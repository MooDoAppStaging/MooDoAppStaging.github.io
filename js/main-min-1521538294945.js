webpackJsonp([0],[function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(4),r=a(1),n=a(5),s=a(51),o=a(102),l=a(9),d=a(34),c=a.n(d),u=a(11),h=a(67),f=(a.n(h),a(68));a.n(f);t.default=function(){var e={vmMain:void 0,isShowingLogin:new l.a(!1),topBarHeight:i.a.android?56:44,archivedPadding:34,itemTransitionTime:100,iOSDragTime:400,iOSDragTimeKeyboardOpen:200,scrollbarWidth:12,hasFocus:!0,zoomTime:0,demoMode:!1,intro:void 0,focusedPane:void 0,focusedItem:void 0,ClickThreshold:5,isFirstRun:!1,isReconnected:!1,isBlocked:!1,blockedMessage:"",authImmediateFailed:!1,authUserLoggedIn:!1,noLocalWrites:!1,noLocalWritesReason:r.a.LocalWriteReason.Enabled,isLoadingRemote:!1,isSendingEmail:!1,isSavingDrafts:!1,isKeyboardOpen:!1,itemMenuOpenedOn:void 0,errorPlatformInfo:void 0,nativeBacklog:[],nativeBridge:{sendToApp:function(t,a){e.nativeBacklog.push({method:t,data:a})}},elements:{},SPThresholdLeft:8,SPThresholdRight:42,MobileSideTapThreshold:40,MobileSideTapThresholdKeyboardOpen:15,minItemHeight:32,colorBlue:"#09d",colorLightBlue:"#02b1ff",colorRed:"#d43",colorLightRed:"#f34433",MinItemWidth:50};e.paneTop=i.a.app?20:0,e.overviewPaddingStart=32,e.overviewPaddingIncrement=18,window.ScrollDuration={Snap:0,Default:200,Slow:500},window.ButtonCode={None:-1,Left:0,Middle:1,Right:2},window.Direction={Up:-1,None:0,Down:1},window.TextSpace="\ufeff",window.AttachChar=" ",window.EmbedAttachChar=" ",window.DriveStatus={Offline:0,Connecting:1,Saving:2,Saved:3,Reconnecting:4},window.PaneMode={Task:"PaneTask",Archived:"PaneArchived",Drive:"PaneDrive",Gmail:"PaneGmail"},window.MessageAction={Default:0,Reload:1,LoginScreen:2,Demo:3,ResetClient:4,None:5,SyncContacts:6,OpenURL:7,Okay:8,Blog:9,Undo:10,Contact:11,OpenSettings:12,OpenAccountSettings:13,OpenGoogleDrive:14,OpenDisplaySettings:15,StartDemo:16,OpenLinkedSettings:17,OpenGeneralSettings:18,OpenCalendarSettings:19},window.MessageType={Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7},window.MessageID={Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,SyncContacts:10,ExitDemo:11,Reauthorize:12,ShareFailure:13,ThisIsDemo:14,MailbirdClick:15,InviteFailure:16,InviteSuccess:17,PremiumRequired:18,TrialOver:19,TrialEndSoon:20,DisabledFolderDrop:21,WarnLargeFile:22,InviteInvalid:23,NoSharingWarning:24,LostPermission:25,CalendarSync:26,EmailSendFail:28,EmailUpdateFail:29,EmailLabelFail:30,EmailSyncFail:31,OldUserNewTrial:32,DemoPluginClick:33,PromptScriptStart:34,SnoozeOffline:35,NeedDrivePermission:36,NeedGmailPermission:37,LostLinked:38,GmailDisabled:39,LocalWritesDisabled:40,MissingOffline:41,MissingOfflineMobile:42,FlatSearchMultiSelect:43,FlatSearchEnter:44,FlatSearchTab:45,ReadOnlyCalendar:46,CalendarSaveFail:47,QuotaError:48,ReselectEmail:49,ReactError:50},window.VMLIFlag={None:0,Header:1,Collapsed:2,Selected:4,Highlighted:8,NumList:16,Note:32,Multiline:64,Archived:128,Complete:4096,P2:8192,P1:16384,P0:32768,Starred:65536,HasPageToken:131072,DisplayComplete:262144},window.UninitializedVersion=-1,window.VersionType={Structure:1,Text:2},window.SaveFlag={None:0,Prop:1,Text:2,All:3},window.RepeatFreq={Once:0,Daily:1,Weekly:2,Monthly:3,DayOfMonth:4,Yearly:5,EndOfMonthOffset:6,NthMonthInst:7},window.DateType={Once:1,Repeat:2},window.ChangeType={None:0,Local:1,Remote:2,Auto:4,Structure:33554432,Text:67108864,Property:134217728,Rollover:1048576,UndoRedo:2097152,PluginLoad:4194304,ItemLoad:8388608,DocLoad:65536,Locations:7,All:234881024,AllLocal:234881025,AllRemote:234881026,Valid:250675207},window.StorageType={InMemory:1,LocalStorage:2,IndexedDB:3},window.LoginState={NONE:0,LOGGED_OUT:1,LOGGED_IN:2},window.ReturnValue={Success:0,Error:1,FatalError:2},window.OAuthSchemeType={Invalid:-1,None:0,Web:1,Native:2,Count:2},window.ACProvider={None:0,Contact:1,DatePicker:2,DateList:3,Tag:4,Search:5},window.DataSource={Paste:1,Drop:2,Plugin:3},window.PluginID={Moodo:"Moodo",Contacts:"Contacts",Drive:"Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"GCalendar"},window.PluginSettingsID={},window.PluginLoad={None:0,Preview:1,Full:2,Runtime:4,Autocomplete:8,Inline:16},window.PluginDependency={DemoMode:"DemoMode",GoogleLogin:"GoogleLogin",PremiumSub:"PremiumSub",EarlyAccess:"EarlyAccess",LocalLoaded:"LocalLoaded"},window.PluginRenderTypes={Generic:0,StyledText:1,UnstyledText:2,Measure:3},window.PluginRenderers={Unknown:-1,DriveFile:0,EmailThread:1,CalendarEvent:2},window.Modals={ReportBug:"reportBug",ImportData:"importData",ExportData:"exportData",RevisionHistory:"revisionHistory",ShareDoc:"shareDoc",MobileSettings:"mobileSettings",Settings:"settings",Confirm:"confirm",Alert:"alert",Options:"options",Billing:"billing",DeleteAccount:"deleteAccount",EmailPreview:"emailPreview",ReportProblem:"reportProblem",Welcome:"welcome",EmailCompose:"emailCompose",EmailReply:"emailReply",Invoices:"invoices",Prompt:"prompt",Lightbox:"lightbox",EnterCode:"enterCode"},window.PremiumStatus={Unknown:0,Never:1,Trial:2,TrialOver:3,Active:4,PastDue:5,CanceledUser:6,CanceledPastDue:7},function(){function e(e){return e}window.PrivateAPIErrorCodes={Success:0,UnknownFailure:e(1),Unexpected:e(2),DatabaseReadError:e(3),DatabaseWriteError:e(4),MissingParameter:e(5),InvalidParameter:e(6),UnauthorizedUser:e(7),ErrorSendingEmail:e(8),AlreadyReferred:e(9),ErrorContactingRemote:e(10),BraintreeUnknown:e(11),InvalidToken:e(12),InvalidReferralCode:e(13),NoSignupFound:e(14),TrialOver:e(15),RemoteServerError:e(16),TokenMissing:e(17),BraintreePaypalBlock:e(18),BraintreeInvalidCCN:e(19),AlreadyExists:e(20),DomainPolicy:e(21),InvalidCode:e(22)}}(),window.DataChangeType={Add:1,Remove:2,Change:3},window.SearchResultStatus={Done:1,TooMany:2,None:3,Error:4},window.Settings={theme:"theme",syncContacts:"syncContacts",lastContactSync:"lastContactSync",lastTaskSync:"lastTaskSync",lastQuickAddSync:"lastQuickAddSync",disableNotifications:"disableNotifications",notificationDelay:"notificationTime",rootFolderId:"rootFolderId",attachFolderId:"attachFolderId",authScopes:"authScopes",localIntegrity:"localIntegrity",localDataVersion:"localDataVersion",localRecoverVersion:"localRecoverVersion",shownTutorial:"shownTutorial",gdocId:"gdocId",gdocTitle:"gdocTitle",activeUser:"activeUser",userId:"userId",displayName:"displayName",lastServerVersion:"lastServerVersion",helpPaneState:"helpPaneState",closedImport:"closedImport",closedHelps:"closedHelps",oauthScheme:"oauthScheme",premiumStatus:"zzp",enableOfflineAuth:"enableOfflineAuth",trialStart:"pzs",trialDuration:"pzd",trialExtended:"pze",premiumEndDate:"ped",notifiedTrialOver:"notifiedTrialOver",notifiedTrialEndSoon:"notifiedTrialEndSoon",inTooltipIntro:"inTooltipIntro",keyboardToolbarScroll:"keyboardToolbarScroll",defaultItemPrefix:"defaultItemPrefix",dayWeekStart:"dayWeekStart",trialOverHidden:"trialOverHidden",checkboxOpacity:"checkboxOpacity",checkboxBackgroundOpacity:"checkboxBackgroundOpacity",showVerticalLines:"showVerticalLines",verticalLinesOpacity:"verticalLinesOpacity",boldHeaders:"boldHeaders",itemPadding:"itemPadding",notePadding:"notePadding",itemLineHeight:"itemLineHeight",noteLineHeight:"noteLineHeight",itemIndentSize:"itemIndentSize",fontSize:"fontSize",fontSizeHeader:"fontSizeHeader",fontSizeHeaderTopLevel:"fontSizeHeaderTopLevel",noteFontSize:"noteFontSize",tagColor:"tagColor",dateColor:"dateColor",contactColor:"contactColor",linkColor:"linkColor",underlineP:"underlineP",layoutTheme:"layoutTheme",grayscale:"grayscale",helpState:"helpState",localPaneState:"localPaneState",workspaces:"workspaces",selectedWorkspace:"selectedWorkspace",paneHistoryMobile:"paneHistoryMobile",cacheSizeRatio:"cacheSizeRatio",monthlyInvoice:"monthlyInvoice",invoiceEmail:"invoiceEmail",invoiceCompany:"invoiceCompany",invoiceAddress:"invoiceAddress",isUnsubscribed:"isUnsubscribed",showSidebar:"showSidebar",sidebarWidth:"sidebarWidth",searchExpandsCollapsed:"searchExpandsCollapsed",openEvernoteApp:"openEvernoteApp",closedVideo:"closedVideo",agendaSort:"agendaSort",dateFormat:"dateFormat"},window.__TEXT_CHANGED_UPDATES={NoUpdate:0,PaneSkipped:0,CausedUpdate:0},e.inMaskOnly=function(e,t){return 0==(~t&e)},e.isFlagSet=function(e,t){return(e&t)===t},e.isOneFlagSet=function(e,t){var a=e&t;return 0!==a&&0==(a&a-1)},e.isAtLeastOneFlagSet=function(e,t){return 0!=(e&t)},e.forEachFlagSet=function(e,t){for(;0!==e;)t(Math.abs(e&-e)),e&=e-1},e.PCMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2|VMLIFlag.Complete,e.PMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2,e.fieldMapIn={isArchived:"a",dateCreated:"c",date:"d",duration:"e",formats:"f",durationText:"g",favorites:"h",items:"i",isNote:"k",modifiedOffline:"l",isCollapsed:"m",note:"n",modifiedOfflineText:"o",priority:"p",dateFormat:"q",repeatDate:"r",dateText:"s",text:"t",versionText:"u",version:"v",isDeleted:"x",isComplete:"z",archivedItems:"ai",allDayDate:"ad",id:"id",isStarred:"*",dateCompleted:"^"},e.priorityMapOut={},e.priorityMapOut[VMLIFlag.None]=" ",e.priorityMapOut[VMLIFlag.P0]=" p0",e.priorityMapOut[VMLIFlag.P1]=" p1",e.priorityMapOut[VMLIFlag.P2]=" p2";var t={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"};e.escape=function(e){return String(e).replace(/[&\"<>]/g,function(e){return t[e]})},e.unescape=function(e){return String(e).replace(/&lt;|&gt;|&amp;|&quot;/g,function(e){for(var a in t)if(t.hasOwnProperty(a)&&t[a]===e)return a;return g.Assert(!1,"Should have found a character to replace"),e})},e.escapeRegExp=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},e.stripTagsBasic=function(e){return e.replace(/<.*>/g,"")},e.stripFormattingTags=function(e){return e.replace(/<\/?[biu]>/g,"")},e.trimPunc=function(e){return e.replace(/[:,\.\'\"\)\]]$/g,"")},e.getTransitionClass=function(e){var t;switch(e){case 50:t="trans05";break;case 100:t="trans1";break;case 200:t="trans2";break;case 300:t="trans3";break;case 400:t="trans4";break;case 500:t="trans5";break;case 1e3:t="trans10";break;default:console.log("ERROR: no time for ",e)}return t},e.setTransformStyle=function(t,a,r){try{e.PAssert(91,t,"Must provide a valid element")}catch(t){e.reportError(t)}if(t){try{e.PAssert(92,void 0!==a,"Must supply a valid X offset")}catch(t){e.reportError(t)}try{e.PAssert(93,void 0!==r,"Must supply a valid Y offset")}catch(t){e.reportError(t)}i.a.ie?t.style[i.a.transform.style]="translate("+a+"px, "+r+"px)":t.style[i.a.transform.style]="translate3d("+a+"px, "+r+"px, 0px)"}},e.setTransitionStyle=function(t,a,r,n){try{e.PAssert(94,t,"Must provide a valid element")}catch(t){e.reportError(t)}t&&(n=n||"ease",t.style[i.a.transition.style]=a+" "+r+"ms "+n,setTimeout(function(){t.style[i.a.transition.style]=""},r))},e.setTransform=function(t,a,r,n,s){n>0?(e.setTransitionStyle(t,i.a.transform.prop,n,s),e.setTransformStyle(t,a,r)):a||r?e.setTransformStyle(t,a,r):t.style[i.a.transform.style]="none"},e.openMainPage=function(){e.isShowingLogin.set(!1)},e.openSetupPage=function(){e.isShowingLogin.set(!0)},e.wasAppCacheUpdated=!1;var a=!1;e.setAppCacheUpdateState=function(t){a=t,t&&(e.wasAppCacheUpdated=!0)},e.reload=function(t){try{e.PAssert(95,!a,"Page should not be reloaded while waiting for an appcache update to finish.")}catch(t){e.reportError(t)}a&&e.reportError(new Error("Page requesting reload while waiting for AppCache update.")),window.location.reload(t)},e.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},e.isEmail=function(e){var t=!1;return e&&(t=!!new RegExp(/\S+@\S+\.\S+/i).exec(e))&&(t=e.indexOf('"')<0),t},e.parseTokensFromText=function(e){for(var t,a=[],i=/(?:(?:[\"]([^\"<>]*)[\"]\s))|(?:([^\",<>]*)\s)<([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>,?|(^|[\s,])<?([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>?,?/g,r=0;null!==(t=i.exec(e));){var n=e.substring(r,t.index),s=t[1]||t[2],o=t[3]||t[5];r=i.lastIndex,n&&n.trim().length>0&&a.push({text:n,type:"text"}),a.push({text:s||o,email:o,type:"contact"})}var l=e.substring(r,e.length);return l&&l.length>0&&a.push({text:l,type:"text"}),a},e.parseEmailAddresses=function(e){return o.a.parse(e)},e.isWhiteSpace=function(e){return/^\s*$/.test(e)},e.removeDOM=function(t){try{e.PAssert(96,t,"Must specify a valid DOM id to remove")}catch(t){e.reportError(t)}var a=document.getElementById(t);try{e.PAssert(97,a,"DOM Element must exist to remove it")}catch(t){e.reportError(t)}a&&a.parentNode.removeChild(a)},e.isRunningScript=function(){return e.AScript&&e.AScript.isRunning};var d,h=!1;e.goOnline=function(){h=!1},e.goOffline=function(){h=!0},e.isOffline=function(){return h},e.preventLocalWrites=function(t){try{e.PAssert(98,!e.noLocalWrites,"Should only disable local writes once")}catch(t){e.reportError(t)}try{e.PAssert(99,t>=0,"Must provide a valid reason for disabling local writes")}catch(t){e.reportError(t)}ShouldLog(LogLevels.Warning)&&log("---- WARNING: Local Writes Disabled ----"),e.noLocalWrites=!0,e.noLocalWritesReason=t},e.shouldWriteLocal=function(){return!e.noLocalWrites},e.isLocalWriteReason=function(t){return e.noLocalWritesReason===t},e.enableDemoMode=function(){e.demoMode=!0;var t=n.a.getURLParam("dmode");t&&e.runOnLoad(function(){e.enableMinMode(t)}),e.preventLocalWrites(r.a.LocalWriteReason.DemoMode)},e.isDemoMode=function(){return e.demoMode},window.DisplayMode={Default:0,InIframe:1,NoPaneHeaders:2,Invisible:4,NoScrollbars:8,NoBackground:16,NoPaneTop:32,NoInteraction:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowDemoExit:1024,NoMinPaneSize:2048,PromptStart:4096,FullMin:8191},e.activeDisplayMode=DisplayMode.Default,e.isDisplayModeActive=function(t){return(e.activeDisplayMode&t)===t},e.isDemoInIframe=function(){return this.isDisplayModeActive(DisplayMode.InIframe)},e.enableMinMode=function(t){try{if(e.addClass(document.body,"minMode"),e.isMinMode=!0,t=e.parseInt(t),i.a.touch||(t&DisplayMode.InIframe&&e.addClass(document.documentElement,"inIframe"),t&DisplayMode.Invisible&&e.addClass(document.documentElement,"invisible"),t&DisplayMode.NoPaneHeaders&&e.addClass(document.body,"noPaneHeaders"),t&DisplayMode.NoMinPaneSize&&(e.minPaneWidth=0),t&DisplayMode.NoPaneStyle&&e.addClass(document.body,"noPaneStyle")),t&DisplayMode.NoPanePadding&&(e.addClass(document.body,"noPanePadding"),e.noPanePadding=!0),t&DisplayMode.NoScrollbars&&(e.noScrollbars=!0),t&DisplayMode.NoBackground&&e.addClass(document.documentElement,"noBackground"),t&DisplayMode.NoInteraction){var a=document.getElementById("outerWrapper"),r=document.createElement("div");r.id="preventInteraction",a.appendChild(r),t&DisplayMode.PromptStart&&e.setupClick(r,r,function(){var t=e.toasts.getMessageById(MessageID.PromptScriptStart);t&&(t.doAction(),t.hide())})}t&DisplayMode.ShowDemoExit&&setTimeout(function(){e.toasts.pushMessage(MessageID.ExitDemo)},0),t&DisplayMode.PromptStart&&setTimeout(function(){e.toasts.pushMessage(MessageID.PromptScriptStart)},0),e.activeDisplayMode=t}catch(t){e.reportError(t)}},e.setDimension=function(t,a){window.ga&&!e.isDemoMode()&&ga("set",t,a)},e.sendEvent=function(t,a,i){try{e.PAssert(100,void 0===i||e.isNumber(i),"Values must be numeric")}catch(t){e.reportError(t)}if(window.ga&&!e.isDemoMode())try{ga("send","event",t,a,e.getAnonUserIdentifier(),i)}catch(r){e.reportError(r,"Category: "+t+" Action: "+a+" Value: "+i)}},e.sendTimeEvent=function(t,a,i){try{e.PAssert(101,e.isNumber(i),"Values must be numeric")}catch(t){e.reportError(t)}if(window.ga&&!e.isDemoMode())try{ga("send","timing",t,a,i,e.getAnonUserIdentifier())}catch(r){e.reportError(r,"Category: "+t+" Variable: "+a+" Value: "+i)}},e.startTimeEvent=function(t,a){if(window.log&&window.log.now){try{e.PAssert(102,void 0===d,"This function needs to be updated to allow nested timing events")}catch(t){e.reportError(t)}d={startTime:log.now(),category:t,variable:a}}},e.endTimeEvent=function(){if(window.log&&window.log.now){try{e.PAssert(103,void 0!==d,"Must have started a timing event")}catch(t){e.reportError(t)}if(d){var t=log.now()-d.startTime;e.sendTimeEvent(d.category,d.variable,t),d=void 0}}};var f={};e.registerEvent=function(t,a,i){try{e.PAssert(104,!f.hasOwnProperty(t),"Should only register an event once")}catch(t){e.reportError(t)}try{e.PAssert(105,void 0!==t,"Must specify a name for the event")}catch(t){e.reportError(t)}try{e.PAssert(106,void 0!==a,"Must specify a category for the event")}catch(t){e.reportError(t)}try{e.PAssert(107,void 0!==i,"Must specify an action for the event")}catch(t){e.reportError(t)}var r={category:a,action:i,label:e.getAnonUserIdentifier(),count:0};f[t]=r},e.aggregateEvent=function(t,a){try{e.PAssert(108,f.hasOwnProperty(t),"Must register an event before using it")}catch(t){e.reportError(t)}void 0===a&&(a=1),f[t]&&(f[t].count+=a)},e.UIAction=function(t){e.sendEvent("UIAction",t)},e.getAggregateEvents=function(){return f};var p=976910954,m=0x6bf609b2d12c;e.reportAdConversion=function(t,a){try{!function(e,t){var a=new Image(1,1),i="//www.googleadservices.com/pagead/conversion/"+p+"/?label="+e+"&guid=ON";t&&(i+="&value="+t+"&currency_code=USD"),a.src=i}(t,a)}catch(t){e.reportError(t)}try{i=new Image(1,1),r="//www.facebook.com/tr?id="+m+"&ev=PageView",i.src=r}catch(t){e.reportError(t)}var i,r};var v=!1;e.pageDataCleared=function(){v=!0},e.hasPageDataBeenCleared=function(){return v};var y=LoginState.LOGGED_OUT;e.getLoginState=function(){var t=y;if(e.shouldWriteLocal())try{var a=n.a.storage.getItem("loginState");null!==a&&void 0!==a&&(t=e.parseInt(a))}catch(t){e.reportError(t)}try{e.PAssert(109,t===LoginState.NONE||t===LoginState.LOGGED_OUT||t===LoginState.LOGGED_IN,"Invalid login state set")}catch(t){e.reportError(t)}return t},e.setLoginState=function(t){try{e.PAssert(110,null!==t&&void 0!==t&&!isNaN(t),"Should always be a valid LoginState enum value")}catch(t){e.reportError(t)}if(y=t,e.shouldWriteLocal())try{(isNaN(t)||null===t||void 0===t)&&(t=LoginState.LOGGED_OUT);try{e.PAssert(111,t===LoginState.NONE||t===LoginState.LOGGED_OUT||t===LoginState.LOGGED_IN,"Invalid login state set")}catch(t){e.reportError(t)}n.a.storage.setItem("loginState",t)}catch(t){e.reportError(t)}},"function"!=typeof String.prototype.startsWith&&(Object.defineProperty?Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}):String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!=typeof String.prototype.prevIndexOf&&(String.prototype.prevIndexOf=function(e,t){for(var a=-1,i=t-1;i>=0;--i)if(this[i]===e){a=i;break}return a}),"function"!=typeof String.prototype.capitalize&&(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}),e.findFirstDiff=function(e,t,a,i){if(!e)return i?0:t.length;if(!t)return i?e.length:0;for(var r=Math.min(e.length,t.length),n=0;n<r;++n)if(a){if(e.charAt(n).toLowerCase()!==t.charAt(n).toLowerCase())return n}else if(e.charAt(n)!==t.charAt(n))return n;return i?e.length:t.length},e.findMatchingLength=function(e,t,a){if(!e||!t)return 0;for(var i=Math.min(e.length,t.length),r=0;r<i;++r)if(a){if(e.charAt(r).toLowerCase()!==t.charAt(r).toLowerCase())return r}else if(e.charAt(r)!==t.charAt(r))return r;return i},e.lerp=function(e,t,a){return e+(t-e)*a},e.TEMP_PREFIX="~T^";var S,E=0;function P(e,t){var a,i,r,n,s,o,l,d;for(a=3&e.length,i=e.length-a,r=t,s=3432918353,o=461845907,d=0;d<i;)l=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24,++d,r=27492+(65535&(n=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(n>>>16)&65535)<<16);switch(l=0,a){case 3:l^=(255&e.charCodeAt(d+2))<<16;case 2:l^=(255&e.charCodeAt(d+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(d)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}function b(e){switch(e){case KeyCode.BackSpace:return"BACKSPACE";case KeyCode.Delete:return"DELETE";case KeyCode.Enter:return"ENTER";case KeyCode.Escape:return"ESCAPE";default:return"CHAR"}}e.generateTempId=function(){return e.TEMP_PREFIX+Date.now()+ ++E},e.isTempId=function(t){return t&&t[0]===e.TEMP_PREFIX[0]&&t[1]===e.TEMP_PREFIX[1]&&t[2]===e.TEMP_PREFIX[2]},e.isLocalItem=function(t){try{e.PAssert(127,t.id,"All items should have an ID even if it is a temp one")}catch(t){e.reportError(t)}return e.isTempId(t.id)},e.requestNotification=function(t){var a=document.forms.requestNotification,i=document.getElementById("notificationResult"),r=a.email.value;return void 0===r||null===r||r.length<5?i.innerText="Please enter a valid email address.":e.XHR_PrivateAPI({type:"POST",path:"/feedback/notification",data:{email:r,platform:t},cb:function(e){200===e.status?(a.email.value="",i.innerText="Thanks for your interest!"):i.innerText="There was an error processing your request, please try again in a few minutes."}}),!1},e.getUserIdentifier=function(){return e.getActiveUser()||e.vmMain&&e.vmMain.getUserEmail()||"me"},e.setActiveUser=function(t){try{e.PAssert(128,t,"Must provide an email")}catch(t){e.reportError(t)}try{e.PAssert(129,"me"!==t,'Active user must never be "me"')}catch(t){e.reportError(t)}"me"!==t&&e.settings.set(Settings.activeUser,t)},e.getActiveUser=function(){var t=e.settings.get(Settings.activeUser);return"me"!==t?t:void 0},e.getAnonUserIdentifier=function(){if(!S){var t=e.getUserIdentifier();S=t[0]+t[1]+t[2]+P(t,17124123)}return S},e.hashString=function(t){try{e.PAssert(130,e.isString(t),"Must always be passing a string to hash")}catch(t){e.reportError(t)}return P(t,129831293)},e.sanitizePaneState=function(e){try{for(var t=JSON.parse(JSON.stringify(e)),a=0;a<t.length;++a)""!==t[a].search&&(t[a].search="HasSearch");return JSON.stringify(t)}catch(e){return"Failed to sanitize pane state"}},e.sanitizeLocalSettings=function(e){try{var t=JSON.parse(e);return delete t.values.Default.paneState,delete t.values.Default.localPaneState,delete t.values.Default.gdocTitle,t}catch(e){return"Failed to parse settings"}},e.sanitizeURL=function(e){return e.replace(/&?access_token=[^&]*/g,"")},e.getLoadedScripts=function(e){try{for(var t=document.getElementsByTagName("script"),a=[],i=0;i<t.length;++i){var r=t[i];r.src&&a.push(r.src)}e.loadedScripts=a}catch(t){e.loadedScripts="ERROR: "+t.message}},e.reportSignup=function(t,a,n){try{e.PAssert(131,t,"Must specify a valid email address to signup with")}catch(t){e.reportError(t)}try{e.PAssert(132,a,"Must provide valid signup info in addition to an email address")}catch(t){e.reportError(t)}t&&a&&(e.sendEvent("Subscribe","NewUser"),a.email=t,function(e){e.platformConfig=i.a.getUserPlatformConfig()}(a),e.XHR_PrivateAPI({type:"POST",path:"/tracking/signup",data:a,requireAuth:!0,cb:function(e){200!==e.status?(ShouldLog(LogLevels.Error)&&log("Failed to report signup",e.responseText,e),n&&n(!1)):n&&n(!0)}}),e.reportAdConversion(r.a.ConversionID.Signup))};var C=!1;e.criticalErrorReported=function(){return C},e.handleCriticalError=function(){C=!0;try{if(e.isDemoMode())e.reload();else{var t=document.createElement("div");t.id="criticalError",t.textContent="There was a critical error while loading the app, "+i.a.actionVerb()+" to reload.",i.a.isTouchDevice?t.addEventListener(i.a.touchStartEvent,function(){e.reload()},!0):t.addEventListener(i.a.upEvent,function(){e.reload()},!0),e.prependChild(document.body,t),e.removeDOM("outerWrapper")}}catch(t){e.reportError(t)}},e.hasOnlineBlockingError=function(){return e.isBlocked||navigator.onLine&&e.failedGapiLoad&&!window.gapiCalled||window.gapiTimeout&&!window.gapiCalled},e.hasCookieBlockingError=function(){return e.authImmediateFailed&&e.vmSetup&&e.vmSetup.getPageLoadLoginState()===LoginState.LOGGED_IN},e.safeStringify=function(e){try{return JSON.stringify(e)}catch(e){}},e.reportEvent=function(t){if(!e.isDemoMode()){var a=e.parseExtra(t);a&&e.eventStream.push(a)}},e.getEventStream=function(){return e.eventStream.ordered()},window.__getEventStream=e.getEventStream,e.parseExtra=function(t){var a;if(t)try{var i;if(t instanceof window.KeyboardEvent){var r=e.elementToString(t.target);["[INPUT#importPW]","[INPUT#importEmail]","[TEXTAREA#bugDescription.bugDescription editable]"].indexOf(r)<0&&(i={type:t.type,currentTarget:e.elementToString(t.currentTarget),target:r,keyCode:b(t.keyCode),normCode:b(t.normCode),ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,altKey:t.altKey,tstamp:Date.now()})}else if(t instanceof window.MouseEvent)i={type:t.type,currentTarget:e.elementToString(t.currentTarget),relatedTarget:e.elementToString(t.relatedTarget),target:e.elementToString(t.target),clientX:t.clientX,clientY:t.clientY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,altKey:t.altKey,which:t.which,button:t.button,tstamp:Date.now()};else if(window.TouchEvent&&t instanceof window.TouchEvent){i={type:t.type,currentTarget:e.elementToString(t.currentTarget),relatedTarget:e.elementToString(t.relatedTarget),target:e.elementToString(t.target),tstamp:Date.now()};var n=t.touches[0];n&&(i.clientX=n.clientX,i.clientY=n.clientY)}else if(window.PointerEvent&&t instanceof window.PointerEvent)i={type:t.type,currentTarget:e.elementToString(t.currentTarget),relatedTarget:e.elementToString(t.relatedTarget),target:e.elementToString(t.target),clientX:t.clientX,clientY:t.clientY,tstamp:Date.now()};else if(t instanceof window.Event)i={type:t.type,name:t.name,code:t.code,message:t.message,currentTarget:e.elementToString(t.currentTarget),relatedTarget:e.elementToString(t.relatedTarget),target:e.elementToString(t.target),tstamp:Date.now()};else if(t instanceof window.Selection)if(0===t.rangeCount)i={rangeCount:0};else{var s=t.getRangeAt(0),o=s.startContainer,l=!1,d=s.endContainer,c=!1;o.nodeType===Node.TEXT_NODE&&(o=o.parentNode,l=!0),d.nodeType===Node.TEXT_NODE&&(d=d.parentNode,c=!0),i={rangeCount:t.rangeCount,startContainer:e.getElementPath(o),startWasTextNode:l,startOffset:s.startOffset,endContainer:e.getElementPath(d),endWasTextNode:c,endOffset:s.endOffset}}else i=t;a=i?e.safeStringify(i):void 0}catch(e){log("Error parsing extra "+e.message)}return a},window.__jsVersion="1521538294945",window.__devServerURL="##DEV_SERVER_URL##";var D=["http://a.visadd.com/script/layer","https://gc.kis.v2.scr.kaspersky-labs.com"];e.rollbarIgnoreFn=function(e,t,a){return!!(a&&a.body&&a.body.trace&&a.body.trace.frames&&a.body.trace.frames[0]&&D.indexOf(a.body.trace.frames[0].filename)>=0)},window.__MAX_ERRORS_REPORTED=50;var I=0,A=!1,M=!1;function _(){var t=e.settings.get(Settings.activeUser);return t?"MooDoRDebug"+(new Date).getTime()+"_"+t:"Unknown"}e.handleJSError=function(t,a,i,r,n){if(r||window.__error("JS Error: "+t,"  Stack: ",a,"  Extra: ",i),t||a){n||(n=LogLevels.Error);try{var s=window.__LOG_BUFFER.ordered().join("\r\n"),o=e.getUserIdentifier();M||("me"!==o&&(M=!0),Rollbar.configure({payload:{person:{id:o}},maxItems:__MAX_ERRORS_REPORTED,checkIgnore:e.rollbarIgnoreFn}));var l=e.parseExtra(i);!function(){if(++I<=window.__MAX_ERRORS_REPORTED){var i={};if(!A){A=!0;try{e.vmMain.getAppInfo(i)}catch(e){Rollbar.error(e)}A=!1}i.numReported=I;var r={url:e.sanitizeURL(window.location.href),logs:s,info:i,user:o,extra:l,jsVersion:window.__jsVersion,htmlVersion:document&&document.body?document.body.getAttribute("ver"):"UNKNOWN"};if(window.Rollbar){var d={message:t,stack:a};n===LogLevels.Error?(Rollbar.error(d,r),e.sendEvent("ErrorReport","Error")):n===LogLevels.Warning?(Rollbar.warning(d,r),e.sendEvent("ErrorReport","Warning")):(Rollbar.error(d,r),e.sendEvent("ErrorReport","Unknown"))}else r.msg=t,r.stack=a,e.XHR_PrivateAPI({type:"POST",path:"/feedback/error",data:r,cb:function(e){200!==e.status?log("Failed to report remote error",e.responseText,e):log("Reported Remote Error: ",e.responseText)}})}}()}catch(e){log("Badness happened reporting errors to server: ",e);try{Rollbar.error({message:t,stack:a}),Rollbar.error(e)}catch(e){log("More badness happened reporting errors to rollbar: ",e)}}}},window.onerror=function(t,a,i,r,n){n?(log("Reported Global OnError: "+t+" Script: "+a+" Line: "+i+" Column: "+r),e.reportError(n)):(log("Unreported Global OnError: "+t+" Script: "+a+" Line: "+i+" Column: "+r),e.reportError(t))},e.reportError=function(t,a,i){!t||a||t.message||t.stack?t&&t.e&&e.isString(t.e)&&(t={message:t.e,stack:e.getCurrentStack("")}):(a=t,t=void 0),t||(t={message:"Undefined error passed to reporter",stack:e.getCurrentStack("")}),e.handleJSError(t.message,t.stack,a,!1,i)},window.__SendInfo=function(t){return e.handleJSError("Remote Client Info",void 0,t,!0),"Thank you for providing your client info!"},window.__CreateDebugSession=function(t){if(window.remote)return"Debug session already started";var a=t||_();window.rcon=window.console,e.handleJSError("Remote Debug Session",void 0,a,!0),e.addScript("http://jsconsole.com/remote.js?"+a,"rDebugScript");var i=!1,r=0,n="";return window.rdbg={startProfile:function(e){try{return i?"Profiler already running":(n=e||"RDBGProfile_"+r,window.rcon.profile(n),i=!0,"Profiler Started: "+n)}catch(e){return"Error starting profile: "+e.message}},stopProfile:function(){try{if(i){window.rcon.profileEnd(n),i=!1;var e="Profile Completed: "+n;return n="",r++,e}return"Profiler not running, use startProfile()"}catch(e){return"Error stopping profile: "+e.message}}},"Your remote debug session has started: "+a},(n.a.hasURLParam("rsession")||n.a.hasURLParam("rdebug","true"))&&setTimeout(function(){var e=n.a.getURLParam("rsession")||_();window.__CreateDebugSession(e),log("%c---- REMOTE DEBUGGING ENABLED: "+e+" ----","color: green")},2e3),window.Checkpoint={MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,LoadDefaultFile:256,DocLoadRequested:512,DocLoaded:1024,MaskRequired:2047},e.checkpoint=function(e){window.__checkpoints|=e},e.hasSentLowMemoryWarning=!1,e.handleLowMemory=function(t){e.hasSentLowMemoryWarning||(e.hasSentLowMemoryWarning=!0,log("Low Memory Event: ",t),e.isNumber(t)&&(t=Math.round(t/1024/1024)+"MB"))};var T=/function\s+([^(]*?)\s*\(([^)]*)\)/,w=!0;e.getCurrentStack=function(e){var t;if(w||i.a.noErrorStacks)try{t=JSON.stringify(e)}catch(a){log("Error stringifying stack message",a,e)}if(w){var a=new Error(t||e);if(a.stack)return a.stack}w=!1;try{for(var r=["GenError: "+(t||e)],n=arguments.callee.caller,s=0;n&&s++<75;){var o,l=n.toString(),d=T.exec(l);o=d&&3===d.length&&""!==d[1]&&void 0!==d[1]?"at "+d[1]+"("+d[2].replace(/[\r\n]/g,"")+")":d&&3===d.length?"at <anonymous> ("+d[2].replace(/[\r\n]/g,"")+")":"at <anonymous> (<unknown>)",r.push(o),n=n.caller}return r.join("\n")}catch(e){log("Error generating stack trace",e)}return""};var k,x=0;function L(t,a){return function(){try{return t.apply(this,arguments)}catch(t){e.reportError(t),a&&a(t)}}}function O(t){try{e.PAssert(142,t,"Must specify a callback")}catch(t){e.reportError(t)}return function(){try{if(t)return t.apply(void 0,arguments)}catch(t){e.reportError(t,arguments)}}}if(e.checkForRemoteChanges=function(){var t=Date.now();if(x-t>=12e5)try{e.AppCache&&e.AppCache.checkForUpdate(),e.vmMain&&e.vmMain.vmPicker&&e.vmMain.vmPicker.refreshFiles()}catch(t){e.reportError(t)}finally{x=t}},e.protectFn=L,(k=function(e){var t=window[e];window[e]=function(){var e=Array.prototype.slice.call(arguments),a=e[0];return"function"==typeof a&&(e[0]=L(a)),t.apply?t.apply(this,e):t(e[0],e[1])}})("setTimeout"),k("setInterval"),function(){window.__LOG_BUFFER=new s.a(50);var t=window.log;e.isDemoMode()||(window.log=function(){try{window.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(e){window.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}console.log.apply(console,arguments)},window.__log=function(){try{window.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(e){window.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}});try{window.console.error=function(){try{var t=arguments[0],a=arguments[1];2===arguments.length&&e.isString(t)&&e.isString(a)?e.reportError({message:t,stack:a}):window.__error.apply(window,arguments)}catch(t){window.__error.apply(window,arguments),e.reportError(t)}}}catch(t){e.reportError(t),log("Unable to override console.error")}for(var a in t)t.hasOwnProperty(a)&&(window.log[a]=t[a])}(),e.getObjectInfo=function(t){try{if(t&&t.constructor)return t.constructor.name}catch(t){e.reportError(t)}return typeof t},e.packedFnToString=function(e){for(var t="",a=0;a<e.length;++a)t+=e[a]+".";return t},e.unpackFn=function(t,a){try{e.PAssert(134,e.isFunction(t)||e.isArray(t),"Must supply either a valid function or packed function")}catch(t){e.reportError(t)}var i=NaN;if(e.isFunction(t))i=t;else if(t)try{i=a||window;for(var r=0;r<t.length;++r){try{e.PAssert(135,e.isString(t[r]),"Packed fns must only contain strings: "+r)}catch(t){e.reportError(t)}try{e.PAssert(136,i,"Must be able to unpack each step in object chain: "+t[r]+" in "+e.packedFnToString(t))}catch(t){e.reportError(t)}if(!i){i=NaN;break}i=i[t[r]]}}catch(t){e.reportError(t),i=NaN}return i},e.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.isString=function(e){return"string"==typeof e},e.isObject=function(t){return"object"==typeof t&&null!==t&&!e.isArray(t)},e.isNumber=function(e){return"number"==typeof e&&!isNaN(e)},e.isBoolean=function(e){return!0===e||!1===e},e.isAnything=function(){return!0},e.isValidColor=function(t){return e.isString(t)&&null!==/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.exec(t)},e.parseInt=function(e){return parseInt(e,10)},e.parseBoolean=function(e){return!0===e||"true"===e},e.parseDate=function(t){var a=new Date(t);return e.isDateValid(a)?a:void 0},e.isValidChangeType=function(t){if(void 0!==t&&null!==t){var a=t&~ChangeType.All;if(e.inMaskOnly(t,ChangeType.Valid))return(a&ChangeType.Locations)===ChangeType.None||e.isOneFlagSet(a,ChangeType.Local|ChangeType.Remote|ChangeType.Auto)}return!1},e.isRemoteChange=function(t){try{e.PAssert(137,e.isValidChangeType(t),"Must supply a valid changeType")}catch(t){e.reportError(t)}var a=t&~ChangeType.All;return e.isValidChangeType(t)&&e.isFlagSet(a,ChangeType.Remote)},e.isUndoRedoChange=function(t){try{e.PAssert(138,e.isValidChangeType(t),"Must supply a valid changeType")}catch(t){e.reportError(t)}var a=t&~ChangeType.All;return e.isValidChangeType(t)&&e.isFlagSet(a,ChangeType.UndoRedo)},e.isLocalChange=function(t){try{e.PAssert(139,e.isValidChangeType(t),"Must supply a valid changeType")}catch(t){e.reportError(t)}var a=t&~ChangeType.All;return e.isValidChangeType(t)&&e.isFlagSet(a,ChangeType.Local)},e.isAutoChange=function(t){try{e.PAssert(140,e.isValidChangeType(t),"Must supply a valid changeType")}catch(t){e.reportError(t)}var a=t&~ChangeType.All;return e.isValidChangeType(t)&&e.isFlagSet(a,ChangeType.Auto)},e.changeToString=function(t){try{e.PAssert(141,void 0!==t,"Must supply a valid changeType")}catch(t){e.reportError(t)}var a=[];return e.forEachFlagSet(t,function(e){switch(e){case ChangeType.Local:a.push("Local");break;case ChangeType.Remote:a.push("Remote");break;case ChangeType.Auto:a.push("Auto");break;case ChangeType.Structure:a.push("Structure");break;case ChangeType.Text:a.push("Text");break;case ChangeType.Property:a.push("Property");break;case ChangeType.Rollover:a.push("Rollover");break;case ChangeType.DocLoad:a.push("DocLoad");break;case ChangeType.ItemLoad:a.push("ItemLoad");break;case ChangeType.UndoRedo:a.push("UndoRedo");break;case ChangeType.PluginLoad:a.push("PluginLoad");break;default:a.push("Unknown:"+e)}}),"[ "+(0===a.length?"None":a.join(" "))+" ]"},e.isDOMNode=function(e){return window.HTMLElement?e instanceof HTMLElement:e&&e.tagName&&e.nodeType===Node.ELEMENT_NODE},e.isTextNode=function(e){return e&&e.nodeType===Node.TEXT_NODE},e.ensureDOMNode=function(t){var a;return e.isDOMNode(t)?a=t:e.isTextNode(t)&&(a=t.parentElement),a},e.enumToString=function(e,t){for(var a in e)if(e[a]===t)return a;return null},e.elementToString=function(e,t){if(e){var a=e.nodeName;return e.id&&(a+="#"+e.id),e.className&&(a+="."+e.className.replace(/ /g,".")),t&&e.innerText&&(a+=":"+e.innerText.length),a}return"UNDEFINED"},e.getElementPath=function(t,a){var i=!0,r="";try{for(;t&&"container"!==t.id&&t!==document.documentElement&&t!==document.body;)r+=i?e.elementToString(t,a)+" ":e.elementToString(t)+" ",i=!1,t=t.nodeType===Node.TEXT_NODE?t.parentNode:t.parentElement}catch(e){r+=e.message}return r},e.setupClick=function(t,a,n){try{e.PAssert(143,t,"Expecting an object to bind the click handlers to.")}catch(t){e.reportError(t)}try{e.PAssert(144,a,"Must specify a valid owner for click handlers")}catch(t){e.reportError(t)}a||(a=t);var s=!1;function o(t,i){try{e.PAssert(145,!a.isDestroyed||!a.isDestroyed()||"onMove"===t||"onEnd"===t,"Owner must not be destroyed to handle a click")}catch(t){e.reportError(t)}return n[t].call(a,i)}function l(t){var a=t.eventX-this.lastX,i=t.eventY-this.lastY;if(0!==a||0!==i){var r=!this.moved;this.lastX=t.eventX,this.lastY=t.eventY,t.distanceX=this.distanceX=this.distanceX+Math.abs(a),t.distanceY=this.distanceY=this.distanceY+Math.abs(i),(this.moved||t.distanceX>e.ClickThreshold||t.distanceY>e.ClickThreshold)&&(this.moved=!0,t.moved=this.moved),(n.onMove||n.onFirstMove)&&(t.diffX=t.eventX-this.startX,t.diffY=t.eventY-this.startY,t.xThisFrame=a,t.yThisFrame=i,t.startX=this.startX,t.startY=this.startY,t.startClientX=this.startClientX,t.startClientY=this.startClientY,t.startSrc=this.startSrc,r&&n.onFirstMove&&o("onFirstMove",t),n.onMove&&o("onMove",t)&&t.stopImmediatePropagation())}}function d(e){var t=Date.now(),a=this.lastTouch||t,s=Math.max(0,t-a);this.numClicks?this.numClicks++:this.numClicks=1,e.moved=this.moved,e.timeDelta=s,e.diffX=this.lastX-this.startX,e.diffY=this.lastY-this.startY,e.startX=this.startX,e.startY=this.startY,e.startSrc=this.startSrc,this.startSrc=void 0,s<r.a.DoubleClickTime&&s>0&&n.onDoubleClick&&!this.moved&&o("onDoubleClick",e),isNaN(e.button)||e.button===ButtonCode.Left?(this.lastTouch=t,!n.onClick||this.moved||i.a.mac&&e.ctrlKey||o("onClick",e),n.onEnd&&o("onEnd",e)):e.button===ButtonCode.Middle&&n.onMiddleClick&&!this.moved&&o("onMiddleClick",e),setTimeout(function(){this.lastTouch=void 0,this.numClicks=void 0}.bind(this),r.a.DoubleClickTime)}function c(e){e.timeStart=this.timeStart=Date.now(),this.startSrc=e.target,e.startSrc=e.target,this.moved=!1,e.startX=this.startX=e.eventX,e.startY=this.startY=e.eventY,e.startClientX=this.startClientX=e.clientX,e.startClientY=this.startClientY=e.clientY,this.lastX=e.eventX,this.lastY=e.eventY,this.distanceX=0,this.distanceY=0,(isNaN(e.button)||e.button===ButtonCode.Left||e.button===ButtonCode.Right)&&((isNaN(e.button)||e.button===ButtonCode.Left)&&n.onStart?o("onStart",e):e.button===ButtonCode.Right&&n.onRightStart&&o("onRightStart",e)),isNaN(e.changeLastY)||(this.lastY+=e.changeLastY)}e.isFunction(n)?n={onClick:n}:n&&n.useCapture&&(s=n.useCapture);var u=O(function(a){if(!a.handled){e.lastInputTouch=!0;var r=i.a.ie?a:a.touches[0];return a.eventX=r.pageX,a.eventY=r.pageY,a.clientX=r.clientX,a.clientY=r.clientY,c.call(t,a),a.ignore||(document.addEventListener(i.a.touchMoveEvent,h,s),document.addEventListener(i.a.touchEndEvent,f,s),document.addEventListener(i.a.touchCancelEvent,p,s)),!a.returnFalse&&void 0}}),h=O(function(e){var a=i.a.ie?e:e.touches[0];if(e.eventX=a.pageX,e.eventY=a.pageY,e.clientX=a.clientX,e.clientY=a.clientY,l.call(t,e),e.returnFalse)return!1}),f=O(function(e){document.removeEventListener(i.a.touchMoveEvent,h,s),document.removeEventListener(i.a.touchEndEvent,f,s),document.removeEventListener(i.a.touchCancelEvent,p,s);var a=i.a.ie?e:e.changedTouches[0];if(e.eventX=a.pageX,e.eventY=a.pageY,e.clientX=a.clientX,e.clientY=a.clientY,d.call(t,e),e.returnFalse)return!1}),p=O(function(e){if(document.removeEventListener(i.a.touchMoveEvent,h,s),document.removeEventListener(i.a.touchEndEvent,f,s),document.removeEventListener(i.a.touchCancelEvent,p,s),function(e){n.onCancel&&o("onCancel",e)}.call(t,e),e.returnFalse)return!1}),m=O(function(a){if(!a.handled&&!e.lastInputTouch)return e.lastInputTouch=!1,a.eventX=a.pageX,a.eventY=a.pageY,c.call(t,a),a.ignore||(a.button===ButtonCode.Left&&document.addEventListener(i.a.moveEvent,g,s),document.addEventListener(i.a.upEvent,v,s)),!a.returnFalse&&void 0}),g=O(function(a){if(!e.lastInputTouch)return a.eventX=a.pageX,a.eventY=a.pageY,l.call(t,a),!a.returnFalse&&void 0}),v=O(function(a){if(!a.handled&&!e.lastInputTouch)return document.removeEventListener(i.a.moveEvent,g,s),document.removeEventListener(i.a.upEvent,v,s),a.button===ButtonCode.Left&&d.call(t,a),!a.returnFalse&&void 0}),y=O(function(t){t.handled||e.lastInputTouch||n.onRightClick&&o("onRightClick",t)});return i.a.isTouchDevice&&i.a.isMobileBrowser?t.addEventListener(i.a.touchStartEvent,u,s):t.addEventListener(i.a.downEvent,m,s),i.a.usePointerEvents,n.onRightClick&&t.addEventListener("contextmenu",y,s),this},"function"!=typeof Array.prototype.pushOnlyUniques&&(Array.prototype.pushOnlyUniques=function(e,t){if(!e)return this;for(var a=0,i=e.length;a<i;++a){for(var r=!0,n=0,s=this.length;n<s;++n)if(t&&t(e[a],this[n])||!t&&e[a]===this[n]){r=!1;break}r&&this.push(e[a])}return this}),"function"!=typeof Array.prototype.pushArray&&(Array.prototype.pushArray=function(t){try{e.PAssert(147,e.isArray(t),"Must only supply array to pushArray")}catch(t){e.reportError(t)}return this.push.apply(this,t)}),"function"!=typeof Array.prototype.removeArray&&(Array.prototype.removeArray=function(t){try{e.PAssert(148,e.isArray(t),"Must only supply array to removeArray")}catch(t){e.reportError(t)}return this.filter(function(e){return!t||t.indexOf(e)<0})}),"function"!=typeof Array.prototype.removeAt&&(Array.prototype.removeAt=function(e){return this.splice(e,1)[0]}),"function"!=typeof Array.prototype.remove&&(Array.prototype.remove=function(e,t){var a=this.indexOf(e,t);return a>=0&&this.removeAt.call(this,a),a}),"function"!=typeof Array.prototype.equals){function R(e,t){return e&&t&&"object"==typeof e&&"object"==typeof t?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce(function(a,i){return a&&e[i]===t[i]},!0):e===t}Array.prototype.equals=function(e){if(!e)return!1;if(this.length!==e.length)return!1;for(var t=0,a=this.length;t<a;t++)if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].equals(e[t]))return!1}else if(this[t]!==e[t]&&!R(this[t],e[t]))return!1;return!0}}function N(t,a){try{e.PAssert(153,!1===t.isLoaded,"Must not be loading the same API multiple times")}catch(t){e.reportError(t)}if(a&&a.error){if(2===t.numRetries)for(var i=0;i<t.timeoutCBs.length;++i)try{t.timeoutCBs[i]()}catch(t){e.reportError(t)}t.numRetries++,t.lastTimeout=oe[t.numRetries]||3e3,t.timer=setTimeout(function(){t.timer=void 0,window.gapi.client.load(t.api,t.version,N.bind(window,t))},1e3*t.lastTimeout)}else{for(i=0;i<t.successCBs.length;++i)try{t.successCBs[i]()}catch(t){e.reportError(t)}t.successCBs=[],t.timeoutCBs=[],t.isLoaded=!0}}"function"!=typeof Array.prototype.indexOfWithProperty&&(Array.prototype.indexOfWithProperty=function(t,a){try{e.PAssert(149,void 0!==a,"Called indexOfWithProperty with an undefined value")}catch(t){e.reportError(t)}for(var i=0;i<this.length;i++)if(this[i][t]===a)return i;return-1}),"function"!=typeof Array.prototype.findInsertIndex&&(Array.prototype.findInsertIndex=function(t,a){try{e.PAssert(150,void 0!==t&&null!==t,"Require a valid element to insert")}catch(t){e.reportError(t)}try{e.PAssert(151,a,"Require a valid comparison function")}catch(t){e.reportError(t)}for(var i=0,r=this.length-1;i<=r;){var n=i+r>>1,s=a(this[n],t);if(s<0)i=n+1;else{if(!(s>0))return n;r=n-1}}return i}),e.toLowerCase=function(e){return e.toLowerCase()},e.numberComparator=function(e,t){return e-t},"function"!=typeof Array.prototype.findSorted&&(Array.prototype.findSorted=function(e,t){var a=this.findInsertIndex(e,t);if(0===t(this[a],e))return this[a]}),"function"!=typeof Array.prototype.insertSorted&&(Array.prototype.insertSorted=function(e,t){var a=this.findInsertIndex(e,t);return this.splice.apply(this,[a,0,e]),a}),e.insertIntoText=function(t,a,i){try{e.PAssert(152,i<=t.length)}catch(t){e.reportError(t)}return t.substr(0,i)+a+t.substr(i,t.length-i)},e.arrayUnion=function(e,t){for(var a=[],i=0;i<e.length;i++)a.indexOf(e[i])<0&&a.push(e[i]);for(i=0;i<t.length;i++)a.indexOf(t[i])<0&&a.push(t[i]);return a},e.arrayDiff=function(e,t){for(var a=[],i=0;i<e.length;i++)t.indexOf(e[i])<0&&a.push(e[i]);for(i=0;i<t.length;i++)e.indexOf(t[i])<0&&a.push(t[i]);return a},e.arrayIntersection=function(e,t){for(var a=[],i=0;i<e.length;i++)t.indexOf(e[i])>=0&&a.push(e[i]);return a},e.arrayUniques=function(e,t){e=e||[];var a=[];if(t)for(n=0;n<e.length;++n){var i=!0,r=e[n];for(s=0;s<a.length;++s)if(t(r,a[s])){i=!1;break}i&&a.push(r)}else for(var n=0,s=e.length;n<s;n++)a.indexOf(e[n])<0&&a.push(e[n]);return a},e.mergeObjects=function(t,a){var i=Array.isArray(a),r=i&&[]||{};return i?(t=t||[],r=r.concat(t),a.forEach(function(a,i){void 0===r[i]?r[i]=a:"object"==typeof a?r[i]=e.mergeObjects(t[i],a):-1===t.indexOf(a)&&r.push(a)})):(t&&"object"==typeof t&&Object.keys(t).forEach(function(e){r[e]=t[e]}),Object.keys(a).forEach(function(i){"object"==typeof a[i]&&a[i]&&t[i]?r[i]=e.mergeObjects(t[i],a[i]):r[i]=a[i]})),r};var F={};function U(e,t,a){e.onloadDone=!1,e.onload=function(){e.onloadDone=!0,t&&t()},e.onreadystatechange=function(){"loaded"!==e.readyState||e.onloadDone||(e.onloadDone=!0,t&&t())},a&&(e.onerror=a)}e.loadGoogleAPI=function(t,a,i,r){try{e.PAssert(154,t,"Must supply a valid API name")}catch(t){e.reportError(t)}try{e.PAssert(155,a,"Must supply a valid API version")}catch(t){e.reportError(t)}try{e.PAssert(156,i,"Must supply a valid cb")}catch(t){e.reportError(t)}if(window.gapi&&window.gapi.client){var n=F[t];if(n){try{e.PAssert(157,n.version===a,"Must only load a single version of an API")}catch(t){e.reportError(t)}n.isLoaded?i():(n.successCBs.push(i),r&&n.timeoutCBs.push(r))}else F[t]=n={api:t,version:a,isLoaded:!1,numRetries:0,lastTimeout:0,timer:void 0,successCBs:[i],timeoutCBs:[]},r&&n.timeoutCBs.push(r),window.gapi.client.load(t,a,N.bind(window,n))}else{var s=function(){try{e.PAssert(158,window.gapi&&window.gapi.client,"Must have properly loaded the gapi client lib")}catch(t){e.reportError(t)}e.removeCustomEventListener("gapiLoaded",s),e.loadGoogleAPI(t,a,i,r)};e.addCustomEventListener("gapiLoaded",s)}},e.setupGoogleAPIListener=function(){window.addEventListener("online",function(){for(var e in F){var t=F[e];!t.isLoaded&&t.timer&&(clearTimeout(t.timer),t.timer=setTimeout(function(){window.gapi.client.load(t.api,t.version,N.bind(window,t))},1e3*oe[1]))}})},e.getGoogleAPIStats=function(){var e={};if(window.gapi&&window.gapi.client)for(var t in F){var a=F[t],i={api:a.api,version:a.version,isLoaded:a.isLoaded,numRetries:a.numRetries,lastTimeout:a.lastTimeout,hasTimeout:!!a.timer};if(a.isLoaded)try{i.isAccessible=!!window.gapi.client[t]}catch(e){i.isAccessible=!1}else i.isAccessible=!1;e[t]=i}else e.error="GAPI Client not loaded";return e},e.clamp=function(e,t,a){return Math.max(t,Math.min(a,e))},e.pad2=function(e){return 1===(e=""+e).length?"0"+e:""+e},e.randParam=function(){return"?t="+Date.now()},e.createPath=function(e){return window.location.protocol+"//"+window.location.host+"/"+e},e.addScript=function(t,a,i,r){try{e.PAssert(159,!a||null===document.getElementById(a),"Should never include the same script ID multiple times")}catch(t){e.reportError(t)}var n=document.createElement("script");n.src=t,a&&(n.id=a),i&&U(n,i,r);try{e.PAssert(160,void 0!==n,"Should always be able to create a valid script object")}catch(t){e.reportError(t)}void 0!==n&&document.getElementsByTagName("head")[0].appendChild(n)},e.addScriptHack=function(t,a,i,r){window.define.amd=void 0,e.addScript(t,a,function(){window.define.amd={jQuery:!0},i&&i()},function(){window.define.amd={jQuery:!0},r&&r()})},e.addStylesheet=function(e,t,a){var i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,t&&U(i,t,a),void 0!==i&&document.getElementsByTagName("head")[0].appendChild(i)},e.reportGapiScriptError=function(t,a){log("Failed to load GAPI!",a),e.failedGapiLoad=!0,e.blockedMessage="An extension has blocked apis.google.com from loading.",e.vmMain?e.vmMain.handleGapiLoadError():u.a.listen("VMMainLoaded",function(){e.vmMain.handleGapiLoadError()})},e.reportGapiScriptLoad=function(e,t){},e.DAssert=function(){},e.PAssert=function(t,a){if(!a){var i={isAssert:!0,tag:t};try{var r=function(t){for(var a="",i=0;i<t.length;++i)a+=" "+e.safeStringify(t[i]);return a}(Array.prototype.slice.call(arguments,2));arguments.length>2?log("Assert Failure "+t+": "+r):log("Assert Failure "+t),e.reportError(new Error("Assert Failure: "+r),i,LogLevels.Warning)}catch(a){log("Exception in PAssert "+t+": ",a),e.reportError(a,i)}}},e.getElementParent=function(t){for(;t;){if(e.hasClass(t,"item")||e.hasClass(t,"paneHiddenInput"))return t;t=t.parentNode}};var B=0;function V(t,a){if(t){var i=function(e,t){return!!e&&(t?e.lastFindPass===B:e.lastFindPass<B)}(t,a);try{e.PAssert(235,i,"Item should always be valid")}catch(t){e.reportError(t)}return t.lastFindPass=B,i}return!1}function H(t,a,i){var r,n=i&&i.isTest,s=i&&i.ignoreSearch,o=i&&i.sameLevel,l=i&&i.includeNotes;if(V(t,n)){var d=t.parent();if(d){if(t.isNote())return t.parent();var c=d.getChildIndex(t);if(c>0)for(;!r;){for(var u=!1,h=c-1;h>=0;h--){var f=d.getChild(h);if(!V(f,n)){try{e.PAssert(237,!1,"Invalid child found during findPreviousItem")}catch(t){e.reportError(t)}return}if(o||!f.hasChildren()||a&&f.isCollapsed(a,!1)){if(s||!a||!f.isHidden(a,!1)){r=f,u=!0;break}}else if(s||!a||!f.isHidden(a,!1)){d=f,c=f.numChildren(),u=!0;break}}if(o)break;u||(r=d)}else o||(r=t.parent());l&&r&&r.hasNote()&&(r=r.getNote());try{e.PAssert(238,!o||!r||r.parent()===t.parent(),"Previous item must share the same parent")}catch(t){e.reportError(t)}try{e.PAssert(239,n||!r||a&&r.isCollapsed(a,!1)||t===q(r,a,{isTest:!0,ignoreSearch:s,sameLevel:o}),"Previous/Next should always match")}catch(t){e.reportError(t)}return r}}}function q(t,a,i){var r,n=i&&i.isTest,s=i&&i.ignoreSearch,o=i&&i.sameLevel,l=i&&i.includeNotes;if(t){if(l&&t.hasNote())return t.getNote();if(t.isNote()&&(t=t.parent()),!o&&t.hasChildren()&&(!a||!t.isCollapsed(a,!1)))for(var d=t.numChildren(),c=0;c<d;++c){if(!V(p=t.getChild(c),n)){try{e.PAssert(241,!1,"Invalid child found during findNextItem A")}catch(t){e.reportError(t)}return}if(s||!a||!p.isHidden(a,!1)){r=p,i&&i.numLevels++;break}}for(var u=t;!r;){if(!V(u,n)){try{e.PAssert(242,!1,"Invalid parent found during findNextItem B")}catch(t){e.reportError(t)}break}var h=u.parent();if(!h)break;var f=h.getChildIndex(u);if(d=h.numChildren(),!a||!h.isCollapsed(a,!1))for(c=f+1;c<d;++c){var p;if(!V(p=h.getChild(c),n)){try{e.PAssert(244,!1,"Invalid child found during findNextItem C")}catch(t){e.reportError(t)}return}if(s||!a||!p.isHidden(a,!1)){r=p;break}}if(u=h,i&&!r&&i.numLevels--,o||a&&u===a.getItem())break}try{e.PAssert(245,!o||!r||r.parent()===t.parent(),"Next item must share the same parent")}catch(t){e.reportError(t)}try{e.PAssert(246,n||!r||t===H(r,a,{isTest:!0,ignoreSearch:s,sameLevel:o}),"Previous/Next should always match")}catch(t){e.reportError(t)}return r}}e.getPreviousItem=function(e,t,a){return B++,H(e,t,a)},e.getNextItem=function(e,t,a){return B++,q(e,t,a)},e.getFirstItem=function(t,a){try{e.PAssert(253,t.belongsToSameItemStore(a),"Must match item stores")}catch(t){e.reportError(t)}if(t.id===a.id||a.parent().id===t.id)return t;if(t.parent().id===a.id)return a;var i,r,n=t,s=void 0;do{i=a,r=void 0;do{if(n.id===i.id){if(void 0===s)return t;if(void 0===r)return a;try{e.PAssert(254,n.id===r.parent().id,"Must share a common parent")}catch(t){e.reportError(t)}try{e.PAssert(255,n.id===s.parent().id,"Must share a common parent")}catch(t){e.reportError(t)}try{e.PAssert(256,s.id!==r.id,"If both previous items match, they should have been the common ancestor")}catch(t){e.reportError(t)}return s.getIndex()<r.getIndex()?t:a}r=i}while(void 0!==(i=i.parent()));s=n}while(void 0!==(n=n.parent()));try{e.PAssert(257,!1,"One item must appear first in the tree")}catch(t){e.reportError(t)}},e.animateTransform=function(t,a){try{e.PAssert(258,t,"Must supply a valid element to transform")}catch(t){e.reportError(t)}try{e.PAssert(259,a,"Options must always be defined")}catch(t){e.reportError(t)}if(t){var r=a.transform;if(!isNaN(a.delay)){var n=a.delay;return a.delay=void 0,void setTimeout(e.animateTransform,n,t,a)}function s(){a.clearTransform&&(t.style[i.a.transform.style]="",t.style[i.a.transformOrigin.style]=""),a.onComplete&&a.onComplete()}if(a.time){var o=e.getTransitionClass(a.time);e.addClass(t,o),setTimeout(function(){e.removeClass(t,o),s()},a.time)}else s();isNaN(a.opacity)||(t.style.opacity=a.opacity),r||isNaN(a.left)||isNaN(a.top)||(r="translate3d("+a.left+"px, "+a.top+"px, 0)"),a.origin&&(t.style[i.a.transformOrigin.style]=a.origin),t.style[i.a.transform.style]=r}},e.easeOut=function(e,t,a){return-a*e*(e-2)+t};var G={};e.scrollTo=function(t,a,i,r,n){try{e.PAssert(260,void 0!==t||void 0!==a,"Must be scrolling something")}catch(t){e.reportError(t)}try{e.PAssert(261,void 0===t||e.isNumber(t),"Must provide a valid scrollPosX")}catch(t){e.reportError(t)}try{e.PAssert(262,void 0===a||e.isNumber(a),"Must provide a valid scrollPosY")}catch(t){e.reportError(t)}try{e.PAssert(263,e.isNumber(i),"Must provide a valid duration")}catch(t){e.reportError(t)}try{e.PAssert(264,e.isDOMNode(r),"Must provide a valid element to scroll")}catch(t){e.reportError(t)}try{e.PAssert(265,!n||e.isFunction(n),"Must provide a valid scrollDone callback")}catch(t){e.reportError(t)}var s=r.getAttribute("data-moo-id")||r.id;try{e.PAssert(266,s,"Should only scroll elements with ids")}catch(t){e.reportError(t)}if(G[s]&&(cancelAnimationFrame(G[s]),delete G[s]),r)if(i>0){if(void 0!==t)var o=r.scrollLeft,l=t-o;if(void 0!==a)var d=r.scrollTop,c=a-d;var u;(Math.abs(l)>0||Math.abs(c)>0)&&(G[s]=requestAnimationFrame(function h(f){u||(u=f-20);var p=Math.min((f-u)/i,1);if(void 0!==t){var m=e.easeOut(p,o,l);r.scrollLeft=m}if(void 0!==a){var g=e.easeOut(p,d,c);r.scrollTop=g}1===p?(delete G[s],n&&n()):G[s]=requestAnimationFrame(h)}))}else r&&(void 0!==t&&(r.scrollLeft=t),void 0!==a&&(r.scrollTop=a)),n&&n();else e.reportError(new Error("Must specify an element to scroll to"))},e.computeScrollSpeed=function(t,a,i){return(a-t-(a-(i=e.clamp(i,t,a))))/(a-t)};var z={speed:0,pane:void 0},W=!1;function j(){if(z.pane){var e=0+6*z.speed,t=z.pane.addScrollDelta(e);W&&t?requestAnimationFrame(j):(z.speed=0,z.pane=void 0,W=!1)}}e.repeatScroll=function(t,a){try{e.PAssert(267,a&&!e.isString(a),"Must pass a valid pane object to repeatScroll")}catch(t){e.reportError(t)}z.speed=t,z.pane=a,W||(W=!0,requestAnimationFrame(j))},e.cancelRepeatScroll=function(){W=!1},e.elementInPane=function(t){if(t)for(t.nodeType===Node.TEXT_NODE&&(t=t.parentNode);t;){if(e.hasClass(t,"pane")||e.hasClass(t,"paneOverview"))return!!t;t=t.parentElement}return!1},e.elementInPaneEdit=function(t){var a=!1,i=e.getPaneForElement(t);return i&&e.isAncestor(t,i.getContentElement())&&(a=!0),a},e.elementInNonPaneEdit=function(t){var a=!1;if(t&&(t.nodeType===Node.TEXT_NODE&&(t=t.parentNode),!e.elementInPaneEdit(t)))for(;t;){if(e.isKeyboardInputElement(t)){a=!0;break}t=t.parentElement}return a},e.isNonPaneDropTarget=function(t){var a=!1;return e.elementInNonPaneEdit(t)?a=!0:e.findParent(t,"validDropTarget")&&(a=!0),a},e.scrollIntoView=function(t,a,i){try{e.PAssert(268,e.isDOMNode(t),"Must supply a valid DOM node to scroll into view")}catch(t){e.reportError(t)}try{e.PAssert(269,e.isNumber(a)&&a>=0,"Must supply a valid scroll duration")}catch(t){e.reportError(t)}try{e.PAssert(270,!i||e.isFunction(i),"Callback must be a function")}catch(t){e.reportError(t)}try{e.PAssert(271,!e.getReactCell(t),"Use methods on VMPane to scroll VMLIs")}catch(t){e.reportError(t)}var r=!1;if(t){var n=e.findParent(t,"scroller")||e.findParent(t,"fancyScrollContent")||!1;try{e.PAssert(272,n,"Every element must be a child of a scroller to be able to scroll it into view")}catch(t){e.reportError(t)}try{e.PAssert(273,!e.hasClass(n,"customScroller"),"Must not be scrolling this way, use methods on VMPane instead")}catch(t){e.reportError(t)}if(n){var s,o=n.getBoundingClientRect(),l=o.bottom,d=t.getBoundingClientRect(),c=Math.min(d.bottom,d.top+80),u=n.scrollTop;d.top<o.top?s=u+d.top-o.top:c>l&&d.top>o.top&&(s=u+c-l),void 0!==s&&(e.scrollTo(void 0,s,a,n,i),r=!0)}}return r},e.isKeyboardInputElement=function(t){if(t){if("checkbox"===t.type)return!1;if("INPUT"===t.nodeName||"textarea"===t.type||e.findParentAttr(t,"contenteditable","true"))return!0}return!1},e.openKeyboardOnIndex=function(t,a,i,r,n){e.batchRenderUpdates(function(){e._openKeyboardOnIndex(t,a,i,r,n)})},e._openKeyboardOnIndex=function(t,a,n,s,o){try{e.PAssert(274,!1,"Should only be opening keyboard on mobile devices")}catch(t){e.reportError(t)}var l=a.getScrollOffset(),d=!1;if(e.keyboardToolbar.preShow(),!e.isKeyboardOpen){var c=function(){s&&s(),i.a.iosui&&e.keyboardToolbar.show(r.a.KeyboardToolbarMode.Item),e.enforceScroll()};a.addPadding(),i.a.app||i.a.android||i.a.mobileie?d=a.scrollIndexIntoView(n,i.a.keyboardOpenTime,c):(d=a.scrollIndexIntoView(n,i.a.keyboardOpenTime),c()),e.keyboardToolbar.hideTopBarIfLandscape()}return d&&i.a.app&&!i.a.android&&!i.a.ioswk||(s&&s(),e.keyboardToolbar.show(r.a.KeyboardToolbarMode.Item)),X=a,Q=o,J=l,Y=K.Item,i.a.ios&&e.preventClick(),t.preventDefault(),t.stopImmediatePropagation?t.stopImmediatePropagation():t.stopPropagation(),t.returnFalse=!0,e.enforceScroll(),d},e.openKeyboardOnElement=function(t,a,n,s){try{e.PAssert(275,!1,"Should only be opening keyboard on mobile devices")}catch(t){e.reportError(t)}try{e.PAssert(276,e.isDOMNode(a),"Must supply a valid element")}catch(t){e.reportError(t)}var o,l;if(a){o=e.findParent(a,"scroller");try{e.PAssert(277,!e.hasClass(a,"paneScroller"),"Must never scroll a custom scroller this way")}catch(t){e.reportError(t)}l=o?o.scrollTop:0}var d=!1;if(e.keyboardToolbar.preShow(),!e.isKeyboardOpen){var c=function(){e.keyboardToolbar.show(r.a.KeyboardToolbarMode.Modal),n&&n(),e.enforceScroll()};!function(t){if(t){var a=e.dataFor(t);a&&a.addPadding&&a.addPadding()}}(o),i.a.app&&!i.a.ioswk||i.a.android||i.a.mobileie?d=e.scrollIntoView(a,i.a.keyboardOpenTime,c):(d=e.scrollIntoView(a,i.a.keyboardOpenTime),c()),e.keyboardToolbar.hideTopBarIfLandscape()}return d&&i.a.app&&!i.a.android||(n&&n(),e.keyboardToolbar.show(r.a.KeyboardToolbarMode.Modal)),X=o,Q=s,J=l,Y=K.Element,i.a.ios&&e.preventClick(),t.stopImmediatePropagation(),t.returnFalse=!0,e.enforceScroll(),d};var K={None:0,Item:1,Element:2},Y=K.None,X=void 0,Q=void 0,J=0;function Z(e,t,a){for(var i=e.pane,n=e.overview,s=0;s<t.length;++s){var o=t[s];if(!e.headers||o.showInOverview(e.includeArchived)){if((!e.comparator||e.comparator(o))&&e.each&&!1===e.each(o))return!1;n&&!isNaN(e.collapseAfterDepth)&&(a<e.collapseAfterDepth&&1===i.getPerPaneState(o.id,r.a.PerPaneStateField.CollapsedOverview)?i.setPerPaneState(o.id,r.a.PerPaneStateField.CollapsedOverview,void 0):a>=e.collapseAfterDepth&&void 0===i.getPerPaneState(o.id,r.a.PerPaneStateField.CollapsedOverview)&&i.setPerPaneState(o.id,r.a.PerPaneStateField.CollapsedOverview,1)),$(o,e,a+1)}}}function $(e,t,a){a=a||0;var i,r=t.noCollapsed,n=t.pane,s=t.overview;t.includeNotes&&!t.headers&&e.hasNote()&&(t.comparator&&!t.comparator(e.getNote())||t.each&&(i=t.each(e.getNote()))),!1===i||r&&0!==a&&e.isCollapsed(n,s)||!1!==(i=Z(t,e.items.get(),a))&&t.includeArchived&&e.hasArchivedChildren()&&Z(t,e.archivedItems(!0),a)}function ee(t,a){try{e.PAssert(316,"string"!=typeof t,"Should only pass objects to the obj mapping function",t)}catch(t){e.reportError(t)}var i={};for(var r in t){try{e.PAssert(317,t.hasOwnProperty(r),"This should always be the case, the prototype shouldn't be extended")}catch(t){e.reportError(t)}if(void 0!==t[r]&&null!==t[r]){var n=a[r];if(n)i[n]=t[r];else{try{e.PAssert(318,!1,"Incoming field should be added to the field map",r)}catch(t){e.reportError(t)}i[r]=t[r]}}}return i}e.onCloseKeyboardItem=function(){e.isKeyboardOpen&&(X.addPadding(),X.setScrollOffset(J,i.a.keyboardOpenTime),e.isKeyboardOpen=!1,Q&&Q())},e.onCloseKeyboardElement=function(){if(e.isKeyboardOpen){try{e.PAssert(278,X,"Must have a valid scroller")}catch(t){e.reportError(t)}e.scrollTo(void 0,J,i.a.keyboardOpenTime,X),e.isKeyboardOpen=!1,Q&&Q()}},e.onCloseKeyboard=function(){Y===K.Item?e.onCloseKeyboardItem():Y===K.Element&&e.onCloseKeyboardElement()},e.blurActiveElement=function(t){e.ignoreSelectionChange=!!t,document.activeElement&&document.activeElement.blur(),setTimeout(function(){e.ignoreSelectionChange=!1},100)},e.preventScrollPropagation=function(t){try{e.PAssert(279,e.isDOMNode(t),"Must pass in a valid element")}catch(t){e.reportError(t)}try{e.PAssert(280,!e.hasClass(t,"customScroller"),"Should not prevent scroll prop on pane")}catch(t){e.reportError(t)}return t.scrollHeight!==t.clientHeight&&(0===t.scrollTop?t.scrollTop=1:t.scrollTop+t.offsetHeight>=t.scrollHeight&&(t.scrollTop=t.scrollHeight-t.offsetHeight-1),!0)},e.trimString=function(e){for(var t=/\s/,a=(e=e.replace(/^\s\s*/,"")).length;t.test(e.charAt(--a)););return e.slice(0,a+1)},e.enforceScroll=function(e,t){(e||(i.a.ios||i.a.android)&&(!i.a.app||i.a.ios71))&&(setTimeout(function(){window.scrollTo(0,t||0)},0),requestAnimationFrame(function(){window.scrollTo(0,t||0)}),window.scrollTo(0,t||0),document.body.scrollTop=0)},e.preventDefault=function(t){if(t&&t.preventDefault)t.preventDefault();else try{e.PAssert(310,!1,"Invalid event object: "+t)}catch(t){e.reportError(t)}},e.stopPropagation=function(t){if(t&&t.stopPropagation)t.stopPropagation();else try{e.PAssert(311,!1,"Invalid event object: "+t)}catch(t){e.reportError(t)}},e.preventClick=function(){e.addClass(e.element("outerWrapper"),"noClick"),window.ontouchstart=e.preventDefault,requestAnimationFrame(function(){window.ontouchstart=void 0,e.removeClass(e.element("outerWrapper"),"noClick")})},e.searchVMLIs=function(t){try{e.PAssert(312,t,"Must supply a valid options param")}catch(t){e.reportError(t)}e.vmMain.notifySearchStart();try{if(t.itemStoreFilter)e.vmMain.itemStoreManager.runForEachStore(function(e){var a=t.item;$(a&&a.belongsToItemStore(e)?a:e.getRoot(),t)},t.itemStoreFilter);else if(t.item){try{e.PAssert(313,!t.itemStore&&!t.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(t){e.reportError(t)}$(t.item,t)}else if(t.itemStore){try{e.PAssert(314,!t.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(t){e.reportError(t)}$(t.itemStore.getRoot(),t)}else{try{e.PAssert(315,!1,"Must specify a valid search root, using the default root is deprecated")}catch(t){e.reportError(t)}e.vmMain.itemStoreManager.getDefaultItemStore().getRoot()}}catch(t){e.reportError(t)}e.vmMain.notifySearchEnd()},e.searchVMLIsAsArray=function(t){var a=[];return t.each=function(e){a.push(e)},e.searchVMLIs(t),a},e.getActiveSearch=function(){return e.focusedPane.search},e.invertObject=function(e){var t={};for(var a in e)e.hasOwnProperty(a)&&(t[e[a]]=a);return t},e.fieldMapOut=e.invertObject(e.fieldMapIn),e.translateFieldIn=function(t){try{e.PAssert(319,e.fieldMapIn[t],"Incoming field should be added to the field map",t)}catch(t){e.reportError(t)}try{e.PAssert(320,"string"==typeof t,"Should only pass strings to the field mapping function",t)}catch(t){e.reportError(t)}return e.fieldMapIn[t]||t},e.translateFieldOut=function(t){try{e.PAssert(321,e.fieldMapOut[t],"Incoming field should be added to the field map",t)}catch(t){e.reportError(t)}try{e.PAssert(322,"string"==typeof t,"Should only pass strings to the field mapping function",t)}catch(t){e.reportError(t)}return e.fieldMapOut[t]||t},e.translateObjIn=function(t){return ee(t,e.fieldMapIn)},e.translateObjOut=function(t){return ee(t,e.fieldMapOut)};var te,ae={};function ie(){document.removeEventListener("DOMContentLoaded",ie,!1),window.removeEventListener("load",ie,!1);for(var e=0;e<te.length;++e)te[e]();te=void 0}e.addCustomEventListener=function(t,a,i){try{e.PAssert(323,t,"Must provide a valid event name")}catch(t){e.reportError(t)}try{e.PAssert(324,a,"Must provide a valid event handler to add")}catch(t){e.reportError(t)}if(void 0!==i){var r={fn:a,pri:i};ae[t]?ae[t].insertSorted(r,function(e,t){return e<t?1:-1}):(ae[t]=[r],window.addEventListener(t,function(e){for(var a=0;a<ae[t].length&&!1!==ae[t][a].fn(e);++a);}))}else window.addEventListener(t,a)},e.removeCustomEventListener=function(t,a,i){try{e.PAssert(325,t,"Must provide a valid event name")}catch(t){e.reportError(t)}try{e.PAssert(326,a,"Must provide a valid event handler to remove")}catch(t){e.reportError(t)}if(i){for(var r=ae[t],n=!1,s=0;s<r.length;++s)if(r[s].fn===a){n=!0,r.removeAt(s);break}r.length;try{e.PAssert(327,n,"Event listener should always be found when removing")}catch(t){e.reportError(t)}}else window.removeEventListener(t,a)},e.fireCustomEvent=function(t,a,i){if(document.createEvent){var r=document.createEvent("Event");return a&&(r.data=a),r.initEvent(t,!0,!0),(i||window).dispatchEvent(r)}try{e.PAssert(328,!1,"Unable to fire custom event")}catch(t){e.reportError(t)}},e.clone=function(t,a){var i={};for(var r in t)t.hasOwnProperty(r)&&(a&&e.isFunction(t[r])||(i[r]=t[r]));return i},e.cloneMouseEvent=function(e){return{altKey:e.altKey,button:e.button,buttons:e.buttons,clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,currentTarget:e.currentTarget,fromElement:e.fromElement,metaKey:e.metaKey,pageX:e.pageX,pageY:e.pageY,relatedTarget:e.relatedTarget,shiftKey:e.shiftKey,target:e.target,timestamp:e.timestamp,toElement:e.toElement,type:e.type,view:e.view,which:e.which,x:e.x,y:e.y,preventDefault:e.preventDefault.bind(e),stopPropagation:e.stopPropagation.bind(e),stopImmediatePropagation:e.stopImmediatePropagation.bind(e)}},e.loadXML=function(t){try{if(void 0!==window.DOMParser)return(new window.DOMParser).parseFromString(t,"text/xml");if(void 0!==window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")){var a=new window.ActiveXObject("Microsoft.XMLDOM");return a.async="false",a.loadXML(t),a}try{e.PAssert(329,!1,"No XML parser found")}catch(t){e.reportError(t)}return}catch(t){return void e.reportError(t)}},e.adjustOriginToBeInsideBounds=function(e,t,a,i,r,n){var s={x:t.left,y:t.top};return a=a||0,i=i||0,r=r||0,n=n||0,t.bottom+n>e.bottom&&(s.y=Math.max(i,t.top-(t.bottom+n-e.bottom))),t.top-n<e.top&&(s.y=Math.max(i,t.top)),t.right+r>e.right&&(s.x=Math.max(a,t.left-(t.right+r-e.right))),s},e.adjustLeftToBeInsideBounds=function(e,t,a,i){return t+a+i>e.right&&(t=e.right-i-a),t},e.adjustHeightToBeInsideBounds=function(e,t,a,i,r){if(t.bottom+r>e.bottom&&(t.bottom=e.bottom-r,t.bottom-t.top<a)){var n=Math.max(0,t.bottom-a);t.top=n}return Math.min(i,t.bottom-t.top)},e.setOrigin=function(e,t,a){var i=e.left-t,r=e.top-a;e.left-=i,e.right-=i,e.top-=r,e.bottom-=r},e.copyStyles=function(t,a,i){try{e.PAssert(330,t,"Must have a valid source element")}catch(t){e.reportError(t)}try{e.PAssert(331,a,"Must have a valid dest element")}catch(t){e.reportError(t)}try{e.PAssert(332,i,"Must have a valid list of styles to copy")}catch(t){e.reportError(t)}var r=window.getComputedStyle(t);if(r){for(var n=[],s=0;s<i.length;++s)n[s]=r[i[s]];for(s=0;s<n.length;++s)a.style[i[s]]=n[s]}},e.hasClass=function(t,a){try{e.PAssert(333,t,"Must pass in a valid element")}catch(t){e.reportError(t)}return t&&t.classList?t.classList.contains(a):void 0},e.removeClass=function(t,a){try{e.PAssert(334,t,"Must pass in a valid element")}catch(t){e.reportError(t)}t&&t.classList&&t.classList.remove(a)},e.addClass=function(t,a){try{e.PAssert(335,t,"Must pass in a valid element")}catch(t){e.reportError(t)}t&&t.classList&&t.classList.add(a)},e.toggleClass=function(t,a){try{e.PAssert(336,t,"Must pass in a valid element")}catch(t){e.reportError(t)}t&&t.classList&&t.classList.toggle(a)},e.css=function(t,a){try{e.PAssert(337,t,"Must pass in a valid element")}catch(t){e.reportError(t)}if(t)for(var i in a)if(a.hasOwnProperty(i)){var r=a[i];"number"==typeof r&&(r+="px"),t.style[i]=r}},e.findChild=function(t,a){try{e.PAssert(338,t,"Must pass in a valid element")}catch(t){e.reportError(t)}if(t)for(var i=0;i<t.childElementCount;++i){var r=t.children[i];if(e.hasClass(r,a))return r;var n=e.findChild(r,a);if(n)return n}},e.getPluginForElement=function(t){return e.findParent(t,"plugin",4)},e.findParentInItem=function(t,a){for(;t&&!e.hasClass(t,"item");){if(e.hasClass(t,a))return t;t=t.parentNode}},e.findParent=function(t,a,i){try{e.PAssert(339,t,"Must pass in a valid element")}catch(t){e.reportError(t)}if(i||(i=1e3),t)for(var r=t,n=0;n<i&&r;++n,r=r.parentNode)if(e.hasClass(r,a))return r},e.findParentID=function(t,a,i){try{e.PAssert(341,t,"Must pass in a valid element")}catch(t){e.reportError(t)}if(i||(i=1e4),t)for(var r=t,n=0;n<i&&r;++n,r=r.parentNode)if(r.id===a)return r},e.findParentAttr=function(t,a,i){try{e.PAssert(342,t,"Must pass in a valid element")}catch(t){e.reportError(t)}if(t)for(var r=t;r&&r.getAttribute;r=r.parentNode)if(r.getAttribute(a)===i)return r},e.isAncestor=function(t,a){try{e.PAssert(343,t,"Must have a valid element")}catch(t){e.reportError(t)}try{e.PAssert(344,a,"Must have a valid candidate")}catch(t){e.reportError(t)}for(;t&&t!==a;)t=t.parentNode;return!!t},e.firstChildTag=function(t,a){try{e.PAssert(345,t,"Must pass in a valid element")}catch(t){e.reportError(t)}try{e.PAssert(346,a,"Must pass in a valid tag to check")}catch(t){e.reportError(t)}if(t)for(var i=a.toUpperCase(),r=0;r<t.childElementCount;++r)if(t.children[r].tagName===i)return t.children[r]},e.insertAfter=function(t,a){try{e.PAssert(348,t,"Must pass in a valid element")}catch(t){e.reportError(t)}try{e.PAssert(349,a,"Must pass in a valid element")}catch(t){e.reportError(t)}t.parentNode.insertBefore(a,t.nextSibling)},e.prependChild=function(t,a){try{e.PAssert(350,t,"Must pass in a valid element")}catch(t){e.reportError(t)}try{e.PAssert(351,a,"Must pass in a valid element")}catch(t){e.reportError(t)}t.insertBefore(a,t.firstChild)},e.getAncestorChain=function(e){for(var t=e;t;)t.push(t),t=t.parentNode;return[]},e.findCommonAncestor=function(t){for(var a=e.getAncestorChain(t),i=0,r=1;r<t.length&&i+1<a.length;++r)for(var n=t[r];n;){n=n.parentNode;var s=a.indexOf(n,i);if(s>=0){i=s;break}}return a[i]},e.isAttachedToDoc=function(t){try{e.PAssert(353,t,"Must supply a valid element to check")}catch(t){e.reportError(t)}try{e.PAssert(354,t.ownerDocument,"Checked element must have a valid owner document")}catch(t){e.reportError(t)}return!!t.ownerDocument&&(t.ownerDocument.body.contains(t)||t.ownerDocument.documentElement===t)},e.offset=function(t){try{e.PAssert(355,t,"Must pass in a valid element")}catch(t){e.reportError(t)}var a=t.getBoundingClientRect(),i=t.ownerDocument,r=t.ownerDocument.documentElement,n=i.defaultView;return{top:a.top+n.pageYOffset-r.clientTop,left:a.left+n.pageXOffset-r.clientLeft}},e.position=function(e){var t=e.offsetParent,a=e.getBoundingClientRect(),i=t.getBoundingClientRect();return{left:a.left-i.left,top:a.top-i.top}},e.height=function(t){try{e.PAssert(357,t,"Must pass in a valid element")}catch(t){e.reportError(t)}var a=t.offsetHeight,i=window.getComputedStyle(t);return i?("border-box"!==i.boxSizing&&(a-=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom)),a-=parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth)):ShouldLog(LogLevels.Error)&&log("GetComputedStyle failed in globals::height"),a},e.width=function(t){try{e.PAssert(359,t,"Must pass in a valid element")}catch(t){e.reportError(t)}var a=t.offsetWidth,i=window.getComputedStyle(t);return i?("border-box"!==i.boxSizing&&(a-=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight)),a-=parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth)):ShouldLog(LogLevels.Error)&&log("GetComputedStyle failed in globals::width"),a},e.runOnLoad=function(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e):(te||(te=[],document.addEventListener("DOMContentLoaded",ie,!1),window.addEventListener("load",ie,!1)),te[te.length]=e)},e.sendFeedback=function(t,a,i){var r={};e.vmMain.getAppInfo(r),r.eventStream=void 0;var n={name:t,notes:a+"\r\n\r\n\r\n"+JSON.stringify(r,void 0,3)};n.email=e.getUserIdentifier(),n.premiumStatus=e.billingManager.getPremiumStatus(),console.log(r)};var re={};function ne(t){var a=e.sanitizeURL(t).split("?")[0];return re[a]||(re[a]={requests:0,successes:0,retries:0,failures:0}),re[a]}function se(e){ne(e).failures++}e.getXHRStats=function(){return re};var oe=[0,5,15,35,80,170,400,1200],le=[0,408,429,500,502,503,504];e.XHR=function(t){try{e.PAssert(362,t.url,"Must specify a valid URL to use")}catch(t){e.reportError(t)}try{e.PAssert(363,t.type,"Must specify a valid request type")}catch(t){e.reportError(t)}var a=t.url,i=t.type,r=t.cb,n=t.data,s=t.headers,o=t.autoRetry,l=t.timeout,d=Math.min(t.maxRetries||2,6),c=0,u=t.username,h=t.password;function f(){try{e.PAssert(364,c<d,"Should not be calling retry once retries have been exhausted")}catch(t){e.reportError(t)}c<d?(c++,function(e){ne(e).retries++}(a),setTimeout(p,1e3*oe[c])):(se(a),e.reportError(new Error("XHR Failed: "+a)))}function p(){var t,p=new XMLHttpRequest;if(p.timeout=l,p.onreadystatechange=function(){4===p.readyState&&(200!==p.status?c<d?(p.retry=f,o&&le.indexOf(p.status)>=0?p.retry():r(p)):(se(a),r(p)):(function(e){ne(e).successes++}(a),r(p)))},u&&h?p.open(i.toUpperCase(),a,!0,u,h):p.open(i.toUpperCase(),a,!0),s)for(var m in s)p.setRequestHeader(m,s[m]);n?(p.setRequestHeader("Accept","*/*"),s&&s["Content-Type"]||p.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t=n instanceof Blob?n:function(t){var a="";if("object"==typeof t){var i=[];for(var r in t)i[i.length]=encodeURIComponent(r)+"="+encodeURIComponent(t[r]);a=i.join("&").replace(/%20/g,"+")}else{try{e.PAssert(361,"string"==typeof t,"Only Objects or Strings are currently supported")}catch(t){e.reportError(t)}a=t}return a}(n),p.send(t)):p.send()}!function(e){ne(e).requests++}(a),p()},e.XHR_PrivateAPI=function(t){e.vmMain.XHR_PrivateAPI(t)};var de=!1,ce=1,ue={};function he(e){var t,a;if(a=e.url,t=!!a&&ue[a.split("?")[0]]){e.iid=ce++;var i=e.onreadystatechange;e.onreadystatechange=function(){i&&i.apply(e,arguments),t(e)}}}e.registerURLForNotifyXHR=function(e,t){return ue[e]||(ue[e]=t),de};var fe,pe=["https://drive.google.com/otservice/save","https://drive.google.com/otservice/bind"];e.wrapXHR=function(){try{var t=window.XMLHttpRequest.prototype.open,a=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.open=function(a,i,r,n,s){this.url=i,void 0===r&&(r=!0);try{t.call(this,a,i,r,n,s)}catch(t){throw e.reportError(t),t}},window.XMLHttpRequest.prototype.send=function(t){he(this),!this.timeout&&function(e){var t=!1;if(e&&e.url){var a=e.url.split("?")[0];pe.indexOf(a)>=0&&(t=!0)}return t}(this)&&(this.timeout=e.seconds(70));try{this.url&&!this.url.startsWith("https://nikkomsgchannel")&&a.call(this,t)}catch(t){throw e.reportError(t),t}}}catch(t){return void e.reportError(t)}de=!0},e.wrapXHR(),e.areObjectsEqual=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},e.JSONP=function(t){try{e.PAssert(365,t.url,"Must supply a valid URL to fetch")}catch(t){e.reportError(t)}try{e.PAssert(366,t.cb,"Must supply a valid callback")}catch(t){e.reportError(t)}var a=t.url,i=t.data,r=t.cb;if(i){for(var n="",s=Object.keys(i),o=0;o<s.length;o++)n+=encodeURIComponent(s[o])+"="+encodeURIComponent(i[s[o]]),o!==s.length-1&&(n+="&");a+="?"+n}var l=Date.now(),d="jsonp"+Math.round(l+10001*Math.random());window[d]=function(e){r(e),delete window[d]},-1===a.indexOf("?")?a+="?":a+="&";var c=document.createElement("script");c.id=d,c.setAttribute("src",a+"callback="+d),document.getElementsByTagName("head")[0].appendChild(c)},e.element=function(t,a){try{e.PAssert(367,t,"Tried to get an element without an id")}catch(t){e.reportError(t)}e.elements[t]&&!a||(e.elements[t]=document.getElementById(t));try{e.PAssert(368,e.elements[t],"Tried to get an element that doesn't exist",t)}catch(t){e.reportError(t)}return e.elements[t]},e.openUrl=function(t,a,r){try{e.PAssert(369,t,"Must always provide a valid URL to open")}catch(t){e.reportError(t)}if(!t)return!1;var n=e.parseEvernoteLink(t);if(n){var s=e.settings.get(Settings.openEvernoteApp);if(void 0===s)return void e.menus.confirm("Open Evernote links in Evernote app?",function(i){e.settings.set(Settings.openEvernoteApp,i),e.openUrl(t,a,r)});s&&(n.viewUrl?t=n.viewUrl:(t="evernote:///view/"+n.userId+"/"+n.shardId+"/"+n.noteGuid+"/"+n.noteGuid+"/",console.log(t)))}if(i.a.standalone){var o=document.createElement("a");o.setAttribute("href",t),o.setAttribute("target","_blank"),o.setAttribute("rel","noopener noreferrer");var l=document.createEvent("HTMLEvents");l.initEvent("click",!0,!0),o.dispatchEvent(l)}else i.a.app?(i.a.ios&&i.a.appv>=5||i.a.android&&i.a.appv>=5||i.a.isChrome||!t.startsWith("http://")&&!t.startsWith("https://")?t.startsWith("/")&&(t=window.location.host+t):t=t.replace("http://","").replace("https://",""),t.startsWith("callto:")&&(t=t.replace("callto:","tel:")),i.a.ios&&t.startsWith("tel:")?(t.indexOf("://")<0&&(t=t.replace("tel:","tel://")),e.nativeBridge.sendToApp("openURL",t)):i.a.ios&&t.startsWith("mailto:")?open(t):e.nativeBridge.sendToApp("openURL",t),a&&(e.handlerPreventStop(a),a.returnFalse=!0)):(r=r||t.startsWith("evernote:///")||t.startsWith("onenote:")||t.startsWith("bear:"))?open(t,"_self"):open(t,"_blank");return!0},e.isUrlImage=function(e){return(e=e.toLowerCase()).endsWith(".png")||e.endsWith(".jpg")||e.endsWith(".gif")},e.isDateSoft=function(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1},e.isDateValid=function(e){return e&&e instanceof Date&&!isNaN(e.getTime())},e.getLocationOrigin=function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")},e.isSpellcheckEnabled=function(){return fe},e.handlerPreventStop=function(e){e.preventDefault(),e.stopImmediatePropagation?e.stopImmediatePropagation():e.stopPropagation()},e.handlerStopProp=function(e){e.stopImmediatePropagation()},e.fFalse=function(){return!1},e.fTrue=function(){return!0},e.emptyFn=function(){},e.weeks=function(e){return 6048e5*e},e.days=function(e){return 864e5*e},e.hours=function(e){return 36e5*e},e.minutes=function(e){return 6e4*e},e.seconds=function(e){return 1e3*e},e.round=function(e,t){return t=t||2,Number(Math.round(e+"e"+t)+"e-"+t)},e.toFileSize=function(e){if(e){var t=Math.log(e)/Math.log(1024)|0;return(e/Math.pow(1024,t)).toFixed(2)+" "+(0===t?"bytes":"KMGTPEZY"[t-1]+"B")}return null},e.curry=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(this,t.concat(Array.prototype.slice.call(arguments,0)))}},e.saveFile=function(t,a){if(i.a.appPlatform===AppPlatform.Chrome)try{e.nativeBridge.sendToApp("exportData",{content:t,filename:a})}catch(t){e.reportError(t)}else{var r=new Blob([t],{type:"text/plain;charset=utf-8"});saveAs(r,a)}};var me=[];e.downloadFile=function(t,a){if(i.a.supportsNativeDownload()){try{e.PAssert(371,!me[t],"Should not double create a download for the same file")}catch(t){e.reportError(t)}me[t]=e.toasts.pushMessage({text:"Downloading "+a+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%",hold:!0,actionText:""}),e.nativeBridge.sendToApp("downloadURL",{url:t,name:a})}else if(document.createEvent){var r=document.createElement("a");r.href=t;var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),r.dispatchEvent(n)}else window.open(t,"_self")},e.handleNativeDownloadProgress=function(e){var t=e.url,a=e.name,i=e.progress,r=me[t];r&&(1===i?(r.hide(),delete me[t]):r.setText("Downloading "+a+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+Math.round(100*i)+"%"))},e.printPage=function(e){i.a.app||window.open(e).print()},n.a.hasURLParam("nolocal","true")&&(e.noLocalWrites=!0,e.noLocalWritesReason=r.a.LocalWriteReason.NoLocal),e.eventStream=new s.a(25),window.__CHECK_OAUTH=function(){e.XHR({type:"GET",url:"https://accounts.google.com/o/oauth2/auth?scope=email&redirect_uri=http://moo.do&response_type=token&client_id=597847337936.apps.googleusercontent.com",cb:function(e){log("XHR OAuth: ",e)}})};var ge={};e.setReactCell=function(t,a){try{e.PAssert(372,!ge[a]||ge[a]===t,"Should never overwrite a react item, always clear first")}catch(t){e.reportError(t)}ge[a]=t},e.getReactCell=function(e){var t;if(e.nodeType!==Node.TEXT_NODE){var a=e.getAttribute("data-moo-id");t=ge[a]}return t},e.clearReactCell=function(t,a){try{e.PAssert(373,ge[a]===t,"Must be clearing the same item that was set")}catch(t){e.reportError(t)}ge[a]=void 0};var ve={};e.__dbgGetReactElemenets=function(){return ve},e.setDataFor=function(t,a,i){try{e.PAssert(374,!ve[i]||ve[i]===a,"Should never overwrite a react element, always clear first")}catch(t){e.reportError(t)}ve[i]=a},e.clearDataFor=function(e){delete ve[e]},e.dataFor=function(e,t){if(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),t)for(;e&&e!==document;){var a=e.getAttribute("data-moo-id");if(ve[a])return ve[a];e=e.parentNode}else if(e)return a=e.getAttribute("data-moo-id"),ve[a]},e.getItemForElement=function(t){var a=e.dataFor(t,!0,!0);try{e.PAssert(375,!a||e.isVMLI(a),"Must always find a valid VMLI for a given element: "+e.elementToString(t))}catch(t){e.reportError(t)}if(e.isVMLI(a))return a},e.getIndexForElement=function(t){var a=-1,i=e.findParent(t,"item");if(i){var r=e.getReactCellForElement(i);r&&(a=r.getIndex())}return a},e.getPaneForElement=function(t){var a=e.findParent(t,"pane");if(a)return e.dataFor(a);var i=e.findParent(t,"paneOverviewScroller");return i?e.dataFor(i):e.findParent(t,"mobileUIBottom")?e.focusedPane:void 0},e.getPaneObjectForElement=function(t){var a=e.getReactCellForElement(t);if(a)return a.getPaneObject()},e.getReactCellForElement=function(t){for(;t&&t!==document.body;){var a=e.getReactCell(t);if(a)return a;t=t.parentNode}try{e.PAssert(378,!1,"Should always be able to find a valid item for a given element",e.getElementPath(t))}catch(t){e.reportError(t)}},e.getCellForElement=function(t){var a=e.getReactCellForElement(t);if(a)return a.getCell()},e.classNames=function(){for(var t=arguments,a=[],i=0;i<t.length;i++){var r=t[i];if(r)if(e.isString(r)||e.isNumber(r))a.push(r);else if("object"==typeof r)for(var n in r)r.hasOwnProperty(n)&&r[n]&&a.push(n)}return a.join(" ")},e.extend=function(e,t){if(t)for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e},e.isVMLI=function(e){return e&&e.__ISVMLI},e.isPane=function(e){return e&&e.__ISPANE},e.decodeURLObject=function(t){var a;if(t){var i=e.b64_to_utf8(t);try{a=JSON.parse(i)}catch(t){e.reportError(t)}}return a},e.encodeMIMEHeader=function(e){return"=?UTF-8?B?"+window.btoa(unescape(encodeURIComponent(e)))+"?="},e.utf8_to_b64=function(t){var a;try{a=window.btoa(unescape(encodeURIComponent(t))).replace(/\+/g,"-").replace(/\//g,"_")}catch(a){e.reportError(a,t)}return a},e.b64_to_utf8=function(t){var a;try{a=decodeURIComponent(escape(window.atob(t.replace(/-/g,"+").replace(/_/g,"/"))))}catch(a){e.reportError(a,t)}return a},e.qp_to_utf8=function(t){var a;try{a=t.replace(/[\t\x20]$/gm,"").replace(/=(?:\r\n?|\n|$)/g,"").replace(/=([a-fA-F0-9]{2})/g,function(e,t){var a=parseInt(t,16);return String.fromCharCode(a)})}catch(a){e.reportError(a,t)}return a},e.isHTTPStatusCode=function(e,t){return e&&e.error&&e.error.code===t},e.hasGoogleError=function(t,a,i){try{e.PAssert(379,t,"Must specify a valid result object")}catch(t){e.reportError(t)}try{e.PAssert(380,a,"Must specify a valid error domain")}catch(t){e.reportError(t)}try{e.PAssert(381,i,"Must specify a valid error reason")}catch(t){e.reportError(t)}var r=!1;if(t&&t.error&&t.errors)for(var n=t.error.errors,s=0;s<n.length;++s){var o=n[s];if(o.domain===a&&o.reason===i){r=!0;break}}return r},e.timeouts={},e.hasTimeoutOnce=function(t){return!!e.timeouts[t]},e.timeoutOnce=function(t,a,i,r,n,s,o,l){try{e.PAssert(382,t,"Must supply a valid name")}catch(t){e.reportError(t)}try{e.PAssert(383,e.isFunction(a),"must supply a valid cb fn")}catch(t){e.reportError(t)}try{e.PAssert(384,arguments.length<=8,"Too many args passed in")}catch(t){e.reportError(t)}var d=e.timeouts[t];d&&clearTimeout(d),e.timeouts[t]=setTimeout(function(){delete e.timeouts[t],a(r,n,s,o,l)},i)},e.clearTimeoutOnce=function(t){var a=e.timeouts[t];a&&(clearTimeout(a),delete e.timeouts[t])},e.animFrameOnce=function(t,a){var i=e.timeouts[t];i&&cancelAnimationFrame(i),e.timeouts[t]=requestAnimationFrame(a)},e.contentSetAuto=void 0,e.reEnableNone=function(t){try{e.PAssert(385,t,"Must have a valid element to set pointer-events on")}catch(t){e.reportError(t)}t.style["pointer-events"]=""},e.elementFromPoint=function(e,t){return document.elementFromPoint(e,t)},e.parentTextForItem=function(e){for(var t=e.parents(),a="",i=1;i<t.length;i++)i>1&&(a+="  |  "),a+=t[i].generateTitleText();return a},e.scrollToAndHighlightItem=function(t,a){t.highlight(),e.vmMain.paneManager.runForEachPane(function(i){if(i!==a){var r=i.indexOfItem(t);if(r<0&&i.type===PaneMode.Task&&i.isViewOutline()&&t.isDescendantOf(i.item.get())&&i.search.isMatched(t)){e.vmMain.beginUpdateItems();for(var n=t.parent();n&&n!==i.item.get();)n.isCollapsed(i,!1)&&(i.setIgnoreRestoreScroll(),n.setCollapsed(!1,i,!1)),n=n.parent();e.vmMain.commitUpdateItems(),r=i.indexOfItem(t)}r>=0&&i.scrollIndexToMiddle(r,ScrollDuration.Default)}})},e.batchRenderUpdates=function(e,t,a,i,r,n){return c.a.unstable_batchedUpdates(e,t,a,i,r,n)},e.hexToRgb=function(e){return{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}},e.hexToRgbStr=function(e){return parseInt(e.substr(1,2),16)+","+parseInt(e.substr(3,2),16)+","+parseInt(e.substr(5,2),16)},e.rgbToHex=function(t,a,i){return[e.pad2(Math.round(t).toString(16)),e.pad2(Math.round(a).toString(16)),e.pad2(Math.round(i).toString(16))].join("")},i.a.demo&&e.enableDemoMode(),e.setupGoogleAPIListener(),e.fieldMapValidators={isArchived:e.isBoolean,dateCreated:e.isNumber,date:e.isNumber,duration:e.isNumber,formats:e.isAnything,durationText:e.isString,favorites:e.isAnything,items:e.isArray,isNote:e.isBoolean,modifiedOffline:e.isBoolean,isCollapsed:e.isBoolean,note:e.isString,modifiedOfflineText:e.isBoolean,priority:e.isNumber,repeatDate:e.isAnything,dateText:e.isString,text:e.isString,versionText:e.isNumber,version:e.isNumber,isDeleted:e.isBoolean,isComplete:e.isBoolean,archivedItems:e.isArray,allDayDate:e.isBoolean,id:e.isString,isStarred:e.isBoolean,dateCompleted:e.isNumber,dateFormat:e.isString},e.fixFieldDate=function(t){var a;if(e.isString(t)){var i=new Date(t);i&&(a=i.getTime())}else t instanceof Date?a=t.getTime():e.isNumber(t)&&(a=t);return a},e.fieldMapFixer={date:e.fixFieldDate,dateCompleted:e.fixFieldDate};var ye=/https:\/\/www.evernote.com\/shard\/([a-z0-9.\-]+)\/nl\/([a-z0-9.\-]+)\/([a-z0-9.\-]+)/g;return e.parseEvernoteLink=function(e){return e.startsWith("evernote:///view/")?{viewUrl:e}:(ye.lastIndex=0,null!==(t=ye.exec(e))?{shardId:t[1],userId:t[2],noteGuid:t[3]}:void 0);var t},e.isOneNoteLink=function(e){return e.startsWith("onenote:https://")},e.isBearLink=function(e){return e.startsWith("bear://x-callback-url/")},e.getDefaultItemText=function(t){return(t=t||e.settings.get(Settings.defaultItemPrefix))?t+" ":""},e}()},function(e,t,a){"use strict";window.KeyCode={BackSpace:8,Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Delete:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,Colon:58,LAngle:60,RAngle:62,At:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,NumPlus:107,Minus:109,F1:112,F4:115,F12:123,Equals:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,LBracket:219,RBracket:221,Apos:222};var i={EmailOpenTime:250,DoubleClickTime:300,EmailPreviewSizeMin:400,EmailPreviewSizeMax:800,MaxBoardsFree:5,ExpandedPaneWidth:400,HelpWidth:360,StdPaneWidthMin:400,StdPaneWidthMax:900,EmailOpenTimeMobile:150,OverviewWidth:260,OverviewItemHeightDesktop:26,OverviewItemHeightMobile:36,EmailItemHeight:80,RightMenuWidth:100,TrialDuration:14,PaneSpaceSize:0,MSPerHour:36e5,MaxBatchSize:45,TooltipDelay:400,MobileBottomHeight:50,HorizScrollbarHeight:18,PaneHeaderHeight:73,PaneHeaderButtonWidth:32,PaneHeaderButtonHeight:36,PaneHeaderRow2ButtonHeight:30,PaneHeaderRow2Height:36,MobileHeaderRow2Height:36,CalendarResizeHandleHeight:8,DesktopMenuWidthDefault:120,DesktopMenuWidthMax:240,DesktopMenuWidthMinBig:76,DesktopMenuWidthSmall:36,RootItemName:"Home",MinEmailScale:.25,SidebarDragHandleSize:16,SearchHeight:22,DateFormat:{DMY:"dmy",MDY:"mdy",YMD:"ymd"},SettingsSections:{General:"General",Plugins:"Plugins",Account:"Moo.do Account",EarlyAccess:"Send Feedback",Linked:"Email Accounts",Invite:"Invite Friends",GoogleCalendar:"Google Calendar",Contacts:"Contacts",Gmail:"Gmail",Agenda:"Agenda"},ItemAnimationMode:{None:0,Normal:1,Move:2,Search:3},MatchState:{Unknown:void 0,No:0,Yes:1,Negated:2,ChildYes:3},EmailResponseMode:{None:0,Reply:1,ReplyAll:2,Forward:3,Other:4},PluginType:{Unknown:0,Storage:1,Calendar:2,Email:3},SyncResult:{Success:0,FailureOAuth:1,FailureNoWrite:2,FailureNoRead:3,FailureNetwork:4,FailureUnknown:5},Primary:{No:0,Yes:1,Either:2,Both:3,Never:4,Only:5},Shift:{No:0,Yes:1,Either:2},FavoriteGroup:{EmailRoot:1},DropEffect:{Copy:"copy",Move:"move"},HoveredID:{Plugin:"plugin",Collapser:"collapser",Checkbox:"checkbox",Bullet:"bullet"},TaskViewMode:{Outline:"Outline",Groups_Project:"Groups_Project",Groups_Tag:"Groups_Tag",Groups_Contact:"Groups_Contact",Groups_Priority:"Groups_Priority",Agenda_Today:"Agenda_Today",Agenda_Week:"Agenda_Week",Agenda_All:"Agenda_All",Calendar_Day:"Calendar_Day",Calendar_Week:"Calendar_Week",Calendar_Month:"Calendar_Month"},TaskViewModeText:{Outline:"Outline",Groups_Project:"Projects",Groups_Tag:"Tags",Groups_Contact:"Contacts",Groups_Priority:"Priority",Agenda_Today:"Today",Agenda_Week:"Week",Agenda_All:"All",Calendar_Day:"Day",Calendar_Week:"Week",Calendar_Month:"Month"},TaskViewModeTextSimple:{Outline:"Outline",Groups_Project:"Projects",Groups_Tag:"Tags",Groups_Contact:"Contacts",Groups_Priority:"Priority",Agenda_Today:"Agenda",Agenda_Week:"Agenda",Agenda_All:"Agenda",Calendar_Day:"Calendar",Calendar_Week:"Calendar",Calendar_Month:"Calendar"},TaskViewModeIcon:{Outline:"icon-format_list_bulleted",Groups_Project:"icon-folder",Groups_Tag:"icon-hash",Groups_Contact:"icon-user",Groups_Priority:"icon-exclamation",Agenda_Today:"icon-today",Agenda_Week:"icon-view-groups",Agenda_All:"icon-format_align_justify",Calendar_Day:"icon-day-view",Calendar_Week:"icon-view_week",Calendar_Month:"icon-view_comfy"},TaskSortMode:{None:"None",Alphabetical:"Alphabetical",NumItems:"NumItems",Priority:"Priority",Date:"Date",Created:"Created",Completed:"Completed"},TaskSortModeText:{None:"None",Alphabetical:"Alphabetical",NumItems:"# Items",Priority:"Priority",Date:"Date",Created:"Created",Completed:"Completed"},CalendarMonthViewWeekHeight:150,CalendarMonthViewMonthTitleHeight:50,CalendarMonthViewNumWeeksPad:52,CalendarDayViewNumDaysPad:168,CalendarDayViewMaxAllDayHeight:164,CalendarDayViewBlockHeight:50,HTTPStatusCode:{Network:0,Success:200,Created:201,PermRedirect:308,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,Timeout:408,Conflict:409,Gone:410,TooMany:429,ServerError:500,BadGateway:502,Unavailable:503,GatewayTimeout:504},PluginAction:{Gmail:{Archive:1,Unarchive:2,Trash:3,Untrash:4,AddLabel:5,RemoveLabel:6,Star:7,Unstar:8,MarkRead:9,MarkUnread:10,SetPriority:11,Move:12,Snooze:13,ScheduleSend:14,DiscardDraft:15}},HelpMode:{None:0,Normal:1,Hotkeys:3},Pricing:{None:-1,EarlyMonthly:0,EarlyYearly:1,RegMonthly:2,RegYearly:3},LoginFlags:{None:0,NewUser:1,OldUserNewTrial:2,TrialOver:4,TrialAutoReset:8},Analytics:{Dimensions:{PremiumStatus:"dimension1"}},Feature:{ClonePane:"clonePane",OAuth:"oauth"},GmailViewMode:{Date:"Date",Priority:"Priority"},MaxGmailSyncTime:{Premium:30,Free:2},MessageListVisibility:{Hide:"hide",Show:"show"},LabelListVisibility:{Hide:"labelHide",Show:"labelShow",ShowIfUnread:"labelShowIfUnread"},GoogleError:{FailedPrecondition:"failedPrecondition",InsufficientPermissions:"insufficientPermissions",Forbidden:"forbidden",DailyLimitExceeded:"dailyLimitExceeded",UserRateLimitExceeded:"userRateLimitExceeded",RateLimitExceeded:"rateLimitExceeded",SharingRateLimitExceeded:"sharingRateLimitExceeded",QuotaExceeded:"quotaExceeded"},GoogleErrorDomain:{UsageLimits:"usageLimits"},KeyboardToolbarHeight:44,KeyboardToolbarMode:{Item:0,Search:1,Modal:2},DocLoadSkipReason:{None:"None",Already:"Already Loading",Main:"Main Not Loaded",Drive:"Drive Not Loaded",NotAuth:"Not Authorized",LoginState:"Not Logged In"},TopBarMode:{Normal:"Normal",Multiselect:"Selected",Contact:"Contacts",Date:"Date",Tag:"Tag",Note:"Note"},AutocompleteMode:{All:"all",Move:"move",Jump:"jump",Item:"item",Email:"email",Contact:"contact",Tag:"tag",Date:"date",Snooze:"snooze",GmailLabel:"gmailLabel"},ContextMenuMode:{Default:0,Archived:1,Drive:2,Gmail:3},ComponentDisplay:{Desktop:1,Mobile:2,Everywhere:3},RequestPriority:{Low:0,Default:50,UserBlocking:100},Orientation:{Vertical:0,Horizontal:1},DragDropPosition:{Above:-1,On:0,Below:1},SetMode:{Toggle:-1,No:0,Yes:1},SelectOption:{Delay:1,DoNothing:2,AllowPrefix:3},DisplayTheme:{Simple:"Classic",OutlineLight:"Light",OutlineHeavy:"Outliner",Markdown:"Markdown"},ColorTheme:{Light:"light",Dark:"dark"},LocalWriteReason:{Enabled:-1,DemoMode:1,QuotaError:2,NoLocal:3,NoPermission:4,Generic:5},ConversionID:{Purchase:"ha4uCMXduXUQ6vTp0QM",Signup:"LAulCIvcuXUQ6vTp0QM"},IntroVideoID:"qE14CrQiXwc",Prefix:{Header:"#",Bullet:"*",Bullet2:"-",Bullet3:"+",Task:"[",Task2:"[]",Task3:"]",Task4:"[ ]",NumList:"1."},PrefixWidth:20,PaddingAgendaTime:36,HeightAgendaParents:18,LineLeftPad:5,TextSpace:"\ufeff",AttachChar:" ",EmbedAttachChar:" ",PerPaneStateField:{Element:"element",OverviewElement:"oelement",Collapsed:"collapsed",CollapsedOverview:"collapsedOverview",CollapsedSearch:"collapsedSearch"},ItemStoreFilter:{None:0,Dates:1,Contacts:2,Priority:4},NumKeys:[KeyCode.D1,KeyCode.D2,KeyCode.D3,KeyCode.D4,KeyCode.D5,KeyCode.D6,KeyCode.D7,KeyCode.D8,KeyCode.D9,KeyCode.D0],DatePrefix:"@",ContactPrefix:"+",TagPrefix:"#",KeyCode:window.KeyCode,KeyCodesModifiers:[KeyCode.LeftMeta,KeyCode.RightMeta,KeyCode.Ctrl,KeyCode.Alt],KeyCodesArrows:[KeyCode.UpArrow,KeyCode.DownArrow,KeyCode.LeftArrow,KeyCode.RightArrow]};t.a=i},,function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(34),l=a.n(o),d=a(57),c=a.n(d),u=a(25),h=a(9),f=a(19),p=a(11),m=a(38),g={};g.createClass=function(e){try{i.default.PAssert(2029,!e.mixins,"Should not supply separate mixins value")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2030,e.displayName,"Must always specify displayName for react components")}catch(e){i.default.reportError(e)}e.mixins=[g.MooReactMixin];var t=!1;return e.componentDisplay?i.default.isFlagSet(e.componentDisplay,r.a.ComponentDisplay.Desktop)&&(t=!0):(t=!0,__warn("Unmarked React Create: ",e.displayName)),t?c()(e):void 0};var v=0;function y(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function S(e,t,a){if(y(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i,r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var s=0;s<r.length;s++){if(i=void 0,!hasOwnProperty.call(t,r[s]))return!1;if(a&&!1===(i=a(r[s],e[r[s]],t[r[s]])))return!1;if(void 0===i&&!y(e[r[s]],t[r[s]]))return!1}return!0}g.MooReactMixin={shouldComponentUpdate:function(e,t){return!S(this.props,e,this.arePropsEqual)||!S(this.state,t,this.areStatesEqual)},getInitialState:function(){!function(e){if(e.componentDisplay)try{i.default.PAssert(2032,i.default.isFlagSet(e.componentDisplay,r.a.ComponentDisplay.Desktop),"Component created on wrong platform")}catch(e){i.default.reportError(e)}else console.log("Create Unmarked Component: ",e.constructor.displayName)}(this),this.init&&this.init();var e=this.getState?this.getState(this.props):{};this._observables&&(e=i.default.extend(e,this._observables));var t=null;return e&&(this.setupListeners(e),t=this.transformState(e)),t},createObservables:function(e){try{i.default.PAssert(2033,!this._listeners,"You have to run createObservables in init()")}catch(e){i.default.reportError(e)}for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];i.default.isArray(a)?e[t]=new f.a(a):e[t]=new h.a(a);try{i.default.PAssert(2034,!this.hasOwnProperty(t),"Must not multi-define observable properties")}catch(e){i.default.reportError(e)}this[t]=e[t]}try{i.default.PAssert(2035,!this.hasOwnProperty("_observables"),"Must not define an _observables property and use createObservables")}catch(e){i.default.reportError(e)}this._observables=e},addObservable:function(e,t){t=i.default.isArray(t)?new f.a(t):new h.a(t),this[e]=t,this._observables[e]=t,this._addListener(t.listen(this.onListener))},_addListener:function(e){try{i.default.PAssert(2036,e&&e.target,"Must add a valid listener")}catch(e){i.default.reportError(e)}this._ensureListeners();try{i.default.PAssert(2037,!this._hasListener(e.target),"Must not double register the same observable/trigger")}catch(e){i.default.reportError(e)}this._listeners.push(e)},refreshListeners:function(){this.disposeListeners();var e=this.getState?this.getState(this.props):{};this._observables&&(e=i.default.extend(e,this._observables)),e&&this.setupListeners(e)},_ensureListeners:function(){this._listeners||(this._listeners=[],this._permanentListeners=[])},setupListeners:function(e){for(var t in this._ensureListeners(),e||(e=this.getState?this.getState(this.props):{}),e)if(e.hasOwnProperty(t)){var a=e[t];a instanceof h.a&&this._addListener(a.listen(this.onListener))}},disposeListeners:function(e){if(this._listeners){for(var t=0;t<this._listeners.length;++t)this._listeners[t].dispose();if(this._listeners=[],e)for(t=0;t<this._permanentListeners.length;++t)this._permanentListeners[t].dispose()}e&&this.disposeDispatcherListeners()},disposeDispatcherListeners:function(){if(this._dispatcherListeners){for(var e=0;e<this._dispatcherListeners.length;e++){var t=this._dispatcherListeners[e],a=t[0],i=t.slice(1);a.unlisten.apply(a,i)}this._dispatcherListeners=[]}},listenTo:function(e,t){try{i.default.PAssert(2038,e instanceof m.a||e instanceof h.a,"Can only listen to an Observable or a Trigger object")}catch(e){i.default.reportError(e)}if(e instanceof m.a||e instanceof h.a){var a=e.listen(this.onListener);!1!==t?this._addListener(a):this._permanentListeners.push(a)}},listenToDispatcher:function(){this._dispatcherListeners||(this._dispatcherListeners=[]);var e,t=Array.prototype.slice.call(arguments);i.default.isString(t[0])?e=p.a:(e=t[0],t.splice(0,1)),t.push(this.onListener),e.listen.apply(e,t);var a=[e].concat(t);this._dispatcherListeners.push(a)},listenToSetting:function(e,t){this.listenToDispatcher(i.default.settings,"settingChanged",t||Settings.DefaultGroup,e)},_hasListener:function(e){try{i.default.PAssert(2039,e,"Must have a valid target")}catch(e){i.default.reportError(e)}for(var t=!1,a=0;a<this._listeners.length;++a)if(this._listeners[a].target===e){t=!0;break}return t},_getState:function(e){var t=this.getState?this.getState(e||this.props):{};return this._observables&&(t=i.default.extend(t,this._observables)),this.transformState(t)},transformState:function(e){for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];a&&a instanceof h.a&&(e[t]=a.get(),a instanceof f.a&&(e[t+"_arrVer"]=a.version))}return e},onListener:function(){this.updateState()},updateState:function(e){try{i.default.PAssert(2041,this._isMounted,"updateState called on a component that is not yet mounted:",this.constructor&&this.constructor.displayName)}catch(e){i.default.reportError(e)}if(this._isMounted){var t=this.state,a=this._getState(e);this.onBeforeChanged&&(a=this.onBeforeChanged(a,t,e)||a),this.setState(a),this.onAfterChanged&&this.onAfterChanged(a,t)}},setData:function(e,t){try{i.default.PAssert(2042,this.__id,"A unique ID must have been generated for this object")}catch(e){i.default.reportError(e)}i.default.setDataFor(e,t,this.__id),this.__elementData=e},clearData:function(){this.__elementData&&(this.__elementData=void 0,i.default.clearDataFor(this.__id))},componentWillUnmount:function(){this.disposeListeners(!0),this.clearData(),this.__hotkeys&&(u.a.popStack(this.__hotkeys),this.__hotkeys=void 0),this.onUnmount&&this.onUnmount(this.state),this._isMounted=!1},addTap:function(e,t,a){var r=this.refs[e];try{i.default.PAssert(2043,r,"Invalid refName to add tap to: ",e)}catch(e){i.default.reportError(e)}r&&i.default.setupClick(r,t,a)},refElement:function(e){var t=this.refs[e];return i.default.isDOMNode(t)?t:l.a.findDOMNode(t)},getChildByKey:function(e){var t;return s.a.Children.forEach(this.props.children,function(a){a&&a.key===e&&(t=a)}),t},getChildByDisplayName:function(e){var t;return s.a.Children.forEach(this.props.children,function(a){a&&a.type&&a.type.displayName===e&&(t=a)}),t},componentDidMount:function(){this._isMounted=!0,this.getHotkeys?this.__hotkeys=u.a.pushStack(this.getHotkeys()):this.onEscapeKey&&(this.__hotkeys=u.a.pushStackEscape(this.onEscapeKey))},getUniqueID:function(){return this.props["data-moo-id"]?this.props["data-moo-id"]:(this.__id||(this.__id="m_"+v++),this.__id)},componentDidCatch:function(e,t){i.default.reportError(e),i.default.toasts.pushMessage(MessageID.ReactError)}},t.a=g},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(38),s=a(1),o=a(9);function l(){r.a.forceBind("normalizeKeys",this),r.a.forceBind("getKeyCode",this),this.versionRequired=[],this.versionAvailable=[],this.versionRequired[AppPlatform.iOS]=4,this.versionAvailable[AppPlatform.iOS]=6,this.versionRequired[AppPlatform.Android]=4,this.versionAvailable[AppPlatform.Android]=5,this.versionRequired[AppPlatform.WinPhone]=1,this.versionAvailable[AppPlatform.WinPhone]=1,this.versionRequired[AppPlatform.Chrome]=1,this.versionAvailable[AppPlatform.Chrome]=2,this.versionRequired[AppPlatform.Electron]=1,this.versionAvailable[AppPlatform.Electron]=2,this.versionMobile=2,this.versionDesktop=13,this.versionMobileMessages={},this.versionDesktopMessages={11:"Updated design for pane headers and the sidebar. Workspaces and Documents renamed to Boards and Files. See blog for details.",12:"Use Markdown to style your text. Use # for headers and [ for tasks. See blog for details.",13:"New Item hotkey changed to N and New Email hotkey changed to E. And new Evernote integration! See blog for details."},this.appSubVersion=void 0,this.setDeployEnvironments(),this.appStoreLinks=[],this.appStoreLinks[AppPlatform.iOS]="https://itunes.apple.com/us/app/moo.do-organize-your-way/id889830074?ls=1&mt=8",this.appStoreLinks[AppPlatform.Android]="https://play.google.com/store/apps/details?id=moo.do",this.appStoreLinks[AppPlatform.WinPhone]=void 0,this.appStoreLinks[AppPlatform.Chrome]="https://chrome.google.com/webstore/detail/moodo/iffimmolghilclfndeiebgppddmagofk",this.appStoreLinks[AppPlatform.Electron]="https://github.com/MooDoApp/MooDoApp.github.io/releases/latest",this.appReviewLinks=[],this.appReviewLinks[AppPlatform.iOS]=void 0,this.appReviewLinks[AppPlatform.Android]=void 0,this.appReviewLinks[AppPlatform.WinPhone]=void 0,this.appReviewLinks[AppPlatform.Chrome]=void 0,this.appReviewLinks[AppPlatform.Electron]=void 0,this.appPlatform=void 0,this.appStoreLink=void 0,this.appReviewLink=void 0,this.requireCustomRedirect=!1,this.requireCustomPurchase=!1,this.requireCustomPaypal=!1,this.bodyClass=void 0,this.b=document.documentElement,this.orientation=Orientation.Portrait,this.onResize=new n.a,this.kbsizePortrait=Math.ceil(this.getActualWindowHeight()/2),this.kbsizeLandscape=void 0,this.kbsize=new o.a(this.kbsizePortrait),this.appState=void 0,this.isHosted=!1,this.hostedBy=void 0,this.initStorageQuota={quota:NaN,usage:NaN},this.isNearStorageQuota=!1,this.pageVisibilityHidden=void 0,this.pageVisibilityChange=void 0,this._allowNativeNotifications=!0,this.isPhantom=!1,this.isDevURL="dev.moo.do"===window.location.hostname||"beta.moo.do"===window.location.hostname,this._features={},this.init(),this._windowWidth=new o.a(this.getActualWindowWidth()),this._windowHeight=new o.a(this.getActualWindowHeight()),this.app&&(this.customRedirectState={app:!0,appv:this.appv,webview:this.getAppState("webview")}),this.app||this.android?this.keyboardOpenTime=200:this.winphone?this.keyboardOpenTime=200:this.mobileie?this.keyboardOpenTime=600:this.keyboardOpenTime=0}window.Orientation={Portrait:0,Landscape:1},window.PlatformConfig={DesktopWindows:0,DesktopMac:1,DesktopOther:2,ChromeApp:3,AndroidBrowser:4,AndroidApp:5,iOSBrowser:6,iOSApp:7,WinPhoneBrowser:8,WinPhoneApp:9,MobileOther:10,Unknown:11,EmbedDesktopApp:12,EmbedMobileApp:13,ElectronMac:14,ElectronWindows:15,ElectronUnknown:16},window.AppPlatform={iOS:0,Android:1,WinPhone:2,Chrome:3,Embed:4,Electron:5},window.EmbedApps={Mailbird:"mailbird"},window.DeployVariable={Environment:"Environment",APIHost:"APIHost",APIProtocol:"APIProtocol"},l.prototype={getDeployVar:function(e){return this.deployEnvironment[e]},setDeployEnvironments:function(){this.deployEnvironment={},"dev.moo.do"===window.location.hostname?(this.deployEnvironment[DeployVariable.Environment]="dev",this.deployEnvironment[DeployVariable.APIProtocol]="https:",this.deployEnvironment[DeployVariable.APIHost]="//api-dev.moo.do"):"beta.moo.do"===window.location.hostname?(this.deployEnvironment[DeployVariable.Environment]="beta",this.deployEnvironment[DeployVariable.APIProtocol]="https:",this.deployEnvironment[DeployVariable.APIHost]="//api-beta.moo.do"):"localhost"===window.location.hostname?(this.deployEnvironment[DeployVariable.Environment]="local",this.deployEnvironment[DeployVariable.APIProtocol]="https:",this.deployEnvironment[DeployVariable.APIHost]="//api-dev.moo.do"):(this.deployEnvironment[DeployVariable.Environment]="production",this.deployEnvironment[DeployVariable.APIProtocol]="https:",this.deployEnvironment[DeployVariable.APIHost]="//api.moo.do")},getKBSize:function(){return this.kbsize.get()?this.kbsize.get():Math.ceil(this.getActualWindowHeight()/2)},setKBSize:function(e){this.kbsize.set(parseInt(e))},windowWidth:function(e){if(!this._windowWidth.get()&&!e){try{i.default.PAssert(712,!1,"Window width was not set",this._windowWidth.get(),this._windowHeight.get())}catch(e){i.default.reportError(e)}this._windowWidth.set(this.getActualWindowWidth())}return this._windowWidth.get()},windowHeight:function(e){if(!this._windowHeight.get()&&!e){try{i.default.PAssert(713,!1,"Window height was not set",this._windowWidth.get(),this._windowHeight.get())}catch(e){i.default.reportError(e)}this._windowHeight.set(this.getActualWindowHeight())}return this._windowHeight.get()},setWindowSize:function(e,t){this._windowWidth.set(e),this._windowHeight.set(t)},getLocaleInfo:function(e){try{e.lang=navigator.language||navigator.userLanguage}catch(t){e.lang="EXCEPTION"}},getPlatformInfo:function(e){e.os=this.OSName,e.browser=this.browser,e.majorVersion=this.majorVersion,e.minorVersion=this.minorVersion,e.appVersionRequired=this.versionRequired[this.appPlatform],e.app=this.app,e.appPlatform=this.appPlatform,e.standalone=this.standalone,e.packagedApp=this.packagedApp,e.requireCustomRedirect=this.requireCustomRedirect,e.requireCustomPurchase=this.requireCustomPurchase,e.requireCustomPaypal=this.requireCustomPaypal,e.isMobile=this.mobile,e.isMobileBrowser=this.isMobileBrowser,e.isPhone=this.phone,e.isTouch=this.touch,e.isTouchDevice=this.isTouchDevice,e.usePointerEvents=this.usePointerEvents,e.kbsize=this.kbsize.get(),e.appState=this.appState,e.isHosted=this.isHosted,e.hostedBy=this.hostedBy,e.embed=this.embed,e.bodyClass=this.b.className,e.rawUA=navigator.userAgent,e.referrer=document.referrer,e.devicePixelRatio=window.devicePixelRatio,e.pageVisibilityChange=!!this.pageVisibilityChange,e.appSubVersion=this.appSubVersion,e.initStorageQuota=this.initStorageQuota,e.isNearStorageQuota=this.isNearStorageQuota,this.getLocaleInfo(e)},getUserPlatformConfig:function(){var e=PlatformConfig.Unknown;if(this.app)switch(this.appPlatform){case AppPlatform.iOS:e=PlatformConfig.iOSApp;break;case AppPlatform.Android:e=PlatformConfig.AndroidApp;break;case AppPlatform.WinPhone:e=PlatformConfig.WinPhoneApp;break;case AppPlatform.Chrome:e=PlatformConfig.ChromeApp;break;case AppPlatform.Electron:e="Windows"===this.OSName?PlatformConfig.ElectronWindows:"MacOS"===this.OSName?PlatformConfig.ElectronMac:PlatformConfig.ElectronUnknown;break;case AppPlatform.Embed:e=this.mobile?PlatformConfig.EmbedMobileApp:PlatformConfig.EmbedDesktopApp}else switch(this.OSName){case"Windows":e=this.phone?PlatformConfig.WinPhoneBrowser:PlatformConfig.DesktopWindows;break;case"iPad":case"iPod":case"iPhone":e=PlatformConfig.iOSBrowser;break;case"MacOS":e=PlatformConfig.DesktopMac;break;case"Android":e=PlatformConfig.AndroidBrowser;break;case"ChromeOS":case"Linux":default:e=this.phone?PlatformConfig.MobileOther:PlatformConfig.DesktopOther}return e},getAppDownloadURL:function(){return this.appDownloadUrl||(this.mac?this.appDownloadUrl="https://www.moo.do/lnk/mac":this.windows?this.appDownloadUrl="https://www.moo.do/lnk/windows":this.ios?this.appDownloadUrl=this.appStoreLinks[AppPlatform.iOS]:this.android?this.appDownloadUrl=this.appStoreLinks[AppPlatform.Android]:this.appDownloadUrl=this.appStoreLinks[AppPlatform.Chrome]),this.appDownloadUrl||"https://github.com/MooDoApp/MooDoApp.github.io/releases/latest"},supportsNativeApp:function(){switch(this.OSName){case"Windows":case"MacOS":return!this.mobile;default:return!1}},isNativeApp:function(){return this.appPlatform===AppPlatform.Electron},isNativeMac:function(){return this.isNativeApp()&&this.mac},canDownloadNativeApp:function(){return this.supportsNativeApp()&&!this.isNativeApp()},isChromeApp:function(){return this.appPlatform===AppPlatform.Chrome},canDownloadChromeApp:function(){return!(this.mobile||this.supportsNativeApp()||this.isChromeApp()||this.isNativeApp())},init:function(){this.initAppState(),this.initHostState(),this.initFeatures();var e,t,a=navigator.userAgent,n="";if(this.OSName="Unknown OS",this.app&&(n+=" app"),-1!==a.indexOf("Win")?(this.OSName="Windows",this.windows=!0,-1!==a.indexOf("Windows Phone")?(this.phone=!0,this.touch=!0,this.mobile=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.WinPhone],this.app&&(this.appPlatform=AppPlatform.WinPhone)):this.appStoreLink=this.appStoreLinks[AppPlatform.Electron]):-1!==a.indexOf("iPad")?(this.OSName="iPad",this.ios=!0,this.ipad=!0,this.phone=!0,this.touch=!0,this.mobile=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.iOS],this.app&&(this.appPlatform=AppPlatform.iOS)):-1!==a.indexOf("iPhone")?(this.OSName="iPhone",this.ios=!0,this.iphone=!0,this.phone=!0,this.mobile=!0,this.touch=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.iOS],this.app&&(this.appPlatform=AppPlatform.iOS)):-1!==a.indexOf("iPod")?(this.OSName="iPod",this.ios=!0,this.ipod=!0,this.phone=!0,this.mobile=!0,this.touch=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.iOS],this.app&&(this.appPlatform=AppPlatform.iOS)):-1!==a.indexOf("Mac")?(this.OSName="MacOS",this.mac=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.Electron]):-1!==a.indexOf("X11")?-1!==a.indexOf("CrOS")?(this.OSName="ChromeOS",this.chromeOS=!0):(this.OSName="UNIX",this.unix=!0):-1!==a.indexOf("Android")?(this.OSName="Android",this.android=!0,this.touch=!0,this.mobile=!0,this.phone=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.Android],this.app&&(this.appPlatform=AppPlatform.Android),n+=" android"):-1!==a.indexOf("Linux")&&(this.OSName="Linux",this.linux=!0),this.ios){if(this.ios7=-1!==a.indexOf("OS 7"),this.ios70=-1!==a.indexOf("OS 7_0"),this.ios71=-1!==a.indexOf("OS 7_1"),this.ios10=-1!==a.indexOf("OS 10"),this.ios11=-1!==a.indexOf("OS 11"),this.appState)"ioswk"===this.appState.webview?this.ioswk=!0:this.iosui=!0,this.appState.oauth&&this._enableFeature(s.a.Feature.OAuth);this.ios7&&(n+=" ios7")}if(this.majorVersion=1e3,this.minorVersion=1e3,-1!==a.indexOf("MSIE")||-1!==a.indexOf("Trident"))this.browser="Trident",this.ie=!0,this.winphone=!!a.match(/IEMobile/i),null!==(this.winphone||"Microsoft Internet Explorer"===navigator.appName?new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")).exec(a)?this.majorVersion=parseFloat(RegExp.$1):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(a)&&(this.majorVersion=parseFloat(RegExp.$1));else if(-1!==a.indexOf("Chrome")||-1!==a.indexOf("CriOS")){this.browser="Chrome",this.isChrome=!0,null!==new RegExp("Chrome/([0-9]{1,}).").exec(a)&&(this.majorVersion=parseFloat(RegExp.$1)),-1!==a.indexOf("Edge")&&(this.ieEdge=!0),this.app&&this.appPlatform!==AppPlatform.Android&&(this.appPlatform=AppPlatform.Chrome,this.requireCustomPaypal=!0)}else if(-1!==a.indexOf("Android")){this.browser="Native Android",null!==new RegExp("Linux; Android ([0-9]{1,}).([0-9]{1,}).").exec(a)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))}else if(-1!==a.indexOf("Firefox")){this.browser="Firefox",this.isFirefox=!0,null!==new RegExp("Firefox/([0-9]{1,}).").exec(a)&&(this.majorVersion=parseFloat(RegExp.$1))}else if(-1!==a.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName){this.browser="Safari",this.safari=!0,null!==(this.mobile?new RegExp("OS ([0-9]{1,})_([0-9]{1,})"):new RegExp("Version/([0-9]{1,}).([0-9]{1,}).")).exec(a)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))}else-1!==a.indexOf("Opera")&&(this.browser="Opera");if(this.appState&&"electron"===this.appState.appType&&(this.appPlatform=AppPlatform.Electron,n+=" electron",this.mac&&(n+=" electronMac"),this.appStoreLink=this.appStoreLinks[AppPlatform.Electron],this.requireCustomPurchase=!0,this._enableFeature(s.a.Feature.OAuth)),this.appReviewLink=this.appReviewLinks[this.appPlatform],this.isTouchDevice=!!("ontouchstart"in window||window.navigator.msMaxTouchPoints),this.isMobileBrowser=this.checkMobileBrowser(),this.usePointerEvents=!!window.navigator.msPointerEnabled,this.useCustomScroller=!!this.iosui,this.isTouchDevice&&this.isMobileBrowser&&(this.usePointerEvents?(this.touchStartEvent="MSPointerDown",this.touchMoveEvent="MSPointerMove",this.touchEndEvent="MSPointerUp",this.touchCancelEvent="MSPointerCancel"):(this.touchStartEvent="touchstart",this.touchMoveEvent="touchmove",this.touchEndEvent="touchend",this.touchCancelEvent="touchcancel")),this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup"),r.a.hasURLParam("touch","false")?(this.touch=!1,this.phone=!1,this.mobile=!1,this.ios=!1,this.android=!1):(this.isTouchDevice&&this.isMobileBrowser||r.a.hasURLParam("touch","true"))&&(this.touch=!0,this.phone=!0,this.mobile=!0),this.windows&&(n+=" windows",this.ie&&(n+=" ie",this.demo||(this.mobro=this.isMobro()))),"Firefox"===this.browser&&(n+=" firefox",i.default.runOnLoad(function(){setTimeout(function(){try{document.queryCommandEnabled("enableObjectResizing")&&document.execCommand("enableObjectResizing",!1,"false")}catch(e){i.default.reportError(e)}},500)})),this.safari&&(n+=" safari"),this.phone&&(n+=" phone"),this.ipad&&(n+=" ipad"),this.embed===EmbedApps.Mailbird&&(n+=" mailbird",this.isMailbirdSidebar()&&(n+=" mailbirdSidebar")),this.demo&&(n+=" demoMode"),this.mobileie=this.ie&&this.mobile,this.isChrome&&this.app&&(this.isPackagedApp=!0),this.cmdChar=this.mac?"⌘":"ctrl",this.priModKey=this.mac?"⌘":"Ctrl",this.secModKeyForce=this.mac?"Ctrl":"Alt",this.secModKey=this.app?this.priModKey:this.secModKeyForce,this.noErrorStacks="iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName,this.standalone=!!window.navigator.standalone||window.navigator.userAgent.indexOf("FluidApp")>=0,(this.standalone||this.app||this.mobro)&&(this.requireCustomRedirect=!0),n&&n.length>0&&(this.bodyClass=n,this.b.className+=n),this.URL=window.URL||window.webkitURL,this.supportBlobURLIFrame=!(this.ie||this.ieEdge||this.ios10||this.ios11),this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin","transform-origin"),this.userSelect=this.addPrefix("userSelect","user-select"),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||function(e){clearTimeout(e)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",function(e){e.preventDefault()},!1),document.documentElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0),void 0!==document.hidden?(e="hidden",t="visibilitychange"):["moz","ms","webkit"].forEach(function(a){if("undefined"!==document[a+"Hidden"])return e=a+"Hidden",t=a+"visibilitychange",!1}),void 0!==e&&(this.pageVisibilityHidden=e,this.pageVisibilityChange=t),this.initRedirectString(),this.supportsEstimatedStorage()){this.estimateAvailableStorage(function(e){this.initStorageQuota=e,e.usage/e.quota>.9&&(this.isNearStorageQuota=!0)}.bind(this),function(){})}},updateBodyClass:function(){this.bodyClass&&(document.body.className+=this.bodyClass)},supportsNotifications:function(){return this.supportsNativeNotifications()||this.supportsHTML5Notifications()},supportsNativeNotifications:function(){var e=!1;return this._allowNativeNotifications&&(this.app&&this.appPlatform!==AppPlatform.Electron?(this.ios||this.android||this.isChrome)&&(e=!0):this.embed===EmbedApps.Mailbird&&(e=!0)),e},supportsHTML5Notifications:function(){return"Notification"in window},usesHTML5Notifications:function(){return!this.supportsNativeNotifications()&&this.supportsHTML5Notifications()},hasNotificationPermission:function(){return!this.usesHTML5Notifications()||"granted"===Notification.permission},disallowNativeNotifications:function(){this._allowNativeNotifications=!1},supportsPersistedStorage:function(){var e=!1;return"storage"in navigator&&"persist"in navigator.storage&&(e=!0),e},requestStoragePersistence:function(e,t){navigator.storage.persisted().then(function(a){a?e():navigator.storage.persist().then(e,t)})},isStoragePersisted:function(e){this.supportsPersistedStorage()?navigator.storage.persisted().then(e):setTimeout(e,0,!1)},supportsNativePromises:function(){return!!window.Promise},supportsEstimatedStorage:function(){var e=!1;return"storage"in navigator&&"estimate"in navigator.storage?e=!0:"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage&&(e=!0),e&&this.supportsNativePromises()},estimateAvailableStorage:function(e,t){this.supportsEstimatedStorage()?this._estimateAvailableStorage().then(e,t):setTimeout(t,0)},_estimateAvailableStorage:function(){return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate():"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage?new Promise(function(e,t){navigator.webkitTemporaryStorage.queryUsageAndQuota(function(t,a){e({usage:t,quota:a})},t)}):Promise.resolve({usage:NaN,quota:NaN})},supportsWebworkers:function(){var e=!1;return window.Worker&&(e=!0),e},supportsNativeDownload:function(){return this.isNativeApp()&&this.appv>=2},supportsIDBWebworkers:function(){var e=!1;if(this.supportsWebworkers())switch(this.browser){case"Firefox":e=this.majorVersion>=37;break;case"Chrome":e=this.majorVersion>=24}return e},supportsPassiveListeners:function(){if(void 0===this._supportsPassiveListeners){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(e){}this._supportsPassiveListeners=e}return this._supportsPassiveListeners},addPassiveListener:function(e,t,a){this.supportsPassiveListeners()?e.addEventListener(t,a,{passive:!0}):e.addEventListener(t,a)},isMobro:function(){var e,t=null;try{new ActiveXObject("")}catch(t){e=t.name}try{t=!!new ActiveXObject("htmlfile")}catch(e){t=!1}return!(t="ReferenceError"===e||!1!==t)},normalizeKeys:function(e){void 0!==e.normCode&&(e.synthetic||e instanceof KeyboardEvent)||(e.normCode=this.getKeyCode(e))},getKeyCode:function(e){var t;return 46===(t=null===e.keyCode||0===e.keyCode?null!==e.charCode?e.charCode:e.which:e.keyCode)&&"keypress"===e.type&&(t=190),t},initAppState:function(){var e=location.hash.substring(1);if(e)for(var t,a=/([^&=]+)=([^&]*)/g;null!==(t=a.exec(e));)if("state"===decodeURIComponent(t[1])){var n=decodeURIComponent(t[2]);if(n){try{e=JSON.parse(n)}catch(t){log("Error parsing AppState: ",n),i.default.reportError(t),e=void 0}e&&(this.app=!0===e.app,this.appv=e.appv,this.debugApp=e.debug,this.live=e.live,this.offline=e.offline,this.syncContacts=e.syncContacts,this.test=e.test,this.embed=e.embed,this.appState=e)}break}if(!this.app&&-1!==navigator.userAgent.indexOf("Electron/")&&null!==new RegExp("Moo\\.do/([^\\s]+)\\s").exec(navigator.userAgent)){var s;switch(RegExp.$1){case"1.0.4":case"1.0.5":s=1;break;case"1.0.6":s=2}s&&(this.app=!0,this.appv=s,this.appState={appType:"electron"})}this.live=this.live||r.a.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||this.test||r.a.hasURLParam("offline","true")||!1,this.demo=r.a.hasURLParam("demo","true")||!1,this.script=r.a.hasURLParam("script"),this.app=this.app||!1},getAppState:function(e){return this.appState?this.appState[e]:void 0},_enableFeature:function(e){this._features[e]=!0},_disableFeature:function(e){this._features[e]=!1},initFeatures:function(){this._enableFeature(s.a.Feature.ClonePane),this.isMailbirdSidebar()&&this._disableFeature(s.a.Feature.ClonePane)},isMailbirdSidebar:function(){return this.embed===EmbedApps.Mailbird&&"true"===this.getAppState("sidebar")},checkMobileBrowser:function(){var e,t=!1;if(this.android&&this.app)t=!0;else if(!this.embed&&(e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),!t)){window.matchMedia&&window.matchMedia("(max-device-width: 620px)").matches&&(t=!0)}return t},initHostState:function(){try{this.isHosted=window.self!==window.top}catch(e){this.isHosted=!0}this.isHosted&&(this.hostedBy=document.referrer)},initRedirectString:function(){var e,t;e=this.isDevURL||this.app&&this.debugApp||!this.app&&this.standalone?window.location.host:"www.moo.do",t=!this.app||this.appPlatform!==AppPlatform.Chrome&&this.appPlatform!==AppPlatform.Electron?"app/":"oauthRelay.html",this.customRedirectString=window.location.protocol+"//"+e+"/"+t},addPrefix:function(e,t){var a="",i=["ms","webkit","moz","o"],r=this.b.style;if(t||(t=e),"string"==typeof r[e])a="";else for(var n=0;n<i.length;n++)if("string"==typeof r["-"+i[n]+"-"+t]){a=i[n];break}var s=a.length>0?e.charAt(0).toUpperCase()+e.slice(1):e;return a?{prop:"-"+a+"-"+t,style:a+s,react:(a.length>0?a.charAt(0).toUpperCase()+a.slice(1):e)+s}:{prop:e,style:s,react:s}},blockClient:function(){switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(this.majorVersion<4)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":if(this.majorVersion<10)return{platform:"Internet Explorer",browser:this.browser,update:!0};break;case"Safari":if(this.mobile&&this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0};if(!this.mobile&&(6===this.majorVersion&&this.minorVersion<1||this.majorVersion<6))return{platform:"Safari",browser:this.browser,update:!0}}if(this.app){if(this.appv<this.versionRequired[this.appPlatform]){log("App Version out of date.");var e={version:this.versionRequired[this.appPlatform]};return this.ios?(e.update=!0,e.platform="iOS App"):this.android?(e.update=!0,e.platform="Android App"):i.default.nativeBridge.sendToApp("updateRequired"),e}if(this.appv>this.versionAvailable[this.appPlatform])return log("App is newer than the javascript, forcing an app cache update: "+this.appv+" vs. "+this.versionAvailable[this.appPlatform]),{cacheUpdate:!0}}},actionVerb:function(){return this.touch?"tap":"click"},actionVerbCaps:function(){return this.touch?"Tap":"Click"},updateOrientation:function(){return this.orientation=90===Math.abs(window.orientation)?Orientation.Landscape:Orientation.Portrait,this.app||this.kbsize.set(this.orientation===Orientation.Portrait?this.kbsizePortrait:this.kbsizeLandscape),this.orientation},isPageVisible:function(){return!this.pageVisibilityHidden||!document[this.pageVisibilityHidden]},getUpdateMessages:function(e){for(var t=[],a=this.mobile?"versionMobile":"versionDesktop",i=(e||0)+1;i<=this[a];i++){var r=this[a+"Messages"][i];r&&t.push(r)}return t},isFeatureEnabled:function(e){return this._features[e]},emailPreviewSize:function(){return Math.max(Math.min(s.a.EmailPreviewSizeMax,this.windowWidth()-s.a.ExpandedPaneWidth),s.a.EmailPreviewSizeMin)},recordAppSubVersion:function(e){this.appSubVersion=e},getPlatformName:function(){return this.mac?"Mac":this.windows?"Windows":this.iphone?"iPhone":this.ipad?"iPad":this.android?"Android":"Chrome"},getPlatformIcon:function(){return this.mac||this.iphone||this.ipad?"icon-apple":this.windows?"icon-windows":this.android?"icon-android":"icon-chrome"},getActualWindowWidth:function(){return document.body&&document.body.clientWidth||this.android&&window.screen&&window.screen.width||0},getActualWindowHeight:function(){return document.body&&document.body.clientHeight||this.android&&window.screen&&window.screen.height||0},displayRepeatedOptionalUpdateMessage:function(){if(this.appPlatform===AppPlatform.Chrome){var e,t=this.appv<this.versionAvailable[AppPlatform.Chrome],a="DOWNLOAD";"ChromeOS"===this.OSName?t&&(e="The Moo.do app is out of date. Please update it in the Chrome Web Store.",a="UPDATE"):this.supportsNativeApp()&&(i.default.vmMain.shouldShowHelp("getNativeApp")?(i.default.vmMain.closeHelp("getNativeApp"),e="You might like to use the new Moo.do native application. Download it now!."):t&&(e="The Moo.do app is out of date. You might like to use the new Moo.do native application, or please update in the Chrome Web Store.")),e&&i.default.toasts.pushMessage({text:e,action:MessageAction.OpenURL,actionText:a,data:{url:this.getAppDownloadURL()}})}}},t.a=new l},function(e,t,a){"use strict";window.URLPart={Search:1,Hash:2};var i,r={demo:URLPart.Hash,login:URLPart.Hash,user:URLPart.Hash,premium:URLPart.Hash,ispremium:URLPart.Hash,access_token:URLPart.Hash,error:URLPart.Hash,expires_in:URLPart.Hash,expires_at:URLPart.Hash,issued_at:URLPart.Hash,scope:URLPart.Hash,token_type:URLPart.Hash,id_token:URLPart.Hash,data:URLPart.Hash,script:URLPart.Hash,dmode:URLPart.Hash,jasmine:URLPart.Hash,touch:URLPart.Hash,noverify:URLPart.Hash,file:URLPart.Hash,sinfo:URLPart.Hash,panes:URLPart.Hash,offline:URLPart.Hash,live:URLPart.Hash,test:URLPart.Hash,nolocal:URLPart.Hash,nosync:URLPart.Hash,rdebug:URLPart.Hash,rsession:URLPart.Hash,versionError:URLPart.Hash,invite:URLPart.Hash,state:URLPart.Search,swupdate:URLPart.Hash},n={getItem:function(){},setItem:function(){},removeItem:function(){},clear:function(){}};try{i=window.localStorage||n}catch(e){i=n}function s(){}function o(e,t){e===URLPart.Search?window.location.search=t:e===URLPart.Hash&&(window.location.hash=t)}function l(e){return e===URLPart.Search?window.location.search:e===URLPart.Hash?self.overrideHash||window.location.hash:void 0}function d(e){return r[e]}function c(){}s.prototype={hasURLParam:function(e,t){var a=e+"=";t&&(a+=t);var i=d(e);return i||log("Invalid URL Part"),l(i).indexOf(a)>=0},getURLParam:function(e,t){var a=t||d(e);if(a===URLPart.Search){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=(s=new RegExp("[\\?&]"+e+"=([^&#]*)")).exec(window.location.href);return null===i?void 0:decodeURIComponent(i[1].replace(/\+/g," "))}if(a!==URLPart.Hash)log("Invalid URL part");else for(var r,n=l(URLPart.Hash).substring(1),s=/([^&=]+)=([^&]*)/g;r=s.exec(n);)if(decodeURIComponent(r[1])===e)return decodeURIComponent(r[2])},insertURLParam:function(e,t,a){e=encodeURIComponent(e),t=encodeURIComponent(t);for(var i=d(e),r=l(i).substr(1).split("&"),n=r.length-1;n>=0;n--){var s=r[n].split("=");if(s[0]==e){s[1]=t,r[n]=s.join("=");break}}n<0&&(r[r.length]=[e,t].join("=")),o(i,r.join("&")),i!==URLPart.Hash||a||window.location.reload()},removeURLParam:function(e,t){for(var a=d(e=encodeURIComponent(e)),i=l(a).substr(1).split("&"),r=i.length-1;r>=0;r--){if(i[r].split("=")[0]==e){i.splice(r,1),o(a,i.join("&")),a!==URLPart.Hash||t||window.location.reload();break}}},forceBind:function(e,t){var a=t[e].bind(t);return t[e]=a,a},destroy:function(e){0},extend:function(e,t){if(t)for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e},inherit:function(e,t){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e.prototype},defineBase:function(e){e.prototype.constructor=e},genPromise:function(e){e.then=function(e,t,a){},e.execute=function(e,t,a){}},storage:{getItem:(i.getItem||function(e,t){return this.get(e,t||c)}).bind(i),setItem:(i.setItem||function(e,t){var i={};i[e]=t;try{this.set(i)}catch(e){!0,log("LocalStorageError: ",e),a(0).reportError(e)}}).bind(i),removeItem:(i.removeItem||function(e,t){this.remove(e,t)}).bind(i),clear:(i.clear||function(e){this.clear(e)}).bind(i)}};var u=new s;t.a=u},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(34),l=a.n(o),d=a(3),c=a(53),u=d.a.createClass({displayName:"FancyButton",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({isLoading:!1})},getElement:function(){return l.a.findDOMNode(this)},onClick:function(e){this.isLoading.get()||!1===this.props.enabled||(this.props.onClick||this.props.onMouseDown)(e,this.onButtonClickCallback)&&this.isLoading.set(!0)},onMouseDown:function(e){if(!1!==this.props.enabled&&e.button===ButtonCode.Left&&this.props.onHold){var t={target:e.target,preventDefault:e.preventDefault};this._holdTimeout=setTimeout(this.onHold,150,t)}},onMouseUp:function(){this._clearHoldTimeout()},onHold:function(e){this._clearHoldTimeout(),this.props.onHold(e)},_clearHoldTimeout:function(){this._holdTimeout&&(clearTimeout(this._holdTimeout),this._holdTimeout=0)},onKeyDown:function(e){e.keyCode===KeyCode.Enter&&this.onClick(e)},focus:function(){this.getElement().focus()},onButtonClickCallback:function(){this.isLoading.set(!1)},removeRipple:function(){this.ripples.removeAt(0)},render:function(){var e,t=this.state,a=this.props,r=!1===a.enabled;a.color?e=a.color:a.primary?e=a.raised?"c-button-raised-primary":"c-button-primary":a.heavy?a.raised||(e="c-button-heavy"):e=a.cancel?a.raised?"c-button-raised-cancel":"c-button-cancel":a.raised?"c-button-raised":"c-button";var n={display:a.display,lineHeight:a.height?"auto"===a.height?null:a.height+"px":"36px",height:a.height,width:a.width,textAlign:"center",margin:a.margin,paddingLeft:a.paddingLeft,paddingTop:a.paddingTop,paddingRight:a.paddingRight,paddingBottom:a.paddingBottom,fontWeight:a.fontWeight,fontSize:a.fontSize,color:a.color};void 0===a.margin&&(n.marginLeft=a.marginLeft,n.marginTop=a.marginTop,n.marginRight=a.marginRight,n.marginBottom=a.marginBottom),n=i.default.extend(n,this.props.style),a.raised&&!a.children&&a.icon&&!1!==a.round&&(n.borderRadius="50%");var o,l={fontSize:a.fontSize};if(a.icon){var d={height:a.height,fontSize:a.iconSize},u=i.default.classNames("fancyButtonIcon",a.icon,{"c-button":!!a.color});a.children?0!==a.padding&&(l.paddingLeft="6px",l.paddingRight=0,n.paddingLeft="16px",n.paddingRight="16px"):(n.width=a.width||36,n.height=a.height||36,n.textAlign="center"),o=s.a.createElement("i",{className:u,style:d})}isNaN(a.padding)||(l.padding="0 "+a.padding+"px");var h=a.children&&s.a.Children.count(a.children)>0,f=i.default.classNames("fancyButtonText"),p=h&&s.a.createElement("div",{className:f,style:l},a.children),m=i.default.classNames("fancyButton",e,{raised:a.raised},{loading:t.isLoading},{primary:a.primary},{cancel:a.cancel},{hasText:h},{hasIcon:!!a.icon},{disabled:r},{selected:a.selected},a.className),g=t.isLoading&&s.a.createElement("div",{className:"fancyButtonLoading"},s.a.createElement("i",{className:"icon-spinner"}));return s.a.createElement(c.a,{className:m,style:n,enabled:a.enabled,onMouseEnter:a.onMouseEnter,onMouseLeave:a.onMouseLeave,onMouseDown:a.onMouseDown&&this.onClick||a.onHold&&this.onMouseDown||void 0,onMouseUp:a.onHold?this.onMouseUp:void 0,onClick:a.onClick?this.onClick:void 0,onDoubleClick:a.onDoubleClick,onRightClick:a.onRightClick,onKeyDown:this.onKeyDown,id:a.id,center:a.center||!!a.icon&&!h,ripple:a.ripple,tabIndex:a.tabIndex,"data-tooltip":!r&&a.tooltip?a.tooltip:null,"data-tooltiphotkey":r?null:a.tooltipHotkey},o,p,g)}});t.a=u},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(1),s=a(17),o=a(70),l=a.n(o),d=a(103),c=a(4),u={pendingRemoteUpdates:{},itemCache:{},dbDataCache:{},loadedItemCount:0,hasLocalData:!1,freezeUpdates:!1,hasMadeInMemoryOnlyUpdate:!1,dbClosed:!1,overQuota:!1,dbi:void 0,contactManager:new(a(105).a)};function h(e,t){var a=i.default.fieldMapValidators[e];return a&&a(t)||void 0===t||null===t}u.forEachModel=function(e){try{i.default.PAssert(5,e,"Must pass a valid function to iterate on")}catch(e){i.default.reportError(e)}for(var t in u.itemCache)u.itemCache[t]&&e(u.itemCache[t])},u.getModel=function(e){try{i.default.PAssert(6,i.default.isString(e),"ID must be a valid string: "+i.default.getObjectInfo(e))}catch(e){i.default.reportError(e)}try{i.default.PAssert(7,e,"Tried to get a model with an invalid id")}catch(e){i.default.reportError(e)}return u.itemCache[e]},u.setModel=function(e){try{i.default.PAssert(8,e,"Tried to set an invalid model")}catch(e){i.default.reportError(e)}try{i.default.PAssert(9,e.id,"Tried to set a model with an invalid id")}catch(e){i.default.reportError(e)}try{i.default.PAssert(10,i.default.isString(e.id),"ID must be a valid string: "+i.default.getObjectInfo(e.id))}catch(e){i.default.reportError(e)}try{i.default.PAssert(11,void 0===u.itemCache[e.id],"Must not be replacing a model with another copy")}catch(e){i.default.reportError(e)}u.itemCache[e.id]=e},u.clearModel=function(e){try{i.default.PAssert(12,i.default.isString(e),"ID must be a valid string: ",i.default.getObjectInfo(e))}catch(e){i.default.reportError(e)}try{i.default.PAssert(13,void 0!==u.itemCache[e],"Must not clear a model that does not exist")}catch(e){i.default.reportError(e)}u.itemCache[e]=void 0},u.getItem=function(e){try{i.default.PAssert(14,i.default.isString(e),"ID must be a valid string:"+i.default.getObjectInfo(e))}catch(e){i.default.reportError(e)}try{i.default.PAssert(15,e,"Tried to get an item that doesn't exist")}catch(e){i.default.reportError(e)}return u.dbDataCache[e]},u.setItem=function(e,t){try{i.default.PAssert(16,i.default.isString(e),"ID must be a valid string: "+i.default.getObjectInfo(e))}catch(e){i.default.reportError(e)}try{i.default.PAssert(17,e,"Tried to set an item with an invalid id")}catch(e){i.default.reportError(e)}try{i.default.PAssert(18,void 0===u.dbDataCache[e]||void 0===t,"Must not be replacing an item with another copy")}catch(e){i.default.reportError(e)}u.dbDataCache[e]=t},u.validateItemData=function(e){try{for(var t in e){var a=h(t,e[t])||!1;try{i.default.PAssert(19,a,"Invalid data set in item: ",t,"=",e[t],typeof e[t])}catch(e){i.default.reportError(e)}a||u.fixItemData(e,t)}}catch(e){u.reportError(e)}},u.fixItemData=function(e,t){var a=!1,r=i.default.fieldMapFixer[t];if(r){var n=r(e[t]);log("Value Fixed: ",e[t],"->",n),e[t]=n;try{i.default.PAssert(20,h(t,n),"Fixed field must always be valid")}catch(e){i.default.reportError(e)}a=!0}return a},u.clearItems=function(){u.dbDataCache={},u.itemCache={}},u.clearPlugins=function(){i.default.vmMain.pluginManager.onClearData()},u.getRootItem=function(){return u.rootId?u.getItem(u.rootId):void 0},u.getRootModel=function(){return u.rootId?u.getModel(u.rootId):void 0},u.createVMLI=function(e,t){return i.default.vmMain.itemStoreManager.getDefaultItemStore().createItemRaw(e,t)},u.createTempVMLI=function(e,t){return t.noSave=!0,t.canDestroy=!0,i.default.vmMain.itemStoreManager.getTempItemStore().createItemRaw(e,t)},u.destroyTempVMLI=function(e){i.default.vmMain.itemStoreManager.getTempItemStore().destroyItem(e)},u.initializeIndexedDB=function(e){var t=3;function a(a){a&&l.a?l.a.open({server:"duchess",version:t,schema:{items:{key:{keyPath:"id"}},settings:{},caches:{key:{keyPath:"cid"}}}}).done(function(t){u.dbi=t;try{t.handleDisconnect(function(e){log("DB Disconnect Event: ",e)})}catch(e){i.default.reportError(e)}for(var a=0;a<f.length;++a)f[a](!0);f=[],e()}).fail(function(t){try{log("Error loading local DB client - "+t.target.error.name+": "+t.target.error.message)}catch(e){log("Error loading local DB client - Invalid Error Message")}i.default.preventLocalWrites(n.a.LocalWriteReason.Generic),"Firefox"===c.a.browser?t.target&&t.target.error&&"InvalidStateError"===t.target.error.name||i.default.reportError(new Error("DB Load Failure"),t):"Safari"===c.a.browser&&t.target&&t.target.error&&"DBOpenError"===t.target.error.name||i.default.reportError(new Error("DB Load Failure"),t),"VersionError"===t.target.error.name&&(r.a.hasURLParam("versionError")||i.default.AppCache.runOnFinish(function(){r.a.insertURLParam("versionError",!0)},!0)),e()}):(i.default.preventLocalWrites(n.a.LocalWriteReason.Generic),e())}window.indexedDB&&void 0!==window.indexedDB.onIsReady&&null!==window.indexedDB.onIsReady?window.indexedDB.onIsReady(a):setTimeout(function(){a(!0)},0)},u.getDBState=function(e){e.dbClosedUnexpected=u.dbClosed,e.hasLocalData=u.hasLocalData,e.hasMadeInMemoryOnlyUpdate=u.hasMadeInMemoryOnlyUpdate};var f=[];u.onCachesAvailable=function(e){u.dbi?e(!0):i.default.shouldWriteLocal()?f.push(e):e(!1)},u.openCacheDatabase=function(e,t,a,i){var r=function(){l.a?l.a.open({server:e,version:t,schema:a}).done(function(e){i(e)}).fail(function(e){i(void 0)}):i(void 0)};window.indexedDB&&void 0!==window.indexedDB.onIsReady&&null!==window.indexedDB.onIsReady?r():setTimeout(r,0)};var p={};u.openCacheTable=function(e){if(u.dbi)return p[e]=void 0===p[e]?1:p[e]+1,u.dbi.caches},u.closeCacheTable=function(e){try{i.default.PAssert(21,p[e]>0,"Must have previously opened the cache to close it")}catch(e){i.default.reportError(e)}p[e]--};var m,g=!1;function v(){}function y(e,t){if(t&&t.target){var a=t.target.error;if(a){log("Transaction Error Info: ",a.type,a.name,a.code,a.message);var r="QuotaExceededError"===a.name||4===a.code;"InvalidStateError"===a.name||r?u.notifyDBUnexpectedClose(r):i.default.reportError(new Error("IDB Transaction Error"),a)}else i.default.reportError(new Error("Unexpected transaction error A"),t)}else i.default.reportError(new Error("Unexpected transaction error B"),t)}u.localDataLoaded=function(){return g},u.loadFromIndexedDB=function(e){try{i.default.PAssert(23,!g,"Should never load local data twice")}catch(e){i.default.reportError(e)}if(ShouldLog(LogLevels.Timing)&&log("Loading DB: ",log.now()),u.dbDataCache={},i.default.shouldWriteLocal())if(u.dbi&&u.dbi.items){var t,a,r=!1,s=!1,o=window.__preload,l=function(t){try{i.default.PAssert(24,!s,"Should only process load results once")}catch(e){i.default.reportError(e)}s=!0,ShouldLog(LogLevels.Timing)&&log("Loaded DB: ",log.now()),u.loadedItemCount=0;for(var a=0;a<t.length;++a){var n=r?t[a]:i.default.translateObjOut(t[a]);t[a]&&t[a].id&&n&&(u.setItem(t[a].id,n),u.loadedItemCount++)}if(u.dbi.settings){var l=function(t){if(!i.default.criticalErrorReported()){if(g=!0,t){try{i.default.PAssert(25,u.getItem(t.root),"If there is a root item defined there should be a corresponding local item")}catch(e){i.default.reportError(e)}u.rootId=t.root}e&&e()}};o.settingsPreload&&o.settingsPreload.root?l(o.settingsPreload.root):u.dbi.settings.get("root").done(l).fail(e)}else log("Unable to load local settings DB"),e&&e()};o?o.mainLoaded=!0:o=window.__preload={mainLoaded:!0};var d=function(e){a=Date.now(),t&&log("Time preload blocked: ",a-t),clearTimeout(o.mainTimeout),o.mainTimeout=void 0,o.dataResults=void 0,o.worker&&(o.worker.terminate(),o.worker=void 0),e?l(e):(r=!1,o.onDataLoaded=void 0,u.dbi.items.query().all().fastExecute().done(l))};o.runDataLoad?(r=!0,o.dataResults?(console.log("Preload data available"),d(o.dataResults)):(console.log("Blocked on preload"),t=Date.now(),o.onDataLoaded=d,o.mainTimeout=setTimeout(function(){i.default.reportError(new Error("Preload timeout"));try{i.default.PAssert(26,!o.dataResults,"Should not have results defined")}catch(e){i.default.reportError(e)}r=!1,o.onDataLoaded=void 0,o.worker&&(o.worker.terminate(),o.worker=void 0),u.dbi.items.query().all().fastExecute().done(l)},15e3))):(console.log("Preload skipped"),u.dbi.items.query().all().fastExecute().done(l))}else log("Unable to load local items DB - db not connected"),g=!0,i.default.preventLocalWrites(n.a.LocalWriteReason.Generic),e&&e();else log("Unable to load local items DB - already disabled"),g=!0,e&&e()},u.beginTransaction=function(){i.default.shouldWriteLocal()&&(m={})},u.transactionUpdate=function(e,t){try{i.default.PAssert(27,i.default.shouldWriteLocal(),"Should never be writing during a transaction if local writes are disabled")}catch(e){i.default.reportError(e)}if(m[e])for(var a in t)m[e][a]=t[a];else m[e]=t},u.notifyDBUnexpectedClose=function(e){var t;e?(i.default.toasts.pushMessage(MessageID.QuotaError),u.overQuota=!0,t=n.a.LocalWriteReason.QuotaError):(i.default.toasts.pushMessage(MessageID.LocalWritesDisabled),t=n.a.LocalWriteReason.Generic),i.default.preventLocalWrites(t),u.dbClosed=!0;try{i.default.PAssert(28,i.default.vmMain&&i.default.vmMain.pluginManager,"Should always have a plugin manager when reporting DB quota error")}catch(e){i.default.reportError(e)}i.default.vmMain&&i.default.vmMain.pluginManager&&e&&i.default.vmMain.pluginManager.onCacheLimitExceeded()},u.endTransaction=function(){if(i.default.shouldWriteLocal()&&u.dbi&&u.dbi.items){0;try{u.dbi.items.updateObject(m).done(v).fail(y)}catch(e){i.default.reportError(e),y()}}else void 0!==m&&i.default.reportError(new Error("Started a transaction and stopped writes halfway through"));m=void 0},u.hasPendingDBTransaction=function(){return!!m},u.dbUpdateItem=function(e){if(!u.freezeUpdates){u.hasLocalData||i.default.isLoadingRemote||e.skipLocalModification||(u.hasLocalData=!0);var t=e.changes||{},a=e.id?e.id:t.id,r=e.callback,n=e.saveFlags;try{i.default.PAssert(29,n===SaveFlag.None||n===SaveFlag.Prop||n===SaveFlag.Text||n===SaveFlag.All)}catch(e){i.default.reportError(e)}var s=u.getItem(a);if(i.default.shouldWriteLocal()){var o;try{i.default.PAssert(30,!n||void 0===t.modifiedOffline&&void 0===t.modifiedOfflineText,"Shouldn't be setting a modified flag while passing them in with changes")}catch(e){i.default.reportError(e)}if(i.default.isFlagSet(n,SaveFlag.Prop)){try{i.default.PAssert(31,void 0===t.modifiedOffline,"Shouldnt be passing in a value and assigning "+t.modifiedOffline)}catch(e){i.default.reportError(e)}0,t.modifiedOffline=!0,(l=u.getModel(a))&&(l.modifiedOffline=!0)}if(i.default.isFlagSet(n,SaveFlag.Text)){try{i.default.PAssert(32,void 0===t.modifiedOfflineText,"Shouldnt be passing in a value and assigning "+t.modifiedOfflineText)}catch(e){i.default.reportError(e)}var l;0,t.modifiedOfflineText=!0,(l=u.getModel(a))&&(l.modifiedOfflineText=!0)}if(s){for(var d in t){if(t.hasOwnProperty(d))s[d]=t[d]}u.validateItemData(s),o=i.default.translateObjIn(s)}else{try{i.default.PAssert(33,t.id,"Item being modified does not already exist as expected",t)}catch(e){i.default.reportError(e)}u.setItem(a,t),o=i.default.translateObjIn(t)}if(m){try{i.default.PAssert(35,!r,"Callbacks not supported for updates inside of a transaction")}catch(e){i.default.reportError(e)}u.transactionUpdate(a,o)}else try{r?u.dbi.items.update(o).done(r).fail(r):u.dbi.items.update(o)}catch(e){"InvalidStateError"===e.name?u.notifyDBUnexpectedClose(!1):i.default.reportError(e)}}else{if(s)for(var d in t)t.hasOwnProperty(d)&&(s[d]=t[d]);else u.setItem(a,t);u.hasMadeInMemoryOnlyUpdate=!0,r&&r()}}},u.dbDeleteItem=function(e,t){if(!u.freezeUpdates&&(u.setItem(e,void 0),i.default.shouldWriteLocal()))try{t?u.dbi.items.remove(e).done(t).fail(t):u.dbi.items.remove(e)}catch(e){i.default.reportError(e)}},u.setRoot=function(e){if(!u.freezeUpdates){if(i.default.shouldWriteLocal())try{u.dbi.settings.update({key:"root",item:{root:e}})}catch(e){i.default.reportError(e)}return u.rootId=e,u.getRootItem()}},u.setPluginData=function(e){var t=Object.keys(e);d.a.clearGapiData();for(var a=0;a<t.length;++a){var r=t[a],n=i.default.vmMain.pluginManager.getPlugin(r),s=e[r].data;s&&(d.a.setGapiData(r,s),n&&n.forceLoad())}};var S=0,E={};u.demoDataId=void 0,u.loadDemoData=function(e,t,a){if(u.demoDataId=e,d.a.areRemoteFunctionsHooked()||d.a.hookRemoteFunctions(),t||void 0===e||""===e||void 0===E[e]){function r(r){var n,s;r&&(n=r[0],s=r[1]),s&&(t&&u.clearPlugins(),u.setPluginData(s)),n&&(t&&(i.default.vmMain.itemStoreManager.runForEachStore(function(e){e.clearStore()}),u.clearItems()),function e(t){t.id||(t.id="demo"+S++),u.setItem(t.id,t);var a=t.note;a&&(a.id||(a.id="demo"+S++),e(a),t.note=a.id);var i=t.items;if(i){for(var r=[],n=0;n<i.length;++n)i[n].id||(i[n].id="demo"+S++),r.push(i[n].id),e(i[n]);t.items=r}}(n),u.setRoot(n.id),E[e]={root:n,plugins:s},g=!0,a&&a(n.id))}if(e)d.a.loadRemoteData(e,r);else{try{i.default.PAssert(36,!1,"Test data must be defined using #data=XXX.YYY in URL")}catch(e){i.default.reportError(e)}r([{text:n.a.RootItemName,items:[]}])}}else{log("Use Preloaded demo data: ",e);var s=E[e];u.setRoot(s.root.id),s.plugins&&u.setPluginData(s.plugins),a&&a(s.root.id)}};var P=!1;function b(e){var t=u.getItem(e);if(t){var a=t.items;if(a)for(var i=0;i<a.length;++i)b(a[i]);u.dbDeleteItem(t.id)}}u.initData=function(e){if(P)return!1;P=!0,ShouldLog(LogLevels.Timing)&&log("Initializing User Item Data",log.now());try{i.default.isDemoMode()?setTimeout(function(){var t=r.a.getURLParam("data");u.loadDemoData(t,!1,e)},0):(i.default.checkpoint(Checkpoint.InitData),u.initializeIndexedDB(function(){u.loadFromIndexedDB(function(){i.default.checkpoint(Checkpoint.DBLoaded),u.checkLocalIntegrity(function(t){u.loadLocalContacts(),t&&t.error&&i.default.reportError(new Error("Error during local integrity check")),e()})})}))}catch(e){i.default.reportError(e)}return!0},u.initializeItem=function(e){try{i.default.PAssert(37,e.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}var t=e.id,a=!t||i.default.isLocalItem(e)||!e.data;if(a){var r=s.a.createNewItem(e,e.hasChildren(),e.hasArchivedChildren());0,t&&t!==r&&u.modifyItemId(t,r);for(var n=!1,o=e.numItems(),l=0;l<o;++l){var d=u.initializeItem(e.itemAtIndex(l));n=n||d}if(e.hasArchivedChildren()){var c=e.archivedItems(!0);for(l=0;l<c.length;++l){d=u.initializeItem(c[l]);n=n||d}}if(e.hasNote()){d=u.initializeItem(e.getNote());n=n||d}if(s.a.initializeNewItem(e),t&&t!==r){var h=e.parent();h&&h.save(null,SaveFlag.None)}}return a},u.checkLocalIntegrity=function(e){ShouldLog(LogLevels.Timing)&&log("Checking Local: ",log.now());var t=!1;u.ensureLocalCache(function(){ShouldLog(LogLevels.Timing)&&log("Verifying Local Data",log.now());var a=!1,r={};for(var n in u.dbDataCache)if(u.dbDataCache.hasOwnProperty(n)&&u.getItem(n)){((p=u.getItem(n)).i||p.t)&&(log("%cInvalid local properties on item: ","color: red",p),t=!0),r[p.id]?r[p.id].exist?(log(p.id,": Duplicated IDs in the local database",p),t=!0):(r[p.id].exist=!0,r[p.id].del=!!p.isDeleted):r[p.id]={exist:!0,ref:!1,del:!!p.isDeleted},p.id===u.rootId&&(a&&(log(p.id,": Multiple roots present locally",p),t=!0),a=!0,r[p.id].isRoot=!0),void 0===p.text&&(log("Found item with no text",p.id),p.text="",u.dbUpdateItem({id:n,changes:{text:""},saveFlags:SaveFlag.None})),p.note&&(r[p.note]?r[p.note].ref?(log(p.id,": Item note is used twice - ",p.note),t=!0):r[p.note].ref=p.id:r[p.note]={exist:!1,ref:p.id});for(var s=0;p.items&&s<p.items.length;++s){var o=-1;if(p.items[s]){var l=p.items[s],d=u.getItem(l);if(d){if(d.isArchived&&(o=s),o>=0&&!d.isArchived){log(l,": Unarchived child found after an archived one"),log("   ",p.id,": Parent with incorrectly ordered children"),t=!0;var c=p.items.removeAt(o);p.items.insert(s,c),o=s,u.dbUpdateItem({id:p.id,changes:{items:p.items},saveFlags:SaveFlag.None})}}else log(l,": Child does not have a valid reference on our local database"),t=!0;if(r[l])if(r[l].ref)log(l,": Item is referenced locally multiple times: ",d?u.getItem(l).id:"UNDEFINED"),log("   ",r[l].ref,": ",u.getItem(r[l].ref).id),log("   ",p.id,": <CLIENTDATA>"),t=!0,(m=p.items).removeAt(s),u.dbUpdateItem({id:n,changes:{items:m},saveFlags:SaveFlag.None});else r[l].ref=p.id;else r[l]={exist:!1,ref:p.id}}else log(p.id,": Invalid item in local items array"),t=!0}}for(var h in!a&&u.hasLocalData&&(log("No root present"),t=!0),r){var f=r[h];if(!f.exist){log(h,": Item is referenced locally as a child but does not exist in the database");var p=u.getItem(f.ref);try{i.default.PAssert(38,p,"Parent of item must exist")}catch(e){i.default.reportError(e)}if(p)(m=p.items)?m.remove(h):m=[],u.dbUpdateItem({id:p.id,changes:{items:m},saveFlags:SaveFlag.None})}if(f.ref||f.isRoot||f.del||(log(h,": Item exists locally but is not referenced by a parent"),b(h)),f.ref&&f.del){log(h,": Item is referenced locally by a parent but has been deleted");var m;p=u.getItem(f.ref);try{i.default.PAssert(39,p)}catch(e){i.default.reportError(e)}(m=p.items)?m.remove(h):m=[],u.dbUpdateItem({id:p.id,changes:{items:m},saveFlags:SaveFlag.None})}if(f.isRoot&&f.ref&&(log(h,": Local root has a parent"),t=!0),f.del&&!f.ref){p=u.getItem(h);i.default.isLocalItem(p)&&(log("Deleting Unreferenced Local Item: ",h),u.dbDeleteItem(h))}}ShouldLog(LogLevels.Timing)&&log("Done Verifying Local Data",log.now()),e({error:t,local:!1})})},u.removeDeletedItems=function(e){for(var t in u.dbDataCache){var a=u.getItem(t);a&&a.isDeleted&&(e[t]||u.dbDeleteItem(t))}},u.defaultSkipSettings={Default:[Settings.authScopes,Settings.activeUser,Settings.userId,Settings.displayName,Settings.shownTutorial,Settings.helpPaneState,Settings.oauthScheme,Settings.enableOfflineAuth,Settings.premiumStatus,Settings.trialStart,Settings.trialDuration,Settings.trialExtended,Settings.theme,Settings.helpState,Settings.localPaneState,Settings.selectedWorkspace,Settings.notificationDelay]},u.addDefaultSkipSetting=function(e,t){u.defaultSkipSettings[t]||(u.defaultSkipSettings[t]=[]),u.defaultSkipSettings[t].push(e)},u.clearDataAndReload=function(e){r.a.hasURLParam("sinfo")&&r.a.removeURLParam("sinfo"),u.clearData(function(){setTimeout(i.default.reload,0)},u.defaultSkipSettings,e)},u.clearData=function(e,t,a){u.freezeUpdates=!0,i.default.shouldWriteLocal()||i.default.isLocalWriteReason(n.a.LocalWriteReason.QuotaError)?setTimeout(function(){if(i.default.pageDataCleared(),u.dbi)if(u.dbi.settings)try{u.dbi.settings.clear().done(function(){n()}).fail(function(){log("Failed to reset settings!"+arguments),n()})}catch(e){i.default.reportError(e),n()}else n();else u.initializeIndexedDB(function(){u.clearData(e,t)});function r(){var r;a||(u.clearContacts(),r=i.default.isArray(t)?{Default:t}:t,i.default.settings.resetAll(r),i.default.vmMain&&i.default.vmMain.pluginManager&&i.default.vmMain.pluginManager.onPurgeData());i.default.vmMain&&i.default.vmMain.cacheManager&&(a?i.default.vmMain.cacheManager.clearPerDocCaches(!0):i.default.vmMain.cacheManager.clearLocalCaches(!0)),setTimeout(function(){e&&e()},0)}function n(){if(u.dbi.items)try{u.dbi.items.clear().done(function(){s()}).fail(function(){log("Failed to reset items!"+arguments),s()})}catch(e){i.default.reportError(e),s()}else s()}function s(){if(u.dbi.caches)try{u.dbi.caches.clear().done(function(){r()}).fail(function(){log("Failed to reset items!"+arguments),r()})}catch(e){i.default.reportError(e),r()}else r()}},0):e&&setTimeout(e,0)};var C=!1;function D(e,t,a,r){try{i.default.PAssert(54,e,"Must provide a valid item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(55,e.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}var n=i.default.isLocalChange(r)?SaveFlag.Prop:SaveFlag.None;e.save({items:e.getItemsArrayForSave()},n),t.save({isArchived:a},n)}function I(e,t,a){var i=e[t];return i?',"'+t+'":'+(a?a(i):i):""}u.clearLocalContacts=function(){if(C=!1,i.default.shouldWriteLocal())try{r.a.storage.setItem("ctcs","[]")}catch(e){i.default.reportError(e)}u.contactManager.clearContacts(),i.default.settings.set(Settings.lastContactSync,void 0)},u.loadLocalContacts=function(){if(!C&&(C=!0,i.default.shouldWriteLocal()))try{var e=r.a.storage.getItem("ctcs"),t=e?JSON.parse(e):void 0;u.contactManager.loadContacts(t,!1)}catch(e){i.default.reportError(e)}},u.areLocalContactsLoaded=function(){return C},u.saveContacts=function(){i.default.shouldWriteLocal()&&r.a.storage.setItem("ctcs",JSON.stringify(u.contactManager._contacts.get()))},u.clearContacts=function(){i.default.settings.reset(Settings.lastContactSync),i.default.shouldWriteLocal()&&r.a.storage.removeItem("ctcs",void 0)},u.insertItem=function(e,t,a){try{i.default.PAssert(40,i.default.isVMLI(e),"Must pass in a valid item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(41,i.default.isVMLI(t),"Must pass in a valid insert item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(42,e.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}try{i.default.PAssert(43,void 0===a||a>=0,"Must pass in a valid index")}catch(e){i.default.reportError(e)}e.save({items:e.getItemsArrayForSave()},SaveFlag.Prop),s.a.itemAdded({item:e,addedItem:t,index:a,isArchived:!1})},u.insertItems=function(e,t,a){try{i.default.PAssert(44,e,"Must pass in a valid item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(45,e.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}try{i.default.PAssert(46,void 0===a||a>=0,"Must pass in a valid index")}catch(e){i.default.reportError(e)}e.save({items:e.getItemsArrayForSave()},SaveFlag.Prop),1===t.length?s.a.itemAdded({item:e,addedItem:t[0],index:a,isArchived:!1}):s.a.itemsAdded({item:e,addedItems:t,index:a,isArchived:!1})},u.removeItem=function(e,t,a,r,n){try{i.default.PAssert(47,e,"Must pass in a valid item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(48,e.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}try{i.default.PAssert(49,void 0===t||t>=0,"Must pass in a valid index")}catch(e){i.default.reportError(e)}var o=i.default.isLocalChange(n)?SaveFlag.Prop:SaveFlag.None;e.save({items:e.getItemsArrayForSave()},o),i.default.isLocalChange(n)&&s.a.itemRemoved({item:e,index:t,numToRemove:1,isArchived:r})},u.moveItem=function(e,t){var a=e.item,r=e.newInfo,n=e.oldParent,o=e.oldInfo,l=e.noVersion,d=i.default.isLocalChange(t)?SaveFlag.Prop:SaveFlag.None;try{i.default.PAssert(50,void 0!==a&&void 0!==r&&void 0!==n&&void 0!==o,"moveItem is missing parameters")}catch(e){i.default.reportError(e)}try{i.default.PAssert(51,a.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}try{i.default.PAssert(52,n.shouldSave(),"Old parent must be marked as saveable")}catch(e){i.default.reportError(e)}try{i.default.PAssert(53,a.parent().shouldSave(),"New parent must be marked as saveable")}catch(e){i.default.reportError(e)}n.save({items:n.getItemsArrayForSave()},d),a.parent().save({items:a.parent().getItemsArrayForSave()},d),o.isArchived!==r.isArchived&&(a.isArchived(r.isArchived,t),a.save({isArchived:r.isArchived},d)),i.default.isLocalChange(t)&&(u.saveChanges(a,{},d),s.a.itemMoved({item:a,newInfo:r,oldParent:n,oldInfo:o,noVersion:l}))},u.archiveItem=function(e,t,a,r){try{i.default.PAssert(56,e,"Must provide a valid item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(57,e.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}try{i.default.PAssert(58,t>=0,"Must have a valid index to remove from")}catch(e){i.default.reportError(e)}D(e,a,!0,r),i.default.isLocalChange(r)&&s.a.itemArchived(e,a,t)},u.unarchiveItem=function(e,t,a,r){try{i.default.PAssert(59,e,"Must provide a valid item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(60,e.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}try{i.default.PAssert(61,t>=0,"Must have a valid index to remove from")}catch(e){i.default.reportError(e)}D(e,a,!1,r),i.default.isLocalChange(r)&&s.a.itemUnarchived(e,a,t,e.numItems()-1)},u.modifyItemId=function(e,t,a){var r=u.getItem(e),n=u.getModel(e);try{i.default.PAssert(62,n.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}if(i.default.vmMain.itemStoreManager.getDefaultItemStore().manualModifyItemID(e,t),r.id=t,n.id=t,u.pendingRemoteUpdates[e]&&(u.pendingRemoteUpdates[e]=void 0,u.pendingRemoteUpdates[t]=!0),r.version=-1,r.versionText=-1,"root"===e)for(var s=r.items.length-1;s>=0;s--){var o=u.getItem(r.items[s]);if(i.default.isLocalItem(o)&&!o.modifiedOffline&&!o.modifiedOfflineText){r.items.removeAt(s);try{i.default.PAssert(63,n.itemAtIndex(s).id===o.id,"Item arrays should match")}catch(e){i.default.reportError(e)}n.getItems().removeAt(s)}}try{i.default.PAssert(64,!u.itemCache[t],"Should not be overwriting an item in the d.itemCache")}catch(e){i.default.reportError(e)}try{i.default.PAssert(65,!u.dbDataCache[t],"Should not be overwriting an item in the d.dbDataCache")}catch(e){i.default.reportError(e)}u.itemCache[t]=u.itemCache[e],u.dbDataCache[t]=r,u.dbDeleteItem(e),u.dbUpdateItem({changes:r,callback:a,skipLocalModification:!0,saveFlags:SaveFlag.None}),u.dbDataCache[e]=void 0,delete u.dbDataCache[e],u.itemCache[e]=void 0,delete u.itemCache[e]},u.deleteItem=function(e,t){try{i.default.PAssert(66,e,"Must provide a valid item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(67,e.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}try{i.default.PAssert(68,!e.isDeleted(),"Should never try to delete an item that has already been deleted")}catch(e){i.default.reportError(e)}if(u.getItem(e.id))e.isDeleted(!0,t),u.dbUpdateItem({id:e.id,changes:{isDeleted:!0},saveFlags:SaveFlag.Prop});else try{i.default.PAssert(69,"Expected local item, didnt find one",e.id)}catch(e){i.default.reportError(e)}},u.undeleteItem=function(e,t){if(u.getItem(e.id))e.isDeleted(!1,t),u.dbUpdateItem({id:e.id,changes:{isDeleted:void 0},saveFlags:SaveFlag.Prop});else try{i.default.PAssert(70,"Expected local item, didnt find one",e.id)}catch(e){i.default.reportError(e)}},u.saveChanges=function(e,t,a){if(e){try{i.default.PAssert(72,e.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}t||(t={}),u.dbUpdateItem({id:e.id,changes:t,saveFlags:a})}else{log("Incoming item to save has no item!",e,t);try{i.default.PAssert(71,!1,"Incoming item to save has no item!")}catch(e){i.default.reportError(e)}}},u.addPendingUpdate=function(e){try{i.default.PAssert(73,e,"Invalid ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(74,i.default.isString(e),"Must provide a valid id string")}catch(e){i.default.reportError(e)}u.pendingRemoteUpdates[e]||(u.pendingRemoteUpdates[e]=!0)},u.clearPendingUpdate=function(e){delete u.pendingRemoteUpdates[e]},u.clearPendingUpdates=function(){for(var e in u.pendingRemoteUpdates){try{i.default.PAssert(75,u.pendingRemoteUpdates.hasOwnProperty(e))}catch(e){i.default.reportError(e)}0;var t=u.getModel(e),a=u.getItem(e);if(a&&a.isDeleted)u.dbDeleteItem(e);else if(t&&t.data){var r={id:e,modifiedOffline:!1};t.modifiedOffline=!1,s.a.hasDeferredAction(t.id)||(t.modifiedOfflineText=!1,r.modifiedOfflineText=!1);var n=s.a.getVersion(t.data,VersionType.Structure),o=s.a.getVersion(t.data,VersionType.Text);n!=t.getVersion(VersionType.Structure)&&(r.version=n,t.setVersion(VersionType.Structure,n)),o!=t.getVersion(VersionType.Text)&&(r.versionText=o,t.setVersion(VersionType.Text,o)),u.dbUpdateItem({id:e,changes:r,saveFlags:SaveFlag.None})}}u.pendingRemoteUpdates={},setTimeout(function(){!function e(t){try{i.default.PAssert(76,t&&t.data,"Item must have valid remote data associated with it to be in the tree")}catch(e){i.default.reportError(e)}if(!t||!t.data)return;if(!u.pendingRemoteUpdates[t.id]){var a=t.getVersion(VersionType.Structure)===s.a.getVersion(t.data,VersionType.Structure),r=t.getVersion(VersionType.Text)===s.a.getVersion(t.data,VersionType.Text),n={};a||(n.version=s.a.getVersion(t.data,VersionType.Structure),t.setVersion(VersionType.Structure,s.a.getVersion(t.data,VersionType.Structure))),r||(n.versionText=s.a.getVersion(t.data,VersionType.Text),t.setVersion(VersionType.Text,s.a.getVersion(t.data,VersionType.Text))),i.default.isEmpty(n)||(n.id=t.id,u.dbUpdateItem({id:t.id,changes:n,saveFlags:SaveFlag.None}))}var o=t.getItems();for(var l=0;l<o.length;++l)e(o[l]);if(t.hasArchivedChildren())for(var d=t.archivedItems(!0),l=0;l<d.length;++l)e(d[l])}(this.getRootModel())}.bind(this),0)},u.toDropHtml=function(e){var t="";if(!e.isArchived()&&(t+="<li>"+i.default.escape(e.getParsedText())+"</li>",e.hasChildren())){t+="<ul>";for(var a=0;a<e.numChildren();++a)t+=u.toDropHtml(e.getChild(a));t+="</ul>"}return t},u.toHtml=function(e,t,a){var r="<ul>";if(e.items)for(var n=0;n<e.items.length;n++){var s=u.getItem(e.items[n]),o=u.getModel(s.id),l=i.default.escape(o.getParsedText());if(!s.isArchived||s.isArchived&&t){if(r+="<li>"+l,s.note&&a){r+="<li>";var d=u.getModel(s.note);r+=i.default.escape(d.getParsedText()),r+="</li>"}s.items&&s.items.length>0&&(r+=u.toHtml(s,t,a)),r+="</li>"}}return r+="</ul>"},u.toPlainText=function(e,t,a,i){isNaN(t)&&(t=0);var r="";if(e.items)for(var n=0;n<e.items.length;n++){var s=u.getItem(e.items[n]),o=u.getModel(s.id);if(!s.isArchived||s.isArchived&&a){for(var l=0;l<t;l++)r+="\t";if(r+=o.getParsedText()+"\n",s.note&&i)r+=u.getModel(s.note).getParsedText()+"\n";s.items&&s.items.length>0&&(r+=u.toPlainText(s,t+1,a,i))}}return r};var A=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,M={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function _(e){var t;try{var a=new Date(e);i.default.isDateValid(a)&&(t=a.getTime())}catch(e){i.default.reportError(e)}return t}function T(e,t,a,r){var n="";t&&(n+=",");var s=u.getModel(e.id);if(n+='{"text":"'+function(e){return A.lastIndex=0,A.test(e)?e.replace(A,function(e){var t=M[e];return i.default.isString(t)?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}):e}(s.generateExportText(s.getParsedText()))+'"'+I(e=u.getItem(e.id),"date",_)+I(e,"dateCompleted")+I(e,"priority")+I(e,"isComplete")+I(e,"isStarred")+I(e,"isArchived")+I(e,"isNote"),e.note&&r&&(n+=',"note":'+T(u.getItem(e.note),!1,a,r)),e.items&&e.items.length>0){n+=',"items":[';for(var o=0;o<e.items.length;o++){var l=u.getItem(e.items[o]);(!l.isArchived||l.isArchived&&a)&&(n+=T(l,o>0,a,r))}n+="]"}return n+="}"}u.toJSON=function(e,t,a,r){var n=T(e,t,a,r),o='{"moodoVer":'+(i.default.settings.get(Settings.localDataVersion)||s.a.currentVersion())+',"moodoRoot":'+n+"}";try{var l=JSON.parse(o),d=JSON.stringify(l);try{i.default.PAssert(81,d===o,o)}catch(e){i.default.reportError(e)}}catch(e){i.default.reportError(e)}return o},u.createRootItem=function(e){u.setRoot(e),u.dbUpdateItem({changes:{id:e,text:n.a.RootItemName,items:[]},skipLocalModification:!0,saveFlags:SaveFlag.None,callback:function(){}})},u.ensureLocalCache=function(e){u.getRootItem()?(u.loadedItemCount>1&&(u.hasLocalData=!0),e()):e()},u.printIndexedDB=function(){},t.a=u},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=(a(7),a(5)),o=a(11),l=a(27),d=a(9),c=a(23),u=a(75),h=(a(24),a(36)),f=a(31),p="start",m="end";function g(){this._isValid=!1,this._isInRightClick=!1,this._isDirty=!1,this._isWatchingChange=!0,this._isMouseDown=!1,this.isWindowFocused=new d.a(!0),this.hoveredItem=void 0,this.hoveredReactCell=void 0,this._previousSelectedIndex=void 0,this._previousIsValid=void 0,this._selectedMap=[],this.mousePos={x:-1,y:-1},this.mouseDownPos={x:-1,y:-1},this._lastClickTime=0,this._numClicks=0,this._savedPaneSels={},this._itemHighlightPosition=void 0,this.itemHighlightPosition=new d.a,this.pane=new d.a,this.init()}g.prototype={init:function(){this.reset();var e={};e.onStart=this.onMouseDown.bind(this),e.onEnd=this.onMouseUp.bind(this),e.onRightStart=this.onRightMouseDown.bind(this),e.onMove=this.onMouseMove.bind(this),document.addEventListener("mousemove",this.onMouseMoveDocument.bind(this),!0),i.default.setupClick(document,this,e),window.addEventListener("blur",this.onWindowBlur.bind(this)),window.addEventListener("focus",this.onWindowFocus.bind(this)),o.a.listen("paneAdded",this.onPaneAdded.bind(this)),o.a.listen("paneRemoved",this.onPaneRemoved.bind(this)),s.a.forceBind("restore",this),s.a.forceBind("onScroll",this),s.a.forceBind("closeKeyboardIfNoSelection",this)},reset:function(e){this._isValid&&(this._setOffsetSide(p,void 0),this._setIndexSide(p,void 0),this._setOffsetSide(m,void 0),this._setIndexSide(m,void 0),this._dblClickOffsets=void 0,this.preferLineStart=!1,this._mouseOffset=-1,this._mouseMoved=!1,this._isValid=!1,this._isArrowSelectInverted=!1,this.getPane()&&this.getPane().caretPosition.set(void 0),this._updateSelection())},dumpState:function(){var e={isValid:this._isValid,isDirty:this._isDirty,isWatchingChange:this._isWatchingChange,isMouseDown:this._isMouseDown,isWindowFocused:this.isWindowFocused.get(),numClicks:this._numClicks,start:{index:this.startIndex,offset:this.startOffset},end:{index:this.endIndex,offset:this.endOffset}};try{var t=!!this.pane.get();e.paneInfo=t?{hasPane:t,id:this.pane.get().id,numItems:this.pane.get().items.get().length,displayTop:this.pane.get().indexOfTop(),displayCount:this.pane.get().inViewCount()}:"No Pane Set"}catch(t){e.paneInfo="Invalid Pane"}try{void 0!==this.startIndex&&(e.start.item=this.pane.get().items.get()[this.startIndex].id)}catch(t){e.start.item="Invalid Item"}try{void 0!==this.endIndex&&(e.end.item=this.pane.get().items.get()[this.endIndex].id)}catch(t){e.end.item="Invalid Item"}return e},setValid:function(e){if(e){try{i.default.PAssert(1156,!isNaN(this.getStartIndex())&&this.getStartIndex()>=0,"Must have a valid start index when sel is valid: ",this.getStartIndex())}catch(e){i.default.reportError(e)}try{i.default.PAssert(1157,!isNaN(this.getEndIndex())&&this.getEndIndex()>=0,"Must have a valid end index when sel is valid: ",this.getEndIndex())}catch(e){i.default.reportError(e)}try{var t=this.pane.get().items.get()[this.startIndex];try{i.default.PAssert(1158,t&&(i.default.isVMLI(t)||i.default.isVMLI(t.item)),"Valid selection must always be into a VMLI for start item")}catch(e){i.default.reportError(e)}var a=this.pane.get().items.get()[this.endIndex];try{i.default.PAssert(1159,a&&(i.default.isVMLI(a)||i.default.isVMLI(a.item)),"Valid selection must always be into a VMLI for end item")}catch(e){i.default.reportError(e)}}catch(e){i.default.reportError(e)}}else this.reset();this._isValid=e},isArrowSelectInverted:function(){return this._isArrowSelectInverted},setArrowSelectInverted:function(e){this._isArrowSelectInverted=e},getStartItem:function(){return this.getPane().itemAtIndex(this.startIndex)},getStartObject:function(){return this.getPane().objectAtIndex(this.startIndex)},getStartOffset:function(){var e;return-1===this.startOffset?(e=this.getStartTotal(),this.startOffset=e):e=this.startOffset,e},getStartIndex:function(){return this.startIndex},getStartTotal:function(){return this.getStartItem().getParsedText().length},getEndItem:function(){return this.getPane().itemAtIndex(this.endIndex)},getEndObject:function(){return this.getPane().objectAtIndex(this.endIndex)},getEndOffset:function(){var e;return-1===this.endOffset?(e=this.getEndTotal(),this.endOffset=e):e=this.endOffset,e},getEndIndex:function(){return this.endIndex},getEndTotal:function(){return this.getEndItem().getParsedText().length},isMouseDown:function(){return this._isMouseDown},_mutateProperty:function(e,t){var a=this[e];this[e]=t,a!==t&&(this._isDirty=!0)},_setIndexSide:function(e,t){this._mutateProperty(e+"Index",t)},_setOffsetSide:function(e,t){this._mutateProperty(e+"Offset",t)},setSelection:function(e,t,a,i){this._setIndexSide(p,e),this._setOffsetSide(p,t),this._setIndexSide(m,a),this._setOffsetSide(m,i),this._downIndex=e,this._downOffset=t},isValid:function(){return this._isValid},checkValid:function(){var e=!1,t=this.getPane();if(t&&this.startIndex>=0&&this.startIndex<t.numItems()&&this.endIndex>=0&&this.endIndex<t.numItems())if(this.getStartItem()&&this.getEndItem()){var a=this.getStartItem().getParsedText(),i=this.getEndItem().getParsedText();this.startOffset>=0&&this.startOffset<=a.length&&this.endOffset>=0&&this.endOffset<=i.length&&(e=!0)}else e=!1;return!e&&this.isValid()&&(log("Sel is now invalid"),this.reset()),e},getPane:function(){try{i.default.PAssert(1160,this.pane.get()===i.default.focusedPane,"Should these always match?")}catch(e){i.default.reportError(e)}return this.pane.get()},clearSelection:function(e){this.reset(e)},onPaneAdded:function(e){e.useCustomScroller||e.addScrollListener(this.onScroll)},onPaneRemoved:function(e){e.useCustomScroller||e.removeScrollListener(this.onScroll),this.getPane()===e&&this.setFocusedPane(void 0)},onScroll:function(e){var t=i.default.getPaneForElement(e.target);if(this._isMouseDown&&t===this.getPane()&&t.isWriteable&&!DragDrop.isDragging){var a=this.getMousePos();this._mouseOffset=a.y+t.getScrollTop();var r=document.elementFromPoint(a.x,a.y),n={clientX:a.x,clientY:a.y,target:r};this._updateFromMouse(n),this._updateSelection()}},onRightMouseDown:function(e){var t=!0,a=i.default.getElementParent(e.target);if(a&&!i.default.findParent(a,"autocompleteItem",2)&&!i.default.hasClass(a,"itemNotInPane")){var r=i.default.getReactCellForElement(a);if(r){var n=i.default.getPaneForElement(a),s=r.getIndex();this.isSelected(s,n)&&(t=!1)}}t&&(this._isInRightClick=!0,this.onMouseDown(e,!0),this._isInRightClick=!1)},checkDoubleClick:function(){this._isValid&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()!==this.getEndOffset()&&(this._dblClickOffsets={index:this.getStartIndex(),start:this.getStartOffset(),end:this.getEndOffset()}),this._dblClickTimeout=void 0},onMouseDown:function(e,t){var a=i.default.getPaneForElement(e.target);if(this.isWindowFocused.set(!0),i.default.findParent(e.target,"formattingToolbar")||(this._itemHighlightPosition=void 0,this.itemHighlightPosition.set(void 0)),a&&!(e.clientX-f.a.getSidebarWidth()>a.getLeft()+a.getWidth()-48)){this.setFocusedPane(a);var n=e.target,s=a.getInfiniteList();if(!(!a.supportSel||i.default.findParent(n,"itemNotInPane")||i.default.hasClass(n,"itemCheckbox")||i.default.hasClass(n,"itemPrefix")||i.default.findParent(n,"searchWrap")||!t&&i.default.hasClass(n,"collapser")||!t&&i.default.hasClass(n,"itemMenuIcon")||!t&&i.default.hasClass(n,"itemEditButton")||i.default.findParent(n,"formattingToolbar"))){t||(this._isMouseDown=!0),this._selectionBeforeBlur=void 0,this.preferLineStart=!1;var o=this.mouseDownPos.x,l=this.mouseDownPos.y,d=!1,h=i.default.getElementParent(e.target),g=i.default.findParent(e.target,"line"),v=!1;if(this.mouseDownPos.x=e.pageX,this.mouseDownPos.y=e.pageY,g||(g=h&&i.default.findChild(h,"line"),v=!0),i.default.findParent(n,"paneContent")){if(a&&a.isWriteable&&a.isEditable){if(h&&g){if(t)this._numClicks=1,this._lastClickTime=0,this._dblClickOffsets=void 0;else{var y=Date.now();y-this._lastClickTime<r.a.DoubleClickTime&&Math.abs(e.pageX-this.mouseDownPos.x)<2&&Math.abs(e.pageY-this.mouseDownPos.y)<2&&Math.abs(e.pageX-o)<2&&Math.abs(e.pageY-l)<2?this._numClicks++:(this._numClicks=1,this._dblClickOffsets=void 0),this._lastClickTime=y}var S=c.a.getCursorSelectionRange(e);if(S){0;var E=i.default.getReactCellForElement(e.target);if(E&&!E.props.overview){if(this.preferLineStart=e.clientX-i.default.offset(g).left<30,e.shiftKey)this._mouseMoved=!0,this._mouseOffset=e.eventY+a.getScrollTop(),this._updateFromMouse(e);else if(1===this._numClicks||this._numClicks>3){this._downIndex=E.getIndex();try{i.default.PAssert(1164,this._downIndex>=0,"Must have a valid index in react item")}catch(e){i.default.reportError(e)}if(this._downIndex<0)try{i.default.PAssert(1165,this._downIndex>=0,"Dead cell error",i.default.getElementPath(S.getStartElement()),i.default.getElementPath(e.target))}catch(e){i.default.reportError(e)}this._downItem=E.getItem();try{i.default.PAssert(1166,this._downItem,"Must have a valid item in react item")}catch(e){i.default.reportError(e)}this._setIndexSide(p,this._downIndex),this._setIndexSide(m,this._downIndex);var P=S.getSelectOffsetsInElement(h);if(v&&(P.start=this._downItem.getPrefixLength()),0===this._downItem.getParsedTextWithoutPrefix().length?this._downOffset=P.total:this._downOffset=P.start,!this.isSelected(this._downIndex,a)){var b=i.default.findParent(S.getStartContainer(),"mdSpan",2);if(b&&S.getStartOffset()===b.innerHTML.length){for(var C=b.nextElementSibling,D=0;C&&i.default.hasClass(C,"mdMarkup");)D+=C.innerHTML.length,C=C.nextElementSibling;C||(this._downOffset=Math.min(this._downOffset+D,P.total))}}this._setOffsetSide(p,this._downOffset),this._setOffsetSide(m,this._downOffset)}else if(2===this._numClicks){var I=this._downItem.getParsedText(),A=u.a.getPreviousWord(I,this._downOffset)+1,M=u.a.getNextWord(I,this._downOffset);this._setOffsetSide(p,A),this._setOffsetSide(m,M)}else 3===this._numClicks&&(this._setOffsetSide(p,0),this._setOffsetSide(m,this._downItem.getParsedText().length));d=!0}}}else if(!i.default.findParent(e.target,"paneContent")||i.default.findParent(e.target,"addItemButton")||s.disablePointerEvents.get())0;else{var _=a.indexOfLastItem();_>=0&&(e.shiftKey&&this.isValid()&&!t?this.selectIndices(this.getStartIndex(),this.getStartOffset(),_,-1):this.selectIndex(_,-1),d=!0),e.preventDefault()}this._dblClickTimeout=setTimeout(this.checkDoubleClick.bind(this),0)}}else 0;this.setValid(d&&this.checkValid()),this.isValid()&&(i.default.vmMain.setItemAnimationMode(r.a.ItemAnimationMode.None),this._updateSelection(),i.default.vmMain.resetItemAnimationMode()),s&&s.flushTimeoutPointerEvents()}}},getMousePos:function(){return this.mousePos},onMouseMoveDocument:function(e){this.mousePos.x=e.pageX,this.mousePos.y=e.pageY},onMouseMove:function(e){try{i.default.PAssert(1167,!0,"Should not be called on mobile")}catch(e){i.default.reportError(e)}if(this._dblClickTimeout&&(clearTimeout(this._dblClickTimeout),this._dblClickTimeout=void 0),e.target!==document.documentElement&&e.target.parentElement){var t=i.default.getPaneForElement(e.target);if(this._isValid&&this._isMouseDown&&t===this.getPane()&&t.supportSel&&t.isWriteable&&!DragDrop.isDragging)return this._mouseMoved=!0,i.default.vmMain.setItemAnimationMode(r.a.ItemAnimationMode.None),this._mouseOffset=e.eventY+t.getScrollTop(),this._updateFromMouse(e),this._updateSelection(),Math.abs(e.diffY)>40&&t.scrollFromMousePosition(e.clientY),e.preventDefault(),!1}},onMouseMoveMobile:function(e){this.mousePos.x=e.pageX||e.clientX,this.mousePos.y=e.pageY||e.clientY},onMouseUp:function(e){this._isMouseDown=!1,i.default.vmMain&&i.default.vmMain.resetItemAnimationMode();var t=i.default.isAttachedToDoc(e.target)&&i.default.getPaneForElement(e.target)&&i.default.getElementParent(e.target);!t||i.default.hasClass(e.target,"contact")||i.default.hasClass(t,"itemNotInPane")||this.updateCaret(),this._itemHighlightPosition&&this.itemHighlightPosition.set(this._itemHighlightPosition),i.default.cancelRepeatScroll()},focusPane:function(e){this.setFocusedPane(e),this.updateCaret()},setFocusedPane:function(e){try{i.default.PAssert(1168,!0,"Should not be focusing no pane on mobile")}catch(e){i.default.reportError(e)}if(!e||!i.default.focusedPane||i.default.focusedPane.id!==e.id){var t=i.default.focusedPane;if(t&&(t.setFocused(!1),t.isEditable&&this.isValid()&&(this._savedPaneSels[t.id]=this.save())),i.default.vmMain.beginUpdateItems(),this.reset(),h.a.reset(t),i.default.focusedPane=e,i.default.focusedItem=e?e.getItem():void 0,this.pane.set(e),e){var a=this._savedPaneSels[e.id];a?(a.pane=e,e.isLoaded?this.restore(a):setTimeout(this.restore,0,a),this._savedPaneSels[e.id]=void 0):this.reset(),e.setFocused(!0)}i.default.vmMain.commitUpdateItems()}},_updateWith:function(e,t,a){var r=t===p?a.getStartElement():a.getEndElement();try{i.default.PAssert(1169,r,"Trying to select in invalid container")}catch(e){i.default.reportError(e)}if(r){var n=i.default.getReactCellForElement(r),s=i.default.getElementParent(r),o=a.getSelectOffsetsInElement(s),l=t===p?o.start:o.end;try{i.default.PAssert(1170,n.getItem(),"Should not be updating ReactCells without VMLIs")}catch(e){i.default.reportError(e)}if(this._setIndexSide(e,n.getIndex()),this._dblClickOffsets&&n.getIndex()===this._dblClickOffsets.index)if(e===p)l=Math.min(l,this._dblClickOffsets.start);else if(e===m)l=Math.max(l,this._dblClickOffsets.end);else try{i.default.PAssert(1171,!1,"Invalid toUpdate value")}catch(e){i.default.reportError(e)}this._setOffsetSide(e,l);try{i.default.PAssert(1172,!isNaN(l),"Selection offsets should not be undefined")}catch(e){i.default.reportError(e)}}},_setSelectionOnSide:function(e,t,a){var i=e===p?m:p;this._setIndexSide(e,t),this._setOffsetSide(e,a),this._setIndexSide(i,this._downIndex),this._setOffsetSide(i,this._downOffset),this.setArrowSelectInverted(t<this._downIndex||t===this._downIndex&&a<this._downOffset)},_updateFromMouse:function(e){try{i.default.PAssert(1173,!0,"Should never be reading selection values from mouse on mobile, only accept taps")}catch(e){i.default.reportError(e)}var t=e.target;if(t){var a=i.default.focusedPane;if(!i.default.getElementParent(t)&&e.clientY<a.contentTop()){if(t=i.default.elementFromPoint(e.clientX,a.contentTop()+1,e.target),i.default.getElementParent(t)){var r=i.default.getReactCellForElement(t),n=i.default.getItemForElement(t);try{i.default.PAssert(1174,n,"If it is an LI it should be an item",t)}catch(e){i.default.reportError(e)}this._setIndexSide(p,r.getIndex()),this._setOffsetSide(p,0)}}else{var s,o,l,d=i.default.getElementParent(e.target);if(d){if((l=c.a.getCursorSelectionRange(e))&&l.getStartElement()){r=i.default.getReactCellForElement(e.target);try{i.default.PAssert(1175,r,"Must be able to find a valid reactCell for the start element")}catch(e){i.default.reportError(e)}if(r){if((s=r.getIndex())<0)try{i.default.PAssert(1177,s>=0,"Dead cell error",i.default.getElementPath(l.getStartElement()),i.default.getElementPath(e.target))}catch(e){i.default.reportError(e)}if(i.default.findParent(l.getStartContainer(),"line")&&i.default.findParent(l.getEndContainer(),"line"))o=l.getSelectOffsetsInElement(d).start;else i.default.findParent(l.getStartContainer(),"collapser")&&i.default.findParent(l.getEndContainer(),"collapser")&&(s<=this._downIndex?this._setSelectionOnSide(p,s,0):this._setSelectionOnSide(m,s,0))}}}else if(a.hasNonVMLIs){var u=i.default.dataFor(e.target,!1,!0);if(u){var h,f=u.index;if(f>=0)if(!(n=a.itemAtIndex(f)))if(f<this._downIndex)(h=a.indexOfNextVMLI(f))>=0&&this._setSelectionOnSide(p,h,0);else if((h=a.indexOfPrevVMLI(f))>=0){n=a.itemAtIndex(h);this._setSelectionOnSide(m,h,n.getParsedText().length)}}}else if(i.default.hasClass(t,"paneContent")){0;var g=a.getLastItem();this._setIndexSide(m,a.numItems()-1),this._setOffsetSide(m,g?g.getParsedText().length:0)}if(!isNaN(s)&&!isNaN(o)&&l){var v,y=i.default.findParent(e.target,"line");if(y)this.preferLineStart=e.clientX-i.default.offset(y).left<30,s<this._downIndex||s===this._downIndex&&o<this._downOffset?(v=m,this._updateWith(p,p,l),this.setArrowSelectInverted(!0)):(s>this._downIndex||s===this._downIndex&&o>=this._downOffset)&&(v=p,this._updateWith(m,m,l),this.setArrowSelectInverted(!1),o===this._downOffset&&(this._isDirty=!0)),void 0!==v&&(this._setIndexSide(v,this._downIndex),this._dblClickOffsets?this._setOffsetSide(v,this._dblClickOffsets[v]):this._setOffsetSide(v,this._downOffset),this.setValid(!0))}}}},setSelectionFromNativeRange:function(e){this._updateWith(p,p,e),this._updateWith(m,m,e),this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex()))},_updateSelection:function(){if(this._isDirty){var e=this.getPane(),t=this._selectedMap;if(this._selectedMap=[],this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex())),this.getStartIndex()===this.getEndIndex()&&void 0!==this.getStartIndex()){try{i.default.PAssert(1178,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(e){i.default.reportError(e)}0,this._selectedMap[this.getStartIndex()]={start:this.getStartOffset(),end:this.getEndOffset()}}else for(var a=this.getStartIndex();a<=this.getEndIndex();++a){var n;if(a===this.getStartIndex())n={start:this.getStartOffset(),end:-1};else if(a===this.getEndIndex()){try{i.default.PAssert(1179,this.getEndOffset()<=this.getEndItem().getParsedText().length,"Selection is past end of text string")}catch(e){i.default.reportError(e)}n={start:0,end:this.getEndOffset()}}else n=!0;this._selectedMap[a]=n}if(e){var s=!1;t.forEach(function(t,a){if(void 0===this._selectedMap[a]&&a<e.numItems()){var i=e.itemAtIndex(a);i&&(i.itemChanged.notify(),s=s||e.checkHeightChanged(i,a),0)}}.bind(this)),this._selectedMap.forEach(function(a,i){var r=t[i],n=this._selectedMap[i];if(void 0===r||r.start!==n.start||r.end!==n.end){var o=e.itemAtIndex(i);o&&(o.itemChanged.notify(),s=s||e.checkHeightChanged(o,i),0)}}.bind(this)),s&&(i.default.vmMain.setItemAnimationMode(r.a.ItemAnimationMode.Move),e.updateItems(!1,!0),i.default.vmMain.resetItemAnimationMode())}this.updateCaret(),this._isDirty=!1,o.a.fireEvent("selectionChanged",[]);var l=this.getStartIndex(),d=this.isValid();if(l===this.getEndIndex()||!d){if(l!==this._previousSelectedIndex||d!==this._previousIsValid){var c=d?this.getStartItem():void 0;o.a.fireEvent("selectedIndexChanged",[l,e,c])}this._previousSelectedIndex=l,this._previousIsValid=d}}},_onSelectStart:function(e){return!DragDrop.isDragging||(e.preventDefault(),!1)},_onSelectionChange:function(e){if(c.a.hasSelection()&&(n.a.android&&DragDrop.isDragging))return void c.a.clearSelection();i.default.timeoutOnce("closeKeyboardIfNoSelection",this.closeKeyboardIfNoSelection,100)},closeKeyboardIfNoSelection:function(){0},updateCaret:function(){var e=this.getPane();if(e&&e.isWriteable){if(this.isValid()){var t=!this._isInRightClick&&this.getStartItem()===this.getEndItem()&&this.getStartItem()&&this.getStartItem().isNote();t?e.openNoteContextMenu():!i.default.menus.isAutocompleteOpen()&&i.default.menus.isContextMenuOpen()&&i.default.menus.closeContextMenu()}if(this.isValid()){0;var a=this.getStartItem(),n=this.getStartObject(),s=e.topOfIndex(this.getStartIndex())+(a&&a.shouldShowParents(n,e)?r.a.HeightAgendaParents:0),o=e.getPaddingForPaneObject(n),d=l.a.getCaretOffset(n,e,this.getEndOffset(),this.preferLineStart);if(this.getStartItem()&&this.getEndItem()&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()===this.getEndOffset()){var c=e.caretPosition.get();d.left=Math.floor(Math.min(d.left+o,e.getWidth()-10)),d.top+=s,d.isVisible=!0,d.item=a,d.pane=e,this._itemHighlightPosition=void 0,this.itemHighlightPosition.set(void 0),c&&c.isVisible&&c.left===d.left&&c.top===d.top||e.caretPosition.set(d)}else{var u=e.caretPosition.get();u&&u.isVisible&&((u=i.default.clone(u)).isVisible=!1,e.caretPosition.set(u));var h=l.a.getCaretOffset(n,e,this.getStartOffset(),this.preferLineStart);this._itemHighlightPosition={x:o+(h.left+d.left)/2,y:s}}t||!e.hiddenInput||this.isComposing||this.focusHiddenInput()}else e.caretPosition.set(void 0)}},focusHiddenInput:function(){var e=this.getPane();if(e&&e.isEditable&&e.hiddenInput){var t=c.a.createSelectionRange(),a=e.hiddenInput,r=0,n=1,s=e.scrollElement,o=s.scrollLeft,l=s.scrollTop;if(this.isValid()){var d=this.getStartItem().getParsedText();a.innerHTML=i.default.escape(d),r=this.getStartOffset(),n=this.getStartItem()===this.getEndItem()?this.getEndOffset():this.getStartOffset()}a.firstChild&&0!==a.firstChild.length||(a.innerHTML=TextSpace);var u=a.firstChild;try{i.default.PAssert(1183,u,"Empty element must have a valid child")}catch(e){i.default.reportError(e)}try{a.focus(),t.setStart(u,r),t.setEnd(u,n),c.a.setSelectionRange(t)}catch(e){i.default.reportError(e)}s.scrollLeft=o,s.scrollTop=l}},isSelected:function(e,t){return t===this.getPane()&&!!this._selectedMap[e]},getSelectionAtIndex:function(e){return this._selectedMap[e]},selectIndex:function(e,t,a,i){return void 0===a&&(a=t),this.selectIndices(e,t,e,a,i)},selectIndices:function(e,t,a,n,s){try{i.default.PAssert(1184,e>=0,"Must supply a valid start index")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1185,a>=0,"Must supply a valid end index")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1186,a>e||a===e&&(n>=t||-1===n),"Must not pass reversed selection")}catch(e){i.default.reportError(e)}if(!(e<0||a<0)){var o,l,d=!1,c=this.getPane();if(c&&c.isWriteable){o=c.itemAtIndex(e),l=c.itemAtIndex(a);try{i.default.PAssert(1187,o,"Trying to select invalid start index")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1188,l,"Trying to select invalid end index")}catch(e){i.default.reportError(e)}if(o&&l&&s!==r.a.SelectOption.AllowPrefix){var u=o.getPrefixLength(),h=l.getPrefixLength();t>=0&&t<u&&(t=u),n>=0&&n<h&&(n=h)}}if(!o||!l||this.isValid()&&e===this.getStartIndex()&&t===this.getStartOffset()&&a===this.getEndIndex()&&n===this.getEndOffset())this.updateCaret();else{0,this.setSelection(e,t,a,n);try{i.default.PAssert(1189,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(e){i.default.reportError(e)}!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&this._updateSelection(),d=!0}return d}},selectItem:function(e,t,a){try{i.default.PAssert(1190,i.default.isNumber(t),"Must pass a valid start offset")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1191,i.default.isNumber(a)||void 0===a,"Must pass a valid end offset")}catch(e){i.default.reportError(e)}return void 0===a&&(a=t),this.selectItems(e,t,e,a)},selectItems:function(e,t,a,r){try{i.default.PAssert(1192,i.default.isVMLI(e),"Should only be passing VMLIs to start this fn")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1193,i.default.isVMLI(a),"Should only be passing VMLIs to end this fn")}catch(e){i.default.reportError(e)}var n=this.getPane();if(n){var s=n.indexOfItem(e);try{i.default.PAssert(1194,s>=0,"Must be able to find the start item in the pane")}catch(e){i.default.reportError(e)}var o=n.indexOfItem(a);try{i.default.PAssert(1195,o>=0,"Must be able to find the end item in the pane")}catch(e){i.default.reportError(e)}return this.selectIndices(s,t,o,r)}},selectElements:function(e,t,a,r){try{i.default.PAssert(1196,!i.default.isVMLI(e),"Should not be passing VMLIs to start this fn")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1197,!i.default.isVMLI(a),"Should not be passing VMLIs to end this fn")}catch(e){i.default.reportError(e)}this._isWatchingChange=!1,n.a.android&&(e=e.firstElementChild,a=a.firstElementChild);var s=!1,o=c.a.getOffsetChildElement(e,t),l=c.a.getOffsetChildElement(a,r);try{i.default.PAssert(1198,o&&o.element&&!isNaN(o.offset),"Start element is invalid")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1199,l&&l.element&&!isNaN(l.offset),"End element is invalid")}catch(e){i.default.reportError(e)}return o&&o.element&&l&&l.element&&(c.a.setSelection(o.element,o.offset,l.element,l.offset),s=!0),this._isWatchingChange=!0,s},save:function(){if(this._isValid){try{i.default.PAssert(1200,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1201,!isNaN(this.getEndIndex()),"End index must be valid")}catch(e){i.default.reportError(e)}return{pane:this.getPane(),startIndex:this.getStartIndex(),startItem:this.getStartItem(),startObject:this.getStartObject(),startOffset:this.getStartOffset(),endIndex:this.getEndIndex(),endItem:this.getEndItem(),endObject:this.getEndObject(),endOffset:this.getEndOffset()}}},restore:function(e){var t=!1;if(e){try{i.default.PAssert(1202,e.pane,"Must have a valid pane to restore selection to")}catch(e){i.default.reportError(e)}i.default.focusedPane=e.pane,i.default.focusedItem=e.pane.getItem(),this.pane.set(e.pane),e=e.pane.adjustSelectionFromPaneObject(e)}return e&&e.startItem&&e.endItem?(this.selectIndices(e.startIndex,e.startOffset,e.endIndex,e.endOffset),t=!0):this.reset(),t},scrollStartIntoView:function(e){if(this._isValid){try{i.default.PAssert(1203,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1204,!isNaN(this.getEndIndex()),"End index must be valid")}catch(e){i.default.reportError(e)}i.default.focusedPane.scrollIndexIntoView(this.getStartIndex(),e?ScrollDuration.Snap:ScrollDuration.Default)}},scrollEndIntoView:function(){if(this._isValid){try{i.default.PAssert(1205,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1206,!isNaN(this.getEndIndex()),"End index must be valid")}catch(e){i.default.reportError(e)}i.default.focusedPane.scrollIndexIntoView(this.getEndIndex(),ScrollDuration.Default)}},onWindowBlur:function(e){this.isWindowFocused.set(!1)},onWindowFocus:function(e){this.isWindowFocused.set(!0)},getSelectedItems:function(e){if(!this._isValid)return[];for(var t=[],a=this.getPane(),i=this.getStartIndex();i<=this.getEndIndex();++i){var r=a.itemAtIndex(i);!r||!e&&r.isNote()||t.push(r)}return t},getStartElement:function(){if(this._isValid&&!isNaN(this.getStartIndex()))return this.getPane().elementAtIndex(this.getStartIndex())},getEndElement:function(){if(this._isValid&&!isNaN(this.getEndIndex()))return this.getPane().elementAtIndex(this.getEndIndex())},setHovered:function(e,t,a){if(this.hoveredReactCell!==a){var i=this.hoveredItem;this.hoveredItem=t,this.hoveredReactCell=a,i&&i.itemChanged.notify(),t&&t.itemChanged.notify()}},isReactCellHovered:function(e){return this.hoveredReactCell===e},isItemHovered:function(e){return this.hoveredItem===e},insertTextAtCaret:function(e,t){this.pane.get().updateSelectionAndroid({target:this.getStartElement()});try{i.default.PAssert(1207,this.getStartIndex()===this.getEndIndex(),"Cannot insert text in multiselect")}catch(e){i.default.reportError(e)}var a=this.getStartIndex(),r=this.getStartItem(),n=this.getStartOffset(),s=this.getEndOffset(),o=r.getRawText();n!==s&&(o=o.substr(0,n)+o.substr(s,o.length-s)),t&&n>0&&" "!==o[n-1]&&(o=i.default.insertIntoText(o," ",n),n++),o=i.default.insertIntoText(o,e,n),n+=e.length,r.setText(o,!0,ChangeType.Local),this.selectIndex(a,n)},closeKeyboard:function(){0},_closeKeyboard:function(){g&&g.reset(),i.default.blurActiveElement()},fireKeyEvent:function(e,t,a){this.fireKeyEventInternal(e,"keydown",t),this.fireKeyEventInternal(e,"keypress",a||t),this.fireKeyEventInternal(e,"keyup",t)},fireKeyEventInternal:function(e,t,a){try{i.default.PAssert(1208,void 0!==a,"Must pass in valid key data to type")}catch(e){i.default.reportError(e)}if(e||(e=this.getStartElement()),document.createEvent&&e){var r=document.createEvent("Event");r.normCode=a.normCode,r.shiftKey=!!a.shiftKey,r.altKey=!!a.altKey,r.ctrlKey=!!a.ctrlKey,r.metaKey=!!a.metaKey,r.synthetic=!0,r.initEvent(t,!0,!0),e.dispatchEvent(r)}else if(e)try{i.default.PAssert(1209,!1,"Unable to fire key event")}catch(e){i.default.reportError(e)}else try{i.default.PAssert(1210,!1,"No element available to fire key event on")}catch(e){i.default.reportError(e)}},fireClickEvent:function(e,t){this.fireClickEventInternal(e,"mousedown",t),this.fireClickEventInternal(e,"mouseup",t),this.fireClickEventInternal(e,"mouseclick",t)},fireClickEventInternal:function(e,t,a,r){try{i.default.PAssert(1211,void 0!==a,"Must pass in a valid button to click with")}catch(e){i.default.reportError(e)}if(e||(e=c.a.getSelectionNode()),document.createEvent&&e){var n=document.createEvent("Event");if(n.button=a,n.synthetic=!0,r)for(var s in r)r.hasOwnProperty(s)&&(n[s]=r[s]);n.initEvent(t,!0,!0),e.dispatchEvent(n)}else if(e)try{i.default.PAssert(1212,!1,"Unable to fire click event")}catch(e){i.default.reportError(e)}else try{i.default.PAssert(1213,!1,"No element available to fire click event on")}catch(e){i.default.reportError(e)}},fireMouseUp:function(e,t){this.fireClickEventInternal(e,"mouseclick",t)}},t.a=new g},function(e,t,a){"use strict";var i=a(5),r=a(72);function n(e,t){this._value=e,this._listeners=void 0,t&&(this._listeners=[t])}n.prototype={get:function(){return this._value},set:function(e,t){var a=this._value;return this._value=e,!1!==t&&this.notify(e,a,t),e},dbgObserve:function(){this.listen(function(e,t){log("Value: ",t,"->",e)})},hasListeners:function(){return this._listeners&&this._listeners.length>0},listen:function(e){return this._listeners||(this._listeners=[]),this._listeners.push(e),new r.a(this,e)},unlisten:function(e){this._listeners&&this._listeners.remove(e)},notify:function(e,t,a){0===arguments.length&&(e=this._value,t=this._value,a=!0);var i=this._listeners;if(i&&i.length>0&&(e!==t||!0===a)){0;for(var r=0;r<i.length;++r)!1===(0===arguments.length?i[r](this._value,void 0,a):i[r](e,t,a))&&(i.splice(r,1),r--);0}}},i.a.defineBase(n),t.a=n},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(7),s=a(17),o=a(8);window.TrackerType={Insert:1,Remove:2,SetText:3,Create:4,Delete:5,Move:6,Update:7,Format:8,Zoom:9,UIAction:10,Misc:11,Mobile:12},window.TrackerMisc={ToggleOverview:1,RightClick:2,CloseMessage:3,ChangeDate:4,AddContact:5,DropItem:6,SyncContacts:7,OpenContact:8,SearchChanged:10,OpenDocumentsMenu:11,AddDocument:12,OpenDocument:13,OpenDocSharing:14,Copy:15,Paste:16,OpenImport:17,OpenExport:18,UndoRedo:19,AddToGCal:20,OpenEmail:21,ComposeEmail:22,DriveUpload:23,OpenDisplaySettings:24,DragItem:25,OpenAddPaneMenu:26,SetPrefix:27,OpenCalendarsMenu:28,OpenHelp:29},window.TrackerMiscMobile={OpenKeyboard:1,CloseKeyboard:2,PaneCalendar:3,PaneOutline:4,OpenAutocomplete:5,CloseAutocomplete:6,AtButton:7,OpenMultiselect:8,CloseMultiselect:9},window.TrackerUIAction={AddPane:1,RemovePane:2,SwitchPaneMode:3,OpenSettingsMenu:4,AddBoard:5};function l(){this.disabled=!1,this.allowOfflineUndo=!1,this.cursor=-1,this.groupID=0,this.groups=[],this.externalUndoRedo=!1,this.undoRedoActive=!1,this.canRedo=!1,this.canUndo=!1,this._performingActions=!1,this._currentAction=[],this._actionsPreventUndo=!1,this._aggregateActions=0,this._externalStateChanged=[],r.a.forceBind("stateChangeForUndoRedo",this),this.init()}function d(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.itemID);try{i.default.PAssert(1075,r,"Expected model to exist: ",a)}catch(e){i.default.reportError(e)}var s=r.getParsedText(),l=0;"\ufeff"===s[0]&&(l=1);var d=s.slice(l,a.position)+s.slice(a.position+a.text.length);r.setText(d,!0,ChangeType.Local),o.a.selectItem(r,a.position)}}function c(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.itemID);try{i.default.PAssert(1076,r,"Expected model to exist: ",a)}catch(e){i.default.reportError(e)}var s=r.getParsedText(),l=s.slice(0,a.position)+a.text+s.slice(a.position);0===l.length&&(l="\ufeff"),r.setText(l,!0,ChangeType.Local),o.a.selectItem(r,a.position,a.position+a.text.length)}}function u(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.itemID);try{i.default.PAssert(1077,r,"Expected model to exist: ",a)}catch(e){i.default.reportError(e)}var s=r.getParsedText(),l=0;"\ufeff"===s[0]&&(l=1);var d=s.slice(l,a.position)+a.text+s.slice(a.position);r.setText(d,!0,ChangeType.Local),o.a.selectItem(r,a.position,a.position+a.text.length)}}function h(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.itemID);try{i.default.PAssert(1078,r,"Expected model to exist: ",a)}catch(e){i.default.reportError(e)}var s=r.getParsedText(),l=s.slice(0,a.position)+s.slice(a.position+a.text.length);0===l.length&&(l="\ufeff"),r.setText(l,!0,ChangeType.Local),o.a.selectItem(r,a.position)}}function f(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.parent);try{i.default.PAssert(1079,r,"Expected model to exist: ",a)}catch(e){i.default.reportError(e)}var s=r.removeChildAtIndex(a.position,ChangeType.Local);try{i.default.PAssert(1080,s.id===a.itemID,"Expected data to match removed child: ",s,a)}catch(e){i.default.reportError(e)}s.parent(void 0),n.a.deleteItem(s,ChangeType.Local);var l=r;a.position>0&&(l=r.getChild(a.position-1)),i.default.focusedPane.indexOfItem(l)>=0&&o.a.selectItem(l,l.getParsedText().length),r.save({items:r.getItemsArrayForSave()},SaveFlag.None)}}function p(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.parent);try{i.default.PAssert(1081,r,"Expected parent model to exist: ",a)}catch(e){i.default.reportError(e)}var s=n.a.getModel(a.itemID);try{i.default.PAssert(1082,s,"Expected child model to exist: ",a)}catch(e){i.default.reportError(e)}n.a.undeleteItem(s,ChangeType.Local),s.parent(r),r.items.splice(a.position,0,s),o.a.selectItem(s,0),r.save({items:r.getItemsArrayForSave()},SaveFlag.None)}}function m(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.parent);try{i.default.PAssert(1084,r,"Expected model to exist: ",a)}catch(e){i.default.reportError(e)}var s=n.a.getModel(a.itemID);try{i.default.PAssert(1085,s,"Expected model to exist: ",a)}catch(e){i.default.reportError(e)}n.a.undeleteItem(s,ChangeType.Local),s.parent(r),r.items.splice(a.position,0,s),o.a.selectItem(s,0),r.save({items:r.getItemsArrayForSave()},SaveFlag.None)}}function g(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.parent);try{i.default.PAssert(1087,r,"Expected model to exist: ",a)}catch(e){i.default.reportError(e)}var s=r.removeChildAtIndex(a.position,ChangeType.Local);try{i.default.PAssert(1088,s.id===a.itemID,"Expected data to match removed child: ",s,a)}catch(e){i.default.reportError(e)}s.parent(void 0),n.a.deleteItem(s,ChangeType.Local);var l=r;a.position>0&&(l=r.getChild(a.position-1)),o.a.selectItem(l,l.getParsedText().length),r.save({items:r.getItemsArrayForSave()},SaveFlag.None)}}function v(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.oldParent);try{i.default.PAssert(1089,r,"Expected oldParent model to exist: ",a)}catch(e){i.default.reportError(e)}var s=n.a.getModel(a.newParent);try{i.default.PAssert(1090,s,"Expected newParent model to exist: ",a)}catch(e){i.default.reportError(e)}var l=s.removeChildAtIndex(a.newPosition,ChangeType.Local);try{i.default.PAssert(1091,l.id===a.itemID,"Expected data to match child: ",l,a)}catch(e){i.default.reportError(e)}l.parent(r),r.items.splice(a.oldPosition,0,l),o.a.selectItem(l,0),s.save({items:s.getItemsArrayForSave()},SaveFlag.None),r.save({items:r.getItemsArrayForSave()},SaveFlag.None)}}function y(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.oldParent);try{i.default.PAssert(1092,r,"Expected oldParent model to exist: ",a)}catch(e){i.default.reportError(e)}var s=n.a.getModel(a.newParent);try{i.default.PAssert(1093,s,"Expected newParent model to exist: ",a)}catch(e){i.default.reportError(e)}var l=r.removeChildAtIndex(a.oldPosition,ChangeType.Local);try{i.default.PAssert(1094,l.id===a.itemID)}catch(e){i.default.reportError(e)}l.parent(s),s.items.splice(a.newPosition,0,l),o.a.selectItem(l,0),s.save({items:s.getItemsArrayForSave()},SaveFlag.None),r.save({items:r.getItemsArrayForSave()},SaveFlag.None)}}function S(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.itemID);try{i.default.PAssert(1095,r,"Expected model to exist: ",a)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1096,r[a.field],"Expected field to exist: ",a)}catch(e){i.default.reportError(e)}r[a.field](a.oldValue,ChangeType.Local)}}function E(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.itemID);try{i.default.PAssert(1097,r,"Expected model to exist: ",a)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1098,r[a.field],"Expected field to exist: ",a)}catch(e){i.default.reportError(e)}r[a.field](a.newValue)}}function P(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.itemID);try{i.default.PAssert(1099,r,"Expected model to exist: ",a)}catch(e){i.default.reportError(e)}}}function b(e){for(var t=0;t<e.length;++t){var a=e[t],r=n.a.getModel(a.itemID);try{i.default.PAssert(1100,r,"Expected model to exist: ",a)}catch(e){i.default.reportError(e)}}}function C(e){var t=e[0],a=n.a.getModel(t.oldItemID);try{i.default.PAssert(1101,a,"Expected model to exist: ",t)}catch(e){i.default.reportError(e)}if(t.zoomIn)i.default.vmMain.zoomout(a,!0);else if(t.zoomOut)i.default.vmMain.zoomin(a,!0);else try{i.default.PAssert(1102,!1,"Zoom action must define either zoomIn or zoomOut")}catch(e){i.default.reportError(e)}}function D(e){var t=e[0],a=n.a.getModel(t.itemID);try{i.default.PAssert(1103,a,"Expected model to exist: ",t)}catch(e){i.default.reportError(e)}if(t.zoomIn)i.default.vmMain.zoomout(a,!0);else if(t.zoomOut)i.default.vmMain.zoomin(a,!0);else try{i.default.PAssert(1104,!1,"Zoom action must define either zoomIn or zoomOut")}catch(e){i.default.reportError(e)}}function I(e){switch(e[0].type){case TrackerUIAction.RemovePane:case TrackerUIAction.SwitchPaneMode:break;default:try{i.default.PAssert(1105,!1,"Invalid UIAction")}catch(e){i.default.reportError(e)}}}function A(e){}l.prototype={init:function(){this.listeners=[],s.a.registerForUndoRedoStateChange(this)},addListener:function(e){this.listeners.push(e)},removeListener:function(e){this.listeners.remove(e)},_getNextGroupID:function(){return this.groupID+1},_useNextGroupID:function(){return++this.groupID},_getCurrentGroup:function(){return this.groups[this.cursor]},_getCurrentAction:function(){return this.groups[this.cursor].events[this.groups[this.cursor].events.length-1]},_pushGroup:function(){var e=this._useNextGroupID();return this.groups.push({id:e,events:[],persisted:!1}),this.cursor<74&&this.cursor++,this.groups.length>75&&this._handleGroupTrimmed(this.groups.shift()),e},_doAction:function(e,t){var a=this._getCurrentGroup();try{i.default.PAssert(1106,a,"Expected group to exist")}catch(e){i.default.reportError(e)}var r={type:e,data:t};switch(e){case TrackerType.Insert:r.cb={undo:d,redo:c};break;case TrackerType.Remove:r.cb={undo:u,redo:h};break;case TrackerType.Create:r.cb={undo:f,redo:p};break;case TrackerType.Delete:r.cb={undo:m,redo:g};break;case TrackerType.Move:r.cb={undo:v,redo:y};break;case TrackerType.Update:r.cb={undo:S,redo:E};break;case TrackerType.Format:r.cb={undo:P,redo:b};break;case TrackerType.Zoom:r.cb={undo:C,redo:D};break;case TrackerType.UIAction:r.cb={undo:I,redo:A};break;default:try{i.default.PAssert(1107,!1,"Expected TrackerType, received: ",e)}catch(e){i.default.reportError(e)}}a.events.push(r)},_handleGroupTrimmed:function(e){for(var t=0;t<e.events.length;++t){var a=e.events[t];switch(a.type){case TrackerType.Insert:case TrackerType.Remove:case TrackerType.Create:case TrackerType.Delete:case TrackerType.Move:case TrackerType.Update:case TrackerType.Format:case TrackerType.Zoom:case TrackerType.UIAction:break;default:try{i.default.PAssert(1108,!1,"Expected TrackerType, received: ",a.type)}catch(e){i.default.reportError(e)}}}},_mergeAction:function(e,t){log("Tracker Action Merged: ",e,t);var a=this._getCurrentAction();try{i.default.PAssert(1109,a,"Expected action to exist")}catch(e){i.default.reportError(e)}switch(e){case TrackerType.Insert:case TrackerType.Remove:case TrackerType.Create:case TrackerType.Delete:case TrackerType.Move:case TrackerType.Update:break;case TrackerType.Format:try{i.default.PAssert(1110,!1,"Formats cannot be merged")}catch(e){i.default.reportError(e)}break;case TrackerType.Zoom:try{i.default.PAssert(1111,!1,"Zooms cannot be merged")}catch(e){i.default.reportError(e)}break;case TrackerType.UIAction:try{i.default.PAssert(1112,!1,"UIActions cannot be merged")}catch(e){i.default.reportError(e)}break;default:try{i.default.PAssert(1113,!1,"Expected TrackerType, received: ",e)}catch(e){i.default.reportError(e)}}},_canMerge:function(e){var t=!1,a=this._getCurrentGroup();return a&&a.events.length>0&&(a.events[a.events.length-1].type===e?e===TrackerType.Insert&&(t=!0):t=!1),t},_canCombine:function(e,t){var a=this._getCurrentGroup();return a&&(a.id===t||0===a.events.length)},performActions:function(e){try{i.default.PAssert(1114,!this.disabled||i.default.intro,"Can only perform actions when enabled or during the intro")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1115,!this._performingActions,"Can not nest performing actions")}catch(e){i.default.reportError(e)}if(this._performingActions=!0,e&&e.length>0){if(!this.disabled){var t=void 0;this.cursor!=this.groups.length-1?(this.groups.splice(this.cursor+1,this.groups.length-(this.cursor+1)),t=this._pushGroup()):t=this._getNextGroupID()}for(var a=0;a<e.length;++a){var r=e[a];this.fireActionEvent(r),this.disabled||(this._canCombine(r.type,t)?this._canMerge(r.type)?this._mergeAction(r.type,r.data):this._doAction(r.type,r.data):(t=this._pushGroup(),this._doAction(r.type,r.data)))}}this._performingActions=!1},beginAction:function(e){try{i.default.PAssert(1116,!this._performingActions,"Should never begin an action while replaying old actions")}catch(e){i.default.reportError(e)}if(0===this._aggregateActions){this._actionsPreventUndo=!!e,s.a.beginAction(e);try{i.default.PAssert(1117,0===this._currentAction.length,"Current actions should always be empty when starting a new action")}catch(e){i.default.reportError(e)}}else 0;this._aggregateActions++},performAction:function(e,t){try{i.default.PAssert(1118,!this._performingActions,"Should never perform an action while replaying old actions")}catch(e){i.default.reportError(e)}var a=!i.default.vmMain.isLoaded||i.default.isLoadingRemote;this.disabled?i.default.intro&&(a||this.performActions([{type:e,data:[t]}])):this._aggregateActions?this._currentAction.push({type:e,data:[t]}):this.performActions([{type:e,data:[t]}])},endAction:function(){try{i.default.PAssert(1119,!this._performingActions,"Should never end an action while replaying old actions")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1120,0!==this._aggregateActions,"Must have called beginAction before calling endAction")}catch(e){i.default.reportError(e)}1===this._aggregateActions&&(this.disabled&&!i.default.intro||this.performActions(this._currentAction),this._currentAction.length=0,s.a.endAction(),this._actionsPreventUndo=!1),this._aggregateActions=Math.max(0,this._aggregateActions-1)},resetAggregateActionCount:function(){this._aggregateActions=0},_processStateChangedSelection:function(e,t){try{i.default.PAssert(1121,!this.undoRedoActive,"Must not currently be undoing/redoing an action when setting selection")}catch(e){i.default.reportError(e)}var a,r=0,s=0;if(i.default.isKeyboardOPen||!i.default.keyboardToolbar){for(var l=0;l<e.length;++l){var d=e[l],c=d.data,u=n.a.getModel(c.itemID);try{i.default.PAssert(1122,u,"Expected model to exist: ",c)}catch(e){i.default.reportError(e)}switch(d.type){case TrackerType.Insert:a=u,r=c.position,s=c.text.length;break;case TrackerType.Remove:a=u,r=c.position,s=0;break;case TrackerType.SetText:i.default.focusedPane.indexOfItem(u)>=0&&(a=u,r=c.position,s=0);break;case TrackerType.Create:a=u,r=0,s=0;break;case TrackerType.Delete:if(c.previous){var h=n.a.getModel(c.previous);h&&h.isDescendantOf(i.default.focusedPane.getItem())&&(a=h,r=h.getParsedText().length,s=0)}}}var f=-1;i.default.focusedPane&&(a?f=t&&t.item===a?i.default.focusedPane.closestIndexOfObject(t):i.default.focusedPane.indexOfItem(a):(r=o.a.getStartOffset()||0,f=t?i.default.focusedPane.closestIndexOfObject(t):-1,s=0)),f>=0?(o.a.selectIndex(f,r,r+s),a&&i.default.focusedPane.scrollItemIntoView(a,ScrollDuration.Default)):o.a.reset()}this._externalStateChanged=[]},notifyStateChangedFromUndoRedo:function(e,t){try{i.default.PAssert(1123,this.undoRedoActive)}catch(e){i.default.reportError(e)}this._externalStateChanged.push({type:e,data:t})},undoAction:function(){i.default.vmMain.canRunUndoRedo()||i.default.toasts.pushMessage(MessageID.OfflineUndo),this.undoRedoActive=!0;try{i.default.PAssert(1124,!this._performingActions)}catch(e){i.default.reportError(e)}this.beforeUndoRedo();var e=o.a.isValid()?o.a.getStartObject():void 0;if(!this.disabled&&this.allowOfflineUndo){if(this.cursor>=0)for(var t=this.groups[this.cursor--],a=t.events.length-1;a>=0;a--){var r=t.events[a];r.cb.undo(r.data)}}else if(this.canUndo){try{i.default.PAssert(1125,this.externalUndoRedo)}catch(e){i.default.reportError(e)}s.a.undoAction()}this.afterUndoRedo(),this.undoRedoActive=!1,this._processStateChangedSelection(this._externalStateChanged,e),this.miscAction({type:TrackerType.Misc,misc:TrackerMisc.UndoRedo,data:[{undo:!0}]})},redoAction:function(){i.default.vmMain.canRunUndoRedo()||i.default.toasts.pushMessage(MessageID.OfflineUndo),this.undoRedoActive=!0;try{i.default.PAssert(1126,!this._performingActions)}catch(e){i.default.reportError(e)}this.beforeUndoRedo();var e=o.a.isValid()?o.a.getStartObject():void 0;if(!this.disabled&&this.allowOfflineUndo){if(this.cursor>=-1&&this.cursor<this.groups.length-1)for(var t=this.groups[++this.cursor],a=0;a<t.events.length;++a){var r=t.events[a];r.cb.redo(r.data)}}else if(this.canRedo){try{i.default.PAssert(1127,this.externalUndoRedo)}catch(e){i.default.reportError(e)}s.a.redoAction()}this.afterUndoRedo(),this.undoRedoActive=!1,this._processStateChangedSelection(this._externalStateChanged,e),this.miscAction({type:TrackerType.Misc,misc:TrackerMisc.UndoRedo,data:[{redo:!0}]})},beforeUndoRedo:function(){i.default.vmMain.beginUpdateItems()},afterUndoRedo:function(){i.default.vmMain.commitUpdateItems()},miscAction:function(e){this.fireActionEvent(e)},resetState:function(){this._performingActions=!1,this._externalStateChanged=[],this._currentAction=[],this.undoRedoActive=!1,this.cursor=-1,this.groupID=0,this.groups=[]},_getOrderedGroups:function(){return this.groups.slice(this.cursor).concat(this.groups.slice(0,this.cursor))},stringifyGroups:function(){return"Tracker: "+this._getOrderedGroups().length},stateChangeForUndoRedo:function(e){this.externalUndoRedo=!0,this.disabled=!0,this.canRedo=e.canRedo,this.canUndo=e.canUndo},fireActionEvent:function(e){try{if(e.data||(e.data={}),this.listeners)for(var t=0;t<this.listeners.length;t++)this.listeners[t](e)}catch(e){i.default.reportError(e)}}},t.a=new l},function(e,t,a){"use strict";var i=a(5),r=a(42);function n(){}i.a.defineBase(n),i.a.extend(n.prototype,r.a),t.a=new n},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=a(25),c=a(32),u=l.a.createClass({displayName:"FancyContextMenu",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){var e=this.props;this.listenToDispatcher("windowResize"),e.supportArrows&&(this.selectedIndex=d.a.registerArrowsMode("FancyContextMenu",!0,this.getNumItems,this.onArrowsModeSelect,this.onArrowsModeKey),e.fromHotkey&&this.selectedIndex.set(0,!1),e.onSelectedIndexChanged&&this.selectedIndex.listen(e.onSelectedIndexChanged))},getHotkeys:function(){var e=this.props,t=[d.a.createEscape(this.onEscapeKey)];return e.hotkeys&&(t=t.concat(e.hotkeys)),t},getRefAtIndex:function(e){return this.refs["el_"+e]},componentDidMount:function(){this.props.noBackdrop&&document.addEventListener("mousedown",this.onMouseDownNoBackdrop,!0),this.updateState()},onUnmount:function(){this.props.supportArrows&&d.a.exitArrowsMode("FancyContextMenu"),this.props.noBackdrop&&document.removeEventListener("mousedown",this.onMouseDownNoBackdrop,!0)},getState:function(){var e=this.updatePosition();return{selectedIndex:this.selectedIndex,left:e.left,top:e.top,right:e.right,bottom:e.bottom,maxHeight:e.maxHeight}},onMouseDownNoBackdrop:function(e){i.default.findParent(e.target,"fancyContextMenu")||i.default.menus.closeContextMenu()},isAtPosition:function(e){if(this.props.position&&this.props.position.split("-").indexOf(e)>=0)return!0;return!1},getNumItems:function(){return this.numItems},onArrowsModeSelect:function(e){if(e>=0){var t=this.refs["el_"+e];t&&t.onClick&&t.onClick()}},onArrowsModeKey:function(e,t){var a=this.props;a.onKeyPress&&a.onKeyPress(e,t)&&a.supportArrows&&d.a.exitArrowsMode("FancyContextMenu")},onEscapeKey:function(){this.props.onEscape&&this.props.onEscape(),i.default.menus.closeContextMenu()},onChildMouseEnter:function(e){this.selectedIndex.set(e)},isOnSide:function(e){return this.props.side?this.props.side.indexOf(e)>=0:"bottom"===e},updatePosition:function(){var e=this.props,t=n.a.windowWidth(),a=n.a.windowHeight();try{i.default.PAssert(2569,e.element,"Context menu needs an element to open on",e.id)}catch(e){i.default.reportError(e)}if(e.element){var r,s,o=e.element.getBoundingClientRect(),l=e.pos,d=this.refs.menu,c=l?l.left:void 0,u=l?l.top:void 0;isNaN(c)&&(this.isOnSide("right")?c=o.right:this.isOnSide("left")?r=t-("top left"===e.side?o.right:o.left):c=o.left),isNaN(u)&&(this.isOnSide("bottom")?u=o.bottom:this.isOnSide("top")?s=a-o.top:u=o.top);var h=e.positionOffset;h&&(!isNaN(c)&&h.left&&(c+=h.left),!isNaN(r)&&h.right&&(r+=h.right),!isNaN(u)&&h.top&&(u+=h.top),!isNaN(s)&&h.bottom&&(s+=h.bottom));var f={left:c,top:u,right:r,bottom:s};if(d){var p=c+d.clientWidth,m=u+d.clientHeight,g=t-8,v=a-8;"shrink"===this.props.overflowHeight&&s>a-8&&(f.maxHeight=Math.min(Math.max(a-u,260),500),m=Math.min(m,f.maxHeight+u)),p>g&&(f.left+=g-p),m>v&&(f.top+=v-m),(c<8||c+f.left<8)&&p<t&&(f.left+=8-c)}return f}return{left:0,top:0,maxHeight:400}},render:function(){var e=this.state,t=this.props,a=i.default.classNames("fancyContextMenu popup c-shadow-popup",t.className,t.position,t.background,{"c-bg-menu":!t.background},{loading:t.loading},{openFromBottom:t.openFromBottom},{top:this.isAtPosition("top")},{bottom:this.isAtPosition("bottom")},{left:this.isAtPosition("left")},{right:this.isAtPosition("right")},{fill:this.isAtPosition("fill")},{full:this.isAtPosition("full")}),r={left:e.left,top:e.top,right:e.right,bottom:isNaN(t.bottom)?e.bottom:t.bottom,width:t.width,height:t.height,minWidth:t.minWidth,maxHeight:e.maxHeight||t.maxHeight,maxWidth:t.maxWidth};r=i.default.extend(r,this.props.style);var n=this.props.children;if(t.supportArrows){var s=0,l=this;n=o.a.Children.map(this.props.children,function(t){if(!t||"hr"===t.type||t.props&&!t.props.onClick)return t;if("scroller"===t.key){var a={maxHeight:400};return o.a.createElement(c.a,{style:a},o.a.Children.map(t.props.children,function(t){return o.a.cloneElement(t,{onMouseEnter:l.onChildMouseEnter,ref:"el_"+s,selected:e.selectedIndex===s++})}))}var i=t.props.onMouseEnter?function(e){l.onChildMouseEnter(e),t.props.onMouseEnter(e)}:l.onChildMouseEnter;return o.a.cloneElement(t,{onMouseEnter:i,ref:"el_"+s,selected:e.selectedIndex===s++})}),this.numItems=s}return o.a.createElement("div",{ref:"menu",id:t.id,className:a,style:r},n)}});t.a=u},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(73),a(27));function s(){this._localized=[],this._loadedDateFormat=void 0,this.init()}var o=/([\s]|^)(\d{1,2})[-/.](\d{1,2})(?:[-/.](\d{2,4}))?/g,l=/([\s]|^)(?:(\d{2,4})[-/.])?(\d{1,2})(?:[-/.](\d{1,2}))/g;window.DFormat={LongDayTime:0,ShortDayTime:1,ShortTime:2,ShortDate:3,MonthDay:4,MonthDayYear:5,LongStrDate:6,DayYearTime:7,MonthDayYearShort:8,DayMonthDateYear:9,MonthDayLong:10,MonthDayYearLong:11,DayDate:12,NoPadShortDayTime:13,MonthDayShort:14},s.prototype={init:function(){var e=i.default.settings.get(Settings.dateFormat)||r.a.DateFormat.MDY;this._loadLocalized(e),i.default.settings.registerForChangeNotification(Settings.dateFormat,void 0,function(e,t){this._loadLocalized(t||r.a.DateFormat.MDY),i.default.vmMain.root()&&(i.default.vmMain.parseSubtree(i.default.vmMain.root(),ChangeType.Auto),n.a.clearItemCache(),n.a.clearLineCache(),i.default.vmMain.updateAllItems(!1,!0))}.bind(this))},parseDate:function(e,t){return Date.parse(this.normalizeDateString(e,t))},parseDateDefaultFormat:function(e){return Date.parse(this.normalizeDateString(e,this.getCurrentDateFormat()))},getFormat:function(e){try{i.default.PAssert(856,this._localized[e],"Invalid format request")}catch(e){i.default.reportError(e)}return this._localized[e]},getCurrentDateFormat:function(){return this._loadedDateFormat||r.a.DateFormat.MDY},_loadLocalized:function(e){if(this._loadedDateFormat=e,this._localized[DFormat.LongDayTime]="dddd h:mm tt",this._localized[DFormat.ShortTime]="h:mm tt",this._localized[DFormat.MonthDay]="MMM d",this._localized[DFormat.LongStrDate]="MMMM dd, yyyy",this._localized[DFormat.DayMonthDateYear]="ddd, MMM dd, yyyy",this._localized[DFormat.MonthDayLong]="MMMM d",this._localized[DFormat.MonthDayYearLong]="MMMM d, yyyy",e===r.a.DateFormat.MDY)this._localized[DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[DFormat.ShortDate]="MM/dd",this._localized[DFormat.MonthDayYear]="MM/dd/yy",this._localized[DFormat.MonthDayYearShort]="M/d/yy",this._localized[DFormat.DayYearTime]="MM/dd/yy h:mm tt",this._localized[DFormat.DayDate]="ddd M/d",this._localized[DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[DFormat.MonthDayShort]="M/d";else if(e===r.a.DateFormat.DMY)this._localized[DFormat.ShortDayTime]="dd/MM h:mm tt",this._localized[DFormat.ShortDate]="dd/MM",this._localized[DFormat.MonthDayYear]="dd/MM/yy",this._localized[DFormat.MonthDayYearShort]="d/M/yy",this._localized[DFormat.DayYearTime]="dd/MM/yy h:mm tt",this._localized[DFormat.DayDate]="ddd d/M",this._localized[DFormat.NoPadShortDayTime]="dd/M h:mm tt",this._localized[DFormat.MonthDayShort]="d/M";else if(e===r.a.DateFormat.YMD)this._localized[DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[DFormat.ShortDate]="MM/dd",this._localized[DFormat.MonthDayYear]="yy/MM/dd",this._localized[DFormat.MonthDayYearShort]="yy/M/d",this._localized[DFormat.DayYearTime]="yy/MM/dd h:mm tt",this._localized[DFormat.DayDate]="ddd M/d",this._localized[DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[DFormat.MonthDayShort]="M/d";else try{i.default.PAssert(857,!1,"Unsupport date format requested: "+e)}catch(e){i.default.reportError(e)}},formatDate:function(e,t,a){try{i.default.PAssert(858,i.default.isDateValid(e),"Must provide a valid date to format")}catch(e){i.default.reportError(e)}try{i.default.PAssert(859,t,"Must provide a valid format for the date")}catch(e){i.default.reportError(e)}var r;if(i.default.isDateValid(e)){var n=e.toString(this.getFormat(t));r=a&&a!==this._loadedDateFormat?this.convertDateFormat(n,this._loadedDateFormat,a):n}return r},_isParsedDateValid:function(e,t,a){var r=!0,n=i.default.parseInt(e),s=i.default.parseInt(t),o=i.default.parseInt(a);return void 0!==e&&n<13?r=!1:s<=0||s>12?r=!1:(o<=0||o>31)&&(r=!1),r},_detectDelim:function(e){var t="/";return e.indexOf("-")>=0?t="-":e.indexOf(".")>=0&&(t="."),t},convertDateFormat:function(e,t,a){try{i.default.PAssert(860,t,"Must provide a date format to convert from")}catch(e){i.default.reportError(e)}try{i.default.PAssert(861,a,"Must provide a date format to convert to")}catch(e){i.default.reportError(e)}var n,s,d=e;if(t!==a)for(l.lastIndex=0,o.lastIndex=0,n=t===r.a.DateFormat.YMD?l:o;null!==(s=n.exec(d));){var c,u,h,f,p=this._detectDelim(d);if(a===r.a.DateFormat.MDY)switch(t){case r.a.DateFormat.DMY:s[4]?(u=s[4],c=(h=s[3])+p+(f=s[2])+p+u):s[2]&&s[3]&&(c=(h=s[3])+p+(f=s[2]));break;case r.a.DateFormat.YMD:s[2]?(u=s[2],c=(h=s[3])+p+(f=s[4])+p+u):s[3]&&s[4]&&(c=(h=s[3])+p+(f=s[4]));break;default:try{i.default.PAssert(862,!1,"Invalid date format requested from MDY: ",t)}catch(e){i.default.reportError(e)}}else if(a===r.a.DateFormat.DMY)switch(t){case r.a.DateFormat.MDY:s[4]?(u=s[4],h=s[2],c=(f=s[3])+p+h+p+u):s[2]&&s[3]&&(h=s[2],c=(f=s[3])+p+h);break;case r.a.DateFormat.YMD:s[2]?(u=s[2],h=s[3],c=(f=s[4])+p+h+p+u):s[3]&&s[4]&&(h=s[3],c=(f=s[4])+p+h);break;default:try{i.default.PAssert(863,!1,"Invalid date format requested from DMY: ",t)}catch(e){i.default.reportError(e)}}else if(a===r.a.DateFormat.YMD)switch(t){case r.a.DateFormat.MDY:s[4]?c=(u=s[4])+p+(h=s[2])+p+(f=s[3]):s[2]&&s[3]&&(c=(h=s[2])+p+(f=s[3]));break;case r.a.DateFormat.DMY:s[4]?c=(u=s[4])+p+(h=s[3])+p+(f=s[2]):s[2]&&s[3]&&(c=(h=s[3])+p+(f=s[2]));break;default:try{i.default.PAssert(864,!1,"Invalid date format requested from YMD: ",t)}catch(e){i.default.reportError(e)}}else try{i.default.PAssert(865,!1,"Invalid date format requested: ",a)}catch(e){i.default.reportError(e)}c&&this._isParsedDateValid(u,h,f)&&(d=d.substr(0,s.index)+s[1]+c+d.substr(s.index+s[0].length))}return d},normalizeDateString:function(e,t){var a=e,i=!1;e.startsWith(r.a.DatePrefix)&&(a=e.slice(1),i=!0);var n=this.convertDateFormat(a,t,r.a.DateFormat.MDY);return i?r.a.DatePrefix+n:n},getAppendDateText:function(e,t,a){var r,n=Date.today();r=e<n||e.getFullYear()!==n.getFullYear()?this.getFormat(DFormat.MonthDayYearShort):this.getFormat(DFormat.MonthDayShort);var s=e.toString(r);if(t instanceof Date)r=0===t.getMinutes()?" htt":" h:mmtt",s+=t.toString(r);else if(i.default.isNumber(t)){var o=Math.floor(t),l=o%12,d=i.default.pad2(60*(t-o));0===l&&(l=12),s+=" "+l+":"+d+(o>11?"pm":"am")}return isNaN(a)||(s+=" "+i.default.round(a,2)+"hr"),s}},t.a=new s},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(38);function o(){this.ErrorTimeout=i.default.seconds(30),this.NetworkTimeout=i.default.seconds(15),this.UnauthorizedTimeout=i.default.seconds(2),this._isConnecting=!1,this._isConnected=!1,this._linkedAccounts={},this._decodedIDTokens={},this.onAccountsUpdated=new s.a,this._authCBList={},this._connectedCBList=[],this._signupCBList=[],this._signupUserDataRequested=!1,this._iteratingAuthList=!1,i.default.isDemoMode()&&setTimeout(function(){var e=[GScope.UserInfoEmail,GScope.Calendar,GScope.GmailCompose,GScope.GmailModify];this.addLinkedAccount("me","Moo.do User","InvalidGID",e,{expires_in:3600,expires_at:Math.floor((Date.now()+i.default.minutes(60))/1e3),access_token:"InvalidToken",id_token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJERU1PIiwibmFtZSI6IkRlbW8gQWNjb3VudCIsImF1ZCI6IjU5Nzg0NzMzNzkzNi5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF6cCI6IjU5Nzg0NzMzNzkzNi5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImVtYWlsIjoibWUiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiaXNzIjoiYWNjb3VudHMuZ29vZ2xlLmNvbSJ9.uHbEA0ZvxneZiXwmiL9nnt3J-HYLXBbjwmpoeFkyHh8",scope:e},PrivateAPIErrorCodes.Success)}.bind(this))}o.prototype={getInfo:function(){var e={};for(var t in this._linkedAccounts){var a=this._linkedAccounts[t];if(a){var i=void 0;this.isTokenValid(a.token)&&(i={scope:a.token.scope,hasIDToken:!!a.token.id_token}),e[t]={scopes:a.scopes,gid:a.gid,error:a.serverError,validToken:this.isTokenValid(a.token),hasToken:this.hasToken(a.token),token:i}}else e[t]="UNDEFINED ACCOUNT"}return e},getDefaultAccessToken:function(){var e=this.getAccountTokenSync("me");try{i.default.PAssert(1021,e,"Must verify that a valid token is available before requesting")}catch(e){i.default.reportError(e)}return e?e.access_token:void 0},getDefaultIDToken:function(){var e=this.getAccountTokenSync("me");try{i.default.PAssert(1022,e,"Must verify that a valid token is available before requesting")}catch(e){i.default.reportError(e)}return e?e.id_token:void 0},_areEmailsEqual:function(e,t){return e&&t&&e.toUpperCase()===t.toUpperCase()},getDefaultEmail:function(){var e=this._getDecodedIDToken("me");return e?e.email:"me"},getDefaultGID:function(){var e=this._getDecodedIDToken("me");return e?e.sub:void 0},isDefaultEmail:function(e){return"me"===e||this._areEmailsEqual(e,this.getDefaultEmail())||this._areEmailsEqual(e,i.default.getActiveUser())},_generateState:function(){return"Dchs"+(new Date).getTime()},requestNoneLink:function(e,t){},requestWebLink:function(e,t,a){try{i.default.PAssert(1023,e,"Must provide a valid email to link")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1024,i.default.isArray(t),"Must always provide a valid scopes array")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1025,t.indexOf(GScope.UserInfoEmail)>=0,"Must request profile scope")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1026,!n.a.app,"Should never use web link in native app")}catch(e){i.default.reportError(e)}var r=this._generateState(),s=this._createAuthURL(e,t,r);window.open(s,"googleauth","height=600,width=550");var o=function(t){var n=i.default.getLocationOrigin(),s=!1;try{s=t.data.state===r}catch(e){i.default.reportError(e)}if(n&&s)return window.removeEventListener("message",o),t.data.code?this._handleGoogleAuthorized(e,t.data,r,a):a()}.bind(this);window.addEventListener("message",o)},requestNativeLink:function(e,t,a){try{i.default.PAssert(1027,e&&"me"!==e,"Must provide a valid email to link")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1028,i.default.isArray(t),"Must always provide a valid scopes array")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1029,t.indexOf(GScope.UserInfoEmail)>=0,"Must request profile scope")}catch(e){i.default.reportError(e)}var r=this._generateState(),n={scope:t.join(" ")+" profile",immediate:!1,offline:!0,state:r,login_hint:e,redirect_uri:this._getRedirectURL()};goog.requestNativeOAuth(n,function(t){return t.code?this._handleGoogleAuthorized(e,t,r,a):a()}.bind(this))},_getRedirectURL:function(){return window.location.protocol+"//"+window.location.host+"/oauthRelay.html"},_createAuthURL:function(e,t,a){try{i.default.PAssert(1030,i.default.isArray(t)&&t.length>0,"Must pass in a valid scopes array")}catch(e){i.default.reportError(e)}var r={scope:t.join(" ")+" profile",state:a,login_hint:e,redirect_uri:this._getRedirectURL(),response_type:"code",access_type:"offline",include_granted_scopes:!0,prompt:"consent",client_id:goog.CLIENT_ID},n=[];for(var s in r)n.push(s+"="+encodeURIComponent(r[s]));return"https://accounts.google.com/o/oauth2/v2/auth?"+n.join("&")},unlinkAccount:function(e,t,a){if(!t)return a(!0);var n={email:e,gidLinked:t};i.default.XHR_PrivateAPI({type:"POST",path:"/user/unlinkAccount",data:n,requireAuth:!0,autoRetry:!0,cb:function(e){return e.status===r.a.HTTPStatusCode.Success?a(!0):a(!1)}.bind(this)})},_handleGoogleAuthorized:function(e,t,a,n){var s={email:e,state:a,code:t.code,redir:this._getRedirectURL()};i.default.XHR_PrivateAPI({type:"POST",path:"/user/linkAccount",data:s,requireAuth:!0,autoRetry:!0,maxRetries:1,cb:function(t){if(t.status===r.a.HTTPStatusCode.Success&&t.response){var a,s;try{var o=JSON.parse(t.response).data;try{i.default.PAssert(1031,o.gidLinked,"Must receive a valid GID back from the server")}catch(e){i.default.reportError(e)}a=o.access_token;try{i.default.PAssert(1032,a&&a.id_token,"Missing valid ID token from linking account: ",a)}catch(e){i.default.reportError(e)}s=this.addLinkedAccount(e,o.gidLinked,o.name,a.scope,a,PrivateAPIErrorCodes.Success)}catch(e){i.default.reportError(e)}return n(a,s)}return n()}.bind(this)})},removeLinkedAccount:function(e,t){var a=this._getLinkedAccount(e);try{i.default.PAssert(1033,a,"Must always have linked account data when removing")}catch(e){i.default.reportError(e)}if(!a)return t(!0);this.unlinkAccount(e,a.gid,function(a){return this._deleteLinkedAccount(e),this.onAccountsUpdated.notify(),t(a)}.bind(this))},addLinkedAccount:function(e,t,a,r,n,s){try{i.default.PAssert(1034,!n||void 0===r||r.indexOf(GScope.UserInfoEmail)>=0,"Must request profile scope")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1035,!this._hasLinkedAccount(e)||void 0===this._getLinkedAccount(e).gid||this._getLinkedAccount(e).gid===t,"Google ID should never change")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1036,void 0!==s||void 0===t,"Must supply a valid error code if this is a non-temp account")}catch(e){i.default.reportError(e)}var o=this._getLinkedAccount(e);o&&this._clearRefreshTimeout(o);var l,d={lastRefreshRequested:o?o.lastRefreshRequested:0,refreshTimeout:void 0,refreshScheduleTime:0,isRequestingToken:!1,serverError:s||PrivateAPIErrorCodes.Success,scopes:r||[],gid:t,name:a};n?l=this._runDecodeIDToken(n).email:l=e;delete this._linkedAccounts[e],this._linkedAccounts[l]=d,n&&this.updateAccountToken(e,n),this.onAccountsUpdated.notify();try{if(!i.default.isDemoMode())for(var c=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail).getSyncAccounts(),u=0;u<c.length;++u)try{i.default.PAssert(1037,c[u]===l||c[u].toUpperCase()!==l.toUpperCase(),"Gmail sync account does not match linked account casing")}catch(e){i.default.reportError(e)}}catch(e){i.default.reportError(e)}return l},updateAccountToken:function(e,t){try{i.default.PAssert(1038,t,"Must provide a token when updating")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1039,this.isTokenValid(t),"Token must be valid to be updated")}catch(e){i.default.reportError(e)}var a=this._getLinkedAccount(e);if(a){a.token=t,a.serverError=PrivateAPIErrorCodes.Success;var r=1e3*(i.default.parseInt(t.expires_in)-600);i.default.isDemoMode()||this._createTokenRefresh(e,a,r),this.notifyUserAuthorized(e,t)}},_clearAccountToken:function(e,t){var a=this._getLinkedAccount(e);a&&(a.token=void 0,a.serverError=t||PrivateAPIErrorCodes.Success,this._clearRefreshTimeout(a),this.onAccountsUpdated.notify())},updateServerLinkedAccount:function(e,t,a,i,r,n){this.addLinkedAccount(e,t,a,i,r,n)},_getLinkedAccount:function(e){var t;for(var a in this._linkedAccounts)if(this._areEmailsEqual(a,e)){t=this._linkedAccounts[a];break}return t},_deleteLinkedAccount:function(e){for(var t in this._linkedAccounts)this._areEmailsEqual(t,e)&&(this._clearRefreshTimeout(this._linkedAccounts[t]),delete this._linkedAccounts[t])},_hasLinkedAccount:function(e){return!!this._getLinkedAccount(e)},getLinkedAccounts:function(){var e=[];for(var t in this._linkedAccounts)e.push(t);return e},_getDecodedIDToken:function(e){var t;return this._decodedIDTokens[e]&&(t=this._decodedIDTokens[e]),t},_decodeIDToken:function(e){var t=this.getAccountTokenSync(e);try{i.default.PAssert(1040,t,"Must always call this method when user is authorized")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1041,!t||t.id_token,"All authorized users must have a valid id token")}catch(e){i.default.reportError(e)}return this._runDecodeIDToken(t)},_runDecodeIDToken:function(e){var t;if(e&&e.id_token){var a=e.id_token,r=a.split(".");try{i.default.PAssert(1042,r&&3===r.length&&r[0]&&r[1]&&r[2],"A valid JWT should always have three parts: "+a)}catch(e){i.default.reportError(e)}try{t=JSON.parse(i.default.b64_to_utf8(r[1]))}catch(t){i.default.reportError(t,e.id_token)}}return t},getAccountGID:function(e){var t;if(this.isDefaultEmail(e)&&!i.default.isDemoMode()){var a=this._getDecodedIDToken(e);t=a&&a.sub?a.sub:i.default.vmMain.getUserID()}else if(this._hasLinkedAccount(e))t=this._getLinkedAccount(e).gid;else try{i.default.PAssert(1043,!1,"Unknown account email requested: ",e)}catch(e){i.default.reportError(e)}return t},getAccountEmail:function(e){var t;for(var a in this._linkedAccounts)if(this._linkedAccounts[a].gid===e){t=a;break}if(!t){var r=this._getDecodedIDToken("me");r&&r.email?r.sub===e&&(t=r.email):e===i.default.vmMain.getUserID()&&(t="me")}return t},getAccountName:function(e){var t;if(this.isDefaultEmail(e))t=i.default.vmMain.getUserName();else if(this._hasLinkedAccount(e)){var a=this._getLinkedAccount(e);a.name&&(t=a.name)}else try{i.default.PAssert(1044,!1,"Unknown account name requested: ",e)}catch(e){i.default.reportError(e)}return t},getAccountDomain:function(e){var t;if(this.isDefaultEmail(e)){var a=this._getDecodedIDToken(e);t=a&&a.hd?a.hd:i.default.vmMain.getAccountDomain()}return t},isAccountValidLinked:function(e){var t=!1;return this._hasLinkedAccount(e)&&(t=!!this._getLinkedAccount(e).token),t},isLinkedAccountAuthorized:function(e,t){var a=!1,i=this._getLinkedAccount(e);return i&&i.token&&(!t||i.scopes.indexOf(t)>=0)&&(a=!0),a},isAuthorized:function(e,t){try{i.default.PAssert(1045,t,"Must provide a valid scope to check authorization for")}catch(e){i.default.reportError(e)}var a=!1;if(this._hasLinkedAccount(e)||this.isDefaultEmail(e)){var r=this.getAuthorizedScopes(e);r&&r.indexOf(t)>=0&&(a=!0)}else{var n=i.default.getActiveUser(),s=goog.getAuthorizedScopes();e===n&&(!t||s.indexOf(t)>=0)&&(a=!0)}return a},isCurrentlyAuthorized:function(e){try{i.default.PAssert(1046,e,"Must provide a valid email")}catch(e){i.default.reportError(e)}var t=!1;return i.default.isDemoMode()?t=!0:this.hasValidAccessToken(e)&&(t=!0),t},_refreshToken:function(e){var t=this._getLinkedAccount(e);try{i.default.PAssert(1047,t,"Must have properly linked account before requesting a token")}catch(e){i.default.reportError(e)}t&&(this._clearRefreshTimeout(t),this._getAccountToken(e,!0,function(a,r){if(a&&!a.error)this.updateAccountToken(e,a);else{try{i.default.PAssert(1048,void 0!==r,"Missing error code on token failure")}catch(e){i.default.reportError(e)}if(this._clearAccountToken(e,r),t.serverError===PrivateAPIErrorCodes.Success){try{i.default.PAssert(1049,!t.refreshTimeout,"Should not have a refresh timeout after failure")}catch(e){i.default.reportError(e)}this._createTokenRefresh(e,t,this.ErrorTimeout)}}}.bind(this)))},_createTokenRefresh:function(e,t,a){try{i.default.PAssert(1050,a>0,"Should never schedule an immediate token refresh")}catch(e){i.default.reportError(e)}if(!t.refreshTimeout){var r=!1,n=Date.now()-t.lastRefreshRequested;t.serverError!==PrivateAPIErrorCodes.TokenMissing?r=!0:n>i.default.minutes(90)&&(r=!0),r&&(t.refreshTimeout=setTimeout(this._refreshToken.bind(this,e),a),t.lastRefreshRequested=Date.now(),t.refreshScheduleTime=t.lastRefreshRequested+a)}},_clearRefreshTimeout:function(e){clearTimeout(e.refreshTimeout),e.refreshTimeout=void 0,e.refreshScheduleTime=0},_isRefreshTimeoutValid:function(e){var t=!1;return e.refreshTimeout&&e.refreshScheduleTime>=Date.now()&&(t=!0),t},isMissingAccountToken:function(){var e=!1;for(var t in this._linkedAccounts){if(this._linkedAccounts[t].serverError===PrivateAPIErrorCodes.TokenMissing){e=!0;break}}return e},notifyUnauthorizedRequest:function(e){var t=this._getLinkedAccount(e);t?this._isRefreshTimeoutValid(t)||Date.now()-t.lastRefreshRequested>i.default.seconds(90)&&(this._clearRefreshTimeout(t),this._createTokenRefresh(e,t,this.UnauthorizedTimeout)):this.isConnected()||this.isConnecting()||i.default.billingManager.checkRemotePremiumStatus()},notifyUnauthorizedAccount:function(e,t,a){log("Unauthorized Request: ",e,t,a),this._invalidateAccountToken(e,function(e,t){e?t?log("Account Token Refreshed for Invalidation"):log("Account Token Invalidated"):log("Account Token Failed Invalidation")})},getAccountToken:function(e,t){return this._getAccountToken(e,!1,t)},_getErrorString:function(e){var t;switch(e){case PrivateAPIErrorCodes.TokenMissing:t="Authorization has been revoked.";break;case PrivateAPIErrorCodes.InvalidToken:t="There is an error with your offline authorization. Please try disabling 'Offline Features' and re-authorizing.";break;case PrivateAPIErrorCodes.DomainPolicy:t="Access denied by a security policy established by the Google Apps administrator of your organization. Please contact your administrator for further assistance.";break;default:try{i.default.PAssert(1051,!1,"Unknown error code for account authorization: "+e)}catch(e){i.default.reportError(e)}t="There was an error authorizing your account."}return t},getAccountError:function(e){var t,a=this._getLinkedAccount(e);return a?a.serverError!==PrivateAPIErrorCodes.Success&&(t=this._getErrorString(a.serverError)):t="There was an error authorizing your account.",t},_invalidateAccountToken:function(e,t,a){var n=this.getAccountGID(e);if(n&&this._getLinkedAccount(e)){var s={gid:n};this._clearAccountToken(e,PrivateAPIErrorCodes.InvalidToken),this.onUserAuthorized("me",function(){i.default.XHR_PrivateAPI({type:"POST",path:"/user/invalidateAccountToken",data:s,requireAuth:!0,autoRetry:!0,cb:function(a){if(a.status!==r.a.HTTPStatusCode.Success||!a.response)return t(!1,!1);try{var n=JSON.parse(a.response);if(n.success&&n.data){var s=n.data;return s&&!s.error?(this.updateAccountToken(e,s),t(!0,!0)):t(!0,!1)}return t(!0,!1)}catch(e){return i.default.reportError(e),t(!0,!1)}}.bind(this)})}.bind(this))}else{if(a)return t(!1,!1);i.default.billingManager.onBillingIdentifierAvailable(function(){this._invalidateAccountToken(e,t,!0)}.bind(this))}},_getAccountToken:function(e,t,a){var n=this._getLinkedAccount(e);try{i.default.PAssert(1052,n,"Must have properly linked account before requesting a token")}catch(e){i.default.reportError(e)}if(!n)return setTimeout(a,0);if(!t&&this.isTokenValid(n.token))return setTimeout(a,0,n.token,PrivateAPIErrorCodes.Success);var s=this._generateState(),o={gid:n.gid,state:s};try{i.default.PAssert(1054,n.gid,"Must have a valid GID for account")}catch(e){i.default.reportError(e)}n.isRequestingToken=!0,this.onUserAuthorized("me",function(){i.default.XHR_PrivateAPI({type:"POST",path:"/user/getAccountToken",data:o,requireAuth:!0,autoRetry:!0,cb:function(s){if(n.isRequestingToken=!1,s.response){var o;try{o=JSON.parse(s.response)}catch(e){i.default.reportError(e)}return s.status===r.a.HTTPStatusCode.Success?o&&o.success?a(o.data,PrivateAPIErrorCodes.Success):(this._clearAccountToken(e,PrivateAPIErrorCodes.TokenMissing),a(void 0,PrivateAPIErrorCodes.TokenMissing)):(this._clearAccountToken(e,o.code),a(void 0,o.code))}if(s.status===r.a.HTTPStatusCode.Success)return this._clearAccountToken(e,PrivateAPIErrorCodes.TokenMissing),a(void 0,PrivateAPIErrorCodes.TokenMissing);setTimeout(this._getAccountToken.bind(this),this.NetworkTimeout,e,t,a)}.bind(this)})}.bind(this))},_getAccountTokenRaw:function(e){var t;if(e&&this.isAccountValidLinked(e)){var a=this._getLinkedAccount(e);a&&(t=a.token)}else this.isJSAuthLibLoaded()&&this.isDefaultEmail(e)&&(t=this.getJSAuthLibToken());return t},getAccountTokenSync:function(e){try{i.default.PAssert(1056,e,"Must provide a valid email to retreive the token for")}catch(e){i.default.reportError(e)}if(this.isDefaultEmail(e)){var t=this._getAccountTokenRaw(e);try{i.default.PAssert(1057,this.isTokenValid(t)||i.default.isDemoMode(),"Must ensure token is valid before requesting sync")}catch(e){i.default.reportError(e)}return t}var a=this._getLinkedAccount(e);try{i.default.PAssert(1058,a,"Must have properly linked account before getting a token")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1059,this.isTokenValid(a.token)||i.default.isDemoMode(),"Must ensure token is valid before requesting sync")}catch(e){i.default.reportError(e)}return a.token},getAccessTokenSync:function(e){var t=this.getAccountTokenSync(e);return t?t.access_token:void 0},getAuthorizedScopes:function(e){var t;if(this.isAccountValidLinked(e))t=this._getLinkedAccount(e).scopes;else if(this.isDefaultEmail(e))try{if(this.isJSAuthLibLoaded()){var a=this.getJSAuthLibToken();if(a){t=a.scope;try{i.default.PAssert(1060,i.default.isArray(t),"Must always be a valid scopes array on auth token")}catch(e){i.default.reportError(e)}}else t=i.default.getActiveUser()===e?goog.getAuthorizedScopes().slice(0):[]}else t=i.default.getActiveUser()===e?goog.getAuthorizedScopes().slice(0):[]}catch(e){i.default.reportError(e),t=[]}else{try{i.default.PAssert(1061,this._hasLinkedAccount(e),"Unknown account email requested: ",e)}catch(e){i.default.reportError(e)}t=[]}return t},onConnected:function(e){this._isConnected?setTimeout(e,0):this._connectedCBList.push(e)},setConnected:function(){try{i.default.PAssert(1062,!this._isConnected,"Should not already be connected")}catch(e){i.default.reportError(e)}if(!this._isConnected){this._isConnected=!0;for(var e=0;e<this._connectedCBList.length;++e){var t=this._connectedCBList[e];try{t()}catch(e){i.default.reportError(e)}}}},isConnected:function(){return this._isConnected},setConnecting:function(){try{i.default.PAssert(1063,!this._isConnecting,"Should not already be connecting")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1064,!this._isConnected,"Should not already be connected")}catch(e){i.default.reportError(e)}this._isConnecting||(this._isConnecting=!0)},setNotConnecting:function(){try{i.default.PAssert(1065,this._isConnecting,"Must already be connecting to cancel")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1066,!this._isConnected,"Should not already be connected if canceling")}catch(e){i.default.reportError(e)}this._isConnecting&&(this._isConnecting=!1)},isConnecting:function(){return this._isConnecting},notifyUserAuthorized:function(e,t){try{i.default.PAssert(1067,i.default.isString(e),"Must provide a valid email addr for authorization")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1068,i.default.isObject(t),"Must provide a valid auth token")}catch(e){i.default.reportError(e)}var a=this._runDecodeIDToken(t);if(a&&a.email){try{i.default.PAssert(1069,this._areEmailsEqual(a.email,e)||"me"===e,"Emails must match id_token")}catch(e){i.default.reportError(e)}this._decodedIDTokens[a.email]=a,this.isDefaultEmail(e)&&(this._decodedIDTokens.me=a)}this._iteratingAuthList=!0;for(var r=this._authCBList[e],n=0;r&&n<r.length;++n)try{r[n]()}catch(e){i.default.reportError(e)}this._authCBList[e]=[],this._iteratingAuthList=!1;try{i.default.PAssert(1070,i.default.isDemoMode()||i.default.vmMain&&i.default.vmMain.pluginManager,"Must have initialized plugin manager before users are authorized")}catch(e){i.default.reportError(e)}i.default.vmMain&&i.default.vmMain.pluginManager&&(i.default.vmMain.pluginManager.notifyAuthorizationAdded(e),this.isDefaultEmail(e)&&i.default.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.GoogleLogin,t.scope))},onUserAuthorized:function(e,t,a){try{i.default.PAssert(1071,!this._iteratingAuthList,"Should not queue additional authorizations while iterating")}catch(e){i.default.reportError(e)}this.isCurrentlyAuthorized(e)?setTimeout(t,0):(this._authCBList[e]||(this._authCBList[e]=[]),this._authCBList[e].push(t),a&&setTimeout(function(){this._authCBList[e].remove(t)>=0&&t()}.bind(this),a))},notifyRemoteAccountsLinked:function(){i.default.vmMain.pluginManager.verifyAuthorization(this.getDefaultEmail())},verifyLinkedTokenScopes:function(e,t){var a=[];if(t)if(this._hasLinkedAccount(e)){var i=this._getLinkedAccount(e);if(i.token&&i.token.scope)for(var r=0;r<t.length;++r)i.token.scope.indexOf(t[r])<0&&a.push(t[r]);else a=t.slice(0)}else if(this.isConnected()&&this.isDefaultEmail(e)&&this.isJSAuthLibLoaded()){var n=this.getJSAuthLibToken();if(n&&n.scope)for(r=0;r<t.length;++r)n.scope.indexOf(t[r])<0&&a.push(t[r]);else a.pushArray(t)}return a},isTokenValid:function(e){try{i.default.PAssert(1072,!e||!i.default.isString(e),"Must supply a valid token object to check if valid")}catch(e){i.default.reportError(e)}var t=!1;if(e&&e.expires_at){var a=1e3*i.default.parseInt(e.expires_at),r=Date.now()+i.default.minutes(5);try{var n=new Date(a),s=(new Date).addHours(5);try{i.default.PAssert(1073,n.isBefore(s),"Token lease must be under five hours: ",e.expires_at)}catch(e){i.default.reportError(e)}}catch(e){i.default.reportError(e)}a>r&&(t=!0)}return t},hasToken:function(e){return!!e},hasValidAccessToken:function(e){var t=!1;try{i.default.PAssert(1074,i.default.isString(e),"Must supply a valid email to check access token")}catch(e){i.default.reportError(e)}var a=this._getAccountTokenRaw(e);return a&&this.isTokenValid(a)&&(t=!0),t},getSignupUserData:function(e){this._signupCBList.push(e),this._signupUserDataRequested||(this._signupUserDataRequested=!0,i.default.XHR({type:"GET",url:"https://www.googleapis.com/oauth2/v2/userinfo?alt=json&access_token="+this.getDefaultAccessToken(),autoRetry:!0,cb:function(e){if(this._signupUserDataRequested=!1,200===e.status){var t={};try{t=JSON.parse(e.responseText)}catch(t){i.default.reportError(new Error("Error parsing user info"),e.responseText)}for(var a=0;a<this._signupCBList.length;++a)this._signupCBList[a](t);this._signupCBList=[]}}.bind(this)}))},getJSAuthLibToken:function(){var e;return this.isJSAuthLibLoaded()&&(e=window.gapi.auth.getToken()),e},isJSAuthLibLoaded:function(){return!!(window.gapi&&window.gapi.auth&&window.gapi.auth.authorize)},canRunAuthenticate:function(){return this.isJSAuthLibLoaded()||n.a.isFeatureEnabled(r.a.Feature.OAuth)}},t.a=new o},function(e,t,a){"use strict";var i=a(7),r=a(0),n=a(5),s=a(1),o=a(39),l=a(17),d=a(4),c=a(51),u=a(11),h=(a(9),a(14));t.a=new function(){var e={CLIENT_ID:"597847337936.apps.googleusercontent.com",eventSubscribers:[]};r.default.goog=e;var t=1e4,a=10485760,f=.85,p=.95;e.APP_ID="597847337936",e.REALTIME_MIMETYPE="application/vnd.google-apps.drive-sdk",e.FOLDER_MIMETYPE="application/vnd.google-apps.folder",e.MoodoMimetype=e.REALTIME_MIMETYPE+"."+e.APP_ID,window.GScope={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.googleapis.com/auth/contacts.readonly",Drive:"https://www.googleapis.com/auth/drive.file",UserInfoEmail:"https://www.googleapis.com/auth/userinfo.email",DriveFull:"https://www.googleapis.com/auth/drive",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoProfile:"https://www.googleapis.com/auth/userinfo.profile",DriveInstall:"https://www.googleapis.com/auth/drive.install",DriveAppData:"https://www.googleapis.com/auth/drive.appdata",DriveMetadataRO:"https://www.googleapis.com/auth/drive.metadata.readonly",GmailRO:"https://www.googleapis.com/auth/gmail.readonly",GmailCompose:"https://www.googleapis.com/auth/gmail.compose",GmailModify:"https://www.googleapis.com/auth/gmail.modify"};var m=[GScope.TasksRO],g=[GScope.UserInfoProfile,GScope.GmailRO],v=["https://www.googleapis.com/auth/plus.me","https://www.googleapis.com/auth/contacts",GScope.TasksRO,"email","openid","profile"],y={};y[GScope.CalendarRO]=GScope.Calendar,y[GScope.Drive]=GScope.DriveFull,y[GScope.DriveMetadataRO]=GScope.DriveFull,e.LEGACY_DefaultDriveDocTitle="DuchessBeta",e.DefaultDocTitle="My Tasks",e.DefaultFolderTitle="_Moo.do Files (Do not delete)",e.DefaultAttachTitle="Shared Attachments",e.DefaultProperty="MooDoDefault",e.DefaultPropertyValue="TRUE",e.DefaultRootFolderProperty="MooDoDefaultRoot",e.DefaultRootFolderPropertyValue="TRUE",e.DefaultAttachFolderProperty="MooDoDefaultAttach",e.DefaultAttachFolderPropertyValue="TRUE",e.DocFolderTitlePrefix="Moodo_",e.DocFolderProperty="MooDoFolder",e.DocFolderPropertyPrefix="MDSF_",e.DocFolderTitleProperty="MooDoTitle",e.requiredScopes=[GScope.Drive,GScope.UserInfoEmail,GScope.DriveInstall,GScope.DriveAppData],e.requestScopes=[],e.scopes=[GScope.Calendar,GScope.CalendarRO,GScope.Contacts,GScope.Drive,GScope.UserInfoEmail,GScope.DriveFull,GScope.UserInfoProfile,GScope.DriveInstall,GScope.DriveAppData,GScope.DriveMetadataRO,GScope.GmailRO,GScope.GmailModify,GScope.GmailCompose];var S=[];e.getAuthorizedScopes=function(){return S};e.isLoaded=!1,e.init=function(){h.a.isJSAuthLibLoaded()?e.addOAuthMethod(OAuthSchemeType.Web):window.addEventListener("gapiLoaded",function(){e.addOAuthMethod(OAuthSchemeType.Web)});var t=r.default.settings.get(Settings.oauthScheme);if(void 0!==t&&t!=OAuthSchemeType.Web)try{var a=r.default.parseInt(t);e.addOAuthMethod(a)}catch(e){r.default.reportError(e)}ee();var i=r.default.settings.get(Settings.authScopes);if(i){var s;try{s=JSON.parse(i)}catch(e){r.default.reportError(e)}if(s){for(var o=0;o<s.length;++o){try{r.default.PAssert(429,s[o]>=0,"Each saved scope should be a valid array index")}catch(e){r.default.reportError(e)}s[o]>=0&&e.requestScopes.push(e.scopes[s[o]])}e.requestScopes=r.default.arrayUniques(e.requestScopes)}}else e.requestScopes=e.requiredScopes;S=e.requestScopes,d.a.syncContacts&&n.a.getURLParam("access_token")&&!n.a.hasURLParam("error")&&(S.indexOf(GScope.Contacts)<0&&(S.push(GScope.Contacts),V()),r.default.settings.set(Settings.syncContacts,!0)),r.default.settings.registerForChangeNotification(Settings.syncContacts,void 0,function(t,a){a&&e.authAndLoadContacts(!1,function(e){r.default.settings.set(Settings.syncContacts,e)})}),h.a.onUserAuthorized("me",function(){window.ga&&ga("set","&uid",r.default.getAnonUserIdentifier())})},e.ensureRequiredScopesAreRequested=function(){for(var t=!1,a=0;a<e.requiredScopes.length;++a)if(S.indexOf(e.requiredScopes[a])<0){t=!0;break}t&&e.runAuthenticate(e.requiredScopes,!0,!1,function(t){!t||t.error?r.default.toasts.pushMessage({text:"We need additional permissions to give you the best experience.",actionText:"AUTHORIZE",action:function(){e.runAuthenticate(e.requiredScopes,!1,!1,function(t){t&&!t.error||r.default.toasts.pushMessage({text:"There was an error authenticating. Please try again.",actionText:"AUTHORIZE",action:e.ensureRequiredScopesAreRequested})})}}):V()})};var E;e.startWatchdog=function(){E||(E=setInterval(e.watchdogFn,96e4))},e.stopWatchdog=function(){clearInterval(E),E=void 0};var P,b,C=0;e.watchdogFn=function(){var e=Date.now();if(C-e>=96e4){try{var t=h.a.getJSAuthLibToken();if(t){var a=1e3*parseInt(t.expires_at);e>a?(ShouldLog(LogLevels.Error)&&log("Active token is no longer valid: "+e+" vs. "+a),se(),r.default.reportError(new Error("Watchdog found expired token on client"))):l.a.poke()}else ShouldLog(LogLevels.Error)&&log("No active token on client!"),se(),r.default.reportError(new Error("Watchdog found client with no token set"))}catch(e){r.default.reportError(e)}finally{C=e}r.default.checkForRemoteChanges()}},e.hasPermission=function(e){return S.indexOf(e)>-1};var D,I,A=!0;function M(e){if(e){var t=e.error;t.code===s.a.HTTPStatusCode.Forbidden?r.default.toasts.pushMessage({text:"Google Drive Error: "+t.message+".",action:MessageAction.OpenURL,actionText:"LEARN MORE",data:{url:"https://support.google.com/drive/answer/2500820"}}):r.default.toasts.pushMessage({text:t.message+". Please reload to try again.",action:MessageAction.Reload}),r.default.reportError(new Error("Failed to find default doc: "+e.error.code),e)}else r.default.toasts.pushMessage({text:"There was an internal error in Google Drive. Please reload to try again.",action:MessageAction.Reload});r.default.vmMain.setGDriveStatus(DriveStatus.Offline)}function _(e){log("First Run Drive Document"),T(e),l.a.onFirstInitialized(e),h.a.getSignupUserData(function(e){r.default.reportSignup(e.email,e)})}function T(e){log("Drive Document Initialized"),l.a.onInitialized(e),h.a.onUserAuthorized("me",function(){r.default.sendEvent("Documents","CreateNew")})}function w(t){if(ShouldLog(LogLevels.Timing)&&log("Drive document load started: ",log.now()),r.default.checkpoint(Checkpoint.DocLoaded),r.default.vmMain.setGDriveStatus(DriveStatus.Saved),l.a.onLoad(t)){if(ShouldLog(LogLevels.Timing)&&log("Drive document load done: ",log.now()),e.startWatchdog(),!t.getModel().getRoot().get("docFolderID")){var i=r.default.vmMain.docManager.getOpenDoc();try{r.default.PAssert(456,i,"Must have an open doc to load a realtime doc")}catch(e){r.default.reportError(e)}i.getDocumentFolder(function(e){t.getModel().getRoot().set("docFolderID",e)})}t.getModel().getRoot().get("attachFolderID")||e.getAttachFolder(function(e){t.getModel().getRoot().set("attachFolderID",e)}),t.getModel().bytesUsed>=a*f?r.default.menus.alert({text:"Your document is nearing our maximum size. Consider starting a new document.",actionText:"OKAY"}):t.getModel().bytesUsed>=a*p&&r.default.menus.alert({text:"Your document has reached our maximum allowed size. You must create a new document to continue editing.",actionText:"OKAY"}),e.isLoaded=!0,r.default.vmMain.notifySuccessfulLoad(),r.default.fireCustomEvent("docLoaded")}}function k(t){switch(ShouldLog(LogLevels.Error)&&log("Doc Load Error - ",JSON.stringify(t)),t.type){case gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED:try{r.default.PAssert(457,!t.isFatal,"Token refresh required causes a non-fatal error")}catch(e){r.default.reportError(e)}e.recoverFromError();break;case gapi.drive.realtime.ErrorType.INVALID_COMPOUND_OPERATION:try{r.default.PAssert(458,t.isFatal,"Invalid compound operation causes a fatal error")}catch(e){r.default.reportError(e)}ShouldLog(LogLevels.Error)&&log("RealtimeAPI Error: ["+t.type+"] Fatal: "+t.isFatal),r.default.reportError(new Error("Invalid Compound Operation: "+r.default.safeStringify(t)));break;case gapi.drive.realtime.ErrorType.CONCURRENT_CREATION:case gapi.drive.realtime.ErrorType.CLIENT_ERROR:ShouldLog(LogLevels.Error)&&log("RealtimeAPI Error: ["+t.type+"] Fatal: "+t.isFatal),r.default.reportError(new Error("Client Error: "+r.default.safeStringify(t))),e.clearDocInfo(),O();break;case gapi.drive.realtime.ErrorType.FORBIDDEN:ShouldLog(LogLevels.Error)&&log("Unable to access or find the requested document"),(a=r.default.decodeURLObject(n.a.getURLParam("sinfo")))&&a.fromUser?r.default.menus.alert({text:"Moo.do is not able to access the document you requested. Please contact "+a.fromUser+" to make sure you have permission to view the document.",actionText:"RELOAD",callback:i.a.clearDataAndReload}):r.default.menus.alert({text:"Moo.do has lost access to your document. If the problem persists, please contact support@moo.do.",actionText:"RELOAD",callback:i.a.clearDataAndReload}),r.default.reportError(new Error("DocError Forbidden"),a),r.default.vmMain.notifyFailedLoad();break;case gapi.drive.realtime.ErrorType.NOT_FOUND:var a;ShouldLog(LogLevels.Error)&&log("Unable to access or find the requested document"),(a=r.default.decodeURLObject(n.a.getURLParam("sinfo")))&&a.fromUser?r.default.menus.alert({text:"Moo.do cannot find your document. Please contact "+a.fromUser+" to ensure the document still exists.",actionText:"RELOAD",callback:i.a.clearDataAndReload}):r.default.menus.alert({text:"Moo.do cannot find your document. If the problem persists, please contact support@moo.do.",actionText:"RELOAD",callback:i.a.clearDataAndReload}),r.default.reportError(new Error("DocError NotFound"),a),r.default.vmMain.notifyFailedLoad();break;case gapi.drive.realtime.ErrorType.SERVER_ERROR:ShouldLog(LogLevels.Error)&&log("Received server error: "+r.default.safeStringify(t)),t.isFatal&&(r.default.reportError(new Error("Fatal Server Error"),t),r.default.vmMain.setGDriveStatus(DriveStatus.Offline));break;case"fatal_network_error":ShouldLog(LogLevels.Error)&&log("Fatal network error: "+r.default.safeStringify(t)),t.isFatal&&r.default.vmMain.setGDriveStatus(DriveStatus.Offline);break;default:ShouldLog(LogLevels.Error)&&log("Unkown Doc Error - "+r.default.safeStringify(t)),r.default.reportError(new Error("Unknown Doc Error: "+r.default.safeStringify(t)))}return t.isFatal}e.onFocusHandler=function(){b&&Date.now()>b&&!A&&se()},e.onBlurHandler=function(){P&&clearTimeout(P)},e.getContactInfo=function(e,t){var a=h.a.getAccessTokenSync(e);if(a){var n="https://www.google.com/m8/feeds/contacts/default/full?v=3.0&alt=json",s=r.default.settings.get(Settings.lastContactSync),o=i.a.areLocalContactsLoaded()&&0===i.a.contactManager.numContacts();s&&!o&&(n+="&updated-min="+new Date(s).toString("yyyy-MM-ddTHH:mm:ss")),n+="&max-results=10000",n+="&access_token="+a,r.default.JSONP({url:n,cb:function(e){if(e)try{r.default.settings.set(Settings.lastContactSync,new Date(e.feed.updated.$t))}catch(e){r.default.reportError(e)}t(e)}})}else t(void 0)},e.loadedContacts=!1,e.loadContacts=function(t){if(e.loadedContacts)t(0);else{e.loadedContacts=!0,i.a.loadLocalContacts();var a=i.a.contactManager.numContacts(),n=r.default.vmMain.getUserEmail();h.a.onUserAuthorized(n,function(){e.getContactInfo(n,function(e){if(e){log("Loading Remote Contacts!",parseInt(e.feed.openSearch$totalResults.$t));var r=0;if(e&&e.feed&&e.feed.entry&&e.feed.entry.length){r=e.feed.entry.length;for(var n=e.feed.entry,s=0;s<n.length;s++){var o=n[s],l={id:/\/([^\s\/]+$)/gi.exec(o.id.$t)[1],text:""};if(o.gd$name&&o.gd$name.gd$fullName){var d=o.gd$name.gd$fullName.$t;l.text=d,"'"===l.text[0]&&(l.text=l.text.substr(1))}if(o.gd$email){for(var c=o.gd$email,u=0;u<c.length;u++)delete c[u].rel,!l.text&&c[u].primary&&(l.text=c[u].address);!l.text&&c.length>0&&(l.text=c[0].address),l.emails=c}if(o.gd$phoneNumber){var h=o.gd$phoneNumber;for(l.phoneNumbers=[],u=0;u<h.length;u++){var f={number:h[u].$t};h[u].rel?f.type=h[u].rel.replace("http://schemas.google.com/g/2005#",""):f.type=h[u].label,l.phoneNumbers.push(f)}}l.text&&(0===a?i.a.contactManager.addContact(l):i.a.contactManager.updateContact(l))}}r>0&&i.a.saveContacts(),t&&t(r)}else t(-1)})})}},e.setDocInfo=function(e,t){r.default.settings.set(Settings.gdocId,e),r.default.settings.set(Settings.gdocTitle,t)},e.getDocId=function(){return r.default.vmMain.docManager.getOpenDoc().id},e.clearDocInfo=function(){r.default.settings.reset(Settings.gdocId),r.default.settings.reset(Settings.gdocTitle)},e.getAttachFolder=function(t){try{r.default.PAssert(432,!r.default.isDemoMode(),"Should not be creating file structure in demo mode")}catch(e){r.default.reportError(e)}try{r.default.PAssert(433,t,"Must provide a valid callback when getting the root folder")}catch(e){r.default.reportError(e)}function a(){if(I)t(I);else{var a=r.default.settings.get(Settings.attachFolderId);function i(){!function(t){try{r.default.PAssert(441,!r.default.isDemoMode(),"Should not be creating attach folder in demo mode")}catch(e){r.default.reportError(e)}try{r.default.PAssert(442,D,"Must have already created and found the root folder")}catch(e){r.default.reportError(e)}try{r.default.PAssert(443,void 0===I,"Must not already have an attach folder")}catch(e){r.default.reportError(e)}try{r.default.PAssert(444,t,"Must supply a valid callback when done creating the attachment file structure")}catch(e){r.default.reportError(e)}var a=o.a.fns("drive").files.insert.packedFn,i={resource:{mimeType:e.FOLDER_MIMETYPE,title:e.DefaultAttachTitle,writersCanShare:!1,folderColorRgb:"#FF7537",parents:[{id:D}],properties:[{key:e.DefaultAttachFolderProperty,value:e.DefaultAttachFolderPropertyValue,visibility:"PRIVATE"}]}};r.default.vmMain.remoteAPI().runRemoteSingleRequest(a,i,function(e){return t(e.id)},function(e){return t()})}(function(e){return e?(I=e,r.default.settings.set(Settings.attachFolderId,I),t(I)):t()})}if(a){var n=function(e){if(e)return I=a,t(a);i()},s=function(e){if(r.default.settings.set(Settings.attachFolderId,void 0),!e||!e.error||404!==e.error.code)return t();i()};r.default.vmMain.remoteAPI().driveFilesGet(a,n,s)}else{var l="properties has {key='"+e.DefaultAttachFolderProperty+"' and value='"+e.DefaultAttachFolderPropertyValue+"' and visibility='PRIVATE'} and 'me' in owners and trashed=false";n=function(e){if(e.length>0){try{r.default.PAssert(434,1===e.length,"Must have a single root folder present")}catch(e){r.default.reportError(e)}var a=e[0];return I=a.id,r.default.settings.set(Settings.attachFolderId,I),t(a.id)}i()},s=function(e){return t()},r.default.vmMain.remoteAPI().driveFilesList(l,n,s,{getAllPages:!0})}}}D?a():e.getRootFolder(a)},e.getRootFolder=function(t){try{r.default.PAssert(435,!r.default.isDemoMode(),"Should not be creating file structure in demo mode")}catch(e){r.default.reportError(e)}try{r.default.PAssert(436,t,"Must provide a valid callback when getting the root folder")}catch(e){r.default.reportError(e)}if(D)return t(D);{var a=r.default.settings.get(Settings.rootFolderId);function i(){!function(t){try{r.default.PAssert(438,!r.default.isDemoMode(),"Should not be creating file structure in demo mode")}catch(e){r.default.reportError(e)}try{r.default.PAssert(439,void 0===D,"Must not already have a root folder")}catch(e){r.default.reportError(e)}try{r.default.PAssert(440,t,"Must supply a valid callback when done creating the default file structure")}catch(e){r.default.reportError(e)}var a=o.a.fns("drive").files.insert.packedFn,i={resource:{mimeType:e.FOLDER_MIMETYPE,title:e.DefaultFolderTitle,writersCanShare:!1,folderColorRgb:"#FF7537",properties:[{key:e.DefaultRootFolderProperty,value:e.DefaultRootFolderPropertyValue,visibility:"PRIVATE"}]}};r.default.vmMain.remoteAPI().runRemoteSingleRequest(a,i,function(e){return t(e.id)},function(e){return t()})}(function(e){return e?(D=e,r.default.settings.set(Settings.rootFolderId,D),t(D)):t()})}if(a){var n=function(e){if(e)return D=a,t(a);i()},s=function(e){if(r.default.settings.set(Settings.rootFolderId,void 0),!e||!e.error||404!==e.error.code)return t();i()};r.default.vmMain.remoteAPI().driveFilesGet(a,n,s)}else{var l="properties has {key='"+e.DefaultRootFolderProperty+"' and value='"+e.DefaultRootFolderPropertyValue+"' and visibility='PRIVATE'} and 'me' in owners and trashed=false";n=function(e){if(e.length>0){try{r.default.PAssert(437,1===e.length,"Must have a single root folder present")}catch(e){r.default.reportError(e)}var a=e[0];return D=a.id,r.default.settings.set(Settings.rootFolderId,D),t(a.id)}i()},s=function(e){return t()},r.default.vmMain.remoteAPI().driveFilesList(l,n,s,{getAllPages:!0})}}},e.createDefaultRealtimeFile=function(){var t=r.default.vmMain.docManager.createNewDoc();e.createAndSetupDocument(t,!0,function(a){if(!a||a.error)M();else{r.default.vmMain.docManager.setDoc(t);var i=n.a.getURLParam("file");if(i)try{try{r.default.PAssert(448,gapi.drive,"gapi.drive should exist")}catch(e){r.default.reportError(e)}n.a.removeURLParam("file"),r.default.vmMain.docManager.loadDocFromData({id:i},!1).open(),e.setDocInfo(i,void 0),l.a.driveRealtimeLoad(i,w,T,k);try{window.__LOAD_REQUESTS.push(r.default.getCurrentStack("File Request After Default Load"))}catch(e){r.default.reportError(e)}}catch(e){r.default.reportError(e)}else e.onDefaultRealtimeFileOpened(a,!0)}})},e.createAndSetupDocument=function(t,a,i){try{r.default.PAssert(449,i,"Must pass in a valid creation callback")}catch(e){r.default.reportError(e)}e.getRootFolder(function(n){var s;a&&(s=[{key:e.DefaultProperty,value:e.DefaultPropertyValue,visibility:"PRIVATE"}]);var l=o.a.fns("drive").files.insert.packedFn,d={fields:"createdDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,userPermission(id,role,type)",resource:{mimeType:e.REALTIME_MIMETYPE,title:t.getTitle()||e.DefaultDocTitle,writersCanShare:!1,parents:[{id:n}],properties:s}};r.default.vmMain.remoteAPI().runRemoteSingleRequest(l,d,function(e){t.updateData(e),t.createDocumentFileStructure(function(t){return i(e)})},function(e){return i(void 0)})})};var x=t;function L(t,a,i){if(t){ShouldLog(LogLevels.Timing)&&log("Drive document requested: ",log.now()),r.default.vmMain.docManager.loadDocFromData({id:t,title:a},!1).open(),e.setDocInfo(t,a);try{var n=i?_:T;l.a.driveRealtimeLoad(t,w,n,k);try{window.__LOAD_REQUESTS.push(r.default.getCurrentStack("Normal Load ["+i+"]"))}catch(e){r.default.reportError(e)}}catch(t){e.recoverFromError(t)}}else O()}function O(){!function(){r.default.vmMain.setGDriveStatus(DriveStatus.Connecting);var t="(title='"+e.LEGACY_DefaultDriveDocTitle+"' or properties has {key='"+e.DefaultProperty+"' and value='"+e.DefaultPropertyValue+"' and visibility='PRIVATE'}) and 'me' in owners and trashed=false";function a(){var t=r.default.vmMain.docManager;t.loadDocList(function(a,i){if(a){var n=t.getAutoDefaultDoc();n?e.onDefaultRealtimeFileOpened(n.getData(),!1):t.hasTrashedDocuments()?r.default.vmMain.showTrashedDocumentError():e.createDefaultRealtimeFile()}else M(i)})}r.default.vmMain.remoteAPI().driveFilesList(t,function(t){0===t.length?r.default.vmMain&&r.default.vmMain.docManager?a():u.a.listen("VMMainLoaded",a):e.onDefaultRealtimeFileOpened(t[0],!1)},function(e){M(e)},{getAllPages:!0,maxResults:1})}()}e.recoverFromError=function(t){t&&(ShouldLog(LogLevels.Error)&&log("GDrive Error: ",t),r.default.reportError(t)),r.default.vmMain.setGDriveStatus(DriveStatus.Connecting),se(function(t){if(!t||t.error){r.default.toasts.pushMessage(MessageID.ConnectionError),r.default.vmMain.setGDriveStatus(DriveStatus.Offline);var a="Unable to refresh authentication token - ",i=!0;t?(a+=t.error,"immediate_failed"===t.error&&(i=!1)):a+="No Token",i?r.default.reportError(new Error(a)):ShouldLog(LogLevels.Error)&&log("Refresh Auth Failed: ",a),x<16e4&&(setTimeout(e.recoverFromError,x),x*=2)}})},e.onDefaultRealtimeFileOpened=function(e,t){e&&e.id?L(e.id,e.title,t):r.default.reportError(new Error("We should always find a valid document with a defined id"))};var R=!1;e.loadClientDefaultFile=function(){var t=s.a.DocLoadSkipReason.None,a=!!r.default.vmMain,n=e.isRealtimeAPILoaded();if(R)t=s.a.DocLoadSkipReason.Already;else if(a)if(n)if(h.a.isCurrentlyAuthorized("me"))if(r.default.getLoginState()==LoginState.LOGGED_IN){r.default.checkpoint(Checkpoint.LoadDefaultFile),R=!0,ShouldLog(LogLevels.Timing)&&log("Loading Default Client File: ",log.now()),r.default.vmMain.setGDriveStatus(DriveStatus.Connecting);var o=h.a.getDefaultEmail(),l=r.default.getActiveUser();l&&o&&o!==l?i.a.clearData(function(){r.default.reload()}):!l&&o&&r.default.setActiveUser(o),L(r.default.settings.get(Settings.gdocId),r.default.settings.get(Settings.gdocTitle),!1),e.authAndLoadContacts(!1)}else t=s.a.DocLoadSkipReason.LoginState;else t=s.a.DocLoadSkipReason.NotAuth;else t=s.a.DocLoadSkipReason.Drive;else t=s.a.DocLoadSkipReason.Main;return t},e.reconnectToActiveDocument=function(){var t=!!r.default.vmMain,a=e.isRealtimeAPILoaded(),i=r.default.getLoginState()==LoginState.LOGGED_IN,n=h.a.getDefaultAccessToken();try{r.default.PAssert(459,!l.a.isConnected(),"Should not try to reconnect if gdata is still connected")}catch(e){r.default.reportError(e)}t&&a&&i&&n&&!l.a.isConnected()&&!r.default.vmMain.isReconnecting()&&(r.default.vmMain.setGDriveStatus(DriveStatus.Reconnecting),r.default.isReconnected=!0,L(r.default.settings.get(Settings.gdocId),r.default.settings.get(Settings.gdocTitle),!1))},e.deleteAppDataFiles=function(e){r.default.vmMain.remoteAPI().driveFilesList("'appfolder' in parents",function(t){for(var a=o.a.createBatch(),i=0,r=0;r<t.length;++r){var n=o.a.createRequest("me",o.a.fns("drive").files.trash.packedFn,{fileId:t[r].id});a.add(n,"default",t[r].id),i++}i>0?a.then(function(t){e(!0)},function(){e(!1)}):e(!0)},function(t,a){e(!1)},{getAllPages:!0})},e.deleteAllFiles=function(t,a){for(var i=o.a.createBatch(),r=0,n=0;n<t.length;++n)if(t[n].hasDriveBacking()){var s=t[n].getData();if(s.userPermission&&"owner"===s.userPermission.role){var l=o.a.createRequest("me",o.a.fns("drive").files.trash.packedFn,{fileId:t[n].id});i.add(l,"default",t[n].id),r++}}r>0?i.then(function(t){e.deleteAppDataFiles(a)},function(){a(!1)}):e.deleteAppDataFiles(a)},e.DeleteErrorCode={None:0,RootFolder:1,UnlinkFailure:2,UnlinkException:3,MissingFolders:4,FolderException:5,MissingRoot:6},e.deleteAccount=function(t){e._deleteAccount(t)};var N,F=1500;function U(e,t){if(0===e.length)return t(!0);!function a(i){e[i].then(function(r){e.length>i+1?setTimeout(function(){a(i+1)},F):t(!0)},function(){t(!1)})}(0)}function B(e,t){r.default.vmMain.remoteAPI().driveChildrenList(e,function(a){try{if(a.length>0){for(var i=o.a.createBatch(),n=0;n<a.length;++n){var s=o.a.createRequest("me",o.a.fns("drive").children.delete.packedFn,{folderId:e,childId:a[n].id});i.add(s,"default",a[n].id)}t(i)}else t(void 0)}catch(e){r.default.reportError(e),t(void 0)}},function(e,a){t(void 0)},{getAllPages:!0,maxPageResults:500})}function V(){for(var t=[],a=0;a<S.length;++a){var i=e.scopes.indexOf(S[a]),n=m.indexOf(S[a])>=0;i>=0&&!n&&t.push(i)}var s=JSON.stringify(t);r.default.settings.set(Settings.authScopes,s)}function H(e){e>0&&r.default.vmMain.updateAllItems(!1,!0)}function q(){return""+Math.floor((Date.now()-r.default.minutes(1))/1e3)}function G(e,t){return""+Math.floor(r.default.parseInt(t)+1e3*r.default.parseInt(e)/1e3)}function z(e){try{r.default.PAssert(470,h.a.isJSAuthLibLoaded(),"Auth lib must be loaded to set token")}catch(e){r.default.reportError(e)}try{r.default.PAssert(471,e.id_token,"Token must provide a valid id_token value",e)}catch(e){r.default.reportError(e)}try{r.default.PAssert(472,e.access_token,"Token must provide a valid access_token value",e)}catch(e){r.default.reportError(e)}try{r.default.PAssert(473,e.expires_in||e.expires_at,"Token must provide a valid expires_in value",e)}catch(e){r.default.reportError(e)}e.issued_at||(e.issued_at=q()),e.expires_in?e.expires_at||(e.expires_at=G()):e.expires_in=parseInt(e.expires_at)-parseInt(e.issued_at),window.gapi.auth.setToken(e)}function W(){try{r.default.PAssert(474,void 0!==N,"Should always have a valid token value")}catch(e){r.default.reportError(e)}r.default.isString(N.scope)&&(N.scope=N.scope.split(" ")),z(N)}e._deleteAccount=function(t){var a=0,i=0,n=[];e.getRootFolder(function(s){function o(t){r.default.vmMain.remoteAPI().driveFilesTrash(s,function(){t(!0,e.DeleteErrorCode.None)},function(){t(!1,e.DeleteErrorCode.RootFolder)})}if(s){var l="'"+s+"' in parents";r.default.vmMain.remoteAPI().driveFilesList(l,function(s){try{if((i=s.length)>0)for(var l=0;l<s.length;++l){var d=s[l];"owner"===d.userPermission.role?B(d.id,function(s){s&&n.push(s),++a===i&&U(n,function(a){try{a?o(t):t(!1,e.DeleteErrorCode.UnlinkFailure)}catch(a){r.default.reportError(a),t(!1,e.DeleteErrorCode.UnlinkException)}})}):i--}else o(t)}catch(a){r.default.reportError(a),t(!1,e.DeleteErrorCode.FolderException)}},function(a,i){t(!1,e.DeleteErrorCode.MissingFolders)},{getAllPages:!0,maxPageResults:999})}else t(!1,e.DeleteErrorCode.MissingRoot)})},e.authAndLoadContacts=function(t,a){h.a.onConnected(function(){e._authAndLoadContacts(t,a)})},e._authAndLoadContacts=function(t,a){if(r.default.settings.get(Settings.syncContacts)){var i=r.default.vmMain.getUserEmail();h.a.isAuthorized(i,GScope.Contacts)?e.loadContacts(function(e){H(e),a&&a(e>=0)}):e.runAuthenticate([GScope.Contacts],!0,t,function(t){!t||t.error?(r.default.toasts.pushMessage(MessageID.LostPermission),h.a.notifyUnauthorizedAccount(i,[GScope.Contacts],t?t.error:"Missing token"),r.default.settings.set(Settings.syncContacts,!1),a&&a(!1)):e.loadContacts(function(e){H(e),a&&a(e>0)})})}},e.refreshContacts=function(t){return i.a.clearLocalContacts(),e.loadedContacts=!1,!!r.default.settings.get(Settings.syncContacts)&&(e.authAndLoadContacts(!0,function(e){t&&t()}.bind(this)),!0)},window.__LOAD_HANDLES=new c.a(5),window.__LOAD_REQUESTS=new c.a(5),e.checkTokenInHash=function(){var e=!1;if(n.a.hasURLParam("access_token"))try{var t,a=n.a.getURLParam("scope");a&&(t=a.split("+"));var i=n.a.hasURLParam("issued_at")?n.a.getURLParam("issued_at"):q(),s=n.a.getURLParam("expires_in"),o=n.a.hasURLParam("expires_at")?n.a.getURLParam("expires_at"):G(s,i),l={access_token:n.a.getURLParam("access_token"),id_token:n.a.getURLParam("id_token"),issued_at:i,expires_in:s,expires_at:o,scope:t,token_type:n.a.getURLParam("token_type")};z(l),e=!0,n.a.removeURLParam("access_token",!0),n.a.removeURLParam("issued_at",!0),n.a.removeURLParam("expires_in",!0),n.a.removeURLParam("expires_at",!0),n.a.removeURLParam("scope",!0),n.a.removeURLParam("token_type",!0),n.a.removeURLParam("id_token",!0),n.a.hasURLParam("login")||n.a.insertURLParam("login",!0,!0),h.a.notifyUserAuthorized("me",l)}catch(e){r.default.reportError(e)}return e},e.setExternalAccessToken=function(e){N=e;var t=h.a._runDecodeIDToken(e);try{r.default.PAssert(475,"me"===h.a.getDefaultEmail()||h.a.isDefaultEmail(t.email),"Must only set external access token with default email")}catch(e){r.default.reportError(e)}h.a.isJSAuthLibLoaded()?W():window.addEventListener("gapiLoaded",W)};var j=0,K={};e.requestNativeOAuth=function(e,t){try{r.default.PAssert(476,e,"Must supply valid OAuth config")}catch(e){r.default.reportError(e)}try{r.default.PAssert(477,t,"Must specify a callback function for OAuth respose")}catch(e){r.default.reportError(e)}try{r.default.PAssert(478,!e.offline||!e.immediate,"Cannot request immediate offline access")}catch(e){r.default.reportError(e)}var a=++j,i={id:a,scope:e.scope,immediate:!!e.immediate,offline:!!e.offline,state:e.state,login_hint:e.login_hint,include_granted_scopes:!0,redirect_uri:e.redirect_uri};r.default.nativeBridge.sendToApp("getOAuth",i),K[a]=t},e.handleNativeOAuthResponse=function(t){try{r.default.PAssert(479,t&&!r.default.isString(t),"Must supply valid oauth response data")}catch(e){r.default.reportError(e)}try{r.default.PAssert(480,!t||t.id,"Response must have a valid request ID associated with it")}catch(e){r.default.reportError(e)}var a=K[t.id];if(a)if(K[t.id]=void 0,t.success&&t.token&&!t.token.error)t.token.id_token&&t.token.access_token?e.setExternalAccessToken(t.token):t.token.code||r.default.reportError(new Error("Token missing expected properties"),t),a(t.token);else{try{log("Native Token Error: ",JSON.stringify(t))}catch(e){r.default.reportError(e)}a(t.token)}else try{r.default.PAssert(481,!1,"OAuth callback without a valid handler: ",t.id)}catch(e){r.default.reportError(e)}};var Y=[];e.requestNoneOAuth=function(e,t){Y.push({config:e,cb:t})};var X=!1,Q=[];Q[OAuthSchemeType.None]=!0;var J,Z=OAuthSchemeType.Invalid;function $(e){return function(t,a){e(t,function(e){e&&!e.error&&(X=!0,r.default.settings.set(Settings.oauthScheme,Z)),a(e)})}}function ee(){try{r.default.PAssert(483,!X,"Should not be setting up OAuth if locked into the current scheme")}catch(e){r.default.reportError(e)}if(!X){var t=function(){for(var e=OAuthSchemeType.Count;e>=0;e--)if(Q[e])return e}();if(t>Z)switch(Z=t,t){case OAuthSchemeType.None:J={authorize:$(e.requestNoneOAuth),link:h.a.requestNoneLink.bind(h.a)};break;case OAuthSchemeType.Web:try{r.default.PAssert(484,h.a.isJSAuthLibLoaded(),"GAPI Auth should always be valid at this point")}catch(e){r.default.reportError(e)}J={authorize:$(window.gapi.auth.authorize),link:h.a.requestWebLink.bind(h.a)};break;case OAuthSchemeType.Native:try{r.default.PAssert(485,d.a.app,"Native auth should be used in a native app")}catch(e){r.default.reportError(e)}J={authorize:$(e.requestNativeOAuth),link:h.a.requestNativeLink.bind(h.a)};break;default:try{r.default.PAssert(486,!1,"Invalid OAuth scheme type")}catch(e){r.default.reportError(e)}}}}e.addOAuthMethod=function(t){if(!Q[t])if(e.isOAuthMethodValid(t))Q[t]=!0,X||ee();else try{r.default.PAssert(482,!1,"Adding invalid OAuth method: ",t)}catch(e){r.default.reportError(e)}},e.isOAuthMethodValid=function(e){var t=!1;switch(e){case OAuthSchemeType.Native:d.a.app&&(t=!0);break;case OAuthSchemeType.Web:case OAuthSchemeType.None:t=!0}return t},e.getOAuthMethod=function(){return Z},e.linkAccount=function(e,t,a){return J.link(e,t,a)},e.runAuthenticateOffline=function(t,a){var i=r.default.vmMain.getUserEmail();try{r.default.PAssert(487,i===n.a.getURLParam("user")||!n.a.getURLParam("user"),"Do not try to login a user that is not valid")}catch(e){r.default.reportError(e)}e.numTokensRequestedOffline++;var s=t.slice(0);s.indexOf(GScope.UserInfoEmail)<0&&s.push(GScope.UserInfoEmail);for(var o=!1,l=0;l<s.length;++l)if(!h.a.isLinkedAccountAuthorized(i,s[l])){o=!0;break}if(o){var d=h.a.getAuthorizedScopes(i);s.pushOnlyUniques(d),e.linkAccount(i,s,function(t){t&&!t.error&&(r.default.toasts.clearMessage(MessageID.MissingOffline),r.default.toasts.clearMessage(MessageID.MissingOfflineMobile),e.setExternalAccessToken(t)),ae(t,!0,a)})}else h.a.getAccountToken(i,a)},e.runAuthenticate=function(t,a,i,s){if(!h.a.canRunAuthenticate())return log("Connection: runAuthenticate - Skipped"),s&&s(),!1;var o=r.default.getActiveUser()||void 0;try{r.default.PAssert(488,o===n.a.getURLParam("user")||!n.a.getURLParam("user"),"Do not try to login a user that is not valid")}catch(e){r.default.reportError(e)}if(a&&!o&&!n.a.hasURLParam("login",!0))return s&&s(),!1;var l,c=h.a.getJSAuthLibToken();if(c){if(r.default.isArray(c.scope))l=c.scope.slice();else if(r.default.isString(c.scope))try{l=c.scope.split(" ")}catch(e){r.default.reportError(e)}else l=[];var u=0;if(c.scope)for(var f=0;f<t.length;++f)c.scope.indexOf(t[f])<0&&(l.push(t[f]),u++);else l=t,u=t.length;0===u&&(l=[])}else l=t;if(l.length>0){var p=re(l);ne(p,o);var m={client_id:e.CLIENT_ID,scope:p.join(" "),immediate:a,include_granted_scopes:!0,login_hint:o,response_type:"token id_token",authuser:-1};d.a.requireCustomRedirect&&!a&&(m.redirect_uri=d.a.customRedirectString,d.a.customRedirectState&&(l.indexOf(GScope.Contacts)>=0&&(d.a.customRedirectState.syncContacts=!0),m.state=d.a.iosui?d.a.customRedirectState:JSON.stringify(d.a.customRedirectState))),A=!0,e.numTokensRequested++,J.authorize(m,function(t){A=!1,ShouldLog(LogLevels.Timing)&&log("GAPI Authorized: ",log.now()),(!t||t.error)&&a&&i?(e.numTokenRequestFailed++,e.runAuthenticate(l,!1,!1,s)):(t&&!t.error&&(d.a.app||n.a.hasURLParam("login","true"))&&(r.default.vmSetup?r.default.vmSetup.setLoginState(LoginState.LOGGED_IN):r.default.setLoginState(LoginState.LOGGED_IN)),ae(t,!1,s),t&&!t.error&&(d.a.app||n.a.hasURLParam("login","true"))&&e.loadClientDefaultFile())})}else ShouldLog(LogLevels.Error)&&log("Authorization request with no scopes: ",l),s&&s(c);return!0};var te=0;function ae(a,i,n){if(a&&!a.error){try{r.default.PAssert(489,a.scope,"Scopes must be valid")}catch(e){r.default.reportError(e)}e.numTokenRequestSuccess++,r.default.isString(a.scope)&&(a.scope=a.scope.split(" "));var s=S,o=r.default.arrayUniques(a.scope);i&&o.pushOnlyUniques(s),S=o,s.equals(o)||V(),log("Authorized Token: ",a);var d=Math.max(1e3*(parseInt(a.expires_in)-600),6e4);b=Date.now()+d,clearTimeout(P),P=setTimeout(se,d),x=t,l.a.poke();var c=function(){r.default.vmMain.realtimeDocManager.notifyGoogleAuthorization(S),h.a.notifyUserAuthorized("me",a)};r.default.vmMain?c():u.a.listen("VMMainLoaded",function(){c()}),setTimeout(function(){for(var e,t=document.getElementsByTagName("iframe"),a=0;a<t.length;++a)if(t[a].src.startsWith("https://accounts.google.com/o/oauth2/auth?"))if(""===t[a].id)t[a].id="auth_"+te++;else{var i=(e=t[a],parseInt(e.id.split("_")[1]));i!==te&&i!==te-1&&t[a].parentElement.removeChild(t[a])}},0)}else log("Error authorizing token: "+(a?a.error:"UNDEFINED")),e.numTokenRequestFailed++;n&&n(a)}e.totalTokenLifetime=0,e.numTokensRequested=0,e.numTokensRequestedOffline=0,e.numTokenRequestSuccess=0,e.numTokenRequestFailed=0,e.getTokenStats=function(t){var a={totalLifetime:e.totalTokenLifetime,averageLifetime:e.totalTokenLifetime/(e.numTokenRequestFailed+e.numTokenRequestSuccess),numRequested:e.numTokensRequested,numRequestedOffline:e.numTokensRequestedOffline,numRequestSuccess:e.numTokenRequestSuccess,numRequestFailed:e.numTokenRequestFailed};t.tokenStats=a},e.numScriptLoads=0,e.numTokenRefreshes=0,e.numOnlines=0,e.numEnsureDocs=0,e.getOAuthData=function(t){var a={isLocked:X,availableSchemes:Q,currentScheme:Z,nativeOAuthCount:j,numScriptLoads:e.numScriptLoads,numTokenRefreshes:e.numTokenRefreshes,numOnlines:e.numOnlines,numEnsureDocs:e.numEnsureDocs};t.oauthData=a};var ie=!1;function re(t,a){for(var i=[],n=0;n<t.length;++n){var s=t[n],o=e.scopes.indexOf(s)>=0||!a&&s===GScope.TasksRO;try{r.default.PAssert(490,o||v.indexOf(s)>=0,"Unknown scope requested: ",s)}catch(e){r.default.reportError(e)}g.indexOf(s)<0&&o&&(!y[s]||t.indexOf(y[s])<0)&&i.push(s)}return i}function ne(e,t){var a=!0;t&&!t.endsWith("@gmail.com")&&e.length>7&&(a=!1),a||(e.remove(GScope.DriveInstall),e.length>7&&(e.remove(GScope.Contacts),e.length>7&&r.default.reportError(new Error("Unfixable too many scoops! "+e))))}function se(t){try{r.default.PAssert(491,J&&J.authorize,"Must have locked in a valid auth scheme to refresh")}catch(e){r.default.reportError(e)}if(!J||!J.authorize)return t(void 0),!1;try{r.default.PAssert(493,S.length>=e.requiredScopes.length,"We lost some required scopes somewhere...")}catch(e){r.default.reportError(e)}A=!0;var a=h.a.getJSAuthLibToken();if(a){var i=1e3*r.default.parseInt(a.expires_in),n=Math.min(Date.now()-1e3*r.default.parseInt(a.issued_at),i);e.totalTokenLifetime+=n}var s=r.default.vmMain.getUserEmail(),o=re(S,!0);ne(o,s);var l={client_id:e.CLIENT_ID,scope:o.join(" "),immediate:!0,include_granted_scopes:!0,login_hint:s,response_type:"token id_token",authuser:-1};return e.numTokensRequested++,J.authorize(l,function(e){ie=!0,A=!1,ae(e,!1,t)}),!0}e.ensureScopeAccess=function(t){for(var a,i=e.getAuthorizedScopes(),n=(a=e.getAuthorizedScopes().slice(0),r.default.vmMain.pluginManager.runForEachPlugin(function(e){if(e.isEnabled()){var t=e.googleScopes();t&&a.pushArray(t)}}),r.default.settings.get(Settings.syncContacts)&&a.push(GScope.Contacts),re(a,!1)),s=!1,o=0;o<n.length;++o)if(i.indexOf(n[o])<0){s=!0;break}s?(log("Current Scopes: "+i.join(", ")),log("Necessary Scopes: "+n.join(", ")),r.default.reportError(new Error("Missing offline auth scopes")),e.runAuthenticate(n,!1,!1,function(e){e?log("Authenticated Scopes: "+(e.scope?e.scope.join(", "):void 0)):log("Failed to authorize to ensure scopes - no token"),t(e&&!e.error)})):(log("Determined no extra auth necessary for missing token"),t(!0))},e.isRealtimeAPILoaded=function(){return!!(window.gapi&&window.gapi.client&&window.gapi.drive&&window.gapi.drive.realtime)},e.isGoogleClientAPILoaded=function(){return!(!window.gapi||!window.gapi.load)};var oe=-1,le=!1,de=void 0,ce=void 0;function ue(){if(e.numScriptLoads++,clearTimeout(de),de=void 0,e.isGoogleClientAPILoaded())e.isRealtimeAPILoaded()?le=!1:(le=!1,GoogleClientAPILoaded());else{var t=document.getElementById("gapiScript");t&&t.parentNode.removeChild(t),r.default.addScript("https://apis.google.com/js/api.js?onload=GoogleClientAPILoaded","gapiScript",function(){log("GAPI Reload Success"),le=!1},function(){log("GAPI Reload Failed"),le=!1}),oe-- >0?de=setTimeout(ue,r.default.seconds(20)):le=!1}}function he(t){e.numTokenRefreshes++,clearTimeout(ce),ce=void 0,ie?(l.a.poke(),setTimeout(function(){(!l.a.doc||l.a.doc.saveDelay>=r.default.seconds(30)&&l.a.doc.saveDelay<=r.default.seconds(50))&&se()},r.default.seconds(40)),r.default.toasts.clearMessage(MessageID.ConnectionError),t&&t()):(se(),ce=setTimeout(function(){he(t)},r.default.seconds(10)))}return e.goOnline=function(){return e.numOnlines++,e.isGoogleClientAPILoaded()&&e.isRealtimeAPILoaded()?!ce&&(ie=!1,ce=setTimeout(function(){he()},r.default.seconds(2)),!0):(oe=2,le||de||(le=!0,de=setTimeout(ue,r.default.seconds(5))),!1)},e.ensureDocConnection=function(){e.numEnsureDocs++,e.isGoogleClientAPILoaded()&&e.isRealtimeAPILoaded()?he(function(){R?l.a.isConnected()||e.reconnectToActiveDocument():e.loadClientDefaultFile()}):e.goOnline()},e.init(),e}},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=a(6),c=a(53),u=l.a.createClass({displayName:"FancyContextMenuItem",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({isHovered:!1})},getElement:function(){var e=this.refs.element;return e.getElement?e.getElement():e},closeMenu:function(){!1!==this.props.canClose&&i.default.menus.closeContextMenu()},onClick:function(e){var t=this.props;t.hasButtons||this.didClickJustFire||!t.onClick||(!1!==t.clickCloses&&this.closeMenu(),t.onClick(e),this.didClickJustFire=!0,setTimeout(function(){this.didClickJustFire=!1}.bind(this),300))},onClickIcon:function(e){var t=this.props;t.onClickIcon?(this.closeMenu(),t.onClickIcon(e)):this.onClick(e)},onMouseDown:function(e){(this.props.onClickIcon||i.default.hasClass(e.target,"fancyContextMenuIcon"))&&e.preventDefault()},onMouseUp:function(e){var t=this.props;!isNaN(e.button)&&e.button!==ButtonCode.Left||n.a.mac&&e.ctrlKey||t.onClickIcon&&i.default.hasClass(e.target,"fancyContextMenuIcon")||this.onClick(e)},onMouseEnter:function(e){this.isHovered.set(!0),this.props.onMouseEnter&&this.props.onMouseEnter(e)},onMouseLeave:function(){this.isHovered.set(!1)},render:function(){var e,t,a=this.props,r=this.state,n=a.onClick||a.hoverEffects,s=i.default.classNames("fancyContextMenuItem",{flexbox:!a.customLayout},{"c-foreground":!a.faded},{"c-foreground-faded":a.faded},{"c-popup-item":n&&!1!==a.hoverEffects},{selected:a.selected||!1!==a.hoverEffects&&r.isHovered},{active:a.active},{disabled:a.disabled},{hasIcon:!!a.icon},{hasContent:!!a.children},{bold:a.bold},{hasHotkey:a.hotkey},{"flex-center":a.center},{hasButtons:a.hasButtons},this.props.className);if(a.icon)if(a.onClickIcon)e=o.a.createElement(d.a,{className:"fancyContextMenuIcon",icon:a.icon,tooltip:a.iconTooltip,width:36,height:a.height||28,onClick:this.onClickIcon});else{var l=i.default.classNames("fancyContextMenuIcon c-foreground-faded",a.icon),u={fontSize:a.iconSize,height:a.height,lineHeight:a.height&&a.height+"px",color:a.iconColor};e=o.a.createElement("span",{className:l,style:u,onClick:this.onClickIcon,"data-tooltip":a.iconTooltip})}if(a.hoverHotkeyIcon&&r.isHovered){var h=i.default.classNames("fancyContextMenuHotkey c-button",a.hoverHotkeyIcon,{centered:a.hotkeyCentered});t=o.a.createElement("span",{className:h,onMouseUp:a.onClickHoverHotkeyIcon})}else if(a.hotkey){var f=i.default.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:a.hotkeyCentered});t=o.a.createElement("span",{className:f},a.hotkey)}var p=a.style||{};p.height=a.height,p.lineHeight=a.height&&a.height+"px",p.cursor=n?"pointer":"";var m={id:a.id,className:s,"data-tooltip":a.tooltip,onMouseOver:a.onMouseOver,style:p,ref:"element"};return n&&(m.onMouseDown=a.onClick?this.onMouseDown:void 0,m.onMouseUp=a.onClick&&!a.noMouseUp?this.onMouseUp:void 0,m.onClick=a.onClick&&a.noMouseUp?this.onMouseUp:void 0,m.onMouseEnter=!1!==a.hoverEffects?this.onMouseEnter:void 0,m.onMouseLeave=!1!==a.hoverEffects?this.onMouseLeave:void 0),o.a.createElement(a.onClick?c.a:"div",m,e,t?o.a.createElement("span",{className:"f1"},a.children):a.children,t)}});t.a=u},function(e,t,a){"use strict";var i=a(5),r=a(0),n=a(1),s=a(7),o=(a(4),a(51),a(9)),l={isClosed:!0,initialized:!1,loadedOnce:!1,actionsPreventUndo:!1,wantCompoundOperation:!1,inCompoundOperation:!1,flushingDeferredActions:!1,deferredActionsCommitted:!1,hasPendingDeferredActions:!1,authenticatedUser:new o.a,numChanges:0,lastChangeTime:new o.a(r.default.parseInt(i.a.storage.getItem("lastDocSyncTime"))||0)};l.lastChangeTime.listen(function(e){try{r.default.PAssert(494,r.default.isNumber(e),"Must always provide a valid timestamp for lastDocSyncTime")}catch(e){r.default.reportError(e)}i.a.storage.setItem("lastDocSyncTime",e)});l.offlineTimeoutMS=8e3;l.currentVersion=function(){return 6},l.isReadOnly=function(){var e=!1;return l.model&&(e=l.model.isReadOnly),e};var d,c={},u={};function h(){try{r.default.PAssert(543,!l.inCompoundOperation,"Should never be in a compound operation after sync block finishes")}catch(e){r.default.reportError(e)}try{r.default.PAssert(544,!l.wantCompoundOperation,"Should never want a compound operation after a sync block finishes")}catch(e){r.default.reportError(e)}if(l.inCompoundOperation){try{l.inCompoundOperation=!1,l.wantCompoundOperation=!1,r.default.vmMain.notifyDriveOperationError(),l.model.endCompoundOperation()}catch(e){r.default.reportError(e)}r.default.reportError(new Error("Compound operation open after sync block finished"))}d=void 0}l.cacheItem=function(e){try{r.default.PAssert(495,void 0===u[e.id]||u[e.id]===e,"Should not be caching different items with the same ID")}catch(e){r.default.reportError(e)}if(u[e.id]=e,c[e.id]){try{r.default.PAssert(496,c[e.id]===e,"Should not be caching different items with the same ID in deleted")}catch(e){r.default.reportError(e)}delete c[e.id]}},l.getCacheItem=function(e){return u[e]},l.getDeletedCacheItem=function(e){return c[e]},l.removeItemFromCache=function(e){try{r.default.PAssert(497,void 0!==u[e],"Item cache should contain a valid entry for item")}catch(e){r.default.reportError(e)}try{r.default.PAssert(498,void 0===c[e],"Should never already have item in deleted cache")}catch(e){r.default.reportError(e)}c[e]=u[e],delete u[e]},l.restoreDeletedItem=function(e){try{r.default.PAssert(499,void 0!==c[e],"Deleted item cache should contain a valid entry for item")}catch(e){r.default.reportError(e)}try{r.default.PAssert(500,void 0===u[e],"Should never already have an item in the item cache")}catch(e){r.default.reportError(e)}u[e]=c[e],delete c[e]},l.getState=function(e){try{var t={};if(l.doc)try{var a=l.doc.getModel();t.isReadOnly=a.isReadOnly,t.serverVersion=a.serverVersion,t.size=a.bytesUsed,t.saveDelay=l.doc.saveDelay}catch(t){e.docAccessError=!0}t.lastPending=Z,t.lastSaving=$,t.isClosed=l.isClosed,t.initialized=l.initialized,t.numChanges=l.numChanges,t.lastChanged=l.lastChangeTime.get(),e.gState=t,e.gDocErrors=l.docErrors,e.gdataRealtimeStatus=l.getDriveRealtimeStatus()}catch(t){log("Error getting information in gdata::getState()"+t.message),e.gState="EXCEPTION"}},l.checkRemoteIntegrity=function(){l.beginAction(),ShouldLog(LogLevels.Timing)&&log("Verifying Remote Data: ",log.now());var e={},t=!1;for(var a in u){var i=u[a];function n(t,a){if(t)for(var r=0;r<t.length;++r){var n=t.get(r).id;n||(log(n,": Child does not have a valid reference in our remote database"),!0),e[n]?e[n].ref?(log(n,": Item is referenced remotely multiple times"),log("   ",e[n].ref),log("   ",i.id),!0,l.beginWriteAction(),l.setItemParent(t.get(r),l.getCacheItem(e[n.ref])),t.remove(r)):e[n].ref=i.id:e[n]={exist:!1,arch:a,ref:i.id}}}e[i.id]?e[i.id].exist?(log(i.id,": Duplicated IDs in the remote database",i),!0):e[i.id].exist=!0:e[i.id]={exist:!0,ref:!1},i.id===l.rootID&&(t&&(log(i.id,": Multiple roots present remotely",i),!0),t=!0,e[i.id].isRoot=!0),l.getItemParent(i)||e[i.id].isRoot||log(i.id,": Missing remote parent field",i),n(l.get(i,"items"),!1),n(l.get(i,"archivedItems"),!0);var o=l.get(i,"note");o&&(e[o.id]?e[o.id].ref?(log(o,": Note is referenced remotely multiple times: "),log("    ",e[o.id].ref),log("    ",i.id),!0,l.beginWriteAction(),l.set(i,"note",void 0)):e[o.id].ref=i.id:e[o.id]={exist:!1,isNote:!0,ref:i.id})}for(var d in t||(log("No root present"),!0),e){var c=e[d];if(!c.exist){try{r.default.PAssert(502,!1,"This should never happen as the database is inline with the item tree now")}catch(e){r.default.reportError(e)}log(d,": Item is referenced remotely as a child but does not exist in the database");var h=u[c.ref];try{r.default.PAssert(503,h,"Parent must exist otherwise it couldn't reference this item")}catch(e){r.default.reportError(e)}if(c.isNote)l.beginWriteAction(),l.set(h,"note",void 0);else{var f=l.getItemList(h,c.arch);try{r.default.PAssert(504,f,"If the item has been seen here, we will always have a valid parent list")}catch(e){r.default.reportError(e)}if(f){var p=f.indexOf(d);if(p>=0)l.beginWriteAction(),f.remove(p);else try{r.default.PAssert(505,!1,"If we previously saw this item, we expect to be able to delete it from the parent list")}catch(e){r.default.reportError(e)}}}}c.ref||c.isRoot||(log(d,": Item exists remotely but is not referenced by a parent"),log("   : ",l.get(u[d],"text")),l.removeItemFromCache(d)),c.isRoot&&c.ref&&(log(d,": Remote root has a parent"),!0)}s.a.removeDeletedItems(e),l.endAction(),ShouldLog(LogLevels.Timing)&&log("Done Verifying Remote Data: ",log.now())},l.migrateData=function(){var e=!1,t=!1,a=!1,i=!1,n=!1,o=l.root.get("dataVersion");try{r.default.PAssert(515,r.default.isNumber(o),"Remote data version must always be numeric",o)}catch(e){r.default.reportError(e)}if(o<6){l.beginAction(),log("Migrating to latest version: ",o);try{switch(o){case 0:case 1:case 2:case 3:case 4:i=!0,log("Remote Migration Completed");break;case 5:break;default:try{r.default.PAssert(516,!1,"Unknown remoteVersion: ",o)}catch(e){r.default.reportError(e)}}}catch(e){a=!0,r.default.reportError(e)}l.endAction(),l.model.getRoot().set("dataVersion",6),log("Done Migrating Remote Data!",6)}else o>6&&(t=!0,e=!0);if(s.a.hasLocalData){var d=r.default.settings.get(Settings.localDataVersion)||0;try{r.default.PAssert(518,r.default.isNumber(d),"Local data version must be numeric",d)}catch(e){r.default.reportError(e)}if(r.default.isNumber(d)){if(d<6){try{switch(d){case 0:case 1:case 2:case 3:case 4:e=!0,n=!0,log("Local Migration Completed");break;case 5:r.default.vmMain.cacheManager.notifyMigrationRequired();break;default:try{r.default.PAssert(519,!1,"Unknown localVersion",d)}catch(e){r.default.reportError(e)}}}catch(e){t=!0,r.default.reportError(e)}r.default.settings.set(Settings.localDataVersion,6),log("Done Migrating Local Data!",6)}else if(d>6)try{r.default.PAssert(520,!1,"localVersion is greater than our CURRENT_VERSION",d,6)}catch(e){r.default.reportError(e)}}else e=!0,r.default.menus.alert({text:"There was an error loading your document, please try loading a different document and contact support@moo.do.",actionText:"OKAY"})}else r.default.settings.set(Settings.localDataVersion,o);if(i)r.default.menus.alert({text:"You are using an out of date document - please contact support@moo.do for help.",actionText:"OKAY",callback:function(){r.default.vmMain.remoteAPI().driveTrash(r.default.settings.get(Settings.gdocId),function(){r.default.reportError(new Error("Successfully deleted out of date doc - "+r.default.settings.get(Settings.gdocId))),s.a.clearData(function(){r.default.reload()})},function(){r.default.reportError(new Error("Error deleting out of date doc - "+response.error)),s.a.clearData(function(){r.default.reload()})})}});else if(n)r.default.AppCache.runOnFinish(function(){s.a.clearDataAndReload()},!0);else if(t||a)if(t&&!a)r.default.AppCache.runOnFinish(function(){r.default.reload()},!0);else if(a&&!t)l.registerSaveNotify(function(){r.default.reload()});else{var c=0;function u(){2===++c&&r.default.reload()}r.default.AppCache.runOnFinish(u,!0),l.registerSaveNotify(u)}if(!e){var h=l.model.getRoot().get("recoverVersion")||0,f=r.default.settings.get(Settings.localRecoverVersion);void 0===f||!s.a.hasLocalData&&h>f?r.default.settings.set(Settings.localRecoverVersion,h):h>f&&s.a.hasLocalData&&(e=!0,s.a.addDefaultSkipSetting(Settings.gdocId,"Default"),s.a.addDefaultSkipSetting(Settings.gdocTitle,"Default"),r.default.AppCache.runOnFinish(function(){s.a.clearDataAndReload()},!0))}return e},l.beginAction=function(e){if(l.model&&!l.isReadOnly()){try{r.default.PAssert(533,!l.flushingDeferredActions,"Should never begin a new action while flushing")}catch(e){r.default.reportError(e)}try{r.default.PAssert(534,!l.inCompoundOperation,"Should not nest compound operations")}catch(e){r.default.reportError(e)}try{r.default.PAssert(535,!l.wantCompoundOperation,"Should not nest compound operations")}catch(e){r.default.reportError(e)}try{r.default.PAssert(536,!l.isClosed,"Document must be open to make changes")}catch(e){r.default.reportError(e)}0,l.wantCompoundOperation=!0,l.actionsPreventUndo=!!e}},l.beginWriteAction=function(e){if(l.model&&!l.isReadOnly()){try{r.default.PAssert(537,void 0===e||l.actionsPreventUndo===!!e,"Compound operations prevent undo must match",l.actionsPreventUndo,e)}catch(e){r.default.reportError(e)}if(!l.flushingDeferredActions){try{r.default.PAssert(538,l.inCompoundOperation||l.wantCompoundOperation,"If performing an action, we should have already requested a compound operation")}catch(e){r.default.reportError(e)}if(!l.inCompoundOperation&&l.wantCompoundOperation)try{l.deferredActionsCommitted&&l.flushDeferredActions(),d=setTimeout(h,0);0,l.model.beginCompoundOperation(void 0,!l.actionsPreventUndo),l.inCompoundOperation=!0,l.wantCompoundOperation=!1,l.deferredActionsCommitted||l.executeDeferredActions()}catch(e){r.default.reportError(e)}else try{r.default.PAssert(539,!l.wantCompoundOperation,"Should not nest compound operations")}catch(e){r.default.reportError(e)}}}},l.endAction=function(){if(l.model&&!l.isReadOnly()){try{r.default.PAssert(540,!l.flushingDeferredActions,"Should never end an action while flushing")}catch(e){r.default.reportError(e)}try{r.default.PAssert(541,!l.isClosed,"Document must be open to make changes")}catch(e){r.default.reportError(e)}try{r.default.PAssert(542,l.inCompoundOperation||l.wantCompoundOperation,"If ending an action, a beginning should have happened")}catch(e){r.default.reportError(e)}try{l.hasPendingDeferredActions&&(l.deferredActionsCommitted=!0),l.inCompoundOperation&&l.model.endCompoundOperation()}catch(e){r.default.goog.recoverFromError(e)}finally{l.inCompoundOperation=!1,l.wantCompoundOperation=!1,l.actionsPreventUndo=!1,clearTimeout(d),d=void 0}}};var f,p,m={};function g(e){try{r.default.PAssert(550,e,"Must have a valid local item to attach events to")}catch(e){r.default.reportError(e)}try{r.default.PAssert(551,r.default.isVMLI(e),"Must pass in a valid instace of a local item")}catch(e){r.default.reportError(e)}try{r.default.PAssert(552,e.shouldSave(),"Item must be marked as saveable")}catch(e){r.default.reportError(e)}try{r.default.PAssert(553,e.data,"Must have a valid remote item to attach events to")}catch(e){r.default.reportError(e)}e.data.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,e.onObjectChanged.bind(e))}function v(e){l.beginWriteAction();try{r.default.PAssert(595,r.default.isVMLI(e))}catch(e){r.default.reportError(e)}try{r.default.PAssert(596,e.shouldSave(),"Item must be marked as saveable")}catch(e){r.default.reportError(e)}try{r.default.PAssert(597,e.data,"Must have valid remote item to attach events to and create")}catch(e){r.default.reportError(e)}var t=l.get(e.data,"items");return t||(t=l.model.createList(),l.set(e.data,"items",t)),t}function y(e){l.beginWriteAction();try{r.default.PAssert(598,r.default.isVMLI(e))}catch(e){r.default.reportError(e)}try{r.default.PAssert(599,e.shouldSave(),"Item must be marked as saveable")}catch(e){r.default.reportError(e)}try{r.default.PAssert(600,e.data,"Must have valid remote item to attach events to and create")}catch(e){r.default.reportError(e)}var t=l.get(e.data,"archivedItems");return t||(t=l.model.createList(),l.set(e.data,"archivedItems",t)),t}function S(e){l.beginWriteAction();var t=l.getVersion(e,VersionType.Structure);t=t?t+1:1,l.set(e,"version",t)}l.performDeferredAction=function(e,t){try{r.default.PAssert(545,e,"Must supply a valid item to perform the action on")}catch(e){r.default.reportError(e)}try{r.default.PAssert(546,t,"Must supply a valid action to be performed")}catch(e){r.default.reportError(e)}if(l.model&&!l.isReadOnly()){try{r.default.PAssert(547,!l.inCompoundOperation,"Cannot perform deferred action after a compound operation has started")}catch(e){r.default.reportError(e)}if(m[e.id])for(var a in t)m[e.id].changes[a]=t[a];else m[e.id]={item:e,changes:t};l.hasPendingDeferredActions=!0,clearTimeout(f),f=setTimeout(l.flushDeferredActions,800)}},l.executeDeferredActions=function(){l.flushingDeferredActions=!0;try{for(var e in m)O(m[e].item,m[e].changes)}catch(e){r.default.reportError(e)}finally{l.flushingDeferredActions=!1,l.hasPendingDeferredActions=!1,m={},l.deferredActionsCommitted=!1}},l.flushDeferredActions=function(){if(l.model&&!l.isClosed){try{r.default.PAssert(548,!l.flushingDeferredActions,"Should never recursively call flushDeferredActions")}catch(e){r.default.reportError(e)}try{r.default.PAssert(549,!l.inCompoundOperation,"Must flush deferred actions before starting a compound operation")}catch(e){r.default.reportError(e)}if(l.hasPendingDeferredActions){clearTimeout(f),f=void 0;try{0,l.model.beginCompoundOperation(void 0),l.executeDeferredActions(),l.model.endCompoundOperation()}catch(e){r.default.reportError(e)}}}},l.hasPotentialUnsavedData=function(){return!(!s.a||!s.a.hasMadeInMemoryOnlyUpdate||l.isConnected()&&!(l.doc.saveDelay>r.default.seconds(1)))},l.hasDeferredAction=function(e){return!!m[e]},l.createNewItem=function(e,t,a){try{r.default.PAssert(554,!l.isReadOnly(),"Should never create a new item in a read-only doc")}catch(e){r.default.reportError(e)}l.beginWriteAction();try{r.default.PAssert(555,r.default.isVMLI(e),"Must pass in a valid instace of a local item")}catch(e){r.default.reportError(e)}try{r.default.PAssert(556,e.shouldSave(),"Item must be marked as saveable")}catch(e){r.default.reportError(e)}try{r.default.PAssert(557,l.inCompoundOperation,"Should always create an item inside of a compound operation")}catch(e){r.default.reportError(e)}try{r.default.PAssert(558,!l.isClosed,"Document must be open to make changes")}catch(e){r.default.reportError(e)}try{r.default.PAssert(559,l.model,"Need a valid model to create collaborative items")}catch(e){r.default.reportError(e)}try{r.default.PAssert(560,!e.data,"When initializing a new item, it should have no gdata components already")}catch(e){r.default.reportError(e)}var i=l.model.createMap();e.data=i,e.data.connectIdentifier=l.connectIdentifier();try{r.default.PAssert(561,e.getRawText().indexOf(window.AttachChar)<0,"Remote syncd changes should never contain AttachChar")}catch(e){r.default.reportError(e)}if(l.set(i,"text",e.getRawText()),t){var n=l.model.createList();l.set(i,"items",n)}if(a){var s=l.model.createList();l.set(i,"archivedItems",s)}return l.set(i,"dateCreated",e.dateCreated.getTime()),e.id=i.id,u[i.id]||(u[i.id]=i),i.id},l.initializeNewItem=function(e){try{r.default.PAssert(562,!l.isReadOnly(),"Should never initialize a new item in a read-only doc")}catch(e){r.default.reportError(e)}l.beginWriteAction();try{r.default.PAssert(563,r.default.isVMLI(e),"Must pass in a valid instace of a local item")}catch(e){r.default.reportError(e)}try{r.default.PAssert(564,e.shouldSave(),"Item must be marked as saveable")}catch(e){r.default.reportError(e)}try{r.default.PAssert(565,!l.isClosed,"Document must be open to make changes")}catch(e){r.default.reportError(e)}try{r.default.PAssert(566,l.inCompoundOperation,"Should always initialize an item inside of a compound operation")}catch(e){r.default.reportError(e)}if(e.hasChildren()){var t=e.getItems(),a=v(e);try{r.default.PAssert(567,a,"Must have a valid collab list for normal init")}catch(e){r.default.reportError(e)}for(var i=0;i<t.length;++i){try{r.default.PAssert(568,t[i].data,"Item must have a valid remote to be added to a collab list")}catch(e){r.default.reportError(e)}l.setItemParent(t[i].data,e.data),a.push(t[i].data)}}if(e.hasArchivedChildren()){var n=e.archivedItems(!0),s=y(e);try{r.default.PAssert(569,s,"Must have a valid collab list for archived init")}catch(e){r.default.reportError(e)}for(i=0;i<n.length;++i){try{r.default.PAssert(570,n[i].data,"Item must have a valid remote to be added to a collab list")}catch(e){r.default.reportError(e)}l.setItemParent(n[i].data,e.data),s.push(n[i].data)}}if(e.hasNote()){var o=e.getNote();try{r.default.PAssert(571,o.data,"Note must have a valid remote to be added to an item")}catch(e){r.default.reportError(e)}l.setItemParent(o.data,e.data),l.set(e.data,"note",o.data)}e.isNote()&&l.set(e.data,"isNote",!0),e.parent()&&l.setItemParent(e.data,e.parent().data),g(e)},l.attachEventsToItem=function(e){try{r.default.PAssert(572,r.default.isVMLI(e),"Must pass in a valid local item")}catch(e){r.default.reportError(e)}try{r.default.PAssert(573,e.shouldSave(),"Item must be marked as saveable")}catch(e){r.default.reportError(e)}try{r.default.PAssert(574,e.data,"Must have loaded data from gdrive before attaching events to item")}catch(e){r.default.reportError(e)}g(e)},l.registerForUndoRedoStateChange=function(e){l.model?(l.model.addEventListener(gapi.drive.realtime.EventType.UNDO_REDO_STATE_CHANGED,e.stateChangeForUndoRedo),e.stateChangeForUndoRedo({canUndo:l.model.canUndo,canRedo:l.model.canRedo})):p=e},l.registerForSaveStateChange=function(e){try{r.default.PAssert(575,l.doc,"Must have a valid doc to connect to")}catch(e){r.default.reportError(e)}l.doc.addEventListener(gapi.drive.realtime.EventType.DOCUMENT_SAVE_STATE_CHANGED,e)},l.loadCollaborators=function(){for(var e,t=l.doc.getCollaborators(),a=0;a<t.length;++a){var i=t[a];i.isMe&&(e=i)}l.authenticatedUser.set(e),e&&r.default.settings.set(Settings.displayName,e.displayName)},l.undoAction=function(){l.flushDeferredActions();try{r.default.PAssert(576,!l.isClosed,"Document must be open to make changes")}catch(e){r.default.reportError(e)}try{r.default.PAssert(577,l.model.canUndo,"Remote model must be able to undo")}catch(e){r.default.reportError(e)}try{l.model.undo()}catch(e){r.default.reportError(e)}},l.redoAction=function(){l.flushDeferredActions();try{r.default.PAssert(578,!l.isClosed,"Document must be open to make changes")}catch(e){r.default.reportError(e)}try{r.default.PAssert(579,l.model.canRedo,"Remote model must be able to redo")}catch(e){r.default.reportError(e)}r.default.vmMain.beginUpdateItems();try{l.model.redo()}catch(e){r.default.reportError(e)}r.default.vmMain.commitUpdateItems()},l.getItemParent=function(e){return e._mdParent},l.setItemParent=function(e,t){try{r.default.PAssert(580,e,"Must provide a valid model when setting the item parent")}catch(e){r.default.reportError(e)}try{r.default.PAssert(581,!r.default.isVMLI(e),"Must pass in a valid remote item for child")}catch(e){r.default.reportError(e)}try{r.default.PAssert(582,!r.default.isVMLI(t),"Must pass in a valid remote item for parent")}catch(e){r.default.reportError(e)}try{r.default.PAssert(583,!e||e.type===gapi.drive.realtime.CollaborativeTypes.COLLABORATIVE_MAP,"Model must be a valid Map")}catch(e){r.default.reportError(e)}try{r.default.PAssert(584,!t||t.type===gapi.drive.realtime.CollaborativeTypes.COLLABORATIVE_MAP,"Parent must be a valid Map")}catch(e){r.default.reportError(e)}e._mdParent=t},l.getItemList=function(e,t){l.beginWriteAction();try{r.default.PAssert(592,!r.default.isVMLI(e),"Must pass in a valid remote item")}catch(e){r.default.reportError(e)}return t?l.get(e,"archivedItems"):l.get(e,"items")},l.ensureItemList=function(e,t){l.beginWriteAction();try{r.default.PAssert(593,r.default.isVMLI(e),"Must pass in a valid local item")}catch(e){r.default.reportError(e)}try{r.default.PAssert(594,e.shouldSave(),"Item must be marked as saveable")}catch(e){r.default.reportError(e)}return t?y(e):v(e)},l.canSave=function(e){if(l.initialized){var t=r.default.isVMLI(e)?e.data:e;try{r.default.PAssert(601,t,"Must have a valid remote item to make changes")}catch(e){r.default.reportError(e)}try{r.default.PAssert(602,!l.isClosed,"Document must be open to make changes")}catch(e){r.default.reportError(e)}try{r.default.PAssert(603,!t||t.connectIdentifier===l.connectIdentifier(),"Using remote item data that is out of date",t?t.connectIdentifier:-1,l.connectIdentifier())}catch(e){r.default.reportError(e)}return!(!t||l.isClosed||t.connectIdentifier!==l.connectIdentifier())&&t}},l.deleteTree=function(e){l.beginWriteAction();try{r.default.PAssert(604,e,"Must provide a valid item instance to deleteTree")}catch(e){r.default.reportError(e)}try{r.default.PAssert(605,!r.default.isVMLI(e),"Must not be a VMLI, should be a remote item")}catch(e){r.default.reportError(e)}try{r.default.PAssert(606,!r.default.isString(e),"Must pass in a valid remote item not an ID")}catch(e){r.default.reportError(e)}if(e){l.setItemParent(e,void 0);var t=s.a.getItem(e.id);t&&t.data&&t.data===e&&(t.data=void 0);var a=l.getItemList(e,!1);if(a)for(var i=0;i<a.length;++i){var n=a.get(i);l.deleteTree(n)}var o=l.getItemList(e,!0);if(o)for(i=0;i<o.length;++i){var d=o.get(i);l.deleteTree(d)}l.removeItemFromCache(e.id)}};var E="noteSet",P="itemAdded",b="itemsAdded",C="itemRemoved",D="itemMoved",I="itemArchived",A="itemUnarchived",M="Exception",_="NoData",T="NoSrcList",w="NoDstList",k="InvalidSrcIndex",x="InvalidDstIndex";function L(e,t,a){a||(a=new Error("DocError: "+e+"."+t)),l.docErrors.push({fn:e,type:t,data:a}),r.default.reportError(a)}function O(e,t){try{r.default.PAssert(643,e.shouldSave(),"Item must be marked as saveable")}catch(e){r.default.reportError(e)}var a=l.canSave(e);if(a)if(r.default.isEmpty(t))ShouldLog(LogLevels.Warning)&&log("Skipped remote saving an empty object");else{for(var i in l.beginWriteAction(),s.a.addPendingUpdate(e.id),t.hasOwnProperty("dateFormat")&&l.set(a,"dateFormat",t.dateFormat),t){try{r.default.PAssert(644,t.hasOwnProperty(i),"Changes should only contain properties they own")}catch(e){r.default.reportError(e)}if(t.hasOwnProperty(i))switch(i){case"text":try{r.default.PAssert(645,r.default.isString(t.text))}catch(e){r.default.reportError(e)}try{r.default.PAssert(646,t.text.indexOf(window.AttachChar)<0,"Remote syncd changes should never contain AttachChar")}catch(e){r.default.reportError(e)}try{r.default.PAssert(647,e.isNote()||t.text.indexOf("\n")<0,"Remote syncd changes should never contain newlines")}catch(e){r.default.reportError(e)}l.set(a,"text",t.text);break;case"date":try{r.default.PAssert(648,!t.date||r.default.isNumber(t.date),"Invalid date type")}catch(e){r.default.reportError(e)}l.set(a,"date",t.date);break;case"dateFormat":break;case"repeatDate":try{r.default.PAssert(649,!t.repeatDate||r.default.isString(t.repeatDate),"Invalid repeat date type")}catch(e){r.default.reportError(e)}l.set(a,"repeatDate",t.repeatDate);break;case"dateCreated":try{r.default.PAssert(650,r.default.isNumber(t.dateCreated),"Invalid dateCreated type")}catch(e){r.default.reportError(e)}l.set(a,"dateCreated",t.dateCreated);break;case"dateCompleted":try{r.default.PAssert(651,!t.dateCompleted||r.default.isNumber(t.dateCompleted),"Invalid dateCompleted type")}catch(e){r.default.reportError(e)}l.set(a,"dateCompleted",t.dateCompleted);break;case"allDayDate":case"priority":case"isComplete":case"isStarred":case"favorites":l.set(a,i,t[i]);break;case"isCollapsed":case"isArchived":case"isNote":case"note":try{r.default.PAssert(652,!1,"These properties are not set this way")}catch(e){r.default.reportError(e)}l.set(a,i,t[i]);break;case"modifiedOfflineText":case"dateText":case"durationText":case"duration":break;default:try{r.default.PAssert(653,!1,"Attempting to remotely save an unknown field: ",i)}catch(e){r.default.reportError(e)}}}!function(e){l.beginWriteAction();var t=l.getVersion(e,VersionType.Text);t=t?t+1:1,l.set(e,"versionText",t)}(a)}}l.docErrors=[],l.noteSet=function(e,t){if(!l.isConnected())return ReturnValue.Success;if(l.isReadOnly())return ReturnValue.Success;l.beginWriteAction();try{r.default.PAssert(607,e,"Must provide a valid item to set a note on")}catch(e){r.default.reportError(e)}try{r.default.PAssert(608,!t||t.isNote(),"Must be removing a note or setting note with a valid note item")}catch(e){r.default.reportError(e)}try{var a,i=l.canSave(e);if(!i)return L(E,_),ReturnValue.Error;if(t){if(!(a=l.canSave(t)))return L(E,_),ReturnValue.Error;l.set(a,"isNote",!0)}try{r.default.PAssert(609,!t||!l.get(i,"note"),"Should not set a note on an item that already has a note")}catch(e){r.default.reportError(e)}l.set(i,"note",a)}catch(e){throw L(E,M,e),e}return ReturnValue.Success},l.itemAdded=function(e){if(!l.isConnected())return ReturnValue.Success;if(l.isReadOnly())return ReturnValue.Success;l.beginWriteAction();var t=e.item,a=e.addedItem,i=e.index,n=e.isArchived,o=e.noVersion;try{r.default.PAssert(610,void 0!==t&&void 0!==a&&void 0!==n,"itemAdded is missing parameters")}catch(e){r.default.reportError(e)}try{r.default.PAssert(611,i>=-1||void 0===i,"Invalid index",i)}catch(e){r.default.reportError(e)}try{var d=l.canSave(t);if(!d)return L(P,_),ReturnValue.Error;var c=l.canSave(a);if(!c)return L(P,_),ReturnValue.Error;s.a.addPendingUpdate(t.id),s.a.addPendingUpdate(a.id);try{r.default.PAssert(612,!t.isNote(),"Should not add a child to a note")}catch(e){r.default.reportError(e)}var u=l.ensureItemList(t,n);try{r.default.PAssert(613,u,"Must have a valid remote list to add the item to")}catch(e){r.default.reportError(e)}try{r.default.PAssert(614,isNaN(i)||i<=u.length,"Should not try to insert an item after the end of the array")}catch(e){r.default.reportError(e)}try{r.default.PAssert(615,isNaN(i)||i>=0,"Should not try to insert an item at a negative index")}catch(e){r.default.reportError(e)}i<0||isNaN(i)||i>u.length?u.push(c):u.insert(i,c),o||S(c),l.setItemParent(c,d),l.cacheItem(c)}catch(e){throw L(P,M,e),e}return ReturnValue.Success},l.itemsAdded=function(e){if(!l.isConnected())return ReturnValue.Success;if(l.isReadOnly())return ReturnValue.Success;l.beginWriteAction();var t=e.item;try{r.default.PAssert(616,r.default.isVMLI(t),"Passed in item must be a VMLI")}catch(e){r.default.reportError(e)}var a=e.addedItems,i=e.index,n=e.isArchived,o=e.noVersion;try{r.default.PAssert(617,void 0!==t&&void 0!==a&&void 0!==n,"itemsAdded is missing parameters")}catch(e){r.default.reportError(e)}try{r.default.PAssert(618,isNaN(i)||i>=0,"Must provide a valid item index when adding an item to a remote list")}catch(e){r.default.reportError(e)}try{var d=l.canSave(t);if(!d)return L(b,_),ReturnValue.Error;var c=l.ensureItemList(t,n);try{r.default.PAssert(619,c,"Must have a valid remote list to add the item to")}catch(e){r.default.reportError(e)}try{r.default.PAssert(620,i<=c.length,"Should not insert items after the end of the remote list")}catch(e){r.default.reportError(e)}for(var u=new Array(a.length),h=0;h<a.length;++h){try{r.default.PAssert(621,!a[h].isNote(),"Should never be adding a note as a child")}catch(e){r.default.reportError(e)}u[h]=a[h].data,s.a.addPendingUpdate(a[h].id),!o&&u[h]&&S(u[h]),l.setItemParent(u[h],t),l.cacheItem(u[h])}s.a.addPendingUpdate(t.id);try{r.default.PAssert(622,!t.isNote(),"Should never be adding a child to a note")}catch(e){r.default.reportError(e)}if(i<0||isNaN(i)){try{r.default.PAssert(623,n,"Only archived items should be inserted into a list by pushing")}catch(e){r.default.reportError(e)}c.pushAll(u)}else c.insertAll(i,u);0}catch(e){throw L(b,M,e),e}return ReturnValue.Success},l.itemRemoved=function(e){if(!l.isConnected())return ReturnValue.Success;if(l.isReadOnly())return ReturnValue.Success;l.beginWriteAction();var t=e.item,a=e.index,i=e.numToRemove,n=e.isArchived,o=e.noDelete,d=e.noVersion;try{r.default.PAssert(624,void 0!==t&&void 0!==a&&void 0!==i&&void 0!==n,"itemRemoved is missing parameters")}catch(e){r.default.reportError(e)}try{r.default.PAssert(625,a>=0,"Must have a valid index to remove from")}catch(e){r.default.reportError(e)}try{var c=l.canSave(t);if(!c)return L(C,_),ReturnValue.Error;isNaN(i)&&(i=1);var u=l.getItemList(c,n);if(!u)return L(C,T),ReturnValue.Error;try{r.default.PAssert(626,a+i<=u.length,"Should not be removing items past the end of the remote list")}catch(e){r.default.reportError(e)}for(var h=a;h<a+i;++h){var f=u.get(h);s.a.addPendingUpdate(f.id),d||S(f),o||l.deleteTree(f)}s.a.addPendingUpdate(t.id),1===i?u.remove(a):u.removeRange(a,a+i)}catch(e){throw L(C,M,e),e}return ReturnValue.Success},l.itemMoved=function(e){if(!l.isConnected())return ReturnValue.Success;if(l.isReadOnly())return ReturnValue.Success;l.beginWriteAction();var t=e.item,a=e.newInfo,i=e.oldParent,n=e.oldInfo,o=e.noVersion;try{r.default.PAssert(627,void 0!==t&&void 0!==a&&void 0!==i&&void 0!==n,"itemMoved is missing parameters")}catch(e){r.default.reportError(e)}try{r.default.PAssert(628,a&&a.index>=-1,"Must supply a valid new item index")}catch(e){r.default.reportError(e)}try{r.default.PAssert(629,a&&void 0!==a.isArchived,"Must determine if this item is archived or not")}catch(e){r.default.reportError(e)}try{r.default.PAssert(630,i,"Must specify a valid old parent")}catch(e){r.default.reportError(e)}try{r.default.PAssert(631,n&&n.index>=0,"Must supply a valid old item index")}catch(e){r.default.reportError(e)}try{r.default.PAssert(632,n&&void 0!==n.isArchived,"Must determine if this item was archived or not")}catch(e){r.default.reportError(e)}try{var d=l.canSave(t);if(!d)return L(D,_),ReturnValue.Error;var c=l.canSave(i);if(!c)return L(D,_),ReturnValue.Error;var u=l.canSave(t.parent());if(!u)return L(D,_),ReturnValue.Error;var h=l.getItemList(c,n.isArchived);if(!h)return L(D,T),ReturnValue.Error;if(n.index>=h.length)return L(D,k),ReturnValue.Error;var f=l.ensureItemList(t.parent(),a.isArchived);if(!f)return L(D,w),ReturnValue.Error;if(a.index>f.length)return L(D,x),ReturnValue.Error;var p=a.index;(a.index<0||isNaN(a.index)||a.index>f.length)&&(p=f.length),h.moveToList(n.index,f,p),l.setItemParent(d,u),s.a.addPendingUpdate(t.id),s.a.addPendingUpdate(i.id),s.a.addPendingUpdate(t.parent().id);try{r.default.PAssert(633,!t.isNote(),"Should never move a note as a child")}catch(e){r.default.reportError(e)}try{r.default.PAssert(634,!t.parent().isNote(),"Notes should never have children")}catch(e){r.default.reportError(e)}o||S(d)}catch(e){throw L(D,M,e),e}return ReturnValue.Success},l.itemArchived=function(e,t,a){if(!l.isConnected())return ReturnValue.Success;if(l.isReadOnly())return ReturnValue.Success;l.beginWriteAction();try{r.default.PAssert(635,a>=0,"Must have a valid index to remove from")}catch(e){r.default.reportError(e)}try{var i=l.canSave(e);if(!i)return L(I,_),ReturnValue.Error;if(!l.canSave(t))return L(I,_),ReturnValue.Error;var n=l.getItemList(i,!1);if(!n)return L(I,T),ReturnValue.Error;var o=y(e);if(!o)return L(I,w),ReturnValue.Error;if(!(a<n.length))return L(I,k),ReturnValue.Error;n.moveToList(a,o,o.length),s.a.addPendingUpdate(e.id),s.a.addPendingUpdate(t.id);try{r.default.PAssert(636,!e.isNote(),"Parents should never be archiving notes")}catch(e){r.default.reportError(e)}S(t.data)}catch(e){throw L(I,M,e),e}return ReturnValue.Success},l.itemUnarchived=function(e,t,a,i){if(!l.isConnected())return ReturnValue.Success;if(l.isReadOnly())return ReturnValue.Success;l.beginWriteAction();try{r.default.PAssert(637,a>=0,"Must have a valid index to remove from")}catch(e){r.default.reportError(e)}try{var n=l.canSave(e);try{r.default.PAssert(638,n,"Must have valid item data when archiving an item")}catch(e){r.default.reportError(e)}if(!n)return L(A,_),ReturnValue.Error;if(!l.canSave(t))return L(A,_),ReturnValue.Error;var o=l.get(n,"items");try{r.default.PAssert(639,o,"Must be an items array present")}catch(e){r.default.reportError(e)}var d=l.get(n,"archivedItems");try{r.default.PAssert(640,d,"Must be an archived items array present")}catch(e){r.default.reportError(e)}d.moveToList(a,o,i),s.a.addPendingUpdate(e.id),s.a.addPendingUpdate(t.id),S(t.data)}catch(e){throw L(A,M,e),e}return ReturnValue.Success},l.saveChanges=function(e,t){if(l.isConnected()&&!l.isReadOnly()){if(t&&t.text){try{r.default.PAssert(641,t.text.indexOf(window.AttachChar)<0,"Remote syncd changes should never contain AttachChar")}catch(e){r.default.reportError(e)}try{r.default.PAssert(642,e.isNote()||t.text.indexOf("\n")<0,"Remove syncd changes should never contain newlines")}catch(e){r.default.reportError(e)}}l.inCompoundOperation||l.actionsPreventUndo?O(e,t):l.performDeferredAction(e,t)}},l.resetDriveData=function(){u={},l.initialized=!1,l.doc=void 0,l.model=void 0,l.root=void 0,l.rootItem=void 0,l.rootID=void 0,window.__remoteDoc=void 0,l.cachesRemote=void 0,s.a.forEachModel(function(e){e.resetDriveData()}),r.default.vmMain.notifyDriveDisconnect(),l.inCompoundOperation=!1,l.wantCompoundOperation=!1,l.flushingDeferredActions=!1,l.deferredActionsCommitted=!1,clearTimeout(d),d=void 0,clearTimeout(f),f=void 0,l.hasPendingDeferredActions=!1,m={}},l.clearItemEventListeners=function(){s.a.forEachModel(function(e){e.data&&e.data.removeAllEventListeners()})},l.close=function(e){try{r.default.PAssert(654,e||V===B.Error,"Invalid state for document close: ",V)}catch(e){r.default.reportError(e)}try{r.default.PAssert(655,!l.wantCompoundOperation,"Closing the doc with a deferred compound operation")}catch(e){r.default.reportError(e)}if(l.doc&&!l.isClosed){log("---- Closing Remote Document! ----"),l.isClosed=!0,r.default.vmMain.setGDriveStatus(DriveStatus.Offline);try{l.doc.close()}catch(e){log("Error Closing Doc: ",e)}l.resetDriveData()}else r.default.vmMain.isReconnecting()&&r.default.vmMain.setGDriveStatus(DriveStatus.Offline)};var R,N=0,F=[1e3,2e4,4e4,6e4,9e4];function U(){try{r.default.PAssert(656,V===B.Error||V===B.XHRError,"Invalid state for request reconnect: ",V)}catch(e){r.default.reportError(e)}clearTimeout(R),R=void 0,r.default.goog.reconnectToActiveDocument()}l.setupReconnect=function(){try{r.default.PAssert(657,V===B.Error||V===B.XHRError,"Invalid state for setup reconnect: ",V)}catch(e){r.default.reportError(e)}try{r.default.PAssert(658,!R,"Reconnect timer already active")}catch(e){r.default.reportError(e)}var e,t=(e=N++,F[Math.min(e,F.length-1)]);clearTimeout(R),R=setTimeout(U,t)},l.notifyReconnectFailure=function(){l.setupReconnect()},l.notifyReconnectSuccess=function(){N=0,clearTimeout(R),R=void 0};var B={Disconnected:0,Connecting:1,Connected:2,Reconnecting:3,Error:4,XHRError:5},V=B.Disconnected;function H(e){var t=V;if(V=e,log("Change Realtime Status: ",t," -> ",e),t!==e)switch(t){case B.Disconnected:try{r.default.PAssert(659,e===B.Connecting,"Invalid state switch",t,e)}catch(e){r.default.reportError(e)}break;case B.XHRError:case B.Error:try{r.default.PAssert(660,e===B.Reconnecting||e===B.Connected,"Invalid state switch",t,e)}catch(e){r.default.reportError(e)}e===B.Connected&&l.notifyReconnectSuccess();break;case B.Connected:try{r.default.PAssert(661,e===B.Error,"Invalid state switch",t,e)}catch(e){r.default.reportError(e)}e===B.Error&&(l.close(),l.setupReconnect());break;case B.Connecting:case B.Reconnecting:try{r.default.PAssert(662,e===B.Error||e===B.Connected,"Invalid state switch",t,e)}catch(e){r.default.reportError(e)}e===B.Error?(l.close(),l.setupReconnect()):e===B.XHRError?(l.close(),l.notifyReconnectFailure()):e===B.Connected&&t===B.Reconnecting&&l.notifyReconnectSuccess();break;default:try{r.default.PAssert(663,!1,"Invalid status: ",t,e)}catch(e){r.default.reportError(e)}}}l.getDriveRealtimeStatus=function(){return V};var q=1;function G(e){(!e||4===e.readyState&&200!==e.status)&&H(B.XHRError)}l.connectIdentifier=function(){return q};var z=!1;l.driveRealtimeLoad=function(e,t,a,i){try{r.default.PAssert(667,V===B.Disconnected||V===B.Error,"Loading realtime document from invalid state")}catch(e){r.default.reportError(e)}var n=V;if(V===B.Disconnected?H(B.Connecting):V!==B.Error&&V!==B.XHRError||H(B.Reconnecting),n===B.Disconnected||n===B.Error||n===B.XHRError){z=r.default.registerURLForNotifyXHR("https://drive.google.com/otservice/gs",G);try{r.default.PAssert(668,z,"XHR must always be successfully wrapped")}catch(e){r.default.reportError(e)}r.default.checkpoint(Checkpoint.DocLoadRequested),gapi.drive.realtime.load(e,function(e){try{r.default.PAssert(664,e,"Must pass a valid CB for doc loaded")}catch(e){r.default.reportError(e)}return function(t){r.default.batchRenderUpdates(function(){H(B.Connected),q++,e(t)})}}(t),function(e){try{r.default.PAssert(665,e,"Must pass a valid CB for doc initialized")}catch(e){r.default.reportError(e)}return function(t){H(B.Connected),e(t)}}(a),function(e){try{r.default.PAssert(666,e,"Must pass a valid CB for doc error")}catch(e){r.default.reportError(e)}return function(t){e(t)&&H(B.Error)}}(i))}},l.onInitialized=function(e){log("Initializing",e);var t=e.createMap(),a=e.createList();l.set(t,"text",n.a.RootItemName),l.set(t,"items",a),l.set(t,"archivedItems",e.createList()),l.set(t,"dateCreated",Date.now());var i=e.getRoot();i.set("dataVersion",6),i.set("root",t);var s=r.default.vmMain.docManager.getOpenDoc();try{r.default.PAssert(669,s,"Must have an open doc to be initializing a realtime doc")}catch(e){r.default.reportError(e)}s.getDocumentFolder(function(e){i.set("docFolderID",e)}),i.set("settings",e.createMap()),i.set("caches",e.createMap())},l.onFirstInitialized=function(e){var t=e.getRoot().get("root");function a(t,a){var i=e.createMap();l.set(i,"text",a),l.set(i,"dateCreated",(new Date).getTime());var r=l.get(t,"items");return r||(r=e.createList(),l.set(t,"items",r)),r.push(i),i}var i=a(t,"# Welcome to Moo.do");a(i,"Press **Tab** to indent and **Shift + Tab** to unindent"),a(i,"Use #tags and dates @today 4pm to get organized"),a(i,""),a(i=a(t,"# Start a line with # to create a project"),"[ Start a line with [ to create a task"),a(i=a(i,"# Use hierarchy to organize projects and sub-projects"),"Now delete this and add your own projects"),r.default.vmMain.runFirstRun()};var W={};l.maxCacheEntrySize=function(){return 300},l.cacheChanged=function(e,t){if(t.ocHandled||t.isLocal)return!1;for(var a=0;a<t.events.length;++a){var i=t.events[a];switch(i.type){case gapi.drive.realtime.EventType.VALUES_ADDED:l.notifyListeners(e,DataChangeType.Add,i.property,i.newValue);break;case gapi.drive.realtime.EventType.VALUES_REMOVED:l.notifyListeners(e,DataChangeType.Remove,i.property,i.newValue);break;case gapi.drive.realtime.EventType.VALUE_CHANGED:l.notifyListeners(e,DataChangeType.Change,i.property,i.newValue);break;case gapi.drive.realtime.EventType.TEXT_DELETED:case gapi.drive.realtime.EventType.TEXT_INSERTED:case gapi.drive.realtime.EventType.VALUES_SET:default:try{r.default.PAssert(670,!1,"Unexpected event type")}catch(e){r.default.reportError(e)}}}};var j={};function K(e){try{r.default.PAssert(683,!e||r.default.isString(e),"Must always be saving a string to remote cache")}catch(e){r.default.reportError(e)}return e?e.length:0}function Y(e,t){for(var a=!0,i=t.get("data").items(),n=0;n<i.length;++n){var s=i[n][0],o=i[n][1];try{var l=JSON.parse(o);e._isPreviewData(l)||(a=!1,e._displayMissingProperties(s,l,PluginLoad.Preview))}catch(e){r.default.reportError(e),a=!1}}return a}l.notifyListeners=function(e,t,a,i){var n=j[e];try{r.default.PAssert(671,n&&n.length>0,"Should always have an interested party if we are receiving notifications")}catch(e){r.default.reportError(e)}try{var s;i&&((s=JSON.parse(i)).id=a);for(var o=0;o<n.length;++o)try{n[o](t,a,s)}catch(e){r.default.reportError(e)}}catch(e){r.default.reportError(e)}},l.hookCacheListeners=function(){for(var e in j)try{l.hookCacheListener(e)}catch(e){r.default.reportError(e)}},l.hookCacheListener=function(e){var t=l.cachesRemote.get(e);try{r.default.PAssert(672,t,"If we are listening for a cache, it must have been ensured first")}catch(e){r.default.reportError(e)}var a=!1;if(t){var i=t.get("data");try{r.default.PAssert(673,i,"Malformed cache, must have a data entry present")}catch(e){r.default.reportError(e)}i&&(i.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,l.cacheChanged.bind(l,e)),a=!0)}return a},l.registerForCacheChanges=function(e,t){try{r.default.PAssert(674,t,"Must provide a valid callback function for cache changes")}catch(e){r.default.reportError(e)}var a=!1,i=j[e];if(i){try{r.default.PAssert(675,i.indexOf(t)<0,"Should never double register a listener")}catch(e){r.default.reportError(e)}i.push(t)}else j[e]=[t];return l.isCacheAvailable(e)&&(a=l.hookCacheListener(e)),a},l.unregisterForCacheChanges=function(e,t){var a=j[e];try{r.default.PAssert(676,a,"Must have previously registered with a cache")}catch(e){r.default.reportError(e)}var i=a.remove(t);try{r.default.PAssert(677,i>=0,"Did not try to remove a valid listener")}catch(e){r.default.reportError(e)}return i>=0},l.loadDataCaches=function(){l.cachesRemote=l.root.get("caches"),l.cachesRemote||(l.cachesRemote=l.model.createMap(),l.root.set("caches",l.cachesRemote));try{var e=l.verifyCaches();try{r.default.PAssert(678,e,"Preview caches are not in a fully valid state")}catch(e){r.default.reportError(e)}}catch(e){r.default.reportError(e)}l.writeMissedCacheEntries(),l.sendAvailableNotifications(),l.hookCacheListeners()},l.queryCache=function(e,t){try{r.default.PAssert(679,l.cachesRemote,"Caches must have been initialized")}catch(e){r.default.reportError(e)}try{r.default.PAssert(680,!r.default.isTempId(t),"Should not query remote cache for local only items")}catch(e){r.default.reportError(e)}var a=l.ensureCache(e);if(a){var i=JSON.parse(a.get("data").get(t));if(i)return i.id=t,i}},l.hasCacheEntry=function(e,t){try{r.default.PAssert(681,l.cachesRemote,"Caches must have been initialized")}catch(e){r.default.reportError(e)}try{r.default.PAssert(682,!r.default.isTempId(t),"Should not query remote cache for local only items")}catch(e){r.default.reportError(e)}var a=l.ensureCache(e);return!!a&&!!a.get("data").get(t)},l.updateCache=function(e,t,a){try{r.default.PAssert(685,!r.default.isTempId(t),"Should never save a local only item to the remote cache")}catch(e){r.default.reportError(e)}var i,n=l.ensureCache(e),s=a;try{try{r.default.PAssert(686,!r.default.isString(a),"Should only be saving objects rather than raw strings in cache")}catch(e){r.default.reportError(e)}a=JSON.stringify(a)}catch(e){r.default.reportError(e),a=void 0}if(n){var o=K(i=n.get("data").get(t)),d=K(a);if(d<l.maxCacheEntrySize())try{var c=function(e){try{r.default.PAssert(684,!e||r.default.isObject(e),"Must always pass in a valid object")}catch(e){r.default.reportError(e)}var t={};for(var a in e)if(e.hasOwnProperty(a)){var i;try{i=r.default.isString(e[a])?e[a].length:JSON.stringify(e[a])}catch(e){r.default.reportError(e)}t[a]=i}}(s);try{r.default.PAssert(687,d<l.maxCacheEntrySize(),"New cache entry too large",d,c)}catch(e){r.default.reportError(e)}}catch(e){r.default.reportError(e)}var u=d-o,h=n.get("info");if(i||h.set("entries",h.get("entries")+1),u>0&&h.set("size",h.get("size")+u),void 0!==a)n.get("data").set(t,a);else{try{r.default.PAssert(688,i,"Should never be setting undefined->undefined")}catch(e){r.default.reportError(e)}0,n.get("data").delete(t)}}else l.notifyMissedCacheWrite(e,t,s);return i},l.ensureCache=function(e){var t;if(l.cachesRemote&&!(t=l.cachesRemote.get(e))){0,l.model.beginCompoundOperation(),t=l.model.createMap();var a=l.model.createMap();a.set("entries",0),a.set("size",0),t.set("info",a);var i=l.model.createMap();t.set("data",i),l.cachesRemote.set(e,t),l.model.endCompoundOperation()}return t},l.clearCache=function(e){try{r.default.PAssert(689,l.cachesRemote,"Caches must have been initialized")}catch(e){r.default.reportError(e)}if(l.cachesRemote){var t=l.cachesRemote.get(e);if(t){t.get("data").clear();var a=t.get("info");try{r.default.PAssert(690,a,"Malformed cache, every cache must have an info object")}catch(e){r.default.reportError(e)}a.set("entries",0),a.set("size",0)}}},l.clearCaches=function(){},l.getCacheSize=function(e){try{r.default.PAssert(691,l.cachesRemote,"Caches must have been initialized to get cache size")}catch(e){r.default.reportError(e)}if(l.cachesRemote){var t=l.cachesRemote.get(e);if(t)return t.get("info").get("size")}return 0},l.verifyCaches=function(){try{r.default.PAssert(692,l.cachesRemote,"Caches must have been initialized to verify")}catch(e){r.default.reportError(e)}try{r.default.PAssert(693,r.default.vmMain&&r.default.vmMain.pluginManager,"Must have intiialized VMMain and PluginManager")}catch(e){r.default.reportError(e)}var e=!0;if(l.cachesRemote)for(var t=l.cachesRemote.keys(),a=0;a<t.length;++a){var i=r.default.vmMain.pluginManager.getPluginFromPreviewCache(t[a]);if(i)Y(i,l.cachesRemote.get(t[a]))||(e=!1);else try{r.default.PAssert(694,!1,"Unknown plugin in preview cache: ",t[a])}catch(e){r.default.reportError(e)}}return e},l.isCacheAvailable=function(e){return!(!l.cachesRemote||!l.cachesRemote.get(e))};var X=[];l.requestNotifyWhenAvailable=function(e){try{r.default.PAssert(695,X.indexOf(e)<0,"Should not push same callback multiple times")}catch(e){r.default.reportError(e)}l.cachesRemote||r.default.isDemoMode()?e():X.push(e)},l.sendAvailableNotifications=function(){for(var e=0;e<X.length;++e)X[e]();X=[]},l.notifyMissedCacheWrite=function(e,t,a){W[e]||(W[e]={}),W[e][t]=a},l.writeMissedCacheEntries=function(){try{r.default.PAssert(696,l.cachesRemote,"When flushing missed cache writes, must have access to remote doc cache")}catch(e){r.default.reportError(e)}var e=0;for(var t in W){var a=W[t];for(var i in a){var n=a[i];l.updateCache(t,i,n),e++}}W={},e>0&&r.default.reportError(new Error("Writing missed cache entries: "+e))},l.poke=function(){if(l.root&&!l.isClosed&&!l.isReadOnly())try{var e=l.root.get("poke");0,l.model.beginCompoundOperation("poke",!1),e?l.root.set("poke",e+1):l.root.set("poke",1),l.model.endCompoundOperation()}catch(e){log("Exception during poke, reconnecting: ",e),l.close(),l.setupReconnect()}},window.__poke=l.poke,l.rootChanged=function(e){if(e.ocHandled||e.isLocal||l.root&&l.root.id!==e.target.id)return!1;for(var t=0;t<e.events.length;++t){var a=e.events[t];switch(a.type){case gapi.drive.realtime.EventType.VALUES_ADDED:case gapi.drive.realtime.EventType.VALUES_REMOVED:break;case gapi.drive.realtime.EventType.VALUE_CHANGED:if("dataVersion"===a.property)a.newValue>6?r.default.AppCache.checkForUpdate(!0):a.newVersion<6&&r.default.reportError(new Error("Remote setting dataVersion to invalid value"+a.newVersion));else if("recoverVersion"===a.property){l.clearItemEventListeners(),r.default.settings.get(Settings.localRecoverVersion)<a.newValue&&(r.default.settings.set(Settings.localRecoverVersion,a.newValue),s.a.addDefaultSkipSetting(Settings.gdocId,"Default"),s.a.addDefaultSkipSetting(Settings.gdocTitle,"Default"),l.close(!0),r.default.menus.alert({text:"A remote user has recovered this document. The app needs to restart to continue editing.",actionText:"OKAY",callback:s.a.clearDataAndReload}))}break;case gapi.drive.realtime.EventType.TEXT_DELETED:case gapi.drive.realtime.EventType.TEXT_INSERTED:case gapi.drive.realtime.EventType.VALUES_SET:default:try{r.default.PAssert(697,!1,"Unexpected event type")}catch(e){r.default.reportError(e)}}}},l.isConnected=function(){return l.initialized&&!l.isClosed&&!!l.model},l.onLoad=function(e){try{try{window.__LOAD_HANDLES.push(r.default.getCurrentStack("Document Opened Handled"))}catch(e){r.default.reportError(e)}try{r.default.PAssert(701,l.isClosed,"Document must not already be open when we are loading")}catch(e){r.default.reportError(e)}try{l.isClosed||r.default.reportError(new Error("Multi-Document Load"),window.__LOAD_REQUESTS.ordered())}catch(e){r.default.reportError(e)}return l.initialized=!0,l.loadedOnce=!0,ShouldLog(LogLevels.Timing)&&log("Loading document from gdrive",log.now()),l.doc=e,l.model=e.getModel(),l.root=l.model.getRoot(),l.isReadOnly()&&r.default.vmMain.gdriveStatusObs.notify(),l.root.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,l.rootChanged),l.isClosed=!1,l.registerForSaveStateChange(l.onSaveStateChange),l.migrateData()?(log("---- Skipping Document Load! ----"),l.isClosed=!0,l.initialized=!1,l.doc=void 0,l.model=void 0,l.root=void 0,!1):(l.loadDataCaches(),l.rootItem=l.root.get("root"),l.rootItem?(l.rootID=l.rootItem.id,window.__remoteDoc=e,p&&(l.registerForUndoRedoStateChange(p),p=void 0),r.default.vmMain&&r.default.vmMain.isLoaded?r.default.vmMain.loadGDriveData():r.default.requireGDriveDataCallback=!0,l.loadCollaborators(),!0):void r.default.menus.alert({text:"Moo.do has encountered an error. The developers have been notified to make sure this doesn't happen again. If the problem persists, please contact support@moo.do.",actionText:"RELOAD",callback:function(){s.a.clearData(function(){r.default.reload()})}}))}catch(e){r.default.reportError(e)}},l.getServerVersion=function(){if(l.model&&!l.isClosed)return l.model.serverVersion};var Q=[];l.registerSaveNotify=function(e){Q.push(e)};var J,Z=!1,$=!1;l.onSaveStateChange=function(e){if(Z!==e.isPending||$!==e.isSaving){if(e.isSaving||e.isPending)navigator.onLine?e.isSaving&&(e.isPending||r.default.vmMain.setGDriveStatus(DriveStatus.Saving),clearTimeout(J),J=setTimeout(l.onErrorSaving,l.offlineTimeoutMS)):r.default.vmMain.setGDriveStatus(DriveStatus.Offline);else{r.default.vmMain.setGDriveStatus(DriveStatus.Saved),s.a.clearPendingUpdates(),clearTimeout(J),J=void 0,r.default.toasts.clearMessage(MessageID.ConnectionError);for(var t=0;t<Q.length;++t)Q[t](l.numChanges);l.numChanges=0,l.lastChangeTime.set(Date.now())}Z=e.isPending,$=e.isSaving}},l.onErrorSaving=function(){r.default.vmMain.setGDriveStatus(DriveStatus.Offline),J=void 0},l.getVersion=function(e,t){try{r.default.PAssert(702,!r.default.isVMLI(e),"Must pass in a valid remote item: ",r.default.getObjectInfo(e))}catch(e){r.default.reportError(e)}var a;switch(t){case VersionType.Structure:a=e.get(r.default.translateFieldIn("version"));break;case VersionType.Text:a=e.get(r.default.translateFieldIn("versionText"));break;default:a=-2;try{r.default.PAssert(703,!1,"Invalid version type")}catch(e){r.default.reportError(e)}}return a||0},l.get=function(e,t){try{r.default.PAssert(704,!r.default.isVMLI(e),"Must pass in a valid remote item: ",r.default.getObjectInfo(e))}catch(e){r.default.reportError(e)}return e.get(r.default.translateFieldIn(t))},l.set=function(e,t,a){try{r.default.PAssert(705,!l.isReadOnly(),"Should never perform a write action on a read-only doc")}catch(e){r.default.reportError(e)}l.beginWriteAction();try{r.default.PAssert(706,!r.default.isVMLI(e),"Must pass in a valid remote item: ",r.default.getObjectInfo(e))}catch(e){r.default.reportError(e)}return void 0===a&&(a=null),e.set(r.default.translateFieldIn(t),a)},l.delete=function(e,t){try{r.default.PAssert(707,!l.isReadOnly(),"Should never perform a write action on a read-only doc")}catch(e){r.default.reportError(e)}l.beginWriteAction();try{r.default.PAssert(708,!r.default.isVMLI(e),"Must pass in a valid remote item: ",r.default.getObjectInfo(e))}catch(e){r.default.reportError(e)}return e.delete(r.default.translateFieldIn(t))},l.findInTree=function(e){try{r.default.PAssert(711,e,"Must provide a valid item to find")}catch(e){r.default.reportError(e)}var t=!1,a=l.getItemParent(e);if(a){var i=l.getItemList(a,!1),n=-1;if(i&&(n=i.indexOf(e)),n<0){var s=l.getItemList(a,!0);s&&(n=s.indexOf(e))>=0&&(t=!0)}}var o=void 0;return a&&n>=0&&(o={parent:a,index:n,isArchived:t}),o},t.a=l},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(10),o=(a(7),a(9)),l=a(8),d=a(23),c=a(11);function u(){this.activePane=void 0,this.startPane=void 0,this.previousEventTarget=void 0,this.previousDropTarget=void 0,this.previousHighlightElement=void 0,this.previousAbove=void 0,this.dataTransfer=void 0,this.startInfo=void 0,this.startDragItem=void 0,this.externalData=void 0,this.isDragging=!1,this.dragItem=void 0,this.draggingItems=[],this.position=void 0,this.isVisible=new o.a(!1),this.transform=new o.a({left:0,top:0}),this.linePosition=new o.a,this.isDraggingPane=new o.a(!1),this.draggingToOutline=new o.a,this.dragTargetHovered=new o.a,window.addEventListener("dragover",this.handleDragOver.bind(this)),window.addEventListener("dragleave",this.handleDragLeave.bind(this)),window.addEventListener("drop",this.handleDrop.bind(this)),i.default.dragDrop=this}u.prototype={stop:function(){this.activePane&&!this.activePane.isDestroyed()?this.activePane.notifyDragEnd():i.default.vmMain.paneManager.runForEachPane(function(e){e.notifyDragEnd()});for(var e=this.draggingItems,t=0;t<e.length;++t)e[t].item.draggedInPane.set(!1);this.draggingItems=[],this.isDragging=!1,this.dragItem=void 0,this.position=void 0,this.externalData=void 0},finish:function(){this.isVisible.set(!1),this.blockTarget=void 0,c.a.fireEvent("endDrag",[])},start:function(e,t,a,n,o,d,c,u){this.isDragging&&(this.stop(),this.finish()),i.default.vmMain.setItemAnimationMode(r.a.ItemAnimationMode.None),this.isDragging=!0,this.activePane=o,this.dragInfo=null,this.startPane=o,this.startInfo=d,this.dataTransfer=c,this.dragItem=e,this.startDragitem=e,this.fromOverview=u,this.externalData=void 0,this.draggingItems=t,this.position={left:a,top:n},this.transform.set({left:0,top:0},!1),l.a.reset();for(var h=0;h<t.length;++h)t[h].item.draggedInPane.set(i.default.focusedPane);this.isVisible.set(!0),this.activePane.notifyDragStart(),s.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.DragItem,data:{itemID:this.id,fromPane:o}})},startExternal:function(e){this.isDragging=!0,this.activePane=e,this.startPane=e,this.draggingItems=[],this.isVisible.set(!0),this.activePane.notifyDragStart()},setExternalData:function(e){this.externalData=e},setTransform:function(e,t){this.isVisible.set(!0,!1),this.transform.set({left:e,top:t})},handleDragOver:function(e){var t=i.default.elementFromPoint(e.clientX,e.clientY),a=i.default.getPaneForElement(t);if(this.activePane&&a!==this.activePane&&this.revertDrag(),a){this.isDragging||this.startExternal(a),this.activePane=a;var r=!!i.default.findParent(t,"paneOverviewScroller");a.canAcceptDragOver(e.dataTransfer.pane,e.item,t,r)?this.dragInfo=a.handleDragOver(e.dataTransfer.pane,e.item,t,e.clientX,e.clientY):this.revertDrag()}return this.linePosition.set(this.dragInfo&&this.dragInfo.linePosition),this.dragInfo&&this.dragInfo.targetElement||i.default.cancelRepeatScroll(),!1},revertDrag:function(){this.dragInfo=null,this.activePane.revertDrag()},handleDropItem:function(e,t,a){var r=e,n=this.activePane;this.isDropping=!0,i.default.cancelRepeatScroll();var s=document.elementFromPoint(t.clientX,t.clientY);if(s&&i.default.findParent(s,"mobileDropBucket"))i.default.vmMain.dropBucket.addItemEntry(e,n),this.dragTargetHovered.set(void 0);else if(this.dragInfo&&n)i.default.vmMain.beginUpdateItems(),n.handleDragDrop(e,t,this.dragInfo,a),i.default.vmMain.commitUpdateItems();else if(i.default.isNonPaneDropTarget(t.target)){var o;if(n=t.dataTransfer.pane){o=n.notifyDropFromToEdit(e,t.target);try{i.default.PAssert(1361,!o||i.default.isDOMNode(o),"Must always return DOM elements to insert")}catch(e){i.default.reportError(e)}}if(o){var l=d.a._getCursorSelectionRange(t.clientX,t.clientY);d.a.setSelectionRange(l),d.a.insertNode(o)}}return this.isDropping=!1,r},handleDrop:function(e){var t=this.activePane;if(t&&(i.default.elementInPane(e.target)||e.fromDropBucket)){var a=e.dataTransfer.item;if(this.isDragging=!1,this.isVisible.set(!1),a)this.handleDropItem(a,e);else if(!i.default.vmMain.pluginManager.handleDropEvent(e,function(a,i){s.a.beginAction();var r=t.createVMLI({text:a},{changeType:ChangeType.AllLocal,noParentOkay:!0});return r=this.handleDropItem(r,e,i),s.a.endAction(),r}.bind(this)))if(e.dataTransfer.getData(n.a.ie?"Text":"text/plain")||e.dataTransfer.getData("text/html")){var r=d.a.getCursorSelectionRange(e);try{i.default.PAssert(1362,r,"Range should always be properly set")}catch(e){i.default.reportError(e)}l.a.setFocusedPane(t),s.a.beginAction();var o=t.createVMLI({text:""},{changeType:ChangeType.AllLocal,noParentOkay:!0});o=this.handleDropItem(o,e,!0),l.a.selectItem(o,0),copypaste.insert(e.dataTransfer,e,DataSource.Drop),s.a.endAction()}else if(this.externalData){var c=this.externalData;this.externalData=void 0;var u=c.split(":"),h=(u.removeAt(0),"["+u.removeAt(0)+"]("+u.join(":")+")");s.a.beginAction();o=t.createVMLI({text:h},{changeType:ChangeType.AllLocal});o=this.handleDropItem(o,e,!0),s.a.endAction()}}else i.default.isNonPaneDropTarget(e.target)&&e.dataTransfer.item&&this.handleDropItem(e.dataTransfer.item,e);i.default.vmMain.resetItemAnimationMode(),e.stopPropagation(),e.preventDefault()},handleDragLeave:function(e){e.clientX||e.clientY||(this.isDragging=!1,this.isVisible.set(!1))},setBlockTarget:function(e){this.blockTarget=e},stopDraggingToOutline:function(){var e=this.draggingToOutline.get();e&&e.pane&&setTimeout(function(){i.default.vmMain.switchPaneMobile(e.pane.type,!0)},300),this.dragTargetHovered.set(void 0),this.draggingToOutline.set(void 0)}},t.a=new u},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(9);function s(e,t){this._super.constructor.call(this,e,t),this._value=e||[],this.version=0}var o={notify:function(e,t,a){0===arguments.length&&this.version++,this._super.notify.apply(this,arguments)},length:function(){return this._value.length},set:function(e,t){try{i.default.PAssert(1397,e&&i.default.isArray(e),"Value set on an Observable array must be an array",e)}catch(e){i.default.reportError(e)}this._value=e,this.version++,!1!==t&&this.notify(this._value)},clear:function(e){this.set([],e)},remove:function(e,t){var a=[];if(i.default.isFunction(e))for(var r=0;r<this._value.length;r++){var n=this._value[r];e(n)&&(a.push(n),this._value.splice(r,1),r--)}else a=this._value.remove(e);return this.version++,!1!==t&&this.notify(this._value),a},removeAt:function(e,t){var a=this._value.removeAt(e);return this.version++,!1!==t&&this.notify(this._value),a},push:function(e,t){var a=this._value.push(e);return this.version++,!1!==t&&this.notify(this._value),a},insertSorted:function(e,t,a){var i=this._value.insertSorted(e,t);return this.version++,!1!==a&&this.notify(this._value),i},splice:function(e,t,a,i){var r;return r=a?this._value.splice(e,t,a):this._value.splice(e,t),this.version++,!1!==i&&this.notify(this._value),r},indexOf:function(e){return this._value.indexOf(e)},indexOfWithProperty:function(e,t){return this._value.indexOfWithProperty(e,t)}};r.a.inherit(n.a,s),r.a.extend(s.prototype,o),t.a=s},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(7),s=a(5),o=a(44),l=a(10),d=a(118),c=a(4),u=a(13),h=a(11),f=a(9),p=a(19),m=(a(38),a(81)),g=a(8),v=a(36),y=a(18),S=a(24),E=a(23),P=a(59),b=a(29),C=a(14),D=a(27),I=a(82),A=a(28),M=(a(37),0);function _(e){this.__ISPANE=!0,this.setPropDefault("title","Tasks"),this.setPropDefault("contextMenuMode",r.a.ContextMenuMode.Default),this.setPropDefault("paneEmptyMessage","Start typing to get started"),this.setPropDefault("paneEmptySearchMessage","No search results"),this.setPropDefault("titleContextMenuHeader","Zoom to item"),this.setPropDefault("overviewEmptyMessage","No lists in this item"),this.setPropDefault("searchFilters",[]),this.setPropDefault("dropEffect",function(){return r.a.DropEffect.Move}),this.setPropDefault("isWriteable",!0),this.setPropDefault("isEditable",!1),this.setPropDefault("isDraggable",!0),this.setPropDefault("isDropTarget",!0),this.setPropDefault("hasNonVMLIs",!1),this.setPropDefault("canAddItem",!0),this.setPropDefault("overrideCopyBehavior",!0),this.setPropDefault("supportMenuIcon",!1),this.setPropDefault("supportCollapsing",!0),this.setPropDefault("supportCompleting",!0),this.setPropDefault("supportCheckbox",!1),this.setPropDefault("supportArchiving",!1),this.setPropDefault("supportIndent",!0),this.setPropDefault("supportOffline",!0),this.setPropDefault("supportPerformArchive",!0),this.setPropDefault("supportDataRefresh",!1),this.setPropDefault("supportReportError",!1),this.setPropDefault("supportCompose",!1),this.setPropDefault("supportPagination",!1),this.setPropDefault("supportVertLines",!0),this.setPropDefault("supportStarClick",!1),this.setPropDefault("supportSearchItemAutocomplete",!0),this.setPropDefault("supportSearchListenTextChanges",!0),this.setPropDefault("supportSearchFlat",!0),this.setPropDefault("supportLocalSearch",!0),this.setPropDefault("supportClone",!0),this.setPropDefault("supportDates",!0),this.setPropDefault("supportMultiselect",!0),this.setPropDefault("supportDeferredItemLoad",!1),this.setPropDefault("supportCellTransition",!0),this.setPropDefault("supportViewMenu",!1),this.setPropDefault("showRootOnRow2",!1),this.setPropDefault("useLineCache",!0),this.setPropDefault("supportSel",!0),this.setPropDefault("shouldSearchMatchParents",!0),this.setPropDefault("shouldUpdateOnTextChanged",!0),this.setPropDefault("noOverviewStyle",!1),this.setPropDefault("supportClickOverviewScroll",!0),this.setPropDefault("overviewTracksScroll",!0),this.setPropDefault("overviewHasPaneItems",!0),this.setPropDefault("overviewPadLevels",0),this.setPropDefault("minWidth",r.a.StdPaneWidthMin),this.setPropDefault("maxWidth",r.a.StdPaneWidthMax),this.setPropDefault("hasMoreButtons",!0),this.setPropDefault("_topBoxHeight",i.default.activeDisplayMode&DisplayMode.NoPaneTop?0:36),this.topBoxHeight=new f.a(this._topBoxHeight),this.rect=new f.a(e.rect),this.isExpanded=new f.a(!1);try{i.default.PAssert(1224,void 0!==e.id,"Must supply a valid pane id")}catch(e){i.default.reportError(e)}this.id=e.id,this.uniquePaneID=M++,e.item||(this.supportDeferredItemLoad?(e.item=this.getDefaultDisplayItem(),this.deferredItemState={itemID:e.deferredItemID,search:e.search,offset:0}):(e.item=this.getDefaultDisplayItem(),e.search=e.search||"")),this.name=new f.a(e.name),this.item=new f.a(e.item),this.items=new p.a,this.headers=new p.a,this.isDefaultPane=e.isDefaultPane,this.initialOffset=e.offset,this.itemsDirtyState=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.reloading=!1,this.showArchived=new f.a(!1),this._panePadding=0,this.paneTopText=new f.a,this.isInitialized=!1,this.isLoaded=!1,this._didInitialScroll=!1,this.isLoading=new f.a(!1),this.isFocused=new f.a(!1),this.caretPosition=new f.a,this.isReady=new f.a(!this.plugin||this.plugin.isReady()),this.isActive=new f.a(!0),this.hasBeenActive=this.isActive.get(),this.hasCollapsedObs=new f.a,s.a.forceBind("getItems",this),s.a.forceBind("getHeaders",this),s.a.forceBind("getWidth",this),s.a.forceBind("getHeight",this),s.a.forceBind("zoomInOnSwipe",this),s.a.forceBind("getMinItemSize",this),s.a.forceBind("onInputAndroid",this),s.a.forceBind("onInputSetText",this),this._infiniteList=new P.a({pane:this,offset:e.offset||0,isOverview:!1,itemsObs:this.items,itemsFn:this.getItems,widthFn:this.getWidth,heightFn:this.getHeight,intialOffset:this.initialOffset,minItemSize:this.getMinItemSize}),this.useCustomScroller=this._infiniteList.useCustomScroller,this.isLoadingNewPage=new f.a(!1),this.orientation=new f.a(r.a.Orientation.Vertical),this.showScrollbars=new f.a(!0),this._perPaneState={},this._destroyed=!1,this._numItemComputes=0,this._numHeaderComputes=0,this._numItemSets=0,this.isAnimatingOffset=!1,this._ignoreRestoreScroll=!1,this._activeItemStores={},this.defaultOffset=0,s.a.forceBind("onInput",this),s.a.forceBind("compositionStart",this),s.a.forceBind("compositionEnd",this),s.a.forceBind("onShowArchivedChanged",this),s.a.forceBind("updateItems",this),this.showArchived.listen(this.onShowArchivedChanged),this.search=new m.a(this,e.search,this.onSearchChanged.bind(this)),this.overview=new d.a(this,e.isOverviewVisible)}_.prototype={init:function(){this.getItem()&&this.setItem(this.getItem(),!1),this.plugin&&this.plugin.notifyPaneCreated(this)},isDestroyed:function(){return this._destroyed},getStats:function(){return{numItemComputes:this._numItemComputes,numHeaderComputes:this._numHeaderComputes,numItemSets:this._numItemSets}},activate:function(){try{i.default.PAssert(1225,!1,"Activating panes should only ever happen on mobile devices")}catch(e){i.default.reportError(e)}this.isActive.set(!0),this.hasBeenActive=!0,this.updateItemsImmediate(!0,!1)},deactivate:function(){try{i.default.PAssert(1226,!1,"Deactivating panes should only ever happen on mobile devices")}catch(e){i.default.reportError(e)}this.isActive.set(!1)},destroy:function(){this._destroyed=!0,this.plugin&&this.plugin.notifyPaneDestroyed(this),this.showArchived.unlisten(this.onShowArchivedChanged),this.search.destroy(),this.search=void 0,this.overview.destroy(),this.overview=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.hiddenInput=void 0,this._onAfterLoadedRAF&&(cancelAnimationFrame(this._onAfterLoadedRAF),this._onAfterLoadedRAF=void 0),this.isLoaded&&this.getItemStore()===i.default.vmMain.itemStoreManager.getDefaultItemStore()&&(h.a.unlisten("itemNoteSet",this._infiniteList.handleItemNoteSet),h.a.unlisten("itemTextChanged",this._infiniteList.handleItemTextChanged),h.a.unlisten("itemBoldChanged",this._infiniteList.handleItemBoldChanged)),this._infiniteList=void 0;try{i.default.PAssert(1227,i.default.focusedPane!==this,"Globally focused pane should never be the one destroyed")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1228,g.a.getPane()!==this,"Selection focused pane should never be the one destroyed")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1229,!i.default.vmMain.paneManager.isPaneActive(this.id),"Pane manager has reference to pane in map to destroyed pane")}catch(e){i.default.reportError(e)}s.a.destroy(this)},notifyPluginLoaded:function(){try{i.default.PAssert(1230,!1,"Plugin load notification not supported by pane type: ",this.type)}catch(e){i.default.reportError(e)}},getContextMenuMode:function(e){return this.contextMenuMode},isItemDraggable:function(e){return this.isDraggable},getInfiniteList:function(e){var t;if(e){var a=this.getOverview();try{i.default.PAssert(1231,a,"Trying to get infinite list for overview that doesnt exist.")}catch(e){i.default.reportError(e)}a&&(t=a.getInfiniteList())}else t=this._infiniteList;return t},getItemStore:function(){return i.default.vmMain.itemStoreManager.getDefaultItemStore()},usesItemStore:function(e){return e===this.getItemStore()||!!this._activeItemStores[e.id]},useItemStore:function(e){try{i.default.PAssert(1232,!this._activeItemStores[e.id],"Should never use the same store twice")}catch(e){i.default.reportError(e)}this._activeItemStores[e.id]=e},stopUsingItemStore:function(e){try{i.default.PAssert(1233,this._activeItemStores[e.id],"Must be using item store to stop using it")}catch(e){i.default.reportError(e)}delete this._activeItemStores[e.id]},getOverview:function(){return this.overview},isOverviewVisible:function(){return this.overview.isVisible.get()},getiScroller:function(){return this._infiniteList.iScroller},numItems:function(){return this.getItems().length},getItems:function(){return i.default.vmMain.flushItemsUpdate(this),this.items.get()},getHeaders:function(){return this.headers.get()},itemAtIndex:function(e){return this._infiniteList.itemAtIndex(e)},objectAtIndex:function(e){return this._infiniteList.objectAtIndex(e)},indexOfItem:function(e,t,a){return this._infiniteList.indexOfItem(e,t,a)},indexOfObject:function(e){return this._infiniteList.indexOfItem(e)},topOfItem:function(e){return this._infiniteList.topOfItem(e,this.topBoxHeight.get())},topOfIndex:function(e){return this._infiniteList.topOfIndex(e,this.topBoxHeight.get())},indexOfTop:function(){return this._infiniteList.indexOfTop()},inViewCount:function(){return this._infiniteList.inViewCount()},itemAtTop:function(){return this._infiniteList.itemAtTop()},elementAtIndex:function(e){return this._infiniteList.getElementAtIndex(e)},isIndexMounted:function(e){return this._infiniteList.isIndexMounted(e)},notifyDragStart:function(){return this._infiniteList.notifyDragStart()},notifyDragEnd:function(){return this._infiniteList.notifyDragEnd()},notifySwappedIn:function(e){return this._infiniteList.notifySwappedIn(e)},getScrollOffset:function(){return this._infiniteList.getScrollOffset()},addScrollListener:function(e){return this._infiniteList.addScrollListener(e)},removeScrollListener:function(e){return this._infiniteList.removeScrollListener(e)},refreshScrollListener:function(){return this._infiniteList.refreshScrollListener()},setScrollOffset:function(e,t,a){return this._infiniteList.setScrollOffset(e,t,a)},scrollIndexIntoView:function(e,t,a){return this._infiniteList.scrollIndexIntoView(e,t,a)},scrollItemIntoView:function(e,t,a){return this._infiniteList.scrollItemIntoView(e,t,a)},scrollIndexToTop:function(e,t,a){return this._infiniteList.scrollIndexToTop(e,t,a)},scrollItemToTop:function(e,t,a){return this._infiniteList.scrollItemToTop(e,t,a)},scrollItemToMiddle:function(e,t,a){return this._infiniteList.scrollItemToMiddle(e,t,a)},scrollIndexToMiddle:function(e,t,a){return this._infiniteList.scrollIndexToMiddle(e,t,a)},addScrollDelta:function(e){return!!this._infiniteList&&this._infiniteList.addScrollDelta(e)},addPadding:function(){return this._infiniteList.addPadding()},removePadding:function(){return this._infiniteList.removePadding()},getScrollTop:function(){return this._infiniteList.getScrollTop()},closestIndexOfObject:function(e){return this.indexOfObject(e)},sizeAtIndex:function(e,t){var a=0,r=t?this.overview._infiniteList:this._infiniteList;try{i.default.PAssert(1235,r,"Must have a valid owner")}catch(e){i.default.reportError(e)}if(r){var n=r.objectAtIndex(e);try{i.default.PAssert(1236,n,"Must have found a valid item")}catch(e){i.default.reportError(e)}n&&(a=this.sizeOfItem(n,e,t))}return a},sizeOfItem:function(e,t,a){try{i.default.PAssert(1237,e,"Must provide a valid item to measure")}catch(e){i.default.reportError(e)}var r=0,n=e.sizeInPane;return void 0!==n&&(r=isNaN(n)?e.sizeInPane(this,t,a):n,e.sizePad&&(r+=e.sizePad)),r},getPaneDoc:function(){return i.default.vmMain.docManager.getOpenDoc()},handleStatusClick:function(){},_getLoadingMessage:function(){return"Loading..."},getStatusMessage:function(e){var t;return e?0===this.headers.length()&&(t=this.overviewEmptyMessage):this.isLoading.get()?t=this._getLoadingMessage():0===this.numItems()?t=this.isSearched()?this.paneEmptySearchMessage:this.paneEmptyMessage:this.isReady.get()||(t=this._getNotReadyStatus()),t},_getNotReadyStatus:function(){return"Pane data is only available while online."},copyStateFrom:function(e){this.getItem()!==e.getItem()&&this.setItem(e.getItem())},getSaveInfo:function(){return{id:this.id,name:this.name.get(),item:this.getItem().id,type:this.type,showarch:this.showArchived.get(),search:this.search.getState(),offset:this.getScrollOffset(),itemState:this.getSaveInfoItemState(),isOverviewVisible:this.overview.isVisible.get(),isExpanded:this.isExpanded.get()}},getSaveInfoItemState:function(){var e=this._perPaneState,t={};for(var a in e)if(e.hasOwnProperty(a)){var i=n.a.getModel(a);if(i){var s=e[a];for(var o in s)if(s.hasOwnProperty(o)&&o!==r.a.PerPaneStateField.CollapsedOverview&&o.startsWith(r.a.PerPaneStateField.Collapsed)){var l=s[o],d=o.replace(r.a.PerPaneStateField.Collapsed,"");if("Search"===d||l!==this.getCollapsedDefault(i,!1,d)||!l&&i.isDemandLoad()){var c=(s[o]?"":"un")+o;t[c]||(t[c]=[]),t[c].push(a)}}}else delete e[a]}return t},getPerPaneState:function(e,t){if(this._perPaneState[e])return this._perPaneState[e][t]},setPerPaneState:function(e,t,a){this._perPaneState[e]||(this._perPaneState[e]={}),this._perPaneState[e][t]=a},clearPerPaneStateSearch:function(){var e=this._perPaneState;for(var t in e)e.hasOwnProperty(t)&&(e[t][r.a.PerPaneStateField.CollapsedSearch]=void 0)},deletePerPaneState:function(e){this._perPaneState[e]=void 0},isSearched:function(){try{i.default.PAssert(1238,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){i.default.reportError(e)}return!!this.search&&this.search.isSearched()},isSearchedFlat:function(){return!1},onSearchChanged:function(){var e=g.a.isValid();if(e&&g.a.reset(),this.updateItems(),e&&this.numItems()>0){var t=this.indexOfFirstItem();t>=0&&g.a.selectIndex(t,0)}i.default.vmMain.paneManager.updatePaneStateForPane(this)},refreshSearchResults:function(){this.updateItems(!0)},_applyItemStateArr:function(e,t,a){if(e)for(var i=0;i<e.length;i++){var r=e[i];this.setPerPaneState(r,t,a)}},applyItemState:function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)){var a=t.startsWith("un"+r.a.PerPaneStateField.Collapsed)?t.slice(2):t;if(a.startsWith(r.a.PerPaneStateField.Collapsed)){var i=e[t];this._applyItemStateArr(i,a,!t.startsWith("un"))}}},requestDemandLoadData:function(e,t){try{i.default.PAssert(1239,!1,"SubClass must override - by default demand load is not supported")}catch(e){i.default.reportError(e)}},requestDataPage:function(e){try{i.default.PAssert(1240,!1,"SubClass must override - by default data pagination is not supported")}catch(e){i.default.reportError(e)}},getDefaultDisplayItem:function(){return this.getRootItem()},getRootItem:function(){return i.default.vmMain.root()},setRootItem:function(e,t){try{i.default.PAssert(1241,void 0===e.parent(),"Root should never have a parent")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1242,this.getItem()!==e,"Should not be setting root to the same value")}catch(e){i.default.reportError(e)}this.setItem(e,t)},onTapSection:function(e){i.default.vmMain.vmPicker.onTapSection(e)},scrollFromMousePosition:function(e){var t,a=this.getHeight()-r.a.MobileBottomHeight,n=a-80,s=e-this.contentTop();s<80?(t=3*-(1-i.default.computeScrollSpeed(0,80,s)),i.default.repeatScroll(t,this)):s>=n?(t=3*i.default.computeScrollSpeed(n,a,s),i.default.repeatScroll(t,this)):i.default.cancelRepeatScroll()},getContentElement:function(){return this.paneContent},getPaneIcon:function(){return"icon-align-left"},itemHasChildren:function(){return this.getItem().numItems()>0},getItem:function(){return this.item.get()},allowZoom:function(e){return!0},performOverviewAction:function(e){},setItem:function(e,t){this._numItemSets++;var a=this.getItem();this.item.set(e,!1),this.updateItemsImmediate(!0,!1,!0),a.parent()&&a._updateStylePadding(a.parent().levelsDeep.get(),!0),t&&(e.itemChanged.notify(),e!==a&&a.itemChanged.notify(),this.item.notify(e,a))},getItemSearchParams:function(){return{item:this.getItem(),comparator:this.search.isMatched,noCollapsed:!0,includeNotes:!0,pane:this}},getHeaderSearchParams:function(){return{item:this.getRootItem(),comparator:this.search.isMatched,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}},setItemsDirty:function(){this._setDirtyState(!1,!1)},isItemsDirty:function(){return!!this.itemsDirtyState},_setDirtyState:function(e,t){this.itemsDirtyState?(this.itemsDirtyState.updateSearch=e||this.itemsDirtyState.updateSearch,this.itemsDirtyState.forceNotify=t||this.itemsDirtyState.forceNotify):this.itemsDirtyState={updateSearch:e,forceNotify:t}},updateItems:function(e,t){this._setDirtyState(e,t),i.default.vmMain.updateAllItems()},updateItemsImmediate:function(e,t,a,i){if(this.isActive.get()){this.itemsDirtyState&&(e=e||this.itemsDirtyState.updateSearch,t=t||this.itemsDirtyState.forceNotify,this.itemsDirtyState=void 0),this.search.update(void 0,void 0,!i);var r=this.item.get(),n=[],s=this.getItemSearchParams(),o=s.each,l=this.hasCollapsed();s.each=function(e){e.isNote()&&e.parent()===r||(n.push(e),o&&o(e))},this.runItemSearch(s),this.hasCollapsedObs.set(l),this._numItemComputes++,this.setItems(n,t),this.updateHeaders(t||a),this.isInitialized||(this.isInitialized=!0),h.a.fireEvent("itemsUpdated",[this])}},runItemSearch:function(e){i.default.searchVMLIs(e)},updateOutline:function(e,t){var a=[],i={},r=this.getItem().levelsDeep.get();if(t){var n=[];for(o=0;o<e.length;o++)e[o].isNote()||n.push({item:e[o],index:n.length});for(n.sort(t),e=[],o=0;o<n.length;o++){var s=n[o].item;e.push(s),s.hasNote()&&e.push(s.getNote())}}for(var o=0;o<e.length;o++){s=e[o];var l=new I.a({type:"blockItem",item:s,id:s.id,index:o,parentObject:i[s.parent().id],levelsDeep:(s.isNote()?s.parent():s).levelsDeep.get()-r-1,sizeInPane:s.sizeInPane});i[s.id]=l,a.push(l)}this.items.set(a)},_setItems:function(e,t){this.updateOutline(e)},setItems:function(e,t){!t&&this._searchShowHierarchy===this.search.showHierarchy()&&e.equals(this._allPaneItems)||(this._allPaneItems=e,this._setItems(e,t),g.a.getPane()===this&&g.a.checkValid())},updateHeaders:function(e){var t=[],a=this.getHeaderSearchParams();a.each=function(e){t.push(e)},i.default.searchVMLIs(a),this._numHeaderComputes++,this.setHeaders(t,e)},setHeaders:function(e,t){!t&&e.equals(this.headers.get())||this.headers.set(e)},clearItems:function(e){this.items.set([],e)},onLoad:function(){this.isLoaded=!0,this.getItemStore()===i.default.vmMain.itemStoreManager.getDefaultItemStore()&&(h.a.listen("itemNoteSet",this._infiniteList.handleItemNoteSet),h.a.listen("itemTextChanged",this._infiniteList.handleItemTextChanged),h.a.listen("itemBoldChanged",this._infiniteList.handleItemBoldChanged)),this._onAfterLoadedRAF=requestAnimationFrame(this.onAfterLoaded.bind(this))},onInfiniteListLoaded:function(){},onInfiniteListMounted:function(){},onAfterLoaded:function(){this._onAfterLoadedRAF=void 0,this._didInitialScroll||this.isDestroyed()||(isNaN(this.initialOffset)&&(this.initialOffset=this.defaultOffset),0!==this.initialOffset&&this.setScrollOffset(this.initialOffset),this._didInitialScroll=!0,this._infiniteList.saveScrollOfTop())},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){if(this.isExpanded.get())return r.a.ExpandedPaneWidth;var e=this.rect.get().width;try{i.default.PAssert(1243,e>100,"Pane width is not set",this.rect.get())}catch(e){i.default.reportError(e)}return e>100?e:void 0},getHeight:function(){return this.rect.get().height-this.headerHeight()},getLeft:function(){return this.rect.get().left},toggleOverviewVisibility:function(){this.getOverview().toggleDesktop()},notifyDropFrom:function(e){},notifyDropFromToEdit:function(e,t){if(!e.hasChildren()&&e.hasAttachmentType(r.a.PluginType.Storage))return e.getAttachmentByType(r.a.PluginType.Storage).getPlugin().notifyDropFromToEdit(e,t);var a=document.createElement("ul");return a.innerHTML=n.a.toDropHtml(e),a},dropEffectCopyBehavior:function(e,t){return e.clone(t,ChangeType.Local)},convertElementToText:function(e){var t="";if("TEXTAREA"===e.nodeName)t+=e.value;else if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(e.classList.contains("plugin"))t+=r.a.AttachChar;else for(var a=0;a<e.childNodes.length;a++)t+=this.convertElementToText(e.childNodes[a]);return t},onInputAndroid:function(e){if(e.target&&i.default.findParent(e.target,"item")===g.a.getStartElement()){var t=this.convertElementToText(e.target),a=E.a.getSelectOffsetsInElement(e.target),r=g.a.getStartIndex(),n=t.indexOf("\n");if(!this._hasDetectedEnterAndroid)if(n>=0)n===a.start&&(i.default.clearTimeoutOnce("androidInputSetText"),this.setDetectedEnterAndroid(),g.a.fireKeyEvent(void 0,{normCode:KeyCode.Enter}));else{var s=g.a.getStartItem();i.default.timeoutOnce("androidInputSetText",this.onInputSetText,0,s,t,r,a.start,a.end)}}},onInput:function(e){if(g.a.isValid()){var t=g.a.getStartItem(),a=this.convertElementToText(e.target),r=E.a._getSelectionRange(),n=i.default.getElementParent(e.target),s=E.a.getSelectOffsetsInElement(n,r),o=g.a.getStartIndex();this.onInputSetText(t,a,o,s.start,s.end,e)}},onInputSetText:function(e,t,a,i,r,n){if(!this._hasDetectedEnterAndroid){t=t.replace(new RegExp(TextSpace,"g"),"");var s=DuchessHelpers.checkMultiplePrefixes(t);if(s!==t){var l=t.length-s.length;i-=l,r-=l,t=s}this.isSettingText=!0,e.setText(t,!0,ChangeType.Local),t.length>0&&(c.a.ios?g.a.selectIndex(a,i,r):c.a.android||g.a.selectIndex(a,r)),this.isSettingText=!1,o.a.updateAutocomplete(n)}this._hasDetectedEnterAndroid=!1},setDetectedEnterAndroid:function(){this._hasDetectedEnterAndroid=!0,setTimeout(function(){this._hasDetectedEnterAndroid=!1}.bind(this),0)},updateSelectionAndroid:function(e){if(c.a.android&&!this._hasDetectedEnterAndroid){var t=i.default.hasClass(e.target,"item")&&e.target.firstElementChild||i.default.hasClass(e.target,"androidInput")&&e.target;if(t){var a=g.a.getStartIndex(),r=E.a.getSelectOffsetsInElement(t);g.a.setSelection(a,r.start,a,r.end)}}},keydown:function(e){if(e.handled)return!0;if(this.updateSelectionAndroid(e),this.isWriteable&&0===this.numItems()&&this.canAddItem&&!i.default.hasClass(this.paneContent,"loading")&&r.a.KeyCodesModifiers.indexOf(e.normCode)<0&&r.a.KeyCodesArrows.indexOf(e.normCode)<0&&this.addItem(e),g.a.isValid())if(i.default.autocomplete&&!i.default.autocomplete.onkeydown(e))i.default.preventDefault(e),i.default.stopPropagation(e);else{this.getInfiniteList(!1).reMount(),0!==this.numItems()||i.default.hasClass(this.paneContent,"loading")||this.addItem(e);try{o.a.keydown(this,e)||(i.default.preventDefault(e),i.default.stopPropagation(e))}catch(t){i.default.reportError(t,e)}}},keypress:function(e){if(g.a.isValid()){c.a.android&&e.normCode===KeyCode.Enter&&this.setDetectedEnterAndroid();try{o.a.keypress(this,e)||(i.default.preventDefault(e),i.default.stopPropagation(e))}catch(t){i.default.reportError(t,e)}}},keyup:function(e){if(i.default.vmMain.notifyActivity(),g.a.isValid())try{o.a.keyup(this,e)||(i.default.preventDefault(e),i.default.stopPropagation(e))}catch(t){i.default.reportError(t,e)}},compositionStart:function(){g.a.isComposing=!0},compositionEnd:function(e){g.a.isComposing=!1},addItemToPane:function(e,t){var a=this.getItem();e||(e=""),this.setIgnoreRestoreScroll();var i=a.addItemAtIndex(e,t,this);return v.a.setSelected([t],this),i},runUnarchive:function(e){var t=function(e){e.isArchived()&&e.parent().unarchiveChild(e,ChangeType.Local)},a=function(){if(e.hasArchivedAncestor())for(var t=e.getCollapsedField(this,!1),a=e.parent();void 0!==a&&(void 0===this.getPerPaneState(a.id,t)&&a.setCollapsed(!1,this,!1),!a.isArchived());)a=a.parent()}.bind(this);e.hasArchivedAncestor()?i.default.menus.options("An ancestor of this item is still archived. Which items do you want to unarchive?",["Entire Tree","Single Item"],function(r){("Single Item"===r||"Entire Tree"===r)&&(a(),"Single Item"===r?t(e):"Entire Tree"===r&&i.default.vmMain.runFnOnSubtree(e.getArchivedAncestor(!0),t))}):e.hasArchivedDescendant()?i.default.menus.options("Which items do you want to unarchive?",["Entire Subtree","Single Item"],function(r){("Single Item"===r||"Entire Subtree"===r)&&(a(),"Single Item"===r?t(e):"Entire Subtree"===r&&i.default.vmMain.runFnOnSubtree(e,t))}):(a(),t(e)),g.a.reset()},archiveItem:function(e,t){return t.parent().archiveChild(t,ChangeType.Local)},archiveSelected:function(){var e=0,t=this.indexOfPrevVMLI(g.a.getStartIndex(),!0,!0);if(i.default.vmMain.applyToSelection(function(t){this.archiveItem(!0,t)&&e++}.bind(this)),e>0){if(t<0&&this.numItems()>0&&(t=this.indexOfFirstItem()),t>=0){var a=this.itemAtIndex(t).getParsedText().length;g.a.selectIndex(t,a)}var r=e>1?" items.":" item.";i.default.toasts.pushMessage({text:"Archived "+e+r,action:MessageAction.Undo,hold:!1,timeout:8e3})}},deleteSelected:function(e,t){var a=this.indexOfPrevVMLI(g.a.getStartIndex(),!0,!0);if(i.default.vmMain.applyToSelection(function(t){e&&!e(t)||t.deleteSelf(ChangeType.Local)}),a<0&&this.numItems()>0&&(a=this.indexOfFirstItem()),a>=0){var r=this.itemAtIndex(a);if(r){var n=r.getParsedText().length;g.a.selectIndex(a,n)}else g.a.reset()}},handleLeftSideTap:function(e,t){if(this.supportCollapsing)if(c.a.mac&&t.metaKey||!c.a.mac&&t.ctrlKey)i.default.vmMain.zoomin(e);else if(e.isCollapsible()){var a=g.a.save();e.toggleCollapsed(this),a&&this.restoreSelectionAfterCollapse(a,e)}},handleRightSideTap:function(e){},onClickTitle:function(e){i.default.vmMain.zoomout(e),i.default.sendEvent("Menu","Title")},onDoubleClickTitle:function(){this.toggleCollapseAll()},onTap:{onStart:function(e){var t;if(this._disableClick)i.default.preventDefault(e);else if(!i.default.findParent(e.target,"itemNotInPane")&&!i.default.hasClass(e.target,"androidInput")&&(this.getInfiniteList(!1).reMount(),this.getInfiniteList(!0).reMount(),g.a.setFocusedPane(this),(t=i.default.dataFor(e.target,!0))!==this)){var a=i.default.getIndexForElement(e.target);t&&t.onStart&&t.onStart(a,e)}},onMove:function(e){if(i.default.isAttachedToDoc(e.target)&&!i.default.findParent(e.target,"itemNotInPane")&&!i.default.hasClass(e.target,"androidInput")){0,i.default.autocomplete;var t=i.default.dataFor(e.startSrc,!0),a=!1;return y.a.isDragging&&(t=y.a.dragItem),t&&t.onMove&&t.onMove(e,a),!1}},onClick:function(e){if(!i.default.findParent(e.target,"itemNotInPane")&&!i.default.hasClass(e.target,"androidInput")){var t,a=i.default.dataFor(e.startSrc,!0);a&&(e.targetItem=a),a&&a.onClick?(void 0===t&&(t=i.default.getIndexForElement(e.startSrc)),this.onClickItem(t,a,e)):i.default.hasClass(e.startSrc,"paneDataPageLoad")||e.startSrc.parentElement&&i.default.hasClass(e.startSrc.parentElement,"paneDataPageLoad")?this.getItem().hasPaginationToken()&&this.requestDataPage(this.getItem()):i.default.hasClass(e.startSrc,"agendaCollapser")||i.default.preventDefault(e)}},onEnd:function(e){var t=e.targetItem||i.default.dataFor(e.startSrc,!0);y.a.isDragging&&(t=y.a.dragItem),t&&("paneContent"===e.startSrc.id&&i.default.preventDefault(e),t&&t.onEnd&&t.onEnd(e))},onDoubleClick:function(e){if(!i.default.findParent(e.target,"itemNotInPane")){var t=i.default.dataFor(e.startSrc,!0);if(t&&t.onDoubleClick){var a=i.default.getIndexForElement(e.startSrc);this.onDoubleClickItem(a,t,e)}}},onRightClick:function(e){if(!i.default.findParent(e.target,"itemNotInPane")&&!i.default.isDisplayModeActive(DisplayMode.NoRightClick)){g.a.setFocusedPane(this);var t=i.default.dataFor(e.target,!0);if(t&&t.onRightClick){var a=i.default.getIndexForElement(e.target);this.onRightClickItem(a,t,e)}l.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.RightClick,data:{element:void 0,pane:this}})}}},onClickItem:function(e,t,a){t.isNote()||t.onClick(e,a)},onRightClickItem:function(e,t,a){t.onRightClick(e,a)},onDoubleClickItem:function(e,t,a){t.onDoubleClick(e,a)},addItem:function(e,t){if(t=i.default.getDefaultItemText()+(t||""),g.a.reset(),this.addItemToPane(t,0),this.paneContent){g.a.focusPane(this);var a=this.indexOfFirstItem();a>=0&&g.a.selectIndex(a,t.length)}i.default.sendEvent("Menu","AddItemButton")},onClose:function(){},onTapAddItem:function(e,t){this.addItem(e,t)},onTapOverviewButton:function(){this.toggleOverviewVisibility(),this.isOverviewVisible()?i.default.sendEvent("Menu","OpenOverview"):i.default.sendEvent("Menu","CloseOverview")},onTapClosePane:function(){var e=i.default.vmMain.paneManager.removePane(this);if(e){try{i.default.PAssert(1244,e===this.id,"Pane IDs must match")}catch(e){i.default.reportError(e)}l.a.performAction(TrackerType.UIAction,{type:TrackerUIAction.RemovePane,data:e}),i.default.sendEvent("Menu","ClosePane"),i.default.tooltip.hideTip(),this.onClose()}},onTapArchiveCompleted:{onStart:function(e){e.stopImmediatePropagation()},onClick:function(e){this.archiveCompleted(),i.default.handlerPreventStop(e),i.default.sendEvent("Menu","ArchiveCompleted")}},onTapRefreshData:{onStart:function(e){e.stopImmediatePropagation()},onClick:function(e){try{i.default.PAssert(1245,this.supportDataRefresh,"How did this pane try to perform a data refresh if it is not supported",this.type)}catch(e){i.default.reportError(e)}this.refreshPaneData(),i.default.sendEvent("Menu","PaneDataRefresh"),i.default.handlerPreventStop(e)}},onTapReportError:{onStart:function(e){e.stopImmediatePropagation()},onClick:function(e){try{i.default.PAssert(1246,this.supportReportError,"Pane does not support error reporting")}catch(e){i.default.reportError(e)}this.reportPaneError(),i.default.sendEvent("Menu","PaneReportError"),i.default.handlerPreventStop(e)}},getItemsToArchive:function(){var e=[];i.default.vmMain.itemStoreManager.getDefaultItemStore();return i.default.searchVMLIs({item:this.getItem(),each:function(t){t.isComplete()&&!t.isNote()&&e.push(t)}}),e},archiveCompleted:function(){var e,t,a;if(g.a.isValid())for(t=g.a.getEndIndex();t<this.items.length();){if((a=this.itemAtIndex(t))&&!this.itemAtIndex(t).hasCompletedAncestor()){e=this.objectAtIndex(t);break}t++}var r=this.getItemsToArchive();for(l.a.beginAction(),i.default.vmMain.beginUpdateItems(),t=r.length-1;t>=0;t--)(a=r[t]).parent().archiveChild(a,ChangeType.Local);if(i.default.vmMain.commitUpdateItems(),l.a.endAction(),r.length>0){var n=r.length>1?" items.":" item.";i.default.toasts.pushMessage({text:"Archived "+(r.length+n),action:MessageAction.Undo,hold:!1,timeout:8e3})}else i.default.toasts.pushMessage({text:"No completed items to archive"});if(e){var s=this.indexOfObject(e);if(s>=0){a=this.itemAtIndex(s);try{i.default.PAssert(1247,a,"Could not restore selection to item")}catch(e){i.default.reportError(e)}if(a){var o=a.getParsedText().length;g.a.selectIndex(s,o)}}}else g.a.reset()},updatePosition:function(e,t){this.isAnimatingOffset=t,e=Math.round(e),this.offsetX.set(e)},updatePositionMobile:function(){0},bottomListMessage:function(){},isSearchingRemote:function(){return!1},getTitleList:function(){return this.getItem().parents().concat(this.getItem())},itemTitle:function(){return this.getItem().parent()?this.getItem().getParsedText():this.titleOfFirstItem()},titleOfFirstItem:function(){return r.a.RootItemName},onShowArchivedChanged:function(){this.showArchived.get()&&h.a.fireEvent("showArchived",[]),this.updateItems()},indexOfFirstItem:function(){return this.indexOfNextVMLI(-1)},indexOfLastItem:function(){return this.indexOfPrevVMLI(this.numItems(),!1,!0)},getFirstItem:function(){var e=this.indexOfFirstItem();if(e>=0){var t=this.getItems()[e];return t?t.item:void 0}},getFirstObject:function(){return this.objectAtIndex(this.indexOfFirstItem())},getLastItem:function(){return this.itemAtIndex(this.indexOfLastItem())},getLastObject:function(){return this.objectAtIndex(this.indexOfLastItem())},setFocused:function(e){e&&this.paneContent&&this.paneContent.focus(),this.isFocused.set(e)},headerHeight:function(){return 76},handleUndo:function(){l.a.undoAction()},handleRedo:function(){l.a.redoAction()},contentTop:function(){return i.default.paneTop+this.headerHeight()},indexPageUp:function(e){return e=this._infiniteList.indexPageUp(e),this.itemAtIndex(e)||(e=this.indexOfNextVMLI(e)),e},indexPageDown:function(e){return e=this._infiniteList.indexPageDown(e),this.itemAtIndex(e)||(e=this.indexOfPrevVMLI(e)),e},adjustSelectionFromPaneObject:function(e){try{i.default.PAssert(1248,e,"Must pass in a valid saved selection")}catch(e){i.default.reportError(e)}var t=e;return e.startItem&&e.endItem&&(e.startIndex=this.indexOfObject(e.startObject),e.endIndex=this.indexOfObject(e.endObject),(e.startIndex<0||e.endIndex<0)&&(t=void 0)),t},restoreSelection:function(e){try{i.default.PAssert(1249,e,"Must always have a valid saved selection")}catch(e){i.default.reportError(e)}if(e){var t=this.indexOfObject(e.startObject),a=this.indexOfObject(e.endObject);if(t>=0&&a>=0){var r=e.startOffset,n=e.endOffset,s=e.startItem.getParsedText(),o=e.endItem.getParsedText();(r<0||r>s.length||n<0||n>o.length)&&(r=-1,n=-1),g.a.selectIndices(t,r,a,n)}else g.a.reset()}else g.a.reset()},restoreSelectionAfterCollapse:function(e,t){if(e){var a,r,n=e.startItem,s=this.indexOfItem(e.startItem),o=this.indexOfItem(e.endItem);if(s>=0&&o>=0)g.a.selectIndices(s,e.startOffset,o,e.endOffset),a=e.startItem;else if(s>=0)g.a.selectIndex(s,e.startOffset),a=e.startItem,r=!0;else if(o>=0)g.a.selectIndex(o,e.endOffset),a=e.endItem,r=!0;else if(!0===t)for(a=n;a;){var l=a.parent();if(l===i.default.focusedPane.item.get()){g.a.selectItem(a,a===n?g.a.getStartOffset():-1),r=!0;break}a=l}else g.a.reset();a&&r&&i.default.focusedPane.scrollItemToMiddle(a,ScrollDuration.Snap)}},_setCollapsedRecursive:function(e,t){for(var a=e.numChildren(),i=e.getItems(),r=0;r<a;++r){var n=i[r];n.hasChildren()&&(this.isSearchedFlat()||this.search.isMatched(n))&&(this.isSearchedFlat()&&!this.search.isMatched(n)||n.setCollapsed(t,this,!1,!1),this._setCollapsedRecursive(n,t))}},collapseAll:function(e,t){try{i.default.PAssert(1250,this.supportCollapsing,"Should not be collapsing all")}catch(e){i.default.reportError(e)}var a=this.item.get(),r=g.a.save();this.setIgnoreRestoreScroll(),this.setScrollOffset(this.defaultOffset),i.default.vmMain.beginUpdateItems(),void 0!==e&&this._setCollapsedRecursive(a,e),i.default.vmMain.paneManager.updatePaneStateForPane(this),(this.isSearchedFlat()||t)&&this.updateItems(),i.default.vmMain.commitUpdateItems(),this.restoreSelectionAfterCollapse(r,e)},toggleCollapseAll:function(){if(this.supportCollapsing){var e=!this.hasCollapsed();this.collapseAll(e)}},hasCollapsed:function(e){for(var t=(e=e||this.item.get()).numChildren(),a=e.getItems(),i=0;i<t;++i){var r=a[i];if(r.hasChildren()&&(this.isSearchedFlat()||this.search.isMatched(r))){if(r.isCollapsed(this,!1))return!0;if(this.hasCollapsed(r))return!0}}return!1},onOverviewToggled:function(e){this.useCustomScroller&&(e?this.getiScroller().disable():(this.getiScroller().enable(),this._disableClick=!1))},onTouchHoldTimeout:function(e){0},getPaddingForPaneObject:function(e,t){var a=e.levelsDeep,r=t?e:e.item,n=!t&&this.isSearchedFlat()?S.a.itemIndentStart(this):r.getPadding(this,t,a);return n>this.getWidth()-i.default.SPThresholdRight&&(n=this.getWidth()-i.default.SPThresholdRight-8),n},maxWidthOfPaneObject:function(e){var t=this.getPaddingForPaneObject(e,!1);return this.getWidth()-t-i.default.SPThresholdRight},prevPaneObjectAtSameLevel:function(e){try{i.default.PAssert(1251,e>=0,"Must supply a valid selection index: "+e)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1252,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(e){i.default.reportError(e)}for(var t=this.objectAtIndex(e),a=e-1;a>=0;){var r=this.objectAtIndex(a),n=this.itemAtIndex(a);if(n&&t.item!==n&&!n.isNote()&&r.levelsDeep===t.levelsDeep)return r;a--}},indexOfPrevVMLI:function(e,t,a){try{i.default.PAssert(1253,e>=0,"Must supply a valid selection index: "+e)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1254,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(e){i.default.reportError(e)}for(var r=t?this.itemAtIndex(e):void 0,n=e-1;n>=0;){var s=this.itemAtIndex(n);if(s&&r!==s&&(!a||!s.isNote()))return n;n--}return-1},indexOfNextVMLI:function(e,t,a){try{i.default.PAssert(1255,e>=-1,"Must supply a valid selection index: "+e)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1256,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(e){i.default.reportError(e)}for(var r=t?this.itemAtIndex(e):void 0,n=e+1;n<this.numItems();){var s=this.itemAtIndex(n);if(s&&r!==s&&(!a||!s.isNote()))return n;n++}return-1},indexOfNextSibling:function(e){try{i.default.PAssert(1257,e>=-1,"Must supply a valid selection index: "+e)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1258,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(e){i.default.reportError(e)}var t=this.itemAtIndex(e);for(e=this.indexOfNextVMLI(e);e>=0;){if(!this.itemAtIndex(e).isDescendantOf(t))break;e=this.indexOfNextVMLI(e)}return e>=0?e:-1},_getPrevNextItem:function(e,t,a){var i=a?this.indexOfNextVMLI:this.indexOfPrevVMLI,r=i.call(this,e);if(t)for(var n=this.itemAtIndex(e);r>=0;){var s=this.itemAtIndex(r);if(n.parent()===s.parent())return s;if(n.parent()===s||s.parent()===n.parent().parent()){r=-1;break}r=i.call(this,r)}else if(r>=0)return this.itemAtIndex(r)},getPreviousItem:function(e,t){return this._getPrevNextItem(e,t,!1)},getNextItem:function(e,t){return this._getPrevNextItem(e,t,!0)},getFirstSelectedItem:function(){var e;return this.applyToSelection(function(t){return e=t,!1}),e},getFirstSelectedIndex:function(){return g.a.getStartIndex()},applyToSelection:function(e,t){i.default.vmMain.applyToSelection(e,t)},applyPriorityToSelection:function(e,t){t?i.default.vmMain.applyFnToSelection("priority",{toggle:!0,value:e,value2:ChangeType.Local,emptyValue:VMLIFlag.None}):i.default.vmMain.applyFnToSelection("priority",{value:e,value2:ChangeType.Local})},autocompleteTag:function(){this._autocompletePopup({mode:"tag",text:"Add tag",buttonText:"Add"},function(e,t){var a=t.value.trim(),i=e.getParsedText()+" "+r.a.TagPrefix+a;e.setText(i,!0,ChangeType.Local)}.bind(this))},autocompleteDate:function(){this._autocompletePopup({mode:"date",text:"Choose date",buttonText:"Schedule"},function(e,t){var a=t.value.trim(),i=e.getParsedText()+" "+r.a.DatePrefix+a;e.setText(i,!0,ChangeType.Local)})},autocompleteMove:function(e,t){(e=e||{}).mode=r.a.AutocompleteMode.Move,e.text="Select item to move to",e.buttonText="MOVE",this._autocompletePopup(e,function(e,t){var a;t.subItemText?(a=this.createVMLI({text:t.subItemText},{parent:t.item,changeType:ChangeType.AllLocal}),t.item.insertItem(a,0)):t.item===e||t.item.isDescendantOf(e)||(a=t.item),a&&this.moveItem(e,a)}.bind(this),function(){t&&t(),g.a.updateCaret()}.bind(this))},autocompleteJump:function(e,t){(e=e||{}).mode=r.a.AutocompleteMode.Jump,e.text="Select item to jump to",e.buttonText="JUMP",this._autocompletePopup(e,function(e,t){}.bind(this),function(e){e.item&&this.indexOfItem(e.item)>=0&&(g.a.selectItem(e.item,0,0),this.scrollItemToTop(e.item,ScrollDuration.Default)),t&&t(),g.a.updateCaret()}.bind(this))},autocompleteSnooze:function(e,t,a){var n,s=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail);if(!t){var o=e&&e.item||this.getFirstSelectedItem();o&&(n=o.getAttachmentByPlugin(s.id))&&(t=n.getField("accountID"))}var l=function(){var t=e&&e.elementDisplay;if(!t){var a=this.getFirstSelectedIndex();t=this.elementAtIndex(a)}i.default.menus.openContextMenu({componentName:"ReactContextMenuAuthorize",element:t,message:"Snooze requires server access to your account so Moo.do can manage your inbox while you're not around. Please enable Offline Features to enable Snooze."})}.bind(this),d=i.default.settings.get(Settings.enableOfflineAuth);C.a.isConnected()?d?(i.default.toasts.clearMessage(MessageID.SnoozeOffline),(e=e||{}).mode="snooze",e.text="Snooze until date",e.buttonText="SNOOZE",e.allowCustom=!0,this._autocompletePopup(e,function(e,t){s.beginAction();var a=t.value.trim(),o=u.a.parseDateDefaultFormat(a);if(n=e.getAttachmentByPlugin(s.id))if(i.default.isDateValid(o))if(C.a.isLinkedAccountAuthorized(n.getField("accountID"),GScope.GmailModify)){var d=o.getTime()-Date.now();d<i.default.weeks(1)?s.performAction(r.a.PluginAction.Gmail.Snooze,!1,n,d):i.default.toasts.pushMessage({text:"Maximum snooze delay is one week. Please enter a date less than a week from now.",action:MessageAction.Okay})}else i.default.menus.closeContextMenu(),l();else i.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:MessageAction.Okay});else i.default.toasts.pushMessage(MessageID.ReselectEmail);s.endAction()}.bind(this),a)):l():i.default.toasts.pushMessage(MessageID.SnoozeOffline)},autocompleteSchedule:function(e,t){(e=e||{}).mode="date",e.text="Add event on date",e.buttonText="Add",e.allowCustom=!0;var a=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail);this._autocompletePopup(e,function(e,t){l.a.beginAction();var r=t.value.trim(),n=u.a.parseDateDefaultFormat(r);i.default.isDateValid(n)?a.scheduleEmail(e,n):i.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:MessageAction.Okay}),l.a.endAction()}.bind(this),t)},autocompleteLabel:function(e,t){var a,n=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail);function s(e){var t=e.getAttachmentByPlugin(n.id),r=t.getPlugin().getDisplayTags(t);a=a?i.default.arrayIntersection(a,r):r}(e=e||{}).item?s(e.item):this.applyToSelection(s),e.tokens=(a||[]).map(function(e){return{text:e}}),e.mode=r.a.AutocompleteMode.GmailLabel,e.text="Select a label",e.buttonText="LABEL",e.allowCustom=!0,e.allowEmpty=!0,e.onTokenRemoved=function(a){var s=a.text;function o(e){var t=e.getAttachmentByPlugin(n.id);if(t)if(n.attachmentHasLabel(t,s))n.performAction(r.a.PluginAction.Gmail.RemoveLabel,!1,t,s);else try{i.default.PAssert(1259,!1,"Tried to remove a tag from an attachment without a tag")}catch(e){i.default.reportError(e)}else i.default.toasts.pushMessage(MessageID.ReselectEmail)}n.beginAction(),e.item?o(e.item):this.applyToSelection(o),n.endAction(),t&&t(a)}.bind(this),this._autocompletePopup(e,function(e,t){var a=t.value.trim();try{i.default.PAssert(1260,e.hasPluginAttachment(n.id),"Must have valid plugin attachment")}catch(e){i.default.reportError(e)}var s=e.getAttachmentByPlugin(n.id);if(s){var o=n.createLabelString(a);o?n.attachmentHasLabel(s,o)||n.performAction(r.a.PluginAction.Gmail.AddLabel,!1,s,o):i.default.toasts.pushMessage({text:"Cannot create a label with a reserved named.",action:MessageAction.Okay})}else i.default.toasts.pushMessage(MessageID.ReselectEmail)}.bind(this))},_autocompletePopup:function(e,t,a){if(!e.elementDisplay){var i=g.a.getStartIndex(),r=this.elementAtIndex(i);e.elementDisplay=r}e.onSelected=function(i){e.item?t(e.item,i):this.applyToSelection(function(e){t(e,i)}),a&&a(i)}.bind(this),b.a.showPopup(e)},moveItem:function(e,t){if(l.a.beginAction(),i.default.vmMain.beginUpdateItems(),t.belongsToSameItemStore(e))e.moveTo({parent:t,index:0},ChangeType.Local);else try{i.default.PAssert(1261,!1,"Currently do not support moving items between item stores")}catch(e){i.default.reportError(e)}i.default.vmMain.commitUpdateItems(),l.a.endAction()},setPropDefault:function(e,t){void 0===this[e]&&(this[e]=t)},setExpanded:function(e,t){var a=this.isExpanded.get()!==e;this.isExpanded.set(e),a&&!1!==t&&(h.a.fireEvent("panesChanged",[]),i.default.vmMain.paneManager.updatePaneStateForPane(this),i.default.vmMain.paneManager.ensurePaneInView(this))},modifyTextOnDropBasedOnSearch:function(e,t,a,i,r,n){var s,o,l=a.search,d=this.search,c=t[n](),u=l[n](),h=d[n](),f=[],p=[];for(s=0;h&&s<h.length;s++){o=h[s];for(var m=i,g=!c||c.indexOf(o)<0;g&&m;){var v=m[n]();v&&v.indexOf(o)>=0&&(g=!1),m=m.parent()}g&&f.push(r+o)}if(f.length){for(s=0;c&&u&&s<u.length;s++)o=u[s],c.indexOf(o)>=0&&h.indexOf(o)<0&&p.push(r+o);var y=f.join(" ");if(p.length>0)for(s=0;s<p.length;s++)o=p[s],e=0===s?e.replace(o,y):e.replace(o,"");else e=e+" "+y;e=e.replace(/  +/g," ")}return e},canAcceptDragOver:function(){return this.isDropTarget},handleDragOver:function(e,t,a,r,n){var s=i.default.getElementParent(a),o=s&&i.default.getItemForElement(s),l=(s||i.default.findParent(a,"blockHeader"))&&i.default.getPaneObjectForElement(a),d={};return s&&i.default.findParent(s,"overviewList")?(this.overview.updateDragHoverItem(o),d={overview:!0,targetItem:o,targetElement:s}):l&&(this.overview.updateDragHoverItem(null),d=this._handleDragOverPane(e,t,a,s,l,r,n)),d},_handleDragOverPane:function(e,t,a,i,r,n,s){},handleDragDrop:function(e,t,a,i){a&&e!==a.targetItem&&a.targetItem&&this._handleDragDrop(e,t.dataTransfer,a,i),this.revertDrag()},_handleDragDrop:function(e,t,a,n){for(var s=a.overview,o=!0,d=t.pane,c=e,u=a.targetItem,f=u.parent();f&&o;)f===e&&(o=!1),f=f.parent();if(o){this.indexOfItem(e);if(o){var p,m=-1;if(s)m=(p=u).numChildren();else if(a.dropOnPane)p=u,m=0;else if(a.position===r.a.DragDropPosition.Above)p=u.parent(),m=u.getIndex();else if(a.position===r.a.DragDropPosition.On)p=u,m=u.numItems();else{var g=this.indexOfItem(u),v=this.getNextItem(g);v&&v.parent()===u&&!v.isNote()?(p=u,m=0):(p=u.parent(),m=u.getIndex()+1)}l.a.beginAction();try{i.default.PAssert(1262,p,"Trying to move without a target")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1263,!isNaN(m),"Trying to move without a target index")}catch(e){i.default.reportError(e)}var y=!0;if(t.dropEffect===r.a.DropEffect.Move){var S=e.parent();if(S){var E=e.getIndex();if(S.belongsToSameItemStore(p)){e.moveTo({parent:p,index:m},ChangeType.Local),l.a.performAction(TrackerType.Move,{itemID:e.id,oldParent:S.id,oldPosition:E,newParent:p.id,newPosition:m});var P=e.getRawText();P=this.modifyTextOnDropBasedOnSearch(P,e,d,p,r.a.TagPrefix,"getTags"),(P=this.modifyTextOnDropBasedOnSearch(P,e,d,p,r.a.ContactPrefix,"getContacts"))!==e.getRawText()&&e.setText(P,!0,ChangeType.Local)}else e=e.clone(p,ChangeType.Local),p.insertItem(e,m),S.removeChildAtIndex(E,ChangeType.Local)}else e=e.clone(p,ChangeType.Local),p.insertItem(e,m)}else n||(e=t.pane?t.pane.dropEffectCopyBehavior(e,p):e.clone(p,ChangeType.Local)),e?(e.parent(p),p.insertItem(e,m)):y=!1;y&&(h.a.fireEvent("droppedItem",[c,this,t.pane]),l.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.DropItem,data:{itemID:e.id,toPane:this,fromPane:t.pane}})),l.a.endAction(),y&&t.pane&&t.pane.notifyDropFrom(e,this)}}},revertDrag:function(){this.overview&&this.overview.updateDragHoverItem(null)},isItemHeader:function(e,t){return t?e.hasHeaderChildren():e.hasVisibleChildren(this)},onNotePopupClosed:function(){},openNoteContextMenu:function(){var e=g.a.getStartItem(),t=g.a.getStartIndex(),a=g.a.getStartOffset(),r=g.a.getEndOffset(),n=this.elementAtIndex(t);if(n){try{i.default.PAssert(1264,n.firstChild,"Opening a note should have a firstChild",i.default.getElementPath(n))}catch(e){i.default.reportError(e)}n.firstChild&&(n=n.firstChild),void 0!==a&&void 0===r&&(r=a);var s={componentName:"ReactNotePopup",onClosed:this.onNotePopupClosed.bind(this),element:n,item:e.parent(),note:e,pane:this,index:t,position:"fill",selectionStart:a,selectionEnd:r};i.default.menus.isContextMenuOpen()&&i.default.menus.closeContextMenu(),g.a.clearSelection(!0),s.positionOffset={left:-4,top:-18},i.default.menus.openContextMenu(s)}},closeNoteContextMenu:function(){if(i.default.menus.isContextMenuOpen()){if(c.a.ios){var e=this._editingNote,t=e.note,a=e.itemIndex,r=t.parent().getParsedText().length;g.a.selectIndex(a,r),this._editingNote=void 0}i.default.menus.closeContextMenu()}},canResetMultiselect:function(){return!0},replaceTextOnDropOnBlock:function(e,t,a,i,r){var n=t.name,s=a?[a.name.replace(i,"")]:e[r](),o=e.getRawText();if(o.indexOf(n)<0){if(s){for(var l=0;l<s.length;l++)o=o.replace(i+s[l],0===l?n:"");s.length>1&&(o=o.replace(/  +/g," "))}else o+=" "+n;e.setText(o,!0,ChangeType.Local)}},applyDropOnBlock:function(e,t,a,n){var s,o=e;if(g.a.setFocusedPane(a),o.isStarred||o.isImportant)o.isStarred?t.isStarred(!0,ChangeType.Local):o.p0||o.isImportant?s=VMLIFlag.P0:o.p1?s=VMLIFlag.P1:o.p2&&(s=VMLIFlag.P2),s&&t.priority(s,ChangeType.Local);else if(e.isTag)this.replaceTextOnDropOnBlock(t,e,n,"#","getTags");else if(e.isContact)this.replaceTextOnDropOnBlock(t,e,n,"+","getContacts");else if(e.isPriority)t.priority(e.priority,ChangeType.Local);else{var l=!0;if(t.hasAttachmentType(r.a.PluginType.Calendar)){var d=t.getAttachmentByType(r.a.PluginType.Calendar);d&&d.getField("recurringEventId")&&t.getCalendarParsedText()===d.getField("summary")&&(i.default.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"}),l=!1)}if(l){var c="";if(o.isDate&&i.default.isDateValid(o.date)){var h=t.date(),f=!o.allDay&&(o.dateTime||h&&h.hasTimeOfDay()&&h);c=f?u.a.getAppendDateText(o.date,f):u.a.getAppendDateText(o.date)}else c=o.id;if(c){var p=t.getRawText(),m=o.duration?" "+i.default.round(o.duration,2)+"hr":"";if(c=c.toLowerCase()+m,t.getDateText()){if(t.getDuration()){m=t.getDurationText();var v=p.indexOf(r.a.DatePrefix),y=p.indexOf(m,v);p=p.substr(0,y-1)+p.substr(y+m.length)}p=p.replace(t.getDateText(),c)}else p+=" "+r.a.DatePrefix+c;t.setText(p,!0,ChangeType.Local);var S=i.default.vmMain.getDefaultCalendarPlugin();if(i.default.isDateValid(o.date)&&S&&a!==this&&!t.hasAttachmentType(r.a.PluginType.Calendar))if(S.getDefaultExportCalendarID()){var E=i.default.vmMain.pluginManager,P=PluginSettingsID.GCalendar.SyncDraggedEvents,b=function(){E.getSetting(PluginID.GCalendar,P)&&S.createEventForItem(t)};i.default.vmMain.shouldShowHelp("syncNewEvents")?i.default.menus.confirm("Add events to Google Calendar when dropping onto the Calendar pane?",function(e){i.default.vmMain.closeHelp("syncNewEvents"),E.setSetting(PluginID.GCalendar,P,e),b()}):b()}}}}if(a.isEditable){var C=a.indexOfItem(t,e);g.a.selectIndex(C,t.getParsedText().length)}},setIgnoreRestoreScroll:function(e){this._ignoreRestoreScroll=!0,this._ignoreRestoreScrollTimeout&&clearTimeout(this._ignoreRestoreScrollTimeout),this._ignoreRestoreScrollTimeout=setTimeout(function(){this._ignoreRestoreScroll=!1}.bind(this),e||100)},isIgnoringRestoreScroll:function(){return this._ignoreRestoreScroll},zoomInOnSwipe:function(e){var t=this.item.get();i.default.vmMain.zoomin(e),i.default.toasts.pushMessage({text:"<b>Zoomed in to:</b><br>"+e.getParsedText(),action:function(){i.default.vmMain.zoomin(t)},hold:!1,actionText:"UNDO"})},getSwipeMenuItems:function(){var e=this;return{leftOuter:{text:"Zoom",icon:"icon-zoom-in",color:"#09d",fn:e.zoomInOnSwipe},leftInner:{text:function(t){return e.supportCollapsing&&t.isCollapsible()?t.isCollapsed(e,!1)?"Uncollapse":"Collapse":"Zoom"},icon:function(t){return e.supportCollapsing&&t.isCollapsible()?"icon-"+(t.isCollapsed(e,!1)?"caret-down":"caret-right"):"icon-zoom-in"},color:function(t){return e.supportCollapsing&&t.isCollapsible()?"#777":"#09d"},fn:function(t){e.supportCollapsing&&t.isCollapsible()?(t.toggleCollapsed(e),g.a.closeKeyboard()):e.zoomInOnSwipe(t)}},rightInner:{text:function(e){return e.isComplete()?"Uncomplete":"Complete"},icon:"icon-check",color:"#0c0",fn:function(t){e.supportCompleting&&t.isComplete(!t.isComplete(),ChangeType.Local)}},rightOuter:{text:"Delete",icon:"icon-delete",color:"#a30",fn:function(e){var t;(e.deleteSelf(ChangeType.Local),e.hasAttachmentType(r.a.PluginType.Email))?t=e.getAttachmentByType(r.a.PluginType.Email).getField("subject"):t=e.getParsedText();i.default.toasts.pushMessage({text:"<b>Deleted:</b><br>"+t,action:function(){l.a.undoAction()},hold:!1,actionText:"UNDO"})}}}},getSwipeMenuItem:function(e,t){var a=c.a.windowWidth(),i=.16*a,r=.45*a,n=this.swipeMenuItems;return t>r?n.leftOuter:t>i?n.leftInner:t<-r?n.rightOuter:t<-i?n.rightInner:{color:"#ddd"}},_openSelectedInMode:function(e){var t=g.a.getStartItem();t&&this.openEmailByItem(t,e)},replySelected:function(){this._openSelectedInMode(r.a.EmailResponseMode.Reply)},replyAllSelected:function(){this._openSelectedInMode(r.a.EmailResponseMode.ReplyAll)},forwardSelected:function(){this._openSelectedInMode(r.a.EmailResponseMode.Forward)},openEmailByItem:function(e,t){if(e){var a=e.getAttachmentByPlugin(PluginID.Gmail);(a&&a!==A.a.getThreadAttach()||!A.a.isOpenOnPane(this)||t)&&a.getPlugin().openEmailByItem(e,this,t)}},markItemRead:function(e,t){var a=i.default.vmMain.getDefaultEmailPlugin(),n=t.getAttachmentByPlugin(a.id),s=e?r.a.PluginAction.Gmail.MarkRead:r.a.PluginAction.Gmail.MarkUnread;try{i.default.PAssert(1265,n,"Must be able to get a valid attachment")}catch(e){i.default.reportError(e)}(e&&a.isItemUnread(t)||!e&&!a.isItemUnread(t))&&a.performAction(s,!1,n)},markReadSelected:function(e){var t=i.default.vmMain.getDefaultEmailPlugin();t.beginAction(),this.applyToSelection(this.markItemRead.bind(this,e)),t.endAction()},toggleStarSelected:function(){var e,t=i.default.vmMain.getDefaultEmailPlugin();t.beginAction(),this.applyToSelection(function(a){var n=a.getAttachmentByPlugin(t.id);try{i.default.PAssert(1266,n,"Must be able to get a valid attachment")}catch(e){i.default.reportError(e)}var s=t.isItemStarred(a);void 0===e&&(e=s?r.a.PluginAction.Gmail.Unstar:r.a.PluginAction.Gmail.Star),(s&&e===r.a.PluginAction.Gmail.Unstar||!s&&e===r.a.PluginAction.Gmail.Star)&&t.performAction(e,!1,n)}.bind(this)),t.endAction()},selectIndex:function(e,t){g.a.selectIndex(e,t||0)},onAdded:function(e){!e&&this.isEditable&&this.isWriteable&&(g.a.setFocusedPane(this),setTimeout(this.selectFirstItem.bind(this,e),0))},selectFirstItem:function(e){var t=this.indexOfFirstItem();!e&&t>=0&&g.a.selectIndex(t,0)},isOverviewVisibleInPane:function(e){var t=this.item.get();return e===t||e.isDescendantOf(t)},getContentWidth:function(){return this.getWidth()},getContentHeight:function(){return this.getHeight()},getMinItemSize:function(){return Math.ceil(S.a.itemLineHeight()+2*S.a.itemPadding()+(S.a.noteLineHeight()+S.a.itemPadding()))/2},onZoom:function(){this.setScrollOffset(this.defaultOffset)},widthOfDrag:function(){},getSubItems:function(e,t){var a=[],i={item:e,comparator:this.search.isMatched,pane:this,each:function(e){t&&e.isComplete()||a.push(e)}};return this.runItemSearch(i),a},getStyledLinesForPaneObject:function(e,t,a){var r,n=e.item;if(n.isNote()){var s=i.default.escape(n.getParsedText()).replace(/\n|\r\n/g," "),o=Math.min(s.length,200);return[s=s.substr(0,o)]}try{r=D.a.measurePaneObject(e,this,a)}catch(e){i.default.reportError(e)}return r?r.styledLines:[n.getParsedText()]},isItemInPane:function(e){return this.indexOfItem(e)>=0},isItemTopLevel:function(e){return e.levelsDeep.get()-this.item.get().levelsDeep.get()==1},checkHeightChanged:function(e,t){return this._infiniteList.checkHeightChanged(e,t)},getCollapsedDefault:function(){return!1},isViewProject:function(){return!1},isViewDates:function(){return!1},isViewAgenda:function(){return!1},isViewCalendar:function(){return!1},isViewOutline:function(){return!1},isViewGroups:function(){return!1},viewModeIcon:function(){return""},extraPaddingForPaneObject:function(){return 0},createVMLI:function(e,t){var a=n.a.createVMLI(e,t);return this.search.stickMatch(a),a},selectNearestItem:function(e){var t=this.indexOfNextSibling(e);t<0&&(t=this.indexOfPrevVMLI(e,!0,!0)),t>=0?g.a.selectIndex(t,0):g.a.reset()},supportsSortBlocks:function(){return!1},supportsSortBlocksMode:function(){return!1},supportsSortItems:function(){return!1},getViewMode:function(){},scrollToTop:function(e){this.setScrollOffset(0,e)},setName:function(e){this.name.set(e),i.default.vmMain.paneManager.savePaneState()}},s.a.defineBase(_),i.default.VMPane=_,t.a=_},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(7),s=a(4),o=a(13),l=a(2),d=a.n(l),c=a(3),u=a(25),h=a(43),f=a(29),p=a(23),m=c.a.createClass({displayName:"FancyInput",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){var e=this.props,t={isFocused:e.focused,isComposing:!1,value:e.value||"",tokens:e.tokens||[],item:e.item?{item:e.item,text:e.item.getStyledTextAsOneLine()}:void 0};this.isInput="password"===e.type,this.isInput||(this.html=this.parseHTML(t.value||TextSpace)),e.buttonText&&(t.isLoading=!1),this.createObservables(t)},componentDidMount:function(){this.updateHTML(this.state.value,!1),this.props.focused&&(this.focus(),this.props.selectAll?this.selectAll():this.selectEnd())},onUnmount:function(){this.isFocused.get()&&this.onBlur()},componentWillReceiveProps:function(e){this.state.item!==e.item&&this.item.set(e.item?{item:e.item,text:e.item.getStyledTextAsOneLine()}:void 0),this.props.value!==e.value&&e.value!==this.state.value&&(this.setValue(e.value,this.isFocused.get()),this.forceUpdate()),this.props.tokens!==e.tokens&&e.tokens!==this.state.tokens&&this.tokens.set(e.tokens)},componentDidUpdate:function(){var e=this._isDirty;if(this._isDirty=void 0,e&&this._dirtyCallbacks){for(var t=0;t<this._dirtyCallbacks.length;t++)this._dirtyCallbacks[t]();this._dirtyCallbacks=void 0}},clearValue:function(){this.setValue("")},isButtonEnabled:function(){return void 0!==this.props.buttonEnabled?this.props.buttonEnabled:this.state.value||this.state.tokens.length>0},getValue:function(){return this.value.get()},getTokens:function(){var e=this.getValue().trim(),t=this.tokens.get();return e?t.concat([{text:e,email:e,type:"contact"}]):t},getItem:function(){return this.state.item},parseHTML:function(e){var t;if(this.props.parse){var a=h.a.parseText(e,null,null,null,o.a.getCurrentDateFormat(),null,null,n.a.contactManager.getContacts(),!0,!0);this.parsedEls=a.els;var r=e.match(/(^#|[\(\s]#)([^\s\),#]+)/g);r&&(r=r.map(function(e){return e.trim().slice(1)})),this.tags=a.tags=r,this.contacts=a.contacts,this.props.onParsed&&this.props.onParsed(a),t=h.a.generateHTML(a.els,!0)}else t=e&&i.default.escape(e).replace(/ /g,"&nbsp;");return t},addDirtyCallback:function(e){this._dirtyCallbacks||(this._dirtyCallbacks=[]),this._dirtyCallbacks.push(e)},focus:function(){this._isDirty?this.addDirtyCallback(this.focus):this.refs.input.focus()},blur:function(){this.refs.input.blur()},select:function(){p.a.selectElement(this.refs.input)},selectEnd:function(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectEnd);else{var t=this.refs.input.innerText;t.length>0&&t!==TextSpace&&p.a.selectElement(this.refs.input,t.length)}},selectAll:function(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectAll);else{var t=this.refs.input.innerText;t.length>0&&t!==TextSpace&&p.a.selectElement(this.refs.input,0,t.length)}},onFocus:function(e){this.props.autocompleteMode&&f.a.clearDisabled(),this.props.autocompleteOnClick&&this.updateAutocomplete(),i.default.vmMain.activeInput.set(this),this.isFocused.set(!0),this.props.onEscape&&(this.__hotkeyEscape=u.a.pushStackEscape(this.handleEscapeKey)),this.props.onFocus&&this.props.onFocus(e)},onBlur:function(e){i.default.vmMain.activeInput.set(null),this.isFocused.set(!1),this.__hotkeyEscape&&(u.a.popStack(this.handleEscapeKey),this.__hotkeyEscape=void 0),this.props.onBlur&&this.props.onBlur(e)},getSelectionOffset:function(){var e=p.a._getSelectionRange(),t=0;return e&&(t=p.a.getSelectOffsetsInElement(this.refs.input,e).end),t},_setSelectionOffset:function(e){var t,a;if(e>0){var r=p.a.getOffsetChildElement(this.refs.input,e);t=r.element,a=r.offset}else t=this.refs.input,a=0;var n=p.a.createFakeRange(t,a,t,a);try{i.default.PAssert(2584,n,"Range should be valid when setting selection offset")}catch(e){i.default.reportError(e)}n&&p.a.setSelectionRange(n)},setSelectionOffset:function(e){this._setSelectionOffset(e)},updateAutocomplete:function(e){var t=this.props,a=this.refs.input,i=t.autocompleteMode;if(i){var r=p.a.getSelectionInElement(a);0,(t.autocompleteOnClick||r&&r.start===r.end)&&f.a.update({mode:i,text:this.value.get(),offset:r?r.start:0,owner:this,item:e,parsedEls:this.parsedEls,positionOffset:t.positionOffset,elementDisplay:t.autocompleteElementDisplay||this.refs.wrapper,elementInput:a,supportSearchItemAutocomplete:t.supportSearchItemAutocomplete,noShow:t.noShowAutocomplete,showNoMatches:t.autocompleteOnClick})}},setValue:function(e,t,a){this._isDirty=!0;try{i.default.PAssert(2585,void 0!==e,"Should not set FancyInput value to undefined")}catch(e){i.default.reportError(e)}e=e||"",this.updateHTML(e,t,a),this.value.set(e)},updateHTML:function(e,t,a){var i=a;t&&void 0===i&&(i=this.getSelectionOffset());var r=this.parseHTML(e||TextSpace);r!==this.refs.input.innerHTML&&(this.refs.input.innerHTML=r),t&&(i>e.length&&(i=e.length),this.setSelectionOffset(i))},addToken:function(e){this.tokens.push(e);var t=this.refs.inner;t.scrollWidth>t.clientWidth&&(t.scrollLeft=t.scrollWidth-t.clientWidth)},updateTokens:function(e){for(var t=i.default.parseTokensFromText(this.value.get()),a="",r=0;r<t.length;++r){var n=t[r];"contact"===n.type?this.addToken(n):a+=n.text}this.setValue(a,!0)},onChange:function(){this.value.set(this.refs.input.value)},stripBRs:function(e){for(var t=e.children,a=t.length-1;a>=0;a--){var i=t[a];"BR"===i.nodeName?i.remove():i.children.length>0&&this.stripBRs(i)}},onInput:function(){if(!this.isComposing.get()){0;var e=this.refs.input.textContent.replace(/\u00a0/g," ").replace(new RegExp(TextSpace,"g"),"").replace(/\n/g,"");this.setValue(e,!0),this.updateAutocomplete(),this.props.onChange&&this.props.onChange(e,this.item.get())}},handleEscapeKey:function(){this.props.onEscape?this.props.onEscape():this.isInput||this.select(),this.__hotkeyEscape&&(u.a.popStack(this.handleEscapeKey),this.__hotkeyEscape=void 0)},onMouseDown:function(e){e.stopPropagation(),this.props.onMouseDown&&this.props.onMouseDown(e)},onKeyDown:function(e){var t=this.props;this.isInput||(t.autocompleteMode&&f.a.isShowing()||t.buttonText&&e.keyCode===KeyCode.Enter&&this.onButtonClick(),e.keyCode===KeyCode.BackSpace&&(!this.state.value&&this.state.tokens.length>0&&this.removeToken(this.tokens.length()-1),0===this.refs.input.textContent.length&&(this.refs.input.textContent=TextSpace)),e.keyCode===KeyCode.Tab&&f.a.isShowing()&&f.a.hide(),e.keyCode===KeyCode.Enter&&(t.onEnter&&t.onEnter(e),e.preventDefault())),t.onKeyDown&&t.onKeyDown(e)},onKeyUp:function(e){var t=this.props;!this.isInput&&t.autocompleteMode&&(e.keyCode!==KeyCode.LeftArrow&&e.keyCode!==KeyCode.RightArrow||this.updateAutocomplete()),"email"===t.autocompleteMode&&(e.keyCode===KeyCode.Comma?this.updateTokens(!1):e.keyCode===KeyCode.Enter&&this.updateTokens(!0)),t.onKeyUp&&t.onKeyUp(e)},onCompositionStart:function(){s.a.android||this.isComposing.set(!0)},onCompositionEnd:function(e){s.a.android||(this.isComposing.set(!1),this.onInput(e))},onAutocompleteSelected:function(e){var t=this.props;e.item&&this.item.set({item:e.item,text:e.item.getStyledTextAsOneLine()}),void 0!==e.value&&(this.setValue(e.value,!0,e.offset),t.onChange&&t.onChange(e.value,this.item.get())),e.token&&this.addToken(e.token),t.onAutocompleteSelected&&t.onAutocompleteSelected(e)},onButtonClick:function(){var e=this.state;if(this.isButtonEnabled()){if(this.props.onButtonClick)this.props.onButtonClick(e.value,this.onButtonClickCallback)&&this.isLoading.set(!0);f.a.isShowing()&&f.a.hide()}},onButtonClickCallback:function(){this.value.set(""),this.isLoading.set(!1)},removeToken:function(e){var t=this.props,a=this.tokens.get()[e];this.tokens.removeAt(e),t.onChange&&t.onChange(this.getValue(),this.item.get()),t.onTokenRemoved&&t.onTokenRemoved(a)},removeItem:function(){this.item.set(void 0),this.props.onChange&&this.props.onChange(this.getValue(),this.item.get())},render:function(){var e,t,a=this.state,r=this.props,n=r.margin||{},o=r.padding||{};isNaN(o.left)&&(o.left=8),isNaN(o.right)&&(o.right=8);var l=!1!==r.border,c=l?2:0,u=i.default.classNames("fancyInput",{disabled:r.disabled},{focused:a.isFocused},{hasFloatingText:!!r.floatingText},{hasButton:!!r.buttonText},{hasBorder:l},this.props.className),h=r.height||40,f=(h-40)/2,p=i.default.extend({width:r.width,height:h,display:r.display},r.style);if(r.floatingText)o.bottom=5+Math.min(f,2),o.top=h-16-o.bottom;else{var m=(h-c-16)/2;o.top=m,o.bottom=m}if(r.floatingText){var g={marginBottom:5+f,marginLeft:o.left,marginRight:o.right};a.isFocused||a.value?a.isFocused?g.color=i.default.colorBlue:g.color="#ccc":g.color="#aaa";var v=i.default.classNames("placeholder c-foreground-super-faded","noSelect",{floating:a.isFocused||a.value||a.tokens.length>0});e=d.a.createElement("div",{className:v,style:g},r.floatingText)}else if(r.placeholder&&!a.value&&!a.isComposing&&0===a.tokens.length&&!a.item){var y={paddingTop:o.top,marginLeft:o.left,marginRight:o.right};e=d.a.createElement("div",{className:"placeholder c-foreground-super-faded noSelect",style:y},r.placeholder)}var S,E={right:r.buttonText&&50};if(a.isFocused&&!a.item?E[s.a.transform.react]="":E[s.a.transform.react]="scale(0,1)",t=d.a.createElement("div",{className:"focusUnderline",style:E}),r.buttonText){var P=i.default.classNames("fancyInputButton c-button-raised-primary",{loading:a.isLoading},{disabled:!this.isButtonEnabled()}),b={width:r.buttonWidth,lineHeight:h+"px"};S=d.a.createElement("span",{className:P,style:b,onClick:this.onButtonClick},r.buttonText)}var C,D={paddingLeft:o.left,paddingRight:o.right,marginLeft:n.left,marginRight:n.right},I={ref:"input",className:"fancyInputInput",style:{paddingTop:o.top,paddingBottom:o.bottom},onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onMouseDown:this.onMouseDown,autoComplete:"false",tabIndex:r.tabIndex,disabled:a.isLoading};this.isInput?(I.type=r.type,I.onChange=this.onChange,C=d.a.createElement("input",I)):(I.onInput=this.onInput,I.contentEditable=r.readonly||a.item?null:"true",I.onCompositionStart=this.onCompositionStart,I.onCompositionEnd=this.onCompositionEnd,C=d.a.createElement("div",I));var A=[];if(a.tokens)for(var M=0;M<a.tokens.length;M++){var _=a.tokens[M],T={marginTop:o.top-4};A.push(d.a.createElement("div",{key:"token"+M,className:"token c-button-raised c-border",style:T},d.a.createElement("span",{dangerouslySetInnerHTML:{__html:_.text}}),d.a.createElement("i",{className:"icon-close c-button",onClick:this.removeToken.bind(this,M)})))}if(a.item){T={lineHeight:h+"px",marginTop:0};A.push(d.a.createElement("div",{key:"tokenItem",className:"token flexbox",style:T},d.a.createElement("span",{className:"f1",dangerouslySetInnerHTML:{__html:a.item.text}}),d.a.createElement("i",{className:"icon-close c-button",onClick:this.removeItem})))}var w=i.default.classNames("fancyInputWrap c-foreground c-background c-border",{hasTokens:A.length>0},{hasItem:a.item});return d.a.createElement("div",{className:u,id:this.props.id,style:p,onClick:this.props.onClick},d.a.createElement("div",{className:"fancyInputContent"},d.a.createElement("div",{className:w,ref:"wrapper"},e,d.a.createElement("div",{className:"fancyInputInner",style:D,ref:"inner"},A,d.a.createElement("div",{className:"fancyInputInner2"},C))),S,t))}});t.a=m},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=(a(8),a(32)),d=a(6),c=o.a.createClass({displayName:"FancyModal",componentDisplay:r.a.ComponentDisplay.Everywhere,close:function(e){i.default.menus.closeModalNew(this.props.modalID,e)},onCloseButton:function(e){this.props.onCloseButton?this.props.onCloseButton():this.close()},onEscapeKey:function(){this.close()},render:function(){var e,t=this.props,a=this.getChildByKey("sidebar"),r=this.getChildByKey("content"),n=this.getChildByKey("buttons"),o={maxHeight:t.height?"95%":null},c=i.default.classNames("fancyModal c-bg-app popup c-shadow-popup",t.className,{"flexbox flexvert":!0},{small:t.small},{hasSidebar:!!a},{hasTitle:!!t.title},{hasButtons:!!n}),u=i.default.classNames("fancyModalWrapper",{"small flexbox":t.small}),h=i.default.classNames("fancyModalContent c-border c-background",{flex1:!0},r.props.className),f=s.a.createElement(l.a,{className:h,scrollable:t.scrollable},r.props.children||r);if(t.small||(o.width=t.width,o.height=t.height,o.minWidth=t.minWidth),a){var p={width:a.props.width||180};e=s.a.createElement("div",{className:"fancyModalSidebar",style:p},a.props.children)}return s.a.createElement("span",{className:u},s.a.createElement("div",{className:"fancyModalBackdrop",onClick:!1!==t.backdropClose?this.close.bind(this,!1):void 0}),s.a.createElement("div",{className:c,style:o,id:t.id},!1!==t.closeButton&&s.a.createElement(d.a,{className:"fancyModalClose",icon:"icon-close",iconSize:20,width:50,height:50,onClick:this.onCloseButton,tooltip:"Close"}),t.title&&s.a.createElement("div",{className:"fancyModalTitle"},t.title),s.a.createElement("div",{className:"fancyModalInside flexbox flex1"},e,s.a.createElement("div",{className:"fancyModalContentArea c-border-light c-background flexbox flexvert f1"},f,n&&s.a.createElement("div",{className:i.default.classNames("fancyModalButtons c-background",{border:t.buttonsBorder})},n)))))}});t.a=c},function(e,t,a){"use strict";var i=a(0),r=a(4),n=a(113);function s(){}s.prototype={createFakeRange:function(e,t,a,r){try{var s=this.createSelectionRange();return s.setStart(e,t),s.setEnd(a,r),new n.a(s)}catch(e){i.default.reportError(e)}},createSelectionRange:function(){return document.createRange()},setSelection:function(e,t,a,n,s){if("TEXTAREA"===e.nodeName){try{i.default.PAssert(1367,e===a,"Cannot multiselect textareas")}catch(e){i.default.reportError(e)}e.focus(),e.selectionStart=t,e.selectionEnd=n,!s&&r.a.android&&setTimeout(this.setSelection.bind(this,e,t,a,n,!0),0)}else{var o=this.createSelectionRange();this.setSelectionValues(o,e,t,a,n),this.setSelectionRange(o)}},setSelectionRange:function(e){var t=window.getSelection();t.removeAllRanges(),e instanceof n.a&&(e=e.getNativeRange()),t.addRange(e)},insertNode:function(e){var t=this._getSelectionRange();t&&t.insertNode(e)},selectAfterNode:function(e){var t=document.createRange();t.setStartAfter(e),this.setSelectionRange(t)},setSelectionRangeToWhatItAlreadyIs:function(){var e=this._getSelectionRange();e&&this.setSelectionRange(e)},hasValidSelection:function(){return this.getSelectionRange(!0).isValid()||r.a.android&&document.activeElement&&"TEXTAREA"===document.activeElement.nodeName},getSelectionRange:function(e){var t;return e&&(t=this._getSelectionRange()),new n.a(t)},_getSelectionRange:function(){var e,t=window.getSelection();return t.rangeCount>0&&(e=t.getRangeAt(0)),e},getSelectionNode:function(){var e=window.getSelection().anchorNode;if(e)return e.nodeType===Node.TEXT_NODE?e.parentNode:e},getSelectedText:function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!==document.selection.type?document.selection.createRange().text:void 0},clearSelection:function(){window.getSelection().removeAllRanges()},hasSelection:function(){var e=this._getSelectionRange();return!(!e||e.startContainer===document.documentElement)&&(i.default.getPaneForElement(e.startContainer)&&i.default.findParent(e.startContainer,"paneContent"))},hasRawSelection:function(){return!!window.getSelection().anchorNode},getCursorSelectionRange:function(e){var t,a=i.default.ensureDOMNode(e.target);if(a){try{i.default.PAssert(1368,i.default.findParent(a,"item"),"getCursorSelectionRange must only be called when hovered item is item",a)}catch(e){i.default.reportError(e)}var r=a.getBoundingClientRect(),s=i.default.clamp(e.clientY,r.top+9,r.bottom-9);t=this._getCursorSelectionRange(e.clientX,s)}return t?new n.a(t):void 0},_getCursorSelectionRange:function(e,t){var a;if(document.caretRangeFromPoint)a=document.caretRangeFromPoint(e,t);else if(document.caretPositionFromPoint){var r=document.caretPositionFromPoint(e,t);r&&((a=document.createRange()).setStart(r.offsetNode,r.offset),a.setEnd(r.offsetNode,r.offset))}else if(document.body.createTextRange){var n=this._getSelectionRange(),s=document.body.createTextRange();try{s.moveToPoint(e,t),s.select(),a=this._getSelectionRange(),this.setSelectionRange(n)}catch(e){}}else try{i.default.PAssert(1369,!1,"Unable to get selection range at cursor")}catch(e){i.default.reportError(e)}return a},_ensureSelectionInElement:function(e,t){try{i.default.PAssert(1370,e,"Must have a valid element")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1371,t,"Must have a valid range")}catch(e){i.default.reportError(e)}i.default.isAncestor(t.startContainer,e)||t.setStart(e,0),i.default.isAncestor(t.endContainer,e)||t.setEnd(e,0),i.default.hasClass(t.startContainer,"textSelected")&&t.setStart(t.startContainer.parentElement.firstElementChild,t.startContainer.innerText.length),i.default.hasClass(t.endContainer,"textSelected")&&t.setEnd(t.endContainer.parentElement.firstElementChild,t.endContainer.innerText.length),i.default.hasClass(t.startContainer,"itemIgnoreText")&&t.setStartBefore(t.startContainer),i.default.hasClass(t.endContainer,"itemIgnoreText")&&t.setEndBefore(t.endContainer);var a=i.default.getPluginForElement(t.startContainer);if(a){var r=a.textContent.length;!(s=a.nodeType===Node.TEXT_NODE)&&0===t.startOffset||s&&t.startOffset<r/2?t.setStartBefore(a):t.setStartAfter(a)}var n=i.default.getPluginForElement(t.endContainer);if(n){var s,o=n.textContent.length;!(s=n.nodeType===Node.TEXT_NODE)&&0===t.endOffset||s&&t.endOffset<o/2?t.setEndBefore(n):t.setEndAfter(n)}},getSelectOffsetsInElement:function(e,t){var a={start:0,end:0,total:0};if("TEXTAREA"===e.nodeName){a.start=e.selectionStart,a.end=e.selectionEnd,a.total=e.value.length;var r=e.value.indexOf("\n");r>=0&&a.start>r&&(a.start--,a.end--,a.total--)}else if(e){try{i.default.PAssert(1372,t,"Must provide a valid range")}catch(e){i.default.reportError(e)}if(t){this._ensureSelectionInElement(e,t);var n=this._getComponentNode(t.startContainer,t.startOffset),s=t.startOffset,o=this._getComponentNode(t.endContainer,t.endOffset),l=t.endOffset;n&&n.textContent===TextSpace&&(s=0),o&&o.textContent===TextSpace&&(l=0);var d=0,c=this._getComponentNodesIn(e);if(c.length>0)for(var u=0;u<c.length;++u)c[u]===n&&(a.start=d+s),c[u]===o&&(a.end=d+l),d+=this._getComponentNodeLength(c[u]),void 0===o&&(u===l-1?a.end=d:0===u&&0===l&&(a.end=0)),void 0===n&&(u===s-1?a.start=d:0===u&&0===s&&(a.start=0));else a.start=0,a.end=0;a.total=d,isNaN(a.end)&&(a.end=d)}}try{i.default.PAssert(1373,!isNaN(a.start)&&!isNaN(a.end),"Must have valid start and end",a)}catch(e){i.default.reportError(e)}return a},getSelectOffsetsForMouseEvent:function(e){var t=i.default.getElementParent(e.target),a=this.getCursorSelectionRange(e);return a&&a.getSelectOffsetsInElement(t)},getOffsetChildElement:function(e,t){try{i.default.PAssert(1374,e,"Must supply a valid element")}catch(e){i.default.reportError(e)}if("TEXTAREA"===e.nodeName)return{element:e,offset:t};if(this._isComponentNode(e)){try{i.default.PAssert(1376,this._isComponentSelectable(e),"Component must be selectable")}catch(e){i.default.reportError(e)}return{element:e,offset:t}}for(var a=0,r=this._getComponentNodesIn(e),n=0;n<r.length;++n){var s=this._getComponentNodeLength(r[n]);if(a+s>=t)return{element:r[n],offset:t-a};a+=s}try{i.default.PAssert(1375,!1,"Unable to find offset child element")}catch(e){i.default.reportError(e)}},getChildNodeOffset:function(e){try{i.default.PAssert(1377,e,"Must supply a valid child element")}catch(e){i.default.reportError(e)}for(var t=0,a=this._getComponentNodesIn(i.default.getElementParent(e)),r=this._getComponentNodesIn(e),n=0;n<a.length&&a[n]!==r[0];++n)t+=this._getComponentNodeLength(a[n]);return t},_getComponentNodeLength:function(e){try{i.default.PAssert(1378,this._isComponentNode(e),"Supplied node must be a valid component")}catch(e){i.default.reportError(e)}return i.default.hasClass(e,"plugin")?1:1===e.length&&e.textContent===TextSpace?0:e.length},_getComponentNodesIn:function(e){if(this._isComponentNode(e))return[e];var t=[];return this._getComponentNodes(t,e),t},_isComponentNode:function(e){var t=!1;return e&&(e.nodeType===Node.TEXT_NODE&&!i.default.getPluginForElement(e)||i.default.hasClass(e,"plugin"))&&(t=!0),t},_isComponentSelectable:function(e){try{i.default.PAssert(1379,!e||this._isComponentNode(e),"Must either be an invalid node (not-selectable) or a component")}catch(e){i.default.reportError(e)}var t=!1;return e&&e.nodeType===Node.TEXT_NODE&&(t=!0),t},_getComponentNodes:function(e,t){if(t)if(this._isComponentNode(t))e.push(t);else if(t.childNodes)for(var a=0;a<t.childNodes.length;++a){var i=t.childNodes[a];this._getComponentNodes(e,i)}},_getComponentNode:function(e){var t;if(this._isComponentNode(e))t=e;else{var a=i.default.getPluginForElement(e);a&&(t=a)}return t},setSelectionValues:function(e,t,a,r,n){try{i.default.PAssert(1380,e,"Range must be supplied")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1381,this._isComponentNode(t),"Must be selecting a valid component")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1382,this._isComponentNode(r),"Must be selecting a valid component")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1383,t!==r||a<=n,"Select elements must be different, or selection must start before it ends")}catch(e){i.default.reportError(e)}if(t.nodeType===Node.TEXT_NODE)e.setStart(t,a);else{try{i.default.PAssert(1384,i.default.hasClass(t,"plugin"),"Only other valid component is plugin")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1385,0===a||1===a,"Must eiter be selecting before or after the plugin")}catch(e){i.default.reportError(e)}0===a?this._selectBeforeComponent(e,t,"setStart"):1===a&&this._selectAfterComponent(e,t,"setStart")}if(r.nodeType===Node.TEXT_NODE)e.setEnd(r,n);else{try{i.default.PAssert(1386,i.default.hasClass(r,"plugin"),"Only other valid component is plugin")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1387,0===n||1===n,"Must eiter be selecting before or after the plugin")}catch(e){i.default.reportError(e)}0===n?this._selectBeforeComponent(e,r,"setEnd"):1===n&&this._selectAfterComponent(e,r,"setEnd")}},_selectBeforeComponent:function(e,t,a){var i=this._getPrevComponent(t);if(this._isComponentSelectable(i))e[a](i,this._getComponentNodeLength(i));else{var r=document.createTextNode("");t.parentNode.insertBefore(r,t),e[a](r,0)}},_selectAfterComponent:function(e,t,a){var i=this._getNextComponent(t);if(this._isComponentSelectable(i))e[a](i,0);else{var r=document.createTextNode("");t.parentNode.insertBefore(r,void 0),e[a](r,0)}},_getPrevComponent:function(e){try{i.default.PAssert(1391,e,"Must supply a valid node")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1392,this._isComponentNode(e),"Supplied node must be a valid component itself")}catch(e){i.default.reportError(e)}var t=e.previousSibling;try{i.default.PAssert(1393,!t||this._isComponentNode(t),"Siblings must always be valid components")}catch(e){i.default.reportError(e)}return t},_getNextComponent:function(e){try{i.default.PAssert(1394,e,"Must supply a valid node")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1395,this._isComponentNode(e),"Supplied node must be a valid component itself")}catch(e){i.default.reportError(e)}var t=e.nextSibling;try{i.default.PAssert(1396,!t||this._isComponentNode(t),"Siblings must always be valid components")}catch(e){i.default.reportError(e)}return t},selectElement:function(e,t,a){var i;if(isNaN(a)&&(a=t),isNaN(t))(i=this.createSelectionRange()).selectNodeContents(e);else{var r=this.getOffsetChildElement(e,t),n=t!==a?this.getOffsetChildElement(e,a):r;r&&(i=this.createFakeRange(r.element,r.offset,n.element,n.offset))}i&&this.setSelectionRange(i)},getSelectionInElement:function(e){var t=this._getSelectionRange();if(t&&i.default.isAncestor(t.startContainer,e)&&i.default.isAncestor(t.endContainer,e))return this.getSelectOffsetsInElement(e,t)},deleteRangeContents:function(){var e=this._getSelectionRange();e&&e.deleteContents()}},t.a=new s},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(4),s=a(42),o=a(8);function l(){this.styles={},this.stylesheet={},this.Themes={Classic:{checkboxOpacity:50,checkboxBackgroundOpacity:0,showVerticalLines:!1,boldHeaders:!0,itemLineHeight:18,itemPadding:7,itemIndentSize:20,fontSize:14,fontSizeHeader:14,fontSizeHeaderTopLevel:14},Outliner:{checkboxOpacity:80,checkboxBackgroundOpacity:0,showVerticalLines:!0,boldHeaders:!1,itemLineHeight:20,itemPadding:2,itemIndentSize:36,fontSize:15,fontSizeHeader:15,fontSizeHeaderTopLevel:15},Light:{checkboxOpacity:30,checkboxBackgroundOpacity:0,showVerticalLines:!0,boldHeaders:!1,itemLineHeight:20,itemPadding:3,itemIndentSize:20,fontSize:14,fontSizeHeader:14,fontSizeHeaderTopLevel:14},Markdown:{checkboxOpacity:25,checkboxBackgroundOpacity:0,showVerticalLines:!0,boldHeaders:!1,itemLineHeight:18,itemPadding:5,itemIndentSize:30,fontSize:14,fontSizeHeader:18,fontSizeHeaderTopLevel:18}},this.Defaults={Desktop:{noteLineHeight:18,notePadding:0,noteFontSize:12,grayscale:!1,Colors:{light:{bulletColor:"#444444",verticalLinesColor:32,tagColor:"#0099DD",dateColor:"#AA3300",contactColor:"#22AA66",linkColor:"#3333BB",calendarLinesColor:"#E6E6E6"},dark:{bulletColor:"#F6F6F6",verticalLinesColor:255,tagColor:"#0099DD",dateColor:"#C9302C",contactColor:"#00AF4A",linkColor:"#539bd8",calendarLinesColor:"#444444"}}}},this.timeoutSettingChanged=void 0,r.a.forceBind("_updateSettings",this),r.a.forceBind("updateStyles",this),this.updateSettingValues(),i.default.settings.listen("settingChanged",Settings.UISettingsGroup,this.onSettingChanged.bind(this)),i.default.runOnLoad(this.updateStyles)}l.prototype={getSettingValue:function(e,t){var a=!t;if(t)if(i.default.billingManager)if(i.default.billingManager.hasPremiumFeatures())a=!0;else{var r=i.default.billingManager.getPremiumStatus();a=r===PremiumStatus.Unknown||r===PremiumStatus.Trial||r===PremiumStatus.Active||r===PremiumStatus.Never}else a=!0;if(a){var n=i.default.settings.get(e,Settings.UISettingsGroup);return n===this.Defaults.Desktop.Colors.light[e]?this.Defaults.Desktop.Colors[this._colorTheme][e]:n}return this.getThemeValue(e)},getThemeValue:function(e){var t=i.default.settings.get(Settings.layoutTheme,Settings.UISettingsGroup)||"Markdown",a=this.Themes[t][e];return void 0===a&&void 0===(a=this.Defaults.Desktop[e])&&(a=this.Defaults.Desktop.Colors[this._colorTheme][e]),a},setFromThemeValue:function(e){i.default.settings.set(e,this.getThemeValue(e),Settings.UISettingsGroup)},updateSettingValues:function(){this._colorTheme=i.default.settings.get(Settings.theme),this._bulletColor=this.Defaults.Desktop.Colors[this._colorTheme].bulletColor,this._verticalLinesColor=this.Defaults.Desktop.Colors[this._colorTheme].verticalLinesColor,this._boldHeaders=this.getSettingValue(Settings.boldHeaders),this._fontSize=this.getSettingValue(Settings.fontSize,!0),this._fontSizeHeader=this.getSettingValue(Settings.fontSizeHeader,!0),this._fontSizeHeaderTopLevel=this.getSettingValue(Settings.fontSizeHeaderTopLevel,!0),this._noteFontSize=this.getSettingValue(Settings.noteFontSize,!0),this._itemPadding=this.getSettingValue(Settings.itemPadding,!0),this._notePadding=this.getSettingValue(Settings.notePadding,!0),this._itemLineHeight=this.getSettingValue(Settings.itemLineHeight,!0),this._noteLineHeight=this.Defaults.Desktop.noteLineHeight,this._itemIndentSize=this.getSettingValue(Settings.itemIndentSize,!0),this._checkboxOpacity=this.getSettingValue(Settings.checkboxOpacity,!0),this._checkboxBackgroundOpacity=this.getSettingValue(Settings.checkboxBackgroundOpacity,!0),this._showVerticalLines=this.getSettingValue(Settings.showVerticalLines,!0),this._verticalLinesOpacity=this.getSettingValue(Settings.verticalLinesOpacity,!0),this._tagColor=this.getSettingValue(Settings.tagColor,!0),this._dateColor=this.getSettingValue(Settings.dateColor,!0),this._contactColor=this.getSettingValue(Settings.contactColor,!0),this._linkColor=this.getSettingValue(Settings.linkColor,!0),this._grayscale=this.getSettingValue(Settings.grayscale)},onSettingChanged:function(){this.timeoutSettingChanged||this.isChangingTheme||(this.timeoutSettingChanged=setTimeout(this._updateSettings,0))},_updateSettings:function(){var e=this._fontSize,t=this._noteFontSize;this.timeoutSettingChanged=void 0,this.updateSettingValues();var a=this._fontSize!==e||this._noteFontSize!==t;this.fireEvent("settingsChanged",[a]),i.default.vmMain&&i.default.vmMain.paneManager&&i.default.vmMain.paneManager.clearPaneCaches(),this.updateStyles(),i.default.vmMain&&i.default.vmMain.updateAllItems(!1,!0),o.a.updateCaret()},fontSize:function(){return this._fontSize},fontSizeHeader:function(){return this._fontSizeHeader},fontSizeHeaderTopLevel:function(){return this._fontSizeHeaderTopLevel},fontSizeHeaderProjectView:function(){return 17},noteFontSize:function(){return this._noteFontSize},itemPadding:function(){return this._itemPadding},notePadding:function(){return this._notePadding},itemLineHeight:function(){return this._itemLineHeight},noteLineHeight:function(){return this._noteLineHeight},itemIndentSize:function(){return this._itemIndentSize},itemIndentStart:function(e){return n.a.phone?24:45},paddingForBlockHeader:function(){return 0},paddingForItemBottom:function(e,t){return e.hasNote()?t&&t.isViewProject()&&t.isItemTopLevel(e)?this.itemPadding():0:this.itemPadding()},paddingForItemTop:function(e,t){return e.isNote()?this.notePadding():this.itemPadding()},fontSizeForItem:function(e,t){return e.isPrefixHeader()&&t.isViewOutline()?t.isItemTopLevel(e)?this.fontSizeHeaderTopLevel():this.fontSizeHeader():t.isViewProject()&&t.isItemTopLevel(e)?this.fontSizeHeaderProjectView():e.isNote()?this.noteFontSize():this.fontSize()},lineHeightForItem:function(e,t){var a=this.itemLineHeight()-this.fontSize();return e.isNote()?this.noteLineHeight():this.fontSizeForItem(e,t)+a},boldHeaders:function(){return!!n.a.phone||this._boldHeaders},createSheet:function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.rel="stylesheet",e.appendChild(t),this.sheet=t.sheet},changeColorTheme:function(e){e!==this._colorTheme&&(this._colorTheme=e,i.default.settings.set(Settings.theme,e),this.updateSettingValues(),this.updateStyles(),this.fireEvent("themeChanged",[]))},changeTheme:function(e){this.isChangingTheme=!0,i.default.settings.set(Settings.layoutTheme,e,Settings.UISettingsGroup),this.setFromThemeValue(Settings.checkboxOpacity),this.setFromThemeValue(Settings.checkboxBackgroundOpacity),this.setFromThemeValue(Settings.showVerticalLines),this.setFromThemeValue(Settings.boldHeaders),this.setFromThemeValue(Settings.itemLineHeight),this.setFromThemeValue(Settings.itemPadding),this.setFromThemeValue(Settings.itemIndentSize),this.setFromThemeValue(Settings.fontSize),this.setFromThemeValue(Settings.fontSizeHeader),this.setFromThemeValue(Settings.fontSizeHeaderTopLevel),this.isChangingTheme=!1,this._updateSettings()},updateStyles:function(){try{i.default.PAssert(1428,!0,"Should not be running display settings on mobile")}catch(e){i.default.reportError(e)}if(this.sheet){var e=this.sheet.ownerNode;e.parentNode.removeChild(e)}this.createSheet();var t=[];if(this.boldHeaders()&&t.push(".item:not(.overviewItem).pHeader { font-weight: bold; }"),this._showVerticalLines){var a=this.itemIndentSize(),r=this._verticalLinesColor,n="rgba("+r+","+r+","+r+",",s=n+.01*this._verticalLinesOpacity+")",o=n+"0)";t.push(".vertLines { background: repeating-linear-gradient(to right, "+o+" 0, "+s+" 1px, "+o+" 2px, "+o+" "+a+"px) }")}t.push(".item:not(.hasNote) .line.last .itemPrefix:not(.prefixTask):before { bottom: "+this.itemPadding()+"px; }"),t.push(".item:not(.hasNote) .line.last .prefixTask:before { bottom: "+(this.itemPadding()+(this.itemLineHeight()-18)/2)+"px; }"),t.push(".line:not(.last) .prefixTask:before { bottom: "+(this.itemLineHeight()-18)/2+"px; }");var l=this._bulletColor;t.push(".prefixBullet:before { color: "+l+"; }"),t.push(".collapser { color: "+l+"; }");var d="rgba("+i.default.hexToRgbStr(this._bulletColor)+","+.01*this._checkboxOpacity+")";t.push(".prefixTask { border-color: "+d+"; }");var c="rgba("+i.default.hexToRgbStr(this._bulletColor)+","+.01*this._checkboxBackgroundOpacity+")";t.push(".prefixTask:not(.searchButton) { background-color: "+c+"; }"),t.push(".c-tag { color: "+this._tagColor+";}"),t.push(".c-date { color: "+this._dateColor+";}"),t.push(".c-contact { color: "+this._contactColor+";}"),t.push(".c-link { color: "+this._linkColor+";}"),t.push(".calendarDayTimes { background-image: linear-gradient(to bottom, "+this.Defaults.Desktop.Colors[this._colorTheme].calendarLinesColor+" 1px, transparent 1px) !important; }"),i.default.settings.get(Settings.underlineP,Settings.UISettingsGroup)?i.default.addClass(document.body,"underlineTags"):i.default.removeClass(document.body,"underlineTags"),this._grayscale?i.default.addClass(document.body,"grayscale"):i.default.removeClass(document.body,"grayscale"),i.default.removeClass(document.body,"theme-light"),i.default.removeClass(document.body,"theme-dark"),i.default.addClass(document.body,"theme-"+this._colorTheme);for(var u=0;u<t.length;u++)this.sheet.insertRule(t[u],0)},tagColor:function(){return this._tagColor},dateColor:function(){return this._dateColor},contactColor:function(){return this._contactColor},isDark:function(){return"dark"===this._colorTheme}},r.a.extend(l.prototype,s.a),t.a=new l},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(4),s=a(1),o=a(9),l=a(10),d=a(31),c=a(44),u=a(23),h=a(122),f=a(8),p={},m={Ctrl:0,Meta:1,Alt:2,Shift:3};function g(){var e=function(e){var t=i.default.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.toggleFilterDefault(e),!0)},t=function(e){var t=i.default.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.getFilterValue("priority")===e&&(e=0),t.search.setFilter("priority",e),!0)},a=function(){i.default.focusedPane&&(i.default.focusedPane.applyPriorityToSelection(VMLIFlag.None),i.default.sendEvent("Hotkey","Important"))},o=function(){e("starred")||(i.default.vmMain.applyFnToSelection("isStarred",{toggle:!0,restoreSelection:!0,value2:ChangeType.Local}),i.default.sendEvent("Hotkey","Star"))},g=function(){if(!e("complete")){var t,a=f.a.getSelectedItems();f.a.isValid()&&1===a.length&&!a[0].isComplete()&&(t=!0),i.default.vmMain.beginCompleteAction(),i.default.vmMain.applyFnToSelection("isComplete",{toggle:!0,restoreSelection:!0,value2:ChangeType.Local}),t&&i.default.focusedPane.selectNearestItem(f.a.getStartIndex()),i.default.vmMain.endCompleteAction(),i.default.sendEvent("Hotkey","Complete")}},v=function(e){var t=i.default.vmMain.paneManager.getPaneAtIndex(e);if(t&&(f.a.focusPane(t),!f.a.isValid()&&t.isEditable)){var a=t.indexOfFirstItem();t.selectIndex(a),t.scrollIndexIntoView(a,ScrollDuration.Default)}},y=function(e){var t=s.a.NumKeys.indexOf(e.normCode);t>=0&&t<i.default.vmMain.paneManager.paneCount()&&v(t)},S=function(e){i.default.vmMain.applyPrefixToSelection(s.a.Prefix.Bullet),i.default.sendEvent("Hotkey","PrefixBullet")},E=function(){i.default.vmMain.applyToSelection(function(e){return e.isNote()||i.default.vmMain.zoomin(e),!1}),i.default.sendEvent("Hotkey","ZoomIn")},P=function(){var e=i.default.focusedItem;e&&e.parent()&&i.default.vmMain.zoomout(e.parent()),i.default.sendEvent("Hotkey","ZoomOut")},b=function(){i.default.vmMain.applyToSelection(function(e){i.default.focusedPane.supportCollapsing&&e.toggleCollapsed(i.default.focusedPane)}),i.default.sendEvent("Hotkey","Collapse")},C=function(){i.default.focusedItem&&i.default.focusedPane&&i.default.focusedPane.supportCollapsing&&i.default.focusedPane.toggleCollapseAll(),i.default.sendEvent("Hotkey","CollapseAll")},D=function(){f.a.isValid()&&(f.a.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1}),i.default.sendEvent("Hotkey","Indent"))},I=function(){f.a.isValid()&&(f.a.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0}),i.default.sendEvent("Hotkey","Unindent"))},A=function(){if(u.a.hasRawSelection()&&i.default.elementInNonPaneEdit(u.a.getSelectionNode()))return!1;i.default.focusedPane?i.default.focusedPane.handleRedo():l.a.redoAction(),i.default.sendEvent("Hotkey","Redo")},M=function(){d.a.toggleSidebar(),i.default.sendEvent("Hotkey","ToggleSidebar")};this.platformPrimaryKey=n.a.mac?m.Meta:m.Ctrl,this.platformSecondaryKey=n.a.mac?m.Ctrl:m.Alt,this.addHotkey("Search",!1,KeyCode.F,s.a.Primary.Only,s.a.Shift.No,function(){var e=i.default.focusedPane||i.default.vmMain.paneManager.getPaneAtIndex(0);if(e){var t=e.search;t.isFocused.get()||t.focus(),i.default.sendEvent("Hotkey","Search")}}),this.addHotkey("Goto",!1,KeyCode.G,s.a.Primary.No,s.a.Shift.No,function(){i.default.vmMain.applyToSelection(function(e){return i.default.scrollToAndHighlightItem(e,i.default.focusedPane),!1}),i.default.sendEvent("Hotkey","GoTo")}),this.addHotkey("Overview",!1,KeyCode.O,s.a.Primary.No,s.a.Shift.No,function(){i.default.focusedPane&&i.default.focusedPane.toggleOverviewVisibility(),i.default.sendEvent("Hotkey","Overview")}),this.addHotkey("Complete",!1,KeyCode.Slash,s.a.Primary.Either,s.a.Shift.No,g),this.addHotkey("Complete",!1,KeyCode.Enter,s.a.Primary.Never,s.a.Shift.No,g),this.addHotkey("ArchiveCompleted",!1,KeyCode.Slash,s.a.Primary.Either,s.a.Shift.Yes,function(){i.default.focusedPane&&i.default.focusedPane.archiveCompleted(),i.default.sendEvent("Hotkey","ArchiveCompleted")}),this.addHotkey("Priority0",!1,KeyCode.D1,s.a.Primary.Only,s.a.Shift.No,function(){i.default.focusedPane&&!t(VMLIFlag.P0)&&(i.default.focusedPane.applyPriorityToSelection(VMLIFlag.P0,!0),i.default.sendEvent("Hotkey","Important"))}),this.addHotkey("Priority1",!1,KeyCode.D2,s.a.Primary.Only,s.a.Shift.No,function(){i.default.focusedPane&&!t(VMLIFlag.P1)&&(i.default.focusedPane.applyPriorityToSelection(VMLIFlag.P1,!0),i.default.sendEvent("Hotkey","Important"))}),this.addHotkey("Priority2",!1,KeyCode.D3,s.a.Primary.Only,s.a.Shift.No,function(){i.default.focusedPane&&!t(VMLIFlag.P2)&&(i.default.focusedPane.applyPriorityToSelection(VMLIFlag.P2,!0),i.default.sendEvent("Hotkey","Important"))}),this.addHotkey("PriorityNone0",!1,KeyCode.D0,s.a.Primary.Only,s.a.Shift.No,a),this.addHotkey("PriorityNone4",!1,KeyCode.D4,s.a.Primary.Only,s.a.Shift.No,a),this.addHotkey("Star",!1,KeyCode.D8,s.a.Primary.Only,s.a.Shift.Either,o),this.addHotkey("SelectPane1",!0,KeyCode.D1,s.a.Primary.Only,s.a.Shift.No,y,!1,!0),this.addHotkey("SelectPane2",!0,KeyCode.D2,s.a.Primary.Only,s.a.Shift.No,y,!1,!0),this.addHotkey("SelectPane3",!0,KeyCode.D3,s.a.Primary.Only,s.a.Shift.No,y,!1,!0),this.addHotkey("SelectPane4",!0,KeyCode.D4,s.a.Primary.Only,s.a.Shift.No,y,!1,!0),this.addHotkey("SelectPane5",!0,KeyCode.D5,s.a.Primary.Only,s.a.Shift.No,y,!1,!0),this.addHotkey("SelectPane6",!0,KeyCode.D6,s.a.Primary.Only,s.a.Shift.No,y,!1,!0),this.addHotkey("SelectPane7",!0,KeyCode.D7,s.a.Primary.Only,s.a.Shift.No,y,!1,!0),this.addHotkey("SelectPane8",!0,KeyCode.D8,s.a.Primary.Only,s.a.Shift.No,y,!1,!0),this.addHotkey("SelectPane9",!0,KeyCode.D9,s.a.Primary.Only,s.a.Shift.No,y,!1,!0),this.addHotkey("SelectPane10",!0,KeyCode.D0,s.a.Primary.Only,s.a.Shift.No,y,!1,!0),n.a.isNativeApp()&&(this.addHotkey("SelectPaneLeft",!0,KeyCode.LeftArrow,s.a.Primary.Only,s.a.Shift.No,function(){var e=i.default.vmMain.paneManager,t=i.default.vmMain.paneManager.getFocusedPaneIndex()-1;t<0&&(t=e.paneCount()-1),v(t)},!1,!0),this.addHotkey("SelectPaneRight",!0,KeyCode.RightArrow,s.a.Primary.Only,s.a.Shift.No,function(){var e=i.default.vmMain.paneManager,t=i.default.vmMain.paneManager.getFocusedPaneIndex()+1;t>=e.paneCount()&&(t=0),v(t)},!1,!0)),n.a.windows&&this.addHotkey("StarTilde",!1,KeyCode.Tilde,s.a.Primary.Only,s.a.Shift.Either,o),this.addHotkey("ZoomIn",!1,KeyCode.Enter,s.a.Primary.Yes,s.a.Shift.No,E),this.addHotkey("ZoomOut",!1,KeyCode.Enter,s.a.Primary.Yes,s.a.Shift.Yes,P),n.a.mac&&(this.addHotkey("ZoomOut",!1,KeyCode.LeftArrow,s.a.Primary.Never,s.a.Shift.No,P),this.addHotkey("ZoomIn",!1,KeyCode.RightArrow,s.a.Primary.Never,s.a.Shift.No,E),this.addHotkey("ZoomOut",!1,KeyCode.Comma,s.a.Primary.Yes,s.a.Shift.Yes,P),this.addHotkey("ZoomIn",!1,KeyCode.Period,s.a.Primary.Yes,s.a.Shift.Yes,E)),this.addHotkey("ToggleCollapse",!1,KeyCode.Space,s.a.Primary.No,s.a.Shift.No,b),this.addHotkey("CollapseAll",!1,KeyCode.Space,s.a.Primary.No,s.a.Shift.Yes,C),this.addHotkey("ToggleCollapse",!1,KeyCode.Comma,n.a.mac?s.a.Primary.Never:s.a.Primary.No,s.a.Shift.No,b),this.addHotkey("CollapseAll",!1,KeyCode.Comma,n.a.mac?s.a.Primary.Never:s.a.Primary.No,s.a.Shift.Yes,C),this.addHotkey("ToggleCollapse",!1,KeyCode.Period,s.a.Primary.Either,s.a.Shift.No,b),this.addHotkey("CollapseAll",!1,KeyCode.Period,s.a.Primary.No,s.a.Shift.Yes,C),this.addHotkey("Uncollapse",!1,KeyCode.DownArrow,s.a.Primary.Never,s.a.Shift.No,function(){i.default.vmMain.applyToSelection(function(e){i.default.focusedPane.supportCollapsing&&e.setCollapsed(!1,i.default.focusedPane)}),i.default.sendEvent("Hotkey","Collapse")}),this.addHotkey("Collapse",!1,KeyCode.UpArrow,s.a.Primary.Never,s.a.Shift.No,function(){i.default.vmMain.applyToSelection(function(e){i.default.focusedPane.supportCollapsing&&e.setCollapsed(!0,i.default.focusedPane)}),i.default.sendEvent("Hotkey","Collapse")}),this.addHotkey("Unindent",!1,KeyCode.LBracket,s.a.Primary.Either,s.a.Shift.No,I),this.addHotkey("Indent",!1,KeyCode.RBracket,s.a.Primary.Either,s.a.Shift.No,D),this.addHotkey("Unindent",!1,KeyCode.LeftArrow,s.a.Primary.Never,s.a.Shift.Yes,I),this.addHotkey("Indent",!1,KeyCode.RightArrow,s.a.Primary.Never,s.a.Shift.Yes,D);var _,T=c.a.moveUp.bind(c.a),w=c.a.moveDown.bind(c.a);this.addHotkey("MoveUp",!1,KeyCode.UpArrow,s.a.Primary.Never,s.a.Shift.Yes,T),this.addHotkey("MoveDown",!1,KeyCode.DownArrow,s.a.Primary.Never,s.a.Shift.Yes,w),n.a.mac?(this.addHotkey("MoveUp",!1,KeyCode.UpArrow,s.a.Primary.Both,s.a.Shift.No,T,!0),this.addHotkey("MoveDown",!1,KeyCode.DownArrow,s.a.Primary.Both,s.a.Shift.No,w,!0),this.addHotkey("MoveUp",!1,KeyCode.UpArrow,void 0,s.a.Shift.No,T,!0,!0),this.addHotkey("MoveDown",!1,KeyCode.DownArrow,void 0,s.a.Shift.No,w,!0,!0),this.addHotkey("Unindent",!1,KeyCode.LeftArrow,s.a.Primary.Never,s.a.Shift.Yes,I,!0),this.addHotkey("Indent",!1,KeyCode.RightArrow,s.a.Primary.Never,s.a.Shift.Yes,D,!0),this.addHotkey("SelectAll",!1,KeyCode.L,s.a.Primary.Never,s.a.Shift.No,c.a.handleSelectAllItem,!0)):(this.addHotkey("MoveUp",!1,KeyCode.UpArrow,s.a.Primary.Never,s.a.Shift.Yes,T,!0),this.addHotkey("MoveDown",!1,KeyCode.DownArrow,s.a.Primary.Never,s.a.Shift.Yes,w,!0)),this.addHotkey("ClosePane",!1,KeyCode.F4,void 0,s.a.Shift.Yes,function(e){var t=i.default.vmMain.paneManager.removeFocusedPane();void 0!==t&&(l.a.performAction(TrackerType.UIAction,{type:TrackerUIAction.RemovePane,data:t}),i.default.sendEvent("Hotkey","ClosePane"),i.default.tooltip.hideTip(),e.stopImmediatePropagation())}),n.a.mac&&!n.a.isNativeApp()&&this.addHotkey("Passthrough",!0,KeyCode.Tilde,s.a.Primary.Either,s.a.Shift.No,function(){return!1}),this.addHotkey("Bold",!1,KeyCode.B,s.a.Primary.Only,s.a.Shift.No,function(e){return f.a.isValid()&&i.default.vmMain.applyFormatToSelection("**"),e.preventDefault(),i.default.sendEvent("Hotkey","Bold"),!1}),this.addHotkey("Italic",!1,KeyCode.I,s.a.Primary.Only,s.a.Shift.No,function(e){return f.a.isValid()&&i.default.vmMain.applyFormatToSelection("*"),e.preventDefault(),i.default.sendEvent("Hotkey","Italic"),!1}),this.addHotkey("InsertLink",!1,KeyCode.K,s.a.Primary.Only,s.a.Shift.No,function(e){f.a.isValid()&&f.a.getStartItem().insertLinkAtSelection();return e.preventDefault(),i.default.sendEvent("Hotkey","InsertLink"),!1}),this.addHotkey("Save",!0,KeyCode.S,s.a.Primary.Either,s.a.Shift.No,function(){}),this.addHotkey("Move",!1,KeyCode.M,s.a.Primary.Never,s.a.Shift.No,function(){i.default.focusedPane&&f.a.isValid()&&i.default.focusedPane.autocompleteMove()}),this.addHotkey("Jump",!1,KeyCode.J,s.a.Primary.Never,s.a.Shift.No,function(){var e=i.default.focusedPane;if(e){var t=e.search,a={};t.isFocused.get()?a.elementDisplay=t.getSearchBox():e!==i.default.focusedPane&&(f.a.focusPane(e),a.elementDisplay=t.getSearchBox()),e.autocompleteJump(a)}}),this.addHotkey("Undo",!1,KeyCode.Z,s.a.Primary.Yes,s.a.Shift.No,function(){if(u.a.hasRawSelection()&&i.default.elementInNonPaneEdit(u.a.getSelectionNode()))return!1;i.default.focusedPane?i.default.focusedPane.handleUndo():l.a.undoAction(),i.default.sendEvent("Hotkey","Undo")}),this.addHotkey("Redo",!1,KeyCode.Y,s.a.Primary.Yes,s.a.Shift.No,A),this.addHotkey("Redo",!1,KeyCode.Z,s.a.Primary.Yes,s.a.Shift.Yes,A),this.addHotkey("AddPane",!1,KeyCode.T,s.a.Primary.No,s.a.Shift.No,this.hotkeyAddPane.bind(this)),this.addHotkey("NewItem",!1,KeyCode.N,s.a.Primary.No,s.a.Shift.No,this.hotkeyNewItem.bind(this)),n.a.mac?this.addHotkey("ToggleSidebar",!1,KeyCode.S,s.a.Primary.Only,s.a.Shift.No,M,!0,!0):this.addHotkey("ToggleSidebar",!1,KeyCode.S,s.a.Primary.Never,s.a.Shift.Yes,M),this.addHotkey("ToggleSidebar",!1,KeyCode.L,s.a.Primary.Only,s.a.Shift.Yes,M),this.addHotkey("PrefixHeader",!1,KeyCode.D3,s.a.Primary.Never,s.a.Shift.Yes,function(){i.default.vmMain.applyPrefixToSelection(s.a.Prefix.Header),i.default.sendEvent("Hotkey","PrefixHeader")}),this.addHotkey("PrefixTask",!1,KeyCode.LBracket,s.a.Primary.Never,s.a.Shift.Yes,function(e){i.default.vmMain.applyPrefixToSelection(s.a.Prefix.Task),i.default.sendEvent("Hotkey","PrefixTask")}),this.addHotkey("PrefixBullet",!1,KeyCode.Minus,s.a.Primary.Never,s.a.Shift.Yes,S),this.addHotkey("PrefixBullet2",!1,KeyCode.D8,s.a.Primary.Never,s.a.Shift.Yes,S),this.addHotkey("EmailCompose",!0,KeyCode.E,s.a.Primary.Only,s.a.Shift.No,function(){var e=i.default.vmMain.getDefaultEmailPlugin();e.isEnabled()?i.default.menus.openComposeEmail(e):i.default.toasts.pushMessage(MessageID.NeedGmailPermission)});var k=function(e,t){for(var a,r=0;r<t.length;r++){var n,s,o,l,d=t[r],c=!d.mods;if(c||(n=!!d.mods[m.Ctrl]==!!e.ctrlKey,s=!!d.mods[m.Meta]==!!e.metaKey,o=!!d.mods[m.Alt]==!!e.altKey,l=!!d.mods[m.Shift]==!!e.shiftKey),(c||n&&s&&o&&l)&&(d.isGlobal||e.target===document.body&&!i.default.menus.isContextMenuOpen()&&!i.default.menus.isModalOpen()||i.default.findParent(e.target,"pane"))){a=d;break}}if(a){this.currentArrowsMode&&(this._exitingArrowsMode=this.currentArrowsMode,this._exitArrowsMode());var u=a.call(e);return a.stopPropagation&&e.stopPropagation(),this._exitingArrowsMode=void 0,!1===u||(e.handled=!0,e.preventDefault(),!1)}}.bind(this),x=function(e){n.a.normalizeKeys(e),_=e.normCode,this.currentArrowsMode&&this._updateArrowsMode(e);var t,a=this.hotkeyStack.peek();if(a&&a[e.normCode]&&(t=k(e,[a[e.normCode]])),void 0===t){var r=p[e.normCode];r&&(t=k(e,r))}if(void 0!==t)return i.default.vmMain&&i.default.vmMain.updateCursorFromEvent(e),t;if(n.a.android&&e.target===document.body){if(function(e){return(n.a.mac&&e.metaKey||!n.a.mac&&e.ctrlKey)&&e.normCode===KeyCode.A}(e))return e.preventDefault(),!1;c.a.keydown(null,e)}}.bind(this);this.hotkeyStack=new h.a,this.currentArrowsMode=void 0,this.arrowsModeHotkeys={},r.a.forceBind("onMouseDownArrowsMode",this),document.addEventListener("keydown",x,!0),document.addEventListener("keyup",function(e){n.a.normalizeKeys(e),i.default.vmMain&&i.default.vmMain.updateCursorFromEvent(e),n.a.windows&&_!==e.normCode&&(e.normCode!==KeyCode.D1&&e.normCode!==KeyCode.D2&&e.normCode!==KeyCode.D3&&e.normCode!==KeyCode.D8||p[e.normCode]&&(x(e),_=void 0))},!0)}g.prototype={pushStack:function(e){for(var t={},a=0;a<e.length;a++){var i=e[a];t[i.keyCode]=i}return this.hotkeyStack.push(t),t},pushStackEscape:function(e){return this.pushStack([this.createEscape(e)])},popStack:function(e){this.hotkeyStack.pop(e)},getHotkey:function(e){var t,a=p[e.normCode];if(a)for(var i=0;i<a.length;i++){var r,n,s,o,l=a[i],d=!l.mods;if(d||(r=!!l.mods[m.Ctrl]==!!e.ctrlKey,n=!!l.mods[m.Meta]==!!e.metaKey,s=!!l.mods[m.Alt]==!!e.altKey,o=!!l.mods[m.Shift]==!!e.shiftKey),d||r&&n&&s&&o){t=l.name;break}}return t},create:function(e,t,a,r,o,l){try{i.default.PAssert(1413,i.default.isNumber(e),"Invalid keyCode")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1414,i.default.isBoolean(t),"Invalid isGlobal")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1415,i.default.isFunction(o),"Invalid callback")}catch(e){i.default.reportError(e)}var d={keyCode:e,mods:{},call:o,isGlobal:t};return a!==s.a.Primary.Yes&&a!==s.a.Primary.Both&&a!==s.a.Primary.Only||(d.mods[this.platformPrimaryKey]=!0),a!==s.a.Primary.No&&a!==s.a.Primary.Never&&a!==s.a.Primary.Both||(d.mods[this.platformSecondaryKey]=!0),l&&n.a.mac&&(d.mods[m.Alt]=!0),r===s.a.Shift.Yes&&(d.mods[m.Shift]=!0),d},createEscape:function(e){return this.create(KeyCode.Escape,!0,s.a.Primary.Either,s.a.Shift.Either,e)},addHotkey:function(e,t,a,r,o,l,d,c){try{i.default.PAssert(1416,a,"Must supply a valid keycode")}catch(e){i.default.reportError(e)}n.a.app&&!isNaN(r)&&r!==s.a.Primary.Both&&r!==s.a.Primary.Never&&r!==s.a.Primary.Only&&(r=s.a.Primary.Either),this._addHotkey(e,t,a,r,o,l,d,c)},_addHotkey:function(e,t,a,r,o,l,d,c){if(!c||!n.a.windows){if(p[a]=p[a]||[],r===s.a.Primary.Either)return this._addHotkey(e,t,a,s.a.Primary.No,o,l,d,c),void this._addHotkey(e,t,a,s.a.Primary.Yes,o,l,d,c);if(o===s.a.Shift.Either)return this._addHotkey(e,t,a,r,s.a.Shift.No,l,d,c),void this._addHotkey(e,t,a,r,s.a.Shift.Yes,l,d,c);try{i.default.PAssert(1417,!n.a.windows||r!==s.a.Primary.Both,"Should never require AltGr combo on windows")}catch(e){i.default.reportError(e)}var u=this.create(a,t,r,o,l,c);u.stopPropagation=d,u.name=e,p[a].push(u)}},registerArrowsMode:function(e,t,a,i,r,n){var s=this["arrowsModeIndex"+e]=new o.a(-1);return!0===t?this._enterArrowsMode(e,a,i,r):this._addHotkey(e,!0,t.keyCode,t.primary,t.shift,this._onKeyDownArrowsMode.bind(this,e,a,i,r,n)),s},getArrowsModeObs:function(e){return this["arrowsModeIndex"+e]},isInArrowsMode:function(e){return this.currentArrowsMode&&this.currentArrowsMode.name===e},exitArrowsMode:function(e){this.isInArrowsMode(e)&&this._exitArrowsMode()},_onKeyDownArrowsMode:function(e,t,a,i,r){this.currentArrowsMode?this._exitArrowsMode():this._exitingArrowsMode&&this._exitingArrowsMode.name===e||this._enterArrowsMode(e,t,a,i,r)},_enterArrowsMode:function(e,t,a,i,r){this.currentArrowsMode={name:e,cbGetMax:t,cbSelect:a,cbKey:i,cbOnHotkey:r},r&&r(),document.addEventListener("mousedown",this.onMouseDownArrowsMode,!0),this["arrowsModeIndex"+e].set(-1)},_exitArrowsMode:function(){this.currentArrowsMode&&(document.removeEventListener("mousedown",this.onMouseDownArrowsMode,!0),this.getArrowsModeObs(this.currentArrowsMode.name).set(-1),this.currentArrowsMode=void 0)},onMouseDownArrowsMode:function(e){this._exitArrowsMode()},_updateArrowsMode:function(e){var t=this.currentArrowsMode,a=this.getArrowsModeObs(t.name),i=n.a.getKeyCode(e),r=a.get(),s=t.cbGetMax();if(i===KeyCode.Enter)r>=0&&t.cbSelect(r),this._exitArrowsMode();else if(i===KeyCode.Escape)this._exitArrowsMode();else if(i===KeyCode.UpArrow)r>0&&a.set(r-1);else if(i===KeyCode.DownArrow)r<s-1&&a.set(r+1);else if(t.cbKey){var o=t.cbKey(i,e);o>=0&&(t.cbSelect(o),this._exitArrowsMode(),e.stopPropagation(),e.preventDefault())}},hotkeyNewItem:function(){i.default.menus.openItemEditor({addOnSave:!0,element:i.default.element("newItemButton")})},hotkeyAddPane:function(){i.default.menus.openAddPaneMenu({element:i.default.element("addPaneButton")})}},t.a=new g},function(e,t,a){"use strict";var i=a(0),r=a(7),n=a(5),s=a(4),o=a(15),l=a(10),d=a(9),c=a(19),u=a(14);function h(){this.pluginsAvailable=[PluginID.Contacts,PluginID.Drive,PluginID.GCalendar,PluginID.Gmail],this._pluginEnabledObservables={},this._pluginOptionObservables={},this.isRefreshingContacts=new d.a(!1),this.GCalendarsAvailable=new c.a,this.GCalendarSyncErrors=new c.a(void 0),this.GCalendarAddFailure=new d.a(!1),this.GCalendarListFailure=new d.a(!1),this.GCalendarListLoading=new d.a(!1),this.GmailNumSyncd=new d.a(0),this.GmailNumTotal=new d.a(0),this.GmailCacheSize=new d.a(0),this.GmailSyncAccounts=new c.a,this.enableOfflineAuth=new d.a(!1),this.isSaveEnabled=new d.a(!1),this.hasRefreshed=!1,n.a.forceBind("calendarComparator",this)}h.prototype={init:function(){var e=i.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar),t=e.getSetting(e.Settings.ImportCalendars);t&&this.GCalendarsAvailable.set(t)},checkRefresh:function(){this.hasRefreshed||this.refreshPluginStatus()},refreshPluginStatus:function(e){this.hasRefreshed=!0;for(var t=0;t<this.pluginsAvailable.length;++t){var a,r=this.pluginsAvailable[t];a=r===PluginID.Contacts?i.default.settings.get(Settings.syncContacts):i.default.vmMain.pluginManager.isAuthorized(r),this.updatePluginStatus(r,a)}e&&e!==PluginID.GCalendar||(this.updatePluginOptionStatus(PluginID.GCalendar,PluginSettingsID.GCalendar.WriteAccess),this.updatePluginOptionStatus(PluginID.GCalendar,PluginSettingsID.GCalendar.ImportCalendars,!0),this.updatePluginOptionStatus(PluginID.GCalendar,PluginSettingsID.GCalendar.ExportCalendar)),e&&e!==PluginID.Drive||this.updatePluginOptionStatus(PluginID.Drive,PluginSettingsID.Drive.WriteAccess),this.enableOfflineAuth.set(i.default.settings.get(Settings.enableOfflineAuth))},refresh:function(e){this.refreshPluginStatus(),e&&e!==PluginID.GCalendar||(this.GCalendarAddFailure.set(!1),this.GCalendarListFailure.set(!1),this.updateCalendarList()),e&&e!==PluginID.Gmail||this.updateGmailInfo()},calendarComparator:function(e,t){return e.summary.localeCompare(t.summary)},updateGmailInfo:function(){var e=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail);e.getTotalMessageCount(function(e){this.GmailNumTotal.set(e)}.bind(this)),e.getSyncdMessageCount(function(e){this.GmailNumSyncd.set(e)}.bind(this)),this.GmailSyncAccounts.set(e.getSyncAccounts())},updateCalendarList:function(){if(i.default.vmMain.pluginManager.isAuthorized(PluginID.GCalendar)){var e=i.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar);this.GCalendarListLoading.set(!0),e.getFullCalendarList(function(e){this.GCalendarListLoading.set(!1,!1),e?(e.sort(this.calendarComparator),this.GCalendarsAvailable.set(e),this.GCalendarListFailure.set(!1)):this.GCalendarListFailure.set(!0)}.bind(this))}},getEnabledPlugins:function(){this.checkRefresh();var e=this._pluginEnabledObservables;return Object.keys(e).filter(function(t){return e[t].get()})},getPluginEnabledObservable:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e]},isPluginEnabled:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e].get()},getPluginOptionObservable:function(e,t){return this.checkRefresh(),this._pluginOptionObservables[e][t]},getPluginOptions:function(e){return this.checkRefresh(),this._pluginOptionObservables[e]},isPluginAnOption:function(e){return e===PluginID.Mailbird?s.a.embed===EmbedApps.Mailbird:this.pluginsAvailable.indexOf(e)>=0},updatePluginStatus:function(e,t,a){this._pluginEnabledObservables[e]?this._pluginEnabledObservables[e].set(t,a):this._pluginEnabledObservables[e]=new d.a(t)},updatePluginOptionStatus:function(e,t,a){var r=i.default.vmMain.pluginManager.getSetting(e,t);this._pluginOptionObservables[e]||(this._pluginOptionObservables[e]={}),this._pluginOptionObservables[e][t]?this._pluginOptionObservables[e][t].set(r||a&&[]):this._pluginOptionObservables[e][t]=a?new c.a(r):new d.a(r)},onFailedAuthenticate:function(e){i.default.toasts.pushMessage({text:"We failed to successfully authenticate you for "+e+", please try again.",actionText:"OKAY"})},_wasPluginAuthorized:function(e,t){var a=!1;e===PluginID.Contacts?t.indexOf(GScope.Contacts)>=0&&(a=!0):0===i.default.vmMain.pluginManager.getPlugin(e).verifyAuthorization(i.default.vmMain.getUserEmail()).length&&(a=!0);try{i.default.PAssert(1019,a,"Should always be successful at authorizing plugins")}catch(e){i.default.reportError(e)}return a},setEnabledPlugins:function(e,t,a){for(var r=0;r<e.length;r++){var n=e[r],s=n.id,o=n.enable,l=this._pluginEnabledObservables[s].get(),d=i.default.vmMain.pluginManager.getPlugin(n.id);!o&&l&&this.disablePlugin(s),n.id!==PluginID.Drive||n.shared||d.setSetting(PluginSettingsID.Drive.WriteAccess,!1)}this.enableOfflineAuth.set(t),i.default.settings.set(Settings.enableOfflineAuth,t);var c=e.filter(function(e){return e.enable});this.enablePlugins(c,t,a)},enablePlugins:function(e,t,a){var r=e.map(function(e){var t=e.id,a=i.default.vmMain.pluginManager.getPlugin(e.id);return a?t===PluginID.Drive?a.googleScopes(e.shared):a.googleScopes():t===PluginID.Contacts?[GScope.Contacts]:void 0}).reduce(function(e,t){return e.concat(t)},[]);if(r&&r.length>0){var n=function(r){r&&!r.error?(this.refresh(),t&&(this.enableOfflineAuth.set(!0),i.default.settings.set(Settings.enableOfflineAuth,!0)),e.map(function(e){if(e.id===PluginID.Contacts)this.enableSyncContacts();else{var t=i.default.vmMain.pluginManager.getPlugin(e.id);i.default.vmMain.pluginManager.onPluginAuthorized(t,!0),e.id===PluginID.Drive&&e.shared&&t.setSetting(PluginSettingsID.Drive.WriteAccess,!0)}try{i.default.PAssert(1020,this._wasPluginAuthorized(e.id,r.scope),"Plugin "+e.id+" was not authorized properly.")}catch(e){i.default.reportError(e)}}.bind(this)),this.refresh(),a(!0)):a(!1)}.bind(this);t?o.a.runAuthenticateOffline(r,n):o.a.runAuthenticate(r,!1,!1,n)}else this.enableOfflineAuth.set(!0),i.default.settings.set(Settings.enableOfflineAuth,!0),a(!0)},_enablePlugin:function(e){var t=this._pluginEnabledObservables[e];i.default.vmMain.pluginManager.authorizePlugin(e,this.enableOfflineAuth.get(),function(a){a?(t.set(!0),this.refresh(e),i.default.sendEvent(e,"PluginEnabled")):(this.onFailedAuthenticate(e),i.default.sendEvent(e,"PluginEnableFailed"))}.bind(this))},enablePlugin:function(e){e===PluginID.Contacts?this.enableSyncContacts():this._enablePlugin(e)},disablePlugin:function(e){var t=this._pluginEnabledObservables[e];e===PluginID.Contacts?(i.default.sendEvent("Settings","DisableContacts"),o.a.loadedContacts=!1,i.default.settings.set(Settings.syncContacts,!1),r.a.clearContacts(),t.set(!1)):i.default.vmMain.pluginManager.deauthorizePlugin(e,function(){t.set(!1),i.default.sendEvent(e,"PluginDisabled")})},togglePlugin:function(e){!this._pluginEnabledObservables[e].get()?this.enablePlugin(e):this.disablePlugin(e)},togglePluginOption:function(e,t){var a=this._pluginOptionObservables[e][t],r=!a.get();i.default.vmMain.pluginManager.setSetting(e,t,r),r?i.default.vmMain.pluginManager.authorizePlugin(e,this.enableOfflineAuth.get(),function(n){n?(i.default.vmMain.pluginManager.onAuthorizedSetting(e,t,r),a.set(!0),i.default.sendEvent(e,"OptionEnabled_"+t)):(this.onFailedAuthenticate(t),i.default.vmMain.pluginManager.setSetting(e,t,!r),i.default.sendEvent(e,"OptionEnableFailed_"+t))}.bind(this)):(a.set(!1),i.default.sendEvent(e,"OptionDisabled_"+t))},setPluginOption:function(e,t,a,r,n){var s=this._pluginOptionObservables[e][t],o=s.get();i.default.vmMain.pluginManager.setSetting(e,t,a),a&&r?i.default.vmMain.pluginManager.authorizePlugin(e,this.enableOfflineAuth.get(),function(r){r?(i.default.vmMain.pluginManager.onAuthorizedSetting(e,t,a),s.set(a),i.default.sendEvent(e,"OptionSet_"+t+"_"+a),n&&n(!0)):(this.onFailedAuthenticate(t),i.default.vmMain.pluginManager.setSetting(e,t,o),i.default.sendEvent(e,"OptionEnableFailed_"+t+"_"+a),n&&n(!1))}.bind(this)):(s.set(a),i.default.sendEvent(e,"OptionSet_"+t+"_"+a),n&&n(!0))},enableOfflineFeatures:function(e){var t=this.getEnabledPlugins().map(function(e){return e===PluginID.Drive?{id:e,shared:this.getPluginOptionObservable(e,PluginSettingsID.Drive.WriteAccess).get()}:{id:e}}.bind(this));this.enablePlugins(t,!0,function(t){t?(i.default.settings.set(Settings.enableOfflineAuth,!0),i.default.sendEvent("OfflineAccess",!0)):(i.default.toasts.pushMessage({text:"We failed to successfully authenticate you for offline access.",actionText:"OKAY"}),i.default.sendEvent("OfflineAccessFailed",!0),this.enableOfflineAuth.set(!1),i.default.settings.set(Settings.enableOfflineAuth,!1)),e&&e(t)}.bind(this))},toggleOfflineFeatures:function(e,t){e?this.enableOfflineFeatures(t):(u.a.removeLinkedAccount(i.default.vmMain.getUserEmail(),function(t){t?(this.enableOfflineAuth.set(!1),i.default.settings.set(Settings.enableOfflineAuth,e)):i.default.toasts.pushMessage({text:"There was an error disabling offline authorization. Please try again in a few minutes.",actionText:"OKAY"})}.bind(this)),i.default.sendEvent("OfflineAccess",!1))},isNotificationsEnabled:function(){return!i.default.settings.get(Settings.disableNotifications)},toggleNotifications:function(){var e=i.default.settings.get(Settings.disableNotifications);i.default.settings.set(Settings.disableNotifications,!e),e?i.default.timeline.updateNotifications():i.default.timeline.clearNotifications()},enableSyncContacts:function(e){i.default.sendEvent("Settings","EnableContacts");var t=function(t){t&&!t.error?(i.default.settings.set(Settings.syncContacts,!0),this.updatePluginStatus(PluginID.Contacts,!0),o.a.loadContacts(function(t){t<0?(i.default.toasts.pushMessage({text:"There was an error syncing your contacts. Please try again.",actionText:"SYNC",action:function(){this.enableSyncContacts(e)}.bind(this)}),e&&e(!1)):(t>0&&i.default.vmMain.parseSubtree(i.default.vmMain.root(),ChangeType.Auto),e&&e(!0))}.bind(this)),l.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SyncContacts})):(i.default.settings.set(Settings.syncContacts,!1),this.updatePluginStatus(PluginID.Contacts,!1),i.default.toasts.pushMessage({text:"To sync your contacts we need permission to access them. Please try again.",actionText:"SYNC",action:function(){this.enableSyncContacts(e)}.bind(this)}),e&&e(!1))}.bind(this);this.enableOfflineAuth.get()?o.a.runAuthenticateOffline([GScope.Contacts],t):o.a.runAuthenticate([GScope.Contacts],!1,!1,t)},onTapRefreshContacts:function(e,t){var a=!1;return this.isRefreshingContacts.get()||(this.isRefreshingContacts.set(!0),a=o.a.refreshContacts(function(e){this.isRefreshingContacts.set(!1),t&&t()}.bind(this)),i.default.sendEvent("Menu","RefreshContacts")),a},onAllDayTimeValid:function(e){this.isAllDayTimeValid(e),e&&this.datesAllDayTime(i.default.element("settings-allday").value)},addCalendar:function(e){var t=i.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar);this.GCalendarListLoading.set(!0),t.createCalendar(e,function(e){this.GCalendarListLoading.set(!1),e?this.updateCalendarList():this.GCalendarAddFailure.set(!0)}.bind(this))},notifySyncError:function(e){this.GCalendarSyncErrors.set(e||[])}},t.a=new h},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(58),s=a(4),o=a(43),l=a(24),d=a(9),c=a(23),u={" ":!0,"-":!0},h={};h[window.AttachChar]=!0;var f=function(){this.fontSize=l.a.fontSize(),this.needsFontUpdate=!1,this.isNote=!1,this.isBold=!1,this.needsFontUpdate=!0,this.canvasContext=void 0,this.canvasElement=void 0,this.measureTextItem=new d.a,this.measureTextPane=new d.a,this.registerWordCaches(["Normal","Bold","Note","Header","HeaderTopLevel"]),this._lineCache=n.a.registerLocalCache("LineCache","LineCache",StorageType.LocalStorage,{saveTime:-1,writeOnUnload:!0,clearBackingOnLoad:!0,isPerDoc:!0}),this._itemCache={},this._loadCaches(),l.a.listen("settingsChanged",this.onDisplaySettingsChanged.bind(this))},p={CallCount:{GetCaretOffset:0,GetClassStyles:0,measurePaneObject:0,MeasureLines:0,MeasureWord:0,GetOffsetForPositionInLine:0},Cache:{ItemCacheMiss:0,ItemCacheHit:0,LinesCacheMiss:0,LinesCacheHit:0,CanvasStyleHit:0,CanvasStyleMiss:0,WordCacheHit:0,WordCacheMiss:0}};var m=100;function g(e){return Math.round(e*m)/m}f.prototype={registerWordCaches:function(e){this._wordCaches=[];for(var t=0;t<e.length;t++){var a=e[t],i=n.a.registerLocalCache("WordCache"+a,"WordCache"+a,StorageType.LocalStorage,{isPerDoc:!0});this._wordCaches.push(i),this["_wordCache"+a]=i}},updateFont:function(e){this.needsFontUpdate||this.fontSize!==e.fontSize||e.isBold!==this.isBold||e.isNote!==this.isNote||e.isPrefixHeader!==this.isPrefixHeader||e.isHeaderTopLevel!==this.isHeaderTopLevel?(this.fontSize=e.fontSize,this.isBold=!!e.isBold,this.isNote=!!e.isNote,this.isPrefixHeader=e.isPrefixHeader,this.isHeaderTopLevel=e.isHeaderTopLevel,this.canvasFont=(this.isBold?"bold ":"")+this.fontSize+"px Helvetica Neue, Helvetica, Arial, Sans-serif",p.Cache.CanvasStyleMiss++,this.canvasContext&&(this.canvasContext.font=this.canvasFont),this.needsFontUpdate=!1):p.Cache.CanvasStyleHit++},getCanvasElement:function(){return this.canvasElement||(this.canvasElement=document.createElement("canvas")),this.canvasElement},getCanvasContext:function(e){return this.canvasContext||(this.canvasContext=this.getCanvasElement().getContext("2d")),this.updateFont(e),this.canvasContext},getMeasureStats:function(){return p},_getLineOffset:function(e,t,a){var r=e.childNodes,n=0;if(r)for(var s=0;s<r.length;s++){var o=r[s];if(o===t){n+=a;break}if(i.default.hasClass(o,"plugin")?n+=1:o.nodeType===Node.TEXT_NODE?o.nodeValue!==TextSpace&&(n+=o.length):o.childNodes.length>0&&(n+=this._getLineOffset(o,t,a)),t&&i.default.isAncestor(t,o))break}return n},_getCaretPosition:function(e,t,a,n){var o,d,u,h,f=i.default.element("measureTextItem"),p=f.querySelector(".line").getBoundingClientRect(),m=0,g=t.hasPrefix()&&a.isViewProject()&&a.isItemTopLevel(t);e>t.getParsedText().length&&(e=t.getParsedText().length);var v=c.a._getSelectionRange();c.a.selectElement(f,e);var y,S=c.a._getSelectionRange();if(S){d=i.default.findParent(S.startContainer,"line");var E=i.default.findParent(S.startContainer,"itemPrefix",2);if(d){u=[].indexOf.call(d.parentNode.children,d),h=this._getLineOffset(d,S.startContainer,S.startOffset),i.default.hasClass(S.startContainer,"plugin")?(y=S.startContainer.getBoundingClientRect(),o={left:S.startOffset>0?y.right+12:y.left,top:y.top}):E&&e===t.getPrefixLength()?(y=E.getBoundingClientRect(),o={left:p.left+r.a.PrefixWidth+(s.a.isFirefox?0:5),top:y.top}):n&&h===this._getLineOffset(d)&&d.nextSibling?(o={left:(y=(d=d.nextSibling).getBoundingClientRect()).left+5,top:y.top},h=0,u++):((y=S.getBoundingClientRect()).left===y.right&&0===y.left&&(y=S.getClientRects()[0]),o={left:y.left,top:y.top}),s.a.isFirefox||(o.left-=5);for(var P=d.parentNode.childNodes,b=0;b<u;b++)m+=this._getLineOffset(P[b]);return v&&!i.default.findParent(v.startContainer,"fancyInput")&&c.a.setSelectionRange(v),{left:o.left-p.left-(g?r.a.PrefixWidth:0),top:o.top-p.top+l.a.paddingForItemTop(t,a),line:u,lineOffset:h,lineLength:this._getLineOffset(d),lineStart:m}}}try{i.default.PAssert(1129,!1,"Failed to compute caret position: ",e,t.getParsedText().length,i.default.getElementPath(f))}catch(e){i.default.reportError(e)}return{left:0,top:0,line:0,lineOffset:0,lineLength:0,lineStart:0}},_measureCaretPosition:function(e,t,a,r){for(var n=i.default.element("measureText"),s=i.default.element("measureTextItem"),o=e.item,d=a.getStyledLinesForPaneObject(e,!1,!0),c="",u=0;u<d.length;u++){c+='<span class="line" style="'+("font-size:"+l.a.fontSizeForItem(o,a)+"px;line-height:"+l.a.lineHeightForItem(o,a)+"px")+'">'+(d[u]||TextSpace)+"</span>"}return n.className="pane "+a.paneClass,s.className="item "+o.styleProps(a),s.innerHTML=c,this._getCaretPosition(t,o,a,r)},getCaretOffset:function(e,t,a,i){var r=e.item;if(p.CallCount.GetCaretOffset++,isNaN(a)&&(a=r.getParsedText().length),void 0===i){var n=t.caretPosition.get();if(n&&Sel.getStartOffset()===Sel.getEndOffset()&&Sel.getStartIndex()===Sel.getEndIndex())i=n.left-t.getPaddingForPaneObject(e)<30;else{var s=Sel.isArrowSelectInverted(),o=s?Sel.getStartOffset():Sel.getEndOffset(),l=s?Sel.getStartObject():Sel.getEndObject(),d=this._measureCaretPosition(l,o,t,!0),c=this._measureCaretPosition(l,o,t,!1);d.left!==c.left&&(i=!s)}}return this._measureCaretPosition(e,a,t,i)},getCaretScreenPosition:function(e,t,a){try{i.default.PAssert(1130,t>=0,"Must provide a valid index")}catch(e){i.default.reportError(e)}var r=e.itemAtIndex(t),n=e.objectAtIndex(t);try{i.default.PAssert(1131,r,"Must be able to find a valid item at index")}catch(e){i.default.reportError(e)}if(e.isIndexMounted(t)){var s=e.elementAtIndex(t);try{i.default.PAssert(1132,s,"Must be able to get element for item at index")}catch(e){i.default.reportError(e)}var o=e.getPaddingForPaneObject(n),l=this.getCaretOffset(n,e,a),d={left:-1,top:-1};if(s){var c=s.getBoundingClientRect();d.left=l.left+c.left+o,d.top=l.top+c.top}return d}return{left:-1,top:-1}},_getClassStyles:function(e,t,a){p.CallCount.GetClassStyles++;try{i.default.PAssert(1133,i.default.isVMLI(e),"Item must be a valid VMLI instance")}catch(e){i.default.reportError(e)}var r=e.isNote(),n=e.isPrefixHeader(),s=e.isPrefixHeader()&&t.isItemTopLevel(e);return{isBold:n||s&&t.isViewProject()||e.isHeader()&&l.a.boldHeaders()||a.hasClass("contact")||a.hasClass("date")||a.hasClass("duration")||a.hasClass("tag"),fontSize:e.isNote()?l.a.noteFontSize():s&&l.a.fontSizeHeaderTopLevel()||n&&l.a.fontSizeHeader()||l.a.fontSize(),isPrefixHeader:n,isHeaderTopLevel:s,isNote:r,attrs:a.getAttrs()}},measureLines:function(e,t,a,r){try{i.default.PAssert(1134,i.default.isVMLI(e),"Must provide a valid item to measure lines for")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1135,i.default.isPane(t),"Must provide a valid pane to measure lines for")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1136,a>=0,"Max width must be greater than 0: ",a)}catch(e){i.default.reportError(e)}p.CallCount.MeasureLines++;var n=this.getItemDisplayText(e),s=r||!e.requireStoredEls();try{i.default.PAssert(1137,e&&(e.els||!e.requireStoredEls()),"A Item has no els: ",e.__TEMP_InitCalled,e.__TEMP_InitParseCalled,e.__TEMP_ParseCalled,e.__TEMP_SkippedInitParsed,e.isArchived(),i.default.vmMain.hasDisplayedArchivedItems())}catch(e){i.default.reportError(e)}if(0===n.length||!e||!e.els&&e.requireStoredEls())return e&&i.default.vmMain.runSingleParse(e,ChangeType.Auto),[{text:"",start:0,length:0,width:0}];if(!s){var o=this.getLinesFromCache(e,t,a);if(o){for(var l=n.length,d=0,c=0;c<o.length;c++)d+=o[c].length;if(l===d)return p.Cache.LinesCacheHit++,o}else p.Cache.LinesCacheMiss++}var f=[],m=e.els,v=0,y="",S=0,E=[],P=0;if(m&&e.requireStoredEls())for(c=0;c<m.length;++c){var b=m[c],C=this._getClassStyles(e,t,b),D=b.getParsedText();if(void 0===b.getWidth(r)){var I=D.length;try{i.default.PAssert(1138,!C.plugin||D===window.AttachChar,"Plugin should only be set for attachment element")}catch(e){i.default.reportError(e)}for(var A=0;A<I;++A){var M=D[A];if(!u[M]||v===P||0===A&&c>0&&void 0!==m[c-1].getWidth(r)){y+=M;for(var _="",T=v+1;T<n.length;++T){var w=n[T];if(!u[w])break;_+=w}if(_||h[M]||D[A+1]===window.AttachChar){var k=this.measureWord(t,y,C,s),x=this.measureWord(t,_,C,s);E.push({text:y,delim:_,styles:C,width:k,delimWidth:Math.min(x,a),isAttach:M===window.AttachChar}),y=""}}v++}if(y.length>0){k=this.measureWord(t,y,C,s);E.push({text:y,delim:"",styles:C,width:k,delimWidth:0}),y=""}}else E.push({isPrefix:!0,text:D,width:b.getWidth(r),delimWidth:0,delim:""}),P+=D.length,v+=D.length}else{try{i.default.PAssert(1139,e&&!e.requireStoredEls(),"Items that do not have els must be marked as not requiring them to be cached")}catch(e){i.default.reportError(e)}e.els||i.default.vmMain.runSingleParse(e,ChangeType.Auto);try{i.default.PAssert(1140,e.els&&1===e.els.length,"Should always have a single el for non-measure cached items")}catch(e){i.default.reportError(e)}if((C=this._getClassStyles(e,t,e.els[0]))&&C.attrs)E.push({text:window.AttachChar,delim:"",styles:C,width:i.default.vmMain.pluginManager.measureAttachment(t,C),delimWidth:0});else{y=e.els[0].getParsedText();E.push({text:y,delim:"",styles:C,width:this.measureWord(t,y,C,s),delimWidth:0})}}var L=0,O="";v=0;for(c=0;c<E.length;++c){if(y=E[c],c>S&&L+y.width+y.delimWidth>a&&(f.push({text:O,start:v,length:O.length,width:g(L)}),v+=O.length,L=0,O="",S=c),!y.isPrefix&&y.width+y.delimWidth>a&&!y.isAttach){var R=0,N=0;L=0;for(A=0;A<y.text.length;++A)L=N,(N+=this.measureChar(y.text[A],y.styles))>a&&A>0&&A-1>R&&(O=y.text.substring(R,A),f.push({text:O,start:v,length:O.length,width:g(L)}),v+=O.length,R=A,L=0,O="",A--,N=0);if(R>=0){var F=y.text.substring(R,y.text.length);F.length>0&&(y.text=y.text.substr(0,R),O=F+y.delim,L=this.measureWord(t,F,y.styles,!0),S=c)}}else L+=y.width+y.delimWidth,O+=y.text+y.delim;c===E.length-1&&f.push({text:O,start:v,length:O.length,width:g(L)})}return s||this.saveLinesToCache(e,t,a,f),f},getPaneObjectFromCache:function(e,t){var a,r=e.item,n=e.id,s=this._itemCache[n],o=t,l=this.getItemDisplayText(r);if(s&&s[o]&&s[o].isHeader===r.isHeader()&&l===s.text&&s[o].isNote===r.isNote()&&l.indexOf(window.AttachChar)<0){var d=s[o];if(d.els)p.Cache.ItemCacheHit++,a=d;else try{i.default.PAssert(1141,!1,"Getting item from cache with no els")}catch(e){i.default.reportError(e)}}return a||p.Cache.ItemCacheMiss++,a},savePaneObjectToCache:function(e,t){try{i.default.PAssert(1142,t,"Must save a valid measured item to cache")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1143,t.els,"Measured item must have els")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1144,t.maxWidth,"Measured item must have a valid max width")}catch(e){i.default.reportError(e)}var a=e.item,r=this.getItemDisplayText(a),n=e.id,s=this._itemCache[n];if(s&&s.text===r){var o,l=0,d=Number.MAX_VALUE;for(var c in s)if(s.hasOwnProperty(c)){l++;var u=s[c].lastAccess;u<d&&(d=u,o=c)}l>=5&&delete s[o]}else s=this._itemCache[n]={text:r};s[t.maxWidth]=t},getLinesFromCache:function(e,t,a){if(t.useLineCache){var r,n,s=this._lineCache.getEntrySync(e.id);if(s)for(d=0;d<s.length&&!(r=s[d][a]);d++);if(r){var o=this.getItemDisplayText(e);if(i.default.isNumber(r))n=[{start:0,length:o.length,text:o}];else{n=new Array(r.length);for(var l=0,d=0;d<r.length;d++){var c=r[d];try{i.default.PAssert(1145,!i.default.isNumber(c),"Cached lines should always be line info rather than a number")}catch(e){i.default.reportError(e)}n[d]={start:l,length:c.length,text:o.substr(l,c.length)},l+=c.length}}}return n}},saveLinesToCache:function(e,t,a,i){if(t.useLineCache){var r;r=i.length>1?i:1;var n=this._lineCache.getEntrySync(e.id)||[];n.length>=5&&n.pop();for(var s=0;s<n.length;s++)n[s][a]&&(n.splice(s,1),s--);var o={};o[a]=r,n.splice(0,0,o),this._lineCache.cacheEntry(e.id,n)}},measurePaneObject:function(e,t,a){p.CallCount.measurePaneObject++;var r,n=t.maxWidthOfPaneObject(e),s=e.item,l=this.getItemDisplayText(s),d=s.isHeader(),c=s.isNote(),u=a;try{i.default.PAssert(1146,i.default.isNumber(n),"Must provide a valid number for maxWidth: ",n)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1147,n>=0,"Max width must be greater than 0: ",n)}catch(e){i.default.reportError(e)}if(0===l.length||n<i.default.MinItemWidth){var h=[{text:"",start:0,length:0,width:0,cls:"line",index:0}];return{height:this.lineItemHeight(s,t,1),maxWidth:n,lineLengths:[0],styledLines:[TextSpace],els:h,isHeader:d,isNote:c}}if(!(r=!u&&this.getPaneObjectFromCache(e,n))){for(var f=this.measureLines(s,t,n,a),m=[],g=[],v=0;v<f.length;++v){var y=f[v];m.push(y.length),g.push({text:y.text,start:y.start,length:y.length,width:y.width,cls:"line",index:v})}try{i.default.PAssert(1149,s&&(s.els||!s.requireStoredEls()),"B Item has no els: ",s.__TEMP_InitCalled,s.__TEMP_InitParseCalled,s.__TEMP_ParseCalled,s.__TEMP_SkippedInitParsed,s.isArchived(),i.default.vmMain.hasDisplayedArchivedItems())}catch(e){i.default.reportError(e)}if(!s.els&&s.requireStoredEls())return{height:this.lineItemHeight(s,t,1),maxWidth:n,lineLengths:[],styledLines:[],els:h=[{text:"",start:0,length:0,width:0,cls:"line",index:0}],isHeader:d,isNote:c};var S=o.a.generateStyledLines(s.els,f,t);r={height:this.lineItemHeight(s,t,f.length),maxWidth:n,lineLengths:m,styledLines:S,els:g,isHeader:d,isNote:c,lastAccess:Date.now()},u||this.savePaneObjectToCache(e,r)}return r},measureWord:function(e,t,a,r){p.CallCount.MeasureWord++;try{i.default.PAssert(1150,void 0!==t,"Must pass in a valid word")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1151,a,"Must supply valid styles for word")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1152,t.indexOf(window.AttachChar)<0||1===t.length,"AttachChar should not be processed with other chars")}catch(e){i.default.reportError(e)}if(t.length>0){if(t===window.AttachChar&&a&&a.attrs){try{i.default.PAssert(1153,!a.attrs||a.attrs.plugin,"Must have a valid plugin: ",a.attrs&&a.attrs.plugin)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1154,!a.attrs||a.attrs["plugin-id"],"Must have a valid attachment",a.attrs&&a.attrs["plugin-id"])}catch(e){i.default.reportError(e)}return i.default.vmMain.pluginManager.measureAttachment(e,a)}var n=this._selectCache(a),s=n.getEntrySync(t);if(s)return p.Cache.WordCacheHit++,s;for(var o=0,l=0;l<t.length;l++)o+=this.measureChar(t[l],a);var d=g(o);return r||n.cacheEntry(t,d),d}return 0},measureChar:function(e,t){var a=this._selectCache(t),i=a.getEntrySync(e);if(i)return i;var r=this.getCanvasContext(t).measureText(e).width;return a.cacheEntry(e,r),r},getOffsetForScreenPositionInLine:function(e,t,a,i,r){var n,s=t.item;if(a.isIndexMounted(e)){var o=a.elementAtIndex(e).querySelectorAll(".line");if(o.length>i){var d=o[i],u=d.getBoundingClientRect(),h=c.a.getSelectOffsetsForMouseEvent({target:d,clientX:Math.min(r,u.right-2),clientY:u.top+2+(0===i?l.a.paddingForItemTop(s,a):0)});h&&(n=h.start)}}if(isNaN(n)){var f=this.measurePaneObject(t,a,!0).lineLengths;n=0;for(var p=0;p<f.length;p++)n+=f[p]}return n},clearCacheForItem:function(e){for(var t in this._lineCache.removeEntry(e),this._itemCache)this._itemCache.hasOwnProperty(t)&&t.startsWith(e)&&(this._itemCache[t]=void 0)},_loadCaches:function(){for(var e=0;e<this._wordCaches.length;e++)this._wordCaches[e].loadAll();this._lineCache.loadAll()},clearWordCaches:function(){for(var e=0;e<this._wordCaches.length;e++)this._wordCaches[e].clearCache()},clearItemCache:function(){this._itemCache={}},clearLineCache:function(){this._lineCache.clearCache()},_selectCache:function(e){var t;if(e.isHeaderTopLevel)t=this._wordCacheHeaderTopLevel;else if(e.isPrefixHeader)t=this._wordCacheHeader;else if(e.isBold){try{i.default.PAssert(1155,!e.isNote,"Currently do not support bold+note")}catch(e){i.default.reportError(e)}t=this._wordCacheBold}else t=e.isNote?this._wordCacheNote:this._wordCacheNormal;return t},lineItemHeight:function(e,t,a){return i.default.isNumber(a)&&!e.isNote()||(a=1),l.a.paddingForItemTop(e,t)+l.a.paddingForItemBottom(e,t)+l.a.lineHeightForItem(e,t)*a},getItemDisplayText:function(e){return e.getParsedText()},onDisplaySettingsChanged:function(e){this.needsFontUpdate=!0,e&&this.clearWordCaches(),this.clearItemCache(),this.clearLineCache()}},t.a=new f},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(5),s=a(4),o=a(24),l=a(9),d=a(19),c=a(11),u=a(47),h=a(76),f=a(8),p=a(10);function m(){this.openOnPane=void 0,this.messages=new d.a,this.messagesLoaded=new l.a(!1),this.isLoading=new l.a(!1),this.errorMessage=new l.a(""),this.threadAttach=void 0,this.threadAttachLoading=void 0,this.threadItem=void 0,this.numLoaded=0,this._cachedCSS=void 0,n.a.forceBind("onAttachmentUpdate",this),n.a.forceBind("reset",this),n.a.forceBind("_onWindowResizeTimeout",this),o.a.listen("themeChanged",this.onDisplaySettingsChanged.bind(this)),this.init()}function g(e,t){!function(){function a(e){console.log("ERROR: ",e)}function i(e){var a,i,r=1;t.isAndroid&&(a=document.documentElement.scrollWidth,i=document.documentElement.clientWidth/a,(r=Math.max(i,.25))<1&&(document.documentElement.style.transform="scale("+r+")")),InjectedJS.postMessage("resize",{canBeShorter:e,scale:r})}window.InjectedJS={postMessage:function(t,i){try{var r;if(void 0!==i)if("string"==typeof i)r="-"+i;else try{r="-"+JSON.stringify(i)}catch(e){a(e),r=""}else r="";window.parent.postMessage("-"+t+"-"+e+r,"*")}catch(e){a(e)}}},window.addEventListener("message",function(e){if(e.data&&e.data.startsWith&&e.data.startsWith("-")){var t=e.data.indexOf("-",1),r=e.data.substring(1,t),n=e.data.substring(t+1);switch(r){case"resLoad":try{if(n)for(var s=JSON.parse(n),o=document.querySelectorAll('[cid="'+s.cid+'"]'),l="data:"+s.mimeType+";base64,"+s.data,d=0;d<o.length;++d)o[d].src=l}catch(e){a(e)}break;case"contentLoad":try{if(n){s=JSON.parse(n);document.open(),document.write(s.data),document.close(),setTimeout(i,0)}}catch(e){a(e)}break;default:a(new Error("Unknown PreviewFrame message: "+r))}}});var r=!1;function n(){document.removeEventListener("DOMContentLoaded",n,!1),r?i():(r=!0,function(){document.documentElement.addEventListener("click",function(e){InjectedJS.postMessage("click")}),document.addEventListener("keydown",function(e){var t={type:e.type,keyCode:e.keyCode,charCode:e.charCode,which:e.which,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey};InjectedJS.postMessage("keypress",t)},!0);for(var e=function(e){e.stopImmediatePropagation(),e.preventDefault();var t=this.getAttribute("href");return t.startsWith("attach:")?InjectedJS.postMessage("reqResource",[t]):t.startsWith("moodoAction:")?InjectedJS.postMessage(t.replace(/^moodoAction:/gi,"")):InjectedJS.postMessage("href",t),!1},t=document.querySelectorAll("[mlink]"),a=0;a<t.length;++a)t[a].addEventListener("click",e);var r=document.querySelectorAll("[place]");for(a=0;a<r.length;++a)r[a].addEventListener("click",function(e){for(var t=this.id,a=this.nextElementSibling,r=!1;a&&a.getAttribute("group")===t;){var n="collapsed"===a.getAttribute("quote")?"uncollapsed":"collapsed";"collapsed"===n&&(r=!0),a.setAttribute("quote",n),a=a.nextElementSibling}return setTimeout(function(){i(r)},0),e.stopImmediatePropagation(),e.preventDefault(),!1});var n=[],s=document.querySelectorAll("img");for(a=0;a<s.length;++a){var o=s[a].getAttribute("cid");o&&n.push(o),s[a].addEventListener("load",function(){i()})}n.length>0&&InjectedJS.postMessage("reqResource",n)}(),InjectedJS.postMessage("epLoaded"))}"complete"===document.readyState||"interactive"===document.readyState?setTimeout(n):(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1))}()}m.prototype={init:function(){window.addEventListener("message",function(e){if(i.default.getLocationOrigin()===e.origin&&e.data&&e.data.startsWith&&e.data.startsWith("-")){var t=e.data.indexOf("-",1),a=e.data.indexOf("-",t+1);a<0&&(a=void 0);var r=e.data.substring(1,t),n=e.data.substring(t+1,a),s=a?e.data.substring(a+1):void 0;i.default.batchRenderUpdates(function(){this.handleFrameMessage(n,r,s,e)}.bind(this))}}.bind(this)),c.a.listen("selectedIndexChanged",this.onSelectedIndexChanged.bind(this)),s.a.onResize.listen(this._onWindowResize.bind(this))},reset:function(e,t){if(this.threadAttach){for(var a=this.threadAttach.getField("messages"),i=0;i<a.length;++i){a[i].initializedForDisplay&&this._destroyMessageDisplay(a[i])}this.threadAttach.unsubscribe(this)}this.numLoaded=0,this.threadAttach=void 0,this.threadItem=void 0,this.emailElement=void 0,this.errorMessage.set("",!1),this.isLoading.set(t,!1),this.messagesLoaded.set(!1,!1),this.messages.get().length>0&&this.messages.set([],e)},_onWindowResizeTimeout:function(){if(this.threadAttach)for(var e=this.threadAttach.getField("messages"),t=0;t<e.length;++t)this.updateMessageHeight(e[t].id,!0)},_onWindowResize:function(){i.default.timeoutOnce("email resize",this._onWindowResizeTimeout,0)},getPlugin:function(){return this.threadAttach?this.threadAttach.getPlugin():i.default.vmMain.getDefaultEmailPlugin()},_sendReply:function(e,t,a){try{i.default.PAssert(1482,e,"Must supply a valid target")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1483,t,"Must supply a valid action")}catch(e){i.default.reportError(e)}try{var r="-"+t+(void 0!==a?"-"+a:"");e.postMessage(r,"*")}catch(e){i.default.reportError(e)}},handleFrameMessage:function(e,t,a,r){switch(t){case"resize":try{var n=JSON.parse(a);this.updateMessageHeight(e,!0===n.canBeShorter,n.scale)}catch(e){i.default.reportError(e)}break;case"click":i.default.fireCustomEvent("tapMain");break;case"keypress":try{var o=JSON.parse(a);s.a.normalizeKeys(o),f.a.fireKeyEvent(document.documentElement,o)}catch(e){i.default.reportError(e)}break;case"href":if(a.startsWith("mailto:")){var l=this.parseMailtoURL(a.replace(/^mailto:/gi,"")),d={to:[{email:l.to}],subject:l.subject&&unescape(l.subject),body:l.body&&unescape(l.body).replace(/\r?\n/g,"<br>")};i.default.menus.openComposeEmail(this.getPlugin(),void 0,void 0,d)}else i.default.openUrl(a);break;case"epLoaded":this.onMessageLoaded(e);break;case"reloadMessage":this.threadAttach&&this._requestMessageReload(e,this.threadAttach,e);break;case"reqResource":try{try{i.default.PAssert(1484,r,"Must provide a valid request event")}catch(e){i.default.reportError(e)}if(this.threadAttach)for(var c=JSON.parse(a),u=0;u<c.length;++u){var h=c[u],p=!1;h.startsWith("attach:")&&(h=h.replace(/^attach:/gi,""),p=!0),this.getPlugin().loadResource(this.threadAttach.id,e,h,function(e,t){var a;e&&(a={cid:t,data:p?this._createMessageHTML(this.getPlugin()._decodeEmail(e.data,void 0,{}),{},"text/html").parsed:e.data,mimeType:e.mimeType});try{if(r.source&&a){var n=p?"contentLoad":"resLoad";this._sendReply(r.source,n,a?JSON.stringify(a):void 0)}}catch(e){i.default.reportError(e)}}.bind(this))}}catch(e){i.default.reportError(e)}break;default:log("Unknown message from child frame: ",e,t,a,r)}},isOpen:function(){return this.openOnPane&&this.openOnPane.isExpanded.get()},isOpenOnPane:function(e){return this.openOnPane===e&&this.openOnPane.isExpanded.get()},isOpenOnThread:function(e){return this.isOpen()&&this.threadAttach===e},close:function(){this.isOpen()&&(this.wantsPaneTransition=!0,this.setOpenPane(null),this.reset(),this.wantsPaneTransition=!1,c.a.fireEvent("EmailPreview","onClosed",[]))},setOpenPane:function(e,t){this.openOnPane&&this.openOnPane!==e&&this.openOnPane.setExpanded(!1,t),this.openOnPane=e,e&&e.setExpanded(!0,t)},_openPane:function(e,t){try{i.default.PAssert(1485,t,"Must supply a valid cb to openPane")}catch(e){i.default.reportError(e)}e!==this.openOnPane?(this.wantsPaneTransition=!0,setTimeout(function(){this.wantsPaneTransition=!1,t()}.bind(this),r.a.EmailOpenTime+100)):t(),this.setOpenPane(e)},getPane:function(){try{i.default.PAssert(1486,this.openOnPane,"Should not be trying to get pane if email preview is not open")}catch(e){i.default.reportError(e)}return this.openOnPane},startOpenOnLoad:function(e){this.setOpenPane(e,!1)},open:function(e,t,a,r){if(t!==this.threadAttach||a!==this.openOnPane){var n=t.getPlugin();this.reset(!0,!0),this.threadAttachLoading=t,i.default.vmMain.paneManager.ensurePaneInView(a);var s=2,o=!1;if(r){var l=function(e){if(e.length>0)return e[e.length-1].labelIds.indexOf("DRAFT")<0&&this.setLastMessageResponseMode(r),!1}.bind(this);this.messages.listen(l)}var d=function(){0===--s&&t===this.threadAttachLoading&&(o?(this._setThread(t,e),p.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenEmail,data:{pane:a}})):this.errorMessage.get()?this.isLoading.set(!1):i.default.menus.alert({text:"Unable to load email messages. You may be offline.",actionText:"OKAY"}))}.bind(this);this._openPane(a,function(){d()}),n.loadThread(t,function(e,t,a){o=e,!e&&a?this.errorMessage.set(a):this.errorMessage.set(""),d()}.bind(this))}else r&&this.isOpen()&&this.setLastMessageResponseMode(r)},_getReplyToFromMessage:function(e){return this._selfSentMessage(e)?e.to:e.replyTo?[e.replyTo]:[e.from]},_getSenderFromMessage:function(e){var t=this.threadAttachLoading||this.threadAttach;return this._findSelf(t.getField("accountID"),e)},_selfSentMessage:function(e){return this.getPlugin().isMyAccountID(e.from.email)},_removeSelf:function(e){if(e){for(var t=e.slice(0),a=this.getPlugin(),i=0;i<t.length;i++)a.isMyAccountID(t[i].email)&&(t.splice(i,1),i--);return t}},_findSelf:function(e,t){var a,i=this.getPlugin(),r=i.getSendingAccounts(e);if(r.indexOf(t.from.email)>=0)a=t.from.email;else{if(t.to)for(var n=0;n<t.to.length;++n)if(r.indexOf(t.to[n].email)>=0){a=t.to[n].email;break}if(!a&&t.cc)for(n=0;n<t.cc.length;++n)if(r.indexOf(t.cc[n].email)>=0){a=t.cc[n].email;break}if(!a&&t.bcc)for(n=0;n<t.bcc.length;++n)if(r.indexOf(t.bcc[n].email)>=0){a=t.bcc[n].email;break}}return a||(a=i.getDefaultSendingAccount(e)),{text:i.getDisplayName(a),email:a}},areContactsEqual:function(e,t){return e.email===t.email},_updateDraftFromMessage:function(e,t,a){var n,s,o,l,d=this.getPlugin(),c=e.subject,u=this._getSenderFromMessage(e);try{i.default.PAssert(1487,a!==r.a.EmailResponseMode.Other,"Should never pass Other mode to _updateDraftFromMessage")}catch(e){i.default.reportError(e)}a===r.a.EmailResponseMode.Reply?n=this._getReplyToFromMessage(e):a===r.a.EmailResponseMode.ReplyAll?(n=this._removeSelf(this._getReplyToFromMessage(e).concat(e.to)),s=this._removeSelf(e.cc)):a===r.a.EmailResponseMode.Forward&&(l=e.resources.clone()),a&&(o=d.createMessageBody(e,t.from.email,a)),n=i.default.arrayUniques(n||[],this.areContactsEqual),s=i.default.arrayUniques(s||[],this.areContactsEqual),a===r.a.EmailResponseMode.Reply||a===r.a.EmailResponseMode.ReplyAll?(0!==c.toLowerCase().indexOf("re")&&(c="Re: "+c),l=t.resources):a===r.a.EmailResponseMode.Forward&&0!==c.toLowerCase().indexOf("fwd")&&(c="Fwd: "+c);var f={to:n,from:u,cc:s,bcc:void 0,subject:c,body:o,resources:l||new h.a};this.getPlugin().updateDraft(this.threadAttach,t.id,t.draftID,f,o,!0,!1,function(e){try{i.default.PAssert(1488,e,"Should always be able to update a draft")}catch(e){i.default.reportError(e)}})},requestAttachment:function(e,t,a,i){this.getPlugin().loadResource(e,t,a,i)},getAttachmentURL:function(e,t,a){return this.getPlugin().getAttachmentURL(e,t,a)},getPreviewURL:function(e){return this.getPlugin().getPreviewURL(e)},reportMessage:function(e,t,a,i,r){this.getPlugin().reportMessage(e,t,a,i,r)},dumpMessage:function(e,t,a){try{i.default.PAssert(1489,!1,"Should not be dumping message in non-DEBUG modes")}catch(e){i.default.reportError(e)}this.getPlugin().dumpMessage(e,t,a)},parseMailtoURL:function(e){var t={to:void 0,subject:void 0,body:void 0},a=e.split("?");if(t.to=a[0],a[1])for(var i=a[1].split("&"),r=0;r<i.length;++r){var n=i[r].split("=");switch(n[0].toUpperCase()){case"SUBJECT":t.subject=n[1];break;case"BODY":t.body=n[1]}}return t},parseListUnsubscribe:function(e){for(var t={emailData:void 0,url:void 0},a=e.split(","),r=0;r<a.length;++r){var n=/^<?(http|https|mailto):([^<>]*)>?/gi.exec(a[r]);if(n)switch(n[1]){case"http":case"https":t.url=n[1]+":"+n[2];break;case"mailto":t.emailData=this.parseMailtoURL(n[2]);break;default:try{i.default.PAssert(1490,!1,"Unknown List Unsubscribe Format: "+e)}catch(e){i.default.reportError(e)}}}return t},setMessageResponseMode:function(e,t){var a=this.messages.get()[this.messages.indexOfWithProperty("id",e)];try{i.default.PAssert(1491,a,"Must be able to find a valid reply message to update response mode for")}catch(e){i.default.reportError(e)}if(a){if(t!==r.a.EmailResponseMode.None){try{i.default.PAssert(1492,a.initializedForDisplay,"Must be initialized for display to set response mode")}catch(e){i.default.reportError(e)}var n=this.getPlugin().getDraftForMessage(this.threadAttach.getField("accountID"),this.threadAttach.id,e,this._getSenderFromMessage(a));this._updateDraftFromMessage(a,n,t)}a.responseMode&&a.responseMode.set(t)}},setLastMessageResponseMode:function(e){if(e){var t=this.messages.get()[this.messages.length()-1];try{i.default.PAssert(1493,t,"Setting message response mode when there are no messages")}catch(e){i.default.reportError(e)}t&&this.setMessageResponseMode(t.id,e)}},_createErrorHTML:function(){return u.a.update('<html><body>There was an error loading your mail message.<br><br><a href="moodoAction:reloadMessage">Retry</a></body></html>',{},{},"text/html")},_createMessageHTML:function(e,t,a,i){var r={collapseQuotes:!0,replaceLinks:!0,createLinksFromText:!0};if(i)for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n]);return u.a.update(e,t,r,a)},_generateCSS:function(){if(!this._cachedCSS){var e={html:{"transform-origin":"0 0"},body:{"overflow-x":"auto","overflow-y":"hidden","font-family":"'Helvetica Neue', Helvetica, Arial, Sans-serif","font-size":"14px","text-rendering":"optimizeLegibility","-moz-font-smoothing":"antialiased","-webkit-font-smoothing":"antialiased","font-smoothing":"antialiased",margin:0},"#moodoAttach":{display:"none"},'[moodoAttach="true"]':{display:"none"},'[quote="collapsed"]':{display:"none"},'[place="true"]':{cursor:"pointer",display:"inline-block",height:"12px",width:"26px","text-align":"center","margin-top":"8px","margin-bottom":"8px",color:"#aaa",border:"1px solid #ddd","background-color":"#f6f6f6","border-radius":"3px"},'[place="true"]:before':{content:'"..."',"line-height":"5px","font-size":"16px","vertical-align":"text-top"}};o.a.isDark()&&(e.body["-webkit-filter"]="invert(100%) hue-rotate(180deg)",e.img={"-webkit-filter":"invert(100%) hue-rotate(180deg)"});var t="";for(var a in e){for(var i in t+=a+"{",e[a]){t+=i+":"+e[a][i]+";"}t+="}"}this._cachedCSS="<style>"+t+"</style>"}return this._cachedCSS},_createFrameBlob:function(e,t,a){var i={isApp:s.a.app,isAndroid:s.a.android},r=this._generateCSS(),n="<script>("+g.toString()+')("'+a+'",'+JSON.stringify(i)+");<\/script>",o="<!DOCTYPE html>";t='<meta http-equiv="Content-Type" content="'+t+'">';return s.a.supportBlobURLIFrame?new Blob([o,"<html>","<head>",t,r,n,"</head>",e,"</html>"],{type:"text/html"}):[o,"<html>","<head>",t,r,n,"</head>",e,"</html>"].join("")},onMessageLoaded:function(e){this.updateMessageHeight(e),this.messagesLoaded.set(!0)},getPreviewIFrame:function(e){return document.getElementById("emailPreview_"+e)},updateMessageHeight:function(e,t,a){var r=this.getPreviewIFrame(e);if(r){var n=this.messages.get()[this.messages.indexOfWithProperty("id",e)];t&&(r.style.height="0px");try{var s=r.contentDocument.documentElement;if(s){var o=a||n.defaultScale.get(),l=Math.ceil(s.scrollWidth*o),d=Math.ceil(s.scrollHeight*o);t&&d===n.height.get()&&(r.style.height=d+"px"),n.width.set(l),n.height.set(d),a&&n.defaultScale.get()!==a&&n.defaultScale.set(a)}}catch(e){i.default.reportError(e)}}},_generateAltParts:function(e,t){var a=this.getPlugin().getMessageAttachments(t);if(a)for(var r=0;r<a.length;++r){var n=a[r];"application/ics"===n.mimeType&&this.getPlugin().loadResource(e.id,t.id,n.cid,function(e){if(e){var t=parse.parseICS(i.default.b64_to_utf8(e.data));log("Parsed ICS Data: ",t)}})}},_computeResponseMode:function(e){var t=r.a.EmailResponseMode.None;return e&&e.labelIds.indexOf("DRAFT")>=0&&(t=e.subject.startsWith("Fwd:")?r.a.EmailResponseMode.Forward:e.subject.startsWith("Re:")?1===e.to.length?r.a.EmailResponseMode.Reply:r.a.EmailResponseMode.ReplyAll:r.a.EmailResponseMode.Other),t},_createMessageDisplay:function(e,t,a){try{i.default.PAssert(1494,!e.initializedForDisplay,"Should only initialize message for display once")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1495,e.to,"Must have a valid to object")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1496,e.from,"Mus have a valid from object")}catch(e){i.default.reportError(e)}var r,n=!0;if(e.decoded?(e.isErrorMessage=!1,(r=this._createMessageHTML(e.decoded,e.resources,e.mimeType,a)).missingResourceData&&(n=!1)):(i.default.reportError(!1,"Missing message decoded data: "+i.default.isString(e.decoded)),e.isErrorMessage=!0,r=this._createErrorHTML()),e.listUnsubscribe){var o=this.parseListUnsubscribe(e.listUnsubscribe);log("Unsub Data: ",o)}try{i.default.PAssert(1497,r.parsed,"Must have valid parsed data")}catch(e){i.default.reportError(e)}return e.blob=this._createFrameBlob(r.parsed,e.contentType,e.id),i.default.isString(e.blob)||(e.blobURL&&(s.a.URL.revokeObjectURL(e.blobURL),e.blobURL=void 0),e.blobURL=s.a.URL.createObjectURL(e.blob)),e.specialLinks=r.specialLinks,e.width||(e.width=new l.a(0)),e.height||(e.height=new l.a(0)),e.defaultScale||(e.defaultScale=new l.a(1)),e.responseMode||(e.responseMode=new l.a(this._computeResponseMode(t))),e.initializedForDisplay=!0,n},_destroyMessageDisplay:function(e){try{i.default.PAssert(1498,e.initializedForDisplay,"Message must first be initialized before being destroyed")}catch(e){i.default.reportError(e)}e.initializedForDisplay=!1,e.isErrorMessage=!1,e.width=void 0,e.height=void 0,e.defaultScale=void 0,e.responseMode&&(e.responseMode=void 0),e.specialLinks=void 0,e.blob=void 0,e.blobURL&&(s.a.URL.revokeObjectURL(e.blobURL),e.blobURL=void 0)},ensureDisplayMessages:function(e){if(e===this.threadAttach)try{for(var t=e.getField("messages"),a=[],r=0;r<t.length;++r){var n=t[r];if(!e.getPlugin().isMessageDraft(n)&&!n.initializedForDisplay){try{this._generateAltParts(e,n)}catch(e){i.default.reportError(e)}(0===r?this._createMessageDisplay(n,t[r+1],{collapseQuotes:!1}):this._createMessageDisplay(n,t[r+1]))||this.getPlugin().reportMessage(e.getField("accountID"),e.id,n.id,"Error creating display",!1)}a.push(n)}a.equals(this.messages.get())||this.messages.set(a)}catch(e){i.default.reportError(e)}},_requestMessageReload:function(e,t,a){t.getPlugin().forceReloadMessage(t,a,function(r){try{i.default.PAssert(1499,r,"Must be able to re-load message data")}catch(e){i.default.reportError(e)}if(t===this.threadAttach){var n=t.getField("messages"),o=n[n.indexOfWithProperty("id",a)];if(o){var l=this.getPreviewIFrame(e);if(l)if(o.initializedForDisplay=!1,this.ensureDisplayMessages(t),s.a.supportBlobURLIFrame)l.src=o.blobURL;else{var d=l.contentWindow.document;d.documentElement.innerHTML="",d.open(),d.write(o.blob),d.close()}}}}.bind(this))},onAttachmentUpdate:function(e,t,a){(!t||t.indexOf("messages")>=0)&&e.getPlugin().loadThread(e,function(t,a){try{i.default.PAssert(1500,t,"Must be able to re-load thread data")}catch(e){i.default.reportError(e)}a&&e===this.threadAttach&&this.ensureDisplayMessages(e)}.bind(this))},getThreadAttach:function(){return this.threadAttach},_setThread:function(e,t){try{i.default.PAssert(1501,e.hasField("messages"),"Must supply valid messages to the email preview")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1502,this.errorMessage.get()||e.getField("dataLoaded"),"Must have loaded remote data or have an error")}catch(e){i.default.reportError(e)}this.threadAttach&&this.threadAttach.id===e.id||(this.reset(),this.threadAttach=e,this.threadItem=t,e.subscribe(this),this.ensureDisplayMessages(e),e.getPlugin().attachmentHasLabelByID(e,"UNREAD")&&e.getPlugin().performAction(r.a.PluginAction.Gmail.MarkRead,!0,e),c.a.fireEvent("EmailPreview","openThreadChanged",[]))},onSelectedIndexChanged:function(e,t,a){this.isOpen()&&t===this.openOnPane&&(a&&a.hasAttachmentType(r.a.PluginType.Email)?a.getAttachmentByType(r.a.PluginType.Email).getPlugin()===this.getPlugin()&&this.getPlugin().openEmailByItem(a,t):"PaneGmail"===t.type&&this.reset())},onDisplaySettingsChanged:function(){this._cachedCSS=void 0,this.threadAttach&&this.ensureDisplayMessages(this.threadAttach)}},t.a=new m},function(e,t,a){"use strict";var i=a(0),r=a(7),n=a(5),s=a(1),o=a(19),l=a(27),d=a(8),c=a(114),u=a(77),h=a(115),f=a(116);function p(){this.matches=new o.a,this._isShowing=!1,this._isTempDisabled=!1,this._showNoMatches=!1,this._searchInfo=void 0,this.owner=void 0,this.elementInput=void 0,this.text=void 0,this._prefixes=[s.a.ContactPrefix,s.a.DatePrefix,s.a.TagPrefix],this._prefixMap={},this._prefixMap[s.a.ContactPrefix]=r.a.contactManager,this._prefixMap[s.a.TagPrefix]=u.a,this._prefixMap[s.a.DatePrefix]=new c.a,n.a.forceBind("onClosed",this),n.a.forceBind("onSelectedFromPane",this),this.supportedModes=null}p.prototype={isShowing:function(){return this._isShowing},getText:function(){return this.text},getProviderForPrefix:function(e){return this._prefixMap[e]||ACProvider.None},_checkPrefixes:function(e){for(var t=e.startsWith("-")?1:0,a=0;a<this._prefixes.length;a++){var i=this._prefixes[a];if(e[t]===i)return{length:t+1,prefix:i}}},_findClosestWithPrefix:function(e,t,a){for(var i,r=e.split(/\s/),n=0,s=-1,o=-1,l=-1,d=0,c=0;c<r.length&&n<=t;++c){var u=r[c];r[s]===i&&(d=0);var h=this._checkPrefixes(u);h?(s=c,l=(o=n)+u.length,d=h.length,i=h.prefix):d&&(l+=u.length+1),n+=u.length+1}if(d){var f=e.substr(o+d,l-o-d);return{mode:a,text:e,prefix:i,searchText:f,start:o+d,end:l}}},_findClosestDelimited:function(e,t,a){for(var i=e.split(","),r=!1,n=0,s=-1,o=-1,l=0;l<i.length&&n<=t;++l){var d=i[l];s=n+this._numStartSpaces(d),o=n+d.length-1-this._numEndSpaces(d),r=s<t&&t<=o+1&&d.length>0,n+=d.length+1}if(r||this._showNoMatches){var c=e.substr(s,o-s+1);return{mode:a,text:e,searchText:c,start:s,end:o}}},_findClosestVMLIElement:function(e,t,a,i){for(var r,n,s,o=0,l=!1,d=0;d<t.length&&!1===l;d++){var c=t[d].getParsedText();if(r=o+this._numStartSpaces(c),n=o+c.length-1-this._numEndSpaces(c),r<a&&a<=n+1&&c.length>0){l=d,s=c.trim();break}o+=c.length}if(!1!==l)return{mode:i,text:e,prefix:"",searchText:s,start:r,end:n,el:t[d]}},_numStartSpaces:function(e){for(var t=0,a=0;a<e.length&&" "===e[a];a++)t++;return t},_numEndSpaces:function(e){for(var t=0,a=e.length-1;a>=0&&" "===e[a];a--)t++;return t},insertMatch:function(e){var t=this._searchInfo,a=t.text,i=a.substr(0,t.start),r=a.substr(t.end+1,a.length),n=t.start+e.length;" "!==r[0]&&e&&(e+=" ",n++);var s=i+e+r;return{text:s,offset:n}},onSelectedFromPane:function(e){e.owner.setText(e.value,!0,ChangeType.Local),d.a.selectIndex(e.index,e.offset)},prefixForMode:function(e){return"date"===e&&s.a.DatePrefix||"contact"===e&&s.a.ContactPrefix||"tag"===e&&s.a.TagPrefix||void 0},startMobileAutocomplete:function(e){var t=e.mode,a=this.prefixForMode(t),i="Search "+t.capitalize()+"s";this.showPopup({mode:t,text:i,buttonText:"Add",onSelected:function(t){var i=e.owner;if(i){var r=i.getParsedText(),n=i.getDateText();r="date"===e.mode&&n?r.replace(n,t.value):r+(r.endsWith(" ")?"":" ")+a+t.value,i.setText(r,!0,ChangeType.Local),d.a.selectIndex(e.index,r.length)}}})},updateFromPane:function(e){var t=e.owner.getACText()||"";if(!(e.start<=1)||"#"!==t&&"+"!==t){var a=e.element.getBoundingClientRect(),i=l.a.getCaretScreenPosition(e.pane,e.index,e.start);this.update({mode:"all",text:t,offset:e.start,owner:e.owner,positionOffset:{left:i.left-a.left,top:0},fromPane:!0,indexInPane:e.index,elementDisplay:e.element,position:void 0,onSelected:this.onSelectedFromPane})}},update:function(e){var t=e.mode;if(e.owner===this.owner&&e.elementInput===this.elementInput||(this._isTempDisabled=!1),e.showNoMatches&&(this._showNoMatches=!0),this.text=e.text,this._isTempDisabled||!e.text&&!this._showNoMatches)this.matches.set([]),this._showNoMatches||this.hide();else{this.owner=e.owner,this.elementInput=e.elementInput;var a=e.text,r=null,n=null;this._searchInfo="all"===t?this._findClosestWithPrefix(a,e.offset,e.mode):this._findClosestDelimited(a,e.offset,e.mode);if(this._searchInfo){this.text=this._searchInfo.searchText;if("all"===t)n=this.getProviderForPrefix(this._searchInfo.prefix);else switch(t){case s.a.AutocompleteMode.Move:case s.a.AutocompleteMode.Jump:case s.a.AutocompleteMode.Item:n=h.a;break;case s.a.AutocompleteMode.Email:r=(n=this._prefixMap[s.a.ContactPrefix]).findEmailsLike(this._searchInfo.searchText.trim(),22);break;case s.a.AutocompleteMode.Contact:n=this._prefixMap[s.a.ContactPrefix];break;case s.a.AutocompleteMode.Tag:n=this._prefixMap[s.a.TagPrefix];break;case s.a.AutocompleteMode.Date:case s.a.AutocompleteMode.Snooze:n=this._prefixMap[s.a.DatePrefix];break;case s.a.AutocompleteMode.GmailLabel:var o=i.default.vmMain.getDefaultEmailPlugin()._getAccountIDFromItem(e.item);(n=f.a).setAccountID(o);break;default:try{i.default.PAssert(1128,!1,"Unknown autocomplete mode: ",t)}catch(e){i.default.reportError(e)}}null===r&&(r=n.findMatchLike(this._searchInfo.searchText,22,i.default.focusedPane)),1===r.length&&n.findMatchExact(this._searchInfo.searchText,r)&&(r=[])}r=r||[],e.supportSearchItemAutocomplete&&"all"===t&&0===r.length&&e.parsedEls&&(this._searchInfo=this._findClosestVMLIElement(a,e.parsedEls,e.offset,t)),this.matches.set(r),!this._isShowing&&r.length>0&&!this._isTempDisabled&&!e.noShow?this.show(e):0===r.length&&(this._showNoMatches||this.hide(),this._isTempDisabled=!1)}},clearDisabled:function(){this._isTempDisabled=!1},onClosed:function(){this._isShowing=!1,this._owner=null,this.matches.clear()},show:function(e){this._isShowing=!0,this._showNoMatches=!!e._showNoMatches,this._owner=e.owner,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,i.default.menus.openContextMenu(e,!1)},showPopup:function(e){this._isShowing=!0,this._showNoMatches=!0,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,i.default.menus.openContextMenu(e)},hide:function(e){this._isShowing&&(this._isShowing=!1,i.default.menus.closeContextMenu("ReactAutocomplete"))}},t.a=new p},function(e,t,a){"use strict";var i=a(1),r=a(0),n=a(2),s=a.n(n),o=a(3).a.createClass({displayName:"FancyContextMenuHeader",componentDisplay:i.a.ComponentDisplay.Desktop,render:function(){var e=this.props,t=r.default.classNames("fancyContextMenuItem fancyContextMenuHeader flexbox c-foreground-very-faded",{"border c-border-light":!1!==e.border},{topHeader:e.topHeader}),a=r.default.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:e.hotkeyCentered}),i={padding:isNaN(e.padding)?void 0:e.padding};return s.a.createElement("div",{className:t,style:i},s.a.createElement("span",{className:"f1"},e.children),e.hotkey&&s.a.createElement("span",{className:a},e.hotkey))}});t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(9),o=a(38);function l(){this.sidebarTransitioning=!1,this.isDraggingSidebar=new s.a(!1),this.lightboxPosition=new s.a,this.lightboxSrc=new s.a,this.lightboxElement=void 0,this.sidebarChanged=new o.a}l.prototype={init:function(){this.showSidebar=new s.a(!n.a.isMailbirdSidebar()&&!i.default.isDemoInIframe()&&i.default.settings.get(Settings.showSidebar));var e=i.default.settings.get(Settings.sidebarWidth)||r.a.DesktopMenuWidthDefault;this._savedSidebarWidth=e===r.a.DesktopMenuWidthSmall?r.a.DesktopMenuWidthDefault:e,this.sidebarWidth=new s.a(e)},toggleSidebar:function(e){this.sidebarTransitioning=!0;var t=void 0!==e?e:!this.showSidebar.get();t&&(!0===e&&this._savedSidebarWidth===r.a.DesktopMenuWidthSmall&&(this._savedSidebarWidth=r.a.DesktopMenuWidthDefault),this.sidebarWidth.set(this._savedSidebarWidth)),this._setSidebarVisible(t),this.sidebarChanged.notify()},minimize:function(){this.sidebarTransitioning=!0;var e=r.a.DesktopMenuWidthSmall;i.default.settings.set(Settings.sidebarWidth,e),this.sidebarWidth.set(e),this.sidebarChanged.notify()},restore:function(){this.toggleSidebar(!0),i.default.settings.set(Settings.sidebarWidth,this.sidebarWidth.get())},getSidebarWidth:function(){return n.a.isMailbirdSidebar()||!this.showSidebar.get()?0:this.sidebarWidth.get()},setSidebarWidthMoving:function(e){this.showSidebar.set(!0),this.sidebarTransitioning=!1,this.isDraggingSidebar.set(!0),this.sidebarWidth.set(e)},setSidebarWidthUp:function(){var e=this.sidebarWidth.get();e<20?e=0:e<r.a.DesktopMenuWidthMinBig&&(e=r.a.DesktopMenuWidthSmall),e!==this.sidebarWidth.get()&&(this.sidebarTransitioning=!0,this.sidebarWidth.set(e)),e>0&&(this._savedSidebarWidth=e,i.default.settings.set(Settings.sidebarWidth,e)),this._setSidebarVisible(e>0),this.isDraggingSidebar.set(!1),this.sidebarChanged.notify()},_setSidebarVisible:function(e){i.default.settings.set(Settings.showSidebar,e),this.showSidebar.set(e)},shouldShowTopBar:function(){return!this.showSidebar.get()||n.a.isNativeMac()&&this.sidebarWidth.get()<r.a.DesktopMenuWidthMinBig}},t.a=new l},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=(a(9),a(3)),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};var c=l.a.createClass({displayName:"FancyScroller",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){var e=this.props;this.thumbExtraHeight=0;try{i.default.PAssert(2580,!(e.noOwnScroll&&e.onScroll),"FancyScroller can not have onScroll prop if it does not own its own scroll")}catch(e){i.default.reportError(e)}var t={isVisible:!1,isDragging:!1,thumbTop:0,thumbHeight:0};this.props.trackHasScrolled&&(t.hasScrolled=!1),this.createObservables(t)},componentDidMount:function(){this.refs.thumb&&this.addTap("thumb",this,this.onTapThumb)},onUnmount:function(){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)},getScrollSize:function(){var e=this.props.orientation!==r.a.Orientation.Horizontal?"Height":"Width";return this.props.getScrollSize?this.props.getScrollSize():this.refs.scroller["scroll"+e]},getClientHeight:function(){var e=this.props.orientation!==r.a.Orientation.Horizontal?"Height":"Width";return this.props.getClientHeight?this.props.getClientHeight():this.refs.scroller["client"+e]},getScrollTop:function(){var e=this.props.orientation!==r.a.Orientation.Horizontal?"Top":"Left";return this.props.getScrollTop?this.props.getScrollTop():this.refs.scroller["scroll"+e]},calculateThumb:function(){this.props;var e,t=this.getScrollSize(),a=this.getClientHeight(),i=this.getScrollTop(),r=this.props.thumbHeight;(r||(t===a?r=a:(r=a/t*a,this.thumbExtraHeight=r<30?30-r:0,r=Math.max(r,30))),t===a)?e=0:e=i/(t-a)*(a-r);var n=r!==this.thumbHeight.get()||e!==this.thumbTop.get();this.thumbHeight.set(r,!1),this.thumbTop.set(e,n)},onScroll:function(e){this.handleScroll(),this.props.onScroll&&this.props.onScroll(e)},handleScroll:function(){this.isMouseDown||(this.calculateThumb(),this.isVisible.set(!0),this.hideTimeout()),this.props.trackHasScrolled&&this.hasScrolled.set(this.getScrollTop()>0)},onMouseMove:function(e){this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)},onMouseEnter:function(e){var t=this.refs.scroller;t.scrollHeight>t.clientHeight&&(this.timeoutShow&&clearTimeout(this.timeoutShow),this.timeoutShow=setTimeout(this.showScrollbar,100))},onMouseLeave:function(e){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.isMouseDown||this.hideTimeout()},onTapThumb:{onStart:function(e){e.button===ButtonCode.Left&&(this.isMouseDown=!0,this.lastY=this.props.orientation===r.a.Orientation.Horizontal?e.clientX:e.clientY,i.default.disableMouseMove=!0,this.isDragging.set(!0)),e.stopPropagation()},onMove:function(e){if(this.isMouseDown){var t=this.refs.scroller,a=this.props.orientation===r.a.Orientation.Horizontal,n=a?e.clientX:e.clientY,s=a?"Left":"Top",o=a?"Width":"Height",l=n-this.lastY;this.lastY=n;var d=i.default.clamp(this.thumbTop.get()+l,0,t["client"+o]-this.thumbHeight.get());this.thumbTop.set(d);var c=d/(t["client"+o]-this.thumbExtraHeight)*t["scroll"+o];t["scroll"+s]=c,e.preventDefault()}},onEnd:function(e){this.isMouseDown&&e.button===ButtonCode.Left&&(this.isMouseDown=!1,i.default.disableMouseMove=!1,this.isDragging.set(!1),this.hideTimeout())}},hideTimeout:function(){this.timeoutHide&&clearTimeout(this.timeoutHide),this.timeoutHide=setTimeout(this.hideScrollbar,500)},hideScrollbar:function(){this.isVisible.set(!1),this.timeoutHide=void 0},showScrollbar:function(){this.calculateThumb(this.refs.scroller),this.isVisible.set(!0),this.timeoutShow=void 0},getElement:function(){return this.refs.element},getScrollElement:function(){return this.refs.scroller},scrollTo:function(e,t,a){isNaN(a)&&(a=ScrollDuration.Default),i.default.scrollTo(e,t,a,this.refs.scroller)},scrollToBottom:function(){var e=this.getClientHeight();this.scrollTo(0,e)},render:function(){var e=this.state,t=this.props,a=(t.getScrollSize,t.getClientHeight,t.getScrollTop,t.noOwnScroll),s=t.showScrollbars,l=(t.trackHasScrolled,t.scrollable),c=(t.orientation,t.tinyMode),u=function(e,t){var a={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a}(t,["getScrollSize","getClientHeight","getScrollTop","noOwnScroll","showScrollbars","trackHasScrolled","scrollable","orientation","tinyMode"]),h=t.orientation===r.a.Orientation.Horizontal,f=!1!==l&&!i.default.noScrollbars,p=i.default.classNames("fancyScroller",t.className,{flexbox:!0},{"flexvert horizontal":h},{vertical:!h},{trackHasScrolled:t.trackHasScrolled},{scrolled:e.hasScrolled},{tinyMode:c}),m=i.default.classNames("fancyScrollbar",{"visible c-border":e.isVisible},{dragging:e.isDragging}),g=i.default.classNames("fancyScrollbarThumb c-bg-scrollthumb",{dragging:e.isDragging}),v={};h?(v.width=e.thumbHeight,v[n.a.transform.react]="translate3d("+e.thumbTop+"px,0,0)"):(v.height=e.thumbHeight,v[n.a.transform.react]="translate3d(0,"+e.thumbTop+"px,0)");var y=i.default.classNames("fancyScrollContent",{hideScrollbar:void 0!==t.showScrollbars},{scrollable:f}),S={};return S[t.orientation===r.a.Orientation.Horizontal?"overflowX":"overflowY"]="auto",o.a.createElement("div",d({},u,{className:p,ref:"element"}),o.a.createElement("div",{className:y,style:S,ref:"scroller",onScroll:a?void 0:this.onScroll,"data-moo-id":this.getUniqueID()},t.children),!n.a.isFirefox&&f&&s&&o.a.createElement("div",{className:m,ref:"scrollbar",onMouseMove:this.onMouseMove,onMouseEnter:this.props.tinyMode?void 0:this.onMouseEnter,onMouseLeave:this.props.tinyMode?void 0:this.onMouseLeave},o.a.createElement("div",{className:g,style:v,ref:"thumb"})))}});t.a=c},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(9),l=a(3).a.createClass({displayName:"FancyCheckbox",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){var e={animCheck:!1};this.props.checked instanceof o.a?(this.checked=this.props.checked,this.trackObservable=!0):e.checked=this.props.checked||this.props.initialChecked,this.createObservables(e)},getState:function(){return this.trackObservable?{checked:this.checked}:{}},onClick:function(){var e=this.props;if(!e.disabled){this.animCheck.set(!0),setTimeout(function(){this.animCheck.set(!1)}.bind(this),300);var t=!this.checked.get();this.trackObservable&&!e.setObs||this.checked.set(t),e.onChange&&e.onChange(t)}e.onClick&&e.onClick(t)},getValue:function(){return this.checked.get()},setValue:function(e){return this.checked.set(e)},resetValue:function(){void 0!==this.props.initialChecked&&this.checked.set(this.props.initialChecked)},onKeyDown:function(e){e.keyCode===KeyCode.Enter&&this.onClick(e)},onChangeInput:function(){},componentWillReceiveProps:function(e){this.trackObservable||void 0===e.checked||e.checked===this.state.checked||this.checked.set(e.checked)},getElement:function(){return this.refs.element},getChildren:function(){return this.props.children},render:function(){var e=this.props,t=this.state.checked,a={background:t&&e.checkedColor,width:e.size,height:e.size,lineHeight:e.size&&e.size-1+"px",fontSize:e.size&&e.size-4+"px"};this.isTrackingObservable&&(t=t.get());var r=i.default.classNames("fancyCheckbox",{flexbox:!1},{checked:t},{disabled:e.disabled},{animate:this.state.animCheck},{radio:e.radio},{error:e.error},{noBG:e.noBG},e.className),n=i.default.classNames("fancyCheckboxText",{f1:!1}),o=i.default.classNames("fancyCheckboxCheck",{"c-button-raised-primary":t}),l=s.a.createElement("span",{className:o,style:a});return s.a.createElement("span",{className:r,onClick:!1!==e.canChange&&this.onClick,id:e.id,style:e.style,tabIndex:e.tabIndex,onKeyDown:this.onKeyDown,ref:"element"},s.a.createElement("input",{className:"fancyCheckboxInput",type:"checkbox",checked:t,onChange:this.onChangeInput}),l,this.props.children&&s.a.createElement("span",{className:n},this.props.children),!1)}});t.a=l},,function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(5),s=a(4),o=a(25),l=a(9),d=a(38),c=a(60),u=a(19),h=r.a.TaskViewMode,f=1;function p(){}p.prototype={init:function(){this._isSaving=!1,this._isAdding=!1,this._docID=void 0,this._syncState=void 0,this._localState=void 0,this._selectionState=void 0,this._workspaces=new u.a,this.selectedIndex=new l.a,this.selected=new c.a([this.selectedIndex],function(){return this.get()}.bind(this)),this.selectedChanged=new d.a,n.a.forceBind("getNumWorkspaces",this),n.a.forceBind("onArrowsModeSelect",this),n.a.forceBind("onArrowsModeKey",this),n.a.forceBind("onWorkspaceMouseDown",this),n.a.forceBind("hotkeyNextBoard",this),n.a.forceBind("hotkeyPrevBoard",this),n.a.forceBind("selectBoard",this);var e=o.a.registerArrowsMode("BoardsW",{keyCode:KeyCode.W,primary:s.a.mac?r.a.Primary.Never:r.a.Primary.No,shift:r.a.Shift.No},this.getNumWorkspaces,this.onArrowsModeSelect,this.onArrowsModeKey),t=o.a.registerArrowsMode("BoardsB",{keyCode:KeyCode.B,primary:r.a.Primary.Only,shift:r.a.Shift.Yes},this.getNumWorkspaces,this.onArrowsModeSelect,this.onArrowsModeKey);s.a.isNativeApp()&&(o.a.addHotkey("NextBoard",!0,KeyCode.Tab,r.a.Primary.Never,r.a.Shift.No,this.hotkeyNextBoard,!0),o.a.addHotkey("PrevBoard",!0,KeyCode.Tab,r.a.Primary.Never,r.a.Shift.Yes,this.hotkeyPrevBoard,!0),o.a.addHotkey("NextBoard2",!0,KeyCode.Tilde,r.a.Primary.Never,r.a.Shift.No,this.hotkeyNextBoard,!0),o.a.addHotkey("PrevBoard2",!0,KeyCode.Tilde,r.a.Primary.Never,r.a.Shift.Yes,this.hotkeyNextBoard,!0)),o.a.addHotkey("SelectBoard1",!0,KeyCode.D1,r.a.Primary.Never,r.a.Shift.No,this.selectBoard,!0),o.a.addHotkey("SelectBoard2",!0,KeyCode.D2,r.a.Primary.Never,r.a.Shift.No,this.selectBoard,!0),o.a.addHotkey("SelectBoard3",!0,KeyCode.D3,r.a.Primary.Never,r.a.Shift.No,this.selectBoard,!0),o.a.addHotkey("SelectBoard4",!0,KeyCode.D4,r.a.Primary.Never,r.a.Shift.No,this.selectBoard,!0),o.a.addHotkey("SelectBoard5",!0,KeyCode.D5,r.a.Primary.Never,r.a.Shift.No,this.selectBoard,!0),o.a.addHotkey("SelectBoard6",!0,KeyCode.D6,r.a.Primary.Never,r.a.Shift.No,this.selectBoard,!0),o.a.addHotkey("SelectBoard7",!0,KeyCode.D7,r.a.Primary.Never,r.a.Shift.No,this.selectBoard,!0),o.a.addHotkey("SelectBoard8",!0,KeyCode.D8,r.a.Primary.Never,r.a.Shift.No,this.selectBoard,!0),o.a.addHotkey("SelectBoard9",!0,KeyCode.D9,r.a.Primary.Never,r.a.Shift.No,this.selectBoard,!0),o.a.addHotkey("SelectBoard10",!0,KeyCode.D0,r.a.Primary.Never,r.a.Shift.No,this.selectBoard,!0),this.hotkeySelectedIndex=new c.a([e,t],function(){return e.get()>=0?e.get():t.get()}),i.default.settings.listen("settingChanged",Settings.DefaultGroup,Settings.workspaces,this.onSettingChanged.bind(this))},setIsAdding:function(e){this._isAdding=e},isAdding:function(){return this._isAdding},add:function(e){this.setIsAdding(!0);var t={id:this.getNextID(),name:this.getNextName(),needsName:!0,panes:e||[]};return this._workspaces.push(t),this.save(),t},removeWorkspace:function(e){if(this._workspaces.length()>1){var t=this._workspaces.indexOf(e),a=this.selectedIndex.get();this._workspaces.remove(e),!isNaN(a)&&a>=t&&this.setSelectedIndex(a-1),this._localState[this.getDocID()]&&delete this._localState[this.getDocID()][e.id],this.save()}},length:function(){return this._workspaces.length()},setSelectedIndex:function(e,t){var a=this.getDocID(),r=e!==this.selectedIndex.get();this.selectedIndex.set(e),!1!==t&&r&&this.selectedChanged.notify(),this._selectionState[a]!==e&&(this._selectionState[a]=e,i.default.settings.set(Settings.selectedWorkspace,this._selectionState))},switchTo:function(e){var t=this._workspaces.indexOf(e);this.setSelectedIndex(t)},getDocID:function(){return this._docID||(this.trackPaneState()?this._docID=i.default.settings.get(Settings.gdocId):this._docID="TEST"),this._docID},_findMatchingLocalPane:function(e,t){var a;if(t)for(var i=0;i<t.length;++i)if(t[i].id===e){a=t[i];break}return a},_generateUsablePaneState:function(e,t){for(var a=[],i=0;i<e.length;++i){var r=e[i],n=this._findMatchingLocalPane(r.id,t)||r;a.push({id:r.id,name:r.name,item:r.item,type:r.type,showarch:r.showarch,search:r.search,viewState:r.viewState||(r.viewMode?{viewMode:r.viewMode}:void 0),displayLocalItems:r.displayLocalItems,displayCalendars:r.displayCalendars,blocksCollapsed:r.blocksCollapsed,offset:n?n.offset:0,itemState:n?n.itemState:{},isOverviewVisible:!!n&&n.isOverviewVisible,isExpanded:!!n&&n.isExpanded,selectedItem:n?n.selectedItem:void 0})}return a},_loadWorkspaces:function(){var e=this._workspaces.get();if(!e||0===e.length){try{i.default.PAssert(931,this.getDocID(),"Should have a docID before loading workspaces panes from state")}catch(e){i.default.reportError(e)}this.load(),e=this._workspaces.get()}try{i.default.PAssert(932,e.length>0,"Must have loaded workspaces and pane state before accessing")}catch(e){i.default.reportError(e)}return e},hasLoadedPaneState:function(){return!!this._localState},getPaneState:function(){this._loadWorkspaces();var e=this.get(),t=this._localState&&this._localState[this.getDocID()]||[];return e?this._generateUsablePaneState(e.panes,t[e.id]):[]},_generateSyncPaneState:function(e){for(var t=[],a=0;a<e.length;++a){var i=e[a];t.push({id:i.id,name:i.name,item:i.item,type:i.type,showarch:i.showarch,search:i.search,viewState:i.viewState,displayCalendars:i.displayCalendars,displayLocalItems:i.displayLocalItems,blocksCollapsed:i.blocksCollapsed})}return t},_generateLocalPaneState:function(e){for(var t=[],a=0;a<e.length;++a){var i=e[a];t.push({id:i.id,offset:i.offset,itemState:i.itemState,isOverviewVisible:i.isOverviewVisible,isExpanded:i.isExpanded,selectedItem:i.selectedItem})}return t},savePaneState:function(e,t){this._loadWorkspaces();try{t||this._saveSyncState(e),this._saveLocalState(e),this.save(t)}catch(e){i.default.reportError(e,{numWorkspaces:this._workspaces.length(),selectedIndex:this.selectedIndex.get(),docID:this.getDocID()})}},_saveLocalState:function(e){var t=this.get().id;try{i.default.PAssert(933,t,"Must have a valid workspace ID")}catch(e){i.default.reportError(e)}var a=this._generateLocalPaneState(e),r=this.getDocID();try{i.default.PAssert(934,r,"Must have a valid doc ID")}catch(e){i.default.reportError(e)}this._localState[r]||(this._localState[r]={}),this._localState[r][t]=a},_saveSyncState:function(e){var t=this.get();try{i.default.PAssert(935,t,"Selected workspace does not exist")}catch(e){i.default.reportError(e)}t&&(t.panes=this._generateSyncPaneState(e))},renameWorkspace:function(e,t){for(var a=!1,i=0;i<this._workspaces.length();i++){var r=this._workspaces.get()[i];r!==e&&r.name===t&&(a=!0)}return!a&&(e.name=t,this.save(),this.selected.notify(),!0)},get:function(){var e=this.selectedIndex.get();if(void 0!==e)return this._workspaces.get()[e]},migrateLocalFromPaneState:function(e){var t={};for(var a in e)if(e.hasOwnProperty(a)){var i=e[a];t[a]=this.createDefaultState(i,["id","offset","itemState","isOverviewVisible","isExpanded"])}return t},migrateSyncFromPaneState:function(e){var t={};for(var a in e)if(e.hasOwnProperty(a)){var i=e[a];t[a]=this.createDefaultState(i,["id","item","type","showarch","search"])}return t},createDefaultState:function(e,t){for(var a=[],r=0;r<e.length;++r){var n=e[r],s={};for(var o in n)n.hasOwnProperty(o)&&t.indexOf(o)>=0&&(s[o]=n[o]);a.push(s)}var l=[{name:"Today",panes:[{type:PaneMode.Task,viewState:{viewMode:h.Agenda_Today},isOverviewVisible:!0}]},{name:"Tasks",panes:[{type:PaneMode.Task,viewState:{viewMode:h.Groups_Project},isOverviewVisible:!0}]},{name:"Calendar",panes:[{type:PaneMode.Task,viewState:{viewMode:h.Calendar_Week}}]}];return i.default.vmMain.pluginManager.isEnabled(PluginID.Gmail)&&l.splice(2,0,{name:"Email",panes:[{type:PaneMode.Gmail,isOverviewVisible:!0,isExpanded:!0}]}),a.length>0&&l.push({name:"My First Board",panes:a}),{workspaces:l}},getNextName:function(){var e,t,a=this._workspaces.get(),i=1;do{e=!1,t="Board "+i,i++;for(var r=0;r<a.length;r++){if(a[r].name===t){e=!0;break}}}while(e);return t},getNextID:function(){return 1e3*Math.floor(Math.random())+"I"+Date.now()+"Z"+ ++f},load:function(){var e,t,a=this.getDocID(),r=!1;if(a){if(this.trackPaneState()){var s=i.default.settings.get(Settings.workspaces);if(s){try{e=JSON.parse(s)}catch(t){i.default.reportError(t),e={}}try{var o=i.default.settings.get(Settings.localPaneState);t=o?JSON.parse(o):{}}catch(e){i.default.reportError(e),t={}}}else{r=!0;var l=n.a.storage.getItem("paneState");if(l){try{l=JSON.parse(l)}catch(e){i.default.reportError(e),l={}}e=this.migrateSyncFromPaneState(l),t=this.migrateLocalFromPaneState(l)}else t={},(e={})[a]=this.createDefaultState([])}}else e={},t={};if(e){var d=e[a],c=0;d&&d.workspaces||(e[a]=this.createDefaultState([]),c=1,d=e[a],r=!0),this._selectionState=i.default.settings.get(Settings.selectedWorkspace),this._selectionState&&i.default.isObject(this._selectionState)||(this._selectionState={});var u=this._selectionState[a];void 0===u&&(u=c),!isNaN(u)&&u>=d.workspaces.length&&(u=d.workspaces.length-1),this._syncState=e,this._localState=t;for(var h=0;h<d.workspaces.length;++h){var f=d.workspaces[h];i.default.isString(f.name)?f.name=f.name.replace("Workspace","Board"):f.name="Board",f.id||(f.id=this.getNextID(),r=!0)}this._workspaces.set(d.workspaces),this.setSelectedIndex(u)}r&&this.save()}},save:function(e){if(this.trackPaneState()){this._isSaving=!0;try{e||i.default.settings.set(Settings.workspaces,JSON.stringify(this._syncState)),i.default.settings.set(Settings.localPaneState,JSON.stringify(this._localState))}catch(e){i.default.reportError(e)}this._isSaving=!1}},trackPaneState:function(){return!i.default.isRunningScript()&&!i.default.isDemoMode()&&!0},onSettingChanged:function(){this._isSaving||this.load()},getNumWorkspaces:function(){return this._workspaces.get().length},onArrowsModeSelect:function(e){this.setSelectedIndex(e)},onArrowsModeKey:function(e){if(e>=KeyCode.D1&&e<=KeyCode.D9){var t=e-KeyCode.D1;if(t<this.getNumWorkspaces())return t}},getHotkeySelected:function(){return this._workspaces.get()[this.hotkeySelectedIndex.get()]},onWorkspaceMouseDown:function(e){o.a.exitArrowsMode("BoardsW"),o.a.exitArrowsMode("BoardsB")},moveTo:function(e,t){var a=this._workspaces.get()[e],i=this.get();this._workspaces.splice(e,1,void 0,!1),this._workspaces.splice(t,0,a);var r=this._workspaces.indexOf(i);r>=0&&this.selectedIndex.set(r)},cloneBoard:function(e,t){var a;(e=e||this.get(),t)?a=[t.getSaveInfo()]:a=e.panes;try{i.default.PAssert(936,a,"Must have valid panes to clone a board")}catch(e){i.default.reportError(e)}var r=this.add(a);return this.switchTo(r),r},hotkeyPrevBoard:function(){var e=this.selectedIndex.get()-1;e<0&&(e=this.length()-1),this.setSelectedIndex(e)},hotkeyNextBoard:function(){var e=this.selectedIndex.get()+1;e>=this.length()&&(e=0),this.setSelectedIndex(e)},selectBoard:function(e){var t=r.a.NumKeys.indexOf(e.normCode);t>=0&&t<this.length()&&this.setSelectedIndex(t)}},t.a=new p},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(42),s=a(9),o=a(19);function l(){this.selected={},this.numSelected=new s.a(0),this._queueRemoveEditables=[],r.a.forceBind("reset",this)}l.prototype={_selectedObjForPane:function(e){try{i.default.PAssert(914,e,"Multiselect should always pass in a pane")}catch(e){i.default.reportError(e)}e=e||i.default.focusedPane;var t=this.selected[e.id];return t||(t=this.selected[e.id]={arr:new o.a,isInverted:!1}),t},_selectedForPaneObs:function(e){return this._selectedObjForPane(e).arr},_selectedForPane:function(e){return this._selectedObjForPane(e).arr.get()},onChanged:function(e){this.numSelected.set(this.numSelectedInPane(e))},isInverted:function(e){return this._selectedObjForPane(e).isInverted},setInverted:function(e,t){this._selectedObjForPane(t).isInverted=e},isSelected:function(e,t){return this._selectedForPane(t).indexOf(e)>=0},getSelected:function(e){return this._selectedForPane(e)},getSelectedItems:function(e,t){for(var a=this._selectedForPane(e),i=[],r=0;r<a.length;++r){var n=a[r];if(e.numItems()>n){var s=e.itemAtIndex(n);!s||!t&&s.isNote()||i.push(s)}}return i},numSelectedInPane:function(e){for(var t=0,a=this._selectedForPane(e),i=0;i<a.length;i++){var r=e.itemAtIndex(a[i]);!r||r.isNote&&r.isNote()||t++}return t},getFirstSelectedIndex:function(e){e=e||i.default.focusedPane;for(var t=this._selectedForPane(e),a=Number.MAX_VALUE,r=!1,n=0;n<t.length;n++){var s=t[n];s<a&&(a=s,r=!0)}return r?a:-1},getFirstSelectedItem:function(e){e=e||i.default.focusedPane;var t=this.getFirstSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)},getLastSelectedIndex:function(e){e=e||i.default.focusedPane;for(var t=this._selectedForPane(e),a=-1,r=0;r<t.length;r++){var n=t[r];n>a&&(a=n)}return a},getLastSelectedItem:function(e){e=e||i.default.focusedPane;var t=this.getLastSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)},_resetPaneID:function(e){var t=i.default.vmMain.paneManager,a=!0;if(t.isPaneActive(e)){var r=t.getPaneById(e);r.canResetMultiselect()?(this.setSelected([],r),this.selected[e].isInverted=!1):a=!1}else delete this.selected[e];return a},reset:function(e){var t=!0;if(e)e.canResetMultiselect()?this._resetPaneID(e.id):t=!1;else for(var a in this.selected)this.selected.hasOwnProperty(a)&&(t=t&&this._resetPaneID(a));t&&this.fireEvent("reset",[e])},clearEditables:function(e){for(var t=this.getSelectedItems(e),a=1===t.length?t[0]:void 0,i=0;i<this._queueRemoveEditables.length;i++){var r=this._queueRemoveEditables[i];r!==a&&(r.isEditable.set(!1),r.itemChanged.notify())}this._queueRemoveEditables=[]},setSelected:function(e,t,a){t=t||i.default.focusedPane;var r=this._selectedForPane(t),n=i.default.arrayDiff(r,e);this.setInverted(!1,t),this._selectedForPaneObs(t).set(e);for(var s=0;s<n.length;s++){var o=n[s];if(o<t.numItems()){var l=t.itemAtIndex(o);if(l)l.itemChanged.notify()}}},toggleSelected:function(e,t,a){t=t||i.default.focusedPane;var r=this._selectedForPaneObs(t),n=t.itemAtIndex(e),s=r.indexOf(e);s>=0&&!0!==a?(r.remove(e),n.itemChanged.notify()):s<0&&!1!==a&&(r.push(e),n.itemChanged.notify())},addSelected:function(e,t){this.toggleSelected(e,t,!0)},removeSelected:function(e,t){this.toggleSelected(e,t,!1)},selectInOrder:function(e,t,a){a=a||i.default.focusedPane;for(var r=[],n=e;n<=t;n++)r.push(n);this.setSelected(r,a)},applyFnToSelected:function(e,t){i.default.vmMain.beginUpdateItems(),t=t||i.default.focusedPane;for(var a,r=this.getSelectedItems(t),n=0;n<r.length&&!1!==a;n++)a=e(r[n],n,r.length);i.default.vmMain.commitUpdateItems()}},r.a.extend(l.prototype,n.a),t.a=new l},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(9),o=a(60),l=a(18),d=a(8),c=a(36),u={None:0,Item:1,Multiselect:2,Overview:3};function h(){this.swipeMode=u.None,this.swipeX=0,this.swipePoints=[],this.multiselectAnimate=!1,this.multiselectOffset=new s.a(0),this.topBarMode=new s.a(r.a.TopBarMode.Normal),this._isDisabled=!0}h.prototype={init:function(){this.bottomBarHeight=new o.a([i.default.vmMain.gdriveStatusObs],this.getBottomBarHeight.bind(this))},isSwiping:function(){return this._isSwiping},disable:function(){this._isDisabled=!0},enable:function(){try{i.default.PAssert(1579,!1,"Should never enable MobileUI on desktop")}catch(e){i.default.reportError(e)}this._isDisabled=!1},isDisabled:function(){return this._isDisabled||i.default.isKeyboardOpen},start:function(e){if(i.default.focusedPane.isOverviewVisible()&&e.clientX>this.overviewWidth())return!0},update:function(e){if(!this.isDisabled()&&!l.a.draggingToOutline.get()){var t=i.default.dataFor(e.startSrc,!0);this.swipeMode===u.None&&(i.default.focusedPane.isOverviewVisible()?this.swipeMode=u.Overview:Math.abs(e.distanceY)<i.default.ClickThreshold&&Math.abs(e.diffX)>i.default.ClickThreshold&&(this.isInMultiselect()?this.swipeMode=u.Multiselect:t&&i.default.isVMLI(t)&&!t.isNote()&&(this.swipeMode=u.Item)));var a=e.diffX;if(this.swipePoints.splice(0,0,{time:Date.now(),x:e.xThisFrame}),this.swipePoints.length>20&&this.swipePoints.splice(this.swipePoints.length-1,1),this.swipeMode===u.Multiselect)a=i.default.clamp(-r.a.RightMenuWidth+a,-r.a.RightMenuWidth,0),this.updateMultiselectPosition(a);else if(this.swipeMode===u.Overview)a=i.default.clamp(this.overviewWidth()+a,0,this.overviewWidth()),i.default.focusedPane.updatePosition(a,!1);else if(this.swipeMode===u.Item&&t){var s=i.default.getCellForElement(e.target);try{i.default.PAssert(1580,s,"Expected cell for swipe")}catch(e){i.default.reportError(e)}s&&(a=i.default.clamp(a,-n.a.windowWidth(),n.a.windowWidth()),s.isAnimatingOffsetX=!1,s.offsetX.set(a))}this.lastX=e.diffX}return this.swipeMode!==u.None&&e.preventDefault(),this.swipeMode!==u.None},onClickPane:function(e){var t=i.default.focusedPane;!this.isDisabled()&&t.isOverviewVisible()&&(d.a.closeKeyboard(),this.setOverviewVisibility(t,!1))},end:function(e){var t=i.default.focusedPane,a=this.swipeMode!==u.None;if(!this.isDisabled())if(this.swipeMode===u.Item){var s=i.default.dataFor(e.startSrc,!0);if(s&&i.default.isVMLI(s)){var o=i.default.getCellForElement(e.target),l=i.default.getItemForElement(e.target);try{i.default.PAssert(1581,o&&l,"Expected cell and item for swipe")}catch(e){i.default.reportError(e)}if(o){var c=t.getSwipeMenuItem(l,o.offsetX.get());o.isAnimatingOffsetX=!0,o.offsetX.set(0),c.fn&&c.fn(l)}}}else if(this.swipeMode===u.Multiselect||this.swipeMode===u.Overview){for(var h,f,p=Date.now(),m=0,g=0,v=0;v<this.swipePoints.length;v++){var y=this.swipePoints[v];if(!(p-y.time<300))break;m+=y.x,g=p-y.time}var S=m?m/(g/1e3):0;S<-200?h=0:S>200?h=1:this.swipeMode===u.Overview?h=Math.round((this.overviewWidth()+this.lastX)/n.a.windowWidth()):this.swipeMode===u.Multiselect&&(h=Math.round(this.lastX/r.a.RightMenuWidth)),this.swipeMode===u.Overview?(f=h>0,this.setOverviewVisibility(t,f),f&&d.a.closeKeyboard()):this.swipeMode===u.Multiselect&&(f=0===h,this.setMultiselectVisibility(f))}return this.swipeMode=u.None,this.swipePoints.length=0,a},setOverviewVisibility:function(e,t){e.updatePosition(t?this.overviewWidth():0,!0),e.overview.setVisibility(t)},toggleOverviewVisibility:function(e){var t=!(e=e||i.default.focusedPane).isOverviewVisible();this.setOverviewVisibility(e,t)},overviewWidth:function(){return Math.min(Math.floor(.85*n.a.windowWidth()),400)},isInMultiselect:function(){return 0!==this.multiselectOffset.get()},updateMultiselectPosition:function(e,t){this.multiselectAnimate=t,this.multiselectOffset.set(e),this.topBarMode.set(0!==e?r.a.TopBarMode.Multiselect:r.a.TopBarMode.Normal),0!==e&&d.a.closeKeyboard()},setMultiselectVisibility:function(e){this.updateMultiselectPosition(e?-r.a.RightMenuWidth:0,!0),e||c.a.reset()},setTopBarMode:function(e){this.topBarMode.set(e)},resetTopBarMode:function(){var e=this.topBarMode.get();e===r.a.TopBarMode.Multiselect?(this.updateMultiselectPosition(0,!0),c.a.reset()):e===r.a.TopBarMode.Note&&(i.default.menus.closeContextMenu(),d.a.reset()),i.default.autocomplete.hide(),this.topBarMode.set(r.a.TopBarMode.Normal)},getBottomBarHeight:function(){return r.a.MobileBottomHeight+(i.default.vmMain.onlineText()?14:0)}},t.a=new h},function(e,t,a){"use strict";var i=a(72),r=function(e){this._listeners=[],this._enabled=!0,e&&this._listeners.push(e)};r.prototype={listen:function(e){return this._addListener(e),new i.a(this,e)},_addListener:function(e){this._listeners.push(e)},_hasListener:function(e){return this._listeners.indexOf(e)>=0},unlisten:function(e){this._listeners.remove(e)},enable:function(){this._enabled=!0},disable:function(){this._enabled=!1},notify:function(){if(this._enabled)for(var e=0;e<this._listeners.length;++e)arguments.length>0?this._listeners[e](arguments[0]):this._listeners[e]()}},t.a=r},function(e,t,a){"use strict";var i=a(0),r=a(104),n=a(14),s=function(){0};s.prototype={fns:function(e){return this._data.gapi.client[e]},generatePackedFns:function(e){var t=this._data.gapi.client[e],a=["gapi","client",e];this._iterateAPI(t,a)},_iterateAPI:function(e,t){if(i.default.isString(e.path))e.packedFn||(log("WARNING: Missing Pre-Packed Fn: [ '"+t.join("', '")+"' ]"),e.packedFn=t.slice(0));else for(var a in e)i.default.isObject(e[a])&&(t.push(a),this._iterateAPI(e[a],t),t.pop())},_constructPath:function(e,t){var a=i.default.clone(t);for(var r in t){var n=new RegExp("\\{"+r+"\\}"),s=e.replace(n,encodeURIComponent(t[r]));s!==e&&delete a[r],e=s}return delete a.resource,delete a.timeoutMS,delete a.forceNoDupe,{path:e,fields:a}},_constructHeaders:function(e,t){var a={Authorization:"Bearer "+n.a.getAccountTokenSync(t).access_token};for(var i in e)a[i]=e[i];return a},canConstruct:function(e){var t=!1;return i.default.isFunction(e)||(t=!!i.default.unpackFn(e,this._data)),t},createBatch:function(e){return new r.a(gapi.client.newBatch,e)},createRequest:function(e,t,a){var r,n=i.default.unpackFn(t,this._data);if(n){var s=this._constructPath(n.path,a),o=this._constructHeaders(n.headers,e),l={path:s.path,method:n.method||"GET",params:s.fields,body:a.resource,headers:o};i.default.isDemoMode()&&(l.__packedFn=t,l.__rawParams=a),r=gapi.client.request(l)}else{var d=i.default.unpackFn(t);d&&(r=d(a))}return r},getAPIForRequest:function(e){try{i.default.PAssert(978,i.default.isDemoMode(),"Must only reverse the path in demo mode")}catch(e){i.default.reportError(e)}return i.default.unpackFn(e.__packedFn)},_data:{gapi:{client:{drive:{files:{get:{path:"/drive/v2/files/{fileId}",method:"GET",packedFn:["gapi","client","drive","files","get"]},list:{path:"/drive/v2/files",method:"GET",packedFn:["gapi","client","drive","files","list"]},trash:{path:"/drive/v2/files/{fileId}/trash",method:"POST",packedFn:["gapi","client","drive","files","trash"]},untrash:{path:"/drive/v2/files/{fileId}/untrash",method:"POST",packedFn:["gapi","client","drive","files","untrash"]},insert:{path:"/drive/v2/files",method:"POST",packedFn:["gapi","client","drive","files","insert"]},patch:{path:"/drive/v2/files/{fileId}",method:"PATCH",packedFn:["gapi","client","drive","files","patch"]}},permissions:{list:{path:"/drive/v2/files/{fileId}/permissions",method:"GET",packedFn:["gapi","client","drive","permissions","list"]},insert:{path:"/drive/v2/files/{fileId}/permissions",method:"POST",packedFn:["gapi","client","drive","permissions","insert"]},delete:{path:"/drive/v2/files/{fileId}/permissions/{permissionId}",method:"DELETE",packedFn:["gapi","client","drive","permissions","delete"]}},properties:{insert:{path:"/drive/v2/files/{fileId}/properties",method:"POST",packedFn:["gapi","client","drive","properties","insert"]},update:{path:"/drive/v2/files/{fileId}/properties/{propertyKey}",method:"PUT",packedFn:["gapi","client","drive","properties","update"]}},parents:{insert:{path:"/drive/v2/files/{fileId}/parents",method:"POST",packedFn:["gapi","client","drive","parents","insert"]},delete:{path:"/drive/v2/files/{fileId}/parents/{parentId}",method:"DELETE",packedFn:["gapi","client","drive","parents","delete"]}},changes:{list:{path:"/drive/v2/changes",method:"GET",packedFn:["gapi","client","drive","changes","list"]}},children:{list:{path:"/drive/v2/files/{folderId}/children",method:"GET",packedFn:["gapi","client","drive","children","list"]},delete:{path:"/drive/v2/files/{folderId}/children/{childId}",method:"DELETE",packedFn:["gapi","client","drive","children","delete"]}}},gmail:{users:{threads:{list:{path:"/gmail/v1/users/{userId}/threads",method:"GET",packedFn:["gapi","client","gmail","users","threads","list"]},get:{path:"/gmail/v1/users/{userId}/threads/{id}",method:"GET",packedFn:["gapi","client","gmail","users","threads","get"]},modify:{path:"/gmail/v1/users/{userId}/threads/{id}/modify",method:"POST",packedFn:["gapi","client","gmail","users","threads","modify"]},trash:{path:"/gmail/v1/users/{userId}/threads/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","threads","trash"]},untrash:{path:"/gmail/v1/users/{userId}/threads/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","threads","untrash"]}},labels:{list:{path:"/gmail/v1/users/{userId}/labels",method:"GET",packedFn:["gapi","client","gmail","users","labels","list"]},create:{path:"/gmail/v1/users/{userId}/labels",method:"POST",packedFn:["gapi","client","gmail","users","labels","create"]}},history:{list:{path:"/gmail/v1/users/{userId}/history",method:"GET",packedFn:["gapi","client","gmail","users","history","list"]}},messages:{get:{path:"/gmail/v1/users/{userId}/messages/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","get"]},send:{path:"/gmail/v1/users/{userId}/messages/send",method:"POST",packedFn:["gapi","client","gmail","users","messages","send"]},trash:{path:"/gmail/v1/users/{userId}/messages/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","messages","trash"]},untrash:{path:"/gmail/v1/users/{userId}/messages/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","messages","untrash"]},attachments:{get:{path:"/gmail/v1/users/{userId}/messages/{messageId}/attachments/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","attachments","get"]}}},drafts:{create:{path:"/gmail/v1/users/{userId}/drafts",method:"POST",packedFn:["gapi","client","gmail","users","drafts","create"]},update:{path:"/gmail/v1/users/{userId}/drafts/{id}",method:"PUT",packedFn:["gapi","client","gmail","users","drafts","update"]},send:{path:"/gmail/v1/users/{userId}/drafts/send",method:"POST",packedFn:["gapi","client","gmail","users","drafts","send"]},delete:{path:"/gmail/v1/users/{userId}/drafts/delete",method:"DELETE",packedFn:["gapi","client","gmail","users","drafts","delete"]},list:{path:"/gmail/v1/users/{userId}/drafts",method:"GET",packedFn:["gapi","client","gmail","users","drafts","list"]}},settings:{sendAs:{list:{path:"/gmail/v1/users/{userId}/settings/sendAs",method:"GET",packedFn:["gapi","client","gmail","users","settings","sendAs","list"]}}}}},calendar:{settings:{list:{path:"/calendar/v3/users/{userId}/settings",method:"GET",packedFn:["gapi","client","calendar","settings","list"]}},events:{get:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"GET",packedFn:["gapi","client","calendar","events","get"]},list:{path:"/calendar/v3/calendars/{calendarId}/events",method:"GET",packedFn:["gapi","client","calendar","events","list"]},patch:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"PATCH",packedFn:["gapi","client","calendar","events","patch"]},insert:{path:"/calendar/v3/calendars/{calendarId}/events",method:"POST",packedFn:["gapi","client","calendar","events","insert"]},delete:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"DELETE",packedFn:["gapi","client","calendar","events","delete"]}},calendars:{insert:{path:"/calendar/v3/calendars",method:"POST",packedFn:["gapi","client","calendar","calendars","insert"]}},calendarList:{list:{path:"/calendar/v3/users/{userId}/calendarList",method:"GET",packedFn:["gapi","client","calendar","calendarList","list"]}}}}}}},t.a=new s},function(e,t,a){"use strict";var i=a(2),r=a.n(i),n=a(0);t.a=function(e){var t={},a=e.size||20,i=e.size||20,s={fontSize:a,height:i,width:i,lineHeight:i+"px"};(e.top||e.left)&&(t.position="absolute",t.left=e.left||"50%",t.top=e.top||"50%",s.marginLeft=-a/2,s.marginTop=-a/2+20);var o=n.default.classNames("fancyLoader",{center:e.center},{inline:e.inline});return r.a.createElement("div",{className:o,style:t},r.a.createElement("div",{className:"icon-spinner",style:s}),e.children&&r.a.createElement("div",{className:"fancyLoaderText"},e.children))}},,function(e,t,a){"use strict";var i=a(0),r={_ensureListeners:function(){return this._listeners||(this._listeners={}),this._listeners},clearListeners:function(){this._listeners=void 0},listen:function(){for(var e=this._ensureListeners(),t=0;t<arguments.length-1;++t){try{i.default.PAssert(965,"callbacks"!==arguments[t],"Invalid event name/grouping")}catch(e){i.default.reportError(e)}try{i.default.PAssert(966,i.default.isString(arguments[t])||i.default.isFunction(arguments[t]),"Only accept string or functions for listen")}catch(e){i.default.reportError(e)}e[arguments[t]]||(e[arguments[t]]={callbacks:[]}),e=e[arguments[t]]}var a=arguments[arguments.length-1];try{i.default.PAssert(967,i.default.isFunction(a),"Listeners must always be valid functions")}catch(e){i.default.reportError(e)}try{i.default.PAssert(968,e.callbacks.indexOf(a)<0,"Should never listen with the same function twice")}catch(e){i.default.reportError(e)}e.callbacks.push(a)},isListening:function(){var e=this._ensureListeners(),t=arguments[arguments.length-1];try{i.default.PAssert(969,i.default.isFunction(t),"Listeners must always be valid functions")}catch(e){i.default.reportError(e)}for(var a=0;a<arguments.length-1;++a)e[arguments[a]]&&(e=e[arguments[a]]);return e&&e.callbacks&&e.callbacks.indexOf(t)>=0},unlisten:function(){var e=this._ensureListeners(),t=arguments[arguments.length-1];try{i.default.PAssert(970,i.default.isFunction(t),"Listeners must always be valid functions")}catch(e){i.default.reportError(e)}for(var a=0;a<arguments.length-1;++a){try{i.default.PAssert(971,"callbacks"!==arguments[a],"Invalid event name/grouping")}catch(e){i.default.reportError(e)}try{i.default.PAssert(972,i.default.isString(arguments[a]),"Only accept string for unlisten")}catch(e){i.default.reportError(e)}try{i.default.PAssert(973,e[arguments[a]],"Cannot unlisten something that has never been listened")}catch(e){i.default.reportError(e)}e[arguments[a]]&&(e=e[arguments[a]])}try{i.default.PAssert(974,e&&e.callbacks&&e.callbacks.indexOf(t)>=0,"Cannot unlisten something that has never been listened")}catch(e){i.default.reportError(e)}e.callbacks&&e.callbacks.remove(t)},fireEvent:function(){var e=!0,t=this._ensureListeners(),a=arguments[arguments.length-1];try{i.default.PAssert(975,void 0===a||i.default.isArray(a),"Last argument to fireEvent must be an array")}catch(e){i.default.reportError(e)}for(var r=0;r<arguments.length-1;++r){try{i.default.PAssert(976,"callbacks"!==arguments[r],"Invalid event name/grouping")}catch(e){i.default.reportError(e)}try{i.default.PAssert(977,i.default.isString(arguments[r])||i.default.isArray(arguments[r]),"Only accept strings for firing event")}catch(e){i.default.reportError(e)}if(!t[arguments[r]])break;t=t[arguments[r]];for(var n=0;n<t.callbacks.length;++n)try{e=t.callbacks[n].apply(this,a)&&e}catch(e){i.default.reportError(e)}}return e}};t.a=r},function(e,t,a){"use strict";var i=a(0),r=a(7),n=a(1),s=a(112),o=a(4),l=a(13),d=", . ? ! ) ( : ; [ ] ' \"".split(" "),c=-1===navigator.userAgent.indexOf("Mac")?"ctrl":"⌘",u=0;var h=["http","https","evernote","onenote","bear"];window.__PARSE_STATS={total:0,parseText:0,parseNote:0,parseSinglePlugin:0};var f,p,m,g=new Date(9e12).getTime(),v=new Date(1401606e6),y=/^(next|today|tomorrow|yesterday|(?:sun|mon|tue(?:s)?|wed(?:nes)?|thu(?:rs)?|fri|sat(?:ur)?)(?:day)?)/i,S=/^(?:(?:([0]?[1-9]|1[0-2])(?::([0-5]\d))?(?:\s)?(am?|pm?|\b))|(?:([0]?\d|1\d|2[0-3]):([0-5]\d)))$/i,E=/(^#|[\(\s-]#)([^\s\),#]+)/g,P=/(?:^(?:[\*_]*?)@|[\(\s](?:[\*_]*?)@)([^\s\)\*_]{2,})(\s[^\s\)@\u2001\u2003\*_]{1,})?(\s[^\s\)@\u2001\u2003\*_]{1,})?/g,b=/\b((?:(https?|evernote|onenote|bear):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\))+)*\))(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/g,C=/(?:^|[\s\(\[])([^\(\[#@\s]+\.(?:com|org|net|io))/gi,D=/(?:(?:\u2001|\u2003)(p:[^\u2001\u2003]+)(?:\u2001|\u2003))/gi,I=/^(\#+|\-|\*|\[\]|\[(?: \])?|\[\]|\]|\+|[0-9]+\.) /gi,A=/(\#+|\-|\*|\[\]|\[(?: \])?|\[\]|\]|\+|[0-9]+\.) /gi,M=/\[([^\[]+)\]\((\S+(?=\)))\)/g,_=/^(-{3,})$/g,T=/^([\*_]*)([^\*_]+)([\*_]*)/g,w=/\b([^<>\s]+@[^<>\s]+\.[^<>\s]+)\b/gi,k=/(\*\*\*|___)(.*?)\1/g,x=/(\*\*|__)(.*?)\1/g,L=/(\*|_)(\u2005*?)([^\u2005|\*|_]+?)\2\1/gi,O={repeat:/^(ev(ery)?|after)\b/i,recur:/^(other|first|second|third|fourth|1st|2nd|3rd|4th|last)$/i,day:/^(((sun|mon|tue(s)?|wed(nes)?|thu(rs)?|fri|sat(ur)?)(day)?)(?:,|\sand\s)?)$/i,daysOfWeek:/^(weekday|weekend)$/i,len:/^(day|week|month|year|morning|afternoon|night)$/i,count:/^((\d{1,2})|one|two|three|four|five|six|seven|eight|nine|ten)$/i,month:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)$/i,at:/^at$/i,of:/^of$/i,in:/^in$/i,delim:/^and$/i,date:/^((\d{1,2})|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?)(?:,|\sand\s)?)$/i,year:/^((\d\d)|(\d\d\d\d))$/i,time:S,from:/^(from|starting)$/i,until:/^(until)$/i,measure:/^(days|weeks|months|years)$/i},R={"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,fou:4,sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,days:RepeatFreq.Daily,weeks:RepeatFreq.Weekly,months:RepeatFreq.Monthly,years:RepeatFreq.Yearly},N={h:1,hr:1,hrs:1,hour:1,hours:1,Hours:1,m:2,min:2,mins:2,Minutes:2,d:3,day:3,days:3,Days:3,"-":1,until:1,to:1,till:1,EndDate:1,for:2,Duration:2},F={duration:/^(-\s|(?:for|until|to|till)\b)/i,len:/^(\d{1,3}(?:\.\d{1,2})?)(h(?:(?:ou)?r(?:s)?)?|m(?:in(?:s)?)?|d(?:ay(?:s)?)?)$/i},U=0,B=0,V=1;function H(){}H.prototype={isFlagSet:function(e,t){return(e&t)===t},trimPunc:function(e){return e.replace(/[:,\.\'\"\)\]\*_]*$/g,"")},generateStyledLines:function(e,t,a){for(var i=this.linesToEls(e,t),r=[],n=0;n<i.length;++n)r.push(this.generateHTML(i[n],!1,a));return r},linesToEls:function(e,t){for(var a,i=[],r=[],n=0;n<t.length;++n){for(var o=0,l=t[n].start,d=t[n].length,c=0,u=0;u<e.length;++u){var h=e[u],f=h.getParsedText().length,p=Math.max(l-o,0);if(p<f){var m=Math.min(f-p,d-c);if(m>0){var g=h.getParsedText().substr(p,m);r.push(new s.a(g,h.getAttrs(),h.getAttr("appLink")&&a!==u&&(0===u||!e[u-1].getAttr("appLink")))),c+=m,a=u}}o+=f}i.push(r),r=[]}return i},replaceTextInEls:function(e,t,a,r){try{i.default.PAssert(1503,i.default.isArray(e),"Must supply a valid VMLIElement array")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1504,t,"Must be replacing at least one of parsed or styled text")}catch(e){i.default.reportError(e)}for(var n=0,s=0;s<e.length;++s){var o=e[s],l=o.getParsedText();if(a+r>=n&&a<n+o.getOrigTextLength()){var d=a-n,c=Math.min(r,l.length-d),u=l.substr(0,d),h=l.substr(d+c);t&&o.setParsedText(u+t+h);break}n+=o.getOrigTextLength()}},getElAtOffset:function(e,t){for(var a=0,i=0;i<e.length;++i){var r=e[i],n=r.getOrigTextLength();if(t>=a&&t<a+n)return r;a+=n}},insertEl:function(e,t,a,r){try{i.default.PAssert(1505,i.default.isArray(t.cls),"Must always pass in a valid classes array")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1506,i.default.isNumber(a),"Must have a valid start")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1507,i.default.isNumber(r),"Must have a valid length")}catch(e){i.default.reportError(e)}for(var n,o=0,l=r,d=0;d<e.length;++d){var c=e[d],u=c.getParsedText();if(o<a+r&&a<o+c.getOrigTextLength()){var h=0,f=Math.max(a-o,0),p=Math.min(l,u.length),m=f+l,g=u.length-m;if(f>0){var v=u.substr(0,f);e.splice(d,0,new s.a(v,c.getAttrs())),h++}var y=u.substr(f,p);if((n=new s.a(y,c.getAttrs())).mergeAttrs(t),e.splice(d+h,1,n),h++,g>0){var S=u.substr(m,g);e.splice(d+h,0,new s.a(S,c.getAttrs()))}if(d+=h-1,l-=p,g>0)break}o+=c.getOrigTextLength()}return n},generateHTML:function(e,t,a,r,n){var s,l,d=[],u=!1;try{i.default.PAssert(1508,e,"C Item has no els: ")}catch(e){i.default.reportError(e)}e||(e=[]);for(var h=0;h<e.length;++h){var f=e[h],p=f.getAttrs(),m="",g="",v=f.getStyledText(a);if(t&&(v=v&&v.replace(/ /g,"&nbsp;")),!r||!f.hasClass("itemPrefix"))if(p){var y="",S="",E=f.getClassString(),P=p.tooltip;if(f.getAttr("appLink")&&(u||(y+='<span class="appLink '+(l=(f.hasClass("evernote")?"Evernote":"")||(f.hasClass("onenote")?"OneNote":"")||(f.hasClass("bear")?"Bear":""))+'">'),f.isFirstInstanceInItem&&(y+='<span contenteditable="false" class="appLinkStart"></span>'),u=!0),f.hasClass("link"))if(f.hasClass("linkImage"))P="<b>Click</b> to open image.<br><b>"+c+" + Click</b> to open in "+(o.a.app?"browser":"new tab")+".";else if(u)P="<b>Click</b> to open in "+l;else{var b=f.getAttr("data-href");P=(b!==v?b+"<br>":"")+"<b>"+c+" + Click</b> to open"}else f.hasClass("tag")?P="<b>Click</b> to show only "+v+"<br><b>"+c+" + Click</b> to hide "+v:f.hasClass("email")?P="<b>"+c+"+ Click</b> to email "+v:f.hasClass("plugin")&&(v="<span"+(a&&a.isEditable?' tooltip="<b>'+c+' + Click</b> to open"':"")+">"+v+"</span>");for(var C in P&&a&&(S+='tooltip="'+P+'"'),y+="<span ",S+=">"+v+"</span>",f.hasClass("plugin")&&(y+='contenteditable="false" '),p)p.hasOwnProperty(C)&&("cls"===C?(g='class="'+E+'" ',"itemPrefix"===p[C][0]&&(s=!0)):"appLink"===C||"tooltip"===C&&!a||(m+=C+'="'+p[C]+'" '));!u||h!==e.length-1&&e[h+1].getAttr("appLink")||(S+="</span>",u=!1),d.push(y+(g||"")+(m?" "+m:"")+S)}else d.push(v)}return s&&1===e.length&&d.push("<span>"+TextSpace+"</span>"),n&&d.push(n),d.join("")},getNowRelativeDate:function(e){var t;switch(e.toUpperCase()){case"NOW":t=Date.today().add({hours:11});break;case"NEXT":t=Date.today().add({hours:12});break;case"SOON":t=Date.today().add({days:2});break;case"LATER":t=Date.today().add({days:5});break;case"SOMEDAY":t=Date.today().add({days:14});break;default:try{i.default.PAssert(1509,!1,"Must supply a valid now relative date string")}catch(e){i.default.reportError(e)}}return t},_notifyParse:function(e){__PARSE_STATS.total++,__PARSE_STATS[e]++},runParseSinglePlugin:function(e,t){return this.parseSinglePlugin(e.getRawText(),t)},parseSinglePlugin:function(e,t){if(this._notifyParse("parseSinglePlugin"),!e||0===e.length)return{parsedText:void 0,els:void 0};try{i.default.PAssert(1510,!u,"We do not support recursive calls to parse")}catch(e){i.default.reportError(e)}var a,r;if(u++," "===e[0]||" "===e[0]){var n=!i.default.isFlagSet(t,ChangeType.ItemLoad),o=i.default.vmMain.pluginManager.parseAttachmentEmbedString(e.slice(1,-1),n);r=[o],e=window.AttachChar,n&&(a=[new s.a(window.AttachChar,o.displayElement.attrs)])}else a=[new s.a(e)];return u--,{parsedText:e,attachments:r,els:a}},parseNote:function(e){return this._notifyParse("parseNote"),{parsedText:e.getRawText(),els:[new s.a(e.getRawText())]}},runParseText:function(e,t){var a;return(a=this.isFlagSet(t,ChangeType.Local)?l.a.getCurrentDateFormat():e.getDateFormat())||(a=n.a.DateFormat.MDY),this.parseText(e.getRawText(),e.getDateTime(),e.getRepeatDateString(),e.getDateText(),a,e.getDateCompletedTime(),t,r.a.contactManager.getContacts())},parseText:function(e,t,a,r,c,f,p,m,g,v){if(this._notifyParse("parseText"),!e||0===e.length)return{parsedText:void 0,els:[]};try{i.default.PAssert(1511,!u,"We do not support recursive calls to parse")}catch(e){i.default.reportError(e)}u++;var y,S,A,O,R,N,F,U,B,V,H,q,G=!1,z=e,W=e,j=0,K=!1,Y=[new s.a(z)];v||(I.lastIndex=0,null!==(y=I.exec(z))&&(F=y[1])&&(j=y[0].length,0===F.indexOf("#")?(H="prefixHeader",U="header",q="<b>Click</b> to zoom in"):"["===F||"[]"===F||"[ ]"===F||"]"===F?(H="prefixTask icon-square-o",U="task",q="<b>Click</b> to toggle complete.<br><b>"+o.a.priModKey+" + Click</b> to zoom in."):"*"===F||"-"===F||"+"===F?(H="prefixBullet",U="bullet",q="<b>Click</b> to zoom in"):(H="prefixNumList",U="numList",q="<b>"+o.a.priModKey+" + Click</b> to zoom in."),this.insertEl(Y,{cls:["itemPrefix",H],tooltip:q},0,j).setWidth(n.a.PrefixWidth),W=z.substr(j)));for(D.lastIndex=0;null!==(y=D.exec(z));){var X=i.default.vmMain.pluginManager.parseAttachmentEmbedString(y[1],!0),Q=this.insertEl(Y,X.displayElement.attrs,y.index,y[0].length);this.replaceTextInEls(Y,window.AttachChar,y.index,y[0].length);var J=Y.indexOf(Q);J>0&&Q.addClass("padB"),J<Y.length-1&&Q.addClass("padA"),G=!0,R?R.push(X):R=[X]}for(M.lastIndex=0;null!==(y=M.exec(W));){var Z=y[2].indexOf("://")>0?y[2]:"http://"+y[2],$=!!i.default.parseEvernoteLink(y[2]),ee=i.default.isOneNoteLink(y[2]),te=i.default.isBearLink(y[2]),ae=$||ee||te,ie=["mdMarkup"];$?ie.push("evernote"):ee?ie.push("onenote"):te&&ie.push("bear"),this.insertEl(Y,{cls:ie,appLink:ae},j+y.index,1),this.insertEl(Y,{cls:["mdSpan","link","c-link"].concat(i.default.isUrlImage(Z)?"linkImage":[]),appLink:ae,"data-href":Z},j+y.index+1,y[1].length),this.insertEl(Y,{cls:["mdMarkup"],appLink:ae},j+y.index+1+y[1].length,2),this.insertEl(Y,{cls:["mdSpan","link","c-link","mdMarkup"].concat(i.default.isUrlImage(Z)?"linkImage":[]),appLink:ae,"data-href":Z},j+y.index+y[1].length+3,y[2].length),this.insertEl(Y,{cls:["mdMarkup"],appLink:ae},j+y.index+y[1].length+y[2].length+3,1),K=!0}if(!K)if(b.lastIndex=0,null!==(y=b.exec(z))){Z=h.indexOf(y[2])>=0?y[0]:"http://"+y[0],$=i.default.parseEvernoteLink(Z),ee=i.default.isOneNoteLink(Z),te=i.default.isBearLink(Z);var re={cls:["link","c-link"].concat(i.default.isUrlImage(Z)?"linkImage":[]),"data-href":Z};$&&(re.appLink=!0,re.cls.push("evernote")),ee&&(re.appLink=!0,re.cls.push("onenote")),te&&(re.appLink=!0,re.cls.push("bear")),this.insertEl(Y,re,y.index,y[0].length)}else if(C.lastIndex=0,null!==(y=C.exec(z))){j=y[0].length-y[1].length,Z=y[1].startsWith("http")?y[1]:"http://"+y[1],$=i.default.parseEvernoteLink(Z),ee=i.default.isOneNoteLink(Z),te=i.default.isBearLink(Z),re={cls:["link","c-link"].concat(i.default.isUrlImage(Z)?"linkImage":[]),"data-href":Z};$&&(re.appLink=!0,re.cls.push("evernote")),ee&&(re.appLink=!0,re.cls.push("onenote")),te&&(re.appLink=!0,re.cls.push("bear")),this.insertEl(Y,re,y.index+j,y[1].length)}for(k.lastIndex=0;null!==(y=k.exec(W));)this.isInTag(y)||this.getElAtOffset(Y,y.index).hasClass("link")||(this.insertEl(Y,{cls:["mdMarkup"]},j+y.index,y[1].length),this.insertEl(Y,{cls:["mdSpan","mdBold","mdItalic"]},j+y.index+y[1].length,y[2].length),this.insertEl(Y,{cls:["mdMarkup"]},j+y.index+y[1].length+y[2].length,y[1].length));var ne=W.replace(k,"   $2   ");for(x.lastIndex=0;null!==(y=x.exec(ne));)this.isInTag(y)||this.getElAtOffset(Y,y.index).hasClass("link")||(this.insertEl(Y,{cls:["mdMarkup"]},j+y.index,y[1].length),this.insertEl(Y,{cls:["mdSpan","mdBold"]},j+y.index+y[1].length,y[2].length),this.insertEl(Y,{cls:["mdMarkup"]},j+y.index+y[1].length+y[2].length,y[1].length));for(ne=ne.replace(x,"  $2  "),L.lastIndex=0;null!==(y=L.exec(ne));)this.isInTag(y)||this.getElAtOffset(Y,y.index).hasClass("link")||(this.insertEl(Y,{cls:["mdMarkup"]},j+y.index,y[1].length),this.insertEl(Y,{cls:["mdSpan","mdItalic"]},j+y.index+y[1].length+y[2].length,y[3].length),this.insertEl(Y,{cls:["mdMarkup"]},j+y.index+y[1].length+y[2].length+y[3].length+y[2].length,y[1].length));for(_.lastIndex=0,null!==(y=_.exec(W))&&this.insertEl(Y,{cls:["mdSpan","mdHR","c-border-heavy"]},0,z.length),w.lastIndex=0;null!==(y=w.exec(z));)this.getElAtOffset(Y,y.index).hasClass("link")||this.insertEl(Y,{cls:["email","c-contact"]},y.index,y[1].length);if(m&&m.___info___.count>0&&z.indexOf(n.a.ContactPrefix)>=0){var se,oe=z.split(/\s/),le=0;for(B=0;B<oe.length;B++){var de=oe[B].replace(T,"$2"),ce=oe[B].indexOf(de);if(0===de.indexOf(n.a.ContactPrefix)){se=void 0;var ue=de.substring(1);for(V=1;;V++){if(""===m[ue])se=ue;else{var he=this.trimPunc(ue);""===m[he]&&(se=he)}if(!(B+V<oe.length))break;ue+=" "+oe[B+V]}se&&(O?O.push(se):O=[se],this.insertEl(Y,{cls:["contact","c-contact"]},le+ce,se.length+1))}le+=oe[B].length+1}}for(E.lastIndex=0;null!==(y=E.exec(z));){for(var fe=y.index+y[1].length-1,pe=y[2].length+1,me=y[2];d.indexOf(me.charAt(me.length-1))>=0;)pe--,me=me.substr(0,me.length-1);S?S.push(me):S=[me],this.insertEl(Y,{cls:["tag","c-tag"]},fe,pe)}for(P.lastIndex=0;null!==(y=P.exec(z));){j=y[0].indexOf(n.a.DatePrefix);var ge=!1;for(B=1;B<y.length&&y[B];++B)if(ge)y[B]=void 0;else{var ve=y[B][y[B].length-1];d.indexOf(ve)>=0&&(y[B]=y[B].slice(0,-1),ge=!0)}var ye,Se=!g&&this.parseRepeatDate(a,r,c,f,p,z.substr(y.index+j+1));if(Se||y[1].startsWith("every")||"in"===y[1]){if(Se){ye=y.index+j,Se.replacedDate?(this.insertEl(Y,{cls:["date","c-date"]},ye,Se.repLength+1),this.replaceTextInEls(Y,Se.text,ye+1,Se.repLength),z=z.substr(0,ye+1)+Se.text+z.substr(ye+Se.repLength+1),G=!0):this.insertEl(Y,{cls:["date","c-date"]},ye,Se.repLength+1),A?A.push(Se):A=[Se];var Ee=new Date(Se.startDate);if(Ee.hasTimeOfDay()){Me=ye+Se.text.length+1,_e=z.substr(Me);if(Ae=this.parseDuration(Ee,_e,c)){var Pe=ye+Se.oldText.length+1;this.insertEl(Y,{cls:["duration","c-date"]},Pe,Ae.durationText.length+1),N?N.push(Ae):N=[Ae]}}break}}else{var be=[y[1]?y[1]:"",y[2]?y[2]:"",y[3]?y[3]:""];if(i.default.isDateSoft(be[0])){var Ce=!0;"NEXT"===be[0].toUpperCase()&&this.runDateParse(be,c)&&(Ce=!1),Ce&&(t=this.getNowRelativeDate(be[0]),be[1]="",be[2]="")}var De=this.computeDateInfo(t,r,c,l.a.getCurrentDateFormat(),p,be);if(De.isValid){var Ie;ye=y.index+j,De.replacedDate?(this.insertEl(Y,{cls:["date","c-date"]},ye,De.oldText.length+1),this.replaceTextInEls(Y,De.text,ye+1,De.oldText.length),z=z.substr(0,ye+1)+De.text+z.substr(ye+De.oldText.length+1),G=!0,Ie={type:DateType.Once,date:De.date,dateFormat:De.format,origText:De.oldText,text:De.text,explicitTime:De.date.hasTimeOfDay()}):(this.insertEl(Y,{cls:["date","c-date"]},ye,De.text.length+1),Ie={type:DateType.Once,date:De.date,dateFormat:De.format,origText:De.oldText,text:De.text,explicitTime:De.date.hasTimeOfDay()}),A?A.push(Ie):A=[Ie];var Ae,Me=ye+De.text.length+1,_e=z.substr(Me);(Ae=this.parseDuration(De.date,_e,c))&&(this.insertEl(Y,{cls:["duration","c-date"]},Me,Ae.durationText.length+1),Ie.explicitTime||Ae.duration%i.default.days(1)==0||(Ie.explicitTime=!0),N?N.push(Ae):N=[Ae]);break}}}return R&&(D.lastIndex=0,z=z.replace(D,window.AttachChar)),u--,{parsedText:G?z:void 0,dates:A,durations:N,tags:S,attachments:R,contacts:O,prefix:F,prefixType:U,els:Y}},getDurationLength:function(e){var t=F.len.exec(e),a=parseFloat(t[1]),r=0;switch(N[t[2].toLowerCase()]){case N.Hours:r=i.default.hours(a);break;case N.Minutes:r=i.default.minutes(a);break;case N.Days:r=i.default.days(a);break;default:try{i.default.PAssert(1512,!1,"Invalid duration length: "+t[2])}catch(e){i.default.reportError(e)}}return r},parseDuration:function(e,t,a){this.setDateTokens(t);var i,r=0;if(this.checkAndParse(F.duration)){if(N[f.toLowerCase()]===N.EndDate)if(this.checkAndParse(S,2)){var n=this.getTimeFromString(f),s=e.clone();s.setHours(n.hour),s.setMinutes(n.min),r=s-e}else this.checkAndParseDate(a)&&(r=m-e);else if(N[f.toLowerCase()]===N.Duration){for(;this.checkAndParse(F.len);)r+=this.getDurationLength(f);r--}}else{for(;this.checkAndParse(F.len);)r+=this.getDurationLength(f);r--}return r>0&&(i={durationText:t.substr(1,U).trim(),duration:r}),i},getSoftText:function(e,t){return t<0?t>=-864e5?"yesterday":e.toString(l.a.getFormat(DFormat.MonthDayYear)):t<=864e5&&e.isToday()?"today":t<1728e5?"tomorrow":void 0},runDateParse:function(e,t){var a=e.join(""),i=l.a.parseDate(a,t);return!i&&e[1]&&(a=e[0]+e[1],i=l.a.parseDate(a,t)),!i&&e[0]&&(a=e[0],i=l.a.parseDate(a,t)),{dt:i,dateString:a}},computeDateInfo:function(e,t,a,r,n,s){var o,d,c,u,h=new Date(e).clearTime(),f=(new Date).clearTime(),p=h-f,m=t||s.join(""),g=m,v=!1;if(this.isFlagSet(n,ChangeType.Auto)||this.isFlagSet(n,ChangeType.Remote)&&this.isFlagSet(n,ChangeType.DocLoad)){if(o=new Date(e),void 0!==e&&(p<0||p>=0&&p<1728e5)){if(y.lastIndex=0,null!==(c=y.exec(m))){if("NEXT"!==m.toUpperCase()&&(d=this.getSoftText(o,p))&&!m.toUpperCase().startsWith(d.toUpperCase())){if(void 0===t)m=(P=this.runDateParse(s,a)).dateString;g=m.replace(c[0],d),v=!0}}else if(null!==(c=S.exec(m))){if((d=this.getSoftText(o,p))&&"today"!==d){if(void 0===t)m=(P=this.runDateParse(s,a)).dateString;g=d+" "+m,v=!0}}else if(void 0===e||void 0===t){(P=this.runDateParse(s,a)).dateString!==t&&(o=P.dt,m=P.dateString,g=P.dateString)}}else if(void 0===e||void 0===t){var E=this.isFlagSet(n,ChangeType.Rollover);if(i.default.isDemoMode()||!this.isFlagSet(n,ChangeType.Auto)||E)o=(P=this.runDateParse(s,a)).dt,g=P.dateString,E||(m=P.dateString);else void 0===e&&(o=void 0)}}else if(this.isFlagSet(n,ChangeType.Local)||this.isFlagSet(n,ChangeType.Remote)){if(this.isFlagSet(n,ChangeType.PluginLoad))o=e?new Date(e):void 0;else o=(P=this.runDateParse(s,a)).dt,m=P.dateString,g=P.dateString}else{var P;o=(P=this.runDateParse(s,a)).dt,m=P.dateString,g=P.dateString}try{i.default.PAssert(1513,!o||!isNaN(o.getTime()),"Must be a valid parsed date")}catch(e){i.default.reportError(e)}return a!==r?(u=l.a.convertDateFormat(g,a,r),v=!0):u=g,{isValid:!!o,oldText:m,text:u,date:o,format:a,replacedDate:v}},getRepeatStartDate:function(e){if(e&&"string"==typeof e){var t=e.split("|");if(t.length>3&&"1"===t[0])return new Date(parseInt(t[1]))}},setDateTokens:function(e){f=void 0,p=e.split(" "),V=1,U=p[0].length,B=0,m=void 0},checkAndParse:function(e,t){var a=!1;if(void 0===(t=void 0!==t&&t>1?Math.min(p.length-V,t):t)||1===t)V<p.length&&(a=p[V].match(e))&&(f=p[V],V++,U+=f.length+1);else if(t>1&&V+t<=p.length)for(var i=t;i>0;i--){for(var r="",n=0;n<i;++n)r+=p[V+n],n+1!==i&&(r+=" ");if(a=r.match(e)){f=r,V+=i,U+=r.length+1;break}}return a},checkAndParseDate:function(e){var t=!1;if(V+1<p.length&&!p[V+1].match(O.at)){var a=l.a.parseDate(p[V]+" "+p[V+1],e);a&&(t=!0,f=p[V]+p[V+1],m=a,V+=2,U+=f.length+2)}if(!t&&V<p.length){var i=l.a.parseDate(p[V],e);i&&(t=!0,f=p[V],m=i,V++,U+=f.length+1)}return t},computeStartDate:function(e,t,a,i,r,n){var s=n||new Date,o=(n?new Date(n):new Date).clearTime();(void 0!==i&&o.setMonth(i),void 0!==a)&&(a>0&&a<=31&&((Date.getDaysInMonth(o.getFullYear(),o.getMonth())<a||a<o.getDate())&&void 0===i&&o.addMonths(1),o.setDate(a)));return void 0!==t?(o.moveToNthOccurrence(e,t),o.isBefore(s)&&(o.addMonths(1),o.moveToNthOccurrence(e,t))):void 0!==e&&o.getDay()!==e&&(o.moveToDayOfWeek(e,-1),o.isBefore(s)&&o.moveToDayOfWeek(e)),void 0!==i&&o.isBefore(s)&&(o.addYears(1),o.setMonth(i)),r&&this.updateDateWithTime(o,r),o},updateDateWithTime:function(e,t){var a=this.getTimeFromString(t);e.setHours(a.hour),e.setMinutes(a.min),e.setMilliseconds(1)},getTimeFromString:function(e){var t,a,r,n,s,o=S.exec(e);void 0!==o[1]?(a=(t=o[3].toUpperCase())===Date.CultureInfo.pmDesignator[0]||t===Date.CultureInfo.pmDesignator,r=i.default.parseInt(o[1])+(a?12:0),n=o[2]?i.default.parseInt(o[2]):0,s=o[1]):void 0!==o[4]&&void 0!==o[5]&&(r=i.default.parseInt(o[4]),n=i.default.parseInt(o[5]),s=o[4]);var l=!1;if(s){var d=i.default.parseInt(s);(s.startsWith("0")||0===d||d>12)&&(l=!0)}return t||l?t&&!l&&(a||12!==r?a&&24===r&&(r=12):r=0):r<8&&(r+=12),{hour:r,min:n}},parseRepeatDate:function(e,t,a,r,n,s){var o,d,c,u,h,p,y,S,E=!1,P=Date.today(),b=RepeatFreq.Daily,C=1;if(s.match(O.repeat)){this.setDateTokens(s);var D=!1;if(this.checkAndParse(O.recur)){switch(f){case"other":C=2;break;case"last":b=RepeatFreq.NthMonthInst,p=-1;break;default:b=RepeatFreq.NthMonthInst,p=R[f.substr(0,3).toLowerCase()]}D=!0}if(D&&"other"!==f||!this.checkAndParse(O.date))if(!D&&this.checkAndParse(O.count)){var I=i.default.parseInt(f);isNaN(I)&&(I=R[f]),this.checkAndParse(O.measure)&&(b=R[f.toLowerCase()],C=I,E=!0)}else if(this.checkAndParse(O.day)){var A;for(b!==RepeatFreq.NthMonthInst&&(b=RepeatFreq.Weekly),h=R[f.substr(0,3).toLowerCase()];(f.endsWith(",")||this.checkAndParse(O.delim))&&this.checkAndParse(O.day);){var M=R[f.substr(0,3).toLowerCase()];A?A.push(M):A=[h,M]}A&&(A.sort(),c=A),E=!0}else if(this.checkAndParse(O.daysOfWeek))b=RepeatFreq.Weekly,"weekday"===f?c=[1,2,3,4,5]:"weekend"===f&&(c=[0,6]),E=!0;else if(this.checkAndParse(O.month)){var _=f;if(this.checkAndParse(O.date)){var T=parseInt(f);T>0&&T<=31&&(y=T,S=R[_.substr(0,3).toLowerCase()],b=RepeatFreq.Yearly,E=!0)}}else if(D&&"other"!==f||!this.checkAndParse(O.len))if(D&&"last"!==f||!this.checkAndParse(O.len))D&&"other"!==f&&(b=RepeatFreq.DayOfMonth,y=p,p=void 0,E=!0);else switch(f){case"day":E=!0,b=RepeatFreq.EndOfMonthOffset}else{switch(f){case"day":b=RepeatFreq.Daily;break;case"week":b=RepeatFreq.Weekly;break;case"month":b=RepeatFreq.Monthly;break;case"year":b=RepeatFreq.Yearly;break;case"morning":b=RepeatFreq.Daily,u="9:00am";break;case"afternoon":b=RepeatFreq.Daily,u="2:00pm";break;case"night":b=RepeatFreq.Daily,u="7:00pm"}E=!0}else{var w,k=i.default.parseInt(this.trimPunc(f));for(0;(f.endsWith(",")||this.checkAndParse(O.delim))&&this.checkAndParse(O.date);){var x=i.default.parseInt(this.trimPunc(f));x>0&&x<=31&&(w?w.push(x):w=[k,x])}w&&w.length>1?(w.sort(i.default.numberComparator),b=RepeatFreq.DayOfMonth,y=w[0],c=w,E=!0):k>0&&k<=31&&(isNaN(k)||(b=RepeatFreq.DayOfMonth,y=k,E=!0),this.checkAndParse(O.measure)?(b=R[f.toLowerCase()],C=k,y=void 0,E=!0):(this.checkAndParse(O.of),this.checkAndParse(O.month)&&(y=k,S=R[f.substr(0,3).toLowerCase()],b=RepeatFreq.Yearly,E=!0)))}var L=!1;this.checkAndParse(O.at)&&(L=!0),this.checkAndParse(O.time,2)&&(u=f,E=!0);var N,F,V,H=!1,q=!1;if(this.checkAndParse(O.in))q=!0,this.checkAndParse(O.month)&&(N=R[f.substr(0,3).toLowerCase()]),this.checkAndParse(O.year)&&(F=parseInt(f)),void 0===N&&void 0===F||(d=new Date,V=new Date,H=!0,F&&(d.setYear(F),d.setMonth(11),V.setYear(F),V.setMonth(0)),void 0!==N&&(void 0!==F&&(d.getMonth()>N&&d.addYears(1),V.getMonth()>N&&V.addYears(1)),d.setMonth(N),V.setMonth(N)),d.moveToLastDayOfMonth(),V.setDate(1));var G=U+1,z=U;this.checkAndParse(O.from)?(G=U+1,this.checkAndParseDate(a)&&(H&&!m.isAfter(V)||(V=m),H=!1,B=U)):B=U;var W=!1;L||u||(this.checkAndParse(O.at)&&(L=!0,W=!0),this.checkAndParse(O.time,2)&&(u=f,W=!0)),q||this.checkAndParse(O.until)&&this.checkAndParseDate(a)&&(d=m,W=!0),d&&d.isBefore(V)&&(E=!1)}else"everyday"===s&&(this.setDateTokens(s),E=!0,b=RepeatFreq.Daily,C=1);if(E){var j=this.getRepeatStartDate(e),K=this.isFlagSet(n,ChangeType.Remote)?j:V;if(c&&b===RepeatFreq.Weekly)for(var Y=(K||new Date).getDay(),X=0;X<c.length;++X)if(c[X]>=Y){h=c[X];break}var Q=!!(P=this.computeStartDate(h,p,y,S,u,K));if(P&&(P.isBefore(v)&&(Q=!1),d&&d.isBefore(P)&&(Q=!1)),Q){var J,Z,$=!1,ee=s.substr(0,U);if(!r&&V&&e&&!H){Z=s.substr(G,B);var te=this.computeDateInfo(j,void 0,a,a,n,[Z]);te.replacedDate&&(Z=te.text)}else r&&r!==g&&(this.isFlagSet(n,ChangeType.Text)||(Z=l.a.formatDate(new Date(r),DFormat.MonthDayYear,a)));if(Z){var ae=s.substr(G,B);if(ae.toUpperCase()!==Z.toUpperCase()){0;var ie=l.a.parseDate(Z,a);ie&&(u&&this.updateDateWithTime(ie,u),ee=ee.substr(0,z)+" from "+Z+(W?ee.substr(B):""),J=ie.getTime(),$=!0)}}var re,ne=s.substr(0,U),se=l.a.getCurrentDateFormat();a!==se?(re=l.a.convertDateFormat(ee,a,se),$=!0):re=ee,o={type:DateType.Repeat,repLength:U,oldText:ne,text:re,dateFormat:a,startDate:J||P,endDate:d,frequency:b,separation:C,offsets:c,replacedDate:$}}}return o},isInTag:function(e){for(var t=e.index;t>=0;t--){if(" "===e.input[t])return!1;if("#"===e.input[t])return!0}return!1},checkMultiplePrefixes:function(e,t){var a;for(A.lastIndex=0;null!==(match=A.exec(e));)if(a)match.index===a.length&&(e=e.substr(match.index));else{if(0!==match.index)break;a=match}return e}},t.a=new H},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(7),o=a(10),l=a(8),d=a(75),c=a(27),u=a(29);function h(){}var f={None:0,Left:1,Right:2,StartLine:3,EndLine:4,LeftWord:5,RightWord:6,Down:7,Up:8,PageDown:9,PageUp:10,Top:11,Bottom:12,PrevHeader:13,NextHeader:14,All:15},p=[KeyCode.Tab,KeyCode.BackSpace,KeyCode.Delete],m=[KeyCode.UpArrow,KeyCode.DownArrow,KeyCode.LeftArrow,KeyCode.RightArrow,KeyCode.Home,KeyCode.End,KeyCode.A,KeyCode.E,KeyCode.F,KeyCode.B,KeyCode.PageUp,KeyCode.PageDown];h.prototype={getNavigationAction:function(e){var t=n.a.mac,a=e.ctrlKey&&!e.altKey&&!e.metaKey,i=e.altKey&&!e.ctrlKey&&!e.metaKey,r=e.metaKey&&!e.ctrlKey&&!e.altKey,s=!e.ctrlKey&&!e.altKey&&!e.metaKey,o=e.normCode,l=KeyCode,d=f;if(o===l.LeftArrow){if(a&&!n.a.mac||i&&n.a.mac)return d.LeftWord;if(r&&t)return d.StartLine;if(s)return d.Left}if(o===l.RightArrow){if(a&&!n.a.mac||i&&n.a.mac)return d.RightWord;if(r&&t)return d.EndLine;if(s)return d.Right}if(o===l.UpArrow){if(t&&r)return d.Top;if(t&&a)return d.PageUp;if(t&&i)return d.StartLine;if(!t&&a)return d.PrevHeader;if(s)return d.Up}if(o===l.DownArrow){if(t&&r)return d.Bottom;if(t&&a)return d.PageDown;if(t&&i)return d.EndLine;if(!t&&a)return d.NextHeader;if(s)return d.Down}if(o===l.A&&a&&t)return d.StartLine;if(o===l.E&&a&&t)return d.EndLine;if(o===l.B&&a&&t)return d.Left;if(o===l.F&&a&&t)return d.Right;if(o===l.Home&&!t){if(a)return d.Top;if(s)return d.StartLine}if(o===l.End&&!t){if(a)return d.Bottom;if(s)return d.EndLine}return o===l.PageUp&&s?d.PageUp:o===l.PageDown&&s?d.PageDown:o===l.A&&r&&t||o===l.A&&a&&!t?d.All:d.None},updateAutocomplete:function(e){var t=e&&e.normCode&&m.indexOf(e.normCode)>=0&&"#"!==e.key;if(!i.default.isDemoRunning){var a=l.a.getStartIndex(),r=l.a.getStartItem(),n=l.a.getStartOffset(),s=l.a.getPane();l.a.isValid()&&r===l.a.getEndItem()&&n===l.a.getEndOffset()&&s.isIndexMounted(a)?u.a.updateFromPane({owner:r,pane:s,index:a,start:n,element:l.a.getStartElement(),fromArrows:t}):u.a.hide()}},stopPropagation:function(e){try{i.default.PAssert(720,e.stopImmediatePropagation,"Should always be defined")}catch(e){i.default.reportError(e)}e.stopImmediatePropagation&&e.stopImmediatePropagation()},preventDefault:function(e){try{i.default.PAssert(721,e.preventDefault,"Should always be defined")}catch(e){i.default.reportError(e)}e.preventDefault&&e.preventDefault()},keyup:function(e,t){if(this.stopPropagation(t),this.preventDefault(t),this.isTyping=!1,t.handled)return!0},handleSelectAll:function(e){var t=e.indexOfFirstItem(),a=e.indexOfLastItem();return l.a.selectIndices(t,0,a,-1,r.a.SelectOption.AllowPrefix),!1},handleSelectAllItem:function(){if(i.default.focusedPane&&i.default.focusedPane.isWriteable)return l.a.selectIndex(l.a.getStartIndex(),0,-1),!1},_move:function(e,t){try{i.default.PAssert(722,e===Direction.Up||e===Direction.Down,"Must move in a direction")}catch(e){i.default.reportError(e)}var a,n,s=i.default.focusedPane,d=l.a.getStartIndex(),c=l.a.getEndIndex(),u=l.a.getStartItem(),h=l.a.getEndItem(),f=!1;if((u.parent()===h.parent()&&(f=!0),!f)&&!s.getNextItem(l.a.getEndIndex(),!0))for(;h;){if(u.parent()===h.parent()){f=!0;break}h=h.parent()}if(f&&(e===Direction.Up?(a=s.getPreviousItem(d,!0),n=h.getIndex()+1):(a=s.getNextItem(c,!0),n=u.getIndex()),a)){o.a.beginAction();var p=l.a.save();l.a.reset();var m=1+a.numChildrenRecursive();i.default.vmMain.setItemAnimationMode(r.a.ItemAnimationMode.Move),a.moveTo({parent:a.parent(),index:n},ChangeType.Local),i.default.vmMain.resetItemAnimationMode(),e===Direction.Up?(p.startIndex-=m,p.endIndex-=m):e===Direction.Down&&(p.startIndex+=m,p.endIndex+=m),l.a.restore(p),e===Direction.Up?l.a.scrollStartIntoView():l.a.scrollEndIntoView(),o.a.endAction()}},moveUp:function(e){!i.default.focusedPane.isViewAgenda()&&l.a.isValid()&&this._move(Direction.Up,e)},moveDown:function(e){!i.default.focusedPane.isViewAgenda()&&l.a.isValid()&&this._move(Direction.Down,e)},handleArrows:function(e,t){var a=i.default.focusedPane;if(!l.a.isValid())return!0;var r=this.getNavigationAction(t),s=f;switch(l.a.preferLineStart=!1,r){case s.Left:case s.Right:case s.StartLine:case s.EndLine:case s.LeftWord:case s.RightWord:var o,u,h,p=r===s.Left||r===s.LeftWord||r===s.StartLine,m=r===s.Right||r===s.RightWord||r===s.EndLine;if(p&&(!t.shiftKey||l.a.isArrowSelectInverted())||m&&t.shiftKey&&l.a.isArrowSelectInverted()||r===s.StartLine&&l.a.getStartIndex()===l.a.getEndIndex()?(M=l.a.getStartOffset(),A=l.a.getStartIndex(),h=l.a.getStartTotal(),o=l.a.getStartObject()):(M=l.a.getEndOffset(),A=l.a.getEndIndex(),h=l.a.getEndTotal(),o=l.a.getEndObject()),u=(B=o.item).getParsedText(),r===s.StartLine)k=(g=c.a.getCaretOffset(o,a,M)).lineStart,A=l.a.isArrowSelectInverted()?l.a.getStartIndex():l.a.getEndIndex(),h=l.a.isArrowSelectInverted()?l.a.getStartTotal():l.a.getEndTotal();else if(r===s.EndLine){var g=c.a.getCaretOffset(o,a,M);B.metricsInPane(a,A);k=g.lineStart+g.lineLength,A=l.a.isArrowSelectInverted()?l.a.getStartIndex():l.a.getEndIndex()}else if(r===s.LeftWord){var v=d.a.getPreviousWord(u,M-1),y=u.prevIndexOf(window.AttachChar,M);if(y<0||y<=v)if(-1===v&&0===M)if(A>0){if((A=a.indexOfPrevVMLI(A,!1,!0))>=0){var S=a.itemAtIndex(A).getParsedText();k=d.a.getPreviousWord(S,S.length-1)+1,h=S.length}}else k=-1;else k=v+1;else y>v&&(k=y+1,y+1===M&&k--)}else if(r===s.RightWord){var E=d.a.getNextWord(u,M+1),P=u.indexOf(window.AttachChar,M);if(P<0||P>=E)if(E===h)if(M===h)if(A<a.numItems()-1){if((A=a.indexOfNextVMLI(A,!1,!0))>=0){var b=a.itemAtIndex(A).getParsedText();E=d.a.getNextWord(b,0),h=b.length,-1===E&&(E=b.length),k=E}}else k=h+1;else k=h;else k=E;else(E>P||E<0)&&P>=0&&(k=P,P===M&&k++)}else r===s.Left?k=l.a.getStartOffset()===l.a.getEndOffset()||t.shiftKey?M-1:l.a.getStartOffset():r===s.Right&&(k=l.a.getStartOffset()===l.a.getEndOffset()||t.shiftKey?M+1:l.a.getEndOffset());if(l.a.preferLineStart=p,k<l.a.getStartItem().getPrefixLength()&&r!==s.StartLine?A>0?(A=a.indexOfPrevVMLI(A,!1,!0),k=-1):k=0:k>h&&(A<a.numItems()-1?(A=a.indexOfNextVMLI(A,!1,!0),k=0):k=h),t.shiftKey){var C=l.a.isArrowSelectInverted()?l.a.getEndIndex():l.a.getStartIndex(),D=l.a.isArrowSelectInverted()?l.a.getEndOffset():l.a.getStartOffset();!l.a.isArrowSelectInverted()&&p&&A<=l.a.getStartIndex()&&k>=-1&&k<l.a.getStartOffset()?l.a.setArrowSelectInverted(!0):l.a.isArrowSelectInverted()&&m&&A>=l.a.getEndIndex()&&k>l.a.getEndOffset()&&l.a.setArrowSelectInverted(!1),l.a.isArrowSelectInverted()?l.a.selectIndices(A,k,C,D):l.a.selectIndices(C,D,A,k)}else l.a.selectIndex(A,k);if(n.a.isFirefox)if(t.normCode===KeyCode.LeftArrow){if(B.getParsedText()[l.a.getStartOffset()-1]===window.AttachChar&&!t.shiftKey)return l.a.selectItem(B,l.a.getStartOffset()-1),!1}else if(t.normCode===KeyCode.RightArrow){if(B.getParsedText()[l.a.getEndOffset()]===window.AttachChar&&!t.shiftKey)return l.a.selectItem(B,l.a.getEndOffset()+1),!1}p?l.a.scrollStartIntoView():l.a.scrollEndIntoView();break;case s.Up:case s.Down:case s.Top:case s.Bottom:case s.PageUp:case s.PageDown:case s.PrevHeader:case s.NextHeader:var I,A,M,_=r===s.Up||r===s.Top||r===s.PageUp,T=r===s.Down||r===s.Bottom||r===s.PageDown;_&&(!t.shiftKey||l.a.isArrowSelectInverted())||T&&t.shiftKey&&l.a.isArrowSelectInverted()?(M=l.a.getStartOffset(),A=l.a.getStartIndex(),I=l.a.getStartObject()):(M=l.a.getEndOffset(),A=l.a.getEndIndex(),I=l.a.getEndObject());w=I.item;var w,k,x=c.a.getCaretOffset(I,a,M),L=c.a.getCaretScreenPosition(a,A,M),O=(x.lineOffset,L.left);if(l.a.preferLineStart=x.lineOffset<=2,r===s.Up){var R=x.line-1;if(0===A&&R<0)k=0,R=0;else{if(R<0&&A>0)if((A=a.indexOfPrevVMLI(A,!1,!0))>=0)w=a.itemAtIndex(A),I=a.objectAtIndex(A),R=c.a.getCaretOffset(I,a).line;R>=0&&(k=c.a.getOffsetForScreenPositionInLine(A,I,a,R,O))}}else if(r===s.Down){(R=x.line+1)>w.metricsInPane(a,A).styledLines.length-1&&(A<a.numItems()-1&&(A=a.indexOfNextVMLI(A,!1,!0))>=0?(w=a.itemAtIndex(A),R=0):R=x.line),k=c.a.getOffsetForScreenPositionInLine(A,I,a,R,O)}else if(r===s.Top)A=a.indexOfFirstItem(),k=0;else if(r===s.Bottom){var N=a.getLastItem(),F=a.numItems();N&&F>0&&(A=a.indexOfLastItem(),k=N.getParsedText().length)}else if(r===s.PageUp){A=a.indexPageUp(l.a.getStartIndex()),k=0}else if(r===s.PageDown){var U=a.indexPageDown(l.a.getStartIndex());A=U,k=(B=a.itemAtIndex(U)).getParsedText().length}else{if(r===s.PrevHeader&&a.isViewOutline()){if((B=l.a.getStartItem()).parent()===i.default.focusedItem){if(!B.isFirstChild()){try{i.default.PAssert(723,B.getIndex()>0,"Should never hit this with the first item in the list")}catch(e){i.default.reportError(e)}V=B.parent().getChild(B.getIndex()-1)}}else{for(;B.parent()!==i.default.focusedItem;)B=B.parent();V=B}return void 0!==V&&l.a.selectItem(V,-1),!1}if(r===s.NextHeader&&a.isViewOutline()){var B,V;if((B=l.a.getEndItem()).parent()===i.default.focusedItem)B.isLastChild()||(V=B.parent().getChild(B.getIndex()+1));else{for(;B.parent()!==i.default.focusedItem;)B=B.parent();B.isLastChild()||(V=B.parent().getChild(B.getIndex()+1))}return void 0!==V&&l.a.selectItem(V,-1),!1}}if(A>=0&&!isNaN(k))if(t.shiftKey){C=l.a.isArrowSelectInverted()?l.a.getEndIndex():l.a.getStartIndex(),D=l.a.isArrowSelectInverted()?l.a.getEndOffset():l.a.getStartOffset();!l.a.isArrowSelectInverted()&&_&&(A===l.a.getStartIndex()&&k<l.a.getStartOffset()||A<l.a.getStartIndex())?l.a.setArrowSelectInverted(!0):l.a.isArrowSelectInverted()&&T&&(A===l.a.getEndIndex()&&k>l.a.getEndOffset()||A>l.a.getEndIndex())&&l.a.setArrowSelectInverted(!1),l.a.isArrowSelectInverted()?l.a.selectIndices(A,k,C,D):l.a.selectIndices(C,D,A,k)}else l.a.selectIndex(A,k);_?l.a.scrollStartIntoView():l.a.scrollEndIntoView();break;case s.All:this.handleSelectAll(a)}return r===s.None},keydown:function(e,t){this.isTyping=!0;var a=!0;return p.indexOf(t.normCode)>=0?a=this.keypress(e,t,!0):n.a.mac&&t.ctrlKey&&t.normCode===KeyCode.D?a=this.keypress(e,t,!0):m.indexOf(t.normCode)>=0?(i.default.vmMain.setItemAnimationMode(r.a.ItemAnimationMode.None),a=this.handleArrows(e,t),i.default.vmMain.resetItemAnimationMode(),n.a.ios||this.updateAutocomplete(t)):n.a.mac&&t.metaKey||!n.a.mac&&t.ctrlKey&&!t.altKey?t.normCode!==KeyCode.Y&&t.normCode!==KeyCode.Z||(a=this.keypress(e,t,!0)):n.a.mac&&t.ctrlKey&&t.normCode===KeyCode.H&&this.preventDefault(t),a&&this.keyWantsScrollIntoView(t,!0)&&l.a.scrollStartIntoView(),a},checkKeypressSpecialCases:function(e,t){var a;return e.ctrlKey&&e.altKey&&t?a=!0:e.metaKey&&e.normCode===KeyCode.Tilde&&(a=!1),a},isMultiselectDangerous:function(){var e=i.default.focusedPane;if(!e.isViewOutline()&&!e.isViewProject())return"Are you sure you want to delete multiple items?";for(var t=e.indexOfNextVMLI(l.a.getStartIndex()-1),a=e.indexOfPrevVMLI(l.a.getEndIndex()+1),r=t,n=0;!isNaN(r)&&r>=0&&r<=a;){var s=e.itemAtIndex(r);if(e.isSearchedFlat()){if(e.search.isFlatSearchResult(s)&&n++,n>=2)return MessageID.FlatSearchMultiSelect}else if(++n>=8)return"You have selected a large number of items to delete. Are you sure?";r=e.indexOfNextVMLI(r)}return!1},keypress:function(e,t,a,r){var s=[KeyCode.Enter,KeyCode.D];try{i.default.PAssert(724,t.stopPropagation,"Should always be defined")}catch(e){i.default.reportError(e)}t.stopPropagation&&t.stopPropagation();var d=!0,c=i.default.focusedPane,u=t.normCode>=32||s.indexOf(t.normCode)>=0;if(!(0===t.which)&&(a||u)){if(n.a.mac&&t.metaKey||!n.a.mac&&t.ctrlKey)switch(String.fromCharCode(t.normCode)){case"c":case"C":return t.handled=!0,!0;case"v":case"V":return t.handled=!0,!0;case"x":case"X":return t.handled=!0,!0;case"Y":case"y":case"Z":case"z":try{i.default.PAssert(725,!1,"Should not be handled undo/redo hotkeys here")}catch(e){i.default.reportError(e)}return t.handled=!0,!0;case"r":case"R":case"a":case"A":case"t":case"T":return t.handled=!0,!0}var h=l.a.getStartItem();o.a.beginAction();var f=[KeyCode.Tab,KeyCode.Enter,KeyCode.BackSpace,KeyCode.Delete,KeyCode.D];if(l.a.getStartIndex()!==l.a.getEndIndex()&&t.normCode!==KeyCode.Tab&&(!t.metaKey&&!t.ctrlKey&&!t.optKey||f.indexOf(t.normCode)>=0))if(c.isViewOutline()||c.isViewProject()){var p;if(i.default.vmMain.beginUpdateItems(),!r&&(p=this.isMultiselectDangerous())){if(c.isSearchedFlat())i.default.toasts.pushMessage(MessageID.FlatSearchMultiSelect);else{var m=l.a.save();i.default.menus.confirm(p,function(i){l.a.restore(m),i&&this.keypress(e,t,a,!0)}.bind(this))}d=!1}else d=!!c.isEditable&&(d&&this.handleMultiselect(t));i.default.vmMain.commitUpdateItems()}else i.default.toasts.pushMessage({text:"Editing multiple items from this view is not currently supported. Please edit them individually.",actionText:"OKAY"}),d=!1;d&&f.indexOf(t.normCode)>=0&&(i.default.vmMain.beginUpdateItems(),t.ctrlKey||t.normCode!==KeyCode.Tab?t.normCode===KeyCode.Enter?d=!!c.isEditable&&(d&&this.handleEnter(t)):t.normCode===KeyCode.BackSpace?d=!!(h&&h.allowTextEditing()&&c.isEditable)&&(d&&this.handleBackspace(t)):(t.normCode===KeyCode.Delete||n.a.mac&&t.ctrlKey&&t.normCode===KeyCode.D)&&(d=!!(h&&h.allowTextEditing()&&c.isEditable)&&(d&&this.handleDelete(t))):d=!!c.isEditable&&(d&&this.handleTab(t)),i.default.vmMain.commitUpdateItems()),o.a.endAction()}return this.keyWantsScrollIntoView(t,a)&&l.a.scrollStartIntoView(),d},handleMultiselect:function(e){var t=i.default.focusedPane,a=t.indexOfNextVMLI(l.a.getStartIndex()-1),n=t.indexOfPrevVMLI(l.a.getEndIndex()+1),s=l.a.getStartOffset(),d=l.a.getEndOffset();l.a.selectIndices(a,s,n,d,r.a.SelectOption.AllowPrefix);var c=!0,u=t.objectAtIndex(a),h=l.a.getStartItem(),f=l.a.getEndItem();if(h.isNote()&&(h=h.parent()),f.isNote()&&(f=f.parent()),!t.hasNonVMLIs&&h===f)return!1;if(e.normCode===KeyCode.Enter&&e.shiftKey)return!0;for(var p=[],m=(n=n,t.indexOfNextVMLI(a));m&&m>=0&&(m<n||m===n&&l.a.getEndOffset()===l.a.getEndTotal());){(M=t.itemAtIndex(m)).parent()===i.default.focusedPane.getItem()&&M.isHeader()&&0,p.indexOf(M)<0&&M!==h&&p.push(M),m=t.indexOfNextVMLI(m)}var g,v=l.a.getEndItem().levelsDeep.get()-l.a.getStartItem().levelsDeep.get();if(l.a.getStartOffset()>0||l.a.getEndOffset()<l.a.getEndTotal()){var y=h.splitUsableText(h.getParsedText(),s,s),S=f.splitUsableText(f.getParsedText(),d,d);g=y.before+S.after,o.a.performAction(TrackerType.Remove,{itemID:h.id,position:l.a.getStartOffset(),text:h.getParsedText().slice(l.a.getStartOffset())}),o.a.performAction(TrackerType.Insert,{itemID:h.id,position:l.a.getStartOffset(),text:f.getParsedText().substring(l.a.getEndOffset())}),p.indexOf(f)<0&&p.push(f),0===l.a.getStartOffset()&&h.copyProperties(f)}else o.a.performAction(TrackerType.Remove,{itemID:h.id,position:0,text:h.getParsedText()}),g="";if(e.normCode!==KeyCode.BackSpace&&e.normCode!==KeyCode.Delete&&e.normCode!==KeyCode.Enter||(c=!1),h.setText(g,!0,ChangeType.Local),f.moveChildren(h,0,ChangeType.Local),v>0){for(var E=[],P=f.nextSibling();v>0&&P;){m=P.getIndex();var b=P.parent().getItems().slice(m);E=E.concat(b),P=P.parent().nextSibling(),v--}if(E.length>0)for(var C=h,D=(m=0,0);D<E.length;D++){var I=(M=E[D]).parent();if(p.indexOf(I)>=0){var A=M.getIndex();M.moveTo({parent:C,index:m},ChangeType.Local),o.a.performAction(TrackerType.Move,{itemID:M.id,oldParent:I.id,oldPosition:A,newParent:C.id,newPosition:m}),m++}}}else if(p.indexOf(f.parent())>=0){C=h.parent();for(var M=t.getNextItem(n,!0);M;){m=C.numItems(),A=(I=M.parent()).getChildIndex(M);M.moveTo({parent:C,index:m},ChangeType.Local),o.a.performAction(TrackerType.Move,{itemID:M.id,oldParent:I.id,oldPosition:A,newParent:C.id,newPosition:m}),M=t.getNextItem(n,!0)}}for(D=0;D<p.length;D++){M=p[D];try{i.default.PAssert(726,M,"Item must exist")}catch(e){i.default.reportError(e)}M.isDeleted()||M.parent().deleteChild(M,void 0,void 0,ChangeType.Local)}if(t.hasNonVMLIs){var _=t.closestIndexOfObject(u);try{i.default.PAssert(727,_>=0,"Could not find item to select")}catch(e){i.default.reportError(e)}_>=0&&l.a.selectIndex(_,s)}else l.a.selectIndex(a,s);return c},handleTab:function(e){var t=l.a.getPane(),a=l.a.getStartItem(),r=l.a.getStartIndex(),n=l.a.getEndItem(),s=l.a.getStartObject(),d=l.a.getEndObject(),c=l.a.getStartOffset(),u=l.a.getEndOffset(),h=!1,f=e.normCode===KeyCode.Tab&&!e.shiftKey||e.normCode===KeyCode.RightArrow,p=f?0:1;if(s.levelsDeep<p)return!1;if(f&&t.isViewAutoBlocks()&&s.levelsDeep===p){var m=t.prevPaneObjectAtSameLevel(r);if(!m||m.block!==s.block||m.item.parent()!==a.parent())return!1}i.default.vmMain.beginUpdateItems(),a&&a.isNote()&&(a=a.parent()),n&&n.isNote()&&(n=n.parent());var g,v,y,S,E,P=a,b={},C=[a],D={},I={};if(I[a.id]=!0,a!==n)do{(P=i.default.getNextItem(P,t,{numLevels:0,ignoreSearch:!0}))&&(C.push(P),I[P.id]=!0)}while(P!==n&&void 0!==P);for(e.shiftKey?(y=function(){v=C.length-1},S=function(){return v>=0},E=function(){v--}):(y=function(){v=0},S=function(){return v<C.length},E=function(){v++}),y();S();E()){var A=C[v];try{i.default.PAssert(728,A,"Must always be tabbing/untabbing valid items")}catch(e){i.default.reportError(e)}var M,_,T=A.parent(),w=T.getItems().indexOf(A);if(f){if(M=w>0&&!s.isBlockHeader,t.search.isFlatSearchResult(A)&&(M=!1,i.default.toasts.pushMessage(MessageID.FlatSearchTab)),M)if(s.block){var k=t.prevPaneObjectAtSameLevel(r);k&&k.item&&(g=k.item,h=!0)}else g=T.itemAtIndex(w-1);if(M&&g){for(;g.isHidden(t);){if(--w<=0)return i.default.vmMain.commitUpdateItems(),!1;g=T.itemAtIndex(w-1)}D[T.id]||(b[A.parent().id]=A.parent(),b[g.id]=g,A.moveTo({parent:g,fromTab:!0},ChangeType.Local),g.isCollapsed(t,!1)&&g.setCollapsed(!1,t)),D[A.id]=!0,o.a.performAction(TrackerType.Move,{itemID:A.id,oldParent:T.id,oldPosition:w,newParent:g.id,newPosition:g.numItems()-1})}else g=T,D[A.id]=D[T.id];for(var x=!1,L=A;L;){if(D[L.id]){L.isCollapsed(t,!1)||(x=!0);break}L=L.parent()}var O=A.getIndex()+1;if(x){var R=A.getItems(),N=0;for(_=0;_<R.length;_++){var F=R[_];if(!I[F.id]){if(F.isHidden(t,!1))continue;b[F.parent().id]=F.parent(),b[A.parent().id]=A.parent();var U=O+N;F.moveTo({parent:A.parent(),index:U,fromTab:!0},ChangeType.Local),D[F.id]=!0,o.a.performAction(TrackerType.Move,{itemID:F.id,oldParent:A.id,oldPosition:_,newParent:A.parent().id,newPosition:U}),N++,_--}}}}else if(M=A.parent()!==i.default.focusedItem&&!(t.isViewProject()&&s.block.id!==t.blockNoKey&&A.parent().parent()===i.default.focusedItem),(t.search.isFlatSearchResult(A)||t.search.isFlatSearchResult(A.parent()))&&(M=!1,i.default.toasts.pushMessage(MessageID.FlatSearchTab)),M){g=A.parent().parent();var B=T.getItems();for(_=w+1;B[w+1];){var V=B[w+1];I[V.id]||V.isHidden(t)?w++:(b[V.parent().id]=V.parent(),b[A.id]=A,V.moveTo({parent:A,fromTab:!0},ChangeType.Local),D[V.id]=!0,o.a.performAction(TrackerType.Move,{itemID:V.id,oldParent:T.id,oldPosition:_,newParent:A.id,newPosition:A.numItems()-1})),_++}if(I[T.id]>=0&&(!T.parent()||T.parent()!==i.default.focusedItem))continue;var H=g.getItems().indexOf(T);b[A.parent().id]=A.parent(),b[g.id]=g,A.moveTo({parent:g,index:H+1,fromTab:!0},ChangeType.Local),D[A.id]=!0,o.a.performAction(TrackerType.Move,{itemID:A.id,oldParent:T.id,oldPosition:w,newParent:g.id,newPosition:H+1})}}if(t.setIgnoreRestoreScroll(),i.default.vmMain.commitUpdateItems(!1,!0),s||d){try{i.default.PAssert(729,s&&d)}catch(e){i.default.reportError(e)}var q,G;h?(q=t.indexOfItem(a),G=t.indexOfItem(n)):(q=t.indexOfObject(s),G=t.indexOfObject(d)),q>=0&&G>=0&&l.a.selectIndices(q,c,G,u),l.a.scrollStartIntoView()}e.handled=!0;try{i.default.PAssert(730,e.preventDefault,"Should always be defined")}catch(e){i.default.reportError(e)}return e.preventDefault&&e.preventDefault(),!1},handleEnter:function(e){var t=i.default.focusedPane,a=l.a.getStartItem(),d=l.a.getStartObject(),c=l.a.getStartIndex(),u=l.a.getStartOffset(),h=l.a.getStartTotal(),f=l.a.getEndItem(),p=l.a.getEndOffset(),m=l.a.getEndTotal();if(!a){try{i.default.PAssert(731,!1,"Invalid item in handleEnter")}catch(e){i.default.reportError(e)}return!1}var g=a.parent();if(!g){try{i.default.PAssert(732,!1,"Invalid parent in handleEnter")}catch(e){i.default.reportError(e)}return!1}var v,y=g.getItems().indexOf(a),S=a.getParsedText(),E=!1,P=g;if(t.clearPreventUpdate(),e.shiftKey)return a.isNote()||a.editNote(),e.preventDefault(),!1;if(a.isNote())return e.preventDefault(),!1;if(t.search.isFlatSearchResult(a))return i.default.toasts.pushMessage(MessageID.FlatSearchEnter),e.preventDefault(),!1;if(t.isViewProject()&&t.isItemTopLevel(a)&&a.hasChildren()&&0===a.getChild(0).getParsedTextWithoutPrefix().length)l.a.selectIndex(c+1,0);else if(a.shouldCopyPrefix()&&S===a.getPrefix())a.setText("",!0,ChangeType.Local),l.a.selectIndex(c,0);else{if(!a.getPrefix()||u!==a.getPrefixLength()||p!==m){var b,C,D=!0,I=!1,A=!1,M={text:""},_=d.block;if(t.setIgnoreRestoreScroll(),t.isViewTag()&&a.getParsedText().indexOf(d.block.text)>=0&&(b=d.block.text,C=a.getParsedText()[a.getPrefixLength()]===r.a.TagPrefix?0:-1),t.isViewAgenda()&&0===d.levelsDeep&&!a.hasVisibleChildren(t))_.isStarred?M.isStarred=!0:_.isImportant?M.priority=a.priority():_.date&&a.getDateText()&&(M.text=" @"+a.getDateText()),a.shouldSave()||(P=s.a.getRootModel(),y=-1);else if(a.hasAttachmentType(r.a.PluginType.Calendar));else if(p===f.getPrefixLength()&&""!==S)y--,D=!1,I=!0;else if(u>=h)(E=!a.isCollapsed(t,!1)&&(a.getVisibleChildren(t).length>0||a.isPrefixHeader()))&&(P=a);else if(u===a.getPrefixLength()&&p===m)a.setText(a.getPrefix(),!0,ChangeType.Local),o.a.performAction(TrackerType.Remove,{itemID:a.id,position:0,text:S});else{var T=a.splitUsableText(S,u,p);b&&T.before.indexOf(T)<0&&(0===C?T.before=b+" "+T.before:T.before+=" "+b),M.text=T.after,i.default.vmMain.setItemAnimationMode(r.a.ItemAnimationMode.Move),a.setText(T.before,!0,ChangeType.Local),o.a.performAction(TrackerType.Remove,{itemID:a.id,position:0,text:S.substring(0,p)}),A=!0,(E=!a.isCollapsed(t,!1)&&(a.numItems()>0||a.isHeader()))&&(P=a)}!E&&b&&M.text.indexOf(b)<0&&(0===C?M.text=b+" "+M.text:M.text+=" "+b);var w=i.default.settings.get(Settings.defaultItemPrefix);if(E||!a.shouldCopyPrefix()&&!A?(!E||E&&w&&(a.isPrefixHeader()||a.shouldCopyPrefix()&&a.prefix===w))&&(M.text=(w&&w+" ")+M.text):M.text=a.getPrefix()+M.text,v=t.createVMLI(M,{parent:P,changeType:ChangeType.AllLocal,isEditable:!0}),A&&v.copyProperties(a),v.parseText(!0,ChangeType.Local|ChangeType.All),E)a.insertItem(v,0),o.a.performAction(TrackerType.Create,{itemID:v.id,parent:a.id,position:0,text:v.getParsedText()});else{try{i.default.PAssert(733,!v.isNote(),"Should never be inserting a note here")}catch(e){i.default.reportError(e)}P.insertItem(v,y+1),o.a.performAction(TrackerType.Create,{itemID:v.id,parent:P.id,position:y+1,text:v.getParsedText()})}i.default.vmMain.resetItemAnimationMode();var k=D?v:a;try{i.default.PAssert(734,k,"Expected another item to exist")}catch(e){i.default.reportError(e)}var x=t.closestIndexOfObject(d),L=D?t.indexOfNextVMLI(x,!1,!0):I?x-1:x,O=k.shouldCopyPrefix()&&k.getPrefixLength()||0;if(L<0){var R=t.indexOfLastItem(),N=t.getLastItem();R>=0&&R!==x&&N&&(L=R,O=N.getParsedText().length)}L>=0&&l.a.selectIndex(L,O,O,n.a.android&&r.a.SelectOption.Delay);try{i.default.PAssert(735,e.preventDefault,"Should always be defined")}catch(e){i.default.reportError(e)}return e.preventDefault&&e.preventDefault(),!1}a.setText(a.getPrefix(),!0,ChangeType.Local),l.a.selectIndex(c,0),o.a.performAction(TrackerType.Remove,{itemID:a.id,position:0,text:S})}},handleBackspace:function(e){var t=l.a.getStartItem(),a=l.a.getStartIndex(),s=l.a.getStartObject(),c=i.default.focusedPane;if(!t){try{i.default.PAssert(736,!1,"Invalid item in handleBackspace")}catch(e){i.default.reportError(e)}return!1}var u=t.parent();try{i.default.PAssert(737,u,"Must always have a valid parent for an item")}catch(e){i.default.reportError(e)}n.a.ie&&(e.preventDefault(),e.stopImmediatePropagation());var h=t.getParsedText(),f="",p=0,m=!0,g=t.hasAttachmentType(r.a.PluginType.Calendar);if(0===l.a.getStartOffset()&&0===l.a.getEndOffset()||""===h)if(s.isBlockHeader&&t.hasChildren())m=!1;else if(t.isNote()&&""!==h)m=!1;else if(g)m=!1;else if(l.a.getStartIndex()>0){var v=i.default.focusedPane.indexOfPrevVMLI(l.a.getStartIndex(),!0,!0),y=v>=0&&i.default.focusedPane.itemAtIndex(v);if(y&&y.allowTextEditing()){if((c.isViewAgenda()||c.search.isFlatSearchResult(t))&&0!==(h=h.replace(t.getItemDateString(),"").trim()).length&&(m=!1),m){c.setIgnoreRestoreScroll();var S=y.getParsedText(),E=y.isFullscreen()?0:v,P=c.objectAtIndex(E),b=y.isFullscreen()?0:S.length;l.a.selectIndex(E,b),u.deleteChild(t,y,0,ChangeType.Local),h.length>0&&""!==h&&(0===S.length&&y.copyProperties(t),y.setText(y.generateSaveText(S)+t.generateSaveText(h),!0,ChangeType.Local),t.hasNote()&&(y.hasNote()||y.moveNote(t,ChangeType.Local)),o.a.performAction(TrackerType.Insert,{itemID:y.id,position:S.length,text:h})),E=c.indexOfObject(P),l.a.selectIndex(E,b),m=!1}}else m=!1}else m=!1;else if(l.a.getStartOffset()===l.a.getEndOffset()&&l.a.getStartOffset()<=t.getPrefixLength())s.isBlockHeader&&t.hasChildren()?m=!1:(o.a.performAction(TrackerType.Remove,{itemID:t.id,position:0,text:h.slice(0,t.getPrefixLength())}),f=h.substr(t.getPrefixLength()),p=0);else if(0===l.a.getStartOffset()&&l.a.getEndOffset()===h.length)o.a.performAction(TrackerType.Remove,{itemID:t.id,position:0,text:t.getParsedText()}),f="",p=0;else if(e.metaKey)if(t.isNote()){var C=h.prevIndexOf("\n",l.a.getEndOffset());C<0?(f=h.substring(l.a.getEndOffset()),p=0,o.a.performAction(TrackerType.Remove,{itemID:t.id,position:0,text:h.slice(0,l.a.getEndOffset())})):(f=h.substring(0,C)+h.substring(l.a.getEndOffset()),p=C,o.a.performAction(TrackerType.Remove,{itemID:t.id,position:0,text:h.slice(C,l.a.getEndOffset())}))}else f=t.getPrefix()+h.substring(l.a.getEndOffset()),o.a.performAction(TrackerType.Remove,{itemID:t.id,position:0,text:h.slice(0,l.a.getEndOffset())}),p=0;else if((n.a.mac&&e.altKey||!n.a.mac&&e.ctrlKey)&&l.a.getStartOffset()===l.a.getEndOffset()){var D=h.substring(l.a.getStartOffset()),I=d.a.getPreviousWord(h,l.a.getStartOffset()-1)+1;I>=0?(o.a.performAction(TrackerType.Remove,{itemID:t.id,position:I,text:h.slice(I,l.a.getStartOffset())}),f=h.substring(0,I)+D,p=I):(l.a.getStartOffset()===h.length?0===l.a.getStartOffset()&&(f="",o.a.performAction(TrackerType.Remove,{itemID:t.id,position:0,text:h})):(o.a.performAction(TrackerType.Remove,{itemID:t.id,position:0,text:h.slice(0,l.a.getStartOffset())}),f=D),p=0)}else if(l.a.getStartOffset()!==l.a.getEndOffset()){var A=h.slice(l.a.getStartOffset(),l.a.getEndOffset());g&&A.indexOf(window.AttachChar)>=0&&A.indexOf(r.a.DatePrefix)<0?(o.a.performAction(TrackerType.Remove,{itemID:t.id,position:l.a.getStartOffset(),text:A.replace(window.AttachChar,"")}),f=h.substr(0,l.a.getStartOffset())+h.substr(l.a.getEndOffset())+window.AttachChar):(o.a.performAction(TrackerType.Remove,{itemID:t.id,position:l.a.getStartOffset(),text:A}),f=h.substr(0,l.a.getStartOffset())+h.substr(l.a.getEndOffset())),p=l.a.getStartOffset()}else{var M=1;h.length>1&&""===h[l.a.getStartOffset()-1]&&M++,g&&h.charAt(l.a.getStartOffset()-1)===window.AttachChar?" "===h.charAt(l.a.getStartOffset()-2)?(f=h.substr(0,l.a.getStartOffset()-3)+h.substr(l.a.getStartOffset()-2),p=l.a.getStartOffset()-3):(f=h.substr(0,l.a.getStartOffset()-2)+h.substr(l.a.getStartOffset()-1),p=l.a.getStartOffset()-2):(f=h.substr(0,l.a.getStartOffset()-M)+h.substr(l.a.getStartOffset()),o.a.performAction(TrackerType.Remove,{itemID:t.id,position:l.a.getStartOffset()-M,text:h.slice(l.a.getStartOffset()-M,l.a.getStartOffset())}),p=l.a.getStartOffset()-M),!g||f!==" "+window.AttachChar&&f!==window.AttachChar||(f="",p=0)}return m&&(t.setText(f,!0,ChangeType.Local),l.a.selectIndex(a,p),this.updateAutocomplete(e)),!1},handleDelete:function(e){var t=l.a.getStartItem(),a=i.default.focusedPane;if(!t)return!1;var s,c=t.parent(),u=t.getParsedText(),h=!0,f=t.hasAttachmentType(r.a.PluginType.Calendar);if(""===u)if(a.isViewOutline()){if(t.isNote())c.setNote(void 0,ChangeType.Local),l.a.selectItem(c,-1);else if(l.a.getStartIndex()<a.numItems()-1){var p=l.a.getStartIndex();a.setIgnoreRestoreScroll(),a.numItems()>1&&(t.hasChildren()?c.replaceChild(t,t.getFirstChild(),ChangeType.Local):c.deleteChild(t,c,p,ChangeType.Local)),l.a.selectIndex(p,0)}}else h=!1;else if(l.a.getStartOffset()===l.a.getStartTotal()&&l.a.getEndOffset()===l.a.getEndTotal())if(a.isViewOutline())if(t.isNote())h=!1;else{var m=a.indexOfNextVMLI(l.a.getStartIndex(),!0,!0),g=m>=0&&a.itemAtIndex(m);if(a.setIgnoreRestoreScroll(),g&&h){u=t.generateSaveText(u);var v=g.generateSaveText(g.getParsedText()),y=g.hasNote()&&g.getNote();if(t.setText(u+v,!0,ChangeType.Local),y){var S=t.hasNote()&&t.getNote();if(S){var E=S.getRawText()+"\n\n--- merged note ---\n\n"+y.getRawText();S.setText(E,!0,ChangeType.Local)}else y.parent(t),t.setNote(y,ChangeType.Local)}o.a.performAction(TrackerType.Insert,{itemID:t.id,position:u.length,text:g.getParsedText()}),g.parent().deleteChild(g,t,0,ChangeType.Local),l.a.selectIndex(l.a.getEndIndex(),l.a.getEndOffset())}}else h=!1;else if(e.metaKey)t.isNote()||(s=u.substring(0,l.a.getStartOffset()),t.setText(s,!0,ChangeType.Local),o.a.performAction(TrackerType.Remove,{itemID:t.id,position:0,text:u.slice(0,l.a.getStartOffset())}),l.a.selectIndex(l.a.getStartIndex(),l.a.getStartOffset()));else if((n.a.mac&&e.altKey||!n.a.mac&&e.ctrlKey)&&l.a.getStartOffset()===l.a.getEndOffset()){var P=d.a.getNextWord(u,l.a.getStartOffset()+1);P<0&&(P=l.a.getStartTotal()),P>=0&&(s=u.substring(0,l.a.getStartOffset())+u.substring(P),t.setText(s,!0,ChangeType.Local),o.a.performAction(TrackerType.Remove,{itemID:t.id,position:P,text:s}),l.a.selectIndex(l.a.getStartIndex(),l.a.getStartOffset()))}else{if(l.a.getStartOffset()!==l.a.getEndOffset()){var b=u.slice(l.a.getStartOffset(),l.a.getEndOffset());f&&b.indexOf(window.AttachChar)>=0&&b.indexOf(r.a.DatePrefix)<0?(s=u.substr(0,l.a.getStartOffset())+u.substr(l.a.getEndOffset())+window.AttachChar,o.a.performAction(TrackerType.Remove,{itemID:t.id,position:l.a.getStartOffset(),text:u.slice(l.a.getStartOffset(),l.a.getEndOffset())})):(s=u.substr(0,l.a.getStartOffset())+u.substr(l.a.getEndOffset()),o.a.performAction(TrackerType.Remove,{itemID:t.id,position:l.a.getStartOffset(),text:u.slice(l.a.getStartOffset(),l.a.getEndOffset())}))}else f&&u.charAt(l.a.getStartOffset())===window.AttachChar||(s=u.substr(0,l.a.getStartOffset())+u.substr(l.a.getStartOffset()+1),o.a.performAction(TrackerType.Remove,{itemID:t.id,position:l.a.getStartOffset(),text:u.slice(l.a.getStartOffset(),l.a.getStartOffset()+1)}));!f||s!==" "+window.AttachChar&&s!==window.AttachChar&&s!==" "+window.AttachChar&&u!==window.AttachChar||(s=""),void 0!==s&&(t.setText(s,!0,ChangeType.Local),l.a.selectIndex(l.a.getStartIndex(),l.a.getStartOffset()),this.updateAutocomplete(e))}return!1},keyWantsScrollIntoView:function(e,t){switch(e.normCode){case KeyCode.LeftMeta:case KeyCode.RightMeta:case KeyCode.Alt:case KeyCode.Shift:case KeyCode.Ctrl:case KeyCode.LeftArrow:case KeyCode.RightArrow:case KeyCode.UpArrow:case KeyCode.DownArrow:return!1}return!(n.a.mac&&e.metaKey&&(t&&e.normCode===KeyCode.Tilde||!t&&"`"===String.fromCharCode(e.normCode)))&&((!(n.a.mac&&e.metaKey||!n.a.mac&&e.ctrlKey)||e.normCode!==KeyCode.Z&&e.normCode!==KeyCode.Y)&&!(e.normCode>=KeyCode.F1&&e.normCode<=KeyCode.F12))}},t.a=new h},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(20),a(119)),s=a(120),o=a(9),l=a(19),d=r.a.TaskViewMode,c=r.a.TaskViewModeIcon;function u(){this._inactivePaneTypes={},this.activePaneTypes=new l.a,this._registeredTypes={},this.numInactivePanes=new o.a(0),this.registerPaneType(void 0,PaneMode.Task,"Task",s.a,"icon-align-left",99),this.registerPaneType(void 0,PaneMode.Archived,"Archived",n.a,"icon-inbox",90)}u.prototype={paneSortCompare:function(e,t){return e.priority<t.priority?1:-1},registerPaneType:function(e,t,a,i,r,n){this._registeredTypes[t]={plugin:e,constructor:i};var s={type:t,name:a,icon:r,text:a,priority:n,tooltip:"Add "+a+" Pane"};!e||e.isActive()?this.activePaneTypes.insertSorted(s,this.paneSortCompare):(this._inactivePaneTypes[t]=s,this.numInactivePanes.set(this.numInactivePanes.get()+1))},activatePaneType:function(e){var t=this._inactivePaneTypes[e];try{i.default.PAssert(1221,t,"Must have previously registered pane type")}catch(e){i.default.reportError(e)}this._inactivePaneTypes[e]=void 0,this.activePaneTypes.insertSorted(t,this.paneSortCompare),this.numInactivePanes.set(this.numInactivePanes.get()-1)},deactivatePaneType:function(e){var t=this.activePaneTypes.remove(function(t){return t.type===e})[0];try{i.default.PAssert(1222,t,"Must have previously activated pane type")}catch(e){i.default.reportError(e)}i.default.vmMain.paneManager.removePanesByType(e),this._inactivePaneTypes[e]=t,this.numInactivePanes.set(this.numInactivePanes.get()+1)},canCreatePane:function(e){var t=this._registeredTypes[e];return!(t.plugin&&(!t.plugin.isActive()||t.plugin.isPluginBlocked()))},createPane:function(e,t){if((t=t||{}).id||(t.id=i.default.vmMain.paneManager.getNextPaneID()),"PaneTimeline"===e){t.viewMode;e=PaneMode.Task,t.viewState={viewMode:d.Agenda_All}}else"PaneOutline"===e&&(e=PaneMode.Task,t.viewState={viewMode:d.Outline});var a=this._registeredTypes[e];if(a){if(!a.plugin||a.plugin.isActive()&&!a.plugin.isPluginBlocked())try{i.default.vmMain.beginUpdateItems();var r=new a.constructor(t);return i.default.vmMain.commitUpdateItems(),r}catch(e){return void i.default.reportError(e)}}else try{i.default.PAssert(1223,!1,"Invalid pane type requested")}catch(e){i.default.reportError(e)}},isPaneTypeActive:function(e){var t=!!this._registeredTypes[e],a=!!this._inactivePaneTypes[e];return t&&!a},getRegisteredPanes:function(){return this.activePaneTypes.get()},_getTaskView:function(e,t,a){for(var i=[],n=0;n<a.length;n++){var s=a[n];i.push({text:r.a.TaskViewModeText[s],type:PaneMode.Task,viewMode:s,icon:r.a.TaskViewModeIcon[s],canZoom:!0})}e.push({text:t,viewModes:i,border:e.length>0})},getAvailablePanes:function(e){var t=this.activePaneTypes.get(),a=this.numInactivePanes.get(),r=[];if(r.push({text:"Outline",type:PaneMode.Task,viewMode:d.Outline,icon:c[d.Outline],canZoom:!0}),this._getTaskView(r,"Grouped by",[d.Groups_Project,d.Groups_Tag,d.Groups_Contact,d.Groups_Priority]),this._getTaskView(r,"Agenda",[d.Agenda_Today,d.Agenda_Week,d.Agenda_All]),this._getTaskView(r,"Calendar",[d.Calendar_Day,d.Calendar_Week,d.Calendar_Month]),!e){for(var n=!0,s=0;s<t.length;s++){var o=t[s],l=!0;if(o.type!==PaneMode.Task){if(o.type===PaneMode.Archived)i.default.vmMain.root().hasArchivedDescendant()||(l=!1);if(l){var u=o.type===PaneMode.Gmail;r.push({text:o.text,type:o.type,icon:o.icon,canZoom:u,border:n}),n=!1}}}a>0&&r.push({enableMore:!0})}return r}},t.a=new u},function(e,t,a){"use strict";var i=a(0),r=a(7),n=a(1),s=a(2),o=a.n(s),l=a(3),d=a(24),c=a(23),u=a(29),h=a(50),f=l.a.createClass({displayName:"ReactItem",componentDisplay:n.a.ComponentDisplay.Everywhere,init:function(){var e=this.props,t=e.item;e.renderLikePane&&!isNaN(e.paneObject.index)&&(this.styleProps=t.styleProps(e.pane),this.metrics=t.metricsInPane(e.pane,e.paneObject.index))},componentDidMount:function(){var e=this.props,t=e.item;this.listenTo(t.itemChanged),this.setData(this.getElement(),t);try{i.default.PAssert(2570,e.pane||!e.renderLikePane&&!e.padded,"Should not use these props if no pane")}catch(e){i.default.reportError(e)}this.props.editable&&(this._needsSelect=isNaN(e.selectIndex)?t.getParsedText().length:e.selectIndex,c.a.selectElement(this.getElement(),this._needsSelect))},getElement:function(){return this.refs.element.getElement()},getState:function(){var e=this.props,t=e.pane,a=e.item,i={flags:a.flags,renderLikePane:e.renderLikePane&&!isNaN(e.paneObject.index),styleProps:this.styleProps,priorityProps:e.showPriority&&a.getPriorityProps(),isComplete:a.isComplete(),hasPrefix:a.hasPrefix()};return e.allowDrag&&(i.draggedInPane=a.draggedInPane,i.isBeingDragged=a.draggedInPane.get()===t||!1),i.renderLikePane?(i.metrics=this.metrics,i.lines=i.metrics.styledLines):i.lines=[a.getStyledTextAsOneLine()],i},focus:function(){var e=this.props.item.getParsedText().length;c.a.selectElement(this.getElement(),e)},onKeyDown:function(e){var t=this.props,a=t.item;e.keyCode===KeyCode.Backspace&&this.state.hasPrefix&&""===a.getParsedTextWithoutPrefix()&&a.setText("",!0,!1!==t.shouldSave?ChangeType.Local:ChangeType.Auto)},onKeyPress:function(e){var t=this.props;if(t.onKeyPress&&(t.onKeyPress(e),!e.defaultPrevented)){var a=this.props.item,i=c.a._getSelectionRange(),r=c.a.getSelectOffsetsInElement(e.target,i);if(this._needsSelect=void 0,r.start!==r.end){var n=a.getParsedText(),s=n.substr(0,r.start)+n.substr(r.end);a.setText(s,!0,!1!==t.shouldSave?ChangeType.Local:ChangeType.Auto),this._needsSelect=r.start}}},componentDidUpdate:function(){if(!isNaN(this._needsSelect)){var e=this.getElement(),t=e.innerHTML;(t.indexOf("<br")>=0||t.indexOf("></span>")>0||""===t)&&(e.innerHTML=this.getRenderedHtml()),c.a.selectElement(e,Math.min(e.textContent.length,this._needsSelect)),this._needsSelect=void 0}},convertElementToText:function(e){var t="";if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(e.classList.contains("plugin"))t+=n.a.AttachChar;else for(var a=0;a<e.childNodes.length;a++)t+=this.convertElementToText(e.childNodes[a]);return t},stopResizing:function(){this.isResizing=!1},onInput:function(e){e.target.innerHTML.indexOf("<br")>=0&&(e.target.innerHTML=e.target.innerHTML.replace("<br/>","").replace("<br>",""));var t=this.props.item,a=this.convertElementToText(e.target).replace(new RegExp(TextSpace,"g"),""),i=c.a._getSelectionRange();if(i){var r=c.a.getSelectOffsetsInElement(e.target,i);this._needsSelect=r.start}t.setText(a,!0,ChangeType.Local),this.updateAutocomplete(),e.preventDefault()},updateAutocomplete:function(){var e=this.getElement(),t=this.props.autocompleteMode;if(t){var a=c.a.getSelectionInElement(e);0,a&&a.start===a.end&&u.a.update({mode:t,text:this.convertElementToText(e).replace(new RegExp(TextSpace,"g"),""),offset:a.start,owner:this,parsedEls:this.parsedEls,positionOffset:this.props.positionOffset,elementDisplay:e,elementInput:e,supportSearchItemAutocomplete:this.props.supportSearchItemAutocomplete})}},onAutocompleteSelected:function(e){void 0!==e.value&&(this.props.item.setText(e.value,!0,ChangeType.Local),c.a.selectElement(this.getElement(),e.offset),setTimeout(function(){c.a.selectElement(this.getElement(),e.offset)}.bind(this),0))},onClick:function(e){if(!this.isResizing){var t=this.props;if(i.default.menus.isContextMenuOpen("ReactContextMenuContactDetails")&&i.default.menus.closeContextMenu("ReactContextMenuContactDetails"),t.editOnClick)e.preventDefault(),e.stopPropagation(),i.default.menus.isContextMenuOpen()&&i.default.menus.closeContextMenu(),i.default.menus.openContextMenu({componentName:"ReactItemDetailsPopup",element:e.target,item:t.item,pane:t.pane});else{var a=!0;if((t.editable||t.inItemDetails)&&t.pane&&(a=!i.default.vmMain.pluginManager.handleTapClick(t.item,t.pane,e)),a&&!t.inItemDetails&&i.default.hasClass(e.target,"contact")){var s=e.target.textContent,o=r.a.contactManager.findMatchExact(s[0]===n.a.ContactPrefix?s.substr(1):s);o&&i.default.menus.openContextMenu({componentName:"ReactContextMenuContactDetails",position:"bottom",element:e.target,contact:o})}}}},onMouseDown:function(e){if(e.button===ButtonCode.Left){var t=this.props,a=t.item,i=t.resizable;if(i){var r=this.getElement().getBoundingClientRect(),s=Math.min(n.a.CalendarResizeHandleHeight,r.height/3);i=e.clientY-r.top<s?t.onItemResizeStart(a,this,!1):r.bottom-e.clientY<s&&t.onItemResizeStart(a,this,!0)}this.isResizing=i,!i&&t.allowDrag&&a.checkDragOnStart(e)}},onMouseMove:function(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnMove(e,!1)},onMouseUp:function(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnEnd(e)},onRightClick:function(e){var t=this.props;t.pane&&!1!==t.allowDrag&&(i.default.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"contextMenuItem"+this.props.item.id,element:e.target,item:this.props.item,pane:this.props.pane,pos:{left:e.clientX,top:e.clientY}}),e.preventDefault(),e.stopPropagation())},getRenderedHtml:function(){for(var e,t=this.props,a=this.props.item,i=this.state.lines,r="",n=0;n<i.length;++n)e=t.renderLikePane?"padding-top: "+(0===n?d.a.paddingForItemTop(a)+"px":0)+"; padding-bottom: "+(n===i.length-1?(t.noNotes?d.a.paddingForItemTop(a):d.a.paddingForItemBottom(a))+"px":0)+";":"padding-top: 2px; padding-bottom: 2px",r+='<span class="line'+(n===i.length-1?" last":"")+'" style="'+e+'">'+(i[n]||TextSpace)+"</span>";return r},render:function(){var e=this.props,t=e.item,a=this.state,r=(a.lines,e.editable&&i.default.vmMain.pluginManager.allowTextEditing(t)),n=i.default.classNames("item itemNotInPane",e.className,a.styleProps,a.priorityProps,e.coloredInCalendar&&"colored",{hasPrefix:a.hasPrefix},{"itemBeingDragged c-bg-light":a.isBeingDragged},{autoSelect:r},{complete:a.isComplete},{"c-bg-dark":a.isComplete&&e.coloredInCalendar}),s={};a.renderLikePane&&e.padding&&(s.paddingLeft=e.padding);var l=this.getRenderedHtml();if(e.style&&(s=i.default.extend(e.style,s)),e.coloredInCalendar&&!a.isBeingDragged){a.isComplete||(s.backgroundColor=t.getCalendarColor());var d=t.getCalendarDisplayProps();if(d)for(var c in d.style){try{i.default.PAssert(2571,!s[c],"Calendar display prop overwriting default styling")}catch(e){i.default.reportError(e)}s[c]=d.style[c]}}return o.a.createElement(h.a,{"data-moo-id":this.getUniqueID(),style:s,className:n,contentEditable:r,onClick:(e.editOnClick||r||e.inItemDetails)&&this.onClick,onKeyDown:r&&this.onKeyDown,onKeyPress:r&&this.onKeyPress,onInput:r&&this.onInput,onMouseDown:!r&&this.onMouseDown,onMouseMove:!r&&this.onMouseMove,onMouseUp:!r&&this.onMouseUp,onContextMenu:this.onRightClick,tabIndex:e.tabIndex,dangerouslySetInnerHTML:{__html:l},ref:"element"})}});t.a=f},function(e,t,a){"use strict";var i=a(0),r=/^<(.*)>$/,n=/^[^:]+(?=:)/;function s(){}var o={Default:{bannedTags:["style","script","source","track","iframe","frame","frameset","button","input","audio","video","math","svg","link","comment","base","object","embed"],allowedAttributes:["abbr","accept","acceptcharset","accesskey","align","alt","async","autocomplete","axis","background","border","bordercolor","bgcolor","cellpadding","cellspacing","char","charoff","charset","checked","cid","class","classid","classname","color","colspan","cols","content","contextmenu","controls","coords","data","datetime","defer","dir","disabled","download","draggable","enctype","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","headers","height","hidden","high","href","hreflang","htmlfor","httpequiv","icon","itemscope","itemtype","itemid","itemprop","itemref","label","lang","list","loop","low","manifest","marginheight","marginwidth","max","maxlength","media","mediagroup","method","min","multiple","muted","name","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","radiogroup","readonly","rel","required","role","rowspan","rows","rules","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","sortable","sorted","span","spellcheck","src","srcdoc","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","valign","value","width","wmode"],allowedTagAttributes:{A:["href","name"],IMG:["src","alt"],FONT:["face"],HTML:["xmlns"],BODY:["text","link","alink","vlink"],META:["http-equiv"],VAR:["id"]}}};s.prototype={update:function(e,t,a,r){try{i.default.PAssert(2018,t,"Must supply a valid resource lib")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2019,a,"Must supply a valid options obj")}catch(e){i.default.reportError(e)}var n;return"text/plain"===r?n=this._parsePlain(e,t,a):"text/html"===r?n=this._parseHTML(e,t,a):i.default.reportError("Unknown email mimeType: "+r),n?n.parsed=this._escapeHTMLEntities(n.parsed):n={parsed:void 0,missingResourceData:!0},n},_escapeHTMLEntities:function(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(/[\x01-\t\x0B\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"})},getAttachmentLinks:function(e,t){var a=[],r=this._createDoc(e);if(r){var n=this._findLinkElements(r),s=this._findQuoteElements(r);try{a=this._findSpecialLinks(n,s,t).attachments}catch(e){i.default.reportError(e)}}return a},generatePlaintext:function(e,t){return this._createDoc(e).body.innerText},replaceSignature:function(e,t){var a,r=this._createDoc(e),n=this._findActiveSignature(r);if(n){var s=!!n.innerHTML;if(n.innerHTML=t||"",t)s||(n.parentNode.insertBefore(document.createElement("br"),n),n.parentNode.insertBefore(document.createElement("br"),n),n.parentNode.insertBefore(document.createTextNode("--"),n),n.parentNode.insertBefore(document.createElement("br"),n));else{var o=n.previousSibling;if(o&&"BR"===o.tagName){var l=o.previousSibling;if(l&&i.default.isTextNode(l)&&"--"===l.textContent){var d=l.previousSibling;if(d){var c=d.previousSibling;"BR"===d.tagName&&(d.parentElement.removeChild(d),c&&"BR"===c.tagName&&c.parentElement.removeChild(c))}o.parentElement.removeChild(o),l.parentElement.removeChild(l)}}}a=r.body.outerHTML}else a=e;return a},_ensurePartDoc:function(e){var t;switch(e.mimeType){case"text/plain":t=this._createDoc(this._parsePlain(e.decoded).parsed);break;case"text/html":t=this._createDoc(e.decoded);break;default:try{i.default.PAssert(2020,!1,"Unknown display part mimeType: "+e.mimeType)}catch(e){i.default.reportError(e)}}return t},_mergeDocs:function(e,t){if(e.body){var a=t.adoptNode(e.body),r=t.createElement("div");try{for(var n=0;n<a.attributes.length;++n){var s=a.attributes[n];r.setAttribute(s.name,s.value)}}catch(e){i.default.reportError(e)}try{for(;a.childNodes.length>0;)r.appendChild(a.firstChild)}catch(e){i.default.reportError(e)}try{t.body.appendChild(r)}catch(e){i.default.reportError(e)}}},combineParts:function(e){try{i.default.PAssert(2021,i.default.isArray(e)&&e.length>0,"Must always supply a valid part list with contents")}catch(e){i.default.reportError(e)}var t=this._createDoc("<body></body>");try{i.default.PAssert(2022,t,"Must always be able to create a valid document for first part in list")}catch(e){i.default.reportError(e)}if(t)for(var a=0;a<e.length;++a){var r=this._ensurePartDoc(e[a]);if(r)try{this._mergeDocs(r,t)}catch(e){i.default.reportError(e)}}return t?t.body.outerHTML:" "},removeElementById:function(e,t){try{i.default.PAssert(2023,i.default.isString(e),"Must pass in a valid decoded HTML email string")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2024,i.default.isString(t),"Must provide a valid item ID")}catch(e){i.default.reportError(e)}var a=!1;try{var r=this._createDoc(e);r&&(a=this._removeElementById(r,t))}catch(e){i.default.reportError(e)}return a?r.body.outerHTML:e},_removeElementById:function(e,t){var a=!1,i=e.getElementById(t);return i&&(i.parentNode.removeChild(i),a=!0),a},removeElementsByAttribute:function(e,t,a){try{i.default.PAssert(2025,i.default.isString(e),"Must pass in a valid decoded HTML email string")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2026,i.default.isString(t),"Must provide a valid item ID")}catch(e){i.default.reportError(e)}var r=!1;try{var n=this._createDoc(e);n&&(r=this._removeElementsByAttribute(n,t,a))}catch(e){i.default.reportError(e)}return r?n.body.outerHTML:e},_removeElementsByAttribute:function(e,t,a){var i,r=!1;i=void 0!==a&&null!==a?e.querySelectorAll("["+t+'="'+a+'"]'):e.querySelectorAll("["+t+"]");for(var n=0;n<i.length;++n){var s=i[n];s.parentNode.removeChild(s),r=!0}return r},_createFragment:function(){return{lines:[],isQuote:!1}},_createPlainFragments:function(e){var t=[],a=e.split("\n"),i=this._createFragment();t.push(i);for(var r=0;r<a.length;++r){var n=a[r].trim(),s=new RegExp(/^>+/).test(n);i.lines.length>0&&s!==i.isQuote&&""!==n&&(i=this._createFragment(),t.push(i)),i.lines.push(n),i.isQuote=i.isQuote||s}return t},_getFragmentText:function(e){var t,a,i="";if(e.isQuote){var r=this._generatePlaceholderID();t='<div id="'+r+'" place="true"></div><p quote="collapsed" group="'+r+'">',a="</p>"}else t="",a="";for(var n=0;n<e.lines.length;++n)i+=e.lines[n]+"\n";return t+i+a},_joinPlainFragments:function(e){for(var t="",a=0;a<e.length;++a){var i=e[a];t+=this._getFragmentText(i)}return t},_parsePlain:function(e,t,a){var r,n=this._escapeHTMLEntities(e),s=this._createPlainFragments(n);try{r=this._joinPlainFragments(s);r=r.replace(/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gm,'<a mlink="true" href="$1">$1</a>')}catch(e){i.default.reportError(e),r="There was an error loading this message."}return{parsed:'<html><head></head><body style="white-space: pre-wrap;">'+r+"</body><html>"}},_parseHTML:function(e,t,a){var r={parsed:void 0},n=this._createDoc(e),s=this._findQuoteElements(n);if(s=this._cleanupDocQuotes(n,s,t),this._isFullQuote(n,s)||this._collapseAndMarkQuotes(n,s,!!a.collapseQuotes),a.createLinksFromText)try{this._createLinksFromText(n)}catch(e){i.default.reportError(e)}var o=this._findLinkElements(n);this._markLinks(o);try{r.specialLinks=this._findSpecialLinks(o,s,a)}catch(e){i.default.reportError(e)}try{r.parsedMetadata=this._parseMetadata(n)}catch(e){i.default.reportError(e)}try{var l=this._updateResourceImages(n,t);r.missingResourceData=l.missingResourceData}catch(e){i.default.reportError(e)}return this._trimTrailingWhitespace(n),this._trimQuoteWhitespace(s),r.parsed=n.body.outerHTML,r},_traverseNode:function(e,t){if(!1!==t(e))for(var a=e.childNodes.length-1;a>=0;a--)this._traverseNode(e.childNodes[a],t)},_sanitizeInputDoc:function(e,t){var a=o[t];e.body&&this._traverseNode(e.body,function(e){if(e.nodeType===Node.COMMENT_NODE){try{i.default.PAssert(2027,0===e.childNodes.length,"A comment node should never have children")}catch(e){i.default.reportError(e)}e.parentNode.removeChild(e)}else if(e.nodeType===Node.TEXT_NODE);else if(a.bannedTags.indexOf(e.tagName.toLowerCase())>=0)e.parentNode.removeChild(e);else if(e.attributes.length>0){for(var t=a.allowedTagAttributes[e.tagName],r=e.attributes.length-1;r>=0;r--){var n=e.attributes[r].name;if(a.allowedAttributes.indexOf(n)<0&&(!t||t.indexOf(n)<0))e.removeAttribute(n);else{var s=e.getAttribute(n);s&&s.startsWith("javascript:")&&(console.log("Remove Inline JS: ",e.tagName,n),e.removeAttribute(n))}}var o=e.getAttribute("height");o&&o.indexOf("%")>=0&&(e.removeAttribute("height"),console.log("Remove Height: ",e.tagName,o))}})},sanitizeContent:function(e){var t;if(e){var a=this._createDoc(e);try{this._traverseNode(a.body,function(e){e.nodeType===Node.TEXT_NODE?e.textContent=new Array(e.textContent.length+1).join("#"):"A"===e.nodeName&&e.removeAttribute("href")}),t=a.body.outerHTML}catch(e){i.default.reportError(e),t="<<SANITIZED>>"}}else t="<<NO HTML CONTENT>>";return t},sanitizePlaintext:function(e){return e?i.default.isWhiteSpace(e)?"":"<<NonHTML-Sanitized: "+e.length+">>":"<<NO CONTENT>>"},getComposeBody:function(e,t){var a=!1;try{var r=this._createDoc(e);if(r){a=this._removeElementsByAttribute(r,"moodoAttach","true");var n=this._updateResourceImages(r,t);a=a||n.didUpdate}}catch(e){i.default.reportError(e)}return a?r.body.outerHTML:e},_createDoc:function(e){var t,a=new DOMParser;try{if(t=a.parseFromString(e,"text/html")){var r=this._parseJSONLD(t);this._sanitizeInputDoc(t,"Default"),r&&r.length>0&&this._reportMetadata(t,r)}}catch(e){i.default.reportError(e);try{t=a.parseFromString("Error parsing email message","text/html")}catch(e){i.default.reportError(e)}}return t},_updateResourceImages:function(e,t){for(var a={missingData:!1,didUpdate:!1},i=this._findImageElements(e),r=0;r<i.length;++r){var n=i[r];if(n.src.startsWith("cid:")){var s=n.src.substr(4);if(s){n.setAttribute("cid",s);var o=t.getByCID(s);if(o&&o.data){var l="data:"+o.mimeType+";base64,"+o.data;n.src=l,a.didUpdate=!0}else n.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",a.didUpdate=!0,o||(a.missingData=!0)}else n.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",a.didUpdate=!0}}return a},_findImageElements:function(e){return e.querySelectorAll("img")},_findLinkElements:function(e){return Array.prototype.slice.call(e.querySelectorAll("a"))},_sanitizeLink:function(e){if(e&&e.hasAttribute("href")){e.setAttribute("mlink",!0);var t=e.getAttribute("href");if(t.startsWith("file:"))e.setAttribute("href","");else n.exec(t)||e.setAttribute("href","https://"+t)}},_createLinksFromText:function(e){this._traverseNode(e.body,function(t){var a=!0;if(t.nodeType===Node.TEXT_NODE){var i=t.textContent;if(i.indexOf("http")>=0||i.indexOf("www.")>=0){var r=/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gm,n=t.textContent.replace(r,'<a href="$1">$1</a>'),s=e.createElement("div");s.innerHTML=n;var o=s.childNodes.length;if(o>1||1===o&&"A"===s.childNodes[0].tagName){for(;s.firstChild;)t.parentNode.insertBefore(s.firstChild,t);t.parentNode.removeChild(t)}}}else"A"===t.tagName&&(a=!1);return a})},_markLinks:function(e){for(var t=0;t<e.length;++t)this._sanitizeLink(e[t])},_isAttachmentURL:function(e){return!!/^https:\/\/drive.google.com\/file\/d\/.*\/view/g.exec(e)},_findSpecialLinks:function(e,t,a){for(var i={unsubscribe:[],twitter:[],attachments:[]},r=0;r<e.length;++r){var n=e[r];n.href&&this._isAttachmentURL(n.href)&&(a.ignoreQuotedAttachments&&this._isInsideQuote(n,t)||i.attachments.push({href:n.href,cid:n.id,name:n.innerText,type:"application/octet-stream"}))}return i},_parseMetadata:function(e){var t=this._parseMicrodata(e);return t&&t.length>0&&this._reportMetadata(e,t),t},_reportMetadata:function(e,t){i.default.reportError("Metadata Schemas Found: ",t)},_parseJSONLD:function(e){for(var t=[],a=e.getElementsByTagName("script"),r=0;r<a.length;++r){var n=a[r];if("application/ld+json"===n.getAttribute("type")){var s=n.innerText.trim();if(s)try{var o=JSON.parse(s);t.push(o)}catch(e){i.default.reportError(new Error("Invalid JSONLD Schema String"),s)}}}return t},_parseMicrodata:function(e){var t=e.querySelectorAll("[itemscope]");return Array.prototype.map.call(t,function(e){if(!e.hasAttribute("itemprop"))return this._parseMicrodataScope(e)}.bind(this)).filter(function(e){return!!e})},_parseMicrodataScope:function(e){var t={type:e.getAttribute("itemtype"),properties:{}};return this._recurseMicrodataScope(t,e),t},_recurseMicrodataScope:function(e,t){for(var a=0;a<t.children.length;++a){var i=t.children[a];if(i.hasAttribute("itemprop")){var r,n=i.getAttribute("itemprop");if(i.hasAttribute("itemscope"))r=this._parseMicrodataScope(i);else switch(i.tagName.toLowerCase()){case"a":case"area":case"link":r=i.getAttribute("href");break;case"meta":r=i.getAttribute("content");break;case"img":r=i.getAttribute("src");break;case"data":case"meter":r=i.getAttribute("value");break;case"time":r=i.getAttribute("datetime");break;default:r=i.hasAttribute("content")?i.getAttribute("content"):i.textContent}n&&r&&(e.properties[n]=r)}else this._recurseMicrodataScope(e,i)}},_cleanupDocQuotes:function(e,t,a){return t.filter(function(e){var t=!1;"BLOCKQUOTE"===e.nodeName&&"cite"===e.getAttribute("type")&&(function(e){var t;r.lastIndex=0;var a=r.exec(e);return a&&a[1]&&(t=a[1]),t}(e.innerText)&&e&&e.parentNode&&(e.parentNode.removeChild(e),t=!0));return!t})},_generatePlaceholderID:function(){return i.default.generateTempId()},_createQuotePlaceholder:function(e){var t=e.createElement("div");return t.id=this._generatePlaceholderID(),t.setAttribute("place",!0),t},_findFirstSiblingQuote:function(e,t){for(var a=e;a.previousElementSibling&&t.indexOf(a.previousElementSibling)>=0;)a=a.previousElementSibling;return a},_markAdjacentQuotes:function(e,t,a,i){for(;e&&a.indexOf(e)>=0;)e.setAttribute("quote",i),e.setAttribute("group",t),e=e.nextElementSibling},_collapseAndMarkQuotes:function(e,t,a){for(var i=0;i<t.length;++i){var r=t[i];if(!r.getAttribute("quote")){var n=this._findFirstSiblingQuote(r,t),s=this._createQuotePlaceholder(e),o=0===i&&a?"collapsed":"uncollapsed";this._markAdjacentQuotes(n,s.id,t,o),n.parentNode.insertBefore(s,r)}}},_removeQuote:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},_removeQuotes:function(e,t){for(var a=0;a<t.length;++a)this._removeQuote(t[a])},_isFullQuote:function(e,t){for(var a=!0,i=0;i<e.body.childNodes.length;++i){var r=e.body.childNodes[i];if(""!==r.textContent.trim()&&t.indexOf(r)<0&&t.indexOf(r.firstElementChild)<0){a=!1;break}}return a},_findQuoteElements:function(e){var t=this._findGmailQuotes(e),a=this._findOffice365Quotes(e),i=this._findBlockquoteQuotes(e),r=[];return r.pushOnlyUniques(t),r.pushOnlyUniques(a),r.pushOnlyUniques(i),r=this._cleanupGmail(r),r=this._removeEmptyQuotes(r)},_cleanupGmail:function(e){return e.filter(function(t){var a=!1;if("BLOCKQUOTE"===t.nodeName&&i.default.hasClass(t,"gmail_quote"))for(var r=0;r<e.length;++r)for(var n=t.parentNode;n;){if(i.default.hasClass(n,"gmail_quote")){"DIV"===n.nodeName&&(a=!0);break}n=n.parentNode}return!a})},_removeEmptyQuotes:function(e){return e},_findGmailQuotes:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_quote"))},_findOffice365Quotes:function(e){var t=Array.prototype.slice.call(e.querySelectorAll("#divRplyFwdMsg, #OLK_SRC_BODY_SECTION")),a=e.getElementById('3D"divRplyFwdMsg"');return a&&t.push(a),t=t.map(function(e){return e.previousElementSibling&&"HR"===e.previousElementSibling.nodeName?e.parentElement:e})},_findBlockquoteQuotes:function(e){return Array.prototype.slice.call(e.querySelectorAll("blockquote"))},_findGmailSignatures:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_signature"))},_findActiveSignature:function(e){for(var t,a=this._findGmailSignatures(e),r=this._findQuoteElements(e),n=a.length-1;n>=0&&!t;n--){for(var s=a[n],o=!0,l=0;l<r.length;++l)if(i.default.isAncestor(s,r[l])){o=!1;break}o&&(t=s)}return t},_trimTrailingWhitespace:function(e){for(var t=e.body.childNodes,a=[],i=t.length-1;i>=0;i--){var r=t[i],n=t[i-1];if(!r||"BR"!==r.nodeName||!n||"BR"!==n.nodeName)break;a.push(r)}this._removeElements(a)},_trimQuoteWhitespace:function(e){for(var t=[],a=0;a<e.length;++a)for(var i=e[a].previousElementSibling;i;)"BR"===i.nodeName&&i.previousElementSibling&&"BR"===i.previousElementSibling.nodeName&&t.push(i),i=i.previousElementSibling;this._removeElements(t)},_removeElements:function(e){for(var t=0;t<e.length;++t){var a=e[t];try{a.parentNode&&a.parentNode.removeChild(a)}catch(e){}}},_isInsideQuote:function(e,t){for(;e.parentNode;){if(t.indexOf(e.parentNode)>=0)return!0;e=e.parentNode}return!1}},t.a=new s},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(1),s=a(7),o=a(15),l=a(17),d=a(45),c=a(130),u=a(27),h=a(9),f=a(131),p=a(14),m=a(132),g=a(39),v=[1,5,20,40,80,170],y=[n.a.HTTPStatusCode.Network,n.a.HTTPStatusCode.Timeout,n.a.HTTPStatusCode.TooMany,n.a.HTTPStatusCode.ServerError,n.a.HTTPStatusCode.BadGateway,n.a.HTTPStatusCode.Unavailable,n.a.HTTPStatusCode.GatewayTimeout,null],S=[n.a.HTTPStatusCode.Forbidden,n.a.HTTPStatusCode.TooMany],E={};function P(e,t){try{i.default.PAssert(2271,e,"Must supply a valid id")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2272,t,"Must supply a valid name")}catch(e){i.default.reportError(e)}this.id=e,this.name=t,this.DefaultRequestTimeout=i.default.seconds(15),this.LongWaitThreshold=i.default.seconds(7),this._previewCache="p_"+e,this._offlineCache="ocache_"+e,this._paneType="Pane"+e,this._rootId=e+"Root",this._acProviderId="AC"+e,this._settingsGroup="plugin"+this.id,this.loadedEvent="Plugin_"+e+"_Loaded",this.pluginMargin=12,this.pluginPadding=24,this.isActiveObs=new h.a(!1),this._isReady=!1,this._hasDeactivated=!1,this._propertyDescriptors={},this._propertySets={},this._registeredAutocomplete=!1,this._attachKeys=[],this._attachCache={},this._dataKeys=[],this._dataCache={},this._scorchOfflineCache=!1,this._defaultItemStore=void 0,this._activeItemStore={},this._defaultZoomItems={},this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._isRateLimited=!1,this._lastRateLimitTime=void 0,this._numLongWaitRequests=0,this._numSendRequests=0,this._numHandledRequests=0,this._totalRequestSendTime=0,this._totalRequestHandleTime=0,this._activeAttachments=[],this._numActivePanes=0,this._requestCounter=0,this._unloadedDependencies=this.getDependencies(),this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._loadedInitialData=!1,this._hasLoadedCaches=!1,this._hasServicedPreviewCache=!1,this._registeredCaches={},this._registeredModals={},this._createdModals={},this._recurringTasks=[],this._lowImpactTasks={},this._batchedResponses={},this.Settings={},window.PluginSettingsID[this.id]={},r.a.forceBind("_retryRemoteRequest",this),r.a.forceBind("_onGoogleAuthorized",this),r.a.forceBind("_reqSortFn",this),i.default.settings.registerGroup(this._settingsGroup),this.registerSetting("IsEnabled","isEnabled",!0,!1,!this._isBuiltin),this.getDataPane()&&d.a.registerPaneType(this,this._paneType,this.name,this.getDataPane(),this.getPaneIcon(),this.getPanePriority()),this.onSettingChanged(this.Settings.IsEnabled,function(e,t){t&&i.default.vmMain.pluginManager.activatePlugin(this)}.bind(this))}E[PluginDependency.DemoMode]={online:!1},E[PluginDependency.GoogleLogin]={online:!0},E[PluginDependency.PremiumSub]={online:!1},E[PluginDependency.EarlyAccess]={online:!1},E[PluginDependency.LocalLoaded]={online:!1},P.prototype={getType:function(){return n.a.PluginType.Unknown},sendEvent:function(e,t){return i.default.sendEvent(this.id,e,t)},getSetting:function(e){return i.default.settings.get(e,this._settingsGroup)},setSetting:function(e,t){return i.default.settings.set(e,t,this._settingsGroup)},onAuthorizedSetting:function(e,t){},registerSetting:function(e,t,a,r,n){window.PluginSettingsID[this.id][e]=t,this.Settings[e]=t,i.default.settings.registerSetting(t,this._settingsGroup,a,r),n&&i.default.settings.registerAPIServerNotification(t,this._settingsGroup),s.a.addDefaultSkipSetting(t,this._settingsGroup)},onSettingChanged:function(e,t){i.default.settings.registerForChangeNotification(e,this._settingsGroup,t)},getCacheStats:function(e){var t={};if(this.supportOfflineCache()&&i.default.shouldWriteLocal()){var a={},n=r.a.storage.getItem(this.getOfflineCacheName());if(n){a.size=n.length;try{var s=JSON.parse(n);if(s){a.props=s.props;var o=s.data;a.count=Object.keys(o).length}}catch(e){i.default.reportError(e)}}t.Offline=a}var l=Object.keys(this._registeredCaches).length,d=0;if(l>0)for(var c in this._registeredCaches){this._registeredCaches[c].getStats(function(a){t[a.id]=a,l===++d&&e(t)})}else e()},getCacheState:function(){var e={};for(var t in this._registeredCaches){var a=this._registeredCaches[t];e[t]=a.getState()}return e},registerLocalCache:function(e,t,a,r){var n;n=a?this.id:this.id+"_"+e;var s=i.default.vmMain.cacheManager.registerLocalCache(n,e,t,r);return this._registeredCaches[n]=s,s},registerDeferredTaskType:function(e,t,a,r){try{i.default.PAssert(2273,e,"Must specify a valid deferred task type")}catch(e){i.default.reportError(e)}i.default.vmMain.deferredTaskManager.registerTaskType(e,t,a,r)},scheduleDeferredTask:function(e,t,a,r){try{i.default.PAssert(2274,e,"Must supply a valid local ID for deferred task")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2275,t,"Must specify a valid deferred task type")}catch(e){i.default.reportError(e)}i.default.vmMain.deferredTaskManager.scheduleTask(e,t,a,!1,void 0,r)},cancelDeferredTask:function(e,t){i.default.vmMain.deferredTaskManager.cancelTask(e,t)},createRecurringTask:function(e,t){var a=this.id+"_"+e;return this._recurringTasks.push(e),i.default.vmMain.recurringTaskManager.createRecurringTask(a,t)},getRecurringTask:function(e){return i.default.vmMain.recurringTaskManager.getRecurringTask(this.id+"_"+e)},hasRecurringTask:function(e){return i.default.vmMain.recurringTaskManager.hasRecurringTask(this.id+"_"+e)},cancelRecurringTask:function(e){var t=this.id+"_"+e;return this._recurringTasks.remove(e),i.default.vmMain.recurringTaskManager.cancelRecurringTask(t)},cancelRecurringTasks:function(){for(;this._recurringTasks.length>0;)this.cancelRecurringTask(this._recurringTasks[0])},getRecurringStats:function(){for(var e={},t=0;t<this._recurringTasks.length;++t){var a=this._recurringTasks[t],i=this.getRecurringTask(a);e[a]=i.getStats()}return e},registerLowImpactTask:function(e,t){try{i.default.PAssert(2276,!this._lowImpactTasks[e],"Must specify different IDs for each task: ",e)}catch(e){i.default.reportError(e)}var a=new f.a(t);return this._lowImpactTasks[e]=a,a},getLowImpactStats:function(){var e={};for(var t in this._lowImpactTasks){var a=this._lowImpactTasks[t];e[t]=a.getStats()}return e},getTrackedStat:function(e){0},addTrackedStat:function(e){0},reportTrackedStat:function(e){0},getStats:function(){return{fnCalls:void 0,tracked:void 0,remoteReqs:void 0,numItems:this._defaultItemStore?this._defaultItemStore.getCount():-1,activeAttachments:this._activeAttachments.length,numAttach:this._attachKeys.length,numDataCache:this._dataKeys.length,numSendRequests:this._numSendRequests,numHandledRequests:this._numHandledRequests,numLongWaitRequests:this._numLongWaitRequests,avgRequestSendTime:this._totalRequestSendTime/this._numSendRequests,avgRequestHandleTime:this._totalRequestHandleTime/this._numHandledRequests,lowImpact:this.getLowImpactStats(),recurring:this.getRecurringStats()}},getState:function(){return{isActive:this.isActiveObs.get(),isReady:this._isReady,isRateLimited:this._isRateLimited,hasDeactivated:this._hasDeactivated,scorchedCaches:this._scorchOfflineCache,numOutstandingReqs:this._numOutstandingReqs,numPendingReqs:this._pendingRequests.length,numActivePanes:this._numActivePanes,unloadedDeps:this._unloadedDependencies,isFirstLoad:this._isFirstLoad,hasRunOfflineLoad:this._hasRunOfflineLoad,loadedInitialData:this._loadedInitialData,hasLoadedCaches:this._hasLoadedCaches,cacheState:this.getCacheState(),isPreviewCacheAvailable:this.isPreviewCacheAvailable(),hasServicedPreviewCache:this._hasServicedPreviewCache}},isPluginPane:function(e){return e.type===this._paneType},getPaneType:function(){return this._paneType},activate:function(e){if(!this.isActiveObs.get()){if(this.isActiveObs.set(!0),this.useItemStore()){this._defaultItemStore=i.default.vmMain.itemStoreManager.registerItemStore(this.id,this,this.itemStoreOptions());var t=this._defaultItemStore.createRoot(this._rootId,"");setTimeout(function(){this.isActive()&&t.setText(this.useItemStore(),!0,ChangeType.Auto)}.bind(this),0)}if(this._hasLoadedCaches||(this.usesPreviewCache()&&this.registerPreviewCache(),this.supportOfflineCache()&&i.default.shouldWriteLocal()&&this.loadOfflineCache(),this._hasLoadedCaches=!0),this.ensurePaneTypeIsActive(),this.registerAutocomplete(),this._unloadedDependencies)for(var a in e)this.onDependencyLoaded(a,e[a]);return this._unloadedDependencies||this.onAllDependenciesLoaded(),i.default.vmMain.pluginManager.fireEvent("pluginActiveChanged",this.id,"activated",[this,!0]),this._activate&&this._activate(),!0}return!1},deactivate:function(){try{i.default.PAssert(2279,this.isActiveObs.get(),"Must be active in order to deactivate pane")}catch(e){i.default.reportError(e)}return this.isActiveObs.set(!1),i.default.vmMain.pluginManager.fireEvent("pluginActiveChanged",this.id,"deactivated",[this,!1]),this.unregisterAutocomplete(),this.getDataPane()&&i.default.vmMain.paneFactory.deactivatePaneType(this._paneType),this.useItemStore()&&(i.default.vmMain.itemStoreManager.unregisterItemStore(this.id),this._defaultItemStore=void 0),this.cancelRecurringTasks(),this._loadedInitialData=!1,this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._hasDeactivated=!0,this._deactivate&&this._deactivate(),!0},ensurePaneTypeIsActive:function(){(!this.hasDependency(PluginDependency.PremiumSub)||i.default.billingManager.hasPremiumFeatures())&&this.getDataPane()&&!d.a.isPaneTypeActive(this._paneType)&&(this.getSetting(this.Settings.IsEnabled)||i.default.isDemoMode())&&d.a.activatePaneType(this._paneType)},isActive:function(){return this.isActiveObs.get()},isReady:function(){return this._isReady},isEnabled:function(){return i.default.isDemoMode()||this.isAvailable()&&this.getSetting(this.Settings.IsEnabled)},isAvailable:function(){var e=!1,t=this.hasDependency(PluginDependency.EarlyAccess),a=this.hasDependency(PluginDependency.PremiumSub);try{i.default.PAssert(2280,!a||!t,"Must not require both early access and premium sub: "+this.id)}catch(e){i.default.reportError(e)}var r=i.default.billingManager.hasEarlyAccess(),n=i.default.billingManager.hasPremiumFeatures();return t&&r?e=!0:a&&n?e=!0:t||a?i.default.isDemoMode()&&(e=!0):e=!0,e},hasSettingsError:function(){return!1},isCurrentlyAuthorized:function(e){return p.a.isCurrentlyAuthorized(e)},_onGoogleAuthorized:function(e){try{i.default.PAssert(2281,"me"===e||p.a.isCurrentlyAuthorized(e),"Must have a valid access token")}catch(e){i.default.reportError(e)}this.onAuthorized(e)},onAuthorized:function(e){this._pendingRequests.length>0&&i.default.vmMain.pluginManager.notifyHasPendingRemoteRequest()},verifyAuthorization:function(e){return p.a.isDefaultEmail(e)?p.a.verifyLinkedTokenScopes(e,this.googleScopes()):[]},notifyUnauthorized:function(e,t){},isOnline:function(){return i.default.vmMain.pluginManager.isOnline()},goOnline:function(){},goOffline:function(){},onDocumentShared:function(e){},onShutdown:function(){},onDependencyLoaded:function(e,t){if(this._unloadedDependencies){var a=this._unloadedDependencies.indexOf(e);if(a>=0&&(this.isDependencyLoaded(e,t)&&this._unloadedDependencies.removeAt(a),e===PluginDependency.PremiumSub&&this.ensurePaneTypeIsActive()),0===this._unloadedDependencies.length)this._unloadedDependencies=void 0,this.onAllDependenciesLoaded();else if(this.supportOfflineLoad()&&!this._hasRunOfflineLoad){for(var i=!1,r=0;r<this._unloadedDependencies.length;++r){var n=this._unloadedDependencies[r];E[n].online||(i=!0)}!i&&this.isActiveObs.get()&&this.offlineLoad()}}},onAllDependenciesLoaded:function(){this.isActiveObs.get()&&setTimeout(function(){this._isReady=!0,this._updateAttachmentStates(),this.offlineLoad(),this.load()}.bind(this),0)},areDependenciesLoaded:function(){return void 0===this._unloadedDependencies},hasDependencyBeenLoaded:function(e){var t=!1;return this.hasDependency(e)&&(this.getUnloadedDependencies()?this.getUnloadedDependencies().indexOf(e)<0&&(t=!0):t=!0),t},isDependencyLoaded:function(e,t){return!0},getUnloadedDependencies:function(){return this._unloadedDependencies},loadRemoteAPIs:function(e,t){e&&e()},areRemoteAPIsLoaded:function(){return!0},forceLoad:function(){this._loadedInitialData=!1,this.activate(),this._unloadedDependencies&&(this._unloadedDependencies=void 0,this.onAllDependenciesLoaded())},authorize:function(e,t){try{i.default.PAssert(2282,t&&i.default.isFunction(t),"Must provide a valid authoirzation callback")}catch(e){i.default.reportError(e)}this.googleScopes()?this._authorizeGoogle(e,t):t(!0)},_authorizeGoogle:function(e,t){try{i.default.PAssert(2283,this.googleScopes(),"Must have a valid google scope to request")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2284,t&&i.default.isFunction(t),"Must provide a valid authoirzation callback")}catch(e){i.default.reportError(e)}e?o.a.runAuthenticateOffline(this.googleScopes(),function(e){t(e&&!e.error)}):o.a.runAuthenticate(this.googleScopes(),!1,!1,function(e){t(e&&!e.error)})},googleScopes:function(){},getDependencies:function(){},hasDependency:function(e){var t=this.getDependencies();return!!t&&t.indexOf(e)>=0},getOfflineCacheName:function(){return this._offlineCache},loadOfflineCache:function(){try{i.default.PAssert(2285,0===this._dataKeys.length,"Must have no data already loaded")}catch(e){i.default.reportError(e)}if(this.supportOfflineCache()&&i.default.shouldWriteLocal()){var e=r.a.storage.getItem(this.getOfflineCacheName());if(e)try{var t=JSON.parse(e);t&&this.loadDataFromObject(t)}catch(e){i.default.reportError(e)}else 0}},loadDataFromObject:function(e){try{i.default.PAssert(2286,e,"Must provide a valid dataset to load")}catch(e){i.default.reportError(e)}e.props;var t=e.data;try{i.default.PAssert(2287,t,"Load object must contain valid data")}catch(e){i.default.reportError(e)}this._dataKeys=Object.keys(t);for(var a=0;a<this._dataKeys.length;++a){var r=this._dataKeys[a];this._dataCache[r]=this.createEntryFromLocal(r,t[r]),this._dataCache[r].id=r}},saveOfflineCache:function(){if(this.supportOfflineCache()&&i.default.shouldWriteLocal())if(this._scorchOfflineCache)0;else{for(var e=0,t={},a=0;a<this._activeAttachments.length;++a){var n=this._activeAttachments[a];try{i.default.PAssert(2288,n.isInUse(),"Attachments in the active list should always be in use")}catch(e){i.default.reportError(e)}if(n.isInUse()){var s=this.serializeEntry(n.id);s&&(t[n.id]=s,e++)}}var o={data:t,info:{writeDate:Date.now(),entries:e}};try{var l=JSON.stringify(o);0,r.a.storage.setItem(this.getOfflineCacheName(),l)}catch(e){i.default.reportError(e)}}},clearOfflineCache:function(e){this.supportOfflineCache()&&i.default.shouldWriteLocal()&&(r.a.storage.removeItem(this.getOfflineCacheName()),e&&(this._scorchOfflineCache=!0))},supportOfflineLoad:function(){return!1},supportOfflineCache:function(){return!1},createEntryFromLocal:function(e,t){try{i.default.PAssert(2289,!1,"SubClass must override")}catch(e){i.default.reportError(e)}},clearData:function(){for(var e=0;e<this._attachKeys.length;++e)this._attachCache[this._attachKeys[e]].unload();this._attachKeys=[],this._attachCache={},this._dataKeys=[],this._dataCache={},this.useItemStore()&&(this.getDefaultItemStore().clearStore(),this._activeItemStore={}),this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._activeAttachments=[]},onCacheLimitExceeded:function(){for(var e in this._registeredCaches){var t=this._registeredCaches[e];t.usesDiskSpace()&&t.clearCache()}},changeID:function(e,t,a){try{i.default.PAssert(2290,t!==a,"Should never be switching to the same ID")}catch(e){i.default.reportError(e)}if(this._attachCache[a])e.delayChangeID(a),this._attachCache[t]=void 0,this._attachKeys.remove(t),this._dataCache[t]=void 0,this._dataKeys.remove(t);else{var r=this._attachCache[t];try{i.default.PAssert(2291,e===r,"Attach entries must match")}catch(e){i.default.reportError(e)}r&&(this._attachCache[t]=void 0,this._attachCache[a]=r,this._attachKeys.remove(t),this._attachKeys.push(a));var n=this._dataCache[t];if(this._dataCache[t]=void 0,n)n.id===t&&(n.id=a),this._dataCache[a]=n,this._dataKeys.remove(t),this._dataKeys.push(a);else try{i.default.PAssert(2292,this._dataKeys.indexOf(a)>=0,"Should have already changed the ID")}catch(e){i.default.reportError(e)}var s=e.isLocalOnlyAttachment();e.changeID(a),e.isInUse()&&s&&this.notifyAttachmentUpdated(e)}},_isPreviewData:function(e){for(var t=this.getPropertySet(PluginLoad.Preview),a=0;a<t.length;++a){if(!this.getPropertyDescriptor(t[a]).isOpt&&!e.hasOwnProperty(t[a]))return!1}return!0},_isFullData:function(e){for(var t=this.getPropertySet(PluginLoad.Full),a=0;a<t.length;++a){if(!this.getPropertyDescriptor(t[a]).isOpt&&!e.hasOwnProperty(t[a]))return!1}return!0},_addPreviewEntry:function(e,t){var a=this.createEntryFromLocal(e,t);return this.cacheData(e,a),a},cacheData:function(e,t,a,r,n){try{i.default.PAssert(2293,e,"Must supply a valid key for data")}catch(e){i.default.reportError(e)}var s=this._dataCache[e];if(this._dataCache[e]=t,s||this._dataKeys.push(e),this._attachCache[e]){var o=this._attachCache[e],l=this._getPluginLoadType(t);try{i.default.PAssert(2295,l,"Must either contain valid preview or full data")}catch(e){i.default.reportError(e)}o.notifyDataLoaded(l,a,r,n)}},getCacheData:function(e){return this._dataCache[e]},_attachMetadataFields:function(){},fieldsHaveParseEffect:function(e){var t=!1;if(e){var a=this._attachMetadataFields();if(a){for(var i=0;i<e.length;++i)if(a.indexOf(e[i])<0){t=!0;break}}else t=!0}else t=!0;return t},isFieldDefined:function(e){return!!this.getPropertyDescriptor(e)},hasAttachField:function(e,t){var a=!1,r=this._dataCache[e.id];if(r&&r.hasOwnProperty(t))a=!0;else{var n=this.getPropertyDescriptor(t);try{i.default.PAssert(2297,n,"Must have a valid field descriptor",t)}catch(e){i.default.reportError(e)}if(n&&n.isOpt)a=!0;else{var s=e.getInlineData();s&&s.hasOwnProperty(t)&&(a=!0)}}return a},getAttachField:function(e,t){var a,r=this._dataCache[e.id];if(r&&r.hasOwnProperty(t))a=r[t];else{var n=this.getPropertyDescriptor(t);try{i.default.PAssert(2298,n,"Must have a valid field descriptor",t)}catch(e){i.default.reportError(e)}var s=e.getInlineData();if(s&&s.hasOwnProperty(t))a=s[t];else{try{i.default.PAssert(2299,!n||n.isOpt,"Field must be optional if it is not defined",t)}catch(e){i.default.reportError(e)}a=n?n.defaultValue:void 0}}return a},updateAttachField:function(e,t,a){var r=!1;try{i.default.PAssert(2300,this.isFieldDefined(t),"Must be updating a valid attachment field")}catch(e){i.default.reportError(e)}var n=this._dataCache[e.id];try{i.default.PAssert(2301,n,"Invalid field request: ",this.id,t)}catch(e){i.default.reportError(e)}n&&(this.dataFieldNeedsWrite(n,t,a)&&(n[t]=a,this.cacheData(e.id,n,!0,[t])),r=!0);var s=e.getInlineData();if(s&&s.hasOwnProperty(t))try{i.default.PAssert(2304,s[t]===a,"Should never change inline field value")}catch(e){i.default.reportError(e)}return r},isAttachFieldDefault:function(e,t){var a=!1,r=this._dataCache[e.id];try{i.default.PAssert(2305,r,"Invalid field request: ",this.id,t)}catch(e){i.default.reportError(e)}if(r){var n=this.getPropertyDescriptor(t);try{i.default.PAssert(2306,n,"Must have a valid field descriptor",t)}catch(e){i.default.reportError(e)}r.hasOwnProperty(t)?n&&n.isOpt&&n.defaultValue===r[t]&&(a=!0):n&&n.isOpt&&(a=!0)}return a},fieldNeedsWrite:function(e,t,a){var r=this._dataCache[e.id];try{i.default.PAssert(2307,r,"Invalid field request: ",this.id,t)}catch(e){i.default.reportError(e)}return this.dataFieldNeedsWrite(r,t,a)},dataFieldNeedsWrite:function(e,t,a){var r=!1;if(e){var n=this.getPropertyDescriptor(t);try{i.default.PAssert(2308,n,"Must have a valid field descriptor",t)}catch(e){i.default.reportError(e)}var s=this.compactCacheField(e,t);e.hasOwnProperty(t)?void 0===a&&s===n.defaultValue||(n&&n.comparator?n.comparator(s,a)||(r=!0):s!==a?r=!0:(i.default.isObject(s)||i.default.isObject(a)||i.default.isArray(s)||i.default.isArray(a))&&(r=!0)):void 0!==a&&(n&&n.isOpt&&n.defaultValue===a||(r=!0))}return r},hasCacheData:function(e){return!!this._dataCache[e]},findCachedItemsByField:function(e,t,a){for(var i=[],r=0;r<this._dataKeys.length;r++){var n=this._dataCache[this._dataKeys[r]];if(n[e]===t&&(i.push(n),i.length>=a))break}return i},findCachedItemsByFn:function(e,t){try{i.default.PAssert(2309,e,"Must supply a valid match function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2310,i.default.isFunction(e),"Match function must be a valid function")}catch(e){i.default.reportError(e)}for(var a=[],r=0;r<this._dataKeys.length;r++){var n=this._dataCache[this._dataKeys[r]];if(e(n)&&(a.push(n),a.length>=t))break}return a},notifyAttachmentInUse:function(e,t){try{i.default.PAssert(2311,this._activeAttachments.indexOf(e)<0,"Attachment should not already be active")}catch(e){i.default.reportError(e)}this._activeAttachments.push(e),i.default.isLocalChange(t)&&this.usesPreviewCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.writeAttachmentToPreviewCache(e)},notifyAttachmentUpdated:function(e){this.usesPreviewCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.writeAttachmentToPreviewCache(e)},notifyAttachmentUnused:function(e,t){try{i.default.PAssert(2312,this._activeAttachments.indexOf(e)>=0,"Attachment should be marked active")}catch(e){i.default.reportError(e)}this._activeAttachments.remove(e),i.default.isLocalChange(t)&&this.usesPreviewCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.updatePreviewCache(e.id,void 0)},notifyItemTextChanged:function(e,t,a){},notifyItemPropertyChanged:function(e,t,a){},getAttachment:function(e,t){try{i.default.PAssert(2313,e,"Must provide a valid key")}catch(e){i.default.reportError(e)}return e&&!this._attachCache[e]&&(this._attachCache[e]=this._requestAttachment(e,t),this._attachKeys.push(e)),this._attachCache[e]},hasAttachment:function(e){return!!this._attachCache[e]},forEachActiveAttachment:function(e){for(var t=0;t<this._activeAttachments.length;++t)e(this._activeAttachments[t])},forEachAttachment:function(e){for(var t=0;t<this._attachKeys.length;++t)e(this._attachCache[this._attachKeys[t]])},numActiveAttachments:function(){return this._activeAttachments.length},getAttachmentExportString:function(e){for(var t=window.EmbedAttachChar+"p:"+this.id+",id:"+e.id,a=this.getPropertySet(PluginLoad.Inline),r=0;r<a.length;++r){var n=a[r],s=e.getField(n);try{i.default.PAssert(2314,s&&s.indexOf(":")<0&&s.indexOf(" ")<0,"Property value is invalid: "+n+", "+s)}catch(e){i.default.reportError(e)}t+=","+n+":"+s}return t+=window.EmbedAttachChar},getAttachmentEmbedString:function(e){return this._getTextForItem(e)},getAttachmentTitleString:function(e){return this.getUnstyledText(e)},_getTextForItem:function(e){try{i.default.PAssert(2315,e,"Must pass in a valid item to get text for")}catch(e){i.default.reportError(e)}return window.EmbedAttachChar+"p:"+this.id+",id:"+e.id+window.EmbedAttachChar},_requestAttachment:function(e,t){try{i.default.PAssert(2316,e,"Must provide a valid key")}catch(e){i.default.reportError(e)}return new c.a(this,e,t)},releaseAttachment:function(e){},registerPreviewCache:function(){var e=l.a.ensureCache(this._previewCache);l.a.requestNotifyWhenAvailable(this.serviceRemoteRequestsFromPreview.bind(this)),e||l.a.requestNotifyWhenAvailable(this.writeActiveAttachmentsToPreviewCache.bind(this))},isPreviewCacheAvailable:function(){return l.a.isCacheAvailable(this._previewCache)},updatePreviewCache:function(e,t){try{i.default.PAssert(2317,i.default.isString(e),"Key must be a valid string")}catch(e){i.default.reportError(e)}return l.a.updateCache(this._previewCache,e,t)},queryPreviewCache:function(e){try{i.default.PAssert(2318,i.default.isString(e),"Key must be a valid string")}catch(e){i.default.reportError(e)}return l.a.queryCache(this._previewCache,e)},onPreviewCacheChange:function(e,t,a){switch(e){case DataChangeType.Add:case DataChangeType.Remove:case DataChangeType.Change:break;default:try{i.default.PAssert(2319,!1,"Invalid or unhandled DataChangeType: ",e)}catch(e){i.default.reportError(e)}}log("Preview Cache Change: ",arguments)},writeActiveAttachmentsToPreviewCache:function(){l.a.ensureCache(this._previewCache);for(var e=0;e<this._activeAttachments.length;++e){var t=this._activeAttachments[e];t.isLoaded()&&!t.isLocalOnlyAttachment()&&this.writeAttachmentToPreviewCache(t)}},writeAttachmentToPreviewCache:function(e){try{i.default.PAssert(2320,e.isLoaded(),"Attachments should have data before saving them")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2321,!e.isLocalOnlyAttachment(),"Should never write a local-only attachment to the preview cache")}catch(e){i.default.reportError(e)}var t=!1,a=this.getPropertySet(PluginLoad.Preview);if(this.isPreviewCacheAvailable()){var r=this.queryPreviewCache(e.id);t=!r;for(var n=0;!t&&n<a.length;++n){var s=a[n];e.fieldNeedsWrite(s,r[s])&&(t=!0)}}else 0;t&&this.updatePreviewCache(e.id,this.serializePreview(e))},dataHasChanged:function(e,t){for(var a=!e,i=this.getPropertySet(PluginLoad.Full),r=0;!a&&r<i.length;++r){var n=i[r];this.dataFieldNeedsWrite(e,n,t[n])&&(a=!0)}return a},getChangedFields:function(e,t){for(var a=[],i=this.getPropertySet(PluginLoad.Full),r=0;r<i.length;++r){var n=i[r];this.dataFieldNeedsWrite(e,n,t[n])&&a.push(n)}return a},serviceRemoteRequestsFromPreview:function(){for(var e=0;e<this._pendingRequests.length;++e){var t=this._pendingRequests[e];if(t.attach)for(var a=0;a<t.attach.length;++a){(i=this.queryPreviewCache(t.attach[a].id))&&this._addPreviewEntry(t.attach[a].id,i)}}for(e=0;e<this._activeAttachments.length;++e){var i,r=this._activeAttachments[e];if(!r.isLoaded()&&!r.isLocalOnlyAttachment())(i=this.queryPreviewCache(r.id))&&this._addPreviewEntry(r.id,i)}this._hasServicedPreviewCache=!0},usesPreviewCache:function(){return!1},matchAttachment:function(e,t){try{i.default.PAssert(2322,!1,"SubClass must override")}catch(e){i.default.reportError(e)}},getStyledText:function(e){try{i.default.PAssert(2323,!1,"SubClass must override")}catch(e){i.default.reportError(e)}},getUnstyledText:function(e){try{i.default.PAssert(2324,!1,"SubClass must override")}catch(e){i.default.reportError(e)}},getBlockedText:function(e){return"Blocked"},useRenderer:function(e,t){var a,r=i.default.vmMain.pluginManager.useRenderer(e,t);switch(e){case PluginRenderTypes.StyledText:a="getStyledText";break;case PluginRenderTypes.UnstyledText:a="getUnstyledText";break;case PluginRenderTypes.Measure:a="getAttachMeasure";break;default:try{i.default.PAssert(2325,!1,"Unknown plugin renderer type")}catch(e){i.default.reportError(e)}}a&&(this[a]=r)},_getDisplayText:function(e,t,a){return this.isPluginBlocked()?this.getBlockedText(e,t,a):this.getStyledText(e,t,a)},createDisplayElement:function(e){var t=this.getAttachmentClass(e);try{i.default.PAssert(2326,i.default.isArray(t),"Must have a valid class list")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2327,t.indexOf("plugin")<0,"Should not already have plugin as a class")}catch(e){i.default.reportError(e)}t.push("plugin"),this.isPluginBlocked()&&t.push("blocked");var a=this._getDisplayText(e),r={attrs:{cls:t,plugin:this.id,"plugin-id":e.id},text:a},n=this.getAttachmentTooltip(e);return n&&(r.attrs["data-tooltip"]=n),r},measureAttachment:function(e,t){try{i.default.PAssert(2328,t&&t.attrs&&t.attrs["plugin-id"],"Must have a valid word style obj with attachment ID")}catch(e){i.default.reportError(e)}var a;if(t.attrs&&!t.attrs.isUnknown){var r=this.getAttachment(t.attrs["plugin-id"]);try{i.default.PAssert(2329,r,"Must have valid attachment to measure: ",t.attrs["plugin-id"])}catch(e){i.default.reportError(e)}a=this.isPluginBlocked()?u.a.measureWord(e,this.getBlockedText(r),t):this.getAttachMeasure(r,e,t)}else a=u.a.measureWord(e,"Unknown Plugin",t);if(t.attrs&&t.attrs.cls){var n=t.attrs.cls;a+=this.pluginMargin,n.indexOf("padB")>=0&&(a+=this.pluginMargin)}return a+=this.pluginPadding},getAttachmentClass:function(e){return""},getAttachmentTooltip:function(e){},isPluginBlocked:function(){var e=!1;return i.default.billingManager.hasPremiumFeatures()||!this.hasDependency(PluginDependency.PremiumSub)&&!this.hasDependency(PluginDependency.EarlyAccess)||(e=!0),e},_displayMissingProperties:function(e,t,a){var r=!1,n=this.getPropertySet(a);log("Displaying Missing Properties: ",e);for(var s=0;s<n.length;++s){this.getPropertyDescriptor(n[s]).isOpt||t.hasOwnProperty(n[s])||(log(" Missing Property: ",n[s]),r=!0)}try{i.default.PAssert(2330,r,"Must be missing props to run this")}catch(e){i.default.reportError(e)}},_getPluginLoadType:function(e){try{i.default.PAssert(2331,e,"Must be querying loaded data for load state with valid data")}catch(e){i.default.reportError(e)}var t=PluginLoad.None;return this._isPreviewData(e)&&(t|=PluginLoad.Preview,this._isFullData(e)&&(t|=PluginLoad.Full)),t},requestData:function(e,t){t=t||PluginLoad.Preview|PluginLoad.Full;var a,r=this.getCacheData(e.id);r?(a=this._getPluginLoadType(r),i.default.isFlagSet(a,t)?e.notifyDataLoaded(a,!1,void 0,ChangeType.Remote):(i.default.forEachFlagSet(t,function(t){this._displayMissingProperties(e.id,r,t)}.bind(this)),!e.isLocalOnlyAttachment()&&this.allowRemoteRequests()&&this._getRemoteAttachmentData(e,t))):e.isLocalOnlyAttachment()||(a=PluginLoad.None,this.isPreviewCacheAvailable()&&this._loadPreviewData(e,t),this.allowRemoteRequests()&&!i.default.isFlagSet(a,t)&&this._getRemoteAttachmentData(e,t))},_loadPreviewData:function(e,t){try{i.default.PAssert(2332,this.isPreviewCacheAvailable(),"Preview cache must always be available after gdata cb")}catch(e){i.default.reportError(e)}var a=!1,r=this.queryPreviewCache(e.id);return r&&(r=this.createEntryFromLocal(e.id,r),this.cacheData(e.id,r),loadState=this._getPluginLoadType(r),i.default.isFlagSet(loadState,t)&&e.notifyDataLoaded(loadState,!1,void 0,ChangeType.Remote),a=!0),a},_getRemoteAttachmentData:function(e,t){this.usesPreviewCache()&&!i.default.isDemoMode()?l.a.requestNotifyWhenAvailable(function(){this._loadPreviewData(e,t),this.getRemoteAttachmentData(e,t)}.bind(this)):this.getRemoteAttachmentData(e,t)},getRemoteAttachmentData:function(e,t){try{i.default.PAssert(2333,!1,"SubClass must override")}catch(e){i.default.reportError(e)}},_appendDupeRequest:function(e,t){try{i.default.PAssert(2334,e,"Must provide a valid queued request")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2335,t,"Must provide a valid duped request")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2336,!e.duped,"Must never use an already duped request as a dupe for another request")}catch(e){i.default.reportError(e)}t.attach&&(e.attach||(e.attach=[]),e.attach.pushOnlyUniques(t.attach)),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)},_areRequestFnsEqual:function(e,t){var a=!1;return e===t?a=!0:i.default.isArray(e)&&i.default.isArray(t)&&(a=e.equals(t)),a},_areRequestsEqual:function(e,t){try{i.default.PAssert(2337,e,"Must have a valid request A")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2338,t,"Must have a valid request B")}catch(e){i.default.reportError(e)}var a=!0;if(e.accountID!==t.accountID)a=!1;else if(e.forceNoDupe||t.forceNoDupe)a=!1;else if(e.id!==t.id&&this._areRequestFnsEqual(e.requestFn,t.requestFn))if(e.data===t.data)a=!0;else{for(var r in e.data){if(!e.data.hasOwnProperty(r)||!t.data.hasOwnProperty(r)){a=!1;break}if(e.data[r]!==t.data[r]){a=!1;break}}if(a)for(var n in t.data){if(!e.data.hasOwnProperty(n)||!t.data.hasOwnProperty(n)){a=!1;break}if(e.data[n]!==t.data[n]){a=!1;break}}}else a=!1;return a},_getDupeRequest:function(e){for(var t,a=0;!t&&a<this._outstandingRequests.length;++a)!this._outstandingRequests[a].duped&&this._areRequestsEqual(this._outstandingRequests[a],e)&&(t=this._outstandingRequests[a]);for(a=0;!t&&a<this._pendingRequests.length;++a)!this._pendingRequests[a].duped&&this._areRequestsEqual(this._pendingRequests[a],e)&&(t=this._pendingRequests[a]);return t},_combineRequest:function(e,t){try{i.default.PAssert(2339,e,"Must provide a valid queued request")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2340,t,"Must provide a valid combine request")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2341,!e.combined,"Must never use an already combined request as a target for another request")}catch(e){i.default.reportError(e)}e.data=i.default.mergeObjects(e.data,t.data),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)},_areRequestsCombinable:function(e,t){try{i.default.PAssert(2342,e,"Must have a valid request A")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2343,t,"Must have a valid request B")}catch(e){i.default.reportError(e)}var a=!1;return e.id!==t.id&&e.combinable&&t.combinable&&e.accountID===t.accountID&&this._areRequestFnsEqual(e.requestFn,t.requestFn)&&e.type===t.type&&(e.attach||t.attach?e.attach&&t.attach&&e.attach.equals(t.attach)&&(a=!0):a=!0),a},_getCombineRequest:function(e){var t;if(e.combinable)for(var a=0;!t&&a<this._pendingRequests.length;++a)!this._pendingRequests[a].combined&&this._areRequestsCombinable(this._pendingRequests[a],e)&&(t=this._pendingRequests[a]);return t},_handleBatchRequestResponse:function(e){this._numOutstandingReqs--;try{i.default.PAssert(2344,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(e){i.default.reportError(e)}},_handleRequestResponse:function(e,t){if(!t){this._numOutstandingReqs--;try{i.default.PAssert(2345,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(e){i.default.reportError(e)}}},_handleRequestTimeout:function(e){if(this._pendingRequests.indexOf(e)>=0){e.timedOut=!0;for(var t={error:{code:n.a.HTTPStatusCode.Network,message:"Internal request timeout"}},a=0;a<e.failureCB.length;++a)try{e.failureCB[a](t)}catch(e){i.default.reportError(e)}0,this._pendingRequests.remove(e)}},_queueRemoteRequestMulti:function(e,t,a,r,n,s,o,l){try{i.default.PAssert(2346,e,"Missing accountID parameter")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2347,!i.default.isArray(e),"Missing accountID paramter")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2348,!i.default.isFunction(e),"Missing accountID parameter")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2349,!l||void 0===l.accountID,"AccountID is specified as a separate param")}catch(e){i.default.reportError(e)}var d=l?i.default.clone(l):{};return d.accountID=e,this._queueRemoteRequest(t,a,r,n,s,o,d)},_computeTimeoutMS:function(e){var t=void 0;return e&&void 0!==e.timeoutMS&&(0===e.timeoutMS?t=this.DefaultRequestTimeout:e.timeoutMS>=1e3&&(t=e.timeoutMS)),t},_updateRequestTimeout:function(e){e.timeoutMS&&(this._clearRequestTimeout(e),e.timeout=setTimeout(this._handleRequestTimeout.bind(this,e),e.timeoutMS))},_clearRequestTimeout:function(e){e.timeout&&(clearTimeout(e.timeout),e.timeout=void 0)},_queueRemoteRequest:function(e,t,a,r,s,o,l){try{i.default.PAssert(2350,e&&i.default.isArray(e),"RequestFn must be a valid packed function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2351,t,"Must provide valid data for the request")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2353,a,"Must supply a callback for request success")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2354,i.default.isFunction(a),"Success callback must be a valid function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2355,r,"Must supply a callback for request failure")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2356,i.default.isFunction(r),"Failure callback must be a valid function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2357,o,"Request type must be specified")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2358,!l||!l.combinable,"Combinable is not currently a valid option. Do not use.")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2359,!s||!s.isLocalOnlyAttachment(),"Must either specify a valid remote attachment or none at all",s?s.id:"UNDEFINED")}catch(e){i.default.reportError(e)}var d={id:++this._requestCounter,plugin:this,attach:s?[s]:void 0,request:void 0,requestFn:e,data:t,successCB:[a],failureCB:[r],type:o,queueTime:Date.now(),sendTimes:[],handleTimes:[],handled:!1,failed:!1,duped:!1,canceled:!1,timedOut:!1,wasBatched:!1,batchID:void 0,batchRequestID:void 0,requestsBehind:this._pendingRequests.length,accountID:l&&l.accountID?l.accountID:p.a.getDefaultEmail(),combinable:l&&l.combinable,autoRetry:!l||void 0===l.autoRetry||l.autoRetry,timeoutMS:this._computeTimeoutMS(l),forceNoDupe:l&&l.forceNoDupe,priority:l&&l.priority?l.priority:n.a.RequestPriority.Default};d.autoRetry&&(d.numRetries=l&&l.numRetries?l.numRetries:2,d.currentRetries=0),this._updateRequestTimeout(d);var c=this._insertPendingRequest(d);d.priority>n.a.RequestPriority.Default&&log("Insert Index: ",c,this._pendingRequests.length,d),i.default.vmMain.pluginManager.notifyHasPendingRemoteRequest()},_insertPendingRequest:function(e){e.priority++;var t=this._pendingRequests.insertSorted(e,this._reqSortFn);return e.priority--,t},_reqSortFn:function(e,t){return e.priority===t.priority?0:e.priority<t.priority?-1:1},_queuePagedRemoteRequestMulti:function(e,t,a,r,n,s,o,l){try{i.default.PAssert(2360,e,"Missing accountID parameter")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2361,!i.default.isArray(e),"Missing accountID paramter")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2362,!i.default.isFunction(e),"Missing accountID parameter")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2363,!l||void 0===l.accountID,"AccountID is specified as a separate param")}catch(e){i.default.reportError(e)}var d=l?i.default.clone(l):{};return d.accountID=e,this._queuePagedRemoteRequest(t,a,r,n,s,o,d)},_queuePagedRemoteRequest:function(e,t,a,r,n,s,o){try{i.default.PAssert(2364,o,"Must supply a valid options param")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2365,!o.getAllPages||!o.maxPages,"Should only define either maxPages or getAllPages: ",o.getAllPages,o.maxPages)}catch(e){i.default.reportError(e)}o.maxPages=o.maxPages||1,o.getAllPages=o.getAllPages||!1,o.maxPageResults=o.maxPageResults||100,o.maxResults=o.maxResults||1/0,o.resultsField=o.resultsField||"items";var l=0,d=[],c=i.default.clone(t);c.maxResults=o.maxPageResults;var u=function(e){e[o.resultsField]?d.pushArray(e[o.resultsField]):e.items?d.pushArray(e.items):e.history&&d.pushArray(e.history),e.nextPageToken&&(o.getAllPages||o.maxPages>l)&&d.length<o.maxResults?f(e.nextPageToken):e.nextPageToken||e.nextSyncToken||e.historyId?a(d,t,e):a(d)},h=function(e){r(e,d)},f=function(t){t&&(c.pageToken=t),l++,this._queueRemoteRequest(e,c,u,h,void 0,s,o)}.bind(this);f()},_retryRemoteRequest:function(e,t){e.request=void 0,e.wasBatched=void 0,e.batchID=void 0,e.batchRequestID=void 0,setTimeout(function(){e.currentRetries=e.currentRetries?e.currentRetries+1:1,this._insertPendingRequest(e),i.default.vmMain.pluginManager.notifyHasPendingRemoteRequest()}.bind(this),this._getRetryDelay(e,t))},getNumOutstandingReqs:function(){return this._numOutstandingReqs},_pumpRequestQueue:function(e,t,a,r){try{i.default.PAssert(2366,this.areRemoteAPIsLoaded(),"Must have loaded remote APIs before pumping the request queue")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2367,!this.hasDependency(PluginDependency.GoogleLogin)||this.hasDependencyBeenLoaded(PluginDependency.GoogleLogin),"Must be authorized to make remote requests")}catch(e){i.default.reportError(e)}var s=0,o=0,l=0,d=0,c=0,u=0,h=0;try{i.default.PAssert(2368,this._numOutstandingReqs>=0,"Should never have fewer than zero outstanding requests")}catch(e){i.default.reportError(e)}var f,m=t;try{i.default.PAssert(2369,m>0,"Should never have more than max outstanding requests for a given plugin")}catch(e){i.default.reportError(e)}m>1&&this._pendingRequests.length>1&&(f=this.createBatch());for(var g=[],v=0;m>0&&v<this._pendingRequests.length&&h<n.a.MaxBatchSize;++v){var y=this._pendingRequests[v];if(y.priority<e)u++;else{0;try{i.default.PAssert(2370,!i.default.isFunction(y),"Should never use a deferred request")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2371,!1===y.handled,"Should never service a request that has already been handled")}catch(e){i.default.reportError(e)}var S=this._getDupeRequest(y);if(S)y.duped=!0,g.push(y),l++,this._appendDupeRequest(S,y);else{var E=this._getCombineRequest(y);if(E)y.combined=!0,g.push(y),d++,this._combineRequest(E,y);else{var P=!1;if(y.attach)for(var b=0;b<y.attach.length;++b)y.attach[b].needsRemoteData()&&(y.attach[b].notifyDataRequested(),P=!0);else P=!0;if(P)if(this.isCurrentlyAuthorized(y.accountID)){var C=this._runRemoteRequest(f,y,a);if(C.isNewRequest||0===h){try{i.default.PAssert(2372,t>s,"Should not be making more requests for plugin than allowed")}catch(e){i.default.reportError(e)}s++,m--,this._numOutstandingReqs++}C.wasBatched&&h++,g.push(y)}else p.a.notifyUnauthorizedRequest(y.accountID),c++;else y.canceled=!0,o++,g.push(y)}}}}this._pendingRequests=this._pendingRequests.removeArray(g);for(v=0;v<g.length;++v)g[v].canceled||g[v].duped||this._addRequest(this._outstandingRequests,g[v]);try{i.default.PAssert(2373,!f||h+o+l+d+c+u>1,"Batches should always have multiple items in them")}catch(e){i.default.reportError(e)}return f&&h>0&&this.commitBatch(f,r),s},_clearRequestQueue:function(){log("Clear Request Queue: ",this.id),this._pendingRequests=[],this._outstandingRequests=[],this._numOutstandingReqs=0},_addRequest:function(e,t){try{i.default.PAssert(2374,e.indexOf(t)<0,"Should never re-add a request to a queue without removing it first")}catch(e){i.default.reportError(e)}return e.push(t)},_removeRequest:function(e,t){return e.remove(t)},isRateLimited:function(){return this._isRateLimited},_notifyRateLimitedOver:function(){this._isRateLimited=!1},_notifyRateLimited:function(e){this._isRateLimited=!0,this._lastRateLimitTime=new Date},isRateLimitError:function(e){var t=!1;return e&&S.indexOf(e.status)>=0&&(e.status===n.a.HTTPStatusCode.Forbidden?i.default.hasGoogleError(e,n.a.GoogleErrorDomain.UsageLimits,n.a.GoogleError.UserRateLimitExceeded)?t=!0:i.default.hasGoogleError(e,n.a.GoogleErrorDomain.UsageLimits,n.a.GoogleError.RateLimitExceeded)?t=!0:i.default.hasGoogleError(e,n.a.GoogleErrorDomain.UsageLimits,n.a.GoogleError.QuotaExceeded)&&(t=!0):t=!0),t},_getRetryDelay:function(e,t){var a=e.currentRetries;return t&&(a=Math.max(2,e.currentRetries)),i.default.seconds(v[a])},_notifyRequestSuccess:function(e,t){var a={cbList:e.successCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(a)):this._handleResponse(a)},_notifyRequestFailure:function(e,t){var a={cbList:e.failureCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(a)):this._handleResponse(a)},_handleResponse:function(e){for(var t=0;t<e.cbList.length;++t)try{e.cbList[t](e.result)}catch(e){i.default.reportError(e)}},_notifyBatchCompleted:function(e){var t=this._batchedResponses[e.getBatchID()];if(delete this._batchedResponses[e.getBatchID()],t){i.default.vmMain.beginUpdateItems();for(var a=0;a<t.length;++a)this._handleResponse(t[a]);i.default.vmMain.commitUpdateItems()}},computeBatchGroupID:function(e){return e.accountID},computeRequestID:function(e){return e.id+"-"+Date.now()},_setSendTime:function(e){var t=Date.now();if(0===e.sendTimes.length){var a=t-e.queueTime;this._numSendRequests++,this._totalRequestSendTime+=a,a>this.LongWaitThreshold&&this._numLongWaitRequests++}e.sendTimes.push(t)},_setHandleTime:function(e){var t=Date.now();if(0===e.handleTimes.length){var a=t-e.queueTime;this._numHandledRequests++,this._totalRequestHandleTime+=a}e.handleTimes.push(t)},_runRemoteRequest:function(e,t,a){var r={wasBatched:!1,isNewRequest:!1};if(g.a.canConstruct(t.requestFn))t.request=g.a.createRequest(t.accountID,t.requestFn,t.data);else{var n=i.default.unpackFn(t.requestFn);try{i.default.PAssert(2375,i.default.isFunction(n,"Must specify a valid packed function: ",t.requestFn))}catch(e){i.default.reportError(e)}n&&(t.request=n(t.data))}if(t.request){try{i.default.PAssert(2376,t.request.then,"Remote request must be thenable")}catch(e){i.default.reportError(e)}if(e){var s=this.computeBatchGroupID(t),o=this.computeRequestID(t);r.isNewRequest=e.add(t.request,s,o);try{i.default.PAssert(2377,i.default.isBoolean(r.isNewRequest),"Add must return whether it will create a new remote request for this request")}catch(e){i.default.reportError(e)}r.wasBatched=!0,t.wasBatched=!0,t.batchID=e.getBatchID(),t.batchRequestID=o}else t.wasBatched=!1,t.batchID=void 0,t.batchRequestID=void 0;0;try{i.default.PAssert(2378,this.isCurrentlyAuthorized(t.accountID),"Must be currently authorized to make this request")}catch(e){i.default.reportError(e)}this._clearRequestTimeout(t),this._setSendTime(t),t.request.then(function(e){try{i.default.PAssert(2379,!1===t.handled,"Must not handle the same request multiple times")}catch(e){i.default.reportError(e)}this._setHandleTime(t),t.handled=!0,this._notifyRateLimitedOver(),this._notifyRequestSuccess(t,e.result),a(t.attach,t.plugin,t.wasBatched),this._removeRequest(this._outstandingRequests,t)},function(e){try{i.default.PAssert(2380,!1===t.handled,"Must not handle the same request multiple times")}catch(e){i.default.reportError(e)}this._setHandleTime(t);var r=this.isRateLimitError(e);if(r&&this._notifyRateLimited(e),(r||y.indexOf(e.status)>=0)&&t.autoRetry&&t.currentRetries<t.numRetries)a(t.attach,t.plugin,t.wasBatched),this._removeRequest(this._outstandingRequests,t),this._retryRemoteRequest(t,r);else{if(t.handled=!0,t.failed=!0,t.attach)for(var n=0;n<t.attach.length;++n)t.attach[n].notifyDataRequestFailed();this._notifyRequestFailure(t,e.result),a(t.attach,t.plugin,t.wasBatched),this._removeRequest(this._outstandingRequests,t)}},this)}return r},createPaginationToken:function(e,t,a,i,r,n){return new m.a(e,t,a,i,r,n)},updatePaginationToken:function(e,t){try{i.default.PAssert(2381,e,"Must specify a valid token to update")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2382,t,"Must update the pagination token with a valid next page token")}catch(e){i.default.reportError(e)}return e.updateToken(t),e},createBatch:function(e){return g.a.createBatch(e)},commitBatch:function(e,t){try{i.default.PAssert(2383,e,"Batch to commit must be specified")}catch(e){i.default.reportError(e)}e.then(function(a){this._notifyBatchCompleted(e),t(this,!0)}.bind(this),function(){this._notifyBatchCompleted(e),t(this,!1)}.bind(this))},addModifiedOffline:function(e,t){try{i.default.PAssert(2384,e,"Must have a valid cache entry to update")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2385,i.default.isBoolean(t)||i.default.isArray(t),"Incoming fields must be valid")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2386,!1!==t,"Use removeModifiedOffline to clear data instead")}catch(e){i.default.reportError(e)}if(e){var a=e.modifiedOffline||!1;try{i.default.PAssert(2387,i.default.isBoolean(a)||i.default.isArray(a),"Previous fields must be valid")}catch(e){i.default.reportError(e)}!1===a?e.modifiedOffline=t:!0===a||(!0===t?e.modifiedOffline=!0:e.modifiedOffline.pushOnlyUniques(t))}},removeModifiedOffline:function(e,t){try{i.default.PAssert(2388,e,"Must have a valid cache entry to update")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2389,i.default.isBoolean(t)||i.default.isArray(t),"Incoming fields must be valid")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2390,!0!==t,"Use addModifiedOffline to add data instead")}catch(e){i.default.reportError(e)}if(e){var a=e.modifiedOffline||!1;try{i.default.PAssert(2391,i.default.isBoolean(a)||i.default.isArray(a),"Previous fields must be valid")}catch(e){i.default.reportError(e)}!1===a||(!0===a?!1===t&&(e.modifiedOffline=!1):!1===t?e.modifiedOffline=!1:(e.modifiedOffline=e.modifiedOffline.removeArray(t),0===e.modifiedOffline.length&&(e.modifiedOffline=!1)))}},compactCacheField:function(e,t){return e[t]},_serializeObj:function(e,t){try{i.default.PAssert(2392,e,"Must specify a valid entry to serialize")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2393,t,"Must provide a valid property list")}catch(e){i.default.reportError(e)}for(var a={},r=0;r<t.length;++r){var n=t[r],s=this.getPropertyDescriptor(n);if(!s.isOpt||s.defaultValue!==e[n]){var o=this.compactCacheField(e,n);void 0!==o&&(a[n]=o)}}var l=this.getBlobData(e);return l&&(a._blob=l),a},serializeEntry:function(e){var t=this.getPropertySet(PluginLoad.Full),a=this.getCacheData(e);if(a)return this._serializeObj(a,t)},serializeExternalData:function(e){try{i.default.PAssert(2394,e,"Must supply valid data to serialize")}catch(e){i.default.reportError(e)}var t=this.getPropertySet(PluginLoad.Full),a=this._serializeObj(e,t);return a.id=e.id,e.parents&&(a.parents=e.parents),a},serializePreview:function(e){var t=this.getPropertySet(PluginLoad.Preview),a=this.getCacheData(e.id);if(a)return this._serializeObj(a,t)},registerAutocomplete:function(){if(i.default.autocomplete&&!this._registeredAutocomplete){var e=this.getAutocompletePrefixes();if(e){i.default.autocomplete.registerProvider(this._acProviderId,this);for(var t=0;t<e.length;++t)i.default.autocomplete.registerPrefix(this._acProviderId,e[t])}this._registeredAutocomplete=!0}},unregisterAutocomplete:function(){i.default.autocomplete&&this._registeredAutocomplete},declareProperty:function(e,t,a,r,n){try{i.default.PAssert(2395,!this._propertyDescriptors[e],"Should not declare the same property twice")}catch(e){i.default.reportError(e)}t=t||PluginLoad.Preview|PluginLoad.Full,a=a||!1,i.default.forEachFlagSet(t,function(t){this._propertySets[t]||(this._propertySets[t]=[]),this._propertySets[t].push(e)}.bind(this)),this._propertyDescriptors[e]={isOpt:a,defaultValue:r,comparator:n}},getPropertySet:function(e){return this._propertySets[e]||[]},getPropertyDescriptor:function(e){return this._propertyDescriptors[e]},getBlobData:function(e){},_updateAttachmentStates:function(){try{i.default.vmMain.beginUpdateItems();for(var e=0;e<this._attachKeys.length;++e){var t=this._attachCache[this._attachKeys[e]];t.isInUse()&&t.onUpdate(!1,void 0,ChangeType.Auto)}i.default.vmMain.commitUpdateItems()}catch(e){i.default.reportError(e)}},offlineLoad:function(){if(!this._hasRunOfflineLoad&&this.supportOfflineLoad()){this._hasRunOfflineLoad=!0;try{this._offlineLoad&&this._offlineLoad()}catch(e){i.default.reportError(e)}}},load:function(){if(this._isFirstLoad){this._isFirstLoad=!1;try{this._load&&this._load()}catch(e){i.default.reportError(e)}}this._loadedInitialData||!i.default.isDemoMode()&&!this.hasActiveDataPanes()||this.isPluginBlocked()||this.loadInitialData()},loadInitialData:function(){try{i.default.PAssert(2397,!this._loadedInitialData,"Do not make multiple requests for initial data load")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2398,!this.isPluginBlocked(),"Should not load data for blocked plugins")}catch(e){i.default.reportError(e)}this._loadedInitialData=!0},finishedLoading:function(){i.default.fireCustomEvent(this.loadedEvent)},getDataPane:function(){},getPaneIcon:function(){return"icon-question"},getPanePriority:function(){return 0},getDefaultDisplayItem:function(){},useItemStore:function(){},itemStoreOptions:function(){},getDefaultItemStore:function(){try{i.default.PAssert(2399,this.useItemStore(),"Must request an item store")}catch(e){i.default.reportError(e)}return this._defaultItemStore},getActiveItemStore:function(e){try{i.default.PAssert(2400,e,"Must specify a valid paneID to get the item store for")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2401,this.useItemStore(),"Must request item store usage")}catch(e){i.default.reportError(e)}var t=this._activeItemStore[e];return t||this._defaultItemStore},getBucketItemStore:function(e){return this._searchBuckets[e]},allowRemoteRequests:function(){return!1},handleDropEvent:function(e,t){return!1},handleTapClick:function(e,t,a,i){return!1},handleDoubleTap:function(e,t,a,i){return!1},getAutocompletePrefixes:function(){},notifyPaneCreated:function(){this._numActivePanes++,!this.isActive()||this._loadedInitialData||this.isPluginBlocked()||(this.areDependenciesLoaded()?this.loadInitialData():this.loadRemoteAPIs())},notifyPaneDestroyed:function(){this._numActivePanes--;try{i.default.PAssert(2404,this._numActivePanes>=0,"Should never have negative active panes")}catch(e){i.default.reportError(e)}},notifyPanesReadyForLoad:function(){i.default.vmMain.paneManager.runForEachPane(function(e){e.notifyPluginLoaded()},this.getPaneType())},hasActiveDataPanes:function(){return this._numActivePanes>0},allowTextEditing:function(e,t){return!0},_createSearchBucket:function(e,t){var a;a=i.default.generateTempId();var r=i.default.vmMain.itemStoreManager.registerItemStore(a,this,{trackGlobally:!1});return r.createRoot(t||i.default.generateTempId(),"Search Results"),this._searchBuckets[a]=r,a},_destroySearchBucket:function(e){this._searchBuckets[e].clearStore()},swapInSearchBucket:function(e,t){try{i.default.PAssert(2405,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(e){i.default.reportError(e)}if(i.default.vmMain.paneManager.isPaneActive(t)){var a=i.default.vmMain.paneManager.getPaneById(t),r=this._searchBuckets[e];if(!this._activeSearchBucket[t]||this._activeSearchBucket[t].id!==e){var n=r.getRoot();this._activeSearchBucket[t]||(this._defaultZoomItems[t]=a.getItem()),this._activeItemStore[t]=r,this._activeSearchBucket[t]=r,a.setRootItem(n,!0),a.useItemStore(r)}}},swapOutSearchBucket:function(e,t){try{i.default.PAssert(2406,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(e){i.default.reportError(e)}var a=this._activeSearchBucket[e].id;var r=i.default.vmMain.paneManager.getPaneById(e),n=this._searchBuckets[a];try{i.default.PAssert(2407,n,"Must have a valid bucket we are swapping from")}catch(e){i.default.reportError(e)}var s=r.getRootItem();try{i.default.PAssert(2408,s===n.getRoot(),"Current root for pane should match bucket root")}catch(e){i.default.reportError(e)}t=t||this._defaultZoomItems[e];try{i.default.PAssert(2409,t,"Must always be able to get a valid default zoom item")}catch(e){i.default.reportError(e)}this._activeItemStore[e]=void 0,this._activeSearchBucket[e]=void 0,this._defaultZoomItems[e]=void 0,r.setItem(t,!0),r.stopUsingItemStore(n),this._destroySearchBucket(a)},runSearch:function(e,t,a,r,n){try{i.default.PAssert(2410,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(e){i.default.reportError(e)}var s;return r&&(s=this._createSearchBucket(e,a)),this.runRemoteSearch(e,t,s,n)},getSearchRoot:function(e){var t=this._searchBuckets[e];try{i.default.PAssert(2411,t,"Should always reference a valid search bucket")}catch(e){i.default.reportError(e)}return t.getRoot()},runRemoteSearch:function(e,t,a){try{i.default.PAssert(2412,!1,"SubClass must override")}catch(e){i.default.reportError(e)}},isRemoteSearchBucketActive:function(e){return!!this._activeSearchBucket[e]},clearSearch:function(e,t){this._activeSearchBucket[e]&&this.swapOutSearchBucket(e,t)},refreshCurrentView:function(e){try{i.default.PAssert(2413,!1,"SubClass must override")}catch(e){i.default.reportError(e)}},dumpRequestQueue:function(e){console.log("---- Outstanding Requests ["+this._numOutstandingReqs+"] ----");for(var t=0;t<this._outstandingRequests.length;++t){var a=this._outstandingRequests[t];console.log("  ",a.requestFn,":",a.id," - ",a.data)}console.log("---- Pending Requests ["+this._pendingRequests.length+"] ----");for(t=0;t<this._pendingRequests.length;++t){a=this._pendingRequests[t];console.log("  ",a.requestFn,":",a.id," - ",a.data)}if(e){try{i.default.PAssert(2414,!1,"Must be in DEBUG mode to display info on handled requests")}catch(e){i.default.reportError(e)}console.log("---- Handled Requests ["+this._handledRequests.length+"] ----");for(t=0;t<this._handledRequests.length;++t){(a=this._handledRequests[t]).failed?console.log(" !",a.requestFn,":",a.id," - ",a.data):console.log("  ",a.requestFn,":",a.id," - ",a.data)}}},dumpQueueStats:function(){console.log("  Rate Limited: "+this._isRateLimited),console.log("  Long Wait Requests: "+this._numLongWaitRequests),console.log("  Num Requests: ",this._numSendRequests,this._numHandledRequests),console.log("  Num Pending Requests: ",this._pendingRequests.length),console.log("  Avg. Send Time: ",this._totalRequestSendTime/this._numSendRequests),console.log("  Avg. Handle Time: ",this._totalRequestHandleTime/this._numHandledRequests)},getCssClass:function(e){return""}},r.a.defineBase(P),t.a=P},function(e,t,a){"use strict";var i=a(0),r=["SU","MO","TU","WE","TH","FR","SA"],n=500,s=new Date(1401606e6);function o(e){if(this._valid=!0,this._initData=e,this._maxCount=n,i.default.isString(e))this.fromString(e);else if(i.default.isArray(e))this.fromICal(e);else if(e instanceof o)this._startDate=new Date(e._startDate),this._endDate=e._endDate?new Date(e._endDate):void 0,this._frequency=e._frequency,this._separation=e._separation,this._offsets=e._offsets?e._offsets.slice():void 0;else if(i.default.isObject(e)){try{i.default.PAssert(866,e.type===DateType.Repeat,"Must have a valid date type set")}catch(e){i.default.reportError(e)}this._startDate=new Date(e.startDate),this._endDate=e.endDate?new Date(e.endDate):void 0,this._frequency=e.frequency,this._separation=e.separation||1,this._offsets=e.offsets}else{try{i.default.PAssert(867,!1,"Invalid object passed to RepeatDate constructor",e)}catch(e){i.default.reportError(e)}this._valid=!1}if(this._startDate){try{i.default.PAssert(868,this._startDate instanceof Date,"Must be a valid date instance")}catch(e){i.default.reportError(e)}try{i.default.PAssert(869,this._startDate.isAfter(s),"Start date must be after the minimum start date")}catch(e){i.default.reportError(e)}try{i.default.PAssert(870,!this._endDate||this._endDate instanceof Date,"Must be a valid date instance")}catch(e){i.default.reportError(e)}try{i.default.PAssert(871,!this._offsets||this._offsets.length>=1,"Must always store at least one offset if _offsets is defined",this._offsets)}catch(e){i.default.reportError(e)}if(this._endDate&&!this._startDate.isBefore(this._endDate)&&!this._startDate.equals(this._endDate)){this._valid=!1;try{i.default.PAssert(873,!1,"Start date must always be before the end date")}catch(e){i.default.reportError(e)}}}else this._valid=!1;this._doneGenerating=!this._valid,this._cache=[],this._cacheDate=new Date(this._startDate)}o.prototype={isValid:function(){return this._valid},_isValidDate:function(e){return e&&e instanceof Date},setStartDate:function(e){try{i.default.PAssert(874,e,"Must provide a valid date")}catch(e){i.default.reportError(e)}if(this._startDate=new Date(e),this._endDate&&!this._startDate.isBefore(this._endDate)&&!this._startDate.equals(this._endDate)){this._valid=!1;try{i.default.PAssert(875,!1,"Start date must always be before the end date")}catch(e){i.default.reportError(e)}}this._resetCache()},getStartDate:function(){return this._startDate},getEndDate:function(){return this._endDate},_isBeforeEnd:function(e){try{i.default.PAssert(876,this._isValidDate(e),"Must provide a valid date: ",e)}catch(e){i.default.reportError(e)}var t=this._cache.length<this._maxCount,a=!this._endDate||(e.isBefore(this._endDate)||e.equals(this._endDate));return t&&a},_resetCache:function(){this._cache=[],this._cacheDate=new Date(this._startDate),this._doneGenerating=!this._valid},_getNext:function(e){return this._cache.length<e&&this._generate(e),this._cache.slice(0,e)},_generateUntil:function(e){try{i.default.PAssert(877,this._isValidDate(e),"Must provide a valid date to generate until: ",e)}catch(e){i.default.reportError(e)}for(var t=!1,a=0;!this._doneGenerating&&(!this._getLastCachedDate()||this._getLastCachedDate().isBefore(e))&&a<50;)this._generateNext(1),t=!0,a++;return t},_generateNext:function(e){try{i.default.PAssert(878,e>0,"Must request a valid number of additional dates")}catch(e){i.default.reportError(e)}this._generate(this._cache.length+e)},_doGenerateInstance:function(e,t,a){var r=!1;switch(t){case RepeatFreq.Weekly:r=e.getDay()<=a;break;case RepeatFreq.DayOfMonth:r=e.getDate()<=a;break;default:try{i.default.PAssert(879,!1,"Invalid repeat frequency for offset dates",t)}catch(e){i.default.reportError(e)}}return r},_generate:function(e){try{i.default.PAssert(880,e>0,"Must request a valid number of dates")}catch(e){i.default.reportError(e)}try{i.default.PAssert(881,e<this._maxCount,"Must request less than maxCount dates")}catch(e){i.default.reportError(e)}var t=new Date(this._cacheDate);e=Math.min(e,this._maxCount);for(var a=0;a<e&&this._cache.length<e&&this._isBeforeEnd(t);){if(this._offsets)for(var r=0;r<this._offsets.length&&this._cache.length<e;++r){var n=this._offsets[r],s=new Date(t);if(this._doGenerateInstance(s,this._frequency,n)){switch(this._frequency){case RepeatFreq.Weekly:s.addDays(n-s.getDay());break;case RepeatFreq.DayOfMonth:s.addDays(n-s.getDate());break;default:try{i.default.PAssert(882,!1,"Invalid repeat frequency for offset dates",this._frequency)}catch(e){i.default.reportError(e)}}var o=this._cache[this._cache.length-1];!this._isBeforeEnd(s)||o&&!s.isAfter(o)?this._isBeforeEnd(s)||(this._doneGenerating=!0):this._cache.push(s)}}else{s=new Date(t),o=this._cache[this._cache.length-1];if(!this._isBeforeEnd(s)||o&&!s.isAfter(o))return void(this._isBeforeEnd(s)||(this._doneGenerating=!0));this._cache.push(s)}switch(this._frequency){case RepeatFreq.Daily:t.addDays(this._separation);break;case RepeatFreq.Weekly:this._offsets&&this._offsets.length>1&&t.getDay()!==this._offsets[0]&&t.moveToDayOfWeek(this._offsets[0],-1),t.addWeeks(this._separation);break;case RepeatFreq.Monthly:t.addMonths(this._separation);break;case RepeatFreq.NthMonthInst:var l=this._startDate.getDay(),d=Math.ceil(this._startDate.getDate()/7);t.addMonths(this._separation),4!==d&&5!==d||(d=-1),t.moveToNthOccurrence(l,d);break;case RepeatFreq.Yearly:t.addYears(this._separation);break;case RepeatFreq.EndOfMonthOffset:t.addMonths(this._separation);var c=this._startDate.getDate(),u=this._startDate.getDaysInMonth()-c;t.setDate(t.getDaysInMonth()-u);break;case RepeatFreq.DayOfMonth:for(r=0;r<this._separation;++r)this.getNextValidMonth(t,this._startDate.getDate());break;case RepeatFreq.Once:default:try{i.default.PAssert(883,!1,"Invalid repeat frequency")}catch(e){i.default.reportError(e)}return void(this._doneGenerating=!0)}this._cacheDate=t,a++}this._isBeforeEnd(t)||(this._doneGenerating=!0)},getNextValidMonth:function(e,t){try{i.default.PAssert(884,this._isValidDate(e),"Must provide a valid date: ",e)}catch(e){i.default.reportError(e)}(e.addMonths(1),e.getDate()!==t)&&(t>e.getDaysInMonth()&&(e.addMonths(1),e.setDate(t)))},includesDate:function(e){for(var t=this.getDates(!1),a=0;a<t.length;a++){if(t[a].clone().clearTime().equals(e))return!0}return!1},getDates:function(e){try{i.default.PAssert(885,this._valid,"Must not call getDates with invalid RepeatDate: ",this._initData)}catch(e){i.default.reportError(e)}var t=new Date;this._generate(4),this._generateUntil(t);var a=this._cache.findInsertIndex(t,Date.compare),r=this._cache.length-a;r<4&&this._generateNext(4-r);var n=e?Math.max(a,0):Math.max(a-3,0),s=Math.min(a+4,this._cache.length);return this._cache.slice(n,s)},getDateOnDay:function(e){try{i.default.PAssert(886,i.default.isDateValid(e),"Day is not valid",e)}catch(e){i.default.reportError(e)}if(e){var t=this._cache.findInsertIndex(e,Date.compare);return this._cache[t]}},next:function(e){if(e>0)return this._getNext(e)},nextIndex:function(e){try{i.default.PAssert(889,this._valid,"Must not call nextIndex with invalid RepeatDate: ",this._initData)}catch(e){i.default.reportError(e)}try{i.default.PAssert(890,!e||this._isValidDate(e),"Must provide a valid from date",e)}catch(e){i.default.reportError(e)}var t=e?new Date(e):this._startDate;if(this._generateUntil(t))return this._cache.length-1;for(var a=0;a<this._cache.length;++a)if(this._cache[a].isAfter(t)||this._cache[a].equals(t))return a;return this._generateNext(1),this._cache.length-1},nextComplete:function(e){try{i.default.PAssert(891,this._valid,"Must not call nextComplete with invalid RepeatDate: ",this._initData)}catch(e){i.default.reportError(e)}try{i.default.PAssert(892,!e||this._isValidDate(e),"Must provide a valid from date",e)}catch(e){i.default.reportError(e)}var t=this.nextIndex(e);return this._cache[t]},nextActive:function(e){try{i.default.PAssert(895,this._valid,"Must not call nextActive with invalid RepeatDate: ",this._initData)}catch(e){i.default.reportError(e)}try{i.default.PAssert(896,!e||this._isValidDate(e),"Must provide a valid from date",e)}catch(e){i.default.reportError(e)}var t=this.nextIndex(e);return this._cache.length<=t+1&&this._generateNext(1),this._cache[t+1]},_getLastCachedDate:function(){return this._cache[this._cache.length-1]},hasTimeOfDay:function(){return!!this._valid&&this._startDate.hasTimeOfDay()},isRepeatDate:function(){return!0},getTimeOfDay:function(){return this._valid?this._startDate.getTimeOfDay():0},getTime:function(e){return this._valid?this._startDate.toString(e):""},equals:function(e){if(this._valid){if(i.default.isString(e))return this.toString()===e;if(e instanceof o){if(e._valid){var t=!isNaN(this._startDate)&&!isNaN(e._startDate)&&this._startDate.equals(e._startDate),a=this._endDate?this._endDate.equals(e._endDate):this._endDate===e._endDate,r=this._frequency===e._frequency,n=this._separation===e._separation,s=this._offsets?this._offsets.equals(e._offsets):this._offsets===e._offsets;return t&&a&&r&&n&&s}}else if(i.default.isObject(e)){try{i.default.PAssert(899,e.type===DateType.Repeat,"Must have a valid date type set")}catch(e){i.default.reportError(e)}var l=new Date(e.startDate);try{i.default.PAssert(900,this._isValidDate(l),"Must provide a valid comp date",l)}catch(e){i.default.reportError(e)}t=!isNaN(this._startDate)&&!isNaN(l)&&this._startDate.equals(l),a=this._endDate==(e._endDate?new Date(e._endDate):void 0),r=this._frequency===e.frequency,n=this._separation===e._separation,s=this._offsets?this._offsets.equals(e._offsets):this._offsets===e._offsets;return t&&a&&r&&n&&s}}return!1},fromString:function(e){try{var t=e.split("|"),a=t[0];if("1"===a){this._startDate=new Date(parseInt(t[1])),this._endDate=t[2]?new Date(parseInt(t[2])):void 0,this._frequency=parseInt(t[3]),this._separation=parseInt(t[4]);try{i.default.PAssert(901,i.default.isNumber(this._frequency),"Invalid frequency",t[3])}catch(e){i.default.reportError(e)}try{i.default.PAssert(902,i.default.isNumber(this._separation),"Invalid frequency",t[4])}catch(e){i.default.reportError(e)}if(this._offsets=void 0,t[5]){var r=t[5].split(",");if(r.length>0){this._offsets=[];for(var n=0;n<r.length;++n){var s=parseInt(r[n]);try{i.default.PAssert(903,i.default.isNumber(s),"Date offsets must be valid numbers",r[n])}catch(e){i.default.reportError(e)}this._offsets.push(s)}}}if(!this._isValidDate(this._startDate)||this._endDate&&!this._isValidDate(this._endDate)){try{i.default.PAssert(904,!1,"Invalid start or end date parsing from string",this._startDate,this._endDate)}catch(e){i.default.reportError(e)}this._valid=!1}}else{try{i.default.PAssert(905,!1,"Unknown repeated date version: ",a)}catch(e){i.default.reportError(e)}this._valid=!1}}catch(e){this._valid=!1,i.default.reportError(e)}this._resetCache()},toString:function(){if(this._valid){var e=this._startDate.getTime(),t=this._endDate?this._endDate.getTime():"",a=this._offsets&&this._offsets.length>1?this._offsets.join(","):"";return"1|"+e+"|"+t+"|"+this._frequency+"|"+this._separation+"|"+a}},toICal:function(){var e=[],t={};if(this._valid){switch(this._startDate&&e.push("DTSTART:"+this._startDate.getTime()+"Z"),this._endDate&&(t.UNTIL=this._endDate.getTime()+"Z"),this._frequency){case RepeatFreq.Daily:t.FREQ="DAILY";break;case RepeatFreq.Weekly:t.FREQ="WEEKLY";for(var a=this._startDate.clone(),n=[r[a.getDay()]],s=0;s<this._offsets.length;++s)a.moveToDayOfWeek(this._offsets[s]),n.push(r[a.getDay()]);t.BYDAY=n.toString();break;case RepeatFreq.Monthly:t.FREQ="MONTHLY";break;case RepeatFreq.DayOfMonth:t.FREQ="MONTHLY",t.BYMONTHDAY=this._startDate.getDate();break;case RepeatFreq.Yearly:t.FREQ="YEARLY";break;case RepeatFreq.EndOfMonthOffset:t.FREQ="MONTHLY",t.BYMONTHDAY=-this._startDate.getDate();break;case RepeatFreq.NthMonthInst:t.FREQ="MONTHLY",t.BYDAY=r[this._getStartDate.getDay()],t.BYSETPOS=Math.ceil(this._getStartDate.getDate()/7);break;default:try{i.default.PAssert(906,!1,"Invalid repeat date frequencey: "+this._frequency)}catch(e){i.default.reportError(e)}}t.INTERVAL=this._separation;var o="RRULE:";for(var l in t)o+=l+"="+t[l]+";";e.push(o)}return e},_handleICalString:function(e,t){for(var a=e.split(";"),i=0;i<a.length;++i){var r=a[i].split("=");t(r[0],r[1])}},_handleDTSTART:function(e){try{i.default.PAssert(907,e.endsWith("Z"),"Timestamp must be in UTC time: "+e)}catch(e){i.default.reportError(e)}log("DTSTART: ",e),this._startDate=new Date(parseInt(e.slice(0,-1)));try{i.default.PAssert(908,this._startDate,"Must have a valid start date: "+e)}catch(e){i.default.reportError(e)}},_handleRRULE:function(e){this._handleICalString(e,function(e,t){switch(log("RRULE: ",e,"->",t),e){case"FREQ":switch(t){case"DAILY":this._frequency=RepeatFreq.Daily;break;case"WEEKLY":this._frequency=RepeatFreq.Weekly;break;case"MONTHLY":this._frequency=RepeatFreq.Monthly;break;case"YEARLY":this._frequency=RepeatFreq.Yearly;break;case"SECONDLY":case"MINUTELY":case"HOURLY":default:try{i.default.PAssert(909,!1,"Invalid RRULE FREQ value: ",t)}catch(e){i.default.reportError(e)}}break;case"UNTIL":try{i.default.PAssert(910,t.indexOf("T")<0,"Do not currently support date-time")}catch(e){i.default.reportError(e)}var a=t.substring(0,4),n=t.substring(4,6),s=t.substring(6,8);this._endDate=new Date(a,n,s);break;case"COUNT":this._maxCount=parseInt(t);break;case"INTERVAL":this._separation=parseInt(t);break;case"BYDAY":var o=t.split(",");this._offsets=[];for(var l=0;l<o.length;++l){var d=r.indexOf(o[l]);d>=0?this._offsets.push(d):this._offsets.push(parseInt(o[l]))}break;case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYMONTH":case"BYSETPOS":case"WKST":break;case"BYSECOND":case"BYMINUTE":case"BYHOUR":default:try{i.default.PAssert(911,!1,"Invalid RRULE action: ",e)}catch(e){i.default.reportError(e)}}})},_handleEXRULE:function(e){this._handleICalString(e,function(e,t){log("EXRULE: ",e,"->",t)})},_handleRDATE:function(e){this._handleICalString(e,function(e,t){log("RDATE: ",e,"->",t)})},_handleEXDATE:function(e){this._handleICalString(e,function(e,t){log("EXDATE: ",e,"->",t)})},fromICal:function(e){try{i.default.PAssert(912,2===e.length,"Only handle single instance RRULE with added DTSTART")}catch(e){i.default.reportError(e)}for(var t=0;t<e.length;++t){var a=e[t].split(":"),r=a[0],n=a[1];switch(r){case"DTSTART":this._handleDTSTART(n);break;case"RRULE":this._handleRRULE(n);break;case"EXRULE":this._handleEXRULE(n);break;case"RDATE":this._handleRDATE(n);break;case"EXDATE":this._handleEXDATE(n);break;default:try{i.default.PAssert(913,!1,"Invalid recurrence rule: "+r)}catch(e){i.default.reportError(e)}}}},getHours:function(){return this._startDate.getHours()},getMinutes:function(){return this._startDate.getMinutes()}},t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(3),l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};var d=o.a.createClass({displayName:"DivX",componentDisplay:r.a.ComponentDisplay.Everywhere,componentDidMount:function(){this.props.globalEvents&&(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))},onUnmount:function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},getElement:function(){return this.refs.element},onMouseDown:function(e){this.lastX=e.clientX,this.lastY=e.clientY,this.moveX=0,this.moveY=0,this.isDown=!0,this.startSrc=e.target,this.props.onMouseDown&&this.props.onMouseDown(e)},onMouseMove:function(e){if(this.isDown){this.moveX+=Math.abs(e.clientX-this.lastX),this.moveY+=Math.abs(e.clientY-this.lastY),this.lastX=e.clientX,this.lastY=e.clientY;var t={startSrc:this.startSrc,target:e.target,clientX:e.clientX,clientY:e.clientY,eventX:e.clientX,eventY:e.clientY,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn};this.props.onMouseMove&&this.props.onMouseMove(t)}},onClick:function(e){this.moveX<i.default.ClickThreshold&&this.moveY<i.default.ClickThreshold&&this.props.onClick&&this.props.onClick(e)},onMouseUp:function(e){this.isDown=!1,this.props.onMouseUp&&this.props.onMouseUp(e)},onTap:{onStart:function(e){this.onMouseDown(e),e.stopPropagation()},onClick:function(e){this.props.onClick&&(this.props.onClick(e),e.stopPropagation())},onMove:function(e){this.props.onMouseMove&&this.props.onMouseMove(e),e.stopPropagation()},onEnd:function(e){this.onMouseUp(e),e.stopPropagation()}},render:function(){var e=this.props,t=(e.onClick,e.globalEvents),a=function(e,t){var a={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a}(e,["onClick","globalEvents"]);return s.a.createElement("div",l({},a,{onMouseDown:this.onMouseDown,onMouseMove:t?void 0:this.onMouseMove,onClick:this.onClick,onMouseUp:t?void 0:this.onMouseUp,ref:"element"}),this.props.children)}});t.a=d},function(e,t,a){"use strict";function i(e){this._limit=e,this._offset=0,this._buffer=[]}i.prototype={get:function(e){return this._buffer[e]},push:function(e){this._buffer[this._offset]=e,this._offset=(this._limit+this._offset+1)%this._limit},peek:function(){var e=(this._limit+this._offset-1)%this._limit;return this._buffer[e]},pop:function(){var e=(this._limit+this._offset-1)%this._limit,t=this._buffer[e];return t&&(this._buffer[e]=void 0,this._offset=e),t},hasData:function(){return!!this.peek()},reset:function(){this._offset=0,this._buffer=[]},buffer:function(){return this._buffer},limit:function(e){this._limit=e},ordered:function(){return this._buffer.slice(this._offset).concat(this._buffer.slice(0,this._offset))},entries:function(){for(var e=this.ordered(),t=0;t<e.length;++t)console.log("---- Entry ["+t+"] ----"),console.log(e[t])}},t.a=i},function(e,t,a){"use strict";var i=a(0),r=a(5);function n(e,t,a){this._id=e,this._name=t,this._isOpen=!1,this._isReady=!1,this._isAllLoaded=!1,this._storageError=!1,this._loggingEnabled=!1,this._preloadConsumed=!1,this._usesDiskSpace||(this._usesDiskSpace=!1),this._onReadyFns=[],this._onMetadataReadyFns=[],this._cache={},this._metadata={},this._useInMemoryStore=!a||!a.noInMemoryCache,this._useMetadataInMemoryStore=!a||!a.noMetadataInMemoryCache,this._isPerDoc=a&&a.isPerDoc,this.open()}var s={getStats:function(e){this.getFilterEntries(function(){return!0},function(t){var a={id:this._id,count:t.length,size:JSON.stringify(t).length};e(a)}.bind(this))},getState:function(){return{isOpen:this._isOpen,isReady:this._isReady,isAllLoaded:this._isAllLoaded,storageError:this._storageError}},enableLogging:function(){this._loggingEnabled=!0},disableLogging:function(){this._loggingEnabled=!1},isLoggingEnabled:function(){return this._loggingEnabled},usesDiskSpace:function(){return this._usesDiskSpace},_cacheInMemory:function(){return this._useInMemoryStore},_cacheMetadataInMemory:function(){return this._useMetadataInMemoryStore},_hasLoadedAll:function(){return this._isAllLoaded},isPerDoc:function(){return this._isPerDoc},getStorageType:function(){try{i.default.PAssert(1441,!1,"SubClass must override")}catch(e){i.default.reportError(e)}},open:function(){this._isOpen=!0},close:function(){this._isOpen=!1,this._isReady=!1},isOpen:function(){return this._isOpen},isReady:function(){return this._isOpen&&this._isReady},requestPreloadData:function(e){try{i.default.PAssert(1442,!this._preloadConsumed,"Should never consume preload data twice")}catch(e){i.default.reportError(e)}this._preloadConsumed=!0;var t=window.__preload;if(!(t&&t.cachePreloads&&t.cachePreloads.indexOf(this._id)>=0))return e(void 0);if(t.cacheResults[this._id]){try{i.default.PAssert(1443,!t.cacheCallbacks[this._id],"Should never have active callbacks and results")}catch(e){i.default.reportError(e)}var a=t.cacheResults[this._id];return delete t.cacheResults[this._id],t.cachePreloads.remove(this._id),e(a)}t.cacheCallbacks[this._id]||(t.cacheCallbacks[this._id]=[]),t.cacheCallbacks[this._id].push(e)},isMetadataReady:function(){return this._isOpen&&this._isMetadataReady},notifyCacheReady:function(e){if(e){this._storageError=!1,this._isReady=!0;for(var t=0;t<this._onReadyFns.length;++t)this._onReadyFns[t]();this._onReadyFns=[]}else this._storageError=!0,this._isReady=!1},notifyCacheMetadataReady:function(e){if(e){this._isMetadataReady=!0;for(var t=0;t<this._onMetadataReadyFns.length;++t)this._onMetadataReadyFns[t]();this._onMetadataReadyFns=[]}else this._isMetadataReady=!1},onCacheReady:function(e){try{i.default.PAssert(1444,e,"Must provide a valid cb")}catch(e){i.default.reportError(e)}if(this._isReady)setTimeout(e,0);else{try{i.default.PAssert(1445,this._onReadyFns.indexOf(e)<0,"Must not double register a cache ready fn")}catch(e){i.default.reportError(e)}this._onReadyFns.push(e)}},onCacheMetadataReady:function(e){try{i.default.PAssert(1446,e,"Must provide a valid cb")}catch(e){i.default.reportError(e)}if(this._isMetadataReady)setTimeout(e,0);else{try{i.default.PAssert(1447,this._onMetadataReadyFns.indexOf(e)<0,"Must not double register a cache metadata ready fn")}catch(e){i.default.reportError(e)}this._onMetadataReadyFns.push(e)}},setMetadata:function(e,t,a){try{i.default.PAssert(1448,!a,"In memory query is sync")}catch(e){i.default.reportError(e)}this._cacheMetadataInMemory()&&(this._metadata[e]=t)},removeMetadata:function(e,t){try{i.default.PAssert(1449,!t,"In memory query is sync")}catch(e){i.default.reportError(e)}this._cacheMetadataInMemory()&&delete this._metadata[e]},getMetadata:function(e,t){try{i.default.PAssert(1450,!t,"In memory query is sync")}catch(e){i.default.reportError(e)}return this._cacheMetadataInMemory()?this._metadata[e]:void 0},_setRawInMemoryMetadata:function(e){try{i.default.PAssert(1451,this._cacheMetadataInMemory(),"Must be running an in-memory cache")}catch(e){i.default.reportError(e)}this._metadata=e},_getRawInMemoryMetadata:function(){return this._cacheMetadataInMemory()?this._metadata:void 0},_setRawInMemoryCache:function(e){try{i.default.PAssert(1452,this._cacheInMemory(),"Must be running an in-memory cache")}catch(e){i.default.reportError(e)}this._cache=e},_getRawInMemoryCache:function(){return this._cacheInMemory()?this._cache:void 0},count:function(e){try{i.default.PAssert(1453,!e,"In memory query is sync")}catch(e){i.default.reportError(e)}return this._cacheInMemory()?Object.keys(this._cache).length:void 0},size:function(e){try{i.default.PAssert(1454,!e,"In memory query is sync")}catch(e){i.default.reportError(e)}return this._cacheInMemory()?2*JSON.stringify(this._cache).length:void 0},loadAll:function(e){try{i.default.PAssert(1455,!e,"In memory query is sync")}catch(e){i.default.reportError(e)}this._isAllLoaded=!0},getEntrySync:function(e){return this._cacheInMemory()?this._cache[e]:void 0},getEntry:function(e,t){try{i.default.PAssert(1456,!t,"In memory query is sync")}catch(e){i.default.reportError(e)}return this._cacheInMemory()?this._cache[e]:void 0},getBoundEntries:function(e,t,a,r){try{i.default.PAssert(1457,!r,"In memory query is sync")}catch(e){i.default.reportError(e)}var n;if(this._cacheInMemory())for(var s in n=[],this._cache)this._cache[s][e]>=t&&this._cache[s][e]<=a&&n.push(this._cache[s]);return n},getFilterEntries:function(e,t){try{i.default.PAssert(1458,!t,"In memory query is sync")}catch(e){i.default.reportError(e)}var a;if(this._cacheInMemory())for(var r in a=[],this._cache)e(this._cache[r])&&a.push(this._cache[r]);return a},removeEntry:function(e,t){try{i.default.PAssert(1459,!t,"In memory query is sync")}catch(e){i.default.reportError(e)}this._cacheInMemory()&&delete this._cache[e]},hasEntry:function(e,t){try{i.default.PAssert(1461,!t,"In memory query is sync")}catch(e){i.default.reportError(e)}return!!this._cacheInMemory()&&this._cache.hasOwnProperty(e)},cacheEntry:function(e,t,a){try{i.default.PAssert(1462,!a,"In memory query is sync")}catch(e){i.default.reportError(e)}this.isLoggingEnabled()&&log("Cache Entry: ",e,t),this._cacheInMemory()&&t&&(this._cache[e]=t)},clearCache:function(e){try{i.default.PAssert(1463,!e,"In memory query is sync")}catch(e){i.default.reportError(e)}this._cache={}},clearMetadata:function(e){try{i.default.PAssert(1464,!e,"In memory query is sync")}catch(e){i.default.reportError(e)}this._metadata={}},clearBackingStore:function(e){try{i.default.PAssert(1465,!1,"SubClass must override")}catch(e){i.default.reportError(e)}},dumpData:function(e){console.log("-- Cache: ",this._id,"--"),console.log(this._cache)},onCacheError:function(e){i.default.reportError(e)}};r.a.defineBase(n),r.a.extend(n.prototype,s),t.a=n},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(34),l=a.n(o),d=a(3),c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};var u=d.a.createClass({displayName:"FancyRippler",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({ripples:[]}),this.rippleNum=0},componentDidMount:function(){0},getElement:function(){return l.a.findDOMNode(this)},onMouseDown:function(e){var t=this.props;if(!1!==t.enabled){if(this.props.onMouseDown&&this.props.onMouseDown(e),this.props.children&&!e.defaultPrevented&&!1!==t.ripple){var a,r,n=this.refs.element,s=n.offsetWidth,o=n.offsetHeight,l=Math.max(s,o);if(this.props.center)a="50%",r="50%";else{var d=i.default.offset(n);a=e.clientX-d.left,r=e.clientY-d.top}var c={id:this.rippleNum++,left:a,top:r,width:l,height:l};this.ripples.push(c),setTimeout(this.removeRipple,1e3)}e.stopPropagation()}},onRightClick:function(e){e.preventDefault(),e.stopPropagation(),this.props.onRightClick(e)},onTap:{onStart:function(e){!1===this.props.enabled||i.default.findParent(e.target,"fancyInput")||(this.onMouseDown(e),e.stopPropagation())},onClick:function(e){!1===this.props.enabled||i.default.findParent(e.target,"fancyInput")||(this.props.onClick(e),e.preventDefault(),e.stopPropagation())}},removeRipple:function(){this.ripples.removeAt(0)},render:function(){for(var e=this.state,t=this.props,a=[],r=0;r<e.ripples.length;r++){var n={left:(d=e.ripples[r]).left,top:d.top,width:d.width,height:d.height,marginLeft:-d.width/2,marginTop:-d.height/2};a.push(s.a.createElement("div",{key:"ripple_"+d.id,className:"fancyRipple",style:n}))}var o=i.default.classNames(this.props.className,"fancyRippler",{rippleCenter:this.props.center}),l=(t.center,t.onClick),d=(t.enabled,t.ripple),u=t.onRightClick,h=function(e,t){var a={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a}(t,["center","onClick","enabled","ripple","onRightClick"]);return s.a.createElement("div",c({},h,{className:o,onMouseDown:this.onMouseDown,onClick:l,onContextMenu:u?this.onRightClick:void 0,ref:"element"}),this.props.children,a.length>0&&s.a.createElement("div",{className:"fancyRipples"},a))}});t.a=u},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=(a(4),a(25)),d=o.a.createClass({displayName:"FancyTextArea",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({isFocused:this.props.focused||!1})},componentDidMount:function(){var e=this.refs.input;this.props.value&&(e.value=this.props.value),this.props.focused&&requestAnimationFrame(function(){e.focus(),void 0!==this.props.selectionStart&&(e.selectionStart=this.props.selectionStart),void 0!==this.props.selectionEnd&&(e.selectionEnd=this.props.selectionEnd),e.scrollTop=0}.bind(this))},onUnmount:function(){this.isFocused.get()&&this.onBlur()},focus:function(){this.refs.input.focus()},blur:function(){this.refs.input.blur()},getValue:function(){return this.refs.input.value},setValue:function(e){this.refs.input.value=e},getSelectionStart:function(){return this.refs.input.selectionStart},getSelectionEnd:function(){return this.refs.input.selectionEnd},onFocus:function(e){i.default.vmMain.activeInput.set(this),this.isFocused.set(!0),this.props.onEscape&&(this.__hotkeyEscape=l.a.pushStackEscape(this.handleEscapeKey)),this.props.onFocus&&this.props.onFocus(e)},onBlur:function(e){i.default.vmMain.activeInput.set(null),this.isFocused.set(!1),this.__hotkeyEscape&&(l.a.popStack(this.__hotkeyEscape),this.__hotkeyEscape=void 0),this.props.onBlur&&this.props.onBlur(e)},onKeyPress:function(e){this.props.onKeyPress&&this.props.onKeyPress(e)},handleEscapeKey:function(){this.props.onEscape&&this.props.onEscape()},render:function(){var e=this.props,t=i.default.classNames("fancyTextarea c-background c-foreground",e.className),a=e.spellCheck?"true":null,r={fontSize:e.fontSize,height:e.height||150,margin:void 0!==e.margin?e.margin:"16px 0",overflow:e.height<=34&&"hidden"};return s.a.createElement("textarea",{className:t,style:r,ref:"input",readOnly:!!e.isReadOnly,spellCheck:a,onClick:e.onClick,onChange:e.onChange,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:e.onKeyDown,onKeyPress:e.onKeyPress,placeholder:e.placeholder,tabIndex:e.tabIndex})}});t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(3),l=(a(29),a(8)),d=(a(23),o.a.createClass({displayName:"FancyInputNumber",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){var e={value:this.props.value||0,tempValue:void 0};this.createObservables(e)},componentWillReceiveProps:function(e){e.value!==this.state.value&&this.value.set(e.value)},setValue:function(e){try{i.default.PAssert(2579,i.default.isNumber(e),"Must only report a numerical value")}catch(e){i.default.reportError(e)}this.value.get()!==e&&(this.tempValue.set(void 0),this.value.set(e),this.props.onChange&&this.props.onChange(e))},focus:function(){this.refs.input.focus()},blur:function(){this.refs.input.blur()},onFocus:function(){i.default.vmMain.activeInput.set(this)},onBlur:function(){i.default.vmMain.activeInput.set(null),void 0!==this.tempValue.get()&&(this.refs.input.value=this.value.get(),this.tempValue.set(void 0))},onMouseDown:function(){l.a.reset()},interval:function(){return this.props.interval||1},onClickUp:function(){var e=Math.min(this.value.get()+this.interval(),this.props.maxValue||1/0);this.setValue(e)},onClickDown:function(){var e=Math.max(this.value.get()-this.interval(),this.props.minValue||0);this.setValue(e)},onChange:function(){var e=this.props.parseFn||i.default.parseInt,t=this.refs.input.value,a=e(t);isNaN(a)?this.tempValue.set(t):this.setValue(a)},render:function(){var e=this.state,t=this.props,a=void 0!==e.tempValue?e.tempValue:e.value,r=i.default.classNames("fancyInputNumber c-border",t.className);return s.a.createElement("div",{className:r,id:t.id,style:{}},s.a.createElement("input",{className:"c-foreground",onMouseDown:this.onMouseDown,onChange:this.onChange,value:a,ref:"input",onFocus:this.onFocus,onBlur:this.onBlur}),s.a.createElement("div",{className:"fancyInputNumberButton up icon-caret-up",onClick:this.onClickUp}),s.a.createElement("div",{className:"fancyInputNumberButton down icon-caret-down",onClick:this.onClickDown}))}}));t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(3),l=a(53),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};var c=o.a.createClass({displayName:"FancyListItem",componentDisplay:r.a.ComponentDisplay.Desktop,render:function(){var e=this.props,t=e.header,a=(e.clickable,e.subtext,function(e,t){var a={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a}(e,["header","clickable","subtext"])),r=i.default.classNames("fancyListItem",{header:e.header},{clickable:!e.header&&!1!==e.clickable},{"selected c-background c-border-light":e.selected},{subtext:e.subtext},e.className);return!1!==e.ripple&&!t&&!1!==e.clickable?s.a.createElement(l.a,d({},a,{className:r}),e.children):s.a.createElement("div",d({},a,{className:r}),this.props.children)}});t.a=c},,function(e,t,a){"use strict";var i=a(0),r=(a(5),a(7),a(52),a(109)),n=a(110),s=a(111),o=function(){this._reportedQuotaError=!1,this._migrationRequired=!1,this._registeredCaches={},this._storageReady=[],this.init()};o.prototype={init:function(){this._storageReady[StorageType.InMemory]=!0,this._storageReady[StorageType.LocalStorage]=!0},getInfo:function(){return{reportedQuotaError:this._reportedQuotaError,migrationRequired:this._migrationRequired,numCaches:Object.keys(this._registeredCaches).length}},registerLocalCache:function(e,t,a,o){try{i.default.PAssert(1214,e,"Must provide a valid cache ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1215,t,"Must have a valid cache name")}catch(e){i.default.reportError(e)}var l,d=this._createCacheId(e,t);try{i.default.PAssert(1216,void 0===this._registeredCaches[d],"Must not have a previously registered cache with the same id")}catch(e){i.default.reportError(e)}switch(i.default.shouldWriteLocal()||(a=StorageType.InMemory,o&&(o.noInMemoryCache=!1,o.noMetadataInMemoryCache=!1)),a){case StorageType.InMemory:l=new r.a(d,t,o);break;case StorageType.LocalStorage:l=new s.a(d,t,o);break;case StorageType.IndexedDB:l=new n.a(d,t,o)}try{i.default.PAssert(1217,l,"Must have valid cache after creation")}catch(e){i.default.reportError(e)}return this._registeredCaches[e]=l,this._storageReady[a]&&(l.notifyCacheMetadataReady(!0),l.notifyCacheReady(!0)),l},clearLocalCache:function(e,t){var a=this._registeredCaches[e];try{i.default.PAssert(1218,a,"Must have valid local cache")}catch(e){i.default.reportError(e)}a.clearCache(),t&&a.clearMetadata()},clearLocalCaches:function(e){for(var t in this._registeredCaches)this.clearLocalCache(t,e)},clearPerDocCaches:function(e){for(var t in this._registeredCaches){this._registeredCaches[t].isPerDoc()&&this.clearLocalCache(t,e)}},_notifyIDBReady:function(e){},_createCacheId:function(e,t){return e},notifyMigrationRequired:function(){this._migrationRequired=!0},needsMigration:function(){return this._migrationRequired||5===i.default.settings.get(Settings.localDataVersion)},hasReportedQuotaError:function(){return this._reportedQuotaError},reportQuotaExceeded:function(){this._reportedQuotaError||(this._reportedQuotaError=!0,i.default.reportError(new Error("Quota exceeded!")))}},t.a=new o},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(5),s=a(4),o=a(9),l=a(19),d=a(8),c=(a(18),a(23)),u=a(80),h=a(34),f=(a.n(h),a(42)),p={None:0,OnScroll:1};function m(e){this._pane=e.pane,this._isOverview=e.isOverview,this._itemsObs=e.itemsObs,this._getItemsList=e.itemsFn,this.getHeight=e.heightFn,this.getWidth=e.widthFn,this.minItemSize=e.minItemSize,this.hasSetHeightOnce=!1,this.scrollHandler=void 0,this._mobilePadBottom=!1,this.contentSize=new o.a(0),this.paddingBottom=new o.a(0),this._timeoutPointerEvents=void 0,this.disablePointerEvents=new o.a(!1),this._direction=Direction.None,this._scrollTop=0,this._lastProcessedScrollTop=0,this._itemInfoById={},this._savedScrollOfTop={},this._indexOfTop=0,this._inViewCount=0,this._reactList=void 0,this._isMounted=!1,this._panePadding=0,this.useCustomScroller=s.a.useCustomScroller,this.cellsObs=new l.a([]),this.cells=this.cellsObs.get(),this.cellsNew=[],this._tops=[],this.scrollListeners=[],this.offscreenScrollPadding=400,this._phase=p.None,this.init()}m.prototype={init:function(){n.a.forceBind("_onListChanged",this),n.a.forceBind("_onSettingChanged",this),n.a.forceBind("_onResize",this),n.a.forceBind("_onScroll",this),n.a.forceBind("_handleScroll",this),n.a.forceBind("handleItemTextChanged",this),n.a.forceBind("handleItemBoldChanged",this),n.a.forceBind("handleItemNoteSet",this),n.a.forceBind("_onTimeoutPointerEvents",this),n.a.forceBind("_computeRenderItemsBatched",this),n.a.forceBind("_onSetScrollComplete",this),n.a.forceBind("_onSetScrollCompleteTimeout",this),n.a.forceBind("_afterSetScrollComplete",this),n.a.forceBind("reMount",this)},getID:function(){return this._pane.id+(this._isOverview?"_o":"")},notifyInit:function(e){this._pane.setIgnoreRestoreScroll();try{i.default.PAssert(1582,!this._isMounted,"Should not initialize a pane twice")}catch(e){i.default.reportError(e)}this.clearCache(),this.allocateCells(),this._onListChanged(),this._isMounted=!0,this._reactList=e,this._listenToItemsList(this._onListChanged),this._pane.rect.listen(this._onResize),this._pane.topBoxHeight.listen(this._onListChanged),i.default.settings.listen("settingChanged",Settings.UISettingsGroup,this._onSettingChanged)},notifyUnmounted:function(){n.a.destroy(this),this._isMounted=!1,this.isDelayingMounts=!1,this._unlistenToItemsList(this._onListChanged),this._pane.rect.unlisten(this._onResize),this._pane.topBoxHeight.unlisten(this._onListChanged),i.default.settings.unlisten("settingChanged",Settings.UISettingsGroup,this._onSettingChanged),clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=void 0,this.removeNativeScrollListener(this._onScroll),this._reactList=void 0,this.useCustomScroller&&(this.iScroller.destroy(),this.iScroller=void 0),i.default.clearTimeoutOnce("afterScroll"+this.getID()),i.default.clearTimeoutOnce("listSettingChanged_"+this.getID()),this._isOverview||(this._pane=void 0)},allocateCells:function(){var e=this.cells.length,t=Math.ceil((s.a.windowHeight()+2*this.offscreenScrollPadding)/this.minItemSize())+4;if(t>e){for(var a=this.cells,i=e;i<t;i++){var r=new u.a;a.push(r)}this.cellsObs.set(a),this.cells=this.cellsObs.get()}},setupScroller:function(e,t){this.scrollElement=e,this.useCustomScroller&&this.setupCustomScroller(e,t),this.addNativeScrollListener(this._onScroll),this.useCustomScroller&&setTimeout(this.refreshScrollListener.bind(this))},setupCustomScroller:function(e,t){var a;this.iScroller=i.default.createCustomScroller(e),this.iScroller.on("scrollStart",function(){s.a.ios&&(a=i.default.isKeyboardOpen?c.a.getSelectionRange(!0):null,i.default.addClass(t,"preventSelect"))}.bind(this)),this.iScroller.on("scrollEnd",function(){this._onSetScrollComplete(),s.a.ios&&(!a&&i.default.isKeyboardOpen&&(a=c.a.getSelectionRange(!0)),setTimeout(function(){i.default.removeClass(t,"preventSelect"),a&&(c.a.setSelectionRange(a),a=null)},0))}.bind(this))},clearItemInfoForItem:function(e){var t=this._itemInfoById;if(t[e.id])t[e.id].needsUpdate=!0;else for(var a in t)t.hasOwnProperty(a)&&t[a].paneObject.item===e&&(t[a].needsUpdate=!0)},handleItemNoteSet:function(e){this.clearItemInfoForItem(e.item)},handleItemBoldChanged:function(e){try{i.default.PAssert(1583,!this._isOverview,"Overviews should never listen to bold changes")}catch(e){i.default.reportError(e)}var t=e.item;this.clearItemInfoForItem(t)},handleItemTextChanged:function(e){try{i.default.PAssert(1584,!this._isOverview,"Overviews should never listen to text changes")}catch(e){i.default.reportError(e)}if(this._pane!==i.default.focusedPane){var t=this._pane,a=e.item;if(t.isItemInPane(a)){var r=this.indexOfItem(a);this.checkHeightChanged(a,r)?(this.clearItemInfoForItem(a),t.setItemsDirty(),i.default.vmMain.updateAllItems(),window.__TEXT_CHANGED_UPDATES.CausedUpdate++):window.__TEXT_CHANGED_UPDATES.NoUpdate++}else this.clearItemInfoForItem(a),window.__TEXT_CHANGED_UPDATES.PaneSkipped++}},getElementAtIndex:function(e){return this._reactList.getElementAtIndex(e)},isIndexMounted:function(e){return this._reactList.isIndexMounted(e)},hasItems:function(){return this._getItemsList().length>0},numItems:function(){return this._getItemsList().length},indexOfTop:function(){return this._indexOfTop},inViewCount:function(){return this._inViewCount},objectAtTop:function(){var e=this._getItemsList(),t=this.indexOfTop(),a=t>=0&&t<e.length;try{i.default.PAssert(1585,a,"Item at top is not in range",t,e.length)}catch(e){i.default.reportError(e)}return e[t]},itemAtTop:function(){var e=this.objectAtTop();return e&&(i.default.isVMLI(e)?e:e.item)},indexPageUp:function(e){for(var t=this.size.height,a=0,i=e-1;i>=0;--i){if((a+=this._sizes[i])>t)return i+1}return 0},indexPageDown:function(e){for(var t=this.size.height,a=0,i=this._sizes.length,r=e;r<i;++r){if((a+=this._sizes[r])>t)return r}return Math.max(i-1,0)},_listenToItemsList:function(e){this._itemsObs.listen(e)},_unlistenToItemsList:function(e){this._itemsObs.unlisten(e)},objectAtIndex:function(e){var t=this._getItemsList();try{i.default.PAssert(1586,e>=0&&e<t.length,"Invalid item index: "+e,t.length,this._pane.type)}catch(e){i.default.reportError(e)}return t[e]},itemAtIndex:function(e){var t=this._getItemsList();try{i.default.PAssert(1587,e>=0&&e<t.length,"Invalid item index: "+e,t.length,this._pane.type)}catch(e){i.default.reportError(e)}var a=t[e];return a&&(i.default.isVMLI(a)?a:a.item)},sizeAtIndex:function(e){return this._pane.sizeAtIndex(e,this._isOverview)},addPadding:function(){this.useCustomScroller?(this._panePadding=s.a.windowHeight()-2*i.default.topBarHeight,this.refreshScrollListener()):(this._mobilePadBottom=!0,this._computeContentSize(!0))},removePadding:function(){if(this.useCustomScroller){var e=this.iScroller;this._panePadding=0,this.refreshScrollListener(),e&&e.y<e.maxScroll&&this.iScroller.scrollTo(0,e.maxScroll,200)}else this._mobilePadBottom=!1,this._computeContentSize(!0)},addNativeScrollListener:function(e){this.useCustomScroller?this.iScroller.on("scroll",e):s.a.addPassiveListener(this.scrollElement,"scroll",e)},removeNativeScrollListener:function(e){this.useCustomScroller?this.iScroller.off("scroll",e):this.scrollElement&&this.scrollElement.removeEventListener("scroll",e)},addScrollListener:function(e){this.scrollListeners.push(e)},removeScrollListener:function(e){try{i.default.PAssert(1588,this.hasScrollListener(e),"Removing a listener that does not exist")}catch(e){i.default.reportError(e)}this.scrollListeners.remove(e)},hasScrollListener:function(e){return this.scrollListeners.indexOf(e)>=0},refreshScrollListener:function(){if(this.useCustomScroller&&this.iScroller){var e=this.contentSize.get();this.iScroller.manualRefresh(e+this._panePadding)}},getScrollOffset:function(){if(this._isMounted){if(this.useCustomScroller){var e=this._pane.orientation.get()===r.a.Orientation.Vertical?"y":"x";return this.iScroller?-this.iScroller[e]:0}if(this.scrollElement){e=this._pane.orientation.get()===r.a.Orientation.Vertical?"scrollTop":"scrollLeft";return this.scrollElement[e]}return 0}return 0},getScrollSize:function(){return Math.max(this.contentSize.get()+(i.default.noPanePadding?0:200),0)},getMaxScrollOffset:function(){var e=this._pane.orientation.get()===r.a.Orientation.Vertical?this.getHeight():this.getWidth();return Math.max(this.getScrollSize()-e,0)},setScrollOffset:function(e,t,a){try{i.default.PAssert(1589,this.scrollElement,"Pane must have loaded a scrollable element")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1590,i.default.isNumber(e),"Must supply a valid scroll offset")}catch(e){i.default.reportError(e)}if(this.scrollElement&&this._pane){t=t||ScrollDuration.Snap;var n=this.getScrollOffset();this.getMaxScrollOffset();if(e<0&&(e=0),this._isMounted&&this._scrollingTo!==e){this._scrollingTo=t?e:void 0,this._isSettingScroll=!0;var s,o,l=this._pane.orientation.get()===r.a.Orientation.Vertical;this.useCustomScroller?(s=l?0:-e,o=l?-e:0,this.iScroller.scrollTo(s,o,t),t||this.iScroller._execEvent("scroll"),a&&(t?setTimeout(a,t):a())):(s=l?void 0:e,o=l?e:void 0,i.default.scrollTo(s,o,t,this.scrollElement,function(){this._onSetScrollComplete(),a&&a()}.bind(this)))}else a&&(a(),i.default.timeoutOnce("setScrollComplete_"+this.getID(),this._onSetScrollComplete,0));return e-n}},_onSetScrollComplete:function(){this._restoringScroll?this._afterSetScrollComplete():i.default.timeoutOnce("scrollCompleteTimeout_"+this.getID(),this._onSetScrollCompleteTimeout,60)},_onSetScrollCompleteTimeout:function(){this._isMounted&&this.saveScrollOfTop(!0),this._afterSetScrollComplete()},_afterSetScrollComplete:function(){this._scrollingTo=void 0,this._isSettingScroll=!1},_computeContentSize:function(e){var t=this.getPaddingTop(),a=t,r=this._getItemsList(),n=this._pane.getItem().levelsDeep.get();this._sizes=[],this._tops=[];for(var s=0;s<r.length;++s){var o,l=r[s],d=r[s].item||l,c=i.default.isVMLI(d),u=this._itemInfoById[l.id],h=c?d.levelsDeep.get()-n:void 0;u&&!u.needsUpdate&&u.levelsDeep===h&&isNaN(l.sizePad)?o=u.size:(o=this.sizeAtIndex(s),u=this._itemInfoById[l.id]={size:o,levelsDeep:h,paneObject:l,needsUpdate:!1}),this._sizes[s]=o,this._tops[s]=s>0?this._tops[s-1]+this._sizes[s-1]:t,u.previousTop=u.top,u.top=this._tops[s],a+=u.size}return this.contentSize.set(a,e),this.useCustomScroller&&this.refreshScrollListener(),a},flushTimeoutPointerEvents:function(){this._timeoutPointerEvents&&(clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=void 0,this._onTimeoutPointerEvents())},_onTimeoutPointerEvents:function(){this._pane.isDestroyed()||(this.disablePointerEvents.set(!1),this.killAllDeadCells(),this._isSettingScroll||this._wasSettingScroll||this.saveScrollOfTop(),this._scrollingTo=void 0,this._wasSettingScroll=!1)},reMount:function(){this.isDelayingMounts=!1,this.fireEvent("reMount",[])},_onScroll:function(e){if(!e||!i.default.findParent(e.target,"preventScrollPropagate")){this._restoringScroll&&!this._isSettingScroll||(this._prevScrollTop=this._scrollTop,this._scrollTop=this.getScrollOffset(),this._handleScroll());for(var t=0;t<this.scrollListeners.length;t++)this.scrollListeners[t](e)}},_handleScroll:function(){if(this._phase=p.OnScroll,d.a.isMouseDown()||(this._prevScrollTop!==this._scrollTop&&this.disablePointerEvents.set(!0),this._timeoutPointerEvents&&clearTimeout(this._timeoutPointerEvents),this._wasSettingScroll=this._isSettingScroll,this._timeoutPointerEvents=setTimeout(this._onTimeoutPointerEvents,50),0===this._scrollTop&&0!==this._prevScrollTop&&this.saveScrollOfTop()),d.a.isMouseDown()||(this.isDelayingMounts=!0,i.default.timeoutOnce("afterScroll"+this.getID(),this.reMount,150)),i.default.tooltip.hideTip(),d.a.hoveredItem&&d.a.setHovered(this,null,null),this._scrollTop!==this._prevScrollTop){this._direction=this._scrollTop>this._prevScrollTop?Direction.Down:Direction.Up;var e=Math.abs(this._scrollTop-this._lastProcessedScrollTop);if(this.alwaysRenderScroll||e>=this.offscreenScrollPadding/2)this._lastProcessedScrollTop=this._scrollTop,this._computeRenderItems();else this.updateTopIndex()}this.scrollHandler&&this.scrollHandler(this._scrollTop),this._phase=p.None},_updateSize:function(){this.size={width:this._pane.getWidth(),height:this._pane.getHeight()}},_onListChanged:function(){if(this._needsResize)return this._needsResize=!1,void this._onResize(void 0,void 0,!0);this.rect=this._pane.rect.get(),this._updateSize(),this.killAllDeadCells(),this._computeContentSize(!1),this._computeRenderItems(this._isMounted)},_onSettingChanged:function(e){this._needsResize=!0,i.default.timeoutOnce("listSettingChanged_"+this.getID(),this._onResize,0,void 0,void 0,!0)},_onResize:function(e,t,a){i.default.clearTimeoutOnce("listSettingChanged_"+this.getID()),this._needsResize=!1;var n=this.rect?this.rect.width:-1,s=this.rect?this.rect.height:-1;a||e&&(e.width!==n||e.height!==s)?(this._updateSize(),this.clearCache(),this.allocateCells(),i.default.vmMain.setItemAnimationMode(r.a.ItemAnimationMode.None),this._onListChanged(),i.default.vmMain.resetItemAnimationMode(),d.a.getPane()===this._pane&&d.a.updateCaret()):this._updateSize()},saveScrollOfTop:function(e){this._savedScrollOfTop;if(this.numItems()>0&&!this._pane.isIgnoringRestoreScroll()){for(var t,a,i=[],r=this.numItems(),n=e?this.getScrollOffset():this._scrollTop,s=this._indexOfTop;s<Math.min(this._indexOfTop+this._inViewCount-1,r);s++){t=this.objectAtIndex(s),(a=n-this.topOfIndex(s))-this._sizes[s]<-this.getPaddingTop()&&i.push({index:s,paneObject:t,scrollOffset:a})}this._savedScrollOfTop.inView=i}},restoreScrollOfTop:function(){var e=this._savedScrollOfTop;if(!this._pane.isIgnoringRestoreScroll()&&this._pane._didInitialScroll){if(e&&!i.default.isEmpty(e)){var t=e.inView;if(t)for(var a=0;a<t.length;a++){var r=t[a];if(this.restoreScroll(r))break}this._restoringScroll||this._pane.scrollToTop(ScrollDuration.Snap)}this._restoringScroll=!1}},restoreScroll:function(e){var t=this.indexOfItem(e.paneObject);if(t>=0){var a=Math.max(this.topOfIndex(t)+(e.scrollOffset||0),0),r=this.getMaxScrollOffset();return a>r&&(a=r),this._restoringScroll=!0,this._scrollTop=a,this.setScrollOffset(a,ScrollDuration.Snap),i.default.animFrameOnce("restoreScroll_"+this.getID(),function(){this.setScrollOffset(a,ScrollDuration.Snap)}.bind(this)),!0}return!1},clearCache:function(){this._itemInfoById={};for(var e=0;e<this.cells.length;e++){var t=this.cells[e];t.isLive&&(t.width=t.height=void 0)}},_isInBounds:function(e,t){var a=!1;return e>this._getPVRBottom()+this.offscreenScrollPadding||t<this._getPVRTop()-this.offscreenScrollPadding||(a=!0),a},getScrollTop:function(){return this._scrollTop},_getPVRTop:function(){return this._scrollTop},_getPVRBottom:function(){return this._scrollTop+(this._pane.orientation.get()===r.a.Orientation.Vertical?this.size.height:this.size.width)},killAllDeadCells:function(){for(var e=0;e<this.cells.length;e++){var t=this.cells[e];!t.isLive&&t.deadNeedsNotify&&t.kill(!0)}},_startCellPassOnCell:function(e){e.seenInPass=!1},startCellPass:function(){this.cellsCurrent={};for(var e=0;e<this.cells.length;e++){var t=this.cells[e];t.isLive&&(this.cellsCurrent[t.paneObject.id]=t,this._startCellPassOnCell(t))}},_pruneCellPassOnCell:function(e,t){if(!e.seenInPass||t){var a,i=e.index;(this._phase!==p.OnScroll||this._isInBounds(this._tops[i],this._tops[i]+this._sizes[i]))&&(a=!0),e.kill(a)}},pruneCellPass:function(){for(var e=0;e<this.cells.length;e++){var t=this.cells[e];t.isLive&&this._pruneCellPassOnCell(t)}},updateCell:function(e){var t=this._pane,a=this._getItemsList()[e],i=a.id,n=this.cellsCurrent[i],s=this._isOverview||this._pane.orientation.get()===r.a.Orientation.Vertical,o=this._sizes[e],l=s?t.getContentWidth():o,d=s?o:t.getContentHeight(),c=this._tops[e],u=this._itemInfoById[i],h=u&&u.previousTop;n&&!n.seenInPass?n.update(e,l,d,c,h,a):!n&&this.cellsNew.indexOfWithProperty("index",e)<0&&this.cellsNew.push({index:e,width:l,height:d,offset:c,paneObject:a,prevOffset:h})},_addPassOnCell:function(e){for(var t,a=0;a<this.cells.length;a++)if(!this.cells[a].isLive){t=this.cells[a];break}try{i.default.PAssert(1591,t,"Must always have additional cells to use",s.a.windowHeight())}catch(e){i.default.reportError(e)}t||(t=new u.a,this.cells.push(t)),t.update(e.index,e.width,e.height,e.offset,e.prevOffset,e.paneObject)},addCellPass:function(){for(var e=0;e<this.cellsNew.length;e++){var t=this.cellsNew[e];this._addPassOnCell(t)}this.cellsNew=[]},_isIndexSeen:function(e){var t=this._getItemsList()[e].id,a=this.cellsCurrent[t];return a&&a.seenInPass},_computeRenderItems:function(e){i.default.batchRenderUpdates(this._computeRenderItemsBatched,e)},_computeRenderItemsBatched:function(e){var t,a,i,r,n=this._getItemsList(),s=0;this.startCellPass(),e&&this.restoreScrollOfTop();for(var o=0;o<n.length;++o)if(t=this._tops[o],a=this._sizes[o],this._isInBounds(t,t+a))isNaN(i)&&t+a>this._getPVRTop()&&(i=o),this.updateCell(o),!isNaN(i)&&Math.round(t)<this._getPVRBottom()-2&&s++;else if(t>this._getPVRBottom())break;isNaN(i)&&(i=0),this._indexOfTop=i,this._inViewCount=s,d.a.isValid()&&this._pane===d.a.getPane()&&(r=d.a.getStartIndex())<this._sizes.length&&!this._isIndexSeen(r)&&this.updateCell(r),this.pruneCellPass(),this.addCellPass(),this._isSettingScroll||this._phase===p.OnScroll||this.saveScrollOfTop()},updateTopIndex:function(){for(var e,t,a=this._getItemsList(),i=0;i<a.length;++i)if(e=this._tops[i],t=this._sizes[i],this._isInBounds(e,e+t)&&e+t>this._getPVRTop()){this._indexOfTop=i;break}},getItemInfo:function(e){return this._itemInfoById[e]},getItemInfosForItem:function(e){var t=this._itemInfoById,a=[];if(t[e.id])a.push(t[e.id]);else for(var i in this._itemInfoById)t.hasOwnProperty(i)&&t[i].paneObject.item===e&&a.push(t[i]);return a},indexOfItem:function(e,t,a){for(var r,n=i.default.isVMLI(e),s=this._getItemsList(),o=0;o<s.length;o++){var l=s[o];if(n){if(!(l!==e&&l.item!==e||l.type&&"blockItem"!==l.type||t&&l.block.id!==t.id))return o}else{if(l.id===e.id)return o;l.item&&l.item===e.item&&(r||(r=[]),r.push({index:o,item:l}))}}if(r){if(a){var d,c;for(o=0;o<r.length;o++){var u=Math.abs(r[o].index-a);(isNaN(c)||u<d)&&(c=o,d=u)}return r[c].index}return r[0].index}return-1},topOfItem:function(e){try{i.default.PAssert(1592,e,"Must provide a valid item to measure")}catch(e){i.default.reportError(e)}var t=this.indexOfItem(e);try{i.default.PAssert(1593,t>=0,"Must supply a valid item that is in this pane")}catch(e){i.default.reportError(e)}return this.topOfIndex(t)},topOfIndex:function(e){try{i.default.PAssert(1594,e>=0,"Must supply a valid index")}catch(e){i.default.reportError(e)}return this._tops[e]},scrollIndexToTop:function(e,t,a){var i=this.topOfIndex(e);return this.setScrollOffset(i,t,a)},scrollItemToTop:function(e,t,a){try{i.default.PAssert(1595,i.default.isVMLI(e),"Must be a valid VMLI instance")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1596,i.default.isNumber(t),"Must have a valid scroll duration")}catch(e){i.default.reportError(e)}var r=this.indexOfItem(e);try{i.default.PAssert(1597,r>=0,"Must supply a valid item that is in this pane")}catch(e){i.default.reportError(e)}return this.scrollIndexToTop(r,t,a)},scrollIndexToMiddle:function(e,t,a){if(this._isMounted){var i=this.topOfIndex(e),r=this._sizes[e],n=Math.floor(i+r/2-this.getHeight()/2);return this.setScrollOffset(n,t,a)}a&&a()},scrollItemToMiddle:function(e,t,a){if(this._isMounted){var i=this.indexOfItem(e);if(i>=0)return this.scrollIndexToMiddle(i,t,a)}else a&&a()},scrollItemIntoView:function(e,t,a){if(this._isMounted){var i=this.indexOfItem(e);return this.scrollIndexIntoView(i,t,a)}a&&a()},scrollIndexIntoView:function(e,t,a){t=isNaN(t)?ScrollDuration.Default:t;try{i.default.PAssert(1598,i.default.isNumber(e),"Must supply a valid index")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1599,!a||i.default.isFunction(a),"Must supply a valid callback function")}catch(e){i.default.reportError(e)}var n=this.itemAtIndex(e);try{i.default.PAssert(1600,n,"Item does not exist to scroll to",e,this.numItems())}catch(e){i.default.reportError(e)}if(this._isMounted&&n){s.a.getKBSize();var o,l,d,c=this.topOfIndex(e),u=this.getHeight();o=u,i.default.vmMain.paneManager.hasScrollbar()&&(o-=r.a.HorizScrollbarHeight),d=(l=this.getScrollOffset())+u;var h=this._sizes[e],f=c+h,p=f>d,m=c<l;m&&h>o&&f>=d&&(m=!1);var g,v=0;return m?g=0===c?0:c:p&&(g=f-o),m||p?(v=g-l,this.setScrollOffset(g,t,function(){a&&setTimeout(a,0)})):a&&a(),v}return!1},getPaddingTop:function(){return this._isOverview?0:this._pane.topBoxHeight.get()+0},notifyDragStart:function(){this.useCustomScroller&&this.iScroller.disable()},notifyDragEnd:function(){this.useCustomScroller&&this.iScroller&&this.iScroller.enable()},notifySwappedIn:function(e){isNaN(e)||this.setScrollOffset(e)},addScrollDelta:function(e){try{i.default.PAssert(1601,this.scrollElement,"Pane must have loaded a scrollable element")}catch(e){i.default.reportError(e)}return this.setScrollOffset(this.getScrollOffset()+e)},setScrollHandler:function(e){this.scrollHandler=e},setInitialScrollOffset:function(e){this._scrollTop=e||0},checkHeightChanged:function(e,t){var a=this._pane,i=this.objectAtIndex(t),r=e.sizeInPane(a,t,!1)+(i.sizePad||0),n=this.getItemInfosForItem(e);if(n.length>0&&r!==n[0].size)return this.clearItemInfoForItem(e),!0}},n.a.defineBase(m),n.a.extend(m.prototype,f.a),t.a=m},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(9);function s(e,t,a){this._destroyed=!1,r.a.forceBind("onChanged",this);for(var n=0;n<e.length;n++)e[n].listen(this.onChanged);this._observables=e,t&&i.default.isFunction(t)?this.checkFn=t:this.checkFn="or"===t?this.checkFnOr:this.checkFnAnd;var s=this.checkFn();this._super.constructor.call(this,s,a)}r.a.inherit(n.a,s),r.a.extend(s.prototype,{checkFnOr:function(){for(var e=!1,t=0;!e&&t<this._observables.length;t++)e=e||this._observables[t].get();return e},checkFnAnd:function(){for(var e=!0,t=0;e&&t<this._observables.length;t++)e=e&&this._observables[t].get();return e},onChanged:function(e,t,a){var i=this._value,r=this.checkFn();(r!==i||a)&&this._super.set.call(this,r,a)},destroy:function(){this._destroyed=!0;for(var e=0;e<this._observables.length;++e)this._observables[e].unlisten(this.onChanged)}}),t.a=s},function(e,t,a){"use strict";var i=a(0),r=a(4),n=a(26),s=a(127),o=a(19);function l(){this.queue=new o.a,this.remoteMessages={},this.defaultMessages=[],this.defaultMessages[MessageID.Undefined]=void 0,i.default.toasts=this}l.prototype={getMessageById:function(e){void 0===this.defaultMessages[e]&&this.initMessageById(e);try{i.default.PAssert(937,void 0!==this.defaultMessages[e],"After init message should always be defined")}catch(e){i.default.reportError(e)}return this.defaultMessages[e]},testMessageById:function(e){return!!this.defaultMessages[e]},initMessageById:function(e){switch(e){case MessageID.ConnectionError:this.defaultMessages[e]=new s.a({text:"Connection error detected. Please reload to try again.",action:MessageAction.Reload},this);break;case MessageID.OfflineUndo:this.defaultMessages[e]=new s.a({text:"Offline undo/redo has been disabled temporarily.",hold:!0},this);break;case MessageID.FatalError:this.defaultMessages[e]=new s.a({text:"There was a fatal error in the application. "+r.a.actionVerbCaps()+" to restart.",action:MessageAction.Reload},this);break;case MessageID.MailbirdClick:this.defaultMessages[e]=new s.a({text:"Sorry, emails can currently only be opened from inside Mailbird.",action:MessageAction.Okay},this);break;case MessageID.ExitDemo:this.defaultMessages[e]=new s.a({text:"Changes are not saved in demo",action:MessageAction.LoginScreen,hold:!0,noIgnore:!0},this);break;case MessageID.ShareFailure:this.defaultMessages[e]=new s.a({text:"There was an error sharing the file you attached.",action:MessageAction.OpenSettings,timeout:8e3},this);break;case MessageID.ThisIsDemo:this.defaultMessages[e]=new s.a({text:"Click anywhere to try this live demo of <b>Moo.do</b>",onClose:function(){window.parent.postMessage("userInteracted","*")},hold:!0,big:!0},this);break;case MessageID.InviteFailure:this.defaultMessages[e]=new s.a({text:"Failed to use referral code. Please try again in your account settings.",action:MessageAction.OpenAccountSettings},this);break;case MessageID.InviteSuccess:this.defaultMessages[e]=new s.a({text:"You have successfully used your referral code. Enjoy your additional free trial of premium Moo.do!",action:MessageAction.Okay},this);break;case MessageID.PremiumRequired:this.defaultMessages[e]=new s.a({text:"You must be a premium subscriber to use plugins.",action:MessageAction.OpenAccountSettings,actionText:"LEARN MORE"},this);break;case MessageID.TrialOver:this.defaultMessages[e]=new s.a({text:"Your trial of Premium has come to an end. Please sign up to continue using Premium features.",action:MessageAction.OpenAccountSettings,actionText:"SETTINGS"},this);break;case MessageID.TrialEndSoon:this.defaultMessages[e]=new s.a({text:"Your trial of Premium is ending soon. Please sign up to continue using Premium features after your trial ends.",action:MessageAction.OpenAccountSettings,actionText:"SETTINGS"},this);break;case MessageID.DisabledFolderDrop:this.defaultMessages[e]=new s.a({text:"Drag/dropping folders is currently disabled while we polish some rough edges. Sorry for the inconvienience, please contact support@moo.do if you need this.",action:MessageAction.Okay},this);break;case MessageID.WarnLargeFile:this.defaultMessages[e]=new s.a({text:"Warning: You are uploading a large file. If the upload is not successful, try uploading directly to Google Drive.",action:MessageAction.OpenGoogleDrive},this);break;case MessageID.InviteInvalid:this.defaultMessages[e]=new s.a({text:"Invalid referral code. Please try again in your account settings.",action:MessageAction.OpenAccountSettings,actionText:"OKAY"},this);break;case MessageID.NoSharingWarning:this.defaultMessages[e]=new s.a({text:"You have shared your document with someone else, however the files attached have not been shared due to your permissions settings.",action:MessageAction.OpenSettings,actionText:"SETTINGS"},this);break;case MessageID.LostPermission:this.defaultMessages[e]=new s.a({text:"Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings.",action:MessageAction.OpenSettings,actionText:"SETTINGS"},this);break;case MessageID.CalendarSync:this.defaultMessages[e]=new s.a({text:"There was an error syncing your calendars.",action:MessageAction.OpenSettings,actionText:"SETTINGS"},this);break;case MessageID.EmailSendFail:this.defaultMessages[e]=new s.a({text:"Your email was not sent, there was an error contacting the remote server."},this);break;case MessageID.EmailUpdateFail:this.defaultMessages[e]=new s.a({text:"Unable to save draft to Gmail. Your draft is still saved locally."},this);break;case MessageID.EmailLabelFail:this.defaultMessages[e]=new s.a({text:"Unable to sync you changes to Gmail. Your changes are still saved locally."},this);break;case MessageID.EmailSyncFail:this.defaultMessages[e]=new s.a({text:"There was an error syncing your Gmail data.",action:function(){i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail).runThreadSync()},actionText:"RETRY"},this);break;case MessageID.OldUserNewTrial:this.defaultMessages[e]=new s.a({text:"You have been started on a premium free trial. Enable premium plugins for free!",action:MessageAction.OpenSettings,actionText:"SETTINGS"},this);break;case MessageID.DemoPluginClick:this.defaultMessages[e]=new s.a({text:"Outside of demo mode this would show you more information about the plugin.",timeout:3e3},this);break;case MessageID.PromptScriptStart:this.defaultMessages[e]=new s.a({text:"Start demo",hold:!0,big:!0,action:MessageAction.StartDemo},this);break;case MessageID.SnoozeOffline:this.defaultMessages[e]=new s.a({text:"You must be online to Snooze. Please try again when Moo.do has connected.",action:MessageAction.Okay},this);break;case MessageID.NeedDrivePermission:this.defaultMessages[e]=new s.a({text:"Attaching files already in Drive requires 'Shared Drive' to be enabled in settings.",action:MessageAction.OpenSettings},this);break;case MessageID.NeedGmailPermission:this.defaultMessages[e]=new s.a({text:"Sending email requires the Gmail plugin to be enabled in settings.",action:MessageAction.OpenSettings},this);break;case MessageID.LostLinked:this.defaultMessages[e]=new s.a({text:"Moo.do has lost access to one of your linked accounts.",action:MessageAction.OpenLinkedSettings},this);break;case MessageID.GmailDisabled:this.defaultMessages[e]=new s.a({text:"Gmail may not be enabled on your Google account. Please contact your domain admin or reload app.",action:MessageAction.Okay},this);break;case MessageID.LocalWritesDisabled:this.defaultMessages[e]=new s.a({text:"There was an error writing to the local cache. Please restart Moo.do.",action:MessageAction.Reload},this);break;case MessageID.MissingOffline:this.defaultMessages[e]=new s.a({text:"We are missing authorization for your account. Please disable and re-enable 'Offline Features'.",action:MessageAction.OpenSettings},this);break;case MessageID.MissingOfflineMobile:this.defaultMessages[e]=new s.a({text:"We are missing authoriziation for your account. Tap to reauthorize or visit settings.",action:function(){n.a.toggleOfflineFeatures(!0)},actionText:"Reauthorize"},this);break;case MessageID.FlatSearchMultiSelect:this.defaultMessages[e]=new s.a({text:"Editing multiple items in flat search results is not supported because it would have unpredictable results."},this);break;case MessageID.FlatSearchEnter:this.defaultMessages[e]=new s.a({text:"Pressing Enter in flat search results is not supported because it would have unpredictable results."},this);break;case MessageID.FlatSearchTab:this.defaultMessages[e]=new s.a({text:"Indenting search results while in flat search results is not supported because it would have unpredictable results."},this);break;case MessageID.ReadOnlyCalendar:this.defaultMessages[e]=new s.a({text:"You do not have write permission for the calendar you are trying to modify."},this);break;case MessageID.CalendarSaveFail:this.defaultMessages[e]=new s.a({text:"Some changes you made were not able to be saved properly. Please free up disk space and try again."},this);break;case MessageID.QuotaError:this.defaultMessages[e]=new s.a({text:"You have run out of disk space. Moo.do will be unable to operate offline.",timeout:3e3},this);break;case MessageID.ReselectEmail:this.defaultMessages[e]=new s.a({text:"Please re-select the email item and try again."},this);break;case MessageID.ReactError:this.defaultMessages[e]=new s.a({text:"The application has encountered an error. The developers have been notified, but sending a bug report would be very helpful!",actionText:"REPORT",action:function(){i.default.menus.openModalNew(Modals.ReportBug)}},this);break;default:try{i.default.PAssert(938,!1,"Invalid MessageID: ",e)}catch(e){i.default.reportError(e)}}},pushMessage:function(e){try{i.default.PAssert(939,e,"Must supply a valid message to display")}catch(e){i.default.reportError(e)}var t;if(e instanceof s.a)t=e;else if(i.default.isObject(e))t=new s.a(e,this);else if(i.default.isString(e))t=new s.a({text:e},this);else if(!(t=this.getMessageById(e))){try{i.default.PAssert(940,!1,"Invalid data passed to message creation")}catch(e){i.default.reportError(e)}log("Message not created properly",e)}return t&&t.show(),t},clearMessage:function(e){var t;return e instanceof s.a?t=e:this.testMessageById(e)&&(t=this.getMessageById(e)),t&&t.hide(),t},isMessageVisible:function(e){var t=!1;e instanceof s.a?t=e.isVisible():this.testMessageById(e)&&(t=this.getMessageById(e).isVisible());return t},onMessageShow:function(e){try{i.default.PAssert(941,e,"Must pass in a valid message to add to the queue")}catch(e){i.default.reportError(e)}try{i.default.PAssert(942,e&&e.doAction,"Message added to queue must have valid API exposed - doAction")}catch(e){i.default.reportError(e)}e instanceof s.a?this.queue.push(e):i.default.reportError(new Error("Toast message must be an instance of Toast"),e)},onMessageHide:function(e){try{i.default.PAssert(943,e,"Must pass in a valid message to be removed from the queue")}catch(e){i.default.reportError(e)}var t=this.queue.indexOf(e);if(t<0)try{i.default.PAssert(944,!1,"Trying to remove an invalid message from the queue")}catch(e){i.default.reportError(e)}else this.queue.splice(t,1)}},t.a=new l},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=(a(5),a(50),a(20),a(11)),c=a(18),u=a(170),h=a(171),f=a(91),p=a(176),m=a(92),g=a(185),v=a(32),y=(a(6),a(37),l.a.createClass({displayName:"ReactPane",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.props.pane.isDefaultPane;this.createObservables({dragOffset:0})},componentDidMount:function(){var e=this.props.pane,t=e.scrollElement=this.refs.scroller.getScrollElement(),a=e.rootElement=this.refElement("rootElement"),r=e.paneContent=this.refElement("contentElement"),s=e.getInfiniteList(!1);e.element=this.refs.pane,s.setupScroller(t,r),s.setScrollHandler(this.onScroll),a.addEventListener("compositionstart",e.compositionStart),a.addEventListener("compositionend",e.compositionEnd),n.a.android||a.addEventListener("input",e.onInput),this.setData(e.element,e),i.default.setupClick(this.refs.scroller.getElement(),e,e.onTap),e.onLoad(),e.getOverview().onPaneLoad(),d.a.fireEvent("paneAdded",[e])},getState:function(){var e,t=this.props.pane;return t.isDestroyed()?e={}:(e={rect:t.rect,left:t.getLeft(),isExpanded:t.isExpanded,isActive:t.isActive,isOverviewVisible:t.overview.isVisible,isHelpVisible:!!i.default.intro&&i.default.intro.isVisible,item:t.item,paneTopText:t.paneTopText,orientation:t.orientation,titles:t.getTitleList(),showScrollbars:t.showScrollbars}).parents=t.getItem().parents(),e},itemsObs:function(){return this.props.pane.items},getScrollSize:function(){return this.props.pane.getInfiniteList(!1).getScrollSize()},getClientHeight:function(){return this.props.pane.getHeight()},getScrollTop:function(){return this.props.pane.getInfiniteList(!1).getScrollTop()},onScroll:function(){this.refs.scroller&&this.refs.scroller.handleScroll()},startDragging:function(e){i.default.hasClass(e.target,"paneDraggable")&&i.default.vmMain.paneManager.paneCount()>1&&(this.hasMovedDrag=!1,this.dragStartX=e.clientX-this.props.pane.rect.get().left,document.addEventListener("mousemove",this.onDragMove),document.addEventListener("mouseup",this.onDragUp))},onDragMove:function(e){this.hasMovedDrag||(this.hasMovedDrag=!0,c.a.isDraggingPane.set(!0),i.default.addClass(this.refs.pane,"dragging"));var t=this.props.pane.rect.get(),a=e.clientX-this.dragStartX-t.left;this.updateDragOffset(a),i.default.vmMain.paneManager.dragPaneTo(this.props.pane,t.left+a,t.right+a)&&this.updateDragOffset(e.clientX-this.dragStartX-this.props.pane.rect.get().left)},onDragUp:function(){c.a.isDraggingPane.set(!1),i.default.removeClass(this.refs.pane,"dragging"),document.removeEventListener("mousemove",this.onDragMove),document.removeEventListener("mouseup",this.onDragUp),this.updateDragOffset(0)},updateDragOffset:function(e){this.dragOffset.set(e)},renderScrollerWrapper:function(e,t){return o.a.createElement(o.a.Fragment,null,t.children)},onTouchMove:function(e){},onMouseMovePaneBlocker:function(e){0},onMouseUpPaneBlocker:function(e){0},onClickPaneBlocker:function(e){0},renderCell:function(e,t){var a=this.props.pane;return o.a.createElement(m.a,{key:e,list:a.getInfiniteList(!1),pane:a,orientation:this.state.orientation,cell:t})},render:function(){var e,t=this.props,a=this.state,s=t.pane,l=i.default.classNames("pane c-border",s.paneClass,t.className,{overviewOpen:a.isOverviewVisible},{expanded:a.isExpanded},{none:!a.isActive},{hasTitles:a.parents.length>0},{horizontal:a.orientation===r.a.Orientation.Horizontal},{vertical:a.orientation!==r.a.Orientation.Horizontal},{oneRow:1===a.titles.length&&!s.showRootOnRow2},{"flexbox flexvert":!1},{firstPane:a.rect.isFirst}),d=i.default.classNames("paneScroller belowHeader c-background",{customScroller:s.useCustomScroller},"f1"),c=i.default.classNames("paneRoot"),m=i.default.classNames("paneContent",{editable:s.isWriteable});s.topBoxHeight.get()>0&&(e=a.paneTopText?o.a.createElement("span",{className:"loadingText"},a.paneTopText):this.getChildByKey("topBox"));var y,S=o.a.createElement(f.a,{owner:s.getInfiniteList(!1),pane:s,overview:!1,renderCell:this.renderCell,itemsObs:t.itemsObs,hiddenInput:!0,contentClass:m,minItemHeight:t.minItemHeight,orientation:a.orientation,ref:"contentElement"},s.topBoxHeight.get()>0&&o.a.createElement("div",{key:"topBox",className:"paneTopBox c-background"},e)),E=s.isWriteable?o.a.createElement(p.a,{pane:s}):null,P={width:a.rect.width};n.a.isFirefox&&!i.default.isRunningScript()?(P.left=a.left,a.dragOffset&&(P[n.a.transform.react]="translate3d("+a.dragOffset+"px,0,0)")):P[n.a.transform.react]="translate3d("+Math.round(a.left+(a.dragOffset||0))+"px,0,0)";var b={};return o.a.createElement("div",{key:"pane","data-moo-id":this.getUniqueID(),ref:"pane",className:l,style:P},o.a.createElement(u.a,{observe:b,render:this.renderScrollerWrapper},o.a.createElement(h.a,{pane:s,startDragging:this.startDragging},this.getChildByKey("headerButtons")),o.a.createElement(v.a,{className:d,style:y,getScrollSize:this.getScrollHeight,getClientHeight:this.getClientHeight,getScrollTop:this.getScrollTop,noOwnScroll:!0,orientation:a.orientation,showScrollbars:a.showScrollbars,ref:"scroller"},o.a.createElement("div",{className:c,ref:"rootElement",onTouchMove:this.onTouchMove},S,E,o.a.createElement(g.a,{pane:s}))),!1),this.getChildByKey("topButtons"),this.getChildByKey("overlay"))}}));t.a=y},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(23),d=a(6),c=a(21),u=o.a.createClass({displayName:"ReactInviteSection",componentDisplay:r.a.ComponentDisplay.Desktop,getState:function(){var e=i.default.billingManager;return{validBilling:e._hasValidBillingData,premiumStatus:e._premiumStatus,inviteEmailSuccess:e.inviteEmailSuccess,inviteEmailError:e.inviteEmailError,inviteCodeError:e.inviteCodeError}},onTapInviteUrl:function(e){var t=e.target;t!==document.activeElement&&(l.a.selectElement(t),e.preventDefault(),i.default.sendEvent("Billing","TapInviteUrl"))},inviteEmails:function(){for(var e=this.refs.inviteEmails.getTokens(),t=[],a=0;a<e.length;a++)t.push(e[a].email);i.default.billingManager.sendInviteEmail(t)},render:function(){var e=i.default.billingManager,t=this.state;return s.a.createElement("span",{className:"new-modal-group"},s.a.createElement("div",{className:"new-modal-title"},s.a.createElement("div",{className:"title"},"Share Moo.do with your friends"),s.a.createElement("div",{className:"subtext center"},"Thank you for spreading the ",s.a.createElement("i",{className:"icon-heart red"}))),s.a.createElement("div",{className:"new-modal-center"},s.a.createElement("div",null,s.a.createElement("div",{className:"subtitle"},"Social"),s.a.createElement("span",{className:"shareIcons"},s.a.createElement(d.a,{iconSize:22,icon:"icon-twitter",tooltip:"@MooDoApp",onClick:e.shareTwitter.bind(e)}),s.a.createElement(d.a,{iconSize:22,marginLeft:16,marginRight:16,icon:"icon-facebook",tooltip:"@MooDoApp",onClick:e.shareFacebook.bind(e)}),s.a.createElement(d.a,{iconSize:22,icon:"icon-google-plus",tooltip:"@MooDoApp",onClick:e.shareGoogle.bind(e)})),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("div",{className:"subtitle"},"Share Link"),s.a.createElement("div",{className:"subtext"},e.getSelectText()),s.a.createElement(c.a,{display:"inline-block",width:280,height:36,value:e.getInviteUrl(),onMouseDown:this.onTapInviteUrl,readonly:!0}),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("div",{className:"subtitle"},"Share by email"),s.a.createElement("div",{className:"subtext"},"Separate multiple email addresses with commas."),s.a.createElement(c.a,{ref:"inviteEmails",width:350,buttonWidth:70,height:36,autocompleteMode:"email",placeholder:"Add friends' email addresses",buttonText:"SEND",onButtonClick:this.inviteEmails}),(t.inviteEmailSuccess||t.inviteEmailError)&&s.a.createElement("div",{id:"inviteEmailMessage",className:i.default.classNames({success:t.inviteEmailSuccess},{error:t.inviteEmailError})},t.inviteEmailSuccess||t.inviteEmailError))))}});t.a=u},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(3),l=a(8),d=a(47),c=a(28),u=a(23),h=a(25),f=a(18),p=a(97),m=a(14),g=a(21),v=a(221),y=a(6),S=o.a.createClass({displayName:"ReactEmailCompose",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){var e=this.props;this._dragEnterCounter=0,this._escapedFromDrag=!1,this.to=this._createTokensFromAddressText(e.message.to),this.cc=this._createTokensFromAddressText(e.message.cc);var t=!!e.message.cc&&e.message.cc.length>0;if(this.createObservables({showSubject:e.showSubject||!1,showCc:t,showBcc:!1,isSending:!1,isDragOver:!1}),this.listenTo(m.a.onAccountsUpdated),this.props.message.inReplyTo){var a=this.props.threadAttach.getData().messages,r=a.indexOfWithProperty("messageID",this.props.message.inReplyTo);if(r>=0){var n=a[r];try{i.default.PAssert(2667,n.initializedForDisplay,"Message must be ready to display if being replied to")}catch(e){i.default.reportError(e)}n&&n.responseMode&&(this.modeListener=n.responseMode.listen(this.onReplyModeChanged))}}i.default.isDemoMode()&&(i.default.reactEmailCompose=this)},onReplyModeChanged:function(){this.to=this._createTokensFromAddressText(this.props.message.to),this.cc=this._createTokensFromAddressText(this.props.message.cc),this.cc&&this.cc.tokens&&this.cc.tokens.length>0&&this.showCc.set(!0),this.updateState()},_getHotkeys:function(){return[h.a.create(KeyCode.Escape,!0,r.a.Primary.Either,r.a.Shift.Either,this.onEscape),h.a.create(KeyCode.Enter,!0,r.a.Primary.Yes,r.a.Shift.Either,this.send),h.a.create(KeyCode.K,!0,r.a.Primary.Yes,r.a.Shift.No,this.insertLinkHotkey)]},getState:function(){return{attachments:this.props.threadAttach.getPlugin().getMessageDisplayAttachments(this.props.message),fromAccounts:this.getSendingAccounts()}},componentDidMount:function(){var e=this._getComposeBody(this.props.message);e&&this.refs.body.setValue(e),this.refs.container.addEventListener("cdrop",this.onItemDrop);var t=this;this.refs.picker.addEventListener("change",function(){return t.props.threadAttach.getPlugin().notifyAttachFiles(t.props.threadAttach,t.props.message,this.files,t.onAttachUpdated),this.value=null,!1},!1),this.refs.container.addEventListener("paste",function(e){var a=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;if(a&&a.items&&a.items.length>0){for(var i=[],r=0;r<a.items.length;++r)"file"===a.items[r].kind&&i.push(a.items[r].getAsFile());if(i.length>0)return t.props.threadAttach.getPlugin().notifyAttachFiles(t.props.threadAttach,t.props.message,i,t.onAttachUpdated),!1}},!1),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown)},onUnmount:function(){this.modeListener&&(this.modeListener.dispose(),this.modeListener=void 0),this._clearDraftDebounce(!0,!0),document.removeEventListener("mouseup",this.onMouseUp)},discard:function(){this.close(!1,!0,!0)},onEscape:function(){this.isDragOver.get()||(this.refs.to.getTokens().length>0||this.refs.body.getValue()||this.state.attachments.length>0?i.default.menus.confirm("Do you want to discard this draft?",function(e){e&&this.discard()}.bind(this)):this.discard())},send:function(){this.onClickSend()},onFocus:function(){this.__hotkeys||(this.__hotkeys=h.a.pushStack(this._getHotkeys())),l.a.clearSelection()},onBlur:function(){this.__hotkeys&&(h.a.popStack(this.__hotkeys),this.__hotkeys=void 0)},onClickAttach:function(){this.refs.picker.click()},onAttachUpdated:function(e){this._isMounted&&(this.onDraftChanged(),e&&this._clearDraftDebounce(!0,!0),this.updateState())},onDragEnter:function(e){e.preventDefault(),this._escapedFromDrag||(this._dragEnterCounter++,this.isDragOver.set(!0))},onDragLeave:function(){this._dragEnterCounter--,0===this._dragEnterCounter&&this.isDragOver.set(!1)},onMouseUp:function(){this._escapedFromDrag=!1,this.isDragOver.set(!1)},onKeyDown:function(e){e.keyCode===KeyCode.Escape&&this.isDragOver.get()&&(this._escapedFromDrag=!0,this.isDragOver.set(!1))},onFileDrop:function(e){if(!this._escapedFromDrag){this.isDragOver.set(!1);var t=e.dataTransfer;if(t.files&&t.files.length>0)this.props.threadAttach.getPlugin().notifyAttachFiles(this.props.threadAttach,this.props.message,t.files,this.onAttachUpdated.bind(this)),e.preventDefault(),e.stopPropagation(),f.a.stop(),f.a.finish()}},onItemDrop:function(e){if(e.item&&e.item.hasAttachmentType(r.a.PluginType.Storage)){var t=e.item.getAttachmentByType(r.a.PluginType.Storage);this.props.threadAttach.getPlugin().notifyAttachLinkedFile(this.props.threadAttach,this.props.message,t,this.onAttachUpdated.bind(this))}},close:function(e,t,a){try{i.default.PAssert(2668,i.default.isBoolean(e),"Must supply a valid value for sendDraft")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2669,i.default.isBoolean(t),"Must supply a valid value for discardDraft")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2670,i.default.isBoolean(a),"Must supply a valid value for forceFlush")}catch(e){i.default.reportError(e)}this._clearDraftDebounce(e,a),!e&&t&&this._discardDraftUpdates(),this.props.onClose()},_clearDraftDebounce:function(e,t){this._draftUpdateDebounce&&(clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this._saveDraftUpdates(e,t))},openSubject:function(){this.showSubject.set(!0),setTimeout(function(){this._setFocus(this.refs.subject),this.refs.subject.selectEnd()}.bind(this),0)},openCc:function(){this.showCc.set(!0),setTimeout(function(){this._setFocus(this.refs.cc)}.bind(this),0)},openBcc:function(){this.showBcc.set(!0),setTimeout(function(){this._setFocus(this.refs.bcc)}.bind(this),0)},focusTo:function(){this._setFocus(this.refs.to)},focusBody:function(){this._setFocus(this.refs.body)},_setFocus:function(e){e.isFocused.get()||e.focus()},_createTokensFromAddressText:function(e){var t=[];if(e)for(var a=0;a<e.length;a++){var i=e[a];i.text?t.push(i):i.email&&t.push({email:i.email,text:i.email})}return{tokens:t}},onClickSend:function(){var e=this.props,t=this.refs,a=function(t,a){t?this.close(!1,!1,!0):(i.default.isHTTPStatusCode(a,r.a.HTTPStatusCode.Network)?i.default.toasts.pushMessage({text:"You are offline. Your message will be sent when Moo.do is open and you are online.",action:MessageAction.Okay,hold:!0}):a&&i.default.toasts.pushMessage({text:"There was an error sending your message. Please try again in a minute.",action:MessageAction.Okay}),this.isSending.set(!1)),c.a.ensureDisplayMessages(e.threadAttach)}.bind(this),n=function(t){t&&(this._clearDraftDebounce(!1,!1),u.a.clearSelection(),this.isSending.set(!0),e.threadAttach.getPlugin().sendDraft(e.threadAttach,e.message.id,e.message.draftID,void 0,a)||this.isSending.set(!1))}.bind(this);t.subject&&!t.subject.getValue()?i.default.menus.confirm("There is no email subject, send anyway?",n):t.body.getValue()?n(!0):i.default.menus.confirm("There is no email body, send anyway?",n)},onDraftChanged:function(){clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this._isMounted&&(this._draftUpdateDebounce=setTimeout(this._saveDraftUpdates.bind(this,!0,!1),1e3))},_saveDraftUpdates:function(e,t){if(this._isMounted){var a=this.refs,r=this.props,n=a.to.getTokens(),s=a.cc&&a.cc.getTokens(),o=a.bcc&&a.bcc.getTokens(),l=a.subject&&a.subject.getValue()||this.props.message.subject,d=a.body.getValue()||"(no text)",c=a.body.getTextValue()||"(no text)",u={to:n,cc:s,bcc:o,subject:l,body:d};r.threadAttach.getPlugin().updateDraft(r.threadAttach,r.message.id,r.message.draftID,u,c,e,t,function(e){try{i.default.PAssert(2671,e,"Should always be able to update a draft")}catch(e){i.default.reportError(e)}}),clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0}},_discardDraftUpdates:function(){this.props.threadAttach.getPlugin().discardDraft(this.props.threadAttach,this.props.message.id,this.props.message.draftID,function(e){try{i.default.PAssert(2672,e,"Should always be able to delete a draft")}catch(e){i.default.reportError(e)}})},_getComposeBody:function(e){var t;return e&&e.decoded&&(t=d.a.getComposeBody(e.decoded,e.resources)),t},onChangeFrom:function(){var e=this.refs.from.value,t=this.props.threadAttach,a=t.getPlugin(),r=a.getSyncAccount(e),n=a.getSendingAccountInfo(e),s=!!this.props.message.inReplyTo;s?this._clearDraftDebounce(!1,!1):this.close(!1,!1,!1);var o=a.changeMessageAccount(t,this.props.message.id,this.props.message.draftID,r,e,n),l=o?o.threadID:t.id;s||i.default.menus.openComposeEmail(a,l),this.refs.body.setValue(this._getComposeBody(this.props.message))},getSendingAccounts:function(){var e,t=this.props.threadAttach.getPlugin();return this.props.message.inReplyTo&&(e=this.props.threadAttach.getField("accountID")),t.getSendingAccounts(e)},getFromAccount:function(){var e=this.state.fromAccounts;return e.length<2?e[0]:this.refs.from.value},insertLinkHotkey:function(){this.refs.body.hasFocus()&&this.insertLink()},insertLink:function(){var e=u.a.getSelectedText(),t=this.refs.buttonLink.getElement();this.savedSel=u.a.getSelectionRange(),i.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:t,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:e})},onInsertLinkClosed:function(){this.savedSel&&(this.refs.body.focus(),u.a.setSelectionRange(this.savedSel))},onInsertLink:function(e){var t=document.createElement("a");t.href=e.url,t.innerText=e.text,this.refs.body.insertNode(t)},render:function(){var e=this.state,t=this.props,a=this.to,r=this.cc,n="(no subject)"===t.message.subject?"":t.message.subject,o=this.state.showCc||this.cc&&this.cc.length>0,l=8+(o?0:28)+(e.showBcc?0:34),d=t.message.from.email,c=e.fromAccounts.slice(0),u=e.fromAccounts.length>1,h={},f=i.default.classNames("emailCompose validDropTarget flexbox flexvert",t.className);c.remove(d),c.unshift(d);var m,S=i.default.classNames("composeHeader c-border-heavy",{showingFrom:e.fromAccounts.length>1});return t.hidden&&(h.height=0,h.paddingTop=0,h.overflow="hidden"),s.a.createElement("div",{className:f,style:h,ref:"container",onFocus:this.onFocus,onBlur:this.onBlur,onDrop:this.onFileDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave},s.a.createElement("div",{className:S},s.a.createElement("div",{className:"composeButtons"},!e.showSubject&&s.a.createElement(y.a,{height:24,padding:6,onClick:this.openSubject},"Subject"),!o&&s.a.createElement(y.a,{height:24,padding:6,onClick:this.openCc},"Cc"),!e.showBcc&&s.a.createElement(y.a,{height:24,padding:6,onClick:this.openBcc},"Bcc")),s.a.createElement(g.a,{className:"toBox",height:50,floatingText:"To",display:"block",ref:"to",tokens:a.tokens,focused:"to"===this.props.focus,autocompleteMode:"email",padding:{right:0},margin:{right:l},onChange:this.onDraftChanged,onEscape:t.onEscape}),o&&s.a.createElement(g.a,{height:50,floatingText:"Cc",display:"block",ref:"cc",tokens:r.tokens,autocompleteMode:"email",padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),e.showBcc&&s.a.createElement(g.a,{height:50,floatingText:"Bcc",display:"block",ref:"bcc",autocompleteMode:"email",padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),e.showSubject&&s.a.createElement(g.a,{height:50,floatingText:"Subject",display:"block",ref:"subject",value:n,padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),u&&s.a.createElement("div",{className:"composeFrom"},s.a.createElement("span",null,"From"),s.a.createElement("select",{ref:"from",onChange:this.onChangeFrom},c.map(function(e){return s.a.createElement("option",{key:e,value:e},e)})))),s.a.createElement(v.a,{className:"emailComposeTextarea c-border-heavy f1",ref:"body",style:m,onChange:this.onDraftChanged,spellCheck:!0,onEscape:t.onEscape,editable:!e.isSending}),s.a.createElement(p.a,{onUpdate:this.onAttachUpdated,threadAttach:t.threadAttach,message:t.message,editable:!0}),s.a.createElement("div",{className:"composeFooter"},s.a.createElement(y.a,{className:"discardDraft",icon:"icon-delete",iconSize:20,onClick:this.discard,tooltip:"Discard Draft"}),s.a.createElement(y.a,{className:"attachFile",icon:"icon-attach_file",iconSize:20,marginLeft:8,onClick:this.onClickAttach,tooltip:"Attach File"}),s.a.createElement(y.a,{className:"insertLink",icon:"icon-link",iconSize:20,marginLeft:8,onClick:this.insertLink,ref:"buttonLink",tooltip:"Insert Link"}),s.a.createElement(y.a,{className:"buttonSend",primary:!0,marginLeft:16,onClick:this.onClickSend},"SEND")),s.a.createElement("input",{type:"file",ref:"picker",className:"hidden",multiple:!0}),e.isDragOver&&s.a.createElement("div",{className:"dropNotice flexbox flex-center"},s.a.createElement("div",{className:"dropBg absFull"}),s.a.createElement("div",{className:"f1 center"},s.a.createElement("div",{className:"icon-attach_file"}),s.a.createElement("div",null,"Drop to attach"))),e.isSending&&s.a.createElement("div",{className:"clickBlocker flexbox flex-center c-bg-faded"},s.a.createElement("div",{className:"f1 center c-foreground"},"Sending...")))}});t.a=S},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(3).a.createClass({displayName:"FancyTable",componentDisplay:r.a.ComponentDisplay.Desktop,render:function(){var e=i.default.classNames("fancyTable",this.props.className);return s.a.createElement("div",{className:e,id:this.props.id},this.props.children)}});t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(232),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};var c=o.a.createClass({displayName:"FancySortableList",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({draggingChild:void 0})},getElement:function(){return this.refs.element},onDragStart:function(e){this.isDraggingInside=!0,this.dragDidMove=!1,this.draggingChild.set(e)},findTargetIndex:function(e){for(var t=s.a.Children.count(this.props.children),a=this.props.horizontal?"left":"top",r=this.props.horizontal?"width":"height",n=e.props.owner===this?e.props.index:-1,o=e.getDraggingElement(),l=i.default.offset(o)[a],d=o.getBoundingClientRect()[r],c=-1,u=!1,h=0;h<t;h++){var f=this.refs["el_"+h];if(f!==this.draggingChild.get()){var p=f.getElement(),m=i.default.offset(p)[a],g=p.getBoundingClientRect()[r],v=Math.min(g,d)/2;if(h>n)l+v>=m&&(c=h,h===t-1&&!u&&l>m+v&&(c=t));else if(l<=m+v)return h}else u=!0}return c},onDragMove:function(e,t){if(e.getDraggingElement()){var a=this,i=e.props.index,r=e.props.owner;this.props.getDragTargetfromElement&&!(a=this.props.getDragTargetfromElement(t.target))&&this.isDraggingInside&&(this.isDraggingInside=!1,this.props.onDragOut(i,r)),a&&(this.isDraggingInside=!0,a.handleDragMove(e,t))}},handleDragMove:function(e,t){var a=e.props.index,i=e.props.owner,r=this.findTargetIndex(e);r>=0&&(r!==a||this!==i)&&(this.dragDidMove=!0,this.props.moveChild(a,r,i,this))},onDragEnd:function(e,t){if(this.draggingChild.set(void 0),this.props.onDragEnd){var a=!1;if(this.props.getDragTargetfromElement){var i=this.props.getDragTargetfromElement(t.target);a=i&&i!==this}this.props.onDragEnd(e,a,this.dragDidMove||a)}},render:function(){var e=this,t=this.props,a=(t.index,t.moveChild,t.horizontal),r=(t.getDragTargetfromElement,t.onDragOut,t.classDragging,function(e,t){var a={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a}(t,["index","moveChild","horizontal","getDragTargetfromElement","onDragOut","classDragging"])),n=i.default.classNames("fancySortableList",t.className,{dragging:!!this.state.draggingChild},{flexbox:a}),o=s.a.Children.map(t.children,function(i,r){return s.a.createElement(l.a,{owner:e,onDragStart:e.onDragStart,onDragMove:e.onDragMove,onDragEnd:e.onDragEnd,ref:"el_"+r,index:r,horizontal:a,noDrag:i.props["data-nodrag"],isDragging:i.props["data-isdragging"],allowDragOut:!!t.getDragTargetfromElement,classDragging:t.classDragging},i)});return s.a.createElement("div",d({},r,{className:n,ref:"element"}),o)}});t.a=c},,,,,,function(e,t,a){"use strict";var i=function(e,t){this.target=e,this.cb=t,this._disposed=!1};i.prototype={dispose:function(){this._disposed=!0,this.target.unlisten(this.cb)},isDisposed:function(){return this._disposed}},t.a=i},function(e,t,a){"use strict";var i,r,n=a(0),s=a(5),o=a(1),l=a(42);function d(){this._versions={},this._values={},this._changeListeners=[],this._apiNotifications={},this._localLoaded=!1,this._localLoadError=!1,this._localWriteError=!1,this._remoteLoaded=!1,this._remoteLoadError=!1,this._remoteSettings=void 0,i=window.Settings.DefaultGroup="Default",r=window.Settings.UISettingsGroup="UISettings",this.init()}d.prototype={init:function(){this._testLocalWrites(),this.registerGroup(i),this.registerGroup(r),this.registerSetting(Settings.theme,i,!0,"light"),this.registerSetting(Settings.syncContacts,i,!0),this.registerSetting(Settings.shownTutorial,i,!0),this.registerSetting(Settings.rootFolderId,i,!0),this.registerSetting(Settings.attachFolderId,i,!0),this.registerSetting(Settings.enableOfflineAuth,i,!0),this.registerSetting(Settings.trialOverHidden,i,!0),this.registerSetting(Settings.helpState,i,!0),this.registerSetting(Settings.helpPaneState,i,!0),this.registerSetting(Settings.closedImport,i,!0),this.registerSetting(Settings.closedHelps,i,!0),this.registerSetting(Settings.inTooltipIntro,i,!0),this.registerSetting(Settings.closedVideo,i,!0),this.registerSetting(Settings.workspaces,i,!0),this.registerSetting(Settings.paneHistoryMobile,i,!0),this.registerSetting(Settings.notificationDelay,i,!0,30),this.registerSetting(Settings.searchExpandsCollapsed,i,!0),this.registerSetting(Settings.openEvernoteApp,i,!0),this.registerSetting(Settings.dateFormat,i,!0,o.a.DateFormat.MDY),this.registerSetting(Settings.dayWeekStart,i,!0,0),this.registerSetting(Settings.defaultItemPrefix,i,!0,""),this.registerSetting(Settings.agendaSort,i,!0),this.registerSetting(Settings.lastContactSync),this.registerSetting(Settings.lastTaskSync),this.registerSetting(Settings.lastQuickAddSync),this.registerSetting(Settings.disableNotifications),this.registerSetting(Settings.authScopes),this.registerSetting(Settings.localIntegrity),this.registerSetting(Settings.localDataVersion),this.registerSetting(Settings.localRecoverVersion),this.registerSetting(Settings.gdocId),this.registerSetting(Settings.gdocTitle),this.registerSetting(Settings.activeUser),this.registerSetting(Settings.userId),this.registerSetting(Settings.displayName),this.registerSetting(Settings.lastServerVersion),this.registerSetting(Settings.oauthScheme),this.registerSetting(Settings.premiumStatus),this.registerSetting(Settings.trialStart),this.registerSetting(Settings.trialDuration),this.registerSetting(Settings.trialExtended),this.registerSetting(Settings.premiumEndDate),this.registerSetting(Settings.notifiedTrialOver),this.registerSetting(Settings.notifiedTrialEndSoon),this.registerSetting(Settings.localPaneState),this.registerSetting(Settings.selectedWorkspace),this.registerSetting(Settings.monthlyInvoice),this.registerSetting(Settings.invoiceEmail),this.registerSetting(Settings.invoiceCompany),this.registerSetting(Settings.invoiceAddress),this.registerSetting(Settings.isUnsubscribed),this.registerSetting(Settings.keyboardToolbarScroll),this.registerSetting(Settings.showSidebar,i,!1,!1),this.registerSetting(Settings.sidebarWidth,i,!1,o.a.DesktopMenuWidth),this.registerSetting(Settings.cacheSizeRatio,i,!1,1),this.registerSetting(Settings.checkboxOpacity,r,!0,25),this.registerSetting(Settings.checkboxBackgroundOpacity,r,!0,0),this.registerSetting(Settings.showVerticalLines,r,!0,!0),this.registerSetting(Settings.verticalLinesOpacity,r,!0,6),this.registerSetting(Settings.boldHeaders,r,!0,!1),this.registerSetting(Settings.itemPadding,r,!0,5),this.registerSetting(Settings.notePadding,r,!0,0),this.registerSetting(Settings.itemLineHeight,r,!0,18),this.registerSetting(Settings.noteLineHeight,r,!0,18),this.registerSetting(Settings.fontSize,r,!0,14),this.registerSetting(Settings.fontSizeHeader,r,!0,18),this.registerSetting(Settings.fontSizeHeaderTopLevel,r,!0,18),this.registerSetting(Settings.noteFontSize,r,!0,12),this.registerSetting(Settings.itemIndentSize,r,!0,30),this.registerSetting(Settings.tagColor,r,!0,"#0099DD"),this.registerSetting(Settings.dateColor,r,!0,"#AA3300"),this.registerSetting(Settings.contactColor,r,!0,"#22AA66"),this.registerSetting(Settings.linkColor,r,!0,"#3333BB"),this.registerSetting(Settings.underlineP,r,!0,!1),this.registerSetting(Settings.layoutTheme,r,!0,o.a.DisplayTheme.Markdown),this.registerSetting(Settings.grayscale,r,!0,!1),this.registerAPIServerNotification(Settings.layoutTheme,r),this.registerAPIServerNotification(Settings.boldHeaders,r),this.registerAPIServerNotification(Settings.grayscale,r),this._setupLocalNotifications(),this._ensureLocalLoaded(),this._ensureRemoteSettings()},_setupLocalNotifications:function(){n.default.shouldWriteLocal()&&window.addEventListener("storage",function(e){if(e||(e=window.event),"localSettings"===e.key){var t,a;try{if(e.oldValue&&(t=this._deserializeSettings(e.oldValue)),e.newValue&&(a=this._deserializeSettings(e.newValue)),t&&a){try{n.default.PAssert(388,t.values,"Must have a valid set of old settings")}catch(e){n.default.reportError(e)}try{n.default.PAssert(389,a.values,"Must have a valid set of new settings")}catch(e){n.default.reportError(e)}for(var i=0;i<this._changeListeners.length;++i){var r=this._changeListeners[i];try{n.default.PAssert(390,r,"Each listener must have a valid entry")}catch(e){n.default.reportError(e)}var s=t.values[r.groupID],o=a.values[r.groupID];if(s&&o?(f=s[r.key],h=o[r.key]):!s&&o?(f=void 0,h=o[r.key]):s&&!o&&(f=s[r.key],h=void 0),f!==h)try{r.fn(f,h)}catch(e){n.default.reportError(e)}}for(var l in a.versions){o=a.versions[l],s=t.versions[l];if(o)for(var d in o){var c=o[d],u=s?s[d]:void 0;if(!s||u<c){var h=a.values[l][d],f=s?t.values[l][d]:void 0;this.fireEvent("settingChanged",l,d,[f,h])}}}}}catch(e){n.default.reportError(e)}if(this._localLoaded=!1,a)this._loadLocalSettings(a);else try{n.default.PAssert(391,!1,"Unable to update settings to be empty")}catch(e){n.default.reportError(e)}}}.bind(this),!1)},registerForChangeNotification:function(e,t,a){try{n.default.PAssert(392,e,"Must provide a valid key to watch")}catch(e){n.default.reportError(e)}try{n.default.PAssert(393,a&&n.default.isFunction(a),"Must provide a valid callback fn",a)}catch(e){n.default.reportError(e)}t=t||i,this._changeListeners.push({key:e,groupID:t,fn:a})},_testLocalWrites:function(){var e=!1;try{s.a.storage.setItem("poke",0),e=!0}catch(e){n.default.preventLocalWrites(o.a.LocalWriteReason.NoPermission)}return e},registerGroup:function(e){this._versions[e]||(this._versions[e]={},this._values[e]={})},registerSetting:function(e,t,a,r){t=t||i,a=a||!1;try{n.default.PAssert(395,this._versions[t],"Must first register a group before a setting in the group")}catch(e){n.default.reportError(e)}this._versions[t][e]||(this._versions[t][e]={version:-1,syncRemote:a}),void 0!==r&&void 0===this._values[t][e]&&(this._values[t][e]=r)},registerAPIServerNotification:function(e,t){t=t||i,this._apiNotifications[t]||(this._apiNotifications[t]={}),this._apiNotifications[t][e]=!0},get:function(e,t){t=t||i;try{n.default.PAssert(397,e,"Must specify a valid setting to get")}catch(e){n.default.reportError(e)}try{n.default.PAssert(398,this._versions[t],"Must first register a group before getting a setting from it")}catch(e){n.default.reportError(e)}try{n.default.PAssert(399,!this._versions[t]||void 0!==this._versions[t][e],"Must first register a setting before getting a value from it: "+e)}catch(e){n.default.reportError(e)}return this._ensureLocalLoaded(),this._values[t][e]},set:function(e,t,a){a=a||i;try{n.default.PAssert(400,e,"Must specify a valid setting to get")}catch(e){n.default.reportError(e)}try{n.default.PAssert(401,this._versions[a],"Must first register a group before getting a setting from it")}catch(e){n.default.reportError(e)}try{n.default.PAssert(402,!this._versions[a]||void 0!==this._versions[a][e],"Must first register a setting before setting a value to it")}catch(e){n.default.reportError(e)}var r=!1;this._ensureLocalLoaded();var s=this._values[a][e],o=this._versions[a][e].version;if((s!==t||n.default.isObject(t)||n.default.isArray(t))&&(r=!0),r){var l=o+1;this._versions[a][e].syncRemote&&this._remoteLoaded&&this._setRemoteValue(e,t,l,a),this._values[a][e]=t,this._versions[a][e].version=l,this._writeLocalSettings(),this._sendChangeNotification(a,e,s,t,ChangeType.Local)}},reset:function(e,t){t=t||i;try{n.default.PAssert(403,e,"Must specify a valid setting to get")}catch(e){n.default.reportError(e)}try{n.default.PAssert(404,void 0!==this._versions[t],"Must first register a group before getting a setting from it")}catch(e){n.default.reportError(e)}try{n.default.PAssert(405,!1===this._versions[t][e].syncRemote,"Currently do not support resetting remote syncd settings")}catch(e){n.default.reportError(e)}this._ensureLocalLoaded();var a=this._values[t][e];delete this._values[t][e],this._writeLocalSettings(),this._sendChangeNotification(t,e,a,void 0,ChangeType.Local)},resetAll:function(e){try{n.default.PAssert(407,!n.default.isArray(e),"Must pass in a valid settings object to skip")}catch(e){n.default.reportError(e)}if(n.default.isArray(e)){var t=e;(e={})[i]=t}for(var a in this._versions){var r=this._versions[a],o=e?e[a]:void 0;for(var l in r)(!o||o.indexOf(l)<0)&&(this._versions[a][l].version=-1,this._values[a][l]=void 0)}if(e)this._writeLocalSettings();else if(n.default.shouldWriteLocal())try{s.a.storage.setItem("localSettings","{}")}catch(e){n.default.reportError(e)}},_ensureLocalLoaded:function(){if(n.default.shouldWriteLocal()&&!this._localLoaded)try{var e=s.a.storage.getItem("localSettings");e||(n.default.isFirstRun=!0),this._loadLocalSettings(this._deserializeSettings(e))}catch(e){n.default.reportError(e),this._localLoadError=!0}},_serializeSettings:function(){var e={__version:1,versions:{},values:{}};for(var t in this._versions){var a=this._versions[t];for(var i in a){var r=this._versions[t][i].version,n=this._values[t][i];this._versions[t][i].syncRemote&&(e.versions[t]||(e.versions[t]={}),e.versions[t][i]=r),e.values[t]||(e.values[t]={}),void 0!==n&&(e.values[t][i]=n)}}return e},_deserializeSettings:function(e){var t={versions:{},values:{}};if(e)try{var a=JSON.parse(e);if(void 0===a.__version){for(var r in t.versions[i]={},t.values[i]={},a)if(r.startsWith("V~")){var s=a[r];t.versions[i][r.substr("V~".length)]=s}else{var o=a[r];t.values[i][r]=o}}else if(1===a.__version)t.versions=a.versions,t.values=a.values;else try{n.default.PAssert(408,!1,"Invalid settings version")}catch(e){n.default.reportError(e)}}catch(e){n.default.reportError(e)}return t},_loadLocalSettings:function(e){try{n.default.PAssert(409,!this._localLoaded,"Should not load settings from local twice")}catch(e){n.default.reportError(e)}try{n.default.PAssert(410,e,"Must supply some valid parsed settings")}catch(e){n.default.reportError(e)}try{n.default.PAssert(411,!e||e.versions,"Must have a valid constructed parsed settings - versions")}catch(e){n.default.reportError(e)}try{n.default.PAssert(412,!e||e.values,"Must have a valid constructed parsed settings - values")}catch(e){n.default.reportError(e)}var t=e.versions,a=e.values;for(var i in t){var r=t[i];for(var s in this._versions[i]||(this._versions[i]={}),r)this._versions[i][s]={version:r[s],syncRemote:!0}}for(var i in a){r=a[i];for(var s in this._values[i]||(this._values[i]={}),r)this._values[i][s]=r[s]}this._localLoaded=!0,this._localLoadError=!1},_writeLocalSettings:function(){if(n.default.shouldWriteLocal()||n.default.isLocalWriteReason(o.a.LocalWriteReason.QuotaError))try{var e=this._serializeSettings();0,s.a.storage.setItem("localSettings",JSON.stringify(e))}catch(e){n.default.reportError(e);try{s.a.storage.setItem("localSettings","{}")}catch(e){n.default.reportError(e)}this._localWriteError=!0}},_ensureRemoteSettings:function(){this._remoteRequested||this._remoteLoaded||n.default.vmMain&&n.default.vmMain.realtimeDocManager&&(this._remoteRequested=!0,n.default.vmMain.realtimeDocManager.registerForReadyNotification(DocType.GAppData,function(){this._remoteSettings=n.default.vmMain.realtimeDocManager.createDocument(DocType.GAppData,"RemoteSettings"),this._remoteSettings.open("RemoteSettings",this._onRemoteLoad.bind(this),this._onRemoteInit.bind(this),this._onRemoteError.bind(this))}.bind(this)))},_getRemoteEntry:function(e,t){if(this._remoteLoaded){var a=this._remoteSettings.getModel().getRoot().get("settings").get(t);if(a)return a.get(e)}},_getRemoteValue:function(e,t){var a=this._getRemoteEntry(e,t);if(a)return a.value},_getRemoteVersion:function(e,t){var a=this._getRemoteEntry(e,t);return a?a.ver:-1},_setRemoteValue:function(e,t,a,r){if(r=r||i,this._remoteLoaded){var n=this._remoteSettings.getModel(),s=n.getRoot().get("settings"),o=s.get(r);o||(o=n.createMap(),s.set(r,o)),o.set(e,{value:t,ver:a})}},_sendChangeNotification:function(e,t,a,i,r){this.fireEvent("settingChanged",e,t,[a,i]);for(var s=0;s<this._changeListeners.length;++s){var o=this._changeListeners[s];if(e===o.groupID&&t===o.key)try{o.fn(a,i)}catch(e){n.default.reportError(e)}}!n.default.isDemoMode()&&n.default.isLocalChange(r)&&this._shouldNotifyAPIServer(e,t)&&this._notifyAPISever(e,t,i)},_findGroupForMap:function(e,t){for(var a=e.items(),i=0;i<a.length;++i)if(a[i][1]===t)return a[i][0]},_onRemoteSettingsChange:function(e){for(var t=0;t<e.events.length;++t){var a=e.events[t];if(!a.isLocal){0;var i=this._findGroupForMap(e.currentTarget,a.target);i&&a.newValue&&this._remoteSettingLoaded(a.property,a.newValue.value,a.newValue.ver,i)}}},_remoteSettingLoaded:function(e,t,a,i){try{n.default.PAssert(414,i,"Must specify a valid groupID at this point")}catch(e){n.default.reportError(e)}this._versions[i]||this.registerGroup(i),this._versions[i][e]||this.registerSetting(e,i,!0);var r=this._values[i][e],s=this._versions[i][e].version;if(a>s)this._values[i][e]=t,this._versions[i][e].version=a,this._sendChangeNotification(i,e,r,t,ChangeType.Remote);else if(a<s)this._setRemoteValue(e,r,s,i),this._shouldNotifyAPIServer(i,e)&&this._notifyAPISever(i,e,r);else if(a===s)if(n.default.isArray(r)){try{n.default.PAssert(415,n.default.isArray(t),"Must both be arrays or neither arrays")}catch(e){n.default.reportError(e)}try{n.default.PAssert(416,r.equals(t),"Arrays must match")}catch(e){n.default.reportError(e)}}else if(n.default.isObject(r))try{n.default.PAssert(417,n.default.areObjectsEqual(r,t),"Should match if the versions are the same: "+e+" - "+i)}catch(e){n.default.reportError(e)}else try{n.default.PAssert(418,r===t,"Should match if the versions are the same: "+e+" - "+i)}catch(e){n.default.reportError(e)}else try{n.default.PAssert(419,!1,"What - remote and local versions are messed up",a,s)}catch(e){n.default.reportError(e)}},_onRemoteLoad:function(e){try{n.default.PAssert(420,this._localLoaded,"Local settings must be loaded before remote")}catch(e){n.default.reportError(e)}try{n.default.PAssert(421,this._remoteRequested,"Remote document must have been requested")}catch(e){n.default.reportError(e)}this._remoteLoaded=!0;var t=!1,a=!1,i=e.getModel(),r=i.getRoot(),s=r.get("settings");r.get("info");try{for(var o=s.items(),l=0;l<o.length;++l)for(var d=o[l][0],c=(g=o[l][1]).items(),u=0;u<c.length;++u){var h=c[u][0],f=c[u][1],p=f.value,m=f.ver;t=t||this._remoteSettingLoaded(h,p,m,d)}for(var d in this._versions){var g=this._versions[d];for(var h in g)if(this._versions[d][h].syncRemote&&-1!==this._versions[d][h].version){var v=s.get(d);v||(a||(i.beginCompoundOperation("Sync Settings",!1),a=!0),v=i.createMap(),s.set(d,v));var y=v.get(h);y||(a||(i.beginCompoundOperation("Sync Settings",!1),a=!0),y={value:this._values[d][h],ver:this._versions[d][h].version},v.set(h,y))}}}catch(e){n.default.reportError(e)}a&&i.endCompoundOperation(),s.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,this._onRemoteSettingsChange.bind(this)),t&&this._writeLocalSettings()},_onRemoteError:function(e){try{n.default.PAssert(422,this._localLoaded,"Local settings must be loaded before remote")}catch(e){n.default.reportError(e)}try{n.default.PAssert(423,this._remoteRequested,"Remote document must have been requested")}catch(e){n.default.reportError(e)}this._remoteLoaded=!1,this._remoteLoadError=!0},_onRemoteInit:function(e){try{n.default.PAssert(424,this._localLoaded,"Local settings must be loaded before remote")}catch(e){n.default.reportError(e)}try{n.default.PAssert(425,this._remoteRequested,"Remote document must have been requested")}catch(e){n.default.reportError(e)}var t=e.getRoot(),a=e.createMap(),i=e.createMap();i.set("settingsVer",1),t.set("settings",a),t.set("info",i)},_shouldNotifyAPIServer:function(e,t){return this._apiNotifications[e]&&this._apiNotifications[e][t]},_notifyAPISever:function(e,t,a){n.default.billingManager.onConnected(function(){n.default.billingManager.onBillingIdentifierAvailable(function(){n.default.XHR_PrivateAPI({type:"POST",path:"/user/settings/set",data:{email:n.default.billingManager.getBillingIdentifier(),groupID:e,key:t,value:a},requireAuth:!0,autoRetry:!0,cb:function(i){200!==i.status&&n.default.reportError(new Error("Unable to notify API server of remote setting: "+i.status+" "+e+" "+t+" "+a))}})})})},getRawSettings:function(){var e;if(n.default.shouldWriteLocal())try{e=s.a.storage.getItem("localSettings")}catch(e){n.default.reportError(e)}else try{return JSON.stringify(this._serializeSettings())}catch(e){return n.default.reportError(e),'{m:"Invalid Settings"}'}return e},hasLoadedRemote:function(){return this._remoteLoaded},_dumpSettings:function(){log("---- Settings ----"),log("Versions: ",this._versions),log("Values: ",this._values)}},s.a.defineBase(d),s.a.extend(d.prototype,l.a),n.default.settings=new d},function(e,t,a){"use strict";var i=a(7),r=a(1),n=a(0),s=a(5),o=a(4),l=a(15),d=a(108),c=a(14),u=a(9),h={Normal:"Sign in with Google",Connecting:"Connecting...",LoggingIn:"Logging In...",Loading:"Loading...",Offline:"Offline"};function f(){var e;this.loginState=new u.a(LoginState.NONE),e=navigator.onLine?c.a.canRunAuthenticate()?h.Normal:h.Loading:h.Offline,this.loginStatus=new u.a(e),this.downloadIcon=this.getDownloadIcon(),this.downloadText="Download "+this.getDownloadText()+" app",this.showDownload=o.a.canDownloadNativeApp()||o.a.canDownloadChromeApp(),this.showLogin=!0,c.a.canRunAuthenticate()||window.addEventListener("gapiLoaded",function(){this.loginStatus.get()===h.Loading&&this.loginStatus.set(h.Normal)}.bind(this)),this.loginRequested=!1,this.loginRequestTimer=void 0}f.prototype={init:function(){if(n.default.isDemoMode())return this.setLoginState(LoginState.LOGGED_IN),LoginState.LOGGED_IN;var e=n.default.getLoginState();return this._pageLoadLoginState=e,this.setLoginState(e),window.addEventListener("gapiLoaded",function(){this.loginRequested&&(this.loginStatus.set(h.Normal),c.a.hasValidAccessToken("me")?this.userLogin():this.loginRequested=!1)}.bind(this)),window.addEventListener("offline",function(){log("Browser going offline."),n.default.vmMain.setGDriveStatus(DriveStatus.Offline),this.loginStatus.set(h.Offline)}.bind(this)),window.addEventListener("online",function(){if(log("Browser going online."),this.loginStatus.set(h.Normal),this.loginRequested&&(c.a.hasValidAccessToken("me")?this.userLogin():this.loginRequested=!1),n.default.getLoginState()==LoginState.LOGGED_IN&&!o.a.offline){var e=l.a.ensureDocConnection();log("Coming online. Already online:",e)}}.bind(this)),e},getDownloadIcon:function(){return o.a.getPlatformIcon()},getDownloadText:function(){return o.a.getPlatformName()},setLoginState:function(e){e!==this.loginState.get()&&(n.default.setLoginState(e),this.loginState.set(e))},userLogin:function(){c.a.canRunAuthenticate()&&this.loginStatus.get()===h.Normal&&this.loginState.get()!=LoginState.LOGGED_IN?(n.default.authUserLoggedIn=!0,this.loginStatus.set(h.LoggingIn),this.loginRequested=!1,l.a.runAuthenticate(l.a.requiredScopes,!1,!0,function(e){if(this.loginStatus.set(h.Normal),e&&!e.error){n.default.settings.set(Settings.localIntegrity,!0),this.setLoginState(LoginState.LOGGED_IN),n.default.vmMain.paneManager.setupInitialTimeout();var t=l.a.loadClientDefaultFile();t!==r.a.DocLoadSkipReason.None&&this._reportLoginTapSkip("Skipped loading default client file: "+t)}else this._reportLoginTapSkip("Invalid token returned when calling userLogin")}.bind(this))):(this._reportLoginTapSkip("Still in connecting login state"),this.loginStatus.set(h.Connecting),this.loginRequested=!0),clearTimeout(this.loginRequestTimer),this.loginRequestTimer=setTimeout(function(){this.loginStatus.set(navigator.onLine?h.Normal:h.Offline),this.loginRequested=!1}.bind(this),500)},shouldShowLogin:function(){return this.loginStatus.get()===h.Normal||this.loginStatus.get()===h.LoggingIn},openLogin:function(){this.loginState.set(LoginState.NONE)},logout:function(){this.setLoginState(LoginState.LOGGED_OUT),i.a.clearData(function(){s.a.storage.clear(),setTimeout(function(){s.a.hasURLParam("login")?s.a.removeURLParam("login"):s.a.hasURLParam("user")?s.a.removeURLParam("user"):o.a.app?o.a.app&&(n.default.nativeBridge.sendToApp("logout"),o.a.isFeatureEnabled(r.a.Feature.OAuth)&&n.default.reload()):n.default.reload()},0)})},logoutClicked:function(){if(n.default.isDemoMode())s.a.removeURLParam("demo");else{var e=!0;for(var t in i.a.pendingRemoteUpdates)if(i.a.pendingRemoteUpdates.hasOwnProperty(t)){n.default.menus.confirm("You have unsaved changes which will be lost if you log out. Are you sure?",function(e){e&&this.logout()}.bind(this)),e=!1;break}e&&this.logout()}},isLocal:function(){return"localhost"==window.location.hostname},getPageLoadLoginState:function(){return this._pageLoadLoginState},initDemo:function(){n.default.AScript||(n.default.AScript=new d.a)},runScript:function(e){n.default.AScript.runScript(e)},onTapLogin:function(e){this.loginStatus.get()===h.Normal?this.userLogin():this._reportLoginTapSkip("Login Status not LoginStatus.Normal: "+this.loginStatus.get())},isLoggedIn:function(){return this.loginState.get()===LoginState.LOGGED_IN},_reportLoginTapSkip:function(e){}},t.a=f},function(e,t,a){"use strict";function i(){}var r=[" ","-","/","[","]","(",")","*","_","@",".",":"];i.prototype={getPreviousWord:function(e,t){for(var a=-1,i=0;i<r.length;i++)a=Math.max(a,e.prevIndexOf(r[i],t-1));return a},getNextWord:function(e,t){for(var a=e.length,i=0;i<r.length;i++){var n=e.indexOf(r[i],t);n>=0&&(a=Math.min(a,n))}return a}},t.a=new i},function(e,t,a){"use strict";var i=a(0);function r(){this._lib={}}r.prototype={add:function(e){try{i.default.PAssert(2047,1===arguments.length,"Only expect a single resource to be passed in, not a res,key pair")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2048,e.id,"Must specify a valid resource ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2049,!this._lib[e.id],"Should never have duped resources")}catch(e){i.default.reportError(e)}this._lib[e.id]=e},getByCID:function(e){var t;this._lib;return this.forEachResource(function(a){if(a.cid===e)return t=a,!1}),t},find:function(e){var t;if(this.has(e))t=this.getByCID(e);else{var a=e.split("@");t=this.getByCID(a[0])}return t},has:function(e){return!!this.getByCID(e)},remove:function(e){try{i.default.PAssert(2050,this._lib[e.id],"Must only remove resouces that actually exist")}catch(e){i.default.reportError(e)}delete this._lib[e.id]},isEmpty:function(){return i.default.isEmpty(this._lib)},forEachResource:function(e){for(var t in this._lib)try{if(!1===e(this._lib[t]))break}catch(e){i.default.reportError(e)}},clone:function(){var e=new r;for(var t in this._lib)e.add(i.default.clone(this._lib[t]));return e}},t.a=r},function(e,t,a){"use strict";var i=a(0),r=a(5);function n(){r.a.forceBind("tagComparatorNumber",this)}n.prototype={tagComparator:function(e,t){return e.localeCompare(t)},tagComparatorNumber:function(e,t){var a=e.count,i=t.count;return a===i?e.text.localeCompare(t.text):a>i?-1:1},findMatchExact:function(e){return!1},findMatchLike:function(e,t,a){var r={},n=[],s=e.toLowerCase(),o={comparator:function(e){return!e.isComplete()&&!!e.getTags()},each:function(e){for(var t=e.getTags(),a=0;a<t.length;a++){var i=t[a],o="t~"+i.toLowerCase(),l=i.toLowerCase();if(!s||l.startsWith(s)&&l!==s){if(!r[o]){var d=r[o]={type:"tag",text:i,count:0};n.push(d)}r[o].count++}}}};return a?o.item=a.item.get():o.itemStore=i.default.vmMain.itemStoreManager.getDefaultItemStore(),i.default.searchVMLIs(o),n.sort(this.tagComparatorNumber),n.length>t&&(n=n.slice(0,t)),n},printStats:function(e){log("--- Tag stats ---",e);for(var t=this.findMatchLike("",100),a=0;a<t.length;a++)console.log(t[a].text,t[a].count)},getAll:function(){return this.findMatchLike("")}},t.a=new n},function(e,t,a){"use strict";var i=a(0),r=a(4),n=a(44),s=a(10),o=a(79),l=a(8);function d(){}var c=/^(\#+|\-|\*|\[|\[\]|\[\s\]|\+|[0-9]+\.) /gi;d.prototype={init:function(){try{i.default.PAssert(848,"complete"===document.readyState||"interactive"===document.readyState,"Setting up copy/paste too early")}catch(e){i.default.reportError(e)}document.body.addEventListener("paste",this.handlepaste.bind(this),!1),document.body.addEventListener("cut",this.handlecut.bind(this),!1),document.body.addEventListener("copy",this.handlecopy.bind(this),!1)},killEvent:function(e){try{i.default.PAssert(849,e.preventDefault,"Should always be defined")}catch(e){i.default.reportError(e)}try{i.default.PAssert(850,e.stopPropagation,"Should always be defined")}catch(e){i.default.reportError(e)}e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},parseTextForPrefix:function(e){var t,a;return c.lastIndex=0,null!==(t=c.exec(e))&&(a=t[1],e=e.substr(t[0].length)),{prefix:a,text:e}},insertToNote:function(e,t,a){try{i.default.PAssert(851,e,"Must have a valid start item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(852,t,"Must have a valid end item")}catch(e){i.default.reportError(e)}var r,n=e.getParsedText();s.a.beginAction(),r=t===e?n.substring(0,l.a.getStartOffset())+a+n.substring(l.a.getEndOffset()):n.substring(0,l.a.getStartOffset())+a,e.setText(r,!0,ChangeType.Local),s.a.endAction()},insert:function(e,t,a){if(!l.a.isValid()||i.default.elementInNonPaneEdit(t.target))return!1;var d,c,u,h="",f=i.default.focusedPane,p=r.a.ie?"Text":"text/plain";if(a===DataSource.Plugin)u={items:[{text:e}]};else if(e&&e.getData){if(s.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.Paste}),this.killEvent(t),h=r.a.ie?void 0:e.getData("moodo/html")||e.getData("text/html"),!r.a.ie&&h){if(!h)return void 0;var m,g=document.createElement("div"),v=h.replace(/[\n\t]/g," ").replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>|<style(.|\s)*?\/style>/g,"").replace(/[ ]+/g," ").replace(/•/g,"").replace(/onload/gi,"never");if((m=/<body(.|\s)*?\/body>/g.exec(v))&&(v=m[0]),g.innerHTML=v,l.a.isValid()&&l.a.getStartItem().isNote())this.insertToNote(l.a.getStartItem(),l.a.getEndItem(),g.innerText);else{var y=g.children[0];2===g.children.length&&"A"===y.nodeName&&i.default.isOneNoteLink(y.href)&&(g.innerHTML=y.outerHTML),1===(u=o.a.traverseDOM({root:g,shouldPrint:!1,stripParents:!0,preserveWhitespace:!r.a.ie&&e.getData("moodo/html")})).items.length&&""===u.items[0].text&&(u=u.items[0])}}else if(h=e.getData(p)){0;var S,E=h.startsWith("<?xml "),P=h.startsWith("<?opml ")||h.startsWith("<opml ")||E&&h.indexOf("<opml ")>=0;if((E||P)&&(S=i.default.loadXML(h)),S){if(E&&!P)return i.default.toasts.pushMessage({text:"We currently do not support pasting XML, please contact support@moo.do.",action:MessageAction.Contact,hold:!0}),!1;if(P)return o.a.parseOPML(S,"OPML Import"),!1}else{if(h.startsWith("{")&&h.endsWith("}"))try{var b=JSON.parse(h);if(o.a.parseJSON(b,l.a.getStartItem().parent()))return!1}catch(e){}var C=i.default.parseEvernoteLink(h),D=i.default.isBearLink(h);if(C||D){var I=l.a.save(),A="Enter title of "+(C?"Evernote":D&&"Bear")+" document";return void i.default.menus.prompt(A,function(e){e&&(h="["+e+"]("+h+")"),l.a.restore(I),this.insert(h,t,DataSource.Plugin)}.bind(this))}v=h.replace(/[\t]/g,"    ");if(l.a.getStartItem().isNote())this.insertToNote(l.a.getStartItem(),l.a.getEndItem(),v);else{var M=v.split("\n");u=o.a.parseText(M)}}}else{if(e&&e.items&&e.items.length>0)return i.default.vmMain.pluginManager.handleDropEvent(t,function(e){s.a.beginAction();var t=l.a.getStartItem(),a=t.parent(),i=f.createVMLI({text:e},{parent:a,changeType:ChangeType.AllLocal});a.insertItem(i,t.getIndex()+1),s.a.endAction()}),!1;try{i.default.PAssert(853,!1,"Paste with unexpected data type",e.types)}catch(e){i.default.reportError(e)}}if(!u||!u.items||0===u.items.length)return!1}if(u){s.a.beginAction(),i.default.vmMain.beginUpdateItems();var _=!0,T=l.a.getStartOffset(),w=l.a.getStartItem(),k=l.a.getEndItem(),x=l.a.getStartItem().parent(),L=l.a.getStartItem().getIndex(),O=l.a.getStartItem().getParsedText(),R=l.a.getEndItem().getParsedText();if(w!==k&&(k.isNote()&&(k=k.parent()),w!==k&&n.a.handleMultiselect({normCode:KeyCode.BackSpace,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn})),d=w,1!==u.items.length||u.items[0].items)if(f.isViewAgenda())i.default.toasts.pushMessage({text:"Pasting multiple items into the agenda is not supported. Please try pasting into an Outline pane.",actionText:"OKAY"}),_=!1;else{ShouldLog(LogLevels.Timing)&&console.time("paste");var N=[],F=!w.hasChildren()&&l.a.getStartOffset()>=0&&l.a.getEndOffset()<=R.length;!F&&l.a.getStartOffset()>0&&L++;for(var U=0;u&&U<u.items.length;++U){var B=u.items[U],V=this.parseTextForPrefix(B.text);if(""!==B.text||B.items)if(0===U&&F){if(B.text=O.substring(0,T)+(T>0?V.text:B.text),w.setText(B.text,!0,ChangeType.Local),s.a.performAction(TrackerType.Insert,{itemID:w.id,position:0,text:B.text}),L++,B.items){for(var H=0;H<B.items.length;++H){var q=B.items[H];if(""!==q.text||q.items){var G=f.createVMLI(q,{parent:w,changeType:ChangeType.AllLocal});w.insertItem(G),d=G}}N.indexOf(w)<0&&N.push(w)}}else{G=f.createVMLI(B,{parent:x,changeType:ChangeType.AllLocal});if(x.insertItem(G,L++,!0),B._note){var z=f.createVMLI({text:B.text,isNote:!0},{parent:G,changeType:ChangeType.AllLocal});G.setNote(z,ChangeType.Local)}d=G,N.indexOf(x)<0&&N.push(x),s.a.performAction(TrackerType.Create,{itemID:G.id,parent:x.id,position:L-1,text:G.getParsedText()})}}for(;d.hasChildren();)d=d.getLastChild();c=d.getParsedText().length,F&&d.setText(d.getParsedText()+R.substring(l.a.getEndOffset()),!0,ChangeType.Local)}else{var W=u.items[0].text,j=T>0?this.parseTextForPrefix(W).text:W,K=O.substring(0,T)+j+R.substring(l.a.getEndOffset());s.a.performAction(TrackerType.Remove,{itemID:w.id,position:0,text:w.getParsedText()}),w.setText(K,!0,ChangeType.Local),s.a.performAction(TrackerType.Insert,{itemID:w.id,position:0,text:K}),c=l.a.getStartOffset()+j.length}i.default.vmMain.commitUpdateItems(),s.a.endAction(),ShouldLog(LogLevels.Timing)&&console.timeEnd("paste")}return _&&d&&(l.a.selectItem(d,c),i.default.focusedPane.scrollItemIntoView(d,ScrollDuration.Snap)),!1},handlepaste:function(e){var t=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;return this.insert(t,e,DataSource.Paste)},handlecut:function(e){return!!this.handlecopy(e)||(n.a.keydown(void 0,{normCode:KeyCode.BackSpace,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn}),!1)},padText:function(e,t){for(var a=0;a<t;++a)e="    "+e;return e},printLI:function(e,t,a){var i,r=e.getParsedText(),n=e.getPrefix();if(t=t||0,r=isNaN(a)?r.substring(t):r.substr(t,a-t),t>=n.length&&(r=n+r),e.hasAttachments()){var s=0;if(!isNaN(t)&&t>0)for(var o=e.getParsedText(),l=0;l<t;++l)o[l]===window.AttachChar&&s++;i=e.generateExportText(r,s)}else i=r;var d=[],c=e.priority();c&&(c===VMLIFlag.P0?d.push("high"):c===VMLIFlag.P1?d.push("medium"):c===VMLIFlag.P2&&d.push("low")),e.isComplete()&&d.push("complete"),e.isStarred()&&d.push("starred");var u=n.length?r.substr(n.length):r;return{html:"<li"+(d.length>0?' class="'+d.join(" ")+'"':"")+">"+u+"</li>",plain:u,moodo:"<li"+(d.length>0?' class="'+d.join(" ")+'"':"")+">"+i+"</li>"}},handlecopy:function(e){var t=i.default.focusedPane,a=r.a.ie?"Text":"text/plain",n=e&&e.clipboardData?e.clipboardData:window.clipboardData;if(n){if(i.default.findParent(e.target,"exportedArea",10))return!0;if(!l.a.isValid())return!0;if(!l.a.getPane().overrideCopyBehavior)return!0;var o=l.a.getStartItem(),d=l.a.getStartIndex(),c=l.a.getEndItem(),u=l.a.getEndIndex();try{i.default.PAssert(854,o&&c,"Must have valid item selections")}catch(e){i.default.reportError(e)}try{i.default.PAssert(855,i.default.isVMLI(o)&&i.default.isVMLI(c),"Items must be valid VMLIs")}catch(e){i.default.reportError(e)}var h,f,p,m,g=!r.a.ie;if(o===c)h=(m=l.a.getStartOffset()===l.a.getEndOffset()?this.printLI(o):this.printLI(o,l.a.getStartOffset(),l.a.getEndOffset())).html,f=m.plain,p=m.moodo;else{var v=1;h="<ul>"+(m=this.printLI(o,l.a.getStartOffset())).html,f=m.plain,p="<ul>"+m.moodo;do{var y=o;if(d=t.indexOfNextVMLI(d),o=t.itemAtIndex(d)){if(t.isViewOutline()){var S=o.levelsDeep.get()-y.levelsDeep.get();S>0&&(h+="<ul>",p+="<ul>",v++);for(var E=0;E<-S;E++)h+="</ul>",p+="</ul>",v--;v<=0&&(h+="<ul>",p+="<ul>",v++)}d!==u?(m=this.printLI(o),f+="\r\n"+this.padText(m.plain,v-1),h+=m.html,p+=m.moodo):(m=this.printLI(o,0,l.a.getEndOffset()),f+="\r\n"+this.padText(m.plain,v-1),h+=m.html+"</ul>",p+=m.moodo+"</ul>",v--)}}while(d!==u);for(;v>0;)h+="</ul>",p+="</ul>",v--}g&&h&&n.setData("text/html",h),g&&p&&n.setData("moodo/html",p),n.setData(a,f)}return r.a.ios||this.killEvent(e),s.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.Copy}),!1}},t.a=new d},function(e,t,a){"use strict";var i=a(0),r=a(10),n=a(7),s=a(13),o=a(47),l=a(71);a.n(l);function d(){}d.prototype={_setSectionValue:function(e,t,a){e.hasOwnProperty(t)||(e[t]=a)},_parseSection:function(e,t){for(var a={},r=t;r<e.length;++r){var n=e[r];if(n){var s=n.indexOf(":"),o=[n.substr(0,s),n.substr(s+1)],l=o[0].split(";");switch(l[0]){case"BEGIN":var d=this._parseSection(e,r+1);r+=d.size,a[o[1]]=d.section;break;case"END":return{section:a,size:r-t+1};default:if(l.length>1){for(var c={value:o[1]},u=1;u<l.length;++u){var h=l[u].split("=");try{i.default.PAssert(1423,!c.hasOwnProperty(h[0]),"Should never overwrite line values")}catch(e){i.default.reportError(e)}c[h[0]]=h[1]}this._setSectionValue(a,l[0],c)}else this._setSectionValue(a,l[0],o[1]);break;case void 0:case null:try{i.default.PAssert(1424,!1,"Invalid ICS format: "+n)}catch(e){i.default.reportError(e)}}}}return a},parseICS:function(e){for(var t=e.split("\n"),a=[],i=0;i<t.length;++i){var r=t[i];r.startsWith(" ")?a[a.length-1]+=r.trim():a.push(r.trim())}return this._parseSection(a,0)},parseHead:function(e){for(var t={},a=0;a<e.childElementCount;++a){var i=e.children[a],r=i.nodeName;if(i.firstChild){var n=i.firstChild.textContent;t[r]=n}}return t},parseOPML:function(e,t){var a,s=function(e,r){var o,l=!0;switch(e.nodeName){case"#document":case"body":case"opml":break;case"head":l=!1;var d=this.parseHead(e);d&&d.title&&!a&&(a=n.a.createVMLI({text:d.title},{parent:n.a.getRootModel(),changeType:ChangeType.AllLocal}),n.a.getRootModel().insertItem(a));break;case"outline":r||(a?r=a:(r=a=n.a.createVMLI({text:t},{parent:n.a.getRootModel(),changeType:ChangeType.AllLocal}),n.a.getRootModel().insertItem(a)));var c=e.attributes.text,u=c?c.value:"",h=e.attributes.complete||e.attributes._complete,f=!(!h||"true"!==h.value),p=e.attributes.note||e.attributes._note,m={text:i.default.stripFormattingTags(u).replace(/[\r\n\t]/g," "),isComplete:f};if(o=n.a.createVMLI(m,{parent:r,changeType:ChangeType.AllLocal}),r.insertItem(o),p){var g={text:i.default.stripFormattingTags(p.value),isNote:!0},v=n.a.createVMLI(g,{parent:o,changeType:ChangeType.AllLocal});o.setNote(v,ChangeType.AllLocal)}break;default:log("Unknown OPML Node: ",e)}if(l)for(var y=0;y<e.childElementCount;++y)s(e.children[y],o);return o}.bind(this);return r.a.beginAction(),s(e),r.a.endAction(),!0},parseJSON:function(e,t){function a(e,i){var r=i||t||n.a.getRootModel(),s={text:e.text,dateCompleted:e.dateCompleted,dateFormat:e.dateFormat,priority:e.priority,isComplete:e.isComplete,isStarred:e.isStarred},o=n.a.createVMLI(s,{parent:r,changeType:ChangeType.AllLocal});if(r.insertItem(o),e.note){var l={text:e.note.text,isNote:!0},d=n.a.createVMLI(l,{parent:o,changeType:ChangeType.AllLocal});o.setNote(d,ChangeType.AllLocal)}if(e.items)for(var c=0;c<e.items.length;++c)a(e.items[c],o)}if(void 0!==e.moodoVer&&void 0!==e.moodoRoot)try{i.default.parseInt(e.moodoVer),r.a.beginAction();var s=e.moodoRoot;if(s.items)for(var o=0;o<s.items.length;++o)a(s.items[o]);return r.a.endAction(),!0}catch(e){i.default.reportError(e)}else if(void 0!==e.text&&void 0!==e.items)try{return r.a.beginAction(),a(e),r.a.endAction(),!0}catch(e){}return!1},_findLineParent:function(e,t,a){for(var i,r=Math.min(e.length-1,t-1);r>=0;--r){var n=e[r];if(n&&n.indentLevel===a-1){i=n;break}}return i},parseText:function(e){for(var t={items:[]},a=[],i=0;i<e.length;++i){var r=this._parseTextLine(e[i]);if(r){a.push(r);var n=this._findLineParent(a,i,r.indentLevel)||t;r.parent=n,n.items.push(r)}}return t},_parseTextLine:function(e){if(e&&e.length>0)return{indentLevel:Math.floor(e.search(/\S|$/)/4),text:i.default.trimString(e.replace(/[\ud800-\udfff]+/g,"")),items:[]}},_createCSVEntry:function(e,t){for(var a={},i=0;i<e.length;++i)a[e[i]]=t[i];return a},parseCSV:function(e){for(var t=papaparse.parse(e),a=["Area","Client","Contacts","Category","Context","Created By","Date Created","Date Updated","Delegated To","Start Date","Due Date","Links","Notes","Originating Entry","Parent Entries","Priority","Short Description","Title","Star","Status","Website References"],i=[],r=t.data[0],n=0;n<r.length;++n)a.indexOf(r[n])<0?console.log("Unknown CSV Headers: ",r[n]):i.indexOf(r[n])>=0&&i.remove(r[n]);if(0===i.length){var s=[];for(n=1;n<t.data.length;++n)s.push(this._createCSVEntry(r,t.data[n]))}else var o="Missing required export fields: "+i.join(", ");if(r.indexOf("Short Descrption")<0&&r.indexOf("Title")<0)o="Missing required export fields: Short Descrption OR Title.";return s||o},_addMulti:function(e,t,a){return e[t]||(e[t]=a),e[t]},_getReference:function(e,t){var a;return"Evernote"!==t.type&&(a=e[t.value]),a},_hasReference:function(e,t){var a=!0;return"Evernote"!==t.type&&(a=!!e[t.value]),a},_parseIQTellFilename:function(e){return e.replace(/[\s_]-[\s_]Folder[\s_]Content(.*)\.csv/gi,"")},_visitIQTellNode:function(e,t,a){if(!e.isComplete){var i=n.a.createVMLI(e,{parent:t,changeType:ChangeType.AllLocal});if(e.__noteInfo){var r=n.a.createVMLI({text:e.__noteInfo,isNote:!0},{parent:i,changeType:ChangeType.AllLocal});i.setNote(r,ChangeType.AllLocal)}t.insertItem(i);for(var s=0;s<e.children.length;++s)this._visitIQTellNode(e.children[s],i,a+1)}return i},_createVMLITree:function(e){return this._visitIQTellNode(e,n.a.getRootModel(),0)},_createIQTellText:function(e){var t=e.desc;return e.context&&(t+=" #"+e.context),e.date&&(t+=" @"+e.date.toString(s.a.getFormat(DFormat.MonthDayYear))),t},_lookupNode:function(e,t){return e[i.default.hashString(t)]},_storeNode:function(e,t,a){e[i.default.hashString(t)]=a},_beginImport:function(e){this._reportedImportError=!1,this._rawImportData=e},_endImport:function(){this._reportedImportError=!1,this._rawImportData=void 0},_reportRecursiveImport:function(){this._reportRecursiveImport||i.default.reportError(new Error("Recursive import failure"),this._rawImportData)},_ensureIQTellNode:function(e,t,a,r){try{i.default.PAssert(1425,a,"Must always provide a valid entry")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1426,!a||a.desc,"Entry must always have a valid description")}catch(e){i.default.reportError(e)}if(r>60&&this._reportRecursiveImport(),!this._lookupNode(e,a.desc)){var n,s={text:this._createIQTellText(a),isStarred:a.star,isComplete:a.isComplete,priority:a.priority,parent:void 0,children:[],__noteInfo:void 0,__raw:a};if(a.notes){try{i.default.PAssert(1427,i.default.isString(a.notes),"Note must be a valid string")}catch(e){i.default.reportError(e)}var l=o.a.generatePlaintext(a.notes,{});s.__noteInfo=l?l.replace(/(\s*\r?\n){2,}/gm,"\r\n").replace(/^\s*\r?\n/gm,"").replace(/\r([^\n])/gm,"\r\n$1").replace(/\r\n/gm,"\n"):a.notes}for(var d=0;d<a.parents.length;++d){(n=this._lookupNode(e,a.parents[d].value))||(n=this._ensureIQTellNode(e,t,t[a.parents[d].value],r+1));break}n||(n=this._lookupNode(e,"__MDFile__"+a.file)),s.parent=n,n.children.push(s),this._storeNode(e,a.desc,s)}return this._lookupNode(e,a.desc)},_createIQTellTree:function(e,t){var a={};log("Creating Tree From: ",e,t);for(var i={text:"IQTell Import",parent:void 0,children:[]},r=0;r<t.length;++r){var n=this._parseIQTellFilename(t[r]),s={text:n,parent:i,children:[]};this._storeNode(a,"__MDFile__"+n,s),i.children.push(s)}for(var o in e)this._ensureIQTellNode(a,e,e[o],0);return this._createVMLITree(i)},_parseIQTellDate:function(e){var t;try{e&&(t=s.a.parseDate(e,C.DateFormat.MDY))}catch(e){}return t},_parseIQTellPriority:function(e){var t;switch(e){case"1 - Low":t=VMLIFlag.P2;break;case"2 - Medium":t=VMLIFlag.P1;break;case"3 - High":t=VMLIFlag.P0;break;default:t=VMLIFlag.None}return t},iqtellProcess:function(e,t){var a,r={},n=[];for(var s in e)for(var o=e[s],l=0;l<o.length;++l){var d=o[l],c=d["Short Description"]||d.Title;if(c){var u={raw:d,generated:!1,context:d.Context,file:this._parseIQTellFilename(s),children:[],category:d.Category,area:d.Area,parents:this._parseEntries(d["Parent Entries"]),desc:c,links:this._parseEntries(d.Links),notes:d.Notes,date:this._parseIQTellDate(d["Due Date"]||d["Follow-up Date"]),isComplete:"Completed"===d.Status||"Canceled"===d.Status,priority:this._parseIQTellPriority(d.Priority),star:"Yes"===d.Star};this._addMulti(r,c,u),n.push(u)}}for(l=0;l<n.length;++l){u=n[l];for(var h=0;h<u.parents.length;++h){(f=this._getReference(r,u.parents[h]))||this._hasReference(r,u.parents[h])?f.children.push(u):this._addMulti(r,u.parents[h].value,{raw:{},generated:!0,file:u.file,children:[u],parents:[],desc:u.parents[h].value,links:[],notes:void 0,priority:void 0,star:void 0})}for(h=0;h<u.links.length;++h){if(!(f=this._getReference(r,u.links[h]))&&!this._hasReference(r,u.links[h]))var f=this._addMulti(r,u.links[h].value,{raw:{},generated:!0,file:u.file,children:[],parents:[{type:"generated",value:u.desc}],desc:u.links[h].value,links:[],notes:void 0,priority:void 0,star:void 0});u.children.push(f)}}this._beginImport(t);try{a=this._createIQTellTree(r,Object.keys(e))}catch(e){i.default.reportError(e)}return this._endImport(),a},_parseEntries:function(e){var t=[];if(e){for(var a=e.split(", "),i=["Organization","Contact","Prospect","Email","Evernote","Project","Sub-Project","Subtask","Action"],r=[],n=a.length-1;n>=0;n--){var s=a[n],o=/^([^:]*):\s(.*)/.exec(s);(!o||!o[1]||i.indexOf(o[1])<0)&&n>0?(a[n-1]+=", "+a[n],a.removeAt(n)):r.push(s)}for(n=0;n<r.length;++n){var l=r[n],d=l.indexOf(":");if(d>0){var c=l.substr(0,d),u=l.substr(d+2);t.push({type:c,value:u})}}}return t},stripParents:function(e){if(e.parent=void 0,e.items)for(var t=0;t<e.items.length;t++)this.stripParents(e.items[t])},parseClassName:function(e,t){if(e)return e.indexOf("high")>=0?t.priority=VMLIFlag.P0:e.indexOf("medium")>=0?t.priority=VMLIFlag.P1:e.indexOf("low")>=0&&(t.priority=VMLIFlag.P2),e.indexOf("complete")>=0&&(t.isComplete=!0),e.indexOf("starred")>=0&&(t.isStarred=!0),t},traverseDOM:function(e){var t,a=e.root,r=e.stripParents,n=e.shouldPrint,s=e.preserveWhitespace,o=a.firstChild,l={items:[]},d={text:"",parent:l};l.items.push(d);var c,u,h=!1,f=!1,p=this;function m(e){if(e.nodeType===Node.TEXT_NODE){(f||h)&&(s||(d.text=d.text.replace(/^ +/g,"").replace(/ +$/g,"")),""!==d.text&&(t={text:"",parent:d.parent},p.parseClassName(c,t),i.default.hasClass(e.parentNode,"note")?(t.isNote=!0,d._note=t):d.parent.items.push(t),d=t)),f=!1,h=!1;var a=e.nodeValue.replace(/[\ud800-\udfff]+/g,"");""===d.text&&(a=s?a.replace(/^[\r\n\t]+/g,""):a.replace(/^[ \r\n\t]+/g,"")),p.parseClassName(c,d),d.text+=i.default.stripFormattingTags(a)}else e.nodeType===Node.COMMENT_NODE||("BR"===e.tagName||"P"===e.tagName||"LI"===e.tagName||"DIV"===e.tagName?(h=!0,c=e.className):"A"===e.tagName?d.text+="[":"UL"!==e.tagName&&"OL"!==e.tagName||(d.text=d.text.replace(/^ +/g,"").replace(/ +$/g,""),t={text:"",parent:d},p.parseClassName(c,t),d.items?d.items.push(t):d.items=[t],d=t,h=!1,c=""))}function g(e){e.nodeType!==Node.TEXT_NODE&&("UL"===e.tagName||"OL"===e.tagName?(d=d.parent,f=!0):"DIV"===e.tagName||"P"===e.tagName?(h=!0,c=""):"A"===e.tagName&&(d.text+="]("+e.getAttribute("href")+")"))}do{if(m(o),u=o.firstChild)o=u;else if(u=o.nextSibling)o=u;else{do{(u=o.parentNode.nextSibling)?(g(o.parentNode),o=u):g(o=o.parentNode)}while(!u&&o&&o.parentNode);if(!u)break}}while(o);return r&&this.stripParents(l),n&&function e(t,a){isNaN(a)&&(a=0);for(var i="",r=0;r<a;r++)i+="--";if(a&&console.log(i,t.text),t.items)for(r=0;r<t.items.length;r++)e(t.items[r],a+1)}(l),l}},t.a=new d},function(e,t,a){"use strict";var i=a(9),r=a(38);function n(){this.isLive=!1,this.wasLive=!1,this.seenInPass=!1,this.deadNeedsNotify=!1,this.index=-1,this.width=0,this.height=0,this.offset=0,this.paneObject=void 0,this.cellChanged=new r.a,this.offsetX=new i.a(0),this.isAnimatingOffsetX=!1}n.prototype={kill:function(e){this.isLive=!1,this.index=-1,this.isAnimatingOffsetX=!1,e?(this.deadNeedsNotify=!1,this.cellChanged.notify()):this.deadNeedsNotify=!0},update:function(e,t,a,i,r,n){this.seenInPass=!0,this.wasLive=this.isLive,this.deadNeedsNotify=!1,this.isAnimatingOffsetX=!1,this.isLive&&e===this.index&&t===this.width&&a===this.height&&i===this.offset&&n===this.paneObject||(this.isLive=!0,this.index=e,this.width=t,this.height=a,this.paneObject=n,this.offset=i,this.prevOffset=r,this.cellChanged.notify())},getState:function(){return{item:this.paneObject&&this.paneObject.id,index:this.index,height:this.height,offset:this.offset,prevOffset:this.prevOffset,deadNeedsNotify:this.deadNeedsNotify,isLive:this.isLive}}},t.a=n},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(5),s=a(4),o=a(7),l=a(10),d=a(9),c=a(38),u=a(11),h=a(8),f=r.a.MatchState;function p(e,t,a){this.callback=a,this.pane=e,this.searchArr=[],this.matches={},this.previousSearch="",this._stickyMatches={},this._stickyMatchesAwaitingClear=[],this.itemStoreFilter=void 0,this.UI=void 0,this.isFocused=new d.a,this._destroyed=!1,n.a.forceBind("isMatched",this),n.a.forceBind("checkChildrenParams",this),n.a.forceBind("hideNonMatches",this),e.supportSearchListenTextChanges&&u.a.listen("itemTextChanged",n.a.forceBind("handleItemTextChanged",this));var r={priority:{name:"priority",matchFn:this._matchFnPriority.bind(this)},starred:{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred items",matchFn:this._matchFnStarred.bind(this)},project:{name:"project",initialValue:1,icon:"prefixHeader",tooltip:"projects",matchFn:this._matchFnProject.bind(this)},task:{name:"task",initialValue:1,icon:"prefixTask",tooltip:"tasks",matchFn:this._matchFnTask.bind(this)},completeOption:{name:"completeOption",initialValue:1,icon:"icon-check",tooltip:"<b>Click</b> to show completed items.\n<b>"+s.a.priModKey+" + click</b> to show only completed items.",isOption:!0,matchFn:this._matchFnComplete.bind(this)},showOnlyMatches:{name:"showOnlyMatches",initialValue:1,icon:"icon-reorder",tooltip:"Flat mode: Show only matching items",canBeNegated:!1,isOption:!0},showOnlyAgendaDates:{name:"showOnlyAgendaDates",initialValue:1,icon:"icon-calendar",tooltip:"Show only dates on the Agenda",canBeNegated:!1,isOption:!0},showOnlyMatchingTags:{name:"showOnlyMatchingTags",initialValue:1,icon:"icon-short_text",tooltip:"Show only matching tag blocks",canBeNegated:!1,isOption:!0}};if(t){!1===t.showHierarchy&&(t.showOnlyMatches=1);var l=t.complete;!isNaN(l)&&isNaN(t.completeOption)&&(t.completeOption=1===l?-1:l+1)}for(var h=[],f=0;f<e.searchFilters.length;f++){var p=e.searchFilters[f];i.default.isString(p)?h.push(r[p]):h.push(p)}if(this.setupFilters(h,t),this.filterDate=void 0,this.value=t&&t.text||"",this.onChanged=new c.a(a),this._updateSearchArr(),this.value){var m=DuchessHelpers.parseText(this.value,null,null,null,International.getCurrentDateFormat(),null,null,o.a.contactManager.getContacts(),!0,!0);m&&this.onParsed(m)}}p.prototype={destroy:function(){this._destroyed=!0,this.pane.supportSearchListenTextChanges&&u.a.unlisten("itemTextChanged",this.handleItemTextChanged),this.onChanged.unlisten(this.callback),this.pane=void 0,this.UI=void 0,n.a.destroy(this)},setFilterTooltip:function(e,t){this.getFilter(e).tooltip=t},getFilterTooltip:function(e){var t=e.value.get();return t?"<b>Click</b> to clear this "+(e.isOption?"option":"filter"):e.isOption?e.tooltip:"<b>Click</b> to "+(e.initialValue>0?"show only ":"hide ")+e.tooltip+(t!==-e.initialValue?".\n<b>"+s.a.priModKey+" + click</b> to "+(e.initialValue<0?"show only ":"hide ")+e.tooltip+".":"")},setupFilters:function(e,t){for(var a=[],r=0;r<e.length;r++){var n=e[r],s=n.name,o=t&&t[s];n.value=new d.a(o||0),n.enabled=new d.a(void 0===n.enabled||n.enabled);try{i.default.PAssert(1541,!this.hasOwnProperty("filter_"+s),"Should not double define filter properties")}catch(e){i.default.reportError(e)}this["filter_"+s]=n,a.push(n)}this.filters=a},setFilterEnabled:function(e,t){var a=this.filters.indexOfWithProperty("name",e);a>=0&&this.filters[a].enabled.set(t)},getValue:function(){return this.value},getRemoteValue:function(){for(var e=this.value,t=0;t<this.filters.length;++t){var a=this.filters[t];if(a.remoteStringFn&&a.enabled.get()){var i=a.remoteStringFn(a.value.get());i&&(e+=" "+i)}}return e.trim()},getState:function(){for(var e={text:this.getValue(),showHierarchy:this.showHierarchy()},t=0;t<this.filters.length;t++){var a=this.filters[t];e[a.name]=a.value.get()}return e},focus:function(){this.UI.focus()},blur:function(){this.UI.blur()},onParsed:function(e){var t=e.dates&&e.dates[0];t===this.filterDate||t&&i.default.isDateSoft(t.text)||(this.filterDate=t),this.tags=e.tags,this.contacts=e.contacts},setValue:function(e){this.value=e,this._updateSearchArr(),this.update(!0),e&&l.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SearchChanged,data:this.getState()})},addToValue:function(e){var t=this.getSelectionOffset(),a=this.value;"-"!==a[a.length-1]&&"!"!==a[a.length-1]&&(e=" "+e),a+=e,this.setValue(a),this.setSelectionOffset(t+e.length)},toggleText:function(e,t){var a,r=this.value.trim(),n="\\B(-*)("+i.default.escapeRegExp(e)+")\\b",s=r.match(n);s?(a=!s[1]&&t?"-"+e:s[1]&&!t?e:" ",r=r.replace(new RegExp(n),a).replace(/  +/g," ")):r+=" "+(t?"-":"")+e;r=r.trim(),this.setValue(r),this.setSelectionOffset(r.length)},getSelectionOffset:function(){return this.UI.getSelectionOffset()},setSelectionOffset:function(e){this.UI.setSelectionOffset(e)},getSearchBox:function(){return this.UI.refs.searchBox},isSearched:function(){if(this.value.length>0)return!0;for(var e=0;e<this.filters.length;e++){var t=this.filters[e];if(t.enabled.get()&&t.value.get())return!0}},reset:function(){this.setValue("")},resetFilters:function(){for(var e=0;e<this.filters.length;e++){this.filters[e].value.set(0)}this.update(!0,!0)},getMatchedItems:function(){var e=[];for(var t in this.matches)this.matches[t]===f.Yes&&e.push(t);return e},isFlatSearchResult:function(e){return!this.showHierarchy()&&this.matches[e.id]===f.Yes},isMatchStateMatch:function(e){return void 0===e||e===f.Yes||e===f.ChildYes||e===f.Unknown},isMatched:function(e){if(this.pane.supportLocalSearch){var t=this.matches[e.id];return void 0===t&&e.hasText()&&!this.pane.isSettingText&&this.pane!==i.default.focusedPane&&(t=this.checkItem(e)),this.isMatchStateMatch(t)}return f.Yes},handleItemTextChanged:function(e){if(i.default.vmMain.paneManager.isPaneActive(this.pane.id)&&(e.force||i.default.focusedPane&&i.default.focusedPane.id!==this.pane.id)){var t=e.item,a=this.isMatched(t);this.checkItem(t),this.isMatched(t)!=a&&this.pane.refreshSearchResults()}},_updateSearchArr:function(){var e=this.value.toLowerCase().trim().split(/\s+/);this.searchArr=[];for(var t=0,a=0;a<e.length;++a){var i=e[a].startsWith("-"),r=i?e[a].substr(1):e[a];r&&"and"!==r&&"-"!==r&&(a>0&&("or"===r||"|"===r||"||"===r)?t++:(this.searchArr[t]||(this.searchArr[t]=[]),this.searchArr[t].push({text:r,isNegated:i})))}},toggleFilterDefault:function(e){var t=this["filter_"+e],a=t.value.get();a=a?0:t.initialValue,this.setFilter(e,a)},toggleFilter:function(e,t){var a=t?-1:1,i=this["filter_"+e].value.get();i=i===a?0:a,this.setFilter(e,i)},getFilter:function(e){return this["filter_"+e]},getFilterValue:function(e){return this["filter_"+e].value.get()},setFilter:function(e,t){"showOnlyMatches"===e&&this.clearListCache(),this["filter_"+e].value.set(t),this.update(!0,!0),l.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SearchChanged,data:this.getState()})},update:function(e,t,a){i.default.vmMain.beginUpdateItems(),(e||t)&&this.clearStickyMatches(),this.pane.supportLocalSearch&&(this.prevMatches=this.matches,this.matches={},this.isAnimatingSearch=a&&!e&&i.default.focusedPane===this.pane,this.checkChildren(e),this.prevMatches={}),this.isUpdatingSearch=!0,this.pane.isLoaded&&e&&(i.default.vmMain.setItemAnimationMode(r.a.ItemAnimationMode.None),this.onChanged.notify(t)),i.default.vmMain.commitUpdateItems(),setTimeout(function(){this.isUpdatingSearch=!1,i.default.vmMain.resetItemAnimationMode()}.bind(this),0)},clearStickyMatches:function(){this._stickyMatchesAwaitingClear=[],this._stickyMatches={},clearTimeout(this._timeoutHideNonMatches)},_checkMatch:function(e,t,a){var i=!0;return this.filterDate&&a==="@"+this.filterDate.text?i=this._matchDate(e):a.length>0&&i&&(i=!1,a===r.a.Prefix.Task||a===r.a.Prefix.Task2||a===r.a.Prefix.Task3||a===r.a.Prefix.Task4?i=e.isPrefixTask():a!==r.a.Prefix.Bullet&&a!==r.a.Prefix.Bullet2&&a!==r.a.Prefix.Bullet3||(i=e.isPrefixBullet()),i=i||t.indexOf(a)>=0),i},_isMatchStateOk:function(e){return e===f.Yes||e===f.Unknown||e===f.ChildYes},_matchFilter:function(e,t){if(e)return t?e>0?f.Unknown:f.Negated:e>0?f.No:f.Unknown},_matchFilters:function(e){for(var t=f.Unknown,a=0;a<this.filters.length;a++){var i=this.filters[a];if(i.matchFn){var r=i.matchFn(i.value.get(),e);r===f.Unknown||r!==f.Negated&&!this._isMatchStateOk(t)||(t=r)}}return t===f.Yes&&(t=f.Unknown),t},_matchFnComplete:function(e,t){return-1===e?t.isComplete()?f.Unknown:f.No:0===e&&t.isComplete()?f.Negated:f.Unknown},_matchFnStarred:function(e,t){return this._matchFilter(e,t.isStarred())},_matchFnProject:function(e,t){return this._matchFilter(e,t.isPrefixHeader())},_matchFnTask:function(e,t){return this._matchFilter(e,t.isPrefixTask())},_matchFnPriority:function(e,t){var a=t.priority();return e>0?a>=e?f.Yes:f.No:f.Unknown},_matchFnEmail:function(e,t,a){var r=t.getAttachments(),n=r&&r[0],s=n&&n.getPlugin()===i.default.vmMain.getDefaultEmailPlugin();return this._matchFilter(e,s,a)},_matchDate:function(e){var t=this.filterDate;if(t&&e.isOnDate(t.date))return!0},checkItem:function(e){var t,a=i.default.vmMain.root(),r=this.matches;try{i.default.PAssert(1542,e.parent()||e.isRootItem(),"Item parent does not exist while being searched",e.isArchived(),e===a)}catch(e){i.default.reportError(e)}if(this._stickyMatches[e.id])t=f.Yes;else if(e.isRootItem())t=f.Yes;else if(e.parent())if(r[e.parent().id]===f.Negated)t=f.Negated;else{0;var n,s,o,l,d,c,u=[],h=e.getSearchText(this.pane),p=(t=this._matchFilters(e))===f.Negated;if(this.isMatchStateMatch(t))for(s=0;s<this.searchArr.length;s++)for(c=this.searchArr[s],o=0;o<c.length;o++){if((d=c[o]).isNegated){l=d.text;try{i.default.PAssert(1543,l,"Each value in the search array should be valid at this point")}catch(e){i.default.reportError(e)}if(this._checkMatch(e,h,l)){u[s]=f.Negated,p=!0;break}}}if(!p&&this.pane.shouldSearchMatchParents&&e.parent()!==a&&this.showHierarchy()&&r[e.parent().id]===f.Yes)return r[e.id]=f.Yes,r[e.id];if(this.isMatchStateMatch(t)){for(s=0;s<this.searchArr.length;s++)if(u[s]!==f.Negated){for(c=this.searchArr[s],o=0;o<c.length;o++){l=(d=c[o]).text;try{i.default.PAssert(1544,l,"Each value in the search array should be valid at this point")}catch(e){i.default.reportError(e)}if(!d.isNegated&&!this._checkMatch(e,h,l))if(this.showHierarchy())for(n=e;n;){if(!(n=n.parent())||n===a){u[s]=f.No;break}if(this._checkMatch(n,n.getSearchText(),l))break}else u[s]=f.No;if(u[s]===f.No)break}u[s]===f.Unknown&&(u[s]=f.Yes)}for(s=0;s<u.length;s++)if(t===f.Unknown&&u[s]===f.Negated)t=f.Negated;else if(t!==f.Yes&&u[s]===f.No)t=f.No;else if(u[s]===f.Yes||u[s]===f.Unknown){t=f.Yes;break}t===f.Unknown&&(t=f.Yes)}t===f.No&&e.isNote()&&(t=r[e.parent().id])}else t=f.No;if(this.isMatchStateMatch(t)&&this.onlyMatchDates&&!this.pane.isOkOnAgenda(e)&&(t=f.No),t===f.Yes&&(e.isNote()&&(r[e.parent().id]=f.Yes),this.showHierarchy()))for(n=e.parent();n&&!n.isRootItem()&&r[n.id]!==f.Negated&&r[n.id]!==f.Yes;)r[n.id]=f.ChildYes,n.hasNote()&&(r[n.getNote().id]=f.Yes),n=n.parent();return r[e.id]=t,r[e.id]},checkChildrenParams:function(e){return this.checkItem(e)!==f.Negated},checkChildren:function(){var e={includeArchived:this.pane.showArchived.get(),includeNotes:!0,comparator:this.checkChildrenParams};for(var t in this.itemStoreFilter&&(e.itemStoreFilter=this.itemStoreFilter),e.itemStore=this.pane.getItemStore(),i.default.searchVMLIs(e),this.matches)if(this.matches.hasOwnProperty(t)&&this.isAnimatingSearch&&void 0!==this.prevMatches[t]&&this.isMatchStateMatch(this.prevMatches[t])&&!this.isMatchStateMatch(this.matches[t])){var a=o.a.getModel(t);this.isMatchStuck(a)||this.stickMatchAfterSearch(a,this.prevMatches[a.id])}},_getMatchedItem:function(e){return this._stickyMatches[e.id]||e},getItemDate:function(e){var t=this._stickyMatches[e.id];return t&&t.date},getItemRepeatDate:function(e){var t=this._stickyMatches[e.id];return t&&t.repeatDate},getItemDateText:function(e){var t=this._stickyMatches[e.id];return t&&t.dateText},getItemDuration:function(e){var t=this._stickyMatches[e.id];return t&&t.duration},getItemTags:function(e){var t=this._stickyMatches[e.id];return t&&t.tags},getItemContacts:function(e){var t=this._stickyMatches[e.id];return t&&t.contacts},getItemSearchText:function(e){var t=this._stickyMatches[e.id];return t&&t.searchText},getItemPrefix:function(e){var t=this._stickyMatches[e.id];return t&&t.prefix},stickMatch:function(e,t){var a=i.default.isVMLI(e)?e:e.item;if(!this._stickyMatches[a.id]){this.matches[a.id]=f.Yes;var r=a.getStickySearchInfo();t&&(r.isHiding=!0),i.default.vmMain.isInCompleteAction()&&(r.wasCompleted=!0),this._stickyMatches[a.id]=r}},isMatchStuck:function(e){var t=i.default.isVMLI(e)?e:e.item;return!!this._stickyMatches[t.id]},unstickMatch:function(e){var t=i.default.isVMLI(e)?e:e.item;delete this._stickyMatches[t.id]},isMatchStuckHiding:function(e){var t=i.default.isVMLI(e)?e:e.item,a=this._stickyMatches[t.id];return a&&a.isHiding},stickMatchAfterSearch:function(e,t){log("sticking match",e.getParsedText(),t),this.stickMatch(e,!0),t&&(this._timeoutHideNonMatches&&clearTimeout(this._timeoutHideNonMatches),this._stickyMatchesAwaitingClear.push(e),this._timeoutHideNonMatches=setTimeout(this.hideNonMatches,1200))},hideNonMatches:function(){console.log("hiding non matches",this._stickyMatchesAwaitingClear);for(var e=this.pane,t=this._stickyMatchesAwaitingClear,a=t.length,r=0,n=0;n<a;n++){var s=t[n],o=this._stickyMatches[s.id];o&&o.wasCompleted&&r++,this.unstickMatch(s)}var l=a+(a>1?" items":" item"),d={hold:!1};r!==a?(d.text=l+" hidden because "+(a>1?"they do":"it does")+" not match search",d.actionText="UNHIDE",d.action=function(){var i=h.a.save();e.setIgnoreRestoreScroll();for(var r=0;r<a;r++){var n=t[r];this.stickMatch(n),this._stickyMatchesAwaitingClear.push(n)}this.pane.updateItemsImmediate(!0,void 0,void 0,!0),h.a.restore(i)}.bind(this)):(d.text=l+" completed",d.actionText="UNDO",d.action=function(){var i=h.a.save();e.setIgnoreRestoreScroll();for(var r=0;r<a;r++){t[r].isComplete(!1,ChangeType.Local)}this.pane.updateItemsImmediate(!0,void 0,void 0,!0),h.a.restore(i)}.bind(this)),i.default.toasts.pushMessage(d);var c=h.a.save();this._stickyMatchesAwaitingClear=[],e.setIgnoreRestoreScroll(),e.updateItemsImmediate(!0,void 0,void 0,!0),h.a.restore(c)},showHierarchy:function(){return this.pane.type===PaneMode.Task&&1!==this.getFilterValue("showOnlyMatches")},setShowHierarchy:function(e){this.pane.supportSearchFlat&&this.setFilter("showOnlyMatches",e?0:1)},showOnlyAgendaDates:function(){return this.pane.type===PaneMode.Task&&this.getFilterValue("showOnlyAgendaDates")},showOnlyMatchingTags:function(){return this.pane.type===PaneMode.Task&&this.getFilterValue("showOnlyMatchingTags")},clearListCache:function(){this.pane.getInfiniteList().clearCache()},getTags:function(){return this.tags},getContacts:function(){return this.contacts}},t.a=p},function(e,t,a){"use strict";var i=a(0);function r(e){try{i.default.PAssert(1576,e.id&&e.type&&e.sizeInPane,"Pane object missing properties")}catch(e){i.default.reportError(e)}for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}r.prototype={},t.a=r},function(e,t,a){"use strict";var i=a(0),r=a(7),n=a(5),s=a(17),o=a(19),l=a(10),d=a(8),c=a(26),u=a(31);function h(){try{i.default.PAssert(817,!i.default.menus,"Should only have a single instance of VMMenus")}catch(e){i.default.reportError(e)}this.billingManager=i.default.billingManager,this.modals=[Modals.Settings,Modals.Alert,Modals.Confirm,Modals.Prompt,Modals.ExportData,Modals.RevisionHistory,Modals.ImportData,Modals.ReportProblem,Modals.Billing,Modals.Welcome,Modals.EmailReply,Modals.EmailCompose,Modals.MobileSettings,Modals.DeleteAccount,Modals.Invoices,Modals.Options,Modals.Lightbox,Modals.EnterCode,Modals.ShareDoc,Modals.ReportBug],this.modalStack=new o.a,this.contextMenuStack=new o.a,this.emailComposeStack=new o.a,n.a.forceBind("onClosingSettings",this),this.init()}h.prototype={init:function(){},vmPicker:function(){return i.default.vmMain.vmPicker},toggleContextMenu:function(e,t){i.default.menus.isContextMenuOpen()?i.default.menus.closeContextMenu():this.openContextMenu(e,t)},openAddPaneMenu:function(e,t){e.componentName="ReactContextMenuPanes",e.showAddMore=!0,e.onSelected=function(a,r,n){t&&t(a,r,n),i.default.vmMain.paneManager.addPaneByButton(a,r,n,e.fromNewBoard)},this.openContextMenu(e)},openContextMenu:function(e,t){e.element&&i.default.findParent(e.element,"desktopSidebar")&&(e.pos={left:u.a.getSidebarWidth()+4},e.side="right",i.default.findParent(e.element,"desktopMenuBottom")&&(e.openFromBottom=!0)),this.contextMenuNoFade=t,this.contextMenuStack.push(e)},indexOfContextMenu:function(e){var t=this.contextMenuStack.get(),a=t.indexOfWithProperty("fn",e);return a<0&&(a=t.indexOfWithProperty("componentName",e)),a},closeContextMenu:function(e,t,a){if(e){var r=this.indexOfContextMenu(e);try{i.default.PAssert(818,r>=0,"Tried to close a context menu that was not open")}catch(e){i.default.reportError(e)}if(r>=0){var n=this.contextMenuStack.get()[r];n.onClosed&&n.onClosed(t,a),this.contextMenuStack.removeAt(r)}}else{for(var s=this.contextMenuStack.get(),o=s.length-1;o>=0;o--)s[o].onClosed&&s[o].onClosed(!1,a);this.contextMenuStack.clear()}0===this.contextMenuStack.length()&&d.a.updateCaret()},getTopContextMenu:function(){var e=this.contextMenuStack.get();if(e){var t=e[e.length-1];return t.componentName||t.fn}},isAutocompleteOpen:function(){return this.indexOfContextMenu("ReactAutocomplete")>=0},isContextMenuOpen:function(e){return e?this.indexOfContextMenu(e)>=0:this.contextMenuStack.get().length>0},isModalOpen:function(e){var t=this.modalStack.get();if(!e)return t.length>0;for(var a=0;a<t.length;a++)if(t[a].id===e)return!0},openModalNew:function(e,t){try{i.default.PAssert(819,void 0===t||i.default.isObject(t),"Must always pass in a valid object for params")}catch(e){i.default.reportError(e)}try{i.default.PAssert(820,this.modals.indexOf(e)>=0,"Modal must be registered as a new modal to use this fn: ",e)}catch(e){i.default.reportError(e)}if(!this.isModalOpen(e)){t=t||{};try{i.default.PAssert(821,void 0===t.id,"Should not already have an ID defined with modal params")}catch(e){i.default.reportError(e)}t.id=e,d.a.reset(),this.modalStack.push(t)}},closeModalNew:function(e,t){var a=this.modalStack.get().indexOfWithProperty("id",e);if(a>=0){var i=this.modalStack.get()[a],r=!0;i.onClosing&&(r=i.onClosing()),r&&(this.modalStack.removeAt(a),i.callback&&i.callback(t))}},confirm:function(e,t){try{i.default.PAssert(822,t,"Confirm modals should have callbacks",e)}catch(e){i.default.reportError(e)}this.openModalNew(Modals.Confirm,{text:e,callback:t})},prompt:function(e,t){try{i.default.PAssert(823,t,"Prompt modals should have callbacks",e)}catch(e){i.default.reportError(e)}this.openModalNew(Modals.Prompt,{text:e,callback:t})},alert:function(e){try{i.default.PAssert(824,!e.action,"Still using an old style alert",e)}catch(e){i.default.reportError(e)}e.action&&(e.callback=e.action),this.openModalNew(Modals.Alert,e)},options:function(e,t,a){try{i.default.PAssert(825,i.default.isArray(t,"Must have valid options array"))}catch(e){i.default.reportError(e)}try{i.default.PAssert(826,a,"Options modal must have a callback")}catch(e){i.default.reportError(e)}this.openModalNew(Modals.Options,{text:e,options:t,callback:a})},openSettings:function(e){l.a.performAction(TrackerType.UIAction,{type:TrackerUIAction.OpenSettingsMenu}),this.openModalNew(Modals.Settings,{section:e,onClosing:this.onClosingSettings})},onClosingSettings:function(){var e=!c.a.isSaveEnabled.get();return e||this.confirm("You have unsaved changes. Are you sure you want to cancel your changes?",function(e){e&&(c.a.isSaveEnabled.set(!1),this.closeModalNew(Modals.Settings))}.bind(this)),e},openDisplaySettings:function(){i.default.vmMain.isDisplaySettingsOpen.set(!0),l.a.performAction(TrackerType.UIAction,{type:TrackerUIAction.OpenDisplaySettings})},getUserEmail:function(){return i.default.getUserIdentifier()},getUserName:function(){var e=s.a.authenticatedUser.get();return e?e.displayName:i.default.vmMain.gdriveStatus()===DriveStatus.Saved?"Connected":i.default.vmSetup.loginState()===LoginState.LOGGED_IN?"Connecting":"Demo"},openMenuExternalApp:function(e,t){this.openContextMenu({componentName:"ReactContextMenuMobileOpenLink",position:"bottom",html:e,onClick:t})},_indexOfCompose:function(e){for(var t=this.emailComposeStack.get(),a=0;a<t.length;++a){if(t[a].draftMsg.id===e)return a}return-1},isComposeOpenForEmail:function(e){return this._indexOfCompose(e)>=0},openComposeEmail:function(e,t,a,r){try{i.default.PAssert(827,e,"Must have a valid email plugin")}catch(e){i.default.reportError(e)}try{i.default.PAssert(828,!t||i.default.isString(t),"Must have a string threadID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(829,!a||i.default.isString(a),"Must have a string messageID")}catch(e){i.default.reportError(e)}if(d.a.reset(),this.isComposeOpenForEmail());else{var n=e.getDraftByID(e.getDefaultAccount(),t,a,r);try{i.default.PAssert(830,n,"Must always create a valid draft")}catch(e){i.default.reportError(e)}try{i.default.PAssert(831,this.emailComposeStack.indexOf(n)<0,"Must not double-open drafts, should re-use")}catch(e){i.default.reportError(e)}this.emailComposeStack.get().indexOfWithProperty("attach",n.attach)<0&&this.emailComposeStack.push(n)}l.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ComposeEmail})},closeComposeEmail:function(e,t){var a=this._indexOfCompose(t.id);try{i.default.PAssert(832,a>=0,"Must have found a valid composing email to remove")}catch(e){i.default.reportError(e)}this.emailComposeStack.removeAt(a)},openItemEditor:function(e){try{i.default.PAssert(833,!e.item==!!e.addOnSave,"Must be adding item if no item prop")}catch(e){i.default.reportError(e)}if(!e.item){e.parent||(e.parent=r.a.getRootModel());var t=r.a.createTempVMLI({text:e.text||i.default.getDefaultItemText()},{changeType:ChangeType.AllLocal});e.item=t;var a=e.endSave;e.endSave=function(){setTimeout(function(){r.a.destroyTempVMLI(t.id)},0),a&&a.apply(this,arguments)}}e.componentName="ReactItemDetailsPopup",this.openContextMenu(e)},openLightbox:function(e,t,a){try{i.default.PAssert(834,!0,"Should never open lightbox on mobile")}catch(e){i.default.reportError(e)}this.openModalNew(Modals.Lightbox,{src:e,buttonText:t,buttonAction:a})}},t.a=h},function(e,t,a){"use strict";var i=a(0),r=a(39),n=a(15),s=a(9);function o(e,t){this._remoteData=t?e:void 0,e=e||{},this.id=e.id,this._title=new s.a(e.title||""),this._isShared=new s.a(e.shared||!1),this._isOwned=new s.a(!this._remoteData),this._isOpen=new s.a(!1),this._isDeleted=!1,this._isTrashed=this._isRemoteTrashed(this._remoteData),this._docFolderID=void 0,this._realtimeDoc=void 0,this._remoteData&&this.updateData(this._remoteData)}o.prototype={_isRemoteTrashed:function(e){var t=!1;return e&&e.labels?t=!!e.labels.trashed:e||(t=!0),t},updateData:function(e,t){try{i.default.PAssert(1545,e,"Must supply remote data to update doc")}catch(e){i.default.reportError(e)}if(e){if(this._remoteData){try{i.default.PAssert(1546,!e.id||e.id===this.id,"ID must either not exist or be the same")}catch(e){i.default.reportError(e)}for(var a in e)e.hasOwnProperty(a)&&(this._remoteData[a]=e[a])}else this._remoteData=e,this.id=e.id;i.default.settings.get(Settings.gdocId)===this._remoteData.id&&i.default.settings.set(Settings.gdocTitle,this._remoteData.title),this._title.set(this._remoteData.title),this._isShared.set(this._remoteData.shared);var r=this._remoteData.userPermission;r&&"me"===r.id&&"owner"===r.role?this._isOwned.set(!0):this._isOwned.set(!1)}this._isTrashed=this._isRemoteTrashed(this._remoteData)},setRealtimeDoc:function(e){try{i.default.PAssert(1547,!this._realtimeDoc,"Must only have a single realtime doc instance per doc")}catch(e){i.default.reportError(e)}this._realtimeDoc=e},hasDriveBacking:function(){return!!this._remoteData},generateShareInfo:function(e){var t,a={};a.fromUser=i.default.getUserIdentifier(),e&&(a.toUser=e);try{var r=JSON.stringify(a);t=i.default.utf8_to_b64(r)}catch(e){i.default.reportError(e)}return t},insertPermission:function(e,t){try{i.default.PAssert(1548,this._remoteData,"Must have remote data to add permissions")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1549,this.id,"Must specify a valid document ID to operate on")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1550,e,"Must specify a valid email to add")}catch(e){i.default.reportError(e)}var a="https://www.moo.do/app/#login=true&file="+this.id+"&sinfo="+this.generateShareInfo(e),r=function(r){i.default.XHR_PrivateAPI({type:"POST",path:"/sharing/shareDoc",data:{fromUser:i.default.getUserIdentifier(),toEmail:e,docURL:a},requireAuth:!0,cb:function(e){e.status}}),this.getDocumentFolder(function(t){i.default.vmMain.remoteAPI().drivePermissionsInsert(t,e,!1,function(e){},function(e){})}),r&&(this._remoteData.permissions.push(r),this._remoteData.shared=!0,this._isShared.set(!0)),t(!!r)}.bind(this),n=function(a){var s=!1;if(a.error&&400===a.error.code)for(var o=a.error.errors,l=0;l<o.length;++l){"invalidSharingRequest"===o[l].reason&&(i.default.vmMain.remoteAPI().drivePermissionsInsert(this.id,e,!0,r,n),s=!0)}s||t(!1)}.bind(this);i.default.vmMain.remoteAPI().drivePermissionsInsert(this.id,e,!1,r,n)},deletePermission:function(e,t){try{i.default.PAssert(1551,this._remoteData,"Must have valid remote data to remove permissions")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1552,this.id,"Must specify a valid document ID to operate on")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1553,e,"Must specify a valid permissionID to remove")}catch(e){i.default.reportError(e)}var a=function(a){for(var i=0;i<this._remoteData.permissions.length;++i)if(this._remoteData.permissions[i].id===e){this._remoteData.permissions.removeAt(i);break}1===this._remoteData.permissions.length&&(this._remoteData.shared=!1,this._isShared.set(!1)),t(!0)}.bind(this);i.default.vmMain.remoteAPI().drivePermissionsDelete(this.id,e,a,function(e){t(!1)}),this.getDocumentFolder(function(t){i.default.vmMain.remoteAPI().drivePermissionsDelete(t,e,function(e){},function(e){})})},listPermissions:function(e){try{i.default.PAssert(1554,this._remoteData,"Must have valid remote data to list permissions")}catch(e){i.default.reportError(e)}i.default.vmMain.remoteAPI().drivePermissionsList(this.id,function(t){e(t.items)},function(t){e(void 0)})},getDocumentFolder:function(e){try{i.default.PAssert(1555,!i.default.isDemoMode(),"Should not be creating file structure in demo mode")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1556,e,"Must provide a valid callback when getting the doc folder")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1557,this.id,"Must have a valid id")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1558,this.getTitle(),"Must have a valid doc title")}catch(e){i.default.reportError(e)}if(this._docFolderID)return e(this._docFolderID);var t=function(){this.createDocumentFileStructure(function(t){return t?(this._docFolderID=t,e(t)):e(void 0)})}.bind(this),a=n.a.DocFolderPropertyPrefix+this.id;try{var r="properties has {key='"+n.a.DocFolderProperty+"' and value='"+a+"' and visibility='PRIVATE'} and trashed=false",s=function(a){if(0!==a.length){try{i.default.PAssert(1559,1===a.length,"Must have only a single document folder")}catch(e){i.default.reportError(e)}var r=a[0];return this._docFolderID=r.id,this.updateDocumentFolderProps(r),e(r.id)}t()}.bind(this),o=function(t){return e()};i.default.vmMain.remoteAPI().driveFilesList(r,s,o,{getAllPages:!0})}catch(t){return i.default.reportError(t),e()}},updateDocumentFolderProps:function(e){try{i.default.PAssert(1560,e,"Must provide valid doc folder info")}catch(e){i.default.reportError(e)}if(this.getTitle()){var t=!1,a=!1;if(e.properties){for(var r=0;r<e.properties.length;++r)if(e.properties[r].key===n.a.DocFolderTitleProperty){e.properties[r].value!==this.getTitle()&&(t=!0);break}}else a=!0;if(a){var s=function(){},o=function(e){i.default.reportError(new Error("Unable to update drive folder title property"))};i.default.vmMain.remoteAPI().drivePropertiesInsert(e.id,n.a.DocFolderTitleProperty,this.getTitle(),s,o)}else if(t){s=function(){},o=function(e){i.default.reportError(new Error("Unable to update drive folder title property"))};i.default.vmMain.remoteAPI().drivePropertiesUpdate(e.id,n.a.DocFolderTitleProperty,this.getTitle(),s,o)}}n.a.getRootFolder(function(t){if(t){var a=!1;if(e.parents)for(var r=0;r<e.parents.length;++r)if(e.parents[r].id===t){a=!0;break}if(!a){i.default.vmMain.remoteAPI().driveParentsInsert(e.id,t,function(){},function(e){i.default.reportError(new Error("Unable to add shared doc folder to root folder"))})}}}),this.hasDriveBacking()&&this.ensureFolderPermissions(e)},createDocumentFileStructure:function(e){try{i.default.PAssert(1561,this.id,"In order to create a valid folder structure we must have a valid document ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1562,this.getTitle(),"Must provide a valid document title")}catch(e){i.default.reportError(e)}n.a.getRootFolder(function(t){if(!t)return e();var a=[{key:n.a.DocFolderProperty,value:n.a.DocFolderPropertyPrefix+this.id,visibility:"PRIVATE"}];this.getTitle()&&a.push({key:n.a.DocFolderTitleProperty,value:this.getTitle(),visibility:"PRIVATE"});var s=r.a.fns("drive").files.insert.packedFn,o={resource:{fields:"createdDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,userPermission(id,role,type)",mimeType:n.a.FOLDER_MIMETYPE,title:n.a.DocFolderTitlePrefix+this.id,writersCanShare:!1,parents:[{id:t}],properties:a}},l=function(t){return this._docFolderID=t.id,this.hasDriveBacking()&&this.ensureFolderPermissions(t),e(t.id)}.bind(this);i.default.vmMain.remoteAPI().runRemoteSingleRequest(s,o,l,function(t){return e()})}.bind(this))},ensureFolderPermissions:function(e){try{i.default.PAssert(1563,this._remoteData,"Must have valid remote data to take permissions from")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1564,e,"Must supply a valid folder ID to set permissions on")}catch(e){i.default.reportError(e)}var t=function(e){},a=function(e){},r=e.permissions,n=this._remoteData.permissions;try{i.default.PAssert(1565,n,"Must always have a valid list of permissions for this doc")}catch(e){i.default.reportError(e)}function s(e){var t=!1;if(r)for(var a=0;a<r.length;++a)if(r[a].emailAddress===e){t=!0;break}return t}if(n)for(var o=0;o<n.length;++o){var l=n[o];if("anyone"===l.type);else{var d=l.emailAddress;d&&"owner"!==l.role&&(s(d)||i.default.vmMain.remoteAPI().drivePermissionsInsert(e.id,d,!1,t,a))}}},rename:function(e,t){if(this._remoteData||this.getTitle()){try{i.default.PAssert(1566,e,"Must specify a valid title to rename to")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1567,i.default.isFunction(t),"Must supply a valid callback fn")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1568,this.getTitle(),"Must have a valid title set already")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1569,this.getTitle()!==e,"Should always be setting to a different title")}catch(e){i.default.reportError(e)}var a=r.a.fns("drive").files.patch.packedFn,s={fileId:this.id,resource:{title:e}},o=function(a){this.getDocumentFolder(function(t){i.default.vmMain.remoteAPI().drivePropertiesUpdate(t,n.a.DocFolderTitleProperty,e,function(e){},function(e){i.default.reportError(new Error("Unable to update drive folder title property"))})}.bind(this)),this._title.set(e),this._remoteData.title=e,this.isOpen()&&n.a.setDocInfo(this.id,e),log("File renamed to:"+e),t(!0)}.bind(this);i.default.vmMain.remoteAPI().runRemoteSingleRequest(a,s,o,function(e){t(!1)})}else this._title.set(e),t(!0)},shareFile:function(e,t){try{i.default.PAssert(1570,e,"Must specify a valid fileID to share")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1571,t,"Must specify a valid callback for sharing")}catch(e){i.default.reportError(e)}this.getDocumentFolder(function(a){i.default.vmMain.remoteAPI().driveParentsInsert(e,a,function(e){t(!0,e)},function(e){t(!1,e)})})},unshareFile:function(e,t){try{i.default.PAssert(1572,e,"Must specify a valid fileID to unshare")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1573,t,"Must specify a valid callback for unsharing")}catch(e){i.default.reportError(e)}this.getDocumentFolder(function(a){i.default.vmMain.remoteAPI().driveParentsDelete(e,a,function(e){t(!0)},function(e){t(!1)})})},deleteData:function(e){var t=0,a=!1,n=function(){t--,o()},s=function(){a=!0,t--,o()},o=function(){0!==t||a||this.getDocumentFolder(function(e){i.default.vmMain.remoteAPI().driveFilesTrash(e,function(){this._docFolderID=void 0},function(){})})}.bind(this),l=function(a){this.getDocumentFolder(function(e){i.default.vmMain.remoteAPI().driveChildrenList(e,function(a){for(var o=0;o<a.length;++o){var l=r.a.fns("drive").children.delete.packedFn,d={folderId:e,childId:a[o].id};t++,i.default.vmMain.remoteAPI().runRemoteSingleRequest(l,d,n,s)}},function(e){},{getAllPages:!0,maxPageResults:500})}),this._isDeleted=!0,this._isTrashed=!0,this._remoteData&&(this._remoteData.trashed=!0),e(!0)}.bind(this);i.default.vmMain.remoteAPI().driveFilesTrash(this.id,l,function(t){e(!1)})},isShared:function(){return this._isShared.get()},isOwned:function(){return this._isOwned.get()},isTrashed:function(){return this._isTrashed&&!this.isShared()},open:function(){try{i.default.PAssert(1574,!this._isOpen.get(),"Document must be closed to be opened")}catch(e){i.default.reportError(e)}this._isOpen.set(!0),i.default.vmMain.docManager.setDocOpened(this.id)},close:function(){try{i.default.PAssert(1575,this._isOpen.get(),"Document must be opened to be closed")}catch(e){i.default.reportError(e)}this._isOpen.set(!1),i.default.vmMain.docManager.setDocClosed(this.id)},isOpen:function(){return this._isOpen.get()},getTitle:function(){return this._title.get()},getData:function(){return this._remoteData}},t.a=o},function(e,t,a){"use strict";var i=a(0),r=(a(5),a(27)),n=a(13);function s(){this._registeredRenderers=[],this._registeredRenderers[PluginRenderTypes.Generic]={},this._registeredRenderers[PluginRenderTypes.StyledText]={},this._registeredRenderers[PluginRenderTypes.UnstyledText]={},this._registeredRenderers[PluginRenderTypes.Measure]={}}s.prototype={registerDefaultRenderers:function(){var e=this;this.registerRenderer(PluginRenderTypes.StyledText,PluginRenderers.DriveFile,function(e){return e.isLoaded()?e.hasField("isDeleted")&&e.getField("isDeleted")?e.getField("title")+"  (Deleted)":e.getField("title"):e.hasField("title")?e.getField("title")+"  (Loading...)":"Loading..."},["title"]),this.registerRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.DriveFile,function(e){return e.hasField("title")?e.getField("title"):"Loading..."},["title"]),this.registerRenderer(PluginRenderTypes.Measure,PluginRenderers.DriveFile,function(t,a,i){var n=e.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.DriveFile);return r.a.measureWord(a,n(t),i,!1)},["title"]),this.registerRenderer(PluginRenderTypes.StyledText,PluginRenderers.EmailThread,function(e,t){var a="";if(e&&e.isLoaded()){var i=e.getField("count"),r=e.getField("subject");if(r&&""!==r||(r="(no subject)"),r='<span class="subject c-foreground'+(i>1?" hasCount":"")+'">'+r+"</span>",t&&t.type===PaneMode.Gmail){var s=e.getPlugin().getDisplayTags(e,t);a+='<span class="line1"><span class="from">'+e.getPlugin().getDisplayParticipants(e)+"</span>";var o,l=e.getField("date");if(o=l.isToday()?n.a.getFormat(DFormat.ShortTime):l.getYear()!==(new Date).getYear()?n.a.getFormat(DFormat.MonthDayYearShort):n.a.getFormat(DFormat.MonthDay),a+='<span class="emailDate c-foreground-faded">'+l.toString(o)+"</span></span>",a+='<span class="line2">'+r,(e.getField("hasAttachments")||i>1)&&(a+='<span class="line2Right">',e.getField("hasAttachments")&&(a+='<span class="attach icon-attach_file"></span>'),i>1&&(a+='<span class="count">'+i+"</span>"),a+="</span>"),a+="</span>",e.hasField("snippet")||s.length){if(a+='<span class="line3">',e.hasField("snippet")&&(a+='<span class="snippet c-foreground-faded">'+e.getField("snippet")+"</span>"),s.length){a+='<span class="tags">';for(var d=0;d<s.length;++d)a+='<span class="emailLabel c-tag">'+s[d]+"</span>";a+="</span>"}a+="</span>"}}else a=r}else a="Loading...";return a},["from","subject","snippet","count","date"]),this.registerRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.EmailThread,function(e){var t=e.getField("subject");return t&&""!==t||(t="(no subject)"),e.isLoaded()?t:"Loading..."},["from","subject"]),this.registerRenderer(PluginRenderTypes.Measure,PluginRenderers.EmailThread,function(e,t,a){var i;e.isLoaded()?(i=e.getField("subject"))&&""!==i||(i="(no subject)"):i="Loading...";return r.a.measureWord(t,i,a,!1)},[]),this.registerRenderer(PluginRenderTypes.StyledText,PluginRenderers.CalendarEvent,function(e){return""},[]),this.registerRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.CalendarEvent,function(e){return""},[]),this.registerRenderer(PluginRenderTypes.Measure,PluginRenderers.CalendarEvent,function(t,a,i){var n=e.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.CalendarEvent);return r.a.measureWord(a,n(t),i,!1)},[]),this.registerRenderer(PluginRenderTypes.StyledText,PluginRenderers.Unknown,function(e){return"Unknown Plugin"},[]),this.registerRenderer(PluginRenderTypes.Measure,PluginRenderers.Unknown,function(e,t,a){return r.a.measureWord(t,"Unknown Plugin",a,!0)},[])},registerRenderer:function(e,t,a,r){try{i.default.PAssert(1629,this._registeredRenderers[e],"Invalid renderer type",e,t)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1630,!this._registeredRenderers[e][t],"Cannot register a renderer twice",e,t)}catch(e){i.default.reportError(e)}this._registeredRenderers[e][t]={fn:a,fields:r}},useRenderer:function(e,t){try{i.default.PAssert(1631,this._registeredRenderers[e],"Invalid renderer type",e,t)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1632,this._registeredRenderers[e][t],"Renderer has not been registered yet",e,t)}catch(e){i.default.reportError(e)}return this._registeredRenderers[e][t].fn},ensureRendererFields:function(e,t,a){}},t.a=s},function(e,t,a){"use strict";var i=a(5);function r(e){this._cb=e,this._pageToken=void 0,this._validToken=!1}var n={hasPaginationToken:function(){return this._validToken},needsPaginationToken:function(){return!this.hasPaginationToken()&&!this._pageToken},setPaginationToken:function(e){this._pageToken=e,this._validToken=!0,this._cb&&this._cb(this)},beginDataPageLoad:function(){return this._pageToken.notifyBeginUse(),this._pageToken},endDataPageLoad:function(e){e?this._pageToken.notifyEndUse():this._validToken=!1},notifyPaginationUpdate:function(){log("Pagination Update")}};i.a.defineBase(r),i.a.extend(r.prototype,n),t.a=r},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(86);function s(e,t,a){this._super.constructor.call(this),this._searchQuery=e,this._invalid=!1,this._hasError=!1,this._remoteRequestCB=a,this._activePageRequest=void 0,this._lastPageRequest=void 0,this._cachedResults=[],this._localPageOffset=0,this._automaticPageRequests=0,this._pageSize=t,r.a.forceBind("onEntry",this)}var o={invalidate:function(){this._invalid=!0},isValid:function(){return!this._invalid},hasError:function(){return this._hasError},getNextPage:function(e,t){try{i.default.PAssert(2228,i.default.isFunction(e)&&i.default.isFunction(t)||this._lastPageRequest,"Must provide valid callbacks")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2229,!this._invalid,"Should never request another page from an invalidated search")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2230,this.hasMoreResults(),"Should never request another page if there are no possible results")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2231,!this._activePageRequest,"Should only run a single request at a time")}catch(e){i.default.reportError(e)}if(e||t||!this._lastPageRequest||(e=this._lastPageRequest.entryCB,t=this._lastPageRequest.doneCB),this._activePageRequest)t(!1);else if(this._cachedResults.length>this._localPageOffset+this._pageSize){for(var a=0;a<this._pageSize;++a){var r=this._cachedResults[this._localPageOffset+a];try{e(r)}catch(e){i.default.reportError(e)}}this._localPageOffset+=this._pageSize,t(!0)}else if(this.hasPaginationToken()&&this._automaticPageRequests<5)this._activePageRequest={entryCB:e,doneCB:t},this._automaticPageRequests++,this._remoteRequestCB(this);else if(this._localPageOffset<this._cachedResults.length){for(a=this._localPageOffset;a<this._cachedResults.length;++a){r=this._cachedResults[a];try{e(r)}catch(e){i.default.reportError(e)}this._localPageOffset++}t(!0)}},onEntry:function(e){this._invalid||this._cachedResults.push(e)},onDone:function(e){this._invalid||this._activePageRequest&&(this._lastPageRequest=this._activePageRequest,this._activePageRequest=void 0,e?this.getNextPage(this._lastPageRequest.entryCB,this._lastPageRequest.doneCB):(this._invalid=!0,this._hasError=!0,pageRequest.doneCB(e)))},hasResults:function(){return this._cachedResults.length>0},hasMoreResults:function(){return this._cachedResults.length>this._localPageOffset||this.hasPaginationToken()}};r.a.inherit(n.a,s),r.a.extend(s.prototype,o),t.a=s},function(e,t,a){"use strict";var i=a(0);function r(){this._favMap={}}r.prototype={_ensureGroup:function(e){var t=[];return this._favMap[e]||(this._favMap[e]=t),t},notifyAdd:function(e,t){var a=this._ensureGroup(t);try{i.default.PAssert(2433,a.indexOf(e)<0,"Should not double add item to group")}catch(e){i.default.reportError(e)}a.push(e)},notifyRemove:function(e,t){var a=this._ensureGroup(t);try{i.default.PAssert(2434,a.indexOf(e)>=0,"Must have been added to group before removing")}catch(e){i.default.reportError(e)}a.remove(e)},getItems:function(e){return this._favMap[e]},hasItems:function(e){var t=this.getItems(e);return t&&t.length>0}},t.a=new r},function(e,t,a){"use strict";var i=a(0),r=a(5);function n(e,t){this._type=e,this._name=t,this._doc=void 0,this._loadFn=void 0,this._errorFn=void 0,this._initFn=void 0}n.prototype={open:function(e,t,a,r){try{i.default.PAssert(2054,!1,"SubClass must override")}catch(e){i.default.reportError(e)}},close:function(){try{i.default.PAssert(2055,!1,"SubClass must override")}catch(e){i.default.reportError(e)}},_getDocument:function(){return this._doc},getModel:function(){return this._doc.getModel()},setLoadFn:function(e){return this._loadFn=e,this._onLoad.bind(this)},setInitFn:function(e){return this._initFn=e,this._onInit.bind(this)},setErrorFn:function(e){return this._errorFn=e,this._onError.bind(this)},_onLoad:function(e){this._doc=e;try{this._loadFn(e)}catch(e){i.default.reportError(e)}},_onError:function(e){this._errorFn(e)},_onInit:function(e){try{this._initFn(e)}catch(e){i.default.reportError(e)}}},r.a.defineBase(n),t.a=n},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=(a(81),l.a.createClass({displayName:"ReactSearchButton",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){var e=this.props.filter;this.firstValue=this.props.filterValue||e.initialValue},onClickIcon:function(e){var t=this.props.filter,a=this.props.filterValue;a=!1!==t.canBeNegated&&(!n.a.mac&&e.ctrlKey||n.a.mac&&e.metaKey)&&!isNaN(t.initialValue)&&a!==-t.initialValue?-t.initialValue:a?0:t.initialValue,this.props.search.setFilter(t.name,a)},render:function(){var e=this.props,t=e.filter,a=e.filterValue,r=this.firstValue===a,n=e.noClick?void 0:this.props.search.getFilterTooltip(t),s=i.default.classNames("searchButton",{"c-border-super-light":e.hasBorder},{"c-foreground-very-faded":!a},{selected:!!a},t.icon,t.isOption&&(1===a?"yes":-1===a?"only":""),!t.isOption&&((a?this.firstValue>0&&r||this.firstValue<0&&!r:this.firstValue>0)?"yes":"no"));return o.a.createElement("div",{className:s,"data-tooltip":n,onClick:e.noClick?void 0:this.onClickIcon})}}));t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=(a(20),a(59),a(175)),c=a(6),u=l.a.createClass({displayName:"ReactInfiniteList",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.props.pane.onInfiniteListLoaded(),this.props.owner.notifyInit(this)},componentDidMount:function(){this.props.hiddenInput&&(this.props.pane.hiddenInput=this.refs.hiddenInput.getElement())},onUnmount:function(){this.props.owner.notifyUnmounted()},getState:function(){var e=this.props.pane,t=this.props.owner;return{cells:t.cellsObs,paddingBottom:t.paddingBottom,contentSize:t.contentSize,bottomListMessage:e.bottomListMessage(),isLoadingNewPage:e.isLoadingNewPage,isLoading:e.isLoading,statusMessage:e.getStatusMessage(this.props.overview),disablePointerEvents:t.disablePointerEvents,rect:this.props.pane.rect,items:t._itemsObs}},isIndexMounted:function(e){return e>=0&&!!this._getElementAtIndex(e)},_getElementAtIndex:function(e){for(var t,a=this.props,i=this.state,r=0;r<i.cells.length;r++){if(i.cells[r].index===e){t=r;break}}var n=this.getChildByKey("topBox"),s=t+(a.hiddenInput?1:0)+(n?1:0);return this.refs.contentElement.children[s]},getElementAtIndex:function(e){var t=this._getElementAtIndex(e);try{i.default.PAssert(2581,t,"Must have a valid mounted item at index",e)}catch(e){i.default.reportError(e)}return t},handleClick:function(){this.props.pane.isLoading.get()&&this.state.statusMessage&&this.props.pane.handleStatusClick()},renderItems:function(){for(var e=[],t=this.state.cells,a=0;a<t.length;a++)e.push(this.props.renderCell(a,t[a]));return e},render:function(){var e,t=this.state,a=this.props,s=a.pane,l=i.default.classNames(a.contentClass,{noClickItems:t.disablePointerEvents}),u=t.statusMessage,h=t.contentSize+t.paddingBottom;if(!a.isLoading)if(a.owner.hasItems()){if(t.bottomListMessage&&!a.overview){var f={};f[n.a.transform.react]="translateY("+t.contentSize+"px)",e=o.a.createElement("div",{className:"paneBottomMessage",style:f},o.a.createElement(c.a,{className:"paneDataPageLoad",height:40},t.bottomListMessage)),h+=40}}else l+=" noItems"+(u?" displayStatus":"");var p={};a.orientation===r.a.Orientation.Horizontal?(p.width=(h||200)+"px",p.height="100%"):(p.height=(h||200)+"px",p.width="100%");var m=null;a.hiddenInput&&(m=o.a.createElement(d.a,{ref:"hiddenInput",pane:s}));var g=this.getChildByKey("topBox");return o.a.createElement("ul",{className:l,style:p,onClick:this.handleClick,spellCheck:"false",draggable:"false",ref:"contentElement","data-pane-status":u},m,g,this.renderItems(),e)}});t.a=u},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=(a(80),a(177)),c=a(178),u=a(179),h=a(180),f=a(181),p=a(183),m=l.a.createClass({displayName:"ReactCell",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.DISABLE_LISTENER_ASSERT=!0,this.allowTransition=this.props.pane.supportCellTransition&&this.props.cell.isLive,this.createObservables({isHoveredLong:!1}),this.props.list.listen("reMount",this.reMount)},areStatesEqual:function(e,t,a){var i=this.props.cell.isLive&&this._getRenderer();if(i&&i.areStatesEqual)return i.areStatesEqual(e,t,a)},getState:function(e){var t,a=e.cell,r=a.paneObject,n=r;a.isLive&&(t=this._getRenderer(),n=this._getRenderObj());var s={isLive:a.isLive,item:n,id:r&&r.id,index:a.index,height:a.height,offset:a.offset,prevOffset:a.prevOffset,renderer:t,offsetX:a.offsetX,isAnimatingOffsetX:a.isAnimatingOffsetX,faded:!1};return a.isLive&&t&&t.getState&&(s=i.default.extend(s,t.getState(this,n,a.index,this.props))),s},componentDidMount:function(){this.listenTo(this.props.cell.cellChanged,!1),i.default.setReactCell(this,this.__id),this._onMount()},onBeforeChanged:function(e,t){this.allowTransition=this.props.pane.supportCellTransition&&e.isLive&&this.props.cell.wasLive,this.props.pane.isViewDates()&&e.isHovered!==t.isHovered&&(e.isHovered?setTimeout(function(){this.state.isHovered&&this.isHoveredLong.set(!0)}.bind(this),r.a.TooltipDelay):(this.isHoveredLong.set(!1,!1),e.isHoveredLong=!1))},componentDidUpdate:function(e,t){var a=this.state.item,i=t.item,r=this.state.renderer;r!==t.renderer&&t.renderer&&t.renderer.onUnmount&&t.renderer.onUnmount(this,i),a!==i&&(this.needsRefresh={prevState:t},this.props.list.isDelayingMounts||this.reMount()),r&&r.onUpdate&&r.onUpdate(this,a,this.props,this.state,e,t)},_onMount:function(){var e=this.state.item,t=this.state.renderer;e&&t&&t.onMount&&t.onMount(this,e,this.state.index,this.props,this.state)},onUnmount:function(){var e=this.state.item,t=this.state.renderer;e&&t&&t.onUnmount&&t.onUnmount(this,e,this.state.index,this.props,this.state),this.__id&&i.default.clearReactCell(this,this.__id)},reMount:function(){if(this.needsRefresh){var e=this.needsRefresh.prevState,t=e.item;this.refreshListeners(),t&&(this.clearData(),e.renderer&&e.renderer.onUnmount&&e.renderer.onUnmount(this,t)),this._onMount(),this.needsRefresh=void 0}},_getRenderer:function(){var e,t=this.props.cell.paneObject;return i.default.isVMLI(t)?e=d.a:"blockItem"===t.type?e=d.a:"blockHeader"===t.type?e=c.a:"hr"===t.type?e=u.a:"calendarWeek"===t.type?e=f.a:"calendarDay"===t.type?e=p.a:"blockAddItem"===t.type&&(e=h.a),e},_getRenderObj:function(){var e=this.props.cell.paneObject;return"blockItem"===e.type?e.item:e},_getCellState:function(){var e=this.state,t={cell:this.props.cell.getState(),reactCell:{item:e.item.id,index:e.index,height:e.height,offset:e.offset,prevOffset:e.prevOffset,isLive:e.isLive}};return this.refs.li&&(t.element=i.default.getElementPath(this.refs.li)),t},getIndex:function(){try{i.default.PAssert(2582,this.state.isLive,"Should never get the index of a dead cell",this.state.isLive?void 0:this._getCellState())}catch(e){i.default.reportError(e)}return this.state.index},getItem:function(){try{i.default.PAssert(2583,this.state.isLive,"Should never get the index of a dead cell",this.state.isLive?void 0:this._getCellState())}catch(e){i.default.reportError(e)}return this.state.item},getCell:function(){return this.props.cell},getPaneObject:function(){return this.props.cell.paneObject},renderSwipeMenu:function(e,t,a){var r=this.props.pane,n={left:(a>0?"-":"")+"100%"},s={},l=r.sizeOfItem(e,t),d=r.getSwipeMenuItem(e,a);if(d){s[a>0?"right":"left"]=16;var c=i.default.isFunction(d.icon)?d.icon(e):d.icon,u=i.default.isFunction(d.color)?d.color(e):d.color,h=i.default.isFunction(d.text)?d.text(e):d.text;n.background=u,l<44&&(n.height=44,n.marginTop=-(44-l)/2);var f={float:a<0?"right":"left",padding:a<0?"0 0 0 16px":"0 16px 0 0"};return o.a.createElement("div",{className:"itemSwipeMenu",style:n},c&&o.a.createElement("div",{className:"itemSwipeIcon",style:s},o.a.createElement("i",{className:c}),o.a.createElement("span",{style:f},h)))}},onClick:function(){},render:function(){var e=this.props,t=this.state,a=t.isLive?t.offset:-1e3,s=this.getUniqueID(),l=t.renderer,d=i.default.vmMain.getItemAnimationMode(),c={height:t.height},u=i.default.classNames("cell",{transition:this.allowTransition&&d!==r.a.ItemAnimationMode.None});if(t.offsetX?c[n.a.transform.react]="translate3d("+t.offsetX+"px,"+a+"px,0)":(t.isAnimatingOffsetX&&(c[n.a.transition.react]=n.a.transform.style+" 0.15s"),e.orientation===r.a.Orientation.Horizontal?c[n.a.transform.react]="translate("+a+"px,0)":c[n.a.transform.react]="translate(0,"+a+"px)"),l&&t.isLive){var h=!!t.offsetX;return l.render(this,s,t.item,t.index,e,t,c,u,h&&this.renderSwipeMenu(t.item,t.index,t.offsetX))}return o.a.createElement("li",{"data-moo-id":s,className:"itemdead",style:c})}});t.a=m},function(e,t,a){"use strict";var i=a(1),r=a(2),n=a.n(r),s=a(3),o=(a(20),s.a.createClass({displayName:"ReactCalendarTimes",componentDisplay:i.a.ComponentDisplay.Desktop,init:function(){this.scrollTop=void 0},getState:function(){var e=this.props.pane;return{numAllDay:e.numAllDay,heightAllDay:e.getHeightAllDay()}},componentDidMount:function(){this.props.trackPane&&setTimeout(function(){var e=this.props.pane.paneContent;e&&e.addEventListener("scroll",this.onPaneScroll)}.bind(this),0)},onUnmount:function(){var e=this.props.pane.paneContent;e&&e.removeEventListener("scroll",this.onPaneScroll)},onPaneScroll:function(e){var t=e.target.scrollTop;t!==this.scrollTop&&this.refs.scroller&&(this.scrollTop=this.refs.scroller.scrollTop=t)},render:function(){for(var e=this.props,t=this.state,a={height:e.height},i={height:t.heightAllDay+2},r={top:t.heightAllDay+30+2},s=[],o=0;o<24;o++){var l;12===o?l="Noon":(l=0===o?12:o%12,l+=" "+(o>=12?"pm":"am")),s.push(n.a.createElement("div",{key:o,className:"time"},l))}return n.a.createElement("div",{className:"calendarTimes belowHeader c-background",style:a},n.a.createElement("div",{className:"calendarTimesInner hideScrollbar c-border-heavy",style:r,ref:"scroller"},s),e.showAllDay&&n.a.createElement("div",{className:"calendarTimesAllDay c-border-heavy",style:i},"All day"))}}));t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(29),s=a(2),o=a.n(s),l=a(3).a.createClass({displayName:"ReactContact",componentDisplay:r.a.ComponentDisplay.Everywhere,onClickNumber:function(e){n.a.hide(),i.default.openUrl(this.props.contact.link,e,!0)},onClickEmail:function(e){var t=i.default.vmMain.getDefaultEmailPlugin(),a=this.props.contact;if(t.isActive()){n.a.hide();var r={to:[{text:"",email:a.address}]};i.default.menus.openComposeEmail(t,void 0,void 0,r)}else i.default.openUrl(a.link,e,!0)},render:function(){var e=this,t=this.props.contact;return o.a.createElement("div",{className:"contactPreview"},o.a.createElement("div",{className:"contactName c-border"},t.text),t.phoneNumbers&&t.phoneNumbers.map(function(t){return o.a.createElement("div",{className:"contactRow contactPhone",key:t.number},o.a.createElement("i",{className:"contactButton icon-phone c-foreground-super-faded"}),o.a.createElement("span",{className:"contactNumber link",onClick:e.onClickNumber},t.number),o.a.createElement("span",{className:"phoneType c-foreground-faded"},t.type))}),t.emails&&t.emails.map(function(t){return o.a.createElement("div",{className:"contactRow contactEmail",key:t.address},o.a.createElement("i",{className:"icon-mail_outline contactButton c-foreground-super-faded"}),o.a.createElement("span",{className:"contactEmail link",onClick:e.onClickEmail},t.address))}))}});t.a=l},function(e,t,a){"use strict";var i=a(1),r=a(0),n=a(2),s=a.n(n),o=a(3),l=(a(8),a(24)),d=a(10),c=a(54),u=o.a.createClass({displayName:"ReactNoteEditor",componentDisplay:i.a.ComponentDisplay.Everywhere,init:function(){var e=this.props,t=e.item.hasNote()&&e.item.getNote(),a=t?t.getParsedText():void 0;this.createObservables({hasValue:!!a})},onUnmount:function(){clearTimeout(this._noteUpdateTimeout),this._noteUpdateTimeout=void 0,this._saveNote()},getValue:function(){return this.refs.noteText.getValue()},_saveNote:function(){d.a.beginAction(),r.default.vmMain.beginUpdateItems();var e=this.props.item,t=e.hasNote()&&e.getNote(),a=this.refs.noteText.getValue();!t&&a&&(t=e.createNote()),t&&(t.setText(a,!0,ChangeType.Local),a||e.setNote(void 0,ChangeType.Local)),r.default.vmMain.commitUpdateItems(),d.a.endAction()},onChange:function(){var e=this.refs.noteText.getValue().length>0;e!==this.hasValue.get()&&(this.hasValue.set(e),e&&this.props.onValueSet&&requestAnimationFrame(this.props.onValueSet,0)),clearTimeout(this._noteUpdateTimeout),this._noteUpdateTimeout=setTimeout(this._saveNote,8e3)},render:function(){var e=this.props,t=l.a.fontSize(),a=e.item.hasNote()&&e.item.getNote(),i=a?a.getParsedText():void 0,r=a?void 0:"Add note",n=this.state.hasValue?e.heightValue:e.heightEmpty,o=!e.item.canHaveNote();return s.a.createElement(c.a,{ref:"noteText",className:e.className,value:i,placeholder:r,focused:e.focused,onChange:this.onChange,onKeyDown:e.onKeyDown,onKeyPress:e.onKeyPress,selectionStart:e.selectionStart,selectionEnd:e.selectionEnd,fontSize:t,margin:0,height:n,tabIndex:e.tabIndex,isReadOnly:o})}});t.a=u},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=a(0),n=a(1),s=a(2),o=a.n(s),l=a(3),d=a(29),c=a(45),u=a(6),h=a(12),f=a(16),p=a(30),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},g=n.a.TaskViewMode,v={};v.Outline="O",v[PaneMode.Gmail]="E",v[PaneMode.Drive]="D",v[PaneMode.Archived]="R",v[1]="G",v[2]="A",v[3]="C",i=[void 0,{Groups_Project:"P",Groups_Tag:"T",Groups_Contact:"C",Groups_Priority:"R"},{Agenda_Today:"T",Agenda_Week:"W",Agenda_All:"A"},{Calendar_Day:"D",Calendar_Week:"W",Calendar_Month:"M"}];var y=l.a.createClass({displayName:"ReactContextMenuPanes",componentDisplay:n.a.ComponentDisplay.Desktop,init:function(){this.numAtIndex=[],this.createObservables({selectedGroupIndex:0})},getState:function(){var e=this.props.pane;return{viewState:e&&e.viewState,viewMode:e&&e.getViewMode(),activePaneTypes:c.a.activePaneTypes,numInactivePanes:c.a.numInactivePanes,selectedGroup:this.selectedGroup?this.selectedGroup.get():-1}},componentDidMount:function(){this.selectedGroup=this.refs.menu.selectedIndex},onKeyPress:function(e,t){var a,r,n,s=this.selectedGroup.get(),o=s>=1&&s<=3?i[s]:v;for(var l in o)if(o.hasOwnProperty(l)&&KeyCode[o[l]]===e){a=l;break}if(a&&(isNaN(+a)?g[a]&&(n=a,r=g[a],a=PaneMode.Task):a=+a,!isNaN(a)||r||this.isPaneTypeOk(a))){if(t.preventDefault(),t.stopPropagation(),!t.shiftKey)return this.onSelected(a,r),isNaN(a);var d=document.getElementById("addPane_"+(n||a));if(d)return this.selectZoom(a,r,d),!0}var c=this.selectedGroupIndex.get();e===KeyCode.LeftArrow&&c>0?(c--,this.selectedGroupIndex.set(c)):e===KeyCode.RightArrow&&c<this.numAtIndex[this.selectedGroup.get()]-1&&(c++,this.selectedGroupIndex.set(c))},isPaneTypeOk:function(e){return!this.props.subset},onClickEnableMorePanes:function(){r.default.menus.openSettings(n.a.SettingsSections.Plugins)},selectZoom:function(e,t,a){e===PaneMode.Gmail?r.default.menus.openContextMenu({componentName:"ReactContextMenuSelectGmailAccount",element:a,showHeader:!0,onSelected:function(t){this.onSelected(e,null,t)}.bind(this)}):d.a.showPopup({mode:n.a.AutocompleteMode.Move,text:"Select item to zoom to",buttonText:"ZOOM",elementDisplay:a,onSelected:function(a){this.onSelected(e,t,a.item)}.bind(this)})},onSelectZoom:function(e,t,a){a.preventDefault(),a.stopPropagation(),this.selectZoom(e,t,a.target)},onSelected:function(e,t,a){if(isNaN(e)){var i=this.props;i.onSelected(e,t,a),r.default.menus.isContextMenuOpen(i.componentName)&&r.default.menus.closeContextMenu(i.componentName)}else this.selectedGroup.set(e),this.selectedGroupIndex.set(0)},onSelectedIndexChanged:function(e){var t=this.numAtIndex[e]-1;this.selectedGroupIndex.get()>t?this.selectedGroupIndex.set(t):this.updateState()},onClickGroup:function(e){r.default.preventDefault(e),r.default.stopPropagation(e)},onMouseEnterButton:function(e,t,a){this.selectedGroup.set(-1),this.selectedGroupIndex.set(t),this.selectedGroupNum=a},renderPaneType:function(e,t){var a=this.state,n=this.selectedGroup?this.selectedGroup.get():-1,s=isNaN(n)||n<1||n>3;if(e.enableMore)return o.a.createElement(f.a,{className:"hasBorder c-border",onClick:this.onClickEnableMorePanes},"Enable more panes");if(e.viewModes){var l=r.default.classNames("hasHorButtons",{"hasBorder c-border":e.border},{selectedHotkey:t===n}),d=[],c=e.viewModes.length;this.numAtIndex[t]=c;for(var h=0;h<c;h++){var m=e.viewModes[h],g=t===n&&a.selectedGroupIndex===h,y=r.default.classNames("c-popup-item",{selected:g});d.push(o.a.createElement(u.a,{key:m.text,className:y,padding:0,iconSize:16,color:"c-foreground",onMouseEnter:this.onMouseEnterButton.bind(this,t,h,c),onClick:this.onSelected.bind(this,m.type,m.viewMode,void 0)},t===n?o.a.createElement("div",{className:"viewHotkey bold"},i[t][m.viewMode]):o.a.createElement("div",{className:"viewIcon c-foreground-faded "+m.icon}),m.text))}return o.a.createElement(f.a,{className:l,key:e.text,customLayout:!0,onMouseEnter:this.onMouseEnterButton.bind(this,t,void 0,c),onClick:this.onClickGroup,clickCloses:!1,hoverEffects:!1},o.a.createElement(p.a,{hotkeyCentered:!0,hotkey:s&&v[t]},e.text),o.a.createElement("div",{className:"horButtons flexbox"},d))}var S=e.viewMode;return o.a.createElement(f.a,{key:e.text,className:e.border?"hasBorder c-border":"",icon:e.icon,height:32,hotkey:s&&(v[S]||v[e.type]),hotkeyCentered:!0,onClick:this.onSelected.bind(this,e.type,e.viewMode,null),active:this.props.subset&&S&&this.state.viewMode===S,onMouseEnter:this.onMouseEnterButton.bind(this,void 0,void 0),id:"addPane_"+(S||e.type)},e.text)},render:function(){var e=this.props,t=c.a.getAvailablePanes(!!e.subset);return o.a.createElement(h.a,m({},e,{id:"contextMenuPanes",ref:"menu",key:"contextMenuAdd",supportArrows:!0,onKeyPress:this.onKeyPress,onSelectedIndexChanged:this.onSelectedIndexChanged}),e.children,t.map(this.renderPaneType))}});t.default=y},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=(a(31),a(18)),c=a(28),u=a(220),h=a(6),f=l.a.createClass({displayName:"ReactMessageAttachments",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.props.threadAttach.subscribe(this)},onUnmount:function(){this.props.threadAttach.unsubscribe(this)},onAttachmentUpdate:function(){this.updateState()},onAttachmentIDChange:function(){},getState:function(){return{attachments:this.props.threadAttach.getPlugin().getMessageDisplayAttachments(this.props.message)}},isAttachImage:function(e){var t=e.mimeType;return"image/png"===t||"image/jpg"===t||"image/jpeg"===t||"image/gif"===t},onClickAttach:function(e,t){if(e.error)e.uploader&&!e.uploader.isDone()&&e.uploader.resume();else if(!e.uploader||e.uploader.isDone()){var a=this._getURL(e);this.props.editable?i.default.openUrl(a):e.attID?n.a.mac&&t.metaKey||!n.a.mac&&t.ctrlKey||!this.isAttachImage(e)?i.default.downloadFile(a,e.cid):i.default.menus.openLightbox(a,"Download",function(){i.default.downloadFile(a,e.cid)}):i.default.openUrl(a)}t.stopPropagation()},onClickDelete:function(e,t){var a=this.props.threadAttach.getPlugin().removeAttachFiles(this.props.threadAttach,this.props.message,e);this.props.onUpdate&&this.props.onUpdate(a),t.stopPropagation()},onAttachDragStart:function(e){var t=e.target.getAttribute("data-downloadurl");e.stopPropagation(),e.dataTransfer.setData("DownloadURL",t),d.a.setExternalData(t)},_getURL:function(e){return this.props.editable||!e.attID?c.a.getPreviewURL(e):c.a.getAttachmentURL(this.props.threadAttach.getField("accountID"),this.props.message.id,e.attID)},_renderAttachment:function(e){var t=e.mimeType+":"+e.cid+":"+this._getURL(e),a=e.uploader?i.default.clamp(e.uploader.getPercent(),.05,1):1,r=this.isAttachImage(e)?"Click to open image.\n"+n.a.priModKey+" click to download image.":"Click to download image";return o.a.createElement("div",{key:e.id,className:"messageAttachment flexbox c-button-raised",draggable:!0,"data-downloadurl":t,onClick:this.onClickAttach.bind(this,e),onDragStart:this.onAttachDragStart,"data-tooltip":r},o.a.createElement("div",{className:"attachmentIcon icon-drive-file"}),o.a.createElement("div",{className:"attachmentText"},e.cid),o.a.createElement("div",{className:"f1"}),a<1&&o.a.createElement(u.a,{percent:a,height:22,error:e.error,errorMsg:"Click to retry"}),1===a&&e.error&&o.a.createElement("div",null,"ERROR"),o.a.createElement("div",{className:"attachmentSize"},i.default.toFileSize(e.size)),this.props.editable&&o.a.createElement(h.a,{className:"attachmentClose",icon:"icon-close",onClick:this.onClickDelete.bind(this,e),tooltip:"Remove"}))},render:function(){var e=null,t=this.state.attachments;if(t.length>0){for(var a=[],i=0;i<t.length;++i){var r=t[i];a.push(this._renderAttachment(r))}e=o.a.createElement("div",{className:"messageAttachments c-border"},a)}return e}});t.a=f},,,function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(101),r=(a.n(i),a(7)),n=a(0),s=a(5),o=(a(73),a(107)),l=(a(17),a(15)),d=a(4),c=(a(44),a(117)),u=a(74),h=a(161),f=a(83),p=a(162),m=a(163),g=a(164),v=(a(78),a(13),a(49),a(167)),y=a(11),S=(a(36),a(61),a(35),a(2)),E=a.n(S),P=a(34),b=a.n(P),C=a(168);n.default.checkpoint(Checkpoint.RequireLoaded),Object(o.a)(),window.__ERRORINMAINHEADER&&n.default.reportError(window.__ERRORINMAINHEADER),n.default.nativeBridge=new g.a,n.default.billingManager=new v.a,n.default.runOnLoad(function(){try{0;try{n.default.PAssert(0,-1===navigator.userAgent.indexOf("Electron")||d.a.appPlatform===AppPlatform.Electron,"Electron app missing app platform set")}catch(e){n.default.reportError(e)}n.default.checkpoint(Checkpoint.PageLoad);try{n.default.PAssert(1,"loading"!==document.readyState,"Should only be calling mainjs after document is loaded"+document.readyState)}catch(e){n.default.reportError(e)}if("loading"===document.readyState){var e="ERROR: MainJS running before document load! "+document.readyState;ShouldLog(LogLevels.Error)&&log(e),n.default.reportError(new Error(e))}for(var t in window.scriptErrors)window.scriptErrors.hasOwnProperty(t)&&n.default.fireCustomEvent("scriptLoadError",{src:t,id:window.scriptErrors[t],firstChance:!0});if(window.scriptErrors=window.scriptErrors||{},window.handleLoadError=function(e){try{window.scriptErrors[e.target.src]=e.target.id,n.default.fireCustomEvent("scriptLoadError",{src:e.target.src,id:e.target.id,firstChance:!1})}catch(e){n.default.reportError(e)}},window.oncontextmenu=function(e){n.default.isKeyboardInputElement(e.target)||e.preventDefault()},n.default.isDemoMode()||d.a.offline);else I=window,A=document,M="script",_="ga",I.GoogleAnalyticsObject=_,I.ga=I.ga||function(){(I.ga.q=I.ga.q||[]).push(arguments)},I.ga.l=1*new Date,T=A.createElement(M),w=A.getElementsByTagName(M)[0],T.async=1,T.src="//www.google-analytics.com/analytics.js",w.parentNode.insertBefore(T,w),ga("create","UA-37740918-2",{cookieDomain:"auto"}),ga("send","pageview");d.a.updateBodyClass();var a=function(e){document.documentElement.addEventListener(e,function(e){n.default.reportEvent(e)},!0)};if(a("keydown"),a("keyup"),a("keypress"),a("MSPointerDown"),a("MSPointerUp"),a("MSPointerHover"),a("MSPointerCancel"),a("mousedown"),a("mouseup"),a("touchstart"),a("touchend"),n.default.tooltip=new p.a,n.default.AppCache=new m.a,n.default.localDocChangeRequested=!1,!n.default.isDemoMode()){var i=!1;n.default.settings.registerForChangeNotification(Settings.gdocId,void 0,function(e,t){!n.default.localDocChangeRequested&&e&&e!==t&&(i||(i=!0,n.default.menus.alert({text:"The document was changed in another tab. Please close this tab or reload.",actionText:"RELOAD",callback:n.default.reload})))})}n.default.menus=new f.a,n.default.vmSetup=new u.a,y.a.listen("remoteDataLoaded",function(){var e=s.a.getURLParam("file"),t=s.a.getURLParam("state");if(e||t){if(!e)try{var a=JSON.parse(t);"open"===a.action&&a.ids&&a.ids.length>=0&&(e=a.ids[0])}catch(e){n.default.reportError(e)}var i=l.a.getDocId();if(e&&i!==e){var r,o,d=n.default.decodeURLObject(s.a.getURLParam("sinfo")),c=!1;if(d){var u=n.default.getUserIdentifier();d.fromUser&&(r=d.fromUser,d.fromUser===u&&(c=!0)),d.toUser&&(o=d.toUser,d.toUser===u&&(c=!0))}else c=!0;function h(){try{n.default.PAssert(3,n.default.vmMain&&n.default.vmMain.vmPicker,"VMMain must be initialized before loading another doc")}catch(e){n.default.reportError(e)}n.default.vmMain.vmPicker.requestOpenDocument(e)}c?n.default.menus.alert({text:"You have requested to view another document.",actionText:"OPEN IT",callback:h}):o?n.default.menus.alert({text:"You have requested to view another document meant for "+o+".",actionText:"OPEN IT",callback:h}):r&&n.default.menus.alert({text:"You have requested to view another document shared by "+r+".",actionText:"OPEN IT",callback:h})}}});var o=function(e){var t=d.a.getActualWindowWidth(),a=d.a.getActualWindowHeight();try{n.default.PAssert(4,0!==t&&!isNaN(t)&&0!==a&&!isNaN(a),"Window size is 0",t,a)}catch(e){n.default.reportError(e)}var i=d.a.windowWidth(!0),r=d.a.windowHeight(!0);if(d.a.ipad&&!d.a.app&&!0!==e&&!1!==e&&setTimeout(o,0,!0),(t!==i||a!==r)&&(d.a.setWindowSize(t,a),d.a.onResize.notify(),n.default.documentHeight=a,n.default.isMainPageOpen)){var s=a-r,l=(d.a.android||d.a.mobileie)&&a>r&&(!d.a.app||s<=d.a.getKBSize())&&n.default.vmMain&&n.default.vmMain.isLoaded;l&&n.default.blurActiveElement(),n.default.autocomplete&&l&&n.default.autocomplete.hide(),n.default.fireCustomEvent("windowResize"),y.a.fireEvent("windowResize",[])}};function g(){d.a.updateOrientation()}o(!1),g(),ShouldLog(LogLevels.Timing)&&log("Running main.js: ",log.now()),window.onblur=function(){n.default.hasFocus=!1},window.onfocus=function(){n.default.hasFocus=!0,l.a.onFocusHandler()};new c.a;n.default.timeline=new h.a,window.addEventListener("resize",o),window.addEventListener("orientationchange",g),window.addEventListener("dragstart",function(e){return e.preventDefault(),!1}),window.addEventListener("dragover",function(e){return e.preventDefault(),!1});var v=!1,S=!1;function P(){try{if(S||!v||!r.a.localDataLoaded())return;S=!0,n.default.checkpoint(Checkpoint.OnInitializedData),l.a.loadClientDefaultFile(),n.default.isDemoMode()||(n.default.vmMain.setupDateRollover(),window.addEventListener("focus",n.default.vmMain.ensureDateRollover)),n.default.vmMain.loadData(),ShouldLog(LogLevels.Timing)&&log("Data done loading: ",log.now())}catch(e){n.default.reportError(e)}}function D(){v||(v=!0,n.default.checkpoint(Checkpoint.InitializeMain),n.default.openMainPage(),n.default.registerEvent("ItemCreated","ItemAction","Create"),n.default.registerEvent("ItemCompleted","ItemAction","Complete"),r.a.initData(P),P())}n.default.vmSetup.loginState.listen(function(e){e===LoginState.LOGGED_IN?(D(),n.default.openMainPage()):e===LoginState.LOGGED_OUT&&(n.default.isSetupPageOpen||(n.default.isSetupPageOpen=!0,s.a.hasURLParam("login","true")||n.default.openSetupPage(),n.default.vmSetup.openLogin())),d.a.offline||!navigator.onLine?n.default.vmMain.setGDriveStatus(DriveStatus.Offline):n.default.vmMain.setGDriveStatus(DriveStatus.Connecting)}),n.default.vmSetup.init(),n.default.isDemoMode()&&D(),n.default.getLoginState()!==LoginState.LOGGED_OUT?r.a.initData(D):!n.default.isDemoMode()&&d.a.app&&n.default.nativeBridge.sendToApp("loaded"),b.a.render(E.a.createElement(C.a,{main:n.default.vmMain}),document.getElementById("outerWrapper"))}catch(e){console.log(e),n.default.handleCriticalError(),n.default.reportError(e,"Critical Error")}var I,A,M,_,T,w})},function(e,t,a){navigator.userAgent;"http:"===window.location.protocol&&(window.location.hash.indexOf("state=")<0||window.location.hash.indexOf("app")<0&&window.location.hash.indexOf("appv")<0)&&(window.location=window.location.href.replace(/^http:/,"https:")),Date.Config={DEBUG:!0,DisableCache:!0},Error.stackTraceLimit=1/0;try{window.__checkpoints|=1,window.__SESSION_ID=Math.round(1e4*Math.random())+"|"+Date.now(),window.__SESSION_BEGIN=Date.now();var i=function(){};window.appEvents=window.appEvents||{kbsize:i,enterBackground:i,enterForeground:i,statusBarTap:i,closeKeyboard:i,undo:i,redo:i,notifyOAuth:i,features:i,reportLowMemory:i,pokeBackground:i},window.console||(window.console={log:function(){},error:function(){}});window.log=window.console.log.bind(window.console),window.__log=window.console.log.bind(window.console),window.__warn=window.console.warn.bind(window.console),window.__error=window.console.error.bind(window.console),window.performance&&window.performance.now?(window.log.start=window.performance.now(),window.log.now=function(){return window.performance.now()-window.log.start}):(window.log.start=Date.now(),window.performance={now:function(){return Date.now()-window.log.start}},window.log.now=window.performance.now),window.console.timeStamp||(Object.defineProperty?Object.defineProperty(window.console,"timeStamp",{value:function(){}}):window.console.timeStamp=function(){}),window.console.time||(Object.defineProperty?Object.defineProperty(console,"time",{value:function(){}}):window.console.time=function(){}),window.console.timeEnd||(Object.defineProperty?Object.defineProperty(window.console,"timeEnd",{value:function(){}}):window.console.timeEnd=function(){}),window.console.trace||(Object.defineProperty?Object.defineProperty(window.console,"trace",{value:function(){}}):window.console.trace=function(){}),window.LogLevels={Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,ScrMgr:262144,NativeAuth:524288,DateRoll:1048576,DebugDOM:2097152,RepeatDate:4194304,Connection:8388608,Plugin:16777216,Folders:33554432,Verbose:67108864,Account:134217728,React:268435456,Autocomplete:536870912,Compose:1073741824},window.LogLevel=LogLevels.Error|LogLevels.Warning,window.ShouldLog=function(e){return window.DEBUG===e},window.inspectLocal=function(e){if(e){var t=e;return"string"==typeof e&&(t=window.getModel(e)),log("---- Inspecting Item:",t.id,"----"),log("  RawText:",t.getRawText()),log("  ParsedText:",t.getParsedText()),log("  Els:",t.els),log('  Parent: "'+t.parent().id+'"'),log("  Date:",t.date()),log("  AllDayDate:",t.allDayDate()),log("--------------------------------------------"),t}log("Must specify either an item ID or item object to inspect")}}catch(e){console.log("Error in main header",e),window.__ERRORINMAINHEADER=e}},function(e,t,a){"use strict";function i(e){this.str=(e||"").toString(),this.operatorCurrent="",this.operatorExpecting="",this.node=null,this.escaped=!1,this.list=[],this.operators={'"':'"',"(":")","<":">",",":"",":":";",";":""}}function r(){}i.prototype={tokenize:function(){for(var e,t=[],a=0,i=this.str.length;a<i;a++)e=this.str.charAt(a),this.checkChar(e);return this.list.forEach(function(e){e.value=(e.value||"").toString().trim(),e.value&&t.push(e)}),t},checkChar:function(e){if((e in this.operators||"\\"===e)&&this.escaped)this.escaped=!1;else{if(this.operatorExpecting&&e===this.operatorExpecting)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting="",void(this.escaped=!1);if(!this.operatorExpecting&&e in this.operators)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting=this.operators[e],void(this.escaped=!1)}this.escaped||"\\"!==e?(this.node||(this.node={type:"text",value:""},this.list.push(this.node)),this.escaped&&"\\"!==e&&(this.node.value+="\\"),this.node.value+=e,this.escaped=!1):this.escaped=!0}},r.prototype={parse:function(e){var t=[],a=[],r=[];new i(e).tokenize().forEach(function(e){"operator"!==e.type||","!==e.value&&";"!==e.value?a.push(e):(a.length&&t.push(a),a=[])}),a.length&&t.push(a),t.forEach(function(e){(e=function(e){var t,a,i,r,n=!1,s="text",o=[],l={address:[],comment:[],group:[],text:[]};for(i=0,r=e.length;i<r;i++)if("operator"===(t=e[i]).type)switch(t.value){case"<":s="address";break;case"(":s="comment";break;case":":s="group",n=!0;break;default:s="text"}else t.value&&("address"===s&&(t.value=t.value.replace(/^[^<]*<\s*/,"")),l[s].push(t.value));if(!l.text.length&&l.comment.length&&(l.text=l.comment,l.comment=[]),n)l.text=l.text.join(" "),o.push({name:l.text||a&&a.name,group:l.group.length?self.parse(l.group.join(",")):[]});else{if(!l.address.length&&l.text.length){for(i=l.text.length-1;i>=0;i--)if(l.text[i].match(/^[^@\s]+@[^@\s]+$/)){l.address=l.text.splice(i,1);break}var d=function(e){return l.address.length?e:(l.address=[e.trim()]," ")};if(!l.address.length)for(i=l.text.length-1;i>=0&&(l.text[i]=l.text[i].replace(/\s*\b[^@\s]+@[^\s]+\b\s*/,d).trim(),!l.address.length);i--);}if(!l.text.length&&l.comment.length&&(l.text=l.comment,l.comment=[]),l.address.length>1&&(l.text=l.text.concat(l.address.splice(1))),l.text=l.text.join(" "),l.address=l.address.join(" "),!l.address&&n)return[];(a={address:l.address||l.text||"",name:l.text||l.address||""}).address===a.name&&((a.address||"").match(/@/)?a.name="":a.address=""),o.push(a)}return o}(e)).length&&(r=r.concat(e))});for(var n=[],s=0;s<r.length;++s)n.push({type:"contact",text:r[s].name||r[s].address,email:r[s].address});return n}},t.a=new r},function(e,t,a){"use strict";var i=a(0),r=a(11),n=a(39);function s(){this.cache={},this.loadedGapiData={},this._isRemoteHooked=!1,this.resetListener=void 0}s.prototype={setGapiData:function(e,t){try{i.default.PAssert(955,i.default.isObject(t)&&!i.default.isArray(t),"Setting malformed data",e)}catch(e){i.default.reportError(e)}for(var a in this.loadedGapiData[e]=[],t)t[a].id=a,this.loadedGapiData[e].push(t[a])},setGapiDataDirect:function(e,t){try{i.default.PAssert(956,i.default.isArray(t),"Setting malformed data",e)}catch(e){i.default.reportError(e)}this.loadedGapiData[e]||(this.loadedGapiData[e]=t)},clearGapiData:function(){this.loadedGapiData={}},loadRemoteData:function(e,t){try{i.default.PAssert(957,e&&t,"Must supply valid remote load info as well as a cb when data is loaded")}catch(e){i.default.reportError(e)}var a=e.split(".");this.cache[a[0]]?t(JSON.parse(JSON.stringify(this.cache[a[0]][a[1]]))):i.default.XHR({type:"GET",url:window.location.protocol+"//"+window.location.host+"/data/"+a[0]+".json",cb:function(e){if(200===e.status)try{var i=JSON.parse(e.responseText);this.cache[a[0]]=i,a[1]||(a[1]="0");var r=i[a[1]];if(r){var n=JSON.parse(JSON.stringify(r));t(n)}else log("Invalid data slot")}catch(e){log("Error parsing demo data: "+e.message)}else log("Error getting demo data",e.status,e.responseText)}.bind(this)})},stubGapi:function(){try{i.default.PAssert(958,!window.gapi,"Should not have loaded gapi when stubbing")}catch(e){i.default.reportError(e)}var e=function(){},t=function(){return{then:e,execute:e}},a=[];r.a.listen("resetEverything",function(){for(var e=0;e<a.length;++e)clearTimeout(a[e]);a=[]});var s=function(e,t){var i=setTimeout(function(){a.remove(i),e({success:!0})},0);a.push(i)};window.gapi={auth:{getToken:function(){return{expires_in:3600,expires_at:Math.floor((Date.now()+i.default.minutes(60))/1e3),access_token:"InvalidToken",id_token:"InvalidIDToken",scope:[GScope.UserInfoEmail,GScope.Calendar,GScope.GmailCompose,GScope.GmailModify]}}},client:{request:function(e){return{then:function(t,a,i){return n.a.getAPIForRequest(e)(e.__rawParams).then(t,a,i)},execute:function(){}}},load:e,setApiKey:e,newBatch:function(){return{add:e,then:s}},drive:{files:{get:t,list:t,trash:t,insert:t,patch:t},permissions:{list:t,insert:t,delete:t},properties:{insert:t},parents:{insert:t},changes:{list:t}},gmail:{users:{threads:{list:t,get:t,modify:t,trash:t,untrash:t},labels:{list:t,create:t},history:{list:t},messages:{get:t,send:t,trash:t,untrash:t},drafts:{create:t,update:t,send:t,delete:t,list:t},settings:{sendAs:{list:t}}}},calendar:{settings:{list:t},events:{get:t,list:t,patch:t,insert:t,delete:t},calendars:{insert:t},calendarList:{list:t}}}}},areRemoteFunctionsHooked:function(){return this._isRemoteHooked},hookRemoteFunctions:function(){try{i.default.PAssert(959,!this._isRemoteHooked,"Should not hook remote functions more than once")}catch(e){i.default.reportError(e)}function e(e,t){try{i.default.PAssert(960,e,"Must load local or remote data to perform queries")}catch(e){i.default.reportError(e)}for(var a=0;a<e.length;++a)if(e[a].id===t)return e[a]}function t(e,t,a){try{i.default.PAssert(962,e,"Must load local or remote data to perform queries")}catch(e){i.default.reportError(e)}var r=[];if(i.default.isArray(a));else if(e)for(var n=0;n<e.length;++n)e[n][t]===a&&r.push(e[n]);return r}function a(e,t,a){try{i.default.PAssert(963,e,"Must load local or remote data to perform queries")}catch(e){i.default.reportError(e)}for(var r=[],n=0;n<e.length;++n)e[n][t].indexOf(a)>=0&&r.push(e[n]);return r}this.stubGapi(),this._isRemoteHooked=!0;var n=0,s=[],o=this;function l(e){return{then:function(e){return function(t,a,r){var o;try{o=e(r)}catch(e){i.default.reportError(e)}var l=setTimeout(function(){s.remove(l),o?t.call(r,{result:o}):a.call(r,{error:!0})},n);s.push(l)}}(e),execute:function(e){return function(t,a,i){var r=e(i),o=setTimeout(function(){s.remove(o),r?t(r):a({error:!0})},n);s.push(o)}}(e)}}r.a.listen("resetEverything",function(){for(var e=0;e<s.length;++e)clearTimeout(s[e]);s=[]}),gapi.client.drive.files.get=function(t){return l(function(a){return e(o.loadedGapiData.Drive,t.fileId)})},gapi.client.drive.files.list=function(e){return l(function(t){if("mimeType='application/vnd.google-apps.drive-sdk.597847337936' and trashed=false"===e.q)return{items:o.loadedGapiData.documents};var r=/\'(.*)\' in parents/g.exec(e.q),n=/title contains \'([^\']*)\'/g.exec(e.q),s=/mimeType contains \'([^\']*)\'/g.exec(e.q),l=o.loadedGapiData.Drive;return r&&(l=function(e,t){try{i.default.PAssert(961,e,"Must load local or remote data to perform queries")}catch(e){i.default.reportError(e)}for(var a=[],r=0;r<e.length;++r)(e[r].parents[0].id===t||"root"===t&&e[r].parents[0].isRoot)&&a.push(e[r]);return a}(l,r[1])),n&&(l=a(l,"title",n[1])),s&&(l=a(l,"mimeType",s[1])),{items:l}})},gapi.client.drive.files.trash=function(e){return l(emptyImpl)},gapi.client.drive.files.insert=function(e){return l(emptyImpl)},gapi.client.drive.files.patch=function(e){return l(emptyImpl)},gapi.client.drive.permissions.list=function(e){return l(function(e){return{items:o.loadedGapiData.permissions}})},gapi.client.drive.permissions.insert=function(e){return l(emptyImpl)},gapi.client.drive.permissions.delete=function(e){return l(emptyImpl)},gapi.client.drive.properties.insert=function(e){return l(emptyImpl)},gapi.client.gmail.users.threads.list=function(e){return l(function(a){return{threads:t(o.loadedGapiData.Gmail,"hideInPane",void 0).filter(function(t){return"me"===e.userId||t.accountID===e.userId})}})},gapi.client.gmail.users.threads.modify=function(t){return l(function(a){var i=e(o.loadedGapiData.Gmail,t.id)[0];if(!i)return{};if(i.labelIds||(i.labelIds=[]),t.removeLabelIds)for(var r=0;r<t.removeLabelIds.length;++r)i.labelIds.remove(t.removeLabelIds[r]);t.addLabelIds&&i.labelids.pushOnlyUniques(t.addLabelIds)})},gapi.client.gmail.users.threads.get=function(t){return l(function(a){return e(o.loadedGapiData.Gmail,t.id)})},gapi.client.gmail.users.messages.get=function(e){return l(function(t){return function(e,t){try{i.default.PAssert(964,e,"Must load local or remote data to perform queries")}catch(e){i.default.reportError(e)}for(var a=0;a<e.length;++a){var r=t(e[a]);if(r)return r}}(o.loadedGapiData.Gmail,function(t){for(var a=0;a<t.messages.length;++a)if(t.messages[a].id===e.id)return t.messages[a]})})},gapi.client.gmail.users.messages.send=function(e){return l(function(t){return{id:i.default.generateTempId(),threadId:e.resource.threadId||i.default.generateTempId().substr(3),labelIds:["SENT","UNREAD"]}})},gapi.client.gmail.users.labels.list=function(e){return l(function(e){return{labels:o.loadedGapiData.Gmail_Labels}})},gapi.client.gmail.users.labels.create=function(e){return l(function(a){var r=t(o.loadedGapiData.Gmail_Labels,"name",e.resource.name)[0];if(r)return r;var n=i.default.generateTempId().substr(3);return r={name:e.resource.name,id:n},o.loadedGapiData.Gmail_Labels||(o.loadedGapiData.Gmail_Labels=[]),o.loadedGapiData.Gmail_Labels.push(r),r})},gapi.client.gmail.users.settings.sendAs.list=function(e){return l(function(e){return{sendAs:[{displayName:"Demo User",isDefault:!0,isPrimary:!0,replyToAddress:"",sendAsEmail:"demo@moo.do",signature:""}]}})},gapi.client.calendar.calendarList.list=function(e){return l(function(e){return{items:o.loadedGapiData.calendarList}})},gapi.client.calendar.events.get=function(t){return l(function(a){return e(o.loadedGapiData.GCalendar,t.eventId)})}}},t.a=new s},function(e,t,a){"use strict";var i=a(0),r=a(1),n=function(e,t){this._batchConstructor=e,this._batchParams=t,this._batchedRequests={},this._successCB=i.default.emptyFn,this._failureCB=i.default.emptyFn,this._context=void 0,this._hasRun=!1,this._batchID=i.default.generateTempId()};n.prototype={add:function(e,t,a){try{i.default.PAssert(1432,e,"Must provide a valid request to add to batch")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1433,t,"Must supply a valid group ID when adding to a batch")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1434,!this._hasRun,"Should never add new requests to a batch that has already run")}catch(e){i.default.reportError(e)}var r=this._ensureGroup(t);return this._addRequestToGroup(t,a,e),r},then:function(e,t,a){this._successCB=e||i.default.emptyFn,this._failureCB=t||i.default.emptyFn,this._context=a,this._run()},execute:function(e){this._successCB=e,this._failureCB=e,this._run()},getBatchID:function(){return this._batchID},_ensureGroup:function(e){var t=!1;return this._batchedRequests[e]||(this._batchedRequests[e]={size:0,batch:this._createBatchInternal()},t=!0),t},_addRequestToGroup:function(e,t,a){var n=this._getGroupBatch(e),s=this._getGroupSize(e);try{i.default.PAssert(1435,s<=r.a.MaxBatchSize,"Too many requests for a single batch")}catch(e){i.default.reportError(e)}t?n.add(a,{id:t}):n.add(a)},_getGroupBatch:function(e){try{i.default.PAssert(1436,this._batchedRequests[e],"Must ensure before querying")}catch(e){i.default.reportError(e)}return this._batchedRequests[e].batch},_getGroupSize:function(e){try{i.default.PAssert(1437,this._batchedRequests[e],"Must ensure before querying")}catch(e){i.default.reportError(e)}return this._batchedRequests[e].size},_getBatchURL:function(){return this._baseURL},_run:function(){try{i.default.PAssert(1438,!this._hasRun,"Should never run a batch twice")}catch(e){i.default.reportError(e)}for(var e in this._hasRun=!0,this._batchedRequests){this._getGroupBatch(e).then(this._handleSuccess.bind(this),this._handleFailure.bind(this))}},_createBatchInternal:function(){return new this._batchConstructor(this._batchParams)},_handleSuccess:function(e){try{i.default.PAssert(1439,this._hasRun,"Must run batch before success")}catch(e){i.default.reportError(e)}this._successCB.call(this._context,e)},_handleFailure:function(e){try{i.default.PAssert(1440,this._hasRun,"Must run batch before failure")}catch(e){i.default.reportError(e)}this._failureCB.call(this._context,e)}},t.a=n},function(e,t,a){"use strict";var i=a(0),r=a(106),n=(a(9),a(19));function s(){this._contactCache={},this._contacts=new n.a,this._contactsByName={},this._contactNames={___info___:{count:0}},this.init()}s.prototype={init:function(){},loadContacts:function(e,t){try{i.default.PAssert(945,0===this._contacts.get().length,"Should only load contacts once")}catch(e){i.default.reportError(e)}var a=!1;if(e){for(var r=[],n=0;n<e.length;++n){var s=e[n];if(s.name&&(s.text=s.name,e[n].text=s.name,delete e[n].name,a=!0),!t&&s.isDemo||s.text&&!s.phoneNumbers&&!s.emails)a=!0;else{if(s.text){var o=i.default.escape(s.text);this._contactNames[o]="",this._contactsByName[s.text]=s,r.push(s)}try{i.default.PAssert(946,s.id,"Each contact must have a valid id")}catch(e){i.default.reportError(e)}}}r.sort(this.contactComparator),this._contactNames.___info___.count=r.length,this._contacts.set(r)}else this.clearContacts();return a},addContact:function(e){try{i.default.PAssert(947,e.id,"Incoming contacts must have a valid id")}catch(e){i.default.reportError(e)}try{i.default.PAssert(948,e.text,"All contacts are expected to have a text")}catch(e){i.default.reportError(e)}var t=this._contactsByName[e.text];if(e.emails){for(var a=[],n=0;n<e.emails.length;n++){for(var s=e.emails[n],o=!1,l=0;l<a.length;l++)if(a[l].address.toLowerCase()===s.address.toLowerCase()){o=!0;break}o||a.push(s)}e.emails=a}if(t)e.emails&&(t.emails||(t.emails=[]),t.emails.pushOnlyUniques(e.emails,this.emailComparator)),e.phoneNumbers&&(t.phoneNumbers||(t.phoneNumbers=[]),t.phoneNumbers.pushOnlyUniques(e.phoneNumbers,this.phoneComparator));else{if(this._contacts.insertSorted(e,this.contactComparator),e.text){var d=i.default.escape(e.text);this._contactNames[d]="",this._contactsByName[e.text]=e}this._contactNames.___info___.count=this._contacts.get().length}this._contactCache[e.id]&&(this._contactCache[e.id]=new r.a(e))},updateContact:function(e){try{i.default.PAssert(949,e.id,"Incoming contacts must have a valid id")}catch(e){i.default.reportError(e)}try{i.default.PAssert(950,e.text,"All contacts are expected to have a text")}catch(e){i.default.reportError(e)}for(var t=!1,a=0;a<this._contacts.get().length;++a){var r=this._contacts.get()[a];if(r.id===e.id){r.text=e.text,r.emails=r.phoneNumbers=void 0,this.addContact(e),t=!0;break}}if(!t)return this.addContact(e),!0},clearContacts:function(){this._contactCache={},this._contacts.clear(),this._contactsByName={},this._contactNames={___info___:{count:0}}},numContacts:function(){var e=this._contacts.get().length;try{i.default.PAssert(951,e===this._contactNames.___info___.count,"Contact names count should match contacts value")}catch(e){i.default.reportError(e)}return e},getContacts:function(){return this._contactNames},getAll:function(){return this._contacts.get()},contactComparator:function(e,t){return e.text&&t.text?e.text.localeCompare(t.text):e.text&&!t.text?1:!e.text&&t.text?-1:void 0},emailComparator:function(e,t){return e.address.toLowerCase()===t.address.toLowerCase()},emailComparatorSort:function(e,t){return e.address&&t.address?e.address.toLowerCase().localeCompare(t.address.toLowerCase()):e.address&&!t.address?1:!e.address&&t.address?-1:void 0},phoneComparator:function(e,t){return e===t||e.number===t.number},ensureCacheObject:function(e){try{i.default.PAssert(952,e,"Must have valid data to store in cache")}catch(e){i.default.reportError(e)}if(this._contactCache[e.id])return this._contactCache[e.id];var t=new r.a(e);return this._contactCache[e.id]=t,t},findMatchExact:function(e){var t=this._contactsByName[e];if(t)return this.ensureCacheObject(t)},findMatchLike:function(e,t){try{i.default.PAssert(953,void 0!==e,"Must provide a valid contact part")}catch(e){i.default.reportError(e)}for(var a=e.toUpperCase(),r=[],n=this._contacts.get(),s=0;s<n.length;++s){var o=n[s],l=!1;if(o.text.toUpperCase().indexOf(a)>=0&&(l=!0),o.emails)for(var d=0;!l&&d<o.emails.length;++d){if(o.emails[d].address.toUpperCase().indexOf(a)>=0){l=!0;break}}if(o.phoneNumbers)for(d=0;!l&&d<o.phoneNumbers.length;++d){if(o.phoneNumbers[d].number.indexOf(a)>=0){l=!0;break}}if(l&&(r.push(this.ensureCacheObject(o)),r.length>=t))break}return r.sort(this.contactComparator),r},findContactByEmail:function(e){for(var t=0;t<this._contacts.get().length;++t){var a=this._contacts.get()[t];if(a.emails)for(var i=0;i<a.emails.length;++i)if(a.emails[i].address===e)return a}},findEmailsLike:function(e,t){try{i.default.PAssert(954,void 0!==e,"Must provide a valid email part")}catch(e){i.default.reportError(e)}t=t||20;for(var a=[],r=e.toUpperCase(),n=0;n<this._contacts.get().length;++n){var s=this._contacts.get()[n];if(s&&s.emails){var o=!1;s.text&&s.text.toUpperCase().indexOf(r)>=0&&(o=!0);for(var l=0;l<s.emails.length;++l){var d=s.emails[l].address;(o||d.toUpperCase().indexOf(r)>=0)&&a.push({type:"contact",text:s.text,email:d})}}if(a.length>=t)break}return a.sort(this.emailComparatorSort),a}},t.a=s},function(e,t,a){"use strict";var i=a(0);function r(e){try{i.default.PAssert(1430,i.default.isObject(e),"Should always supply a valid object to init a contact")}catch(e){i.default.reportError(e)}this.id=e.id,this.type="contact",this.text=e.text||"",this.phoneNumbers=e.phoneNumbers||[],this.emails=e.emails||[],this.init()}r.prototype={init:function(){for(var e=0;e<this.phoneNumbers.length;e++)this.phoneNumbers[e].link=this.formatPhone(this.phoneNumbers[e].number),this.phoneNumbers[e].type=this.phoneNumbers[e].type[0];for(e=0;e<this.emails.length;e++)this.emails[e].link="mailto:"+this.emails[e].address},_phoneRegex:/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/,formatPhone:function(e){if(this._phoneRegex.test(e)){var t=e.match(this._phoneRegex),a="";return t[1]&&(a+="+1-"+t[1]+"-"),"tel:"+(a+=t[2]+"-"+t[3])}var r=e.replace(/\D+/g,"");try{i.default.PAssert(1431,r&&""!==r,"Invalid phone number format: "+e)}catch(e){i.default.reportError(e)}return e.startsWith("+")&&(r="+"+r),"tel:"+r}},t.a=r},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(4),s=a(15),o=(a(74),a(7));t.a=function(){function e(e){window.gapiLoadError=!0,window.pendingGoogleClientLoad=!1,i.default.reportError(new Error("Google API Load Error"+arguments.length),e)}function t(e){window.gapiTimeout=!0,window.pendingGoogleClientLoad=!1,i.default.reportError(new Error("Google API Load Timeout"),e)}function a(){if(window.pendingGoogleClientLoad=!1,!gapiCalled)if(gapiCalled=!0,gapi.auth.init(),window.location.hash.indexOf("offline=true")>=0||window.location.hash.indexOf("offline%22:true")>=0||window.location.hash.indexOf('offline":true')>=0||window.location.hash.indexOf("demo=true")>=0)log("%cOffline","color: pink");else{if(ShouldLog(LogLevels.Timing)&&log("GAPI Callback - Loaded:",log.now()),ShouldLog(LogLevels.Timing)&&log("Drive-Realtime API - Loaded: ",window.performance.now()),window.gapi&&window.gapi.drive&&window.gapi.drive.realtime)i.default.blockedMessage="",s.a.loadClientDefaultFile(),i.default.fireCustomEvent("gapiDriveLoaded");else{var e;window.gapiCalled=!1,window.gapiLoadError=!0,e=gapi?gapi.drive?gapi.drive.realtime?"all exist":"gapi.drive.realtime":"gapi.drive":"gapi";var t=function(t){i.default.isBlocked=!0,n.a.app||t?(i.default.reportError(new Error("Error loading GAPI: "+e)),i.default.blockedMessage="There was an error loading the Google APIs."):(i.default.reportError(new Error("Extension blocked gapi from loading: "+e)),i.default.blockedMessage="An extension has blocked apis.google.com from loading."),i.default.vmMain&&i.default.vmMain.gdriveStatus(DriveStatus.Offline)};i.default.XHR({type:"GET",timeout:7e3,url:"https://api.moo.do/private/v1/info",cb:function(e){var a=!1;if(200===e.status){var i;try{!0===(i=JSON.parse(e.response)).success&&0===i.data.indexOf("Moo.do")&&(a=!0)}catch(e){}t(!a)}else t(!0)}})}if(window.gapi&&window.gapi.auth){ShouldLog(LogLevels.Timing)&&log("Goog Callback - Loaded: ",log.now()),i.default.fireCustomEvent("gapiLoaded");var a=!1;n.a.ie||(a=s.a.checkTokenInHash());var l=r.a.hasURLParam("login","true"),d=r.a.hasURLParam("user"),c=a||l||d||i.default.getLoginState()==LoginState.LOGGED_IN,u=!1;if(d){var h=r.a.getURLParam("user"),f=i.default.getActiveUser();r.a.removeURLParam("user",!0),h!==f&&(i.default.setActiveUser(h),void 0!==f&&(o.a.clearData(function(){i.default.reload()},{Default:[Settings.activeUser]}),u=!0))}u||s.a.runAuthenticate(s.a.requestScopes,!0,!1,function(e){ShouldLog(LogLevels.Timing)&&log("Goog Authorized - Callback: ",log.now()),l&&r.a.removeURLParam("login",!0),e&&!e.error?(c&&(i.default.vmSetup?i.default.vmSetup.setLoginState(LoginState.LOGGED_IN):i.default.setLoginState(LoginState.LOGGED_IN),s.a.loadClientDefaultFile()),s.a.ensureRequiredScopesAreRequested()):s.a.requiredScopes!==s.a.requestScopes?(i.default.settings.reset(Settings.authScopes),s.a.runAuthenticate(s.a.requiredScopes,!0,!1,function(e){e&&!e.error?c&&(i.default.vmSetup?i.default.vmSetup.setLoginState(LoginState.LOGGED_IN):i.default.setLoginState(LoginState.LOGGED_IN),s.a.loadClientDefaultFile()):(i.default.vmSetup?i.default.vmSetup.setLoginState(LoginState.LOGGED_OUT):i.default.setLoginState(LoginState.LOGGED_OUT),e&&"immediate_failed"===e.error&&(i.default.authImmediateFailed=!0))})):i.default.vmSetup?i.default.vmSetup.setLoginState(LoginState.LOGGED_OUT):i.default.setLoginState(LoginState.LOGGED_OUT)})}else try{i.default.PAssert(426,!1,"Failed to load GAPI auth lib properly")}catch(e){i.default.reportError(e)}}}if(window.gapiKey="AIzaSyB9HEdSJ-nhLJG_ssSSqhI2DX74GSiKSao",window.gapiCalled=!1,window.gapiLoadError=!1,window.gapiTimeout=!1,window.gapiClientCalled=!1,window.gapiClientLoadError=!1,window.gapiClientTimeout=!1,window.pendingGoogleClientLoad=!1,window.GoogleClientAPILoaded=function(r){window.gapiClientCalled=!0,window.gapi?window.pendingGoogleClientLoad||(window.pendingGoogleClientLoad=!0,gapi.load("client:drive-realtime",{callback:a,onerror:e,timeout:2e4,ontimeout:t})):i.default.reportError(new Error("Google Client API Load Failed"),r)},window.location.hash.indexOf("demo=true")<0){var l=document.createElement("script");l.src="https://apis.google.com/js/api.js?onload=GoogleClientAPILoaded",l.async=1,l.id="gapiScript",l.onloadDone=!1;var d=setTimeout(function(){window.gapiCalled||(window.gapiClientTimeout=!0,i.default.blockedMessage||(i.default.blockedMessage="An extension has blocked apis.google.com from loading."))},2e4);l.onerror=function(e){window.gapiClientLoadError=!0,clearTimeout(d),i.default.reportGapiScriptError(l,e)},l.onload=function(e){l.onloadDone=!0,clearTimeout(d),i.default.reportGapiScriptLoad(l,e)},l.onreadystatechange=function(e){"loaded"!==l.readyState||l.onloadDone||(l.onloadDone=!0,i.default.reportGapiScriptLoad(l,e))},document.getElementsByTagName("head")[0].appendChild(l)}}},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(7),s=a(10),o=a(8),l=a(18),d=a(11),c=a(28),u=a(9),h=a(27),f=a(24);function p(){this.hasSelection=!1,this.isTyping=!1,this.isRunning=!1,this.isDisabled=!1,this.isPaused=!1,this.stoppedFromPause=!1,this.activeScript=void 0,this.index=0,this.repeat=!1,this.onScriptDone=void 0,this.selectedItem=void 0,this.lastLoadedData=void 0,this.savedItems={},this.typingSpeed=30,this._scriptQueue=[],this.startText={},this.demoCaption=new u.a,i.default.isDemoMode()&&window.addEventListener("message",function e(t){if(t.data&&i.default.isString(t.data)&&t.data.indexOf("{")<0)for(var a=t.data.split("&"),n=0;n<a.length;n++){var s=a[n].split("=");try{i.default.PAssert(979,s.length>=0,"Invalid number of params in message")}catch(e){i.default.reportError(e)}switch(s[0]){case"script":this.runScript(s[1]);break;case"data":if(this.isRunning)return this.stop(),clearTimeout(this.timeoutMessage),void(this.timeoutMessage=setTimeout(e.bind(this),100,t));this.loadScriptData(s[1]);break;case"start":this.start();break;case"stop":this.stop();break;case"pause":this.pause();break;case"resume":this.resume();break;case"restart":this.restart();break;case"alertDemo":i.default.menus.alert({text:'Click anywhere to try this <b class="blue">live demo</b>',callback:i.default.emptyFn});break;case"help":"1"===s[1]?i.default.vmMain.showHelp(r.a.HelpMode.Normal):i.default.intro.close();break;case"panes":this.loadPanes(s[1])}}}.bind(this),!1),window.pauseScript=function(){this.isDisabled||(log("pause script"),this.isDisabled=!0)}.bind(this)}var m=function(){this.queue.apply(this,arguments)},g=function(e,t,a,i){if(m("createItemAfter",void 0,t),void 0!==a&&0!==a)for(var r=0;r<Math.abs(a);r++)m("indent",a<0);m(i?"setText":"typeString",void 0,e)},v=function(e){m("delay",e)};p.prototype={runScript:function(e){if(!this.isDisabled){0;var t=this.createScript(e);switch(this.activeScript=t,e){case"wait":this.demoEmpty(t);break;case"introEmail":this.demoEmail(t);break;case"introStyle":this.demoStyle(t);break;case"press":this.demoPress(t);break;case"none":return void this.notify("demoReady")}if(t.runQueue.length>0)this._scriptQueue.push(t);else try{i.default.PAssert(980,!1,"Invalid script request: ",e)}catch(e){i.default.reportError(e)}this.repeat=!1,this.activeScript=this._scriptQueue[0],!this.isRunning&&this.activeScript&&this.start()}},start:function(){i.default.toasts.clearMessage(MessageID.ThisIsDemo),this.onScriptStart(this.activeScript),this.run()},restart:function(){this.activeScript=this._scriptQueue[0],this.activeScript.index=0,this.start()},stop:function(){this._scriptQueue=[],this.isRunning=!1,this.activeScript=void 0,clearTimeout(this.timeoutDelay),this.timeoutDelay=void 0,clearTimeout(this.timeout),this.timeout=void 0,clearTimeout(this.timeoutMessage),this.timeoutMessage=void 0,i.default.autocomplete.hide(),l.a.stop(),l.a.finish()},pause:function(){this.isPaused=!0},resume:function(){this.isPaused=!1,this.wasResumed=!0,this.stoppedFromPause&&(this.stoppedFromPause=!1,this.run())},demoReady:function(e){this.wasResumed||this.pause(),this.notify("demoReady"),e()},switchDemo:function(e){this.stop(),i.default.isDemoRunning=!0;var t=this[e]();this.resetData(function(){this._scriptQueue.push(t),this.activeScript=t,this.start()}.bind(this))},loadScriptData:function(e,t){log("Load Script Data: ",e),this._scriptQueue=[],this.repeat=!1,this.lastLoadedData=e,d.a.fireEvent("resetEverything",[]),i.default.vmMain.paneManager.clearPanes(!1),i.default.vmMain.beginUpdateItems(),n.a.loadDemoData(e,!0,function(e){i.default.vmMain.changeRoot(e),i.default.vmMain.commitUpdateItems(),t&&t()})},loadPanes:function(e){i.default.vmMain.loadDemoPanes(e.split(":"))},onScriptStart:function(e){e&&window.parent.postMessage(e.getName(),"*")},createScript:function(){var e={_nextId:0,owner:this,index:0,_repeat:!1,noDelay:!1,runQueue:[],_activeQueue:function(){return this.runQueue},queue:function(e){var t=Array.prototype.slice.call(arguments,1),a=this.runQueue;return a.push({id:this._nextId++,name:e,args:t}),a},repeat:function(e){this._repeat=e},nextStep:function(){return this.runQueue[this.index++]},getName:function(){return this._name}};return m=m.bind(e),g=g.bind(e),e},run:function(){if(!this.isDisabled&&this.activeScript)if(this.isPaused)this.stoppedFromPause=!0;else{try{i.default.PAssert(982,this.activeScript,"Must have a script active to be running")}catch(e){i.default.reportError(e)}var e=this.activeScript.nextStep();if(e){var t=e.args;t.push(this.run.bind(this)),this.isRunning=!0,clearTimeout(this.timeout),this.timeout=setTimeout(function(){try{this[e.name].apply(this,t)}catch(e){i.default.reportError(e),this.onDisable()}}.bind(this),0)}}},onDisable:function(){this.isDisabled=!0},setSelection:function(e,t,a,r,n){try{i.default.PAssert(983,e,"Must provide a valid item to select")}catch(e){i.default.reportError(e)}i.default.isNumber(e)&&(e=i.default.vmMain.paneManager.getPaneAtIndex(t).itemAtIndex(e));e=this.getItemIfString(e);var s=t>=0?i.default.vmMain.paneManager.getPaneAtIndex(t):i.default.focusedPane;i.default.focusedPane&&i.default.focusedPane.id===s.id||o.a.focusPane(s),void 0===a||null===a?a=0:a<0&&(a=e.getParsedText().length+a+1),o.a.selectItem(e,a,a+r),this.hasSelection=!0,this.selectedItem=e,n&&n()},clearSelection:function(e){o.a.reset(),this.hasSelection=!1,this.selectedItem=void 0,e&&e()},scrollTo:function(e,t,a){var r=i.default.vmMain.paneManager.getPaneAtIndex(e);try{i.default.PAssert(984,r,"Must have selected a valid pane")}catch(e){i.default.reportError(e)}r.setScrollOffset(t),a&&a()},scrollMain:function(e,t,a){i.default.vmMain.setScrollOffset(e,t),setTimeout(a,t)},setText:function(e,t,a){(e=e||this.selectedItem).setText(t,!0,ChangeType.Local),a&&a()},appendText:function(e,t,a){e.setText(e.getParsedText()+t,!0),a&&a()},setPriority:function(e,t,a){(e=this.getItemIfString(e)||this.selectedItem).priority(t,ChangeType.Local),a&&a()},setStarred:function(e,t,a){(e=e||this.selectedItem).isStarred(t,ChangeType.Local),a&&a()},setComplete:function(e,t,a,i){(e=this.getItemIfString(e)||this.selectedItem).dateCompleted=a,e.isComplete(t,ChangeType.Local),i&&i()},removeItem:function(e,t){(e=this.getItemIfString(e)||this.selectedItem).deleteSelf(ChangeType.Local),t()},setStarredEmail:function(e,t,a){var r=i.default.vmMain.paneManager.getPaneAtIndex(e),n=r.itemAtIndex(t);r.toggleStar(n),a()},setPriorityEmail:function(e,t,a,r){var n=i.default.vmMain.paneManager.getPaneAtIndex(e).itemAtIndex(t),s=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail);n&&s.setAttachmentPriority(n.getAttachmentByPlugin(PluginID.Gmail),a),r()},indent:function(e,t){var a={normCode:KeyCode.Tab,shiftKey:e};o.a.fireKeyEvent(void 0,a),t&&t()},collapse:function(e,t,a){var r=i.default.vmMain.paneManager.getPaneAtIndex(t);(e=this.getItemIfString(e)||this.selectedItem).setCollapsed(!0,r),a&&a()},backspace:function(e,t,a,r){try{i.default.PAssert(989,r,"typeString should always have a callback")}catch(e){i.default.reportError(e)}e=this.getItemIfString(e)||this.selectedItem;try{i.default.PAssert(990,e,"Must be an item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(991,this.hasSelection,"Must set selection before typing")}catch(e){i.default.reportError(e)}try{i.default.PAssert(992,!this.isTyping,"Must wait until previous typing is finished")}catch(e){i.default.reportError(e)}var n=0,s=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),o=this.activeScript,l=e.getParsedText();function d(){this.isTyping=!0,this.activeScript===o?(l=l.substr(0,a-1)+l.substr(a,l.length-a),a--,e.setText(l,!0,ChangeType.Local),++n>=t&&(s(),r&&r())):s()}d.apply(this),t>1&&(clearInterval(this.intervalTyping),this.intervalTyping=setInterval(d.bind(this),this.typingSpeed))},typeString:function(e,t,a){try{i.default.PAssert(993,a,"typeString should always have a callback")}catch(e){i.default.reportError(e)}e=this.getItemIfString(e)||this.selectedItem;try{i.default.PAssert(994,e,"Must be an item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(995,this.hasSelection,"Must set selection before typing")}catch(e){i.default.reportError(e)}try{i.default.PAssert(996,!this.isTyping,"Must wait until previous typing is finished")}catch(e){i.default.reportError(e)}try{i.default.PAssert(997,void 0!==t,"Must supply a string to be typed")}catch(e){i.default.reportError(e)}var r=0,n=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),s=this.activeScript;function l(){if(this.isTyping=!0,this.activeScript===s){var i=t.charCodeAt(r);if(i===KeyCode.Delete&&(i=KeyCode.Period),i===KeyCode.End){var l=o.a.getStartOffset(),d=e.getParsedText(),c=d.substr(0,l)+t.charAt(r)+d.substr(l);e.setText(c,!0,ChangeType.Local),o.a.selectItem(e,l+1)}else o.a.fireKeyEvent(void 0,{normCode:i});++r>=t.length&&(n(),a&&a())}else n()}t&&(l.apply(this),t.length>1&&(clearInterval(this.intervalTyping),this.intervalTyping=setInterval(l.bind(this),this.typingSpeed)))},typeIntoEmail:function(e,t,a){var r=i.default.reactEmailCompose.refs.body,n=0,s=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),o=this.activeScript;clearInterval(this.intervalTyping),this.intervalTyping=setInterval(function(){if(this.activeScript===o){var t=e[n];r.insertCharAtIndex(t,n),++n>=e.length&&(s(),a&&a())}else s()}.bind(this),t)},setSearch:function(e,t,a){i.default.vmMain.paneManager.getPaneAtIndex(t).search.setValue(e),a&&a()},createItemAfter:function(e,t,a){e=e||this.selectedItem,this.setSelection(e,void 0,e.getParsedText().length,0),o.a.fireKeyEvent(void 0,{normCode:KeyCode.Enter}),requestAnimationFrame(function(){this.clearSelection(function(){var r;r=e.isHeader()?e.getChild(0):e.parent().getChild(e.getIndex()+1);try{i.default.PAssert(1002,r,"Error getting new item: ",t)}catch(e){i.default.reportError(e)}t&&(this.savedItems[t]=r),this.selectedItem=r,this.setSelection(r,void 0,-1,0,a)}.bind(this))}.bind(this))},zoomPane:function(e,t,a){var r=i.default.vmMain.paneManager.getPaneAtIndex(e);t=this.getItemIfString(t),r.setItem(t,!0),a&&a()},zoomGmailPane:function(e,t,a){var r=i.default.vmMain.paneManager.getPaneAtIndex(e),n=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail),s=n._getLabelByName("me",t);try{i.default.PAssert(1007,s,"Must be able to get a valid label if clicking a valid label")}catch(e){i.default.reportError(e)}var o=n.getVMLIForLabel("me",s);r.setItem(o,!0),r.selectIndex(-1),a&&a()},delay:function(e,t){t&&(0===e?t&&t():(this.delayCb=t,clearTimeout(this.timeoutDelay),this.timeoutDelay=setTimeout(function(){this.delayCb=this.timeoutDelay=void 0,t()}.bind(this),e)))},addPane:function(e,t,a,r,s,o){var l={};l.item=a?this.getItemIfString(a):n.a.getRootModel(),r&&(l.search=r);i.default.vmMain.paneManager.createPaneAtIndex(e,t,l,s);o()},removePane:function(e,t,a){i.default.vmMain.paneManager.removePaneAtIndex(e,t),a&&a()},cullPanes:function(e,t){var a=i.default.vmMain.paneManager.paneCount();a>e?(this.removePane(a-1),setTimeout(this.cullPanes.bind(this,e,t),60)):t()},selectItemInPane:function(e,t,a){var r=i.default.vmMain.paneManager.getPaneAtIndex(e).itemAtIndex(t);this.selectedItem=r,a()},dragTo:function(e,t,a,r,n,s){var d=i.default.vmMain.paneManager.getPaneAtIndex(e),c=i.default.vmMain.paneManager.getPaneAtIndex(t),u=d.itemAtIndex(a),f=d.elementAtIndex(a),p=-1===r;p&&(r=c.numItems()-1);var m,g,v=c.elementAtIndex(r),y=c.itemAtIndex(r),S=f.getBoundingClientRect(),E=v.getBoundingClientRect(),P=d.dragMarginTop||0,b=S.top+(P||10),C=E.left-S.left,D=E.top-b+(p?h.a.lineItemHeight(y,1):0);o.a.focusPane(d);var I=null;var A=this,M=this.activeScript;l.a.startDragItem=u,u.dragStart({startSrc:f,eventX:S.left+10,eventY:b}),requestAnimationFrame(function e(t){if(A.activeScript===M){I||(I=t);var a,r=(a=(t-I)/n)<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1;if(m=C*r+S.left+10,g=D*r+b,r>=1){var l,d=document.getElementById("preventInteraction");d&&(l=d.parentElement).removeChild(d)}u.dragMove({eventX:m,eventY:g,diffY:D>S.top?1:-1,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn}),d&&l.appendChild(d),r>=1?(u.dragEnd({clientX:m,clientY:g,target:f}),s&&s()):requestAnimationFrame(e)}else o.a.fireMouseUp(f,ButtonCode.Left)})},getItemIfString:function(e){var t;if(i.default.isString(e)){t=n.a.getModel(e)||this.savedItems[e];try{i.default.PAssert(1014,t,"Item was not saved correctly")}catch(e){i.default.reportError(e)}}else if(e){try{i.default.PAssert(1015,i.default.isVMLI(e),"Must supply a valid VMLI: ",i.default.getObjectInfo(e))}catch(e){i.default.reportError(e)}t=e}return t},pushMessage:function(e,t){if(this._currentToast)return i.default.toasts.clearMessage(this._currentToast),this._currentToast=void 0,void setTimeout(this.pushMessage.bind(this),100,e,t);var a;if(a=i.default.isString(e)?i.default.toasts.pushMessage({text:e,hold:!0}):i.default.toasts.pushMessage(e),this._currentToast=a,e===MessageID.ThisIsDemo){var r=function(){i.default.toasts.clearMessage(a),window.removeEventListener("tapMain",r)};window.addEventListener("tapMain",r)}t&&t()},notify:function(e,t){window.parent.postMessage(e,"*"),t&&t()},demoDone:function(e){o.a.reset(),this.notify("done"),i.default.isDemoRunning=!1,i.default.autocomplete.isEnabled=!0;var t=document.getElementById("preventInteraction");t&&t.parentElement.removeChild(t),e()},addClass:function(e,t){i.default.addClass(document.documentElement||document.body,e),t&&t()},removeClass:function(e,t){i.default.removeClass(document.documentElement||document.body,e),t&&t()},switchClass:function(e,t,a){this.removeClass(e),this.addClass(t),a()},selectEmail:function(e,t,a){var r=i.default.vmMain.paneManager.getPaneAtIndex(e);try{i.default.PAssert(1016,r,"Must have selected a valid pane")}catch(e){i.default.reportError(e)}o.a.focusPane(r),r.selectIndex(t),a&&a()},openEmail:function(e,t,a){var r=i.default.vmMain.paneManager.getPaneAtIndex(e);try{i.default.PAssert(1017,r,"Must have selected a valid pane")}catch(e){i.default.reportError(e)}r.selectIndex(t);var n=r.itemAtIndex(t);r.openEmailByItem(n),a&&a()},closeEmail:function(e){c.a.close(),e&&e()},sendEmail:function(e){i.default.reactEmailCompose.onClickSend(),e()},toggleMessageExpanded:function(e,t){i.default.reactEmailPreview.toggleExpanded(e),t()},replyToMessage:function(e){c.a.setLastMessageResponseMode(r.a.EmailResponseMode.Reply),e()},archiveEmail:function(e,t,a){var r=i.default.vmMain.paneManager.getPaneAtIndex(e),n=r.itemAtIndex(t);r.archiveItem(!0,n),a()},addEmail:function(e,t){i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail).refreshThreadCacheData("me",e,void 0,function(){},t)},waitPaneItems:function(e,t){var a=i.default.vmMain.paneManager.getPaneAtIndex(e);try{i.default.PAssert(1018,a,"Must have selected a valid pane")}catch(e){i.default.reportError(e)}if(a.items.length()>0)t();else{var r=function(e){e.length>0&&(a.items.unlisten(r),t())};a.items.listen(r)}},displaySetting:function(e,t){f.a.changeTheme(e),t()},caption:function(e,t,a){this.demoCaption.set({text:e,opacity:1,center:t,light:e.indexOf("<b>")>=0}),a()},captionFade:function(e){var t=this.demoCaption.get();this.demoCaption.set({text:t.text,opacity:0,center:t.center,light:t.light}),e()},resetData:function(e){if(this.isRunning)return this.stop(),clearTimeout(this.timeoutMessage),void(this.timeoutMessage=setTimeout(this.resetData.bind(this),100,e));this.loadScriptData(n.a.demoDataId,e)},waitAction:function(e,t){this._waitTracker={check:e,cb:t}},onTrackerAction:function(e){var t=this._waitTracker;t&&t.check(e)&&t.cb()},demoEmail:function(e){return i.default.isDemoRunning=!0,m("waitPaneItems",0),m("zoomGmailPane",1,"Needs Reply"),m("zoomGmailPane",2,"Starred"),m("removeClass","invisible"),m("demoReady"),v(1e3),m("dragTo",0,1,0,-1,1e3),v(200),m("dragTo",0,1,0,-1,1e3),v(800),m("setStarredEmail",0,1),v(500),m("setStarredEmail",0,3),v(800),m("setPriorityEmail",2,0,VMLIFlag.P0),v(500),m("setPriorityEmail",2,2,VMLIFlag.P2),v(1200),m("selectEmail",0,0),v(200),m("openEmail",0,0),m("pushMessage",MessageID.ThisIsDemo),m("demoDone"),e},demoStyle:function(e){i.default.isDemoRunning=!0,i.default.autocomplete.isEnabled=!1,this.collapse("ideas",0),this.collapse("todo",0),this.collapse("testing",0),m("removeClass","invisible"),m("demoReady"),v(500),m("dragTo",0,1,1,1,1e3),v(1e3),m("setSelection","tracking",0,-1,0),m("typeString",void 0," #Android"),v(800),m("typeString",void 0," @tomorrow "),v(800),m("setSelection","tracking",0,0,0),m("typeString",void 0,"+Grant "),v(1500),m("zoomPane",1,"release"),v(1500);for(var t="#Android",a=t.length;a>=0;a--)m("setSearch",t.substr(0,a),2),v(40);v(800),t="+Grant";for(a=0;a<=t.length;a++)m("setSearch",t.substr(0,a),2),v(40);m("pushMessage",MessageID.ThisIsDemo),m("demoDone")},demoPress:function(e){s.a.addListener(this.onTrackerAction.bind(this)),m("pushMessage",{text:"Try dragging an email onto the Outline.",hold:!0,big:!0}),m("waitAction",function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&e.data.fromPane&&e.data.fromPane.type===PaneMode.Gmail}),m("pushMessage",{text:"Schedule an item by typing @ then a date.<br><br>Or drag it right onto the Agenda.",hold:!0,big:!0}),m("waitAction",function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate||e.type===TrackerType.Insert&&"@"===e.data[0].text}),m("pushMessage",{text:"Learn more on our homepage.",hold:!0,action:MessageAction.OpenURL,actionText:"https://moo.do",data:{url:"https://www.moo.do"}})},demoEmpty:function(e){i.default.isDemoRunning=!0,m("demoReady"),m("pushMessage",MessageID.ThisIsDemo),m("demoDone")}},t.a=p},function(e,t,a){"use strict";var i=a(0),r=a(5),n=(a(7),a(52));function s(e,t,a){if(a){try{i.default.PAssert(1466,!a.noInMemoryCache,"Invalid in-memory cache option")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1467,!a.noMetadataInMemoryCache,"Invalid metadata in-memory cache option")}catch(e){i.default.reportError(e)}a.noInMemoryCache=!1,a.noMetadataInMemoryCache=!1}this._super.constructor.call(this,e,t,a),this._db=void 0}var o={getStorageType:function(){return StorageType.InMemory},setMetadata:function(e,t,a){this._super.setMetadata.call(this,e,t),a&&a(!0)},removeMetadata:function(e,t){this._super.removeMetadata.call(this,e),t&&t(!0)},getMetadata:function(e,t){var a=this._super.getMetadata.call(this,e)||void 0;t&&t(a)},count:function(e){try{i.default.PAssert(1468,e,"Must provide a valid callback")}catch(e){i.default.reportError(e)}var t=this._super.count.call(this);e&&e(t)},size:function(e){try{i.default.PAssert(1469,e,"Must provide a valid callback")}catch(e){i.default.reportError(e)}var t=this._super.size.call(this);e&&e(t)},loadAll:function(e){this._super.loadAll.call(this),e&&e(!0)},getEntrySync:function(e){try{i.default.PAssert(1470,e,"Must provide a valid ID to get")}catch(e){i.default.reportError(e)}return this._super.getEntrySync.call(this,e)||void 0},getEntry:function(e,t){try{i.default.PAssert(1471,e,"Must provide a valid ID to get")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1472,t,"Must provide a valid entry callback")}catch(e){i.default.reportError(e)}var a=this._super.getEntry.call(this,e)||void 0;t&&t(a,e)},getBoundEntries:function(e,t,a,r){try{i.default.PAssert(1473,e,"Must specify a valid index")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1474,r,"Must provide a valid entry callback")}catch(e){i.default.reportError(e)}var n=this._super.getBoundEntries.call(this,e,t,a)||[];r&&r(n)},getFilterEntries:function(e,t){try{i.default.PAssert(1475,i.default.isFunction(e),"Must specify a valid filter function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1476,t,"Must provide a valid entry callback")}catch(e){i.default.reportError(e)}var a=this._super.getFilterEntries.call(this,e)||[];t&&t(a)},removeEntry:function(e,t){try{i.default.PAssert(1477,e,"Must provide valid data id")}catch(e){i.default.reportError(e)}this._super.removeEntry.call(this,e),t&&t(!0)},hasEntry:function(e,t){var a=this._super.hasEntry.call(this,e);t&&t(a)},cacheEntry:function(e,t,a){try{i.default.PAssert(1478,e,"Must provide valid data id")}catch(e){i.default.reportError(e)}this._super.cacheEntry.call(this,e,t),a&&a(!0)},clearCache:function(e){this._super.clearCache.call(this),e&&e(!0)},clearMetadata:function(e){this._super.clearMetadata.call(this),e&&e(!0)},clearBackingStore:function(e){e&&e(!0)}};r.a.inherit(n.a,s),r.a.extend(s.prototype,o),t.a=s},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(7),s=a(52);function o(e,t,a){this._usesDiskSpace=!0,this._db=void 0,this._cacheTable=void 0,this._metadataTable=void 0,this._version=2,this._schema=this._getDefaultSchema(),this._super.constructor.call(this,e,t,a)}var l={_makeID:function(e){return e},validID:function(e){return!0},_metadataID:function(e){return e},getStorageType:function(){return StorageType.IndexedDB},_migrateEntry:function(e,t,a){delete e.cid,this._cacheTable.update(e).done(t).fail(a)},_migrateMetadata:function(e,t,a){delete e.cid,this._super.setMetadata.call(this,e.id,e.value),this._metadataTable.update(e).done(t).fail(a)},_runMigration:function(e){n.a.onCachesAvailable(function(){var t=n.a.openCacheTable(this._id);t.query().bound(this._id,this._id+"￿").execute().done(function(a){var i=!1,r=0,s=0,o=0,l=this._id;function d(){i&&r+s===o&&(log("Migration Completed: ",r,s,o,i),n.a.closeCacheTable(l),e(!0))}function c(){r++,d()}function u(e){s++,d()}for(var h=0;a&&h<a.length;++h)t.remove(a[h].cid),this._migrateEntry(a[h],c,u),o++;t.query().bound("Meta_Moo_","Meta_Moo_￿").execute().done(function(e){for(var a=0;e&&a<e.length;++a)e[a].cid.endsWith(this._id)&&(t.remove(e[a].cid),this._migrateMetadata(e[a],c,u),o++);i=!0,d()}.bind(this))}.bind(this))}.bind(this))},open:function(){this._super.open.call(this),n.a.openCacheDatabase(this._id,this._version,this._schema,function(e){try{i.default.PAssert(1514,!this._db,"Should not open the cache DB twice")}catch(e){i.default.reportError(e)}e&&(this._db=e,this._cacheTable=e.cache,this._metadataTable=e.metadata),i.default.vmMain.cacheManager.needsMigration()?this._runMigration(function(t){log("Cache data migrated: ",this._id),this.notifyCacheMetadataReady(!!e),this.notifyCacheReady(!!e)}.bind(this)):(this.notifyCacheMetadataReady(!!e),this.notifyCacheReady(!!e))}.bind(this))},close:function(){this._super.close.call(this),this._db.close(),this._db=void 0,this._cacheTable=void 0,this._metadataTable=void 0},isReady:function(){return this._super.isReady.call(this)&&this._db&&this._cacheTable},isMetadataReady:function(){return this._super.isReady.call(this)&&this._db&&this._metadataTable},notifyCacheReady:function(e){this._super.notifyCacheReady.call(this,e)},notifyCacheMetadataReady:function(e){this._super.notifyCacheMetadataReady.call(this,e)},setMetadata:function(e,t,a){if(this._super.setMetadata.call(this,e,t),this.isMetadataReady()){var i={id:e,value:t};try{this._metadataTable.update(i).done(function(){a&&a(!0)}).fail(function(e,t){this.onCacheError(t),a&&a(!1)}.bind(this))}catch(e){this.onTransactionError(e),a&&a(!1)}}else a&&a(!1)},removeMetadata:function(e,t){if(this._super.removeMetadata.call(this,e),this.isMetadataReady())try{this._metadataTable.remove(this._metadataID(e)).done(function(){t&&t(!0)}).fail(function(e){log("IDB removeMetadata Error: ",e),t&&t(!1)})}catch(e){this.onTransactionError(e),t&&t(!1)}else t&&t(!1)},getMetadata:function(e,t){var a=this._super.getMetadata.call(this,e);if(a)t(a);else if(this.isMetadataReady())try{this._metadataTable.query().only(this._metadataID(e)).limit(1).execute().done(function(e){var a;try{i.default.PAssert(1515,!e||0===e.length||1===e.length&&e[0],"Mismatch in metadata value")}catch(e){i.default.reportError(e)}e&&1===e.length&&e[0]&&(a=e[0].value),t(a)}).fail(function(e){log("IDB getMetadata Error: ",e),t(void 0)})}catch(e){this.onTransactionError(e),t(void 0)}else t(void 0)},count:function(e){if(this.isReady())try{this._cacheTable.query().all().count().execute().done(function(t){e(t)}).fail(function(t){e()})}catch(t){this.onTransactionError(t),e()}else e()},size:function(e){if(this.isReady())try{this._cacheTable.query().all().execute().done(function(t){for(var a=0,i=0;i<t.length;++i)a+=this._entrySize(t[i]);e(a)}).fail(function(t){e()})}catch(t){this.onTransactionError(t),e()}else e()},loadAll:function(e){if(this.isReady())try{this._cacheTable.query().all().execute().done(function(t){for(var a=0;a<t.length;++a)this._super.cacheEntry.call(this,t[a].id,t[a]);this._super.loadAll.call(this),e(!0,t)}.bind(this)).fail(function(t){log("IDB loadAll Error: ",t),this._super.loadAll.call(this),e(!1)})}catch(t){this.onTransactionError(t),e(!1)}else e(!1)},getEntrySync:function(e){try{i.default.PAssert(1516,!1,"Sync access to IDB is not supported")}catch(e){i.default.reportError(e)}},getEntry:function(e,t){try{i.default.PAssert(1517,e,"Must provide a valid ID to get")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1518,t,"Must provide a valid entry callback")}catch(e){i.default.reportError(e)}var a=this._super.getEntry.call(this,e);if(a)t(a);else if(this.isReady())try{this._cacheTable.query().only(this._makeID(e)).limit(1).execute().done(function(a){var i;a&&1===a.length&&(i=a[0],this._super.cacheEntry.call(this,e,i)),t(i,e)}.bind(this)).fail(function(e){log("IDB getEntry Error: ",e),t(void 0)})}catch(e){this.onTransactionError(e),t(void 0)}else t(void 0)},getBoundEntries:function(e,t,a,r){try{i.default.PAssert(1519,e,"Must specify a valid index to query")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1520,r,"Must provide a valid entry callback")}catch(e){i.default.reportError(e)}if(this.isReady())try{this._cacheTable.query().filter(function(i){return i[e]>=t&&i[e]<=a}).execute().done(function(e){r(e,!0)}.bind(this)).fail(function(e){r([],!1)}.bind(this))}catch(e){this.onTransactionError(e),r([],!1)}else r([],!1)},getFilterEntries:function(e,t){try{i.default.PAssert(1521,i.default.isFunction(e),"Must specify a valid filter function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1522,t,"Must provide a valid entry callback")}catch(e){i.default.reportError(e)}if(this.isReady())try{this._cacheTable.query().filter(e).execute().done(function(e){t(e,!0)}.bind(this)).fail(function(e){t([],!1)}.bind(this))}catch(e){this.onTransactionError(e),t(!1)}else t([],!1)},removeEntry:function(e,t){try{i.default.PAssert(1523,e,"Must provide valid data id")}catch(e){i.default.reportError(e)}if(this._super.removeEntry.call(this,e),this.isReady())try{this._cacheTable.remove(this._makeID(e)).done(function(){t&&t(!0)}).fail(function(e){log("IDB removeEntry Error: ",e),t&&t(!1)})}catch(e){this.onTransactionError(e),t&&t(!1)}else t&&t(!1)},hasEntry:function(e,t){if(this._super.hasEntry.call(this,e))t(!0);else if(this.isReady())try{this._cacheTable.query().only(this._makeID(e)).limit(1).execute().done(function(a){var i;a&&1===a.length&&(i=a[0],this._super.cacheEntry.call(this,e,i)),t(!!i)}.bind(this)).fail(function(e){log("IDB hasEntry Error: ",e),t(!1)})}catch(e){this.onTransactionError(e),t(!1)}else t(!1)},_entrySize:function(e){var t=0;try{t=2*JSON.stringify(e).length}catch(e){i.default.reportError(e)}return t},cacheEntry:function(e,t,a){try{i.default.PAssert(1524,e,"Must provide valid data id")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1525,t.id,"Data must also contain a valid item id")}catch(e){i.default.reportError(e)}if(this._super.cacheEntry.call(this,e,t),this.isReady())try{this._cacheTable.update(t).done(function(){if(a)try{a(!0)}catch(e){i.default.reportError(e)}}).fail(function(e,t){this.onCacheError(t),a&&a(!1)}.bind(this))}catch(e){this.onTransactionError(e),a&&a(!1)}else a&&a(!1)},clearCache:function(e){if(this._super.clearCache.call(this),this.isReady())try{this._cacheTable.clear().done(function(){e&&e(!0)}).fail(function(t){log("IDB clearcache Error: ",t),e&&e(!1)})}catch(t){this.onTransactionError(t),e&&e(!1)}else e&&e(!1)},clearMetadata:function(e){if(this._super.clearMetadata.call(this),this.isReady())try{this._metadataTable.clear().done(function(){e&&e(!0)}.bind(this)).fail(function(t){log("IDB clearMetadata Error: ",t),e&&e(!1)})}catch(t){this.onTransactionError(t),e&&e(!1)}else e&&e(!1)},dumpData:function(e){e?this._super.dumpData.call(this,e):(console.log("-- Cache: ",this._id,"--"),this.isReady()?this._cacheTable.query().all().execute().done(function(e){for(var t=0;t<e.length;++t)console.log(e[t])}).fail(function(e){console.log("Error running IDB query: ",e)}):console.log("Cache not ready"))},_getDefaultSchema:function(){return{cache:{key:{keyPath:"id"}},metadata:{key:{keyPath:"id"}}}},onTransactionError:function(e){n.a.notifyDBUnexpectedClose(!1)},onCacheError:function(e){if(e&&e.target)try{var t=e.target.error;t?"QuotaExceededError"===t.name||4===t.code?i.default.vmMain.cacheManager.hasReportedQuotaError()||(i.default.vmMain.cacheManager.reportQuotaExceeded(),i.default.vmMain.pluginManager.onCacheLimitExceeded()):"InvalidStateError"===t.name?n.a.notifyDBUnexpectedClose(!1):i.default.reportError(new Error("IDB Cache Transaction Error"),e):i.default.reportError(new Error("IDB Cache Transaction Error [No Target Error]"),e)}catch(e){i.default.reportError(e)}}};r.a.inherit(s.a,o),r.a.extend(o.prototype,l),t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(5),n=(a(7),a(52)),s=a(11),o=5e3;function l(e,t,a){if(a){try{i.default.PAssert(1527,!a.noInMemoryCache,"Invalid in-memory cache option")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1528,!a.noMetadataInMemoryCache,"Invalid metadata in-memory cache option")}catch(e){i.default.reportError(e)}a.noInMemoryCache=!1,a.noMetadataInMemoryCache=!1,this.saveTime=isNaN(a.saveTime)?o:a.saveTime,a.writeOnUnload&&s.a.listen("onUnload",this.writeCache.bind(this)),a.clearBackingOnLoad&&(this.clearBackingOnLoad=!0,s.a.listen("enterForeground",this.clearBackingStore.bind(this)))}else this.saveTime=o;this._super.constructor.call(this,e,t,a),this._saveTimeout=void 0,r.a.forceBind("writeCache",this)}var d={_localStorageKey:function(){return"MDC_"+this._id},_onWrite:function(e){e||0===this.saveTime?(this._saveTimeout&&(clearTimeout(this._saveTimeout),this._saveTimeout=void 0),this.writeCache()):this.saveTime>=0&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(this.writeCache,this.saveTime))},writeCache:function(){performance.now();var e,t={metadata:this._getRawInMemoryMetadata(),cache:this._getRawInMemoryCache()};try{e=JSON.stringify(t),r.a.storage.setItem(this._localStorageKey(),e)}catch(e){i.default.reportError(e)}},close:function(){this._onWrite(!0),this._super.close.call(this)},getStorageType:function(){return StorageType.LocalStorage},setMetadata:function(e,t,a){this._super.setMetadata.call(this,e,t),this._onWrite(),a&&a(!0)},getMetadata:function(e,t){var a=this._super.getMetadata.call(this,e)||void 0;t&&t(a)},count:function(e){try{i.default.PAssert(1529,e,"Must provide a valid callback")}catch(e){i.default.reportError(e)}var t=this._super.count.call(this);e&&e(t)},size:function(e){try{i.default.PAssert(1530,e,"Must provide a valid callback")}catch(e){i.default.reportError(e)}var t=this._super.size.call(this);e&&e(t)},loadAll:function(e){try{var t=r.a.storage.getItem(this._localStorageKey());if(t){var a=JSON.parse(t);this._setRawInMemoryMetadata(a.metadata),this._setRawInMemoryCache(a.cache)}this._super.loadAll.call(this),this.clearBackingOnLoad&&this.clearBackingStore(),e&&e(!0)}catch(t){i.default.reportError(t),this._super.loadAll.call(this),e&&e(!1)}},getEntrySync:function(e){try{i.default.PAssert(1531,e,"Must provide a valid ID to get")}catch(e){i.default.reportError(e)}return this._super.getEntrySync.call(this,e)||void 0},getEntry:function(e,t){try{i.default.PAssert(1532,e,"Must provide a valid ID to get")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1533,t,"Must provide a valid entry callback")}catch(e){i.default.reportError(e)}var a=this._super.getEntry.call(this,e)||void 0;t&&t(a,e)},getBoundEntries:function(e,t,a,i){var r=this._super.getBoundEntries.call(this,e,t,a);i&&i(r)},getFilterEntries:function(e,t){var a=this._super.getFilterEntries.call(this,e);t&&t(a)},removeEntry:function(e,t){try{i.default.PAssert(1534,e,"Must provide valid data id")}catch(e){i.default.reportError(e)}this._super.removeEntry.call(this,e),this._onWrite(),t&&t(!0)},hasEntry:function(e,t){var a=this._super.hasEntry.call(this,e);t&&t(a)},cacheEntry:function(e,t,a){try{i.default.PAssert(1535,e,"Must provide valid data id")}catch(e){i.default.reportError(e)}this._super.cacheEntry.call(this,e,t),this._onWrite(),a&&a(!0)},clearCache:function(e){this._super.clearCache.call(this),this._onWrite(!0),e&&e(!0)},clearMetadata:function(e){this._super.clearMetadata.call(this),this._onWrite(),e&&e(!0)},clearBackingStore:function(e){r.a.storage.removeItem(this._localStorageKey()),e&&e(!0)}};r.a.inherit(n.a,l),r.a.extend(l.prototype,d),t.a=l},function(e,t,a){"use strict";var i=a(0);function r(e,t,a){this._parsedText=e,this._textLength=e.length,this._attrs=t?i.default.clone(t):{},this._width=void 0,this.isFirstInstanceInItem=a}var n={setWidth:function(e){this._width=e},getWidth:function(e){return this._width||(!e&&this.isMarkup()?0:void 0)},getParsedText:function(){return this._parsedText},getOrigTextLength:function(){return this._textLength},setParsedText:function(e){this._parsedText=e},getStyledText:function(e){var t;if(this.getAttr("plugin")){try{i.default.PAssert(2051,this.getAttr("plugin-id"),"If a plugin is specified, must have the ID for that plugin as well")}catch(e){i.default.reportError(e)}var a=i.default.vmMain.pluginManager.getPlugin(this._attrs.plugin),r=a.getAttachment(this.getAttr("plugin-id"));t=a._getDisplayText(r,e)}else t=i.default.escape(this._parsedText);return t},getAttrs:function(){return this._attrs},getAttr:function(e){var t;return this._attrs&&(t=this._attrs[e]),t},hasAttrs:function(){return!!this._attrs},getClasses:function(){var e;return this._attrs&&(e=this._attrs.cls),e},hasClasses:function(){var e=this.getClasses();return!!e&&e.length>0},hasClass:function(e){var t=!1,a=this.getClasses();return a&&(t=a.indexOf(e)>=0),t},getClassString:function(){var e="",t=this.getClasses();return t&&(e=t.join(" ")),e},addClass:function(e){this._attrs||(this._attrs={}),this._attrs.cls||(this._attrs.cls=[]),this._attrs.cls.push(e)},mergeAttrs:function(e){if(e)if(this._attrs){e.cls&&(this._attrs.cls?this._attrs.cls=this._attrs.cls.concat(e.cls):this._attrs.cls=e.cls);var t=this._attrs["data-href"]||e["data-href"];t&&(this._attrs["data-href"]=t);try{i.default.PAssert(2052,void 0===this._attrs.plugin||void 0===e.plugin||this._attrs.plugin===e.plugin,"A single element cannot match multiple plugins")}catch(e){i.default.reportError(e)}var a=this._attrs.plugin||e.plugin;a&&(this._attrs.plugin=a);try{i.default.PAssert(2053,void 0===this._attrs["plugin-id"]||void 0===e["plugin-id"]||this._attrs["plugin-id"]===e["plugin-id"],"A single element cannot match multiple plugins")}catch(e){i.default.reportError(e)}var r=this._attrs["plugin-id"]||e["plugin-id"];r&&(this._attrs["plugin-id"]=r);var n=this._attrs.appLink||e.appLink;n&&(this._attrs.appLink=n);var s=this._attrs.tooltip||e.tooltip;s&&(this._attrs.tooltip=s)}else this._attrs=e},isMarkup:function(){return this.hasClass("mdMarkup")}};a(5).a.extend(r.prototype,n),t.a=r},function(e,t,a){"use strict";var i=a(0),r=a(23);function n(e){this._range=e,this._range||(this._range=r.a._getSelectionRange())}n.prototype={isValid:function(){return!!this._range},getNativeRange:function(){return this._range},getStartContainer:function(){return this._range.startContainer},getEndContainer:function(){return this._range.endContainer},getStartElement:function(){return i.default.getElementParent(this.getStartContainer())},getEndElement:function(){return i.default.getElementParent(this.getEndContainer())},getSelectOffsetsInElement:function(e){return r.a.getSelectOffsetsInElement(e,this._range)},getStartOffset:function(){return this._range.startOffset},getEndOffset:function(){return this._range.endOffset}},t.a=n},function(e,t,a){"use strict";a(7),a(0);function i(){this.softDays=["today","tomorrow"],this.dayModifiers=["next"],this.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.repeatStart=["every"],this.dict=this.repeatStart.concat(this.softDays).concat(this.dayModifiers).concat(this.days).concat(this.months),this.init()}i.prototype={init:function(){},findMatchLike:function(e){for(var t=e.toLowerCase(),a=[],i=0;i<this.dict.length;++i)0===this.dict[i].indexOf(t)&&a.push({type:"date",text:this.dict[i]});return a},findMatchExact:function(e){if(this.dict.indexOf(e)>=0)return{type:"date",text:e}}},t.a=i},function(e,t,a){"use strict";var i=a(0);a(7);function r(){this.items=[]}r.prototype={findMatchLike:function(e,t){var a=i.default.vmMain.itemStoreManager.getDefaultItemStore(),r=e.toLowerCase(),n=[];return i.default.searchVMLIs({itemStore:a,comparator:function(e){return!e.isComplete()},each:function(e){var a=!1;r?(e.getPrefix()+e.getSearchText()).indexOf(r)>=0&&(a=!0):a=e.isPrefixHeader();if(a&&n.push({type:"item",text:e.getParsedText(),item:e}),n.length>=t)return!1}}),n},findMatchExact:function(e,t){}},t.a=new r},function(e,t,a){"use strict";var i=a(0),r=a(1);function n(){this.accountID=void 0}n.prototype={setAccountID:function(e){this.accountID=e},findMatchLike:function(e,t){for(var a=i.default.vmMain.getDefaultEmailPlugin(),n=a.getLabels(this.accountID,e,t),s=[],o=0;o<n.length;++o)n[o].isSystemLabel()||s.insertSorted(n[o],a.labelSortFn);return s.map(function(e){return{type:r.a.AutocompleteMode.GmailLabel,text:e.getName(),label:e}})},findMatchExact:function(e,t){}},t.a=new n},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(11),s=a(5),o=a(58),l=a(7),d=a(17),c=a(15),u=a(78),h=a(10),f=a(4),p=(a(20),a(45)),m=(a(83),a(123)),g=(a(124),a(125),a(61),a(13),a(128)),v=a(144),y=a(146),S=a(149),E=a(151),P=a(153),b=a(154),C=a(27),D=(a(23),a(8)),I=a(18),A=a(9),M=a(14),_=(a(35),a(160)),T=a(31),w=a(26);t.a=function(){T.a.init();var e,t={_root:void 0,isLoaded:!1,isRendered:new A.a(!1),isInit:!1,_hasDisplayedArchivedItems:!1,gdriveStatusObs:new A.a(-1),isPhone:f.a.phone,help:void 0,lastActivity:Date.now(),cacheManager:o.a,recurringTaskManager:new S.a,deferredTaskManager:new E.a,itemStoreManager:new b.a,pluginManager:new g.a,paneManager:new v.a,paneFactory:p.a,docManager:new P.a,realtimeDocManager:new y.a,vmPicker:new m.a,_itemAnimationMode:r.a.ItemAnimationMode.Normal,isDisplaySettingsOpen:new A.a(!1),failedInitialDocLoad:new A.a(!1),activeInput:new A.a(null),_isShowingTrashedDocumentError:new A.a(!1),cursor:new A.a};i.default.vmMain=t,t.getUserEmail=function(){return M.a.getDefaultEmail()||i.default.getActiveUser()||void 0},Rollbar.configure({payload:{environment:f.a.getDeployVar(DeployVariable.Environment),person:{id:i.default.getUserIdentifier()},client:{javascript:{source_map_enabled:!0,code_version:__jsVersion,guess_uncaught_frames:!0}}},maxItems:__MAX_ERRORS_REPORTED,checkIgnore:i.default.rollbarIgnoreFn}),t.root=function(){return t._root},t.remoteAPI=function(){return t.pluginManager.getPlugin(PluginID.Moodo)},t.loadPlugins=function(){},t.getDefaultCalendarPlugin=function(){var e,a=t.pluginManager.getPlugin(PluginID.GCalendar);return(i.default.isDemoMode()||a.getSetting(a.Settings.IsEnabled))&&(e=a),e},t.showTrashedDocumentError=function(){t._isShowingTrashedDocumentError.set(!0),t.paneManager.clearLoadTimeout()},t.clearTrashedDocumentError=function(){t._isShowingTrashedDocumentError.set(!1)},t.notifyFailedLoad=function(){N||t.failedInitialDocLoad.set(!0)},t.notifySuccessfulLoad=function(){t.failedInitialDocLoad.set(!1),s.a.hasURLParam("sinfo")&&s.a.removeURLParam("sinfo")},t.getDefaultEmailPlugin=function(){return t.pluginManager.getPlugin(PluginID.Gmail)},t.isOnline=function(){return t.gdriveStatus()!==DriveStatus.Offline},t.isReconnecting=function(){return t.gdriveStatus()===DriveStatus.Reconnecting},t.isLocal=function(){return"localhost"===window.location.hostname},t.canRunUndoRedo=function(){return t.isOnline()||h.a.allowOfflineUndo},t.getUserName=function(){var e;if(t.isDemoMode())e="Demo";else{var a=d.a.authenticatedUser.get();e=a?a.displayName:i.default.settings.get(Settings.displayName)||void 0}return e},t.getUserDomain=function(){},t.getUserID=function(){return M.a.getDefaultGID()||i.default.settings.get(Settings.userId)||void 0},t.isDemoMode=function(){return i.default.isDemoMode()},t.onlineText=function(){var e=t.gdriveStatus();return(i.default.isDemoMode()?"DEMO":e===DriveStatus.Connecting&&"Syncing")||e===DriveStatus.Reconnecting&&"Syncing"||e===DriveStatus.Offline&&"OFFLINE"||e===DriveStatus.Saved&&d.a.isReadOnly()&&"READ ONLY"||e===DriveStatus.Saved&&"Saved"||""},t.handleGapiLoadError=function(){t.setGDriveStatus(DriveStatus.Offline),setTimeout(c.a.goOnline,3e4)},t.connectFailed=function(){t.setGDriveStatus(DriveStatus.Offline),e=void 0,c.a.ensureDocConnection()},t.gdriveStatus=function(){return t.gdriveStatusObs.get()},t.setGDriveStatus=function(a){var r=t.gdriveStatus();a!==r&&a!==DriveStatus.Saving&&(t.gdriveStatusObs.set(a),a===DriveStatus.Connecting||a===DriveStatus.Reconnecting?d.a.loadedOnce&&(clearTimeout(e),e=setTimeout(t.connectFailed,d.a.offlineTimeoutMS)):(clearTimeout(e),e=void 0),a===DriveStatus.Offline?(i.default.goOffline(),i.default.toasts.clearMessage(MessageID.CalendarSync)):r===DriveStatus.Offline&&i.default.goOnline())},t.init=function(){try{i.default.PAssert(739,!t.isInit,"Should never double init VMMain, may cause severe issues")}catch(e){i.default.reportError(e)}t.isInit=!0,i.default.settings._ensureRemoteSettings(),u.a.init(),w.a.init(),t.loadPlugins(),t.dropBucket=new _.a,i.default.intro.init(),n.a.fireEvent("VMMainLoaded",[]),n.a.listen("showArchived",function(){t._hasDisplayedArchivedItems||(t._hasDisplayedArchivedItems=!0,t.parseSubtreeArchive(t.root(),ChangeType.Auto))}),f.a.demo||(window.onbeforeunload=t.onUnload)},t.hasDisplayedArchivedItems=function(){return t._hasDisplayedArchivedItems},t.addModifiedItem=function(e,t,a){};var a={},k=!1,x=void 0;t.flushModifiedItems=function(){},t.addParseItem=function(e,t){try{i.default.PAssert(740,k,"Must be marked as queueing items")}catch(e){i.default.reportError(e)}try{i.default.PAssert(741,t===x,"ChangeType of queue must match")}catch(e){i.default.reportError(e)}a[e.id]=e},t.beginQueuedParseItems=function(e){try{i.default.PAssert(742,!k,"Should not be already queueing parse items")}catch(e){i.default.reportError(e)}k||(k=!0,x=e)},t.flushParseItems=function(){try{i.default.PAssert(743,k,"Must be marked as queueing items before flushing")}catch(e){i.default.reportError(e)}if(k){k=!1;try{for(var e in a){var r=a[e];t.runSingleParse(r,x)}}catch(e){i.default.reportError(e)}a={},x=void 0}},t.parseSubtree=function(e,a){try{i.default.PAssert(746,e,"Must supply a valid item to parse")}catch(e){i.default.reportError(e)}t.runSingleParse(e,a);for(var r=e.getItems(),n=0;n<r.length;n++)t.parseSubtree(r[n],a)},t.parseSubtreeArchive=function(e,a){try{i.default.PAssert(747,e,"Must supply a valid item to parse")}catch(e){i.default.reportError(e)}t.runSingleParse(e,a);for(var r=e.getItems(),n=0;n<r.length;n++)t.parseSubtreeArchive(r[n],a);if(e.hasArchivedChildren()){var s=e.archivedItems(!0);for(n=0;n<s.length;n++)t.parseSubtreeArchive(s[n],a)}},t.runFnOnSubtree=function(e,a){a(e);for(var i=e.getItems(),r=0;r<i.length;r++)t.runFnOnSubtree(i[r],a);if(e.hasArchivedChildren()){var n=e.archivedItems(!0);for(r=0;r<n.length;r++)t.runFnOnSubtree(n[r],a)}},t.runSingleParse=function(e,t){try{i.default.PAssert(754,e,"Must have a valid item to parse")}catch(e){i.default.reportError(e)}try{i.default.PAssert(755,!k,"Should not run single parse while queueing item parses")}catch(e){i.default.reportError(e)}var a={};e.parseText(!0,t,a)&&e.save(a,SaveFlag.None)},t.createWorkerFromObj=function(e,t,a){var r;try{(r=new Worker(e)).onmessage=t,r.onerror=a}catch(e){i.default.reportError(e)}return r},t.createWorkerFromFnList=function(e,a,r){try{i.default.PAssert(760,!f.a.ie,"IE does not support creating workers from blob URLs")}catch(e){i.default.reportError(e)}var n=[];try{for(var s=0;s<e.length;++s)n.push(window[e[s]].toString()),n.push(e[s]+"();")}catch(e){i.default.reportError(e)}return t.createWorkerFromStrings(n,a,r)},t.createWorkerFromStrings=function(e,a,i){var r=f.a.URL.createObjectURL(new Blob(e,{type:"text/javascript"}));return t.createWorkerFromObj(r,a,i)};var L=0,O=0,R=void 0;t.runDateRollover=function(){try{i.default.PAssert(761,t.isLoaded,"Expect that we have fully loaded the page before performing rollover")}catch(e){i.default.reportError(e)}var e=L-new Date;function a(){t.root()&&t.parseSubtree(t.root(),ChangeType.Auto|ChangeType.Rollover),C.a.clearItemCache(),C.a.clearLineCache(),t.updateAllItems(!1,!0),i.default.timeline.updateNotifications(),log("-------------------------------")}if(log("---- Running Date Rollover: "+e+" ----"),O=new Date,L=0,clearTimeout(R),R=void 0,t.setupDateRollover(),Date.Parsing.Normalizer.buildReplaceData(),i.default.timeline.clearDailyCaches(),i.default.settings.get(Settings.syncContacts)){var r=setTimeout(function(){a()},1e4);c.a.loadedContacts=!1,c.a.loadContacts(function(){clearTimeout(r),r=void 0,a()})}else a();n.a.fireEvent("dateChanged",[])},t.setupDateRollover=function(){try{i.default.PAssert(762,!R,"Should never reschedule a date rollover over another one")}catch(e){i.default.reportError(e)}var e=new Date,a=e.clone().addDays(1).clearTime();try{i.default.PAssert(763,a>e,"Rollover time must be in the future")}catch(e){i.default.reportError(e)}try{i.default.PAssert(764,a>O,"Rollover time must be after the last rollover")}catch(e){i.default.reportError(e)}log("Rollover Run Time: ",e),log("Next Rollover Time: ",a),R=setTimeout(t.runDateRollover,a-e),L=a},t.ensureDateRollover=function(){setTimeout(function(){var e=new Date;L-e<0&&t.runDateRollover()},1e4)};var N=!1;t.notifyDriveDisconnect=function(){N=!1,h.a.resetAggregateActionCount()},t.notifyDriveOperationError=function(){h.a.resetAggregateActionCount()},t.loadGDriveData=function(){if(!N){try{i.default.PAssert(780,l.a.localDataLoaded(),"Must have already loaded local data from db")}catch(e){i.default.reportError(e)}try{i.default.PAssert(781,!0===i.default.vmMain.isLoaded,"Must have already loaded local data")}catch(e){i.default.reportError(e)}N=!0,t.selectionOnLoad=D.a.save();var e,a=d.a.rootItem;try{if(!t.root()){l.a.createRootItem(a.id);var r=l.a.createVMLI(l.a.getRootItem(),{changeType:ChangeType.Auto,isRoot:!0});i.default.vmMain.itemStoreManager.getDefaultItemStore().setRoot(r),t._root=r}t.root().linkToGDrive(a)}catch(e){i.default.reportError(e),i.default.menus.alert({text:"There was a fatal error in the application. Please reload to try again.",actionText:"RELOAD",callback:i.default.reload})}try{d.a.checkRemoteIntegrity()}catch(e){i.default.reportError(e)}D.a.isValid()&&(e=D.a.save(),D.a.reset()),i.default.vmMain.beginUpdateItems(),function(e){i.default.isLoadingRemote=!0;try{l.a.beginTransaction(),i.default.settings.get(Settings.lastServerVersion)===d.a.getServerVersion()?(log("Client and Server Versions Match!"),i.default.sendEvent("PageLoad","VersionMatch")):i.default.sendEvent("PageLoad","VersionDiff"),h.a.beginAction(!0),!1===i.default.settings.get(Settings.localIntegrity)&&(ShouldLog(LogLevels.Warning)&&log("Previous remote sync had an issue!"),i.default.reportError(new Error("Previous remote sync had an issue!"))),d.a.loadSeen={},t.beginQueuedParseItems(ChangeType.Remote|ChangeType.DocLoad|ChangeType.All),i.default.settings.set(Settings.localIntegrity,!1),t.root().initFromGDrive(e),i.default.settings.set(Settings.localIntegrity,!0),d.a.loadSeen={},h.a.endAction(),ShouldLog(LogLevels.Timing)&&log("Drive done init",log.now()),t.flushParseItems(),t.flushModifiedItems(),log("Pending Updates: "+Object.keys(l.a.pendingRemoteUpdates).length),n.a.fireEvent("remoteDataLoaded",[]),setTimeout(function(){},5e3)}catch(e){i.default.reportError(e),i.default.toasts.pushMessage({text:"There was an error loading your data from the server. Please try again.",action:MessageAction.Reload})}finally{l.a.endTransaction(),i.default.isLoadingRemote=!1}}(a),i.default.vmMain.commitUpdateItems(),d.a.lastChangeTime.set(Date.now()),e&&D.a.restore(e),n.a.fireEvent("gdataLoaded",[]),t.vmPicker.refreshFiles()}};var F,U=!1;t.loadDemoContacts=function(e){for(var t,a,i=[],r=0,n=0;n<e.length;n++)t=e[n],a="test-"+t.split(" ")[0].toLowerCase()+"@moo.do",i.push({id:"contact_"+r++,name:t,isDemo:!0,emails:[{address:a,primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]});l.a.contactManager.loadContacts(i,!0)},t.loadData=function(){if(!U){try{i.default.PAssert(782,l.a.localDataLoaded(),"Must have already loaded local data")}catch(e){i.default.reportError(e)}if(ShouldLog(LogLevels.Timing))var e=log.now();if(U=!0,t.isDemoMode()&&t.loadDemoContacts(["Jay","Grant","Ramada","Canyon Ranch","Jim Joseph","Miller Harris","Bob Johnson","Bill Wilson","Emily Edwards","Jane Johnson","Mike Thomas","Joe Lewis","Steve","Melissa","Mikey","Bart","Dad","Mom","James Rhodes","Neptures","Pepper","President Ellis","Contacts","Jane"]),l.a.getRootItem()){i.default.vmMain.beginUpdateItems();var a=l.a.createVMLI(l.a.getRootItem(),{changeType:ChangeType.Auto,isRoot:!0});i.default.vmMain.itemStoreManager.getDefaultItemStore().setRoot(a),t._root=a,i.default.vmMain.commitUpdateItems()}i.default.checkpoint(Checkpoint.LocalDocLoad),t.isLoaded=!0,i.default.requireGDriveDataCallback&&t.loadGDriveData(),ShouldLog(LogLevels.Timing)&&log("Run loading/parseWorker",log.now()),i.default.vmSetup.initDemo(),setTimeout(function(){t.isDemoMode()&&(f.a.script&&i.default.vmSetup.runScript(s.a.getURLParam("script")),window.parent.postMessage("loaded","*"))},0),l.a.getRootItem()?t.afterLoaded():n.a.listen("gdataLoaded",function(){t.afterLoaded()}),t.isDemoMode()&&f.a.script&&i.default.setupClick(document.getElementById("container"),t,t.onTapMain),t.isRendered.set(!0),f.a.app&&i.default.nativeBridge.sendToApp("localLoaded"),t.pluginManager.notifyDependencyLoad(PluginDependency.LocalLoaded),ShouldLog(LogLevels.Timing)&&(log("DONE LOCALLY",log.now()),setTimeout(function(){var t=log.now();log("time react:",t-e,t)},0))}},t.changeRoot=function(e){try{i.default.PAssert(783,e,"Cannot use to reset root to undefined")}catch(e){i.default.reportError(e)}var a=l.a.getModel(e);a||(a=l.a.createVMLI(l.a.getItem(e),{changeType:ChangeType.Auto,isRoot:!0}));try{i.default.PAssert(784,a,"Must have a new root VMLI at this point, otherwise failed creation")}catch(e){i.default.reportError(e)}a&&(t.itemStoreManager.getDefaultItemStore().setRoot(a),t._root=a,t.paneManager.runForEachPane(function(e){D.a.reset(),e.setItem(a)}))},t.resetScrollOffsets=function(){t.paneManager.runForEachPane(function(e){e.setScrollOffset(e.defaultOffset)})},t.onTapMain={onStart:function(){i.default.fireCustomEvent("tapMain")},onClick:function(){try{i.default.PAssert(785,t.isDemoMode()&&f.a.script,"Tap handler should only be active on demo page")}catch(e){i.default.reportError(e)}window.parent.postMessage("click","*")}},t.afterLoaded=function(){t.paneManager.loadInitialState(),f.a.app&&(document.onreadystatechange=function(){i.default.nativeBridge.sendToApp("loaded")},document.onreadystatechange()),i.default.timeline.updateNotifications()},t.zoomin=function(e,a,r){try{i.default.PAssert(788,e,"Must supply a valid item to zoom to")}catch(e){i.default.reportError(e)}var n=i.default.focusedPane,s=n&&n.item.get();if(t._zoom(e,a),e.isDemandLoad()&&e.notifyDemandLoadUpdate(!0,n),a||i.default.sendEvent("Menu","ZoomIn"),n.paneContent&&n.isWriteable){var o=n.indexOfFirstItem();o>=0?D.a.selectIndex(o,0,0):D.a.reset()}n.isLoaded&&n.onZoom(),a||h.a.performAction(TrackerType.Zoom,{itemID:e.id,oldItemID:s.id,zoomIn:!0,time:i.default.zoomTime,pane:n}),r&&i.default.toasts.pushMessage({text:"Zoomed into "+e.getParsedTextWithoutPrefix(),actionText:"UNDO",hold:!1,action:function(){t.zoomin(s)}.bind(this)})},t.zoomout=function(e,a){try{i.default.PAssert(789,e,"Must supply a valid item to zoom to")}catch(e){i.default.reportError(e)}var r=i.default.focusedPane,n=r&&r.item.get(),s=D.a.save();if(t._zoom(e,!1),i.default.sendEvent("Menu","ZoomOut"),r.isWriteable&&s){for(var o=s.startItem,l=s.startOffset,d=s.endItem,c=s.endOffset;o&&r.indexOfItem(o)<0;)o=o.parent(),l=0;o&&(r.indexOfItem(s.endItem)<0&&(d=o,c=l),D.a.selectItems(o,l,d,c),r.scrollItemToMiddle(o,ScrollDuration.Snap))}a||h.a.performAction(TrackerType.Zoom,{itemID:e.id,oldItemID:n.id,zoomOut:!0,time:i.default.zoomTime,pane:r})},t._zoom=function(e,a){try{i.default.PAssert(790,e,"Must supply a valid item to zoom to")}catch(e){i.default.reportError(e)}var r=i.default.focusedPane,n=r&&r.item.get();n&&n.id===e.id||(D.a.reset(),r.setItem(e,!0),i.default.focusedItem=e,a||t.paneManager.updatePaneStateForPane(i.default.focusedPane))},t.applyFormatToSelection=function(e){var a,n,s=!1;i.default.vmMain.setItemAnimationMode(r.a.ItemAnimationMode.None),t.applyToSelection(function(t,i,o){var l=0===i?D.a.getStartOffset():0,d=i===o-1?D.a.getEndOffset():t.getParsedText().length,c=t.applyFormatToSelection(e,l,d,0===i?r.a.SetMode.Toggle:s?r.a.SetMode.Yes:r.a.SetMode.No);0===i&&(s=c.didSet,a=c.selStart),i===o-1&&(n=c.selEnd)}),D.a.selectIndices(D.a.getStartIndex(),a,D.a.getEndIndex(),n),i.default.vmMain.resetItemAnimationMode()},t.applyPrefixToSelection=function(e,a){var i,r;if(D.a.isValid()&&(i=D.a.getStartItem().getPrefixLength(),r=D.a.getEndItem().getPrefixLength()),a)e=a.prefix===e?null:e,a.setPrefix(e);else{var n=!0;t.applyToSelection(function(t){if(t.prefix!==e)return n=!1,!1}),n&&(e=null),t.applyFnToSelection("setPrefix",{value:e})}if(!isNaN(i)){var s=D.a.getStartItem().getPrefixLength()-i,o=D.a.getEndItem().getPrefixLength()-r;s||o?D.a.selectIndices(D.a.getStartIndex(),D.a.getStartOffset()+s,D.a.getEndIndex(),D.a.getEndOffset()+o):D.a.updateCaret()}},t.applyFnToSelection=function(e,a){var r=D.a.save(),n=a&&a.toggle,s=!a||void 0===a.value||a.value,o=a&&void 0!==a.value2?a.value2:void 0;if(t.applyToSelection(function(t){n&&t[e]()!==s&&(n=!1),n||t[e](s,o)}),n){var l=l=!(!a||void 0===a.emptyValue)&&a.emptyValue;t.applyToSelection(function(t){t[e](l,o)})}r&&i.default.focusedPane.restoreSelection(r)},t.applyToSelection=function(e,a){try{i.default.PAssert(791,!a||!a.restoreSelection,"restoreSelection is no longer a valid option")}catch(e){i.default.reportError(e)}h.a.beginAction();var r=D.a.getSelectedItems();a&&a.resetSelection&&D.a.reset(),t.beginUpdateItems();for(var n=0;n<r.length&&!1!==e(r[n],n,r.length);++n);return t.commitUpdateItems(),h.a.endAction(),r.length},t.updateCursorFromEvent=function(e){if(F){var a=F.target;if(a&&i.default.isAttachedToDoc(a)){var r=i.default.getPaneForElement(a);if(r){var n=i.default.elementFromPoint(F.clientX,F.clientY,F.target);if(n){var s=i.default.dataFor(n,!0);i.default.isVMLI(s)||(s=void 0),t.updateCursor(e,r,n,s)}}}}},t.getCursorForClass=function(e,t,a){for(var i=e.classList,r=0;r<i.length;r++)switch(i[r]){case"link":case"date":case"plugin":return f.a.mac&&t.metaKey||!f.a.mac&&t.ctrlKey?"cursor-pointer":null}if(a)return"cursor-pointer"},t.updateCursor=function(e,a,n,s){var o;if(a&&n){if(s&&i.default.isVMLI(s)){var l=i.default.findParentInItem(n,"plugin");l&&(n=l)}var d=!!i.default.findParent(n,"paneOverviewScroller");if(!D.a.isMouseDown()&&!(o=t.getCursorForClass(n,e,d))){var c=i.default.findParent(n,"itemInCalendarResizable");if(c){var u=c.getBoundingClientRect(),h=Math.min(r.a.CalendarResizeHandleHeight,u.height/3);(e.clientY-u.top<h||u.bottom-e.clientY<h)&&(o="cursor-row-resize")}}}t.cursor.set(o)},f.a.touch||(t.redoLastMouseMove=function(){var e=F,a={target:document.elementFromPoint(e.clientX,e.clientY),clientX:e.clientX,clientY:e.clientY};t.mousemove(a,!0)},t.mousemove=function(e,a){if(t.notifyActivity(),!(i.default.disableMouseMove&&!e.target||!a&&F&&e.clientX===F.clientX&&e.clientY===F.clientY||I.a.isDragging)){var r,s,o,l=i.default.ensureDOMNode(e.target);if(l)(i.default.findParent(l,"paneRoot")||i.default.findParent(l,"paneOverviewScroller"))&&(o=i.default.getPaneForElement(l))&&(r=i.default.dataFor(l,!0),i.default.isVMLI(r)?s=i.default.getReactCellForElement(l):r=void 0),t.updateCursor(e,o,l,r),D.a.setHovered(o,r,s),F&&F.target===l||(F&&F.target&&n.a.fireEvent("mouseout",[{target:F.target}]),l&&n.a.fireEvent("mouseover",[{clientX:e.clientX,clientY:e.clientY,target:l}])),F={clientX:e.clientX,clientY:e.clientY,target:l};else try{i.default.PAssert(792,!l,"Target should be defined",i.default.getElementPath(e.target))}catch(e){i.default.reportError(e)}}},i.default.element("outerWrapper").addEventListener("mousemove",t.mousemove)),t.showHelp=function(e){i.default.intro.show(e)},t.runAfterWelcome=function(){t.paneManager.createDefaultPane(),i.default.intro.runTooltipIntro()},t.runFirstRun=function(){f.a.isMailbirdSidebar()?setTimeout(function(){t.paneManager.createPaneAtIndex(PaneMode.Task,void 0,{isDefaultPane:!0})},500):i.default.menus.openModalNew(Modals.Welcome,{callback:t.runAfterWelcome})},t.oldUserNewTrial=function(){i.default.toasts.pushMessage(MessageID.OldUserNewTrial)};var B=void 0;var V=void 0,H=i.default.seconds(5);t.notifyActivity=function(){t.lastActivity=Date.now(),V||(V=setTimeout(t.checkLowActivity,2*H)),t.whenLowImpactEnd()},t.checkLowActivity=function(){Date.now()-t.lastActivity>H&&t.whenLowImpactBegin(),V=void 0};var q=!1;if(t.whenLowImpactBegin=function(){q||(q=!0,n.a.fireEvent("lowImpactBegin",[]))},t.whenLowImpactEnd=function(){q&&(n.a.fireEvent("lowImpactEnd",[]),q=!1)},t.isLowImpact=function(){return q},t.isDemoMode()||(f.a.pageVisibilityChange&&document.addEventListener(f.a.pageVisibilityChange,function(){f.a.isPageVisible()?(B&&(clearTimeout(B),B=void 0),t.whenLowImpactEnd()):B=setTimeout(function(){i.default.AppCache.checkForUpdate(!1,!0),i.default.vmMain.pluginManager.writeCaches(),t.whenLowImpactBegin()},5e3)}),window.applicationCache&&setTimeout(function e(){Date.now()>t.lastActivity+i.default.minutes(90)&&i.default.AppCache.checkForUpdate(!1,!0),setTimeout(e,i.default.minutes(90))},i.default.minutes(90)),t.checkLowActivity()),t.paneManager.onResize(),i.default.shouldWriteLocal()){var G="versionDesktop",z=+s.a.storage.getItem(G),W=f.a[G];if(!i.default.isFirstRun&&!i.default.isDemoMode()&&(!z||W>z))for(var j=f.a.getUpdateMessages(z),K=0;K<j.length;++K)if(i.default.isString(j[K]))i.default.toasts.pushMessage({text:j[K],hold:!0,action:MessageAction.Blog});else{try{i.default.PAssert(793,i.default.isFunction(j[K]),"Must supply a valid getter fn for the message")}catch(e){i.default.reportError(e)}var Y=j[K]();Y.isPremiumOnly&&!i.default.billingManager.hasPremium()||i.default.toasts.pushMessage({text:Y.text,hold:!0,action:Y.action||MessageAction.Blog,actionText:Y.actionText})}s.a.storage.setItem(G,W)}function X(){log("Last Update Items Stack: "+t._lastUpdateItemsStack);try{i.default.PAssert(796,!1,"Update Watchdog Triggered - This should never happen.",t._isWaitingUpdateItems)}catch(e){i.default.reportError(e)}t._isWaitingUpdateItems=1,t.commitUpdateItems()}return f.a.displayRepeatedOptionalUpdateMessage(),t._updateAllItems=function(){var e=t._forceNotify;t._forceNotify=!1;var a=t._updateSearch;t._updateSearch=!1,(t._itemsDirty||e)&&(t._itemsDirty=!1,t._isUpdating=!0,t.paneManager.runForEachPane(function(t){(e||t.isItemsDirty())&&t.updateItemsImmediate(a,e)}),t._isUpdating=!1)},t._isSearching=!1,t._isUpdating=!1,t._numFlushesInCommit=0,t._isWaitingUpdateItems=0,t._itemsDirty=!1,t._forceNotify=!1,t._updateSearch=!1,t._itemsUpdateWatchdog=void 0,t._lastUpdateItemsStack=void 0,t.isUpdatingItems=function(){return t._isWaitingUpdateItems>0&&t._itemsDirty},t.beginUpdateItems=function(){t._isWaitingUpdateItems++,1===t._isWaitingUpdateItems&&(t._lastUpdateItemsStack=i.default.getCurrentStack("Update Items Stack"),t._itemsUpdateWatchdog=setTimeout(X,0))},t.commitUpdateItems=function(e,a){try{i.default.PAssert(799,t._isWaitingUpdateItems>0,"Missing a call to beginUpdateItems: ",t._isWaitingUpdateItems)}catch(e){i.default.reportError(e)}t._isWaitingUpdateItems--,0===t._isWaitingUpdateItems&&(clearTimeout(t._itemsUpdateWatchdog),t._itemsUpdateWatchdog=void 0,t._lastUpdateItemsStack=void 0,t._numFlushesInCommit=0),t._itemsDirty&&t.updateAllItems(e,a)},t.flushItemsUpdate=function(e){t.isUpdatingItems()&&(e?e.isItemsDirty()&&(t._itemsDirty||t._forceNotify)&&(t._numFlushesInCommit++,e.updateItemsImmediate(t._updateSearch,t._forceNotify)):(t._numFlushesInCommit++,t._updateAllItems()))},t.updateAllItems=function(e,a){try{i.default.PAssert(800,void 0===e||i.default.isBoolean(e),"Must supply a bool param for updateSearch")}catch(e){i.default.reportError(e)}try{i.default.PAssert(801,void 0===a||i.default.isBoolean(a),"Must supply a bool param for forceNotify")}catch(e){i.default.reportError(e)}t._itemsDirty=!0,a&&(t._forceNotify=a),e&&(t._updateSearch=e),0===t._isWaitingUpdateItems&&t._updateAllItems()},t.notifySearchStart=function(){t._isSearching=!0},t.notifySearchEnd=function(){t._isSearching=!1},t.getItemAnimationMode=function(){return t._itemAnimationMode},t.setItemAnimationMode=function(e){t._itemAnimationMode=e},t.resetItemAnimationMode=function(){t._itemAnimationMode=r.a.ItemAnimationMode.Normal},t.getScrollOffset=function(){return t.panesContainer.scrollLeft},t.setScrollOffset=function(e,a){i.default.scrollTo(e,0,a||ScrollDuration.Default,t.panesContainer)},t.shouldShowHelp=function(e){var t=i.default.settings.get(Settings.closedHelps);return!t||!t[e]},t.closeHelp=function(e){var t=i.default.settings.get(Settings.closedHelps)||{};t[e]=!0,i.default.settings.set(Settings.closedHelps,t)},t.uncloseHelp=function(e){var t=i.default.settings.get(Settings.closedHelps)||{};delete t[e],i.default.settings.set(Settings.closedHelps,t)},t.beginCompleteAction=function(){t._isInCompleteAction=!0},t.isInCompleteAction=function(){return t._isInCompleteAction},t.endCompleteAction=function(){t._isInCompleteAction=!1},t.onUnload=function(){log("Unloading the page");try{var e,a=i.default.getAggregateEvents();for(var r in a)if(a.hasOwnProperty(r)){var s=a[r];i.default.sendEvent(s.category,s.action,s.count),s.count=0}if(i.default.failedGapiLoad?i.default.sendEvent("ScriptLoad","GapiFailed"):window.gapiCalled||i.default.sendEvent("ScriptLoad","GapiNotLoaded"),n.a.fireEvent("onUnload",[]),i.default.settings.get(Settings.gdocId)&&t.paneManager.savePaneState(),i.default.hasPageDataBeenCleared())t.pluginManager&&(e=t.pluginManager.onShutdown(!1));else{t&&t.pluginManager&&(e=t.pluginManager.onShutdown(!0));try{d.a&&i.default.settings&&i.default.settings.set(Settings.lastServerVersion,d.a.getServerVersion())}catch(e){}}if(i.default.UIAction("PageUnload"),i.default.isLoadingRemote)return"We are still syncing your changes. Do you still want to quit?";if(i.default.isSendingEmail)return"Some emails have not been sent. Closing Moo.do will stop them from sending. Do you still want to quit?";if(i.default.isSavingDrafts)return"Your drafts are still being saved. Do you still want to quit?";if(d.a&&d.a.hasPotentialUnsavedData()&&!i.default.hasPageDataBeenCleared())return"You have made changes that have not been saved to the server. Do you still want to quit?";if(e)return e[0]}catch(e){i.default.reportError(e)}},t.getAppInfo=function(e){var a="Loaded";i.default.failedGapiLoad?a="ErrorLoading":window.gapiCalled||(a="NotLoaded");var r=Date.now();e.gapiStatus=a,e.gapiTimeout=window.gapiTimeout,e.sessionID=window.__SESSION_ID,e.sessionStart=window.__SESSION_BEGIN,e.reportTime=r,e.runningTime=r-window.__SESSION_BEGIN,e.appCacheUpdated=i.default.wasAppCacheUpdated,e.realtimeLoadStatus=this.computeRealtimeLoadStatus(),f.a.getPlatformInfo(e),t.getRunningState(e),t.getAppStats(e),t.getPremiumInfo(e);try{d.a.getState(e)}catch(t){e.gState="ERROR"}try{c.a.getTokenStats(e)}catch(t){e.tokenStats="ERROR"}try{c.a.getOAuthData(e)}catch(t){e.oauthData="ERROR"}try{l.a.getDBState(e)}catch(t){e.dbState="ERROR"}try{if(window.gapi&&window.gapi.auth){var n=gapi.auth.getToken();n?(e.tokenScope=n.scope,e.hasIDToken=!!n.id_token):(e.tokenScope="NO TOKEN",e.hasIDToken="NO TOKEN")}else e.tokenScope="NOT LOADED"}catch(t){e.tokenScope="ERROR"}try{e.linkedAccounts=M.a.getInfo()}catch(t){e.linkedAccounts="ERROR"}try{e.cacheState=o.a.getInfo()}catch(t){e.cacheState="ERROR"}},t.getRunningState=function(e){var a;try{t.paneManager.hasLoadedPaneState()&&(a=t.paneManager.getPaneState())}catch(e){log("Failed to get paneState")}e.isDebug=!1,e.isDemo=i.default.isDemoMode(),e.localWrites=i.default.shouldWriteLocal(),e.authUserLoggedIn=i.default.authUserLoggedIn,e.currentLocalWrites=function(){try{s.a.storage.setItem("poke",Math.random())}catch(e){return!1}return!0},e.isReconnected=i.default.isReconnected,e.url=i.default.sanitizeURL(window.location.href),e.paneState=a?i.default.sanitizePaneState(a):"Missing Pane State",e.localSettings=i.default.settings?i.default.sanitizeLocalSettings(i.default.settings.getRawSettings()):"Not Initialized",e.remoteSettingsLoaded=!!i.default.settings&&i.default.settings.hasLoadedRemote(),e.loginState=i.default.getLoginState(),e.checkpoints=window.__checkpoints,e.gapiLoadError=window.gapiLoadError,e.gapiTimeout=window.gapiTimeout,e.gapiClientLoadError=window.gapiClientLoadError,e.gapiClientTimeout=window.gapiClientTimeout,e.DOMReadyState=document.readyState,e.isKeyboardOpen=i.default.isKeyboardOpen,e.localStorageQuotaError=s.a.localStorageQuotaError,e.jsVersion=window.__jsVersion,e.htmlVersion=document&&document.body?document.body.getAttribute("ver"):"UNKNOWN",e.windowWidth=window.innerWidth,e.windowHeight=window.innerHeight,e.eventStream=i.default.getEventStream(),e.trackerStream=h.a.stringifyGroups(),e.criticalErrorReported=i.default.criticalErrorReported(),i.default.getLoadedScripts(e);try{e.nativesel=i.default.parseExtra(window.getSelection())}catch(t){e.nativesel="Error: "+t.message}try{e.apiStats=i.default.getGoogleAPIStats()}catch(t){e.apiStats="Error: "+t.message}try{e.customsel=D.a.dumpState()}catch(t){e.customsel="Error: "+t.message}try{e.errorPlatformInfo=JSON.stringify(i.default.errorPlatformInfo)}catch(t){e.errorPlatformInfo="Error: "+t.message}try{e.validScreens=JSON.stringify(window.Screens)}catch(t){e.validScreens="Error: "+t.message}e.isBatchingUpdateItems=t.isUpdatingItems(),e.lastActivity=t.lastActivity,t.root()?e.rootId=t.root().id:e.rootId="Undefined Root"},t.getPremiumInfo=function(e){if(i.default.billingManager){var t={premiumStatus:i.default.billingManager.getPremiumStatus(),billingIdentifier:i.default.billingManager.getBillingIdentifier(),btRequested:i.default.billingManager._braintreeRequested,btLoaded:i.default.billingManager._braintreeLoaded,ctRequested:i.default.billingManager._clientTokenRequested,ctLoaded:i.default.billingManager._clientTokenLoaded,lastSignupError:i.default.billingManager._lastSignupError};e.premiumInfo=t}else e.premiumInfo="Billing Manager Not Loaded"},t.computeRealtimeLoadStatus=function(){return{gapi:!!window.gapi,auth:!(!window.gapi||!window.gapi.auth),client:!(!window.gapi||!window.gapi.client),drive:!(!window.gapi||!window.gapi.drive),realtime:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime),load:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime&&i.default.isFunction(window.gapi.drive.realtime.load))}},t.getAppStats=function(e){if(e.numPanes=window.__TOTAL_PANES,e.numItems=window.__TOTAL_ITEMS,e.numArchivedItems=window.__TOTAL_ARCHIVED_ITEMS,e.numArchiveParents=window.__TOTAL_ARCHIVE_PARENTS,e.parseTextCalls=window.__PARSE_STATS,e.textChangedUpdates=window.__TEXT_CHANGED_UPDATES,e.notificationUpdatesFull=window.__FULL_NOTIFICATION_UPDATES,e.notificationUpdatesSingle=window.__SINGLE_NOTIFICATION_UPDATES,e.XHRStats=i.default.getXHRStats(),t.pluginManager){try{e.pluginStats=t.pluginManager.getStats()}catch(t){e.pluginStats="Error: "+t.message}try{e.pluginState=t.pluginManager.getState()}catch(t){e.pluginState="Error: "+t.message}}if(t.recurringTaskManager)try{e.taskStats=t.recurringTaskManager.getStats()}catch(t){e.taskStats="Error: "+t.message}try{e.measureStats=C.a.getMeasureStats()}catch(t){e.measureStats="Error: "+t.message}},t.XHR_PrivateAPI=function(e){try{i.default.PAssert(804,e.type,"Must supply a valid type")}catch(e){i.default.reportError(e)}try{i.default.PAssert(805,e.path&&e.path.startsWith("/"),"Must supply a valid path"+e.path)}catch(e){i.default.reportError(e)}var a=f.a.getDeployVar(DeployVariable.APIProtocol),r=f.a.getDeployVar(DeployVariable.APIHost);if(e.requireAuth){try{i.default.PAssert(806,M.a.isCurrentlyAuthorized("me"),"Must have a valid auth token before making API calls")}catch(e){i.default.reportError(e)}if(!M.a.isCurrentlyAuthorized("me"))return void M.a.onUserAuthorized("me",function(){t.XHR_PrivateAPI(e)});var n=M.a.getDefaultIDToken();try{i.default.PAssert(807,n,"Must have a valid ID token")}catch(e){i.default.reportError(e)}var s=M.a.getDefaultAccessToken();try{i.default.PAssert(808,s,"If account is authorized it must have a valid token")}catch(e){i.default.reportError(e)}var o=M.a.getAccountGID("me");try{i.default.PAssert(809,o,"If account is authorized it must have a valid GID")}catch(e){i.default.reportError(e)}var l=M.a.getAccountTokenSync("me");try{i.default.PAssert(810,M.a.isTokenValid(l),"Must have a valid account token: ",l)}catch(e){i.default.reportError(e)}e.headers||(e.headers={});try{i.default.PAssert(811,!e.headers.token,"Callers should not be setting access token themselves")}catch(e){i.default.reportError(e)}try{i.default.PAssert(812,!e.headers.id_token,"Callers should not be setting id_token themselves")}catch(e){i.default.reportError(e)}try{i.default.PAssert(813,!e.headers.gid,"Callers should not be setting user GID themselves")}catch(e){i.default.reportError(e)}n&&(e.headers.id_token=n),e.headers.token=s,e.headers.gid=o}var d={type:e.type,url:a+r+"/private/v1"+e.path,data:e.data,cb:e.cb,headers:e.headers,autoRetry:e.autoRetry,maxRetries:e.maxRetries};i.default.XHR(d)},t.reportData=function(e){l.a.reportData(e)},t.pluginManager.registerPlugins(),t.init(),t}},function(e,t,a){"use strict";var i=a(0),r=a(24),n=a(5),s=(a(4),a(10)),o=a(18),l=a(9),d=a(59),c=a(8),u=a(11);a(37);function h(e,t){this.pane=e,this.root=e.getRootItem(),this.contentElement=void 0,this._scrollListenerAttached=!1,this.isVisible=new l.a(!!t);this.transform=new l.a(-1),this.cursor=new l.a,this.topItem=void 0,this.dragHoverItem=void 0,this._infiniteList=new d.a({pane:e,isOverview:!0,itemsObs:e.headers,itemsFn:e.getHeaders,widthFn:e.getWidth,heightFn:e.getHeight,minItemSize:this.getMinItemSize}),this.init()}h.prototype={init:function(){n.a.forceBind("onPaneScroll",this),n.a.forceBind("onPaneItemsUpdated",this),u.a.listen("itemsUpdated",this.onPaneItemsUpdated)},destroy:function(){this.pane=void 0,u.a.unlisten("itemsUpdated",this.onPaneItemsUpdated),n.a.destroy(this)},onPaneLoad:function(){this.pane.overviewTracksScroll&&this.isVisible.get()&&this._attachScrollListener()},getInfiniteList:function(){return this._infiniteList},getContentElement:function(){return this.contentElement},onTapSection:function(e){i.default.vmMain.vmPicker.onTapSection(e)},getScrollOffset:function(){this._infiniteList.getScrollOffset()},refreshScrollListener:function(){this._infiniteList.refreshScrollListener()},onTap:{onStart:function(e){if(i.default.findParent(e.target,"overviewList")){var t=i.default.getItemForElement(e.target);t&&(o.a.startDragItem=t)}},onMove:function(e){var t=o.a.startDragItem||o.a.dragItem;t&&t.checkDragOnMove(e,!0)},onClick:function(e){var t,a=this.pane,r=i.default.dataFor(e.target),n=i.default.getElementParent(e.target);if(n&&r!==a&&r!==this&&i.default.findParent(e.target,"overviewList")){i.default.getPaneObjectForElement(e.target),t=i.default.getItemForElement(e.target);try{i.default.PAssert(1536,t,"Element in overview was text but was not an item")}catch(e){i.default.reportError(e)}}if(t){try{i.default.PAssert(1537,n,"Item must have an overview element: "+(t.getRawText?t.getRawText():"not an item"))}catch(e){i.default.reportError(e)}if(n)e.clientX-i.default.offset(n).left<a.getPaddingForPaneObject(t,!0)?t.setCollapsed(!t.isCollapsed(a,!0),a,!0):i.default.hasClass(e.target,"overviewOptions")?(i.default.menus.openContextMenu({componentName:"ReactContextMenuOverviewOptions",key:"menu"+t.id+e.clientX+e.clientY,element:e.target,item:t,pane:a,pos:{left:e.pageX,top:e.pageY}}),e.preventDefault(),e.stopImmediatePropagation()):this.pane.allowZoom(t)?(i.default.vmMain.zoomin(t),i.default.sendEvent("Menu","OverviewZoom")):this.pane.performOverviewAction(t)}e.preventDefault()},onEnd:function(e){var t=o.a.startDragItem||o.a.dragItem;t&&t.checkDragOnEnd(e)}},scrollItemIntoView:function(e){this._disablePaneScrollListener=!0;for(var t=e;t&&t!==this.pane.getItem();){if(this.pane.indexOfItem(t)>=0){this.pane.scrollItemToTop(t,ScrollDuration.Default);break}t=t.parent()}this.updateTopPaneItem(e),setTimeout(function(){this._disablePaneScrollListener=!1}.bind(this),2*ScrollDuration.Default)},setVisibility:function(e){e&&c.a.reset(),e!==this.isVisible.get()&&(this.isVisible.set(e),u.a.fireEvent("panesChanged",[]),i.default.vmMain.paneManager.updatePaneStateForPane(this),this.pane.overviewTracksScroll&&(e?this._attachScrollListener():this._detachScrollListener()))},_attachScrollListener:function(){try{i.default.PAssert(1538,!this._scrollListenerAttached,"Must not double attach scroll listener")}catch(e){i.default.reportError(e)}this._scrollListenerAttached||(this.pane.addScrollListener(this.onPaneScroll),this.onPaneScroll(),this._scrollListenerAttached=!0)},_detachScrollListener:function(){try{i.default.PAssert(1539,this._scrollListenerAttached,"Must only detach overview listener when already attached")}catch(e){i.default.reportError(e)}this._scrollListenerAttached&&(this.pane.removeScrollListener(this.onPaneScroll),this._scrollListenerAttached=!1)},toggleDesktop:function(){this.isVisible.get()?this.setVisibility(!1):this.setVisibility(!0),s.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOverview,data:{value:this.isVisible.get(),pane:this.pane}})},onPaneScroll:function(){if(!this._disablePaneScrollListener){try{i.default.PAssert(1540,this.isVisible.get(),"Should not be tracking scroll if overview is not open")}catch(e){i.default.reportError(e)}var e=this.findTopPaneItem();e&&(this.updateTopPaneItem(e),this._infiniteList.scrollItemToMiddle(e,ScrollDuration.Default))}},findTopPaneItem:function(){var e=this.pane;if(this.pane.numItems()>0){for(var t,a,i=this.pane.indexOfTop();i>=0&&i<e.numItems()&&!a;){for(t=this.pane.itemAtIndex(i);t&&t!==this.root&&!a;){this._infiniteList.indexOfItem(t)<0?t=t.parent():a=t}a||i++}return!a&&this._infiniteList.numItems()>0&&(a=this._infiniteList.itemAtIndex(0)),a}},updateTopPaneItem:function(e){var t=this.topItem;this.topItem=e,t&&t.itemChanged.notify(),e.itemChanged.notify()},updateDragHoverItem:function(e){var t=this.dragHoverItem;this.dragHoverItem=e,t&&t.itemChanged.notify(),e&&e.itemChanged.notify()},onPaneItemsUpdated:function(e){if(e===this.pane&&this.isVisible.get()&&this.pane.overviewTracksScroll){var t=this.findTopPaneItem();t&&this.updateTopPaneItem(t)}},isItemAtTop:function(e){return e===this.topItem},isItemDragHovered:function(e){return e===this.dragHoverItem},getiScroller:function(){return this._infiniteList.iScroller},getMinItemSize:function(){return r.a.itemLineHeight()+2*r.a.itemPadding()}},t.a=h},function(e,t,a){"use strict";var i=a(1),r=a(5),n=a(20);function s(e){this.type=PaneMode.Archived,this.title="Archived",this.paneClass="paneArchived",this.contextMenuMode=i.a.ContextMenuMode.Archived,this.isWriteable=!0,this.isEditable=!1,this.isDraggable=!1,this.isDropTarget=!1,this.canAddItem=!1,this.supportCollapsing=!0,this.supportCompleting=!1,this.supportCheckbox=!1,this.supportArchiving=!0,this.supportPerformArchive=!1,this.supportIndent=!1,this.supportClone=!1,this.hasMoreButtons=!1,this.searchFilters=["project","task","starred","priority","showOnlyMatches"],this._super.constructor.call(this,e),this._blocks=[],this._blocksById={},r.a.forceBind("isItemMatched",this),r.a.forceBind("itemEach",this),this.initArchived()}var o={initArchived:function(){this.showArchived.set(!0)},isItemMatched:function(e){return(e.isArchived()||e.isNote()&&e.parent().isArchived()||e.hasArchivedDescendant()||e.hasArchivedAncestor())&&this.search.isMatched(e)},itemEach:function(e){var t=e.getCollapsedField(this,!1);void 0!==this.getPerPaneState(e.id,t)||e.isNote()||(e.isArchived()&&!e.hasArchivedDescendant()||!e.isArchived()&&e.hasArchivedAncestor()&&!e.hasArchivedDescendant())&&e.setCollapsed(!0,this,!1,!1)},getItemSearchParams:function(){return{item:this.getItem(),comparator:this.isItemMatched,each:this.itemEach,includeArchived:!0,includeNotes:!0,noCollapsed:!0,pane:this}},getHeaderSearchParams:function(){return{item:this.getItem(),comparator:this.isItemMatched,includeArchived:!0,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}},getStatusMessage:function(){return"No archived items"},handleRightSideTap:function(e){this.runUnarchive(e)}};r.a.inherit(n.a,s),r.a.extend(s.prototype,o),t.a=s},function(e,t,a){"use strict";var i,r=a(0),n=a(1),s=a(7),o=a(5),l=a(18),d=a(121),c=(a(35),a(20)),u=a(9),h=a(13),f=a(11),p=a(8),m=a(10),g=a(82),v=n.a.TaskViewMode,y=n.a.TaskSortMode,S="__block_nokey";function E(e){var t=r.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar).isActive()&&!r.default.isDemoMode();this.type=PaneMode.Task,this.paneClass="paneTask",this.isWriteable=!0,this.hasNonVMLIs=!0,this.supportCollapsing=!0,this.supportCompleting=!0,this.supportIndent=!1,this.supportOffline=!0,this.supportMenuIcon=!0,this.supportViewMenu=!0,this.supportMultiselect=!1,this.supportDataRefresh=t,this.supportClickOverviewScroll=!1,this.isDraggable=!0,this.overviewTracksScroll=!1,this.combineOverdue=!0,this.searchFilters=["project","task","starred","priority","completeOption","showOnlyMatches","showOnlyAgendaDates","showOnlyMatchingTags"],this.dragHoveredBlock=new u.a,i||((i={})[v.Groups_Project]={Default:y.None,Available:[y.None,y.Alphabetical,y.NumItems,y.Date,y.Priority,y.Created]},i[v.Groups_Tag]=i[v.Groups_Contact]={Default:y.Alphabetical,Available:[y.Alphabetical,y.NumItems]},i[v.Agenda_Today]=i[v.Agenda_Week]=i[v.Agenda_All]={Default:y.Date,Available:[y.Date,y.Created,y.Completed]});var a=e.viewState||{};if(a.viewMode=a.viewMode||v.Groups_Project,a.sortModeBlocks=a.sortModeBlocks||y.None,a.sortModeItems=a.sortModeItems||y.None,this.viewState=new u.a(a,this.onViewStateChanged.bind(this)),this._super.constructor.call(this,e),this._allPaneItems=[],this.topBoxHeight.set(0,!1),this.blocksCollapsed=e.blocksCollapsed,!this.blocksCollapsed){var s=this.blocksCollapsed={};s[S+"_"+v.Groups_Project]=!0,s[S+"_"+v.Groups_Tag]=!0,s[S+"_"+v.Groups_Contact]=!0,s[S+"_"+v.Groups_Priority]=!0}this.dropEffect=function(e){var t=n.a.DropEffect.Move;return this.isCalendarItem(e)&&(t=n.a.DropEffect.Copy),t},this.displayLocalItems=new u.a(void 0===e.displayLocalItems||e.displayLocalItems),this.displayCalendars=new u.a(e.displayCalendars||{}),this.numAllDay=new u.a(0),o.a.forceBind("getDayWidth",this),o.a.forceBind("updateAllDay",this),o.a.forceBind("scrollToToday",this),o.a.forceBind("openViewMenu",this),o.a.forceBind("setViewMode",this),o.a.forceBind("compareBlockDate",this),o.a.forceBind("compareBlockName",this),o.a.forceBind("compareBlockItemPriority",this),o.a.forceBind("compareBlockItemCreated",this),o.a.forceBind("compareItemDate",this),o.a.forceBind("compareItemName",this),this.setupViewState(),o.a.forceBind("_itemSearchComparator",this),o.a.forceBind("onScroll",this),o.a.forceBind("addFnProject",this),o.a.forceBind("addFnTag",this),o.a.forceBind("addFnDate",this),this.initBlocks()}var P={initBlocks:function(){this.blocks=[],this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.datesByItem={},this.starredItems={},this.priorityItems={},this.blocksByKey={},this.preventUpdateItemsForItem=void 0,this.itemAnimationTimeout=void 0;var e=r.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar);e.isActive()&&this.useItemStore(e.getDefaultItemStore());var t=r.default.vmMain.pluginManager.getPlugin(PluginID.Gmail);t.isActive()&&this.useItemStore(t.getDefaultItemStore()),r.default.vmMain.pluginManager.listen("pluginActiveChanged",PluginID.GCalendar,o.a.forceBind("onGCalendarActiveChanged",this)),r.default.vmMain.pluginManager.listen("pluginActiveChanged",PluginID.Gmail,o.a.forceBind("onGmailActiveChanged",this)),f.a.listen("selectionChanged",o.a.forceBind("_onSelectionChanged",this)),r.default.settings.listen("settingChanged",Settings.DefaultGroup,Settings.dayWeekStart,this.scrollToToday)},init:function(){this._super.init.call(this)},destroy:function(){f.a.unlisten("selectionChanged",this._onSelectionChanged),r.default.settings.unlisten("settingChanged",Settings.DefaultGroup,Settings.dayWeekStart,this.scrollToToday),this._onAfterLoadedRAF||this.removeScrollListener(this.onScroll),r.default.vmMain.pluginManager.unlisten("pluginActiveChanged",PluginID.GCalendar,this.onGCalendarActiveChanged),r.default.vmMain.pluginManager.unlisten("pluginActiveChanged",PluginID.Gmail,this.onGmailActiveChanged),this._super.destroy.call(this)},getPaneIcon:function(){return"icon-calendar"},keydown:function(e){p.a.isValid()&&p.a.getStartIndex()===p.a.getEndIndex()&&!m.a.undoRedoActive&&(this.preventUpdateItemsForItem=p.a.getStartObject(),this.search.stickMatch(p.a.getStartObject())),this._super.keydown.call(this,e)},handleLeftSideTap:function(e,t){this.clearPreventUpdate(),this._super.handleLeftSideTap.call(this,e,t)},setItemsWillBeDirty:function(){this.itemsWillBeDirty=!0},clearPreventUpdate:function(){var e=this.preventUpdateItemsForItem;if(e&&l.a.isDragging){var t=function(){f.a.unlisten("endDrag",t),this.clearPreventUpdate()}.bind(this);f.a.listen("endDrag",t)}else e&&(this.search.unstickMatch(e),this.preventUpdateItemsForItem=void 0),this.itemsWillBeDirty&&(this.itemsWillBeDirty=void 0,this.setItemsDirty(),r.default.vmMain.updateAllItems(),console.log("dirty!"))},_onSelectionChanged:function(){if(p.a.getPane()===this&&this.preventUpdateItemsForItem&&!m.a.undoRedoActive)if(p.a.isValid()){if(p.a.getStartObject().id!==this.preventUpdateItemsForItem.id){this.clearPreventUpdate();var e=p.a.save();r.default.vmMain.setItemAnimationMode(n.a.ItemAnimationMode.Move),r.default.vmMain.updateAllItems(),this.restoreSelection(e),clearTimeout(this.itemAnimationTimeout),this.itemAnimationTimeout=setTimeout(function(){r.default.vmMain.resetItemAnimationMode()},300)}}else this.clearPreventUpdate(),this.updateItems();else this.clearPreventUpdate()},isCalendarItem:function(e){return e.belongsToItemStore(r.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar).getDefaultItemStore())},isEmailItem:function(e){return e.belongsToItemStore(r.default.vmMain.pluginManager.getPlugin(PluginID.Gmail).getDefaultItemStore())},_itemSearchComparator:function(e){var t=this.search.isMatched(e)||e.isNote()&&this.search.isMatched(e.parent()),a=!1,i=!1;if(this.isCalendarItem(e)){var n=e.getAttachmentByPlugin(PluginID.GCalendar);n&&("cancelled"===n.getField("status")?i=!0:n.forEachItem(void 0,function(e){e.belongsToItemStore(r.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar).getDefaultItemStore())||(a=!0)}))}else if(this.isEmailItem(e)){var s=e.getAttachmentByPlugin(PluginID.Gmail);if(s){var o=r.default.vmMain.pluginManager.getPlugin(PluginID.Gmail);if(o.isItemArchived(e))t=!1;else o.getAttachmentPriority(s)!==VMLIFlag.None&&(t=!0)}}return t&&!a&&!i},getItemSearchParams:function(){return{itemStoreFilter:this.search.itemStoreFilter,item:this.item.get(),comparator:this._itemSearchComparator,noCollapsed:this.isViewOutline(),includeArchived:this.showArchived.get(),includeNotes:!0,pane:this}},_setItems:function(e,t){this.updateBlockItems()},onTapViewArchived:function(){r.default.vmMain.beginUpdateItems(),this.showArchived.set(!this.showArchived.get()),r.default.vmMain.commitUpdateItems(),r.default.vmMain.paneManager.updatePaneStateForPane(this),r.default.sendEvent("Menu","ShowArchivedTimeline")},onLoad:function(){isNaN(this.initialOffset)&&this.isViewDates()&&(this.initialOffset=this.getScrollOffsetOfToday(),this._infiniteList.setInitialScrollOffset(this.initialOffset)),this._super.onLoad.call(this)},onAfterLoaded:function(){this.orientation.get()===n.a.Orientation.Horizontal&&(this.paneContent.scrollTop=this.getDayViewY()),this.setIgnoreRestoreScroll(),this._super.onAfterLoaded.call(this),this.addScrollListener(this.onScroll)},getScrollOffsetOfToday:function(){var e,t=this.getViewMode();if(t===v.Calendar_Month)e=this.heightWeek()*(n.a.CalendarMonthViewNumWeeksPad+1);else if(t===v.Calendar_Day||t===v.Calendar_Week)e=this.getDayWidth()*n.a.CalendarDayViewNumDaysPad+1;else if(this.isViewAgenda())for(var a=this.items.get(),i=0;i<a.length;i++){var r=a[i];if((r.isOverdue||r.isToday)&&"blockHeader"===r.type){e=this.topOfIndex(i)-16;break}}return e},_getDateInMiddle:function(){var e=(new Date).clearTime(),t=this.getViewMode();return t===v.Calendar_Month?e=this.getMonthStart(e):t===v.Calendar_Week&&(e=this.getWeekStart(e)),e},scrollToTop:function(e){this.isViewDates()?this.scrollToToday(e):this._super.scrollToTop.call(this,e)},scrollToToday:function(e){var t=this.getScrollOffsetOfToday();e=isNaN(e)?ScrollDuration.Default:e,this.setIgnoreRestoreScroll(e+100),this.setScrollOffset(t,e),this.orientation.get()===n.a.Orientation.Horizontal&&(this.paneContent.scrollTop=this.getDayViewY(),this.scrollElement.scrollTop=0)},weekCount:function(e,t,a){var i=new Date(e,t,1),r=a?new Date(e,t,a):new Date(e,t+1,0),n=i.getDay()+r.getDate();return Math.ceil(n/7)},scrollJump:function(e,t){t=isNaN(t)?ScrollDuration.Default:t;var a,i,n=this.getViewMode(),s=this._infiniteList.getScrollOffset(),o=this._infiniteList.indexOfTop(),l=this._infiniteList.objectAtIndex(o),d=s-this.topOfIndex(o);if(n===v.Calendar_Month){var c=l.date;if(e<0){var u=c.clone().addMonths(-1);a=this.weekCount(c.getFullYear(),c.getMonth(),c.getDate())-1,i=this.weekCount(u.getFullYear(),u.getMonth()),s-=this.heightWeek()*(i+a)+d}else i=this.weekCount(c.getFullYear(),c.getMonth()),a=this.weekCount(c.getFullYear(),c.getMonth(),c.getDate())-1,s+=this.heightWeek()*(i-a)-d}else if(n===v.Calendar_Week){var h,f=l.date.getDay(),p=r.default.settings.get(Settings.dayWeekStart);h=e<0?f>p?-f+p:-7:7-f+p,s+=this.getDayWidth()*h-d+1}else n===v.Calendar_Day&&(e<0&&d>200?s-=d:s+=this.getDayWidth()*e-d+1);this.setIgnoreRestoreScroll(),this.setScrollOffset(s,t)},compareDate:function(e,t){return e||t?e?t?e.compareTo(t):-1:1:0},compareText:function(e,t){return e.localeCompare(t)},comparePriority:function(e,t){var a=e.priority(),i=t.priority();return i>a?1:i<a?-1:0},compareBlockBase:function(e,t,a){var r=this.compareNoKey(t,a)||e(t,a);if(0===r){var n=i[this.getViewMode()].Default,s=this._getBlockSortComparator(n);if(s!==e)return s(t,a)}return r},compareBlockPriority:function(e,t){return t.priority-e.priority},compareNoKey:function(e,t){return e.id===this.blockNoKey?-1:t.id===this.blockNoKey?1:void 0},compareNone:function(e,t){return e.originalIndex-t.originalIndex},compareBlockDate:function(e,t){return this.compareDate(e.date,t.date)},compareBlockName:function(e,t){return this.compareText(e.name,t.name)},compareBlockNumItems:function(e,t){return t.items.length-e.items.length},compareBlockItemPriority:function(e,t){return this.comparePriority(e.item,t.item)},compareBlockItemCreated:function(e,t){return this.compareDate(e.item.dateCreated,t.item.dateCreated)},_getBlockSortComparator:function(e){return e===y.Alphabetical&&this.compareBlockName||e===y.Date&&this.compareBlockDate||e===y.NumItems&&this.compareBlockNumItems||e===y.Priority&&this.compareBlockItemPriority||e===y.Created&&this.compareBlockItemCreated||e===y.None&&this.compareNone},getBlockComparator:function(){var e=this.getSortModeBlocks();return this.compareBlockBase.bind(this,this._getBlockSortComparator(e))},compareItemBase:function(e,t,a){var i=e(t,a);return 0===i?this.compareItemNone(t,a):i},compareItemNone:function(e,t){return e.index-t.index},compareItemDate:function(e,t){return this.compareDate(e.item.getDate(this),t.item.getDate(this))},compareItemName:function(e,t){return this.compareText(e.item.getSearchText(),t.item.getSearchText())},compareItemNumItems:function(e,t){return t.item.numItems()-e.item.numItems()},_getItemSortComparator:function(e){return e===y.Alphabetical&&this.compareItemName||e===y.Date&&this.compareItemDate||e===y.NumItems&&this.compareItemNumItems||e===y.Priority&&this.compareBlockItemPriority||e===y.Created&&this.compareBlockItemCreated||e===y.None&&this.compareItemNone},getItemComparator:function(){var e=this.getSortModeItems();return this.compareItemBase.bind(this,this._getItemSortComparator(e))},findIndexOfNextBlock:function(){for(var e=new Date,t=this.items.get(),a=0;a<t.length;++a){var i=t[a];if("blockHeader"===i.type){var r=i.block;if(r.isOverdue||r.isNow||r.isToday||r.isStarred||r.isImportant||r.date>=e)return a}}return-1},_keyHelper:function(e,t){var a=e["get"+t](this);if(a){if(this.search.showOnlyMatchingTags()){var i=this.search["get"+t]();i&&i.length>0&&(i=i.map(r.default.toLowerCase),a=a.filter(function(e){for(var t=0;t<i.length;t++)if(e===i[t])return!0}))}return a}if(!e.hasVisibleChildren(this)){for(var n=!0,s=e.parent();void 0!==s&&s!==this.getItem();){var o=s["get"+t](this);if(o)for(var l=0;l<o.length;l++)if(this.blocksByKey[o[l]]){n=!1;break}s=s.parent()}if(n)return[this.blockNoKey]}},_getKeysForItem:function(e){var t=this.getViewMode();if(this.isViewAgenda()||this.isViewCalendar()){var a=!0;if(this.isViewAgenda()&&e.hasAttachmentType(n.a.PluginType.Calendar)&&e.date()<Date.today()){var i=e.getAttachmentByType(n.a.PluginType.Calendar);i.getPlugin().shouldDisplayOverdueInAgenda()&&i.getPlugin().hasWritePermissionForAttach(i)||(a=!1)}if(a){var s=this._getDateForItem(e);if(this.isViewAgenda()&&this.getSortModeBlocks()===y.Date&&!this.search.showOnlyAgendaDates()){var o=[];if(!e.isComplete()){if(e.isStarred()){var l="starred";r.default.timeline.getDateForKey(l)&&o.push(l)}if(e.isImportant()){l="important";r.default.timeline.getDateForKey(l)&&o.push(l)}}var d=e.getTags();if(d)for(var c=0;d&&c<d.length;c++){var u="#"+d[c];r.default.timeline.getDateForKey(u)&&o.push(u)}o.length>0&&(s=s?s.concat(o):o)}return s}}else if(t===v.Groups_Project){var h=e.parent();if(h===this.getItem()&&!e.isPrefixHeader(this))return[this.blockNoKey];if(h&&h.parent()===this.getItem()&&h.isPrefixHeader())return[h.id]}else{if(t===v.Groups_Tag)return this._keyHelper(e,"Tags");if(t===v.Groups_Contact)return this._keyHelper(e,"Contacts");if(t===v.Groups_Priority){var f=e.priority();if(f)return[f];if(!e.hasVisibleChildren(this)){a=!0;for(var p=e.parent();void 0!==p&&p!==this.getItem();){if(p.priority()){a=!1;break}p=p.parent()}if(a)return[this.blockNoKey]}}}},isOkOnAgenda:function(e){return!!this._getKeysForItem(e)||e.parent()&&this.isOkOnAgenda(e.parent())},_getDateForItem:function(e){var t,a,i=this.getSortModeBlocks();if(this.isViewCalendar()||i===y.Date){var n=e.getDate(this),s=e.repeatDate(this),o=e.getDateText(this);if(e.isComplete()&&this.isViewAgenda())e.dateCompleted>=Date.today()&&(t=e.dateCompleted);else if(r.default.isDateSoft(o))t=o.toLowerCase(),(a=this.getDateForSoftDate(t))||(t=void 0);else if(s)t=s.getDates();else if(n)if(e.getDuration(this)>0){t=[];for(var l=n.clone().clearTime(),d=e.getEndDate(this).clone().clearTime();l<=d;)l.equals(d)?t.push(e.getEndDate(this)):t.push(l.clone()),l.addDays(1)}else t=n}else i===y.Created?t=e.dateCreated:i===y.Completed&&(t=e.dateCompleted);if(t){if(r.default.isArray(t)){for(var c=0;c<t.length;c++)this.isDateWithinRange(t[c])||(t.splice(c,1),c--);return t}if(this.isDateWithinRange(a||t))return[t]}},isDateWithinRange:function(e){return e&&(!this.endDate||e<this.endDate)},_getKeyForDate:function(e){var t,a=Date.today(),i=Math.floor((e-a)/864e5);if(this.combineOverdue&&e<a)t="overdue";else{switch(i){case-1:t="yesterday";break;case 0:t="today";break;case 1:t="tomorrow";break;default:t=e.toString("dddd")}var r=e.getYear()!==a.getYear()?DFormat.MonthDayYearLong:DFormat.MonthDayLong,n=h.a.getFormat(r);t+=" "+e.toString(n)}return t.toLowerCase()},updateBlockItems:function(){var e,t=this.getViewMode();t===v.Outline?this.updateOutline(this._allPaneItems,this.supportsSortItems()&&this.getItemComparator()):(this.updateBlocks(),t===v.Calendar_Month?this.updateCalendarMonth():t===v.Calendar_Week||t===v.Calendar_Day?(this.updateCalendarWeek(),e=!0):this.updatePaneObjects()),e&&this.updateAllDay()},updateBlocks:function(){var e,t,a;for(this!==r.default.focusedPane&&this.search.update(),this.blocks=[],this.blocksByKey={},this.isViewAgenda()&&this.getBlock(Date.today()),e=0;e<this._allPaneItems.length;e++){var i=!(t=this._allPaneItems[e]).isNote();if(i)if(t.hasAttachmentType(n.a.PluginType.Calendar)){var s=t.getAttachmentByType(n.a.PluginType.Calendar).getField("calendarID");i=!1!==this.displayCalendars.get()[s]}else i=this.displayLocalItems.get();i&&this.addToBlock(this._allPaneItems[e])}this.isViewAgenda()?a=this.compareBlockDate:this.isViewPriority()?a=this.compareBlockPriority:this.supportsSortBlocks()&&this.getSortModeBlocks()!==y.None&&(a=this.getBlockComparator()),a&&this.blocks.sort(a)},addItemToPaneObjects:function(e,t,a,i,r){i=i||0;var n=new g.a({type:"blockItem",item:a,id:t.getItemID(a)+(r?"_"+r.id:""),block:t,parentObject:r,index:e.length,levelsDeep:i,sizeInPane:a.sizeInPane});if(e.push(n),a.hasNote()&&this.addItemToPaneObjects(e,t,a.getNote(),i,r),!a.isCollapsed(this)){var s=a.getVisibleChildren(this);if(s)for(var o=0;o<s.length;o++)this.addItemToPaneObjects(e,t,s[o],i+1,n)}return n},updatePaneObjects:function(){var e,t,a,i,r=[];for(a=0;a<this.blocks.length;a++){var n=this.blocks[a],s=a<this.blocks.length-1&&this.isBlockCollapsed(n)&&!this.isBlockCollapsed(this.blocks[a+1]);if(n.sort(),n.item?(t=n.item,i=new g.a({type:"blockItem",item:t,id:t.id+"_"+n.id,block:n,index:r.length,levelsDeep:0,sizePad:s?n.heightOfSpaceBetween():n.isCollapsed()?0:4,sizeInPane:t.sizeInPane,isBlockHeader:!0}),r.push(i),t.hasNote()&&!this.isBlockCollapsed(n)&&this.addItemToPaneObjects(r,n,t.getNote(),0,i)):this.isViewProject()&&n.id===this.blockNoKey&&1===this.blocks.length||r.push(new g.a({type:"blockHeader",block:n,id:n.id,index:r.length,isToday:n.isToday,isOverdue:n.isOverdue,isFirstCollapsed:e&&n.isCollapsed()&&!e.isCollapsed(),sizePad:s?n.heightOfSpaceBetween():this.isViewProject()||this.isViewAgenda()&&n.isDate?4:0,sizeInPane:n.heightOfHeader})),1===this.blocks.length&&this.isViewProject()||!this.isBlockCollapsed(n)){for(var o=!1,l=0;l<n.items.length;l++)t=n.items[l],i=this.addItemToPaneObjects(r,n,t),!o&&this.isViewAgenda()&&this.shouldShowTime(i)&&!t.time()&&(i.showAllDay=!0,o=!0);r.push(new g.a({type:"blockAddItem",id:n.id+"_add",block:n,index:r.length,sizeInPane:n.noAddButton?n.heightOfSpaceBetween():n.heightOfAddButton(),addFn:n.addItem}))}e=n}this.isViewProject()&&((n=this.getBlock("newProject")).isNewProject=!0,r.push(new g.a({type:"blockHeader",block:n,id:n.id,index:r.length,sizeInPane:n.heightOfHeader}))),this.items.set(r)},addToBlock:function(e){this.isViewProject()&&e.isPrefixHeader(this)&&e.parent()===this.getItem()&&this.getBlock(e.id,e);var t=this._getKeysForItem(e);if(t)for(var a=0;a<t.length;a++){var i=this.getBlock(t[a],e);i&&this.addItemToBlock(e,i)}},addItemToBlock:function(e,t){t.addItem(e)},_addFnBase:function(e,t,a,i,n){e=r.default.getDefaultItemText(i)+e,this.clearPreventUpdate(),r.default.vmMain.beginUpdateItems(),m.a.beginAction();var s={text:e};n&&(s=r.default.extend(s,n));var o=this.createVMLI(s,{parent:a,changeType:ChangeType.AllLocal,isEditable:!0});a.insertItem(o),m.a.performAction(TrackerType.Create,{itemID:o.id,parent:a.id,position:a.numItems(),text:e}),m.a.endAction(),r.default.vmMain.commitUpdateItems();var l=this.indexOfItem(o,t);l>=0&&p.a.selectIndex(l,0)},addFnProject:function(e){return this._addFnBase("",e,e.id===this.blockNoKey?this.getItem():s.a.getModel(e.id))},addFnTag:function(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())},addFnDate:function(e){var t=h.a.getAppendDateText(e.date);return this._addFnBase(" "+n.a.DatePrefix+t,e,this.getItem())},addFnContact:function(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())},addFnPriority:function(e){return this._addFnBase("",e,this.getItem(),void 0,{priority:e.priority})},getDateForSoftDate:function(e){var t=r.default.timeline.getDateForKey(e.toLowerCase());if(!isNaN(t)){var a=100*Math.round(t/100),i={days:Math.round(a/100),minutes:Math.round(t-a)};return Date.today().add(i)}},getBlock:function(e,t){var a,i=this.isViewDates(),n=this.isViewAgenda();if(i&&!r.default.isString(e)&&(a=e,"overdue"===(e=this._getKeyForDate(a))&&(!t.isComplete()&&r.default.timeline.getDateForKey(e)||(e=void 0),a=void 0)),e){var o,l=this.isViewAutoBlocks()?void 0:s.a.getModel(e),c=this.getViewMode(),u=this.blocksByKey[e];if(!u)if(void 0!==(o=l?l.getStyledTextAsOneLine(!0):this.isViewPriority()?e===VMLIFlag.P0?"High":e===VMLIFlag.P1?"Medium":e===VMLIFlag.P2?"Low":"(No priority)":e)){var h={pane:this,id:e,name:o,sortMode:this.supportsSortItems()&&this.getSortModeItems(),addFn:this.isViewProject()&&this.addFnProject.bind(this)||this.isViewTag()&&this.addFnTag.bind(this)||this.isViewContact()&&this.addFnContact.bind(this)||this.isViewPriority()&&this.addFnPriority.bind(this)||n&&this.addFnDate};this.isViewTag()?(h.name=e===this.blockNoKey?"(No tag)":"#"+h.name,h.isTag=!0):this.isViewContact()?(h.name=e===this.blockNoKey?"(No contact)":"+"+h.name,h.isContact=!0):this.isViewPriority()&&(h.isPriority=!0,h.priority=e),c===v.Groups_Project&&(h.name=e===this.blockNoKey?"(No project)":h.name,h.item=l,h.isEditable=!0,h.date=l&&l.getDate(this)),e===this.blockNoKey&&(h.isNoKey=!0),i&&(a?(h.date=a.clone().clearTime(),h.isDate=!0,h.date.equals(Date.today())&&(h.isToday=!0)):(h.date=this.getDateForSoftDate(e),h.name=h.name.toUpperCase(),"now"===e?h.isNow=!0:"starred"===e?h.isStarred=!0:"important"===e?h.isImportant=!0:"overdue"===e&&(h.isOverdue=!0,h.noAddButton=!0))),u=new d.a(h),this.blocksByKey[e]=u,e===this.blockNoKey?(u.originalIndex=0,this.blocks.splice(0,0,u)):(u.originalIndex=this.blocks.length,this.blocks.push(u))}}return u},closestIndexOfObject:function(e){return this.indexOfItem(e,e.block,e.index)},onGCalendarActiveChanged:function(e,t){this.supportDataRefresh=t;var a=e.getDefaultItemStore();t?this.useItemStore(a):this.stopUsingItemStore(a)},onGmailActiveChanged:function(e,t){var a=e.getDefaultItemStore();t?this.useItemStore(a):this.stopUsingItemStore(a)},refreshPaneData:function(){var e=r.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar);e.isActive()&&e.forceRemoteEventSync(this.id)},viewModeIcon:function(){return n.a.TaskViewModeIcon[this.getViewMode()]},isViewDates:function(){return this.isViewAgenda()||this.isViewCalendar()},isViewAgenda:function(){var e=this.getViewMode();return e===v.Agenda_Today||e===v.Agenda_Week||e===v.Agenda_All},isViewCalendar:function(){var e=this.getViewMode();return e===v.Calendar_Day||e===v.Calendar_Week||e===v.Calendar_Month},isViewCalendarMonth:function(){return this.getViewMode()===v.Calendar_Month},isViewProject:function(){return this.getViewMode()===v.Groups_Project},isViewGroups:function(){var e=this.getViewMode();return e===v.Groups_Project||e===v.Groups_Tag||e===v.Groups_Contact||e===v.Groups_Priority},isViewOutline:function(){return this.getViewMode()===v.Outline},isViewTag:function(){return this.getViewMode()===v.Groups_Tag},isViewContact:function(){return this.getViewMode()===v.Groups_Contact},isViewPriority:function(){return this.getViewMode()===v.Groups_Priority},isViewAutoBlocks:function(){return this.isViewAgenda()||this.isViewTag()||this.isViewContact()||this.isViewPriority()},isCalFilterActive:function(){var e=this.displayCalendars.get(),t=!this.displayLocalItems.get();for(var a in e)if(e.hasOwnProperty(a)&&!1===e[a]){t=!0;break}return t},onViewStateChanged:function(){r.default.vmMain.setItemAnimationMode(n.a.ItemAnimationMode.None),this.setIgnoreRestoreScroll(),this.setupViewState(!0),this._infiniteList.clearCache(),this._infiniteList.alwaysRenderScroll=!0,this.isViewCalendar()||this._infiniteList.setInitialScrollOffset(0),this.updateItemsImmediate(!0,void 0,void 0,!0),r.default.vmMain.paneManager.updatePaneStateForPane(this),this.isViewDates()?(this.scrollToToday(ScrollDuration.Snap),requestAnimationFrame(function(){this.isViewDates()&&(this.scrollToToday(ScrollDuration.Snap),r.default.vmMain.resetItemAnimationMode(),requestAnimationFrame(function(){this._infiniteList.alwaysRenderScroll=!1}.bind(this)))}.bind(this))):this.setScrollOffset(0,ScrollDuration.Snap),r.default.vmMain.resetItemAnimationMode(),this.hasCollapsedObs.set(this.hasCollapsed())},setupViewState:function(e){var t,a=this.getViewMode(),s=this.getSortModeBlocks(),o=a===v.Outline,l=this.isViewCalendar()||r.default.activeDisplayMode&DisplayMode.NoPaneTop?0:(this.isViewAgenda()||this.isViewProject()?48:36)||!1;this.supportsSortBlocks()&&(this.supportsSortBlocksMode(s)||this.setSortModeBlocks(i[a].Default,!1),(s=this.getSortModeBlocks())===y.Completed&&0===this.search.getFilterValue("completeOption")&&this.search.setFilter("completeOption",1)),this.blockNoKey=S+"_"+a,this.supportIndent=o,this.supportMultiselect=o,this.overviewTracksScroll=o,this.supportSearchFlat=o,this.topBoxHeight.set(l,!1),this.paneClass=this.getPaneClass(),this.paneEmptyMessage=(this.isViewAgenda()?"Nothing on the agenda":this.isViewOutline()&&"Write some things here to get started")||"",(this.isViewCalendar()||this.isViewAgenda())&&(t=n.a.ItemStoreFilter.Dates,(this.isViewCalendar()||this.getSortModeBlocks()===y.Date)&&(t|=n.a.ItemStoreFilter.Priority)),this.search.itemStoreFilter=t,this.search.setFilterEnabled("showOnlyAgendaDates",this.isViewAgenda()),this.search.setFilterEnabled("showOnlyMatchingTags",this.isViewTag()||this.isViewContact()),(this.isViewTag()||this.isViewContact())&&this.search.setFilterTooltip("showOnlyMatchingTags","Show only matching "+(this.isViewTag()?"Tag":"Contact")+" blocks"),this.search.onlyMatchDates=this.isViewDates(),this.shouldUpdateOnTextChanged=this.isViewAgenda()||this.isViewTag(),this.combineOverdue=this.isViewAgenda()&&s===y.Date,this.showScrollbars.set(!this.isViewCalendar()),this.isViewAgenda()&&(s===y.Date?a===v.Agenda_All?this.endDate=void 0:a===v.Agenda_Today?this.endDate=Date.today().addDays(1):a===v.Agenda_Week&&(this.endDate=Date.today().addDays(7)):(this.startDate=void 0,this.endDate=Date.today().addDays(1))),this.isEditable=this.supportSel=!this.isViewCalendar(),this.orientation.set(a===v.Calendar_Day||a===v.Calendar_Week?n.a.Orientation.Horizontal:n.a.Orientation.Vertical),a===v.Calendar_Week||a===v.Calendar_Month?(this.minWidth=900,this.maxWidth=1200):(this.minWidth=n.a.StdPaneWidthMin,this.maxWidth=n.a.StdPaneWidthMax),this.dateInMiddle=this._getDateInMiddle(),r.default.vmMain.paneManager.updatePaneRects()},getPaneClass:function(){return"paneTask pane"+((this.isViewCalendar()?"Calendar":this.isViewAgenda()&&"Agenda")||this.isViewProject()&&"Project"||this.isViewTag()&&"Tag"||this.isViewContact()&&"Contact"||this.isViewPriority()&&"Priority"||this.isViewOutline()&&"Outline")},onScroll:function(){var e=this.getViewMode();e!==v.Calendar_Day&&e!==v.Calendar_Week||(clearTimeout(this._timeoutUpdateAllDay),this._timeoutUpdateAllDay=setTimeout(this.updateAllDay,50))},_handleDragOverPane:function(e,t,a,i,n,s,o){if(e&&r.default.findParent(a,"paneContent")&&!r.default.hasClass(a,"paneContent")&&!r.default.hasClass(a,"paneTopBox")&&n&&"blockHeader"===n.type&&(this.isViewAgenda()&&e.supportDates||this.isViewAutoBlocks())){var d,c=r.default.getReactCellForElement(a);return c&&c.props.cell&&(d=c.props.cell.paneObject.block,this.isViewAgenda()&&d.isOverdue&&(d=void 0)),this.dragHoveredBlock.set(d),l.a.setBlockTarget(d),{block:d}}if("blockItem"===n.type)return this.dragHoveredBlock.set(void 0),l.a.setBlockTarget(void 0),this._handleDragOverTasks(e,t,a,i,n,s,o)},_handleDragOverTasks:function(e,t,a,i,s,o,l){var d,c,u,h,f,p=!1,m=n.a.DragDropPosition.Below,g=!1,v=0;if(s&&s){d=s.item,f=s.index,d.isNote()&&(s=this.objectAtIndex(f-1),i=this.elementAtIndex(f-1),d=d.parent());var y=i.getBoundingClientRect();d.hasNote()&&(v=this.sizeOfItem(d.getNote()));var S=y.height+v;m=this.isSearchedFlat()&&this.search.isFlatSearchResult(d)||this.isViewAgenda()||this.isViewAutoBlocks()?n.a.DragDropPosition.On:l<y.top+S/3&&(!this.isViewProject()||0!==s.levelsDeep)?n.a.DragDropPosition.Above:l>y.top+2*S/3?n.a.DragDropPosition.Below:n.a.DragDropPosition.On,u=i,p=!0}else if(0===this.numItems())d=this.getItem(),g=!0;else if(!this.isSearchedFlat()&&r.default.findParent(a,"paneScroller")){var E=this.indexOfLastItem();if(!p&&E>=0&&this.isIndexMounted(E))if(l>=(h=this.elementAtIndex(E)).getBoundingClientRect().bottom)d=this.getLastItem(),s=this.getLastObject(),u=h,m=n.a.DragDropPosition.Below,p=!0}if(!p&&!this.isSearchedFlat()){var P=this&&this.indexOfFirstItem();if(this&&P>=0&&this.isIndexMounted(P))if(l<(h=this.elementAtIndex(P)).getBoundingClientRect().top)d=this.getFirstItem(),s=this.getFirstObject(),u=h,m=this.isViewProject()&&0===s.levelsDeep?n.a.DragDropPosition.On:n.a.DragDropPosition.Above,p=!0}if(p){var b=u.getBoundingClientRect(),C=m!==n.a.DragDropPosition.Below?b.top:b.top+b.height+v,D=m===n.a.DragDropPosition.On?b.height:void 0;if(C>this.contentTop()){var I;m===n.a.DragDropPosition.Below&&f+1<this.numItems()&&d.hasChildren()&&((I=this.objectAtIndex(f+1)).item||(I=void 0)),I=I||s;var A=this.getPaddingForPaneObject(I);c={left:b.left+A,top:C,width:b.right-b.left-A,height:D}}}return this.scrollFromMousePosition(l),{position:m,targetElement:u,targetItem:d,linePosition:c,overview:!1,dropOnPane:g}},handleDragDrop:function(e,t,a,i){l.a.blockTarget?(l.a.startPane.applyDropOnBlock(l.a.blockTarget,e,this,t.dataTransfer.block),this.revertDrag()):this._super.handleDragDrop.call(this,e,t,a,i)},revertDrag:function(){this._super.revertDrag.call(this),this.dragHoveredBlock.get()&&this.dragHoveredBlock.set(null)},getSaveInfo:function(){var e=this._super.getSaveInfo.call(this);return e.viewState=this.viewState.get(),e.displayCalendars=this.displayCalendars.get(),e.displayLocalItems=this.displayLocalItems.get(),e.blocksCollapsed=this.blocksCollapsed,e},isBlockCollapsed:function(e){return e.item?e.item.isCollapsed(this):!0===this.blocksCollapsed[e.id]},setBlockCollapsed:function(e,t){p.a.reset(),this.blocksCollapsed[e.id]=t,this.hasCollapsedObs.set(this.hasCollapsed()),this.updateBlockItems(),r.default.vmMain.paneManager.savePaneState()},onInfiniteListLoaded:function(){!this.initialOffset&&this.isViewCalendar()&&(this.initialOffset=this.getScrollOffsetOfToday()||0,this._infiniteList.setInitialScrollOffset(this.initialOffset))},addProject:function(e,t){this.addItemWithPrefix(e,n.a.Prefix.Header,t)},addItemWithPrefix:function(e,t,a){e=e||0,r.default.vmMain.beginUpdateItems(),p.a.reset(),this.setIgnoreRestoreScroll();var i=this.getItem(),s=(t?t+" ":"")+(a||""),o=r.default.getDefaultItemText(),l=i.addItemAtIndex(s,e,this);this.isViewProject()&&t===n.a.Prefix.Header&&l.addItemAtIndex(o,e,this),r.default.vmMain.commitUpdateItems();var d=this.indexOfItem(l);return this.scrollIndexIntoView(d),p.a.selectIndex(d,s.length),l},setDisplayLocal:function(e){this.displayLocalItems.set(e),this.updateItems()},setDisplayCalendar:function(e,t){var a=r.default.clone(this.displayCalendars.get());a[e.id]=t,this.displayCalendars.set(a),this.updateItems()},getCollapsedDefault:function(e,t,a){if((a=a||this.getViewMode())!==v.Outline){var i=t?this.getRootItem():this.getItem();if(!this.isViewProject()||e.parent()&&(e.parent()!==i||!e.isPrefixHeader()))return!0}return!1},getWidth:function(){var e=this._super.getWidth.call(this);return this.isViewCalendar()&&!this.isViewCalendarMonth()&&(e-=50),e},getMonthStart:function(e){return e.clone().clearTime().addDays(1-e.getDate())},getWeekStart:function(e){return e.clone().clearTime().addDays(-e.getDay()+r.default.settings.get(Settings.dayWeekStart))},doesWeekCrossMonth:function(e){if(e.clone().addDays(6).getDate()<e.getDate())return!0},updateCalendarMonth:function(){var e,t,a,i=[],r=this.dateInMiddle,s=this.getWeekStart(r),o=n.a.CalendarMonthViewNumWeeksPad;for(a=-1;i.length<o;a--)e=s.clone().addWeeks(a),t=this.doesWeekCrossMonth(e),i.splice(0,0,this.updateCalendarMonthWeek(e,!1,t)),t&&i.length<o&&i.splice(0,0,this.updateCalendarMonthWeek(e,!0,!1));for(o=2*n.a.CalendarMonthViewNumWeeksPad+1,a=0;i.length<o;a++)e=s.clone().addWeeks(a),(t=this.doesWeekCrossMonth(e))&&i.length<o&&i.push(this.updateCalendarMonthWeek(e,!0,!1)),i.push(this.updateCalendarMonthWeek(e,!1,t));this.items.set(i)},updateCalendarMonthWeek:function(e,t,a){for(var i,r,n=[],s=1===e.getDate(),o=0;o<7;o++){var l=e.clone().addDays(o);if(i&&l.getDate()<i.getDate()&&(s=!0),!(!s&&a||s&&t)){n[o]={date:l};var d=this._getKeyForDate(l),c=this.blocksByKey[d];c&&(n[o].items=c.items),r||(r=l)}i=l}return{type:"calendarWeek",id:"week_"+e+(t?"_end":""),date:r,dates:n,sizeInPane:this.heightWeek()}},heightWeek:function(){return n.a.CalendarMonthViewWeekHeight},getItemsOnDay:function(e){var t=this._getKeyForDate(e),a=this.blocksByKey[t];return a&&a.items||[]},updateCalendarWeek:function(){for(var e=[],t=n.a.CalendarDayViewNumDaysPad,a=this.dateInMiddle,i=this.getViewMode(),r=-t;r<t;r++){var s=a.clone().addDays(r),o=this._getKeyForDate(s),l=this.blocksByKey[o],d=l&&l.items||[];e.push({type:"calendarDay",id:i+"_day_"+(r+t),date:s,items:d,sizeInPane:this.getDayWidth})}this.items.set(e)},getItemPlacementOnDate:function(e,t){var a=e.repeatDate(),i=e.date()||e.repeatDate(),r=e.getDuration()&&e.date()&&e.getEndDate();if(i&&i.hasTimeOfDay()&&(a||i.isSameDay(t))){var s=i.getHours()+i.getMinutes()/60,o=e.getDuration()?e.getDuration()/n.a.MSPerHour:1;if(o=Math.round(10*Math.min(o,24-i.getHours()))/10,s>0||o<24)return{time:s,duration:o}}else if(i&&i.hasTimeOfDay()&&r&&!i.isSameDay(t)&&r.isSameDay(t)){return{time:0,duration:o=r.getHours()+r.getMinutes()/60}}return!1},updateAllDay:function(){if(!this._destroyed){for(var e=this.indexOfTop(),t=this.inViewCount(),a=1,i=e;i<e+t;i++){var r=this.items.get()[i];if(r){for(var n=0,s=r.items||[],o=0;o<s.length;o++){var l=s[o];this.getItemPlacementOnDate(l,r.date)||n++}n>a&&(a=n)}}this.numAllDay.set(a)}},getContentHeight:function(){return 1224+this.getHeightAllDay()+2},getHeightAllDay:function(){return Math.min(n.a.CalendarDayViewMaxAllDayHeight,26*this.numAllDay.get())+1},getDayViewY:function(){return 409},getDayWidth:function(){var e=this.getWidth();return this.getViewMode()===v.Calendar_Day?e:Math.max(e/7,40)},openItemEditor:function(e){e.pane=this,r.default.menus.openItemEditor(e)},getPaddingForPaneObject:function(e,t){var a=this._super.getPaddingForPaneObject.call(this,e,t);return t||(a+=this.extraPaddingForPaneObject(e)),a},extraPaddingForPaneObject:function(e){return this.isViewAgenda()?n.a.PaddingAgendaTime:0},shouldShowTime:function(e,t){var a="blockItem"===e.type&&e.item;return a&&!a.isNote()&&0===e.levelsDeep&&e.block.shouldShowTime()},isSearchedFlat:function(){try{r.default.PAssert(1578,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){r.default.reportError(e)}return!(this.isViewDates()||!this.search)&&!this.search.showHierarchy()},isItemTopLevel:function(e){var t=!0;return this.isViewProject()&&(t=e.isPrefixHeader(this)),t&&this._super.isItemTopLevel.call(this,e)},openViewMenu:function(e){r.default.menus.openContextMenu({componentName:"ReactContextMenuPaneMode",element:e.target,pane:this,onSelected:function(e,t){this.setViewMode(t)}.bind(this),subset:PaneMode.Task})},hasCollapsed:function(e){if(!e&&this.isViewAutoBlocks()){for(var t=0;this.blocks&&t<this.blocks.length;t++)if(this.isBlockCollapsed(this.blocks[t]))return!0;return!1}return this._super.hasCollapsed.call(this,e)},toggleCollapseAll:function(){var e=!this.hasCollapsed();if(this.isViewAutoBlocks()){for(var t=0;t<this.blocks.length;t++)this.blocksCollapsed[this.blocks[t].id]=e;e||(e=void 0)}this._super.collapseAll.call(this,e,this.isViewAutoBlocks())},supportsSortBlocks:function(){return!!i[this.getViewMode()]},supportsSortBlocksMode:function(e){return i[this.getViewMode()].Available.indexOf(e)>=0},supportsSortItems:function(){return this.isViewProject()||this.isViewTag()||this.isViewContact()||this.isViewPriority()||this.isViewOutline()&&this.isSearchedFlat()},getSortModeBlocks:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks},setSortModeBlocks:function(e,t){this.setViewProp("sortModeBlocks",e,t)},getSortModeItems:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems},setSortModeItems:function(e,t){this.setViewProp("sortModeItems",e,t)},getViewMode:function(){return this.viewState.get().viewMode},setViewMode:function(e){this.setViewProp("viewMode",e)},setViewProp:function(e,t,a){var i=this.viewState.get();i[e]!==t&&(i[e]=t,this.viewState.set(i,!1!==a))},createVMLI:function(e,t){var a=this.search.getTags();if(!this.isViewTag()&&a)for(var i=0;i<a.length;i++){var r=a[i],n="#"+r;if(e.text.indexOf(n)<0){for(var s=!1,o=t&&t.parent;o;){var l=o.getTags();if(l&&l.indexOf(r)>=0){s=!0;break}o=o.parent()}s||(e.text+=" "+n)}}return this._super.createVMLI.call(this,e,t)},getItemDisplayTime:function(e){var t=this.getSortModeBlocks(),a=e.item;return t===y.Date?a.time()||(e.showAllDay?"All day":""):t===y.Created?a._formatDateTime(a.dateCreated):t===y.Completed?a.dateCompleted?a._formatDateTime(a.dateCompleted):"no time":void 0}};o.a.inherit(c.a,E),o.a.extend(E.prototype,P),t.a=E},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(1).a.TaskSortMode;function s(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.id=e.id,this.text=e.name,this.search=this.pane.search,this.items=[],this.numInstancesOfItem={},r.a.forceBind("toggleCollapsed",this),r.a.forceBind("heightOfHeader",this),r.a.forceBind("compareItemsAgenda",this),r.a.forceBind("compareItemsCreated",this),r.a.forceBind("compareItemsCompleted",this);try{i.default.PAssert(2056,this.id,"Added an agenda block without an id")}catch(e){i.default.reportError(e)}}s.prototype={shouldShowTime:function(){return!this.isOverdue&&this.isDate},heightOfHeader:function(){return 32},heightOfSpaceBetween:function(){return 16},heightOfAddButton:function(){return this.heightOfHeader()+this.heightOfSpaceBetween()},numItems:function(){return this.items.length},getLastItem:function(){var e=this.items[this.items.length-1];return e&&e.isNote()&&(e=e.parent()),e},comparePriority:function(e,t){var a=e.priority(),i=t.priority();return a>i?-1:a<i?1:0},compareDate:function(e,t){try{i.default.PAssert(2057,this.date,"This block does not have a date",this.text)}catch(e){i.default.reportError(e)}var a=this.pane,r=e.getDate(a)||e.repeatDate(a)&&e.repeatDate(a).getDateOnDay(this.date),n=t.getDate(a)||t.repeatDate(a)&&t.repeatDate(a).getDateOnDay(this.date);if(e.isComplete()&&!t.isComplete())return-1;if(!e.isComplete()&&t.isComplete())return 1;if(e.isComplete()&&t.isComplete())return e.dateCompleted>t.dateCompleted?1:-1;if(r&&!n)return-1;if(!r&&n)return 1;if(!r&&!n)return 0;e.getDuration(a)>0&&(r=e.getDisplayDateWithDuration(this.date)),t.getDuration(a)>0&&(n=t.getDisplayDateWithDuration(this.date));var s=r.clone().clearTime(),o=n.clone().clearTime();if(!s.equals(o))return s<o?-1:1;if(r.hasTimeOfDay()&&n.hasTimeOfDay()){var l=r.getTimeOfDay(),d=n.getTimeOfDay();return l===d?0:l<d?-1:1}return r.hasTimeOfDay()?1:n.hasTimeOfDay()?-1:0},compareOrder:function(e,t){return e.hasAttachments()&&!t.hasAttachments()?-1:t.hasAttachments()&&!e.hasAttachments()?1:-1},compareItemsAgenda:function(e,t){i.default.DAssert(e,"Must have a valid left item to compare"),i.default.DAssert(t,"Must have a valid right item to compare"),i.default.DAssert(!e||e.parent(),"Must have a valid left parent item"),i.default.DAssert(!t||t.parent(),"Must have a valid right parent item"),e.isNote()&&(e=e.parent()),t.isNote()&&(t=t.parent());var a=this.isStarred||this.isImportant?0:this.compareDate(e,t);if(0===a){var r=this.isStarred?0:this.comparePriority(e,t);if(0===r){var n=this.compareDate(e,t);return 0===n?this.compareOrder(e,t):n}return r}return a},compareItemsCreated:function(e,t){return this.pane.compareDate(e.dateCreated,t.dateCreated)},compareItemsCompleted:function(e,t){return this.pane.compareDate(e.dateCompleted,t.dateCompleted)},addItem:function(e){try{i.default.PAssert(2059,e&&i.default.isVMLI(e),"Must be adding a valid item: "+i.default.getObjectInfo(e))}catch(e){i.default.reportError(e)}this.items.indexOf(e)<0&&this.items.push(e)},toggleCollapsed:function(){this.pane.setBlockCollapsed(this,!this.isCollapsed())},isCollapsed:function(){return this.pane.isBlockCollapsed(this)},getItemID:function(e){var t=this.numInstancesOfItem[e.id]||0;return this.numInstancesOfItem[e.id]=t+1,e.id+"_"+this.id+(t?"_"+t:"")},sort:function(){if(this.pane.isViewAgenda()){var e=this.pane.getSortModeBlocks();e===n.Date?this.items.sort(this.compareItemsAgenda):e===n.Created?this.items.sort(this.compareItemsCreated):e===n.Completed&&this.items.sort(this.compareItemsCompleted)}else if(this.sortMode&&this.sortMode!==n.None){var t=this.pane.getItemComparator(),a=this.items.map(function(e,t){return{index:t,item:e}});a.sort(t);var i=a.map(function(e){return e.item});this.items=i}}},t.a=s},function(e,t,a){"use strict";function i(){this.stack=[]}i.prototype={push:function(e){this.stack.push(e)},pop:function(e){this.stack.remove(e)},peek:function(){return this.stack[this.stack.length-1]},contains:function(e){return this.stack.indexOf(e)>=0}},t.a=i},function(e,t,a){"use strict";var i=a(0),r=a(7),n=a(5),s=(a(4),a(17)),o=a(15),l=a(10),d=a(9),c=a(84);a(11);function u(){this.fileMap={},this.isLoading=new d.a(!1),this.showError=new d.a(!1),this.listHeight=void 0,this.scrollDebounced=!1,this._openFile=void 0,this.loadCallbacks=[],this.init()}u.prototype={init:function(){0},hasFiles:function(){return i.default.vmMain.docManager.getDocList().get().length>0},showLoading:function(){return!this.hasFiles()&&!this.showError.get()},refreshFiles:function(){this.loadFileList()},runLoad:function(){i.default.vmMain.docManager.loadDocList(function(e){e||this.showError.set("Refresh Documents List"),this.isLoading.set(!1)}.bind(this))},loadFileList:function(){this.isLoading.get()||(this.isLoading.set(!0),this.showError.set(!1),this.runLoad())},requestOpenDocument:function(e){var t=i.default.vmMain.docManager.getDoc(e);t?this.openDocument(t):this.openDocumentFromId(e)},openDocumentFromId:function(e,t){try{i.default.PAssert(1219,e,"Document should always have a valid id")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1220,t,"Document should always have a valid title")}catch(e){i.default.reportError(e)}o.a.getDocId()!==e&&(s.a.hasPotentialUnsavedData()&&!i.default.hasPageDataBeenCleared()?i.default.toasts.pushMessage({text:"You have made changes that have not been saved to the server. Go online to sync.",actionText:"OKAY"}):i.default.isOffline()?i.default.toasts.pushMessage({text:"You are currently offline. Connect to the internet to switch files.",actionText:"OKAY"}):r.a.clearData(function(){o.a.setDocInfo(e,t),n.a.hasURLParam("file")?n.a.removeURLParam("file",!0):n.a.hasURLParam("state")&&n.a.removeURLParam("state",!0),setTimeout(function(){i.default.reload()},500)},r.a.defaultSkipSettings,!0))},openDocument:function(e){i.default.localDocChangeRequested=!0,this.openDocumentFromId(e.id,e.getTitle())},onTapReloadDocuments:function(e){this.loadFileList()},openSharing:function(e,t){i.default.menus.openModalNew(Modals.ShareDoc,{doc:e,callback:t})},onTapDocument:{onClick:function(e){var t=i.default.dataFor(e.target,!0);i.default.hasClass(e.target,"documentTitle")?this.onClickDocumentTitle(t):t instanceof c.a?(this.onClickDocumentSettings(t),e.stopImmediatePropagation()):"documentsList"!==e.target.id&&i.default.reportError(new Error("Incorrect document type: "+i.default.elementToString(e.target))),e.preventDefault(),e.stopImmediatePropagation()}},onTapAddDocument:function(){if(i.default.vmMain&&i.default.vmMain.isOnline()){var e=i.default.vmMain.docManager.createNewDoc();i.default.sendEvent("Menu","AddDocument"),this.openSharing(e,function(t){t&&i.default.vmMain.docManager.setDoc(e)}),l.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddDocument})}else i.default.toasts.pushMessage({text:"You must be online to create a new document."})},onTapRefresh:{onStart:i.default.handlerStopProp,onClick:function(){i.default.vmMain&&i.default.vmMain.isOnline()&&!this.isLoading.get()&&this.refreshFiles()}}},t.a=u},function(e,t,a){"use strict";var i=a(0),r=a(4),n=a(10),s=a(8),o=a(11),l=a(9);function d(){this.isVisible=new l.a(!1),this.mode=new l.a,this.aboutToShow=void 0,this.bottomPosition=new l.a(0),this.topBarHidden=!1,this.init()}d.prototype={init:function(){o.a.listen("closeKeyboard",this.hide.bind(this)),o.a.listen("itemsUpdated",s.a.closeKeyboardIfNoSelection)},preShow:function(){this.aboutToShow=!0,setTimeout(function(){this.aboutToShow=!1}.bind(this),100)},show:function(e){this.aboutToShow=!1,this.updatePosition(),this.mode.set(e),i.default.isKeyboardOpen=!0,(!r.a.ie||r.a.ie&&(r.a.mobro||r.a.winphone))&&this.isVisible.set(!0),setTimeout(function(){n.a.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.OpenKeyboard}),i.default.fireCustomEvent("keyboardOpened")},0)},hide:function(){!this.aboutToShow&&i.default.isKeyboardOpen&&(i.default.isKeyboardOpen=!1,i.default.focusedPane.removePadding(),i.default.onCloseKeyboard(),this.hideTopBarIfLandscape(),this.isVisible.set(!1),n.a.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.CloseKeyboard}))},shouldHideTopBar:function(){return r.a.orientation===Orientation.Landscape&&(i.default.isKeyboardOpen||this.aboutToShow)&&!i.default.getActiveSearch().UI.isFocused},hideTopBarIfLandscape:function(){this.shouldHideTopBar()?(i.default.setTransform(i.default.element("container"),0,-i.default.topBarHeight),this.topBarHidden=!0):this.topBarHidden&&(this.topBarHidden=!1,i.default.setTransform(i.default.element("container"),0,0))},updatePosition:function(){var e=r.a.getKBSize()-(this.shouldHideTopBar()?i.default.topBarHeight:0);e!==this.bottomPosition.get()&&this.bottomPosition.set(e),i.default.isKeyboardOpen&&i.default.focusedPane.addPadding()},getScroll:function(){return i.default.settings.get(Settings.keyboardToolbarScroll)},setScroll:function(e){i.default.settings.set(Settings.keyboardToolbarScroll,e)}};new d},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(7),s=a(1),o=a(2),l=a.n(o),d=a(10),c=a(4),u=a(9),h=a(19),f=a(60),p=a(126),m=a(8),g=a(11),v=a(6),y={display:"inline-block",height:"24px"};function S(){i.default.menus.openSettings(s.a.SettingsSections.Plugins)}function E(){i.default.intro=this}E.prototype={init:function(){this.mode=new u.a(s.a.HelpMode.None),this.position=new u.a,this.sections=new h.a,this.isVisible=new f.a([this.mode],function(){return this.isHelpShowing()}.bind(this)),this.priKey=c.a.priModKey,this.secKey=c.a.secModKey,this.secKeyForce=c.a.secModKeyForce,this.tooltipIntroSection=void 0;var e=i.default.settings.get(Settings.helpPaneState);void 0===e&&(e=s.a.HelpMode.None),this.initItemsDesktop(),i.default.isDemoMode()||(this.initState(e),i.default.settings.get(Settings.inTooltipIntro)&&this.tooltipIntroSection.isComplete.get()&&i.default.settings.set(Settings.inTooltipIntro,!1)),i.default.settings.registerForChangeNotification(Settings.helpPaneState,void 0,function(e,t){void 0!==t&&t!==e&&this.initState(t)}.bind(this)),i.default.settings.registerForChangeNotification(Settings.helpState,void 0,function(e,t){t&&t!==e&&this.loadState()}.bind(this)),d.a.addListener(this.onAction.bind(this))},isHelpShowing:function(){return this.mode.get()!==s.a.HelpMode.None},initState:function(e){try{i.default.PAssert(1479,void 0!==e,"Must pass in a valid intro mode")}catch(e){i.default.reportError(e)}this.sections.clear(),this.mode.set(e),this.isHotkeyMode()?this.initHotkeys():this.initHelp(),i.default.settings.get(Settings.inTooltipIntro)&&this.initTooltipIntro(),this.loadStateLegacy(),this.loadState()},initItemsDesktop:function(){this.itemIndent={id:"458052715",text:'Press <span class="hHotkey">Tab</span> to indent an item into a list and <span class="hHotkey">Shift + Tab</span> to unindent out of a list',check:this.checkIndent},this.itemDateTime={id:"321249113",text:"Add a date/time by typing @ in the text of an item",check:this.checkDate},this.itemRightClick={id:"3288459206",text:"Right click an item to explore more options",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.RightClick}};var e=i.default.vmMain.getDefaultEmailPlugin(),t=i.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar),a=i.default.vmMain.pluginManager.getPlugin(PluginID.Drive);this.itemPluginSettings={id:"ep",jsx:l.a.createElement("span",null,l.a.createElement("span",{style:y},l.a.createElement(v.a,{raised:!0,primary:!0,marginRight:8,onClick:S},"Enable plugins")),"to connect to your other services"),hiddenObservable:new f.a([e.isActiveObs,t.isActiveObs,a.isActiveObs]),check:function(){}},this.itemOpenEmail={id:"dblE",text:"Double click an email to open it",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenEmail&&e.data.pane.type===PaneMode.Gmail}},this.itemDragEmail={id:"drgEm",text:"Drag an email to your Tasks to organize it",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&e.data.fromPane&&e.data.fromPane.type===PaneMode.Gmail}},this.itemRightClickEmail={id:"rcE",text:"Right click an email to explore more options",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.RightClick&&e.data.pane.type===PaneMode.Gmail}},this.itemGmailLabels={id:"lbls",text:'Click <i class="overviewButtonNormal icon-menu g"></i> in the top left to access your labels',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ToggleOverview&&e.data.pane.type===PaneMode.Gmail}},this.itemGmailCompose={id:"cmp",text:'Click <i class="icon-edit2 g"></i> in the sidebar to compose a new email',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ComposeEmail}}},setMode:function(e){this.mode.set(e),i.default.settings.set(Settings.helpPaneState,e)},show:function(e){this.setMode(e||s.a.HelpMode.Normal)},toggle:function(e){!this.isHelpShowing()||e&&this.mode.get()!==e?this.show(e):this.close()},close:function(){i.default.tooltip.hideTip(),this.setMode(s.a.HelpMode.None),i.default.sendEvent("Menu","CloseHelp")},isHotkeyMode:function(){return this.mode.get()===s.a.HelpMode.Hotkeys},loadStateLegacy:function(){if(i.default.shouldWriteLocal())try{var e=r.a.storage.getItem("help");if(e){var t=JSON.parse(e);if(t){for(var a=0;a<this.sections.get().length;++a){this.sections.get()[a].loadFromSaveData(t)}console.log("found old data and migrating it"),this.saveState(),r.a.storage.removeItem("help")}}}catch(e){i.default.reportError(e)}},_getHelpStateObj:function(){var e={},t=i.default.settings.get(Settings.helpState);if(t)try{(e=JSON.parse(t))&&!i.default.isString(e)||(e={})}catch(e){i.default.reportError(e)}return e||{}},loadState:function(){var e=this._getHelpStateObj();if(e)for(var t=0;t<this.sections.get().length;++t)this.sections.get()[t].loadFromSaveData(e)},saveState:function(){if(i.default.shouldWriteLocal())try{var e=this.getState();0,i.default.settings.set(Settings.helpState,JSON.stringify(e))}catch(e){i.default.reportError(e)}},getState:function(){for(var e=this._getHelpStateObj(),t=0;t<this.sections.get().length;++t){this.sections.get()[t].saveData(e)}return e},notifyOfChange:function(){this.saveState()},createSection:function(e,t,a,i){var r=new p.a(e,t,i);r.owner=this;for(var n=0;n<a.length;n++)r.addStep(a[n]);return r},addSection:function(e,t,a,i){var r=this.createSection(e,t,a,i);return this.sections.push(r),r},initHotkeys:function(){this.addSection(null,"Basic",[{text:'<span class="introHotkey">Tab</span>Indent an item'},{text:'<span class="introHotkey">'+this.secKey+" + ]</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.secKeyForce+" + Shift + Right</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">Shift + Tab</span>Un-indent an item'},{text:'<span class="introHotkey">'+this.secKey+" + [</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.secKeyForce+" + Shift + Left</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.secKey+" + /</span>Complete an item"},{text:'<span class="introHotkey">'+this.secKeyForce+" + Enter</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.priKey+" + N</span>Create new item"},{text:'<span class="introHotkey">'+this.secKey+" + 1 | 2 | 3</span>Set item priority"},{text:'<span class="introHotkey">'+this.secKey+" + 8</span>Star an item"},{text:'<span class="introHotkey">'+this.secKeyForce+" + Up</span>Collapse item"},{text:'<span class="introHotkey">'+this.secKeyForce+" + Down</span>Uncollapse item"},{text:'<span class="introHotkey">'+this.secKey+" + ,</span>Toggle collapsed"},{text:'<span class="introHotkey">'+this.secKey+" + .</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.secKeyForce+" + Space</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.priKey+" + F</span>Search for text"},{text:'<span class="introHotkey">Shift + Enter</span>Add multi-line note'},{text:'<span class="introHotkey">'+this.secKey+" + Shift + 3</span>Make item project"},{text:'<span class="introHotkey">'+this.secKey+" + Shift + [</span>Make item task"}]);var e=c.a.mac?c.a.priModKey+" + Option + S":"Alt + Shift + S";this.addSection(null,"Navigation",[{text:'<span class="introHotkey">'+this.priKey+" + Enter</span>Zoom a pane in an item"},{text:'<span class="introHotkey">'+this.secKeyForce+" + Right</span>",isHotkeyOr:!0,if:c.a.mac},{text:'<span class="introHotkey">'+this.priKey+" + Shift + Enter</span>Zoom out a pane"},{text:'<span class="introHotkey">'+this.secKeyForce+" + Left</span>",isHotkeyOr:!0,if:c.a.mac},{text:'<span class="introHotkey">'+this.priKey+" + "+(c.a.mac?"Up":"Home")+"</span>Go to the top of a pane"},{text:'<span class="introHotkey">'+this.priKey+" + "+(c.a.mac?"Down":"End")+"</span>Go to the bottom of a pane"},{text:'<span class="introHotkey">'+this.secKey+" + G</span>Go to item in all panes"},{text:'<span class="introHotkey">'+this.secKey+" + J</span>Jump to item in current pane"},{text:'<span class="introHotkey">'+e+"</span>Toggle sidebar"},{text:'<span class="introHotkey">'+this.priKey+" + Shift + L</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.priKey+" + Shift + 1, 2, ...</span>Focus pane 1, 2, ..."}]),this.addSection(null,"Advanced",[{text:'<span class="introHotkey">'+this.secKey+" + Shift + /</span>Archive completed items"},{text:'<span class="introHotkey">'+(c.a.mac?"Ctrl + ⌘ + Up":"Alt + Shift + Up")+"</span>Move an item up in a list"},{text:'<span class="introHotkey">'+this.secKey+" + Shift + Up</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+(c.a.mac?"Ctrl + ⌘ + Down":"Alt + Shift + Down")+"</span>Move an item down in a list"},{text:'<span class="introHotkey">'+this.secKey+" + Shift + Down</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.secKey+" + Shift + ,</span>Collapse all top-level items"},{text:'<span class="introHotkey">'+this.secKey+" + Shift + .</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">'+this.secKey+" + Shift + Space</span>",isHotkeyOr:!0},{text:'<span class="introHotkey">Shift + F4</span>Close the current pane'},{text:'<span class="introHotkey">'+this.secKey+" + T</span>Add new pane"},{text:'<span class="introHotkey">'+this.priKey+" + Shift + B</span>Select Board"},{text:'<span class="introHotkey">'+this.secKey+" + M</span>Move selected item to target"}]);var t=this.addSection(null,"Text Editor",[{text:'<span class="introHotkey">'+this.secKey+" + Z</span>Undo your last action"},{text:'<span class="introHotkey">'+this.secKey+" + Y</span>Redo your last action"},{text:'<span class="introHotkey">'+(c.a.mac?"Option":"Ctrl")+" + Backspace</span>Delete the previous word"},{text:'<span class="introHotkey">'+(c.a.mac?"Option":"Ctrl")+" + Delete</span>Delete the next word"},{text:'<span class="introHotkey">'+this.secKeyForce+" + L</span>Select the current item"},{text:'<span class="introHotkey">'+this.priKey+" + K</span>Add Link"}]);c.a.mac&&(t.addStep({text:'<span class="introHotkey">'+this.secKeyForce+" + A</span>Select to start of line"}),t.addStep({text:'<span class="introHotkey">'+this.secKeyForce+" + E</span>Select to end of line"})),this.addSection(null,"Gmail",[{text:'<span class="introHotkey">'+this.secKey+" + E</span>Compose new email"}]),this.addSection(null,"In Gmail Pane",[{text:'<span class="introHotkey">R</span>Reply'},{text:'<span class="introHotkey">Shift + R</span>Reply All'},{text:'<span class="introHotkey">F</span>Forward'},{text:'<span class="introHotkey">I</span>Mark as read'},{text:'<span class="introHotkey">U</span>Mark as unread'},{text:'<span class="introHotkey">8</span>Star / unstar'},{text:'<span class="introHotkey">S</span>',isHotkeyOr:!0},{text:'<span class="introHotkey">1 | 2 | 3</span>Priority'},{text:'<span class="introHotkey">D</span>Snooze'},{text:'<span class="introHotkey">L</span>Label'},{text:'<span class="introHotkey">M</span>Add to Tasks'},{text:'<span class="introHotkey">V</span>',isHotkeyOr:!0},{text:'<span class="introHotkey">C</span>Move to Calendar'},{text:'<span class="introHotkey">E</span>Archive'},{text:'<span class="introHotkey">/</span>',isHotkeyOr:!0},{text:'<span class="introHotkey">Shift + E</span>Archive and close preview'},{text:'<span class="introHotkey">Y</span>Remove from current label'},{text:'<span class="introHotkey">Backspace</span>Delete'},{text:'<span class="introHotkey">Delete</span>',isHotkeyOr:!0}])},checkAddItem:function(e){if(e.type===TrackerType.Create){var t=n.a.getModel(e.data[0].itemID);return!(!t||t.parent()===n.a.getRootModel()&&0===e.data[0].position)}},checkIndent:function(e){if(e.type===TrackerType.Move){var t=n.a.getItem(e.data[0].oldParent);if(t&&t.items.indexOf(e.data[0].newParent)>=0)return!0}},checkSearch:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged},checkComplete:function(e){if(e.type===TrackerType.Update){var t=e.data[0];return"isComplete"===t.field&&t.newValue}},checkOverview:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ToggleOverview},checkZoom:function(e){return e.type===TrackerType.Zoom&&!e.data[0].zoomOut&&i.default.focusedPane.overview.isVisible.get()},checkPriority:function(e){var t=e.data[0];return e.type===TrackerType.Update&&"priority"===t.field&&t.newValue>0},checkDate:function(e){return e.type===TrackerType.Insert&&"@"===e.data[0].text},checkGoogleCalendar:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.AddToGCal},checkGoogleDrive:function(){},initHelp:function(){function e(){i.default.menus.openContextMenu({componentName:"ReactContextMenuOptions",element:"optionsButton"})}this.sections.clear(),this.addSection("2102025841","Organization",[this.itemIndent,{id:"3825397189",text:"Click and drag on the left edge of an item to move it",check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&i.default.vmMain.isLoaded)return!0}},{id:"441256378",text:'Click the left edge of a list or press <span class="hHotkey">'+this.secKey+" + ,</span> to collapse its subitems",check:function(e){if(e.type===TrackerType.Update){var t=e.data[0];return"isCollapsed"===t.field&&t.newValue}}}]),this.addSection("prefixes","Item Prefixes",[{id:"header",text:"Start a line with # to create a project",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SetPrefix&&e.data.prefix===s.a.Prefix.Header}},{id:"task",text:"Start a line with [ to create a task",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SetPrefix&&e.data.prefix===s.a.Prefix.Task}},{id:"bullet",text:"Start a line with - to create a bullet",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SetPrefix&&(e.data.prefix===s.a.Prefix.Bullet||e.data.prefix===s.a.Prefix.Bullet2||e.data.prefix===s.a.Prefix.Bullet3)}},{id:"numlist",text:"Start a line with 1. to create a numbered list",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SetPrefix&&e.data.prefix===s.a.Prefix.NumList}}]),this.addSection("3980400482","Dates",[this.itemDateTime,{id:"2538562480",text:'Write dates in plain English like <span class="date c-date">@tomorrow</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&i.default.vmMain.isLoaded)return!!e.data.date}},{id:"745092254",text:'Schedule a full date and time like <span class="date c-date">@today 2:30pm</span> or <span class="date c-date">@5/25 6:00</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&i.default.vmMain.isLoaded){var t=e.data.date;if(t)return t.hasTimeOfDay()}}},{id:"3023653298",text:'Describe urgency with <span class="date c-date">@now</span>, <span class="date c-date">@soon</span>, or <span class="date c-date">@later</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&i.default.vmMain.isLoaded){var t=n.a.getModel(e.data.itemID);return!!t&&i.default.isDateSoft(t.getDateText())}}},{id:"1941003875",text:'Create a repeating date like <span class="date c-date">@every friday</span> or <span class="date c-date">@every other tuesday</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&i.default.vmMain.isLoaded){var t=e.data.date;if(t)return t.isRepeatDate()}}},{id:"766730775",text:'Create a repeating date with a beginning or end <span class="date c-date">@every friday from tomorrow</span> or <span class="date c-date">@every other tuesday until october</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&i.default.vmMain.isLoaded){var t=e.data.date;if(t&&t.isRepeatDate())return!t.getStartDate().equals(Date.today())||!!t.getEndDate()}}}]),this.addSection("cal","Google Calendar (Premium)",[{id:"enableCalendar",jsx:l.a.createElement("span",null,l.a.createElement(v.a,{raised:!0,primary:!0,marginRight:8,onClick:S},"Enable Google Calendar"),"to sync Google Calendar."),hiddenObservable:i.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar).isActiveObs,check:function(){}},{id:"adc2",text:'Add an item with a date to Google Calendar by pressing <span class="hHotkey">'+this.secKeyForce+' + C</span> or right clicking the date.<span style="color: #777;"></span>',check:this.checkGoogleCalendar}]),this.addSection("3971635305","Priority",[this.itemRightClick,{id:"215510164",text:'Set a priority with the right click menu or <span class="hHotkey">'+this.secKey+" + 1|2|3</span>",check:this.checkPriority},{id:"2165585377",text:'Click the right edge of an item or <span class="hHotkey">'+this.secKey+" + /</span> to complete it",check:this.checkComplete},{id:"4286506454",text:'Press <span class="hHotkey">'+this.secKey+" + 8</span> to star an item and highlight it in yellow",check:function(e){if(e.type===TrackerType.Update){var t=e.data[0];return"isStarred"===t.field&&t.newValue}}}]),this.addSection("4240025947","Contacts",[{id:"9158366",text:"Add a contact by typing + in the text of an item",check:function(e){return e.type===TrackerType.Insert&&"+"===e.data[0].text}},{id:"1594166733",text:'Click on a <span class="contact c-contact">+contact</span> to start a call or email',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenContact}}]),this.addSection("1493247039","Zooming",[{id:"1829655333",text:'To zoom in on an item, right click it and select Zoom In, press <span class="hHotkey">'+this.priKey+' + Enter</span>, or hold <span class="hHotkey">'+this.priKey+"</span> and click its left edge",check:function(e){return e.type===TrackerType.Zoom&&!e.data[0].zoomOut}},{id:"3440644647",text:"To zoom back out, click the title of the list in the top of the pane",check:function(e){return e.type===TrackerType.Zoom&&e.data[0].zoomOut}},{id:"801492595",text:'Press <i class="overviewButtonNormal icon-menu g"></i> in the top left of a pane to open the overview',check:this.checkOverview},{id:"1720747864",text:'Click an item in the Overview to scroll to it or click <i class="icon-zoom-in g"></i> to zoom into it',check:this.checkZoom}]),this.addSection("1393893782","Search",[{id:"3689209442",text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag',check:function(e){return e.type===TrackerType.Insert&&e.data[0].text===s.a.TagPrefix}},{id:"2783340419",text:'Filter by priority by clicking the <span class="searchPriority searchP0 hovered"></span> <span class="searchPriority searchP1 hovered"></span> <span class="searchPriority searchP2 hovered"></span> buttons',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&0!==e.data.priority}},{id:"923656242",text:'Show only starred items by clicking the <span class="c-foreground-faded icon-star"></span> button',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&0!==e.data.starred}},{id:"2227925102",text:'Hide completed items by clicking the <span class="c-foreground-faded icon-check"></span> button',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&0!==e.data.complete}},{id:"457209713",text:"Hide items you're not interested in by starting a search with - (dash)",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data.text.indexOf("-")>=0}}]),this.addSection("gm","Gmail",[{id:"eG",jsx:l.a.createElement("span",null,l.a.createElement(v.a,{raised:!0,primary:!0,marginRight:8,onClick:S},"Enable Gmail"),"to sync Gmail."),hiddenObservable:i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail).isActiveObs,check:function(){}},this.itemOpenEmail,this.itemDragEmail,this.itemRightClickEmail,this.itemGmailLabels]),this.addSection("formatting","Formatting",[{id:"format",text:"Format text like <i>*italic*</i>, <b>**bold**</b>, or <b><i>***both***</i></b>",check:function(e){}},{id:"link",text:"Insert links like [title](http://address.com)",check:function(e){}},{id:"hr",text:"--- to insert a horizontal line",check:function(e){}}]),this.addSection("327865517","Collaboration",[{id:"3453735943",jsx:l.a.createElement("span",null,l.a.createElement("span",{style:y},"Click the ",l.a.createElement(v.a,{icon:"icon-folder",iconSize:18},"File"))," in the options button to open the Files menu"),check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocumentsMenu}},{id:"4176091097",text:'Click <i class="icon-settings f18 g"></i> to change the sharing settings',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocSharing}}]),this.addSection("drv","Google Drive (Premium)",[{id:"eD",jsx:l.a.createElement("span",null,l.a.createElement(v.a,{raised:!0,primary:!0,marginRight:8,onClick:S},"Enable Google Drive"),"to sync Google Drive."),hiddenObservable:i.default.vmMain.pluginManager.getPlugin(PluginID.Drive).isActiveObs,check:function(){}},{id:"drL",text:"Drag a file from the Google Drive Pane to an Task Pane to add it to a list",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&e.data.fromPane&&e.data.fromPane.type===PaneMode.Drive}},{id:"drDr",text:"Drag a file from your "+(c.a.mac?"Finder":"Explorer")+" to your Tasks to upload it to Drive and add it to a list",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DriveUpload}}]),this.addSection("set","Settings",[{id:"oS",jsx:l.a.createElement("span",null,"Click ",l.a.createElement("span",{style:y},l.a.createElement(v.a,{icon:"icon-settings",iconSize:18,onClick:e}))," in the sidebar, then Settings, to access plugin and account settings."),check:function(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.OpenSettingsMenu}},{id:"oDS",jsx:l.a.createElement("span",null,"Click ",l.a.createElement("span",{style:y},l.a.createElement(v.a,{icon:"icon-settings",iconSize:18,onClick:e}))," in the sidebar, then Display Settings, to change display settings."),check:function(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.OpenDisplaySettings}}]),this.addSection("3926176240","Data",[{id:"1927292896",jsx:l.a.createElement("span",null,"Click on Import Data in the options menu in the sidebar, then choose the app to import from and follow the instructions. If you do not see your app, try using copy and paste to paste it in to Moo.do. If that does not work, please ",l.a.createElement(v.a,{primary:!0,onClick:function(){i.default.menus.openModalNew(Modals.ReportBug)}},"contact us")," and tell us what app you want to import from."),check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenImport}},{id:"67562060",text:"Click on Export Data in the options menu in the sidebar, then choose the format you'd like.",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenExport}}])},onAction:function(e){if(!i.default.menus.isModalOpen(Modals.ImportData))try{for(var t=this.sections.get(),a=0;a<t.length;++a)t[a].isComplete.get()||t[a].check(e)}catch(e){i.default.reportError(e)}},runTooltipIntro:function(){i.default.settings.set(Settings.inTooltipIntro,!0),this.initTooltipIntro()},initTooltipIntro:function(){function e(){return i.default.vmMain.pluginManager.isGmailPaneEnabled()}function t(e){try{i.default.PAssert(1480,e,"Must supply a valid tooltip descriptor")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1481,!e||e.element,"Must specify a valid target tooltip element")}catch(e){i.default.reportError(e)}i.default.tooltip.hideSticky(e.text),e.blue=e.sticky=!0,"top"===e.arrowDirection&&(e.offset={top:15}),i.default.tooltip.displayTip(e)}var a,r,n,s=[];function o(e){var a=!1;s.push({id:e.id,check:function(r){return!(!e.check2Invalidates1||!e.check2(r))||(e.check1(r)?(setTimeout(function(){var r=i.default.isFunction(e.element)?e.element():e.element,n=i.default.isFunction(e.text)?e.text():e.text;r&&(a=!0,t({text:n,element:r,arrowDirection:e.arrowDirection,onRight:e.onRight}))},1e3),!0):void 0)}}),s.push({id:e.id+"_complete",check:function(t){if(e.check2(t)){if(a){var r=i.default.isFunction(e.text)?e.text():e.text;i.default.tooltip.hideSticky(r)}return!0}}})}if(o({id:"tipAddPaneMenu",text:"Click here to add a new pane",element:function(){return i.default.element("addPaneButton")},arrowDirection:"left",check2Invalidates1:!0,check1:this.checkAddItem,check2:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenAddPaneMenu}}),o({id:"tipAddPane",text:function(){return e()?"Add a Gmail pane to organize your email":"Add another Task pane to get another view on your tasks."},element:function(){return e()?i.default.element("addPane_PaneGmail"):i.default.element("addPane_PaneTask")},arrowDirection:"left",check2Invalidates1:!0,onRight:!0,check1:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenAddPaneMenu},check2:function(t){return t.type===TrackerType.UIAction&&t.data[0].type===TrackerUIAction.AddPane&&t.data[0].data.type===(e()?PaneMode.Gmail:PaneMode.Task)}}),o({id:"tipNewTaskPane",text:"Each Task pane is a unique view on the same data. Customize your view by searching and filtering.",element:function(){if(a){var e=a.element;if(e)return e.getElementsByClassName("searchWrap")[0]}},arrowDirection:"top",check1:function(e){if(e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane&&e.data[0].data.type===PaneMode.Task)return a=e.data[0].data.pane,!0},check2:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged}}),o({id:"tipNewGmailPane",text:"Try dragging an email to your Task Pane",element:function(){if(r){var e=r.element;if(e)return e.getElementsByClassName("paneContent")[0]}},arrowDirection:"bottom",check2Invalidates1:!0,check1:function(e){if(e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane&&e.data[0].data.type===PaneMode.Gmail&&i.default.vmMain.paneManager.getPanesByType(PaneMode.Task).length>0)return r=e.data[0].data.pane,!0},check2:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&e.data.fromPane&&e.data.fromPane.type===PaneMode.Gmail}}),o({id:"tipNewGmailPane",text:"Each board is a different set of panes. Add a new pane to start setting up your new board.",element:function(){return i.default.element("addPaneButton")},arrowDirection:"left",onRight:!0,check1:function(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddBoard},check2:function(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane}}),o({id:"tipAddToCalendar",text:function(){return"Sync items with dates to Google Calendar by pressing "+c.a.secModKeyForce+" + C"},element:function(){var e=m.a.getStartElement();if(e)return e.getElementsByClassName("date")[0]},arrowDirection:"top",check1:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&i.default.vmMain.isLoaded&&i.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar).isActive())return!0},check2:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.AddToGCal}}),o({id:"tipOverviewButton",text:"Toggle the Overview open and closed",element:function(){var e=n.element;if(e)return e.getElementsByClassName("overviewButton")[0]},arrowDirection:"top",check1:function(e){if(e.type===TrackerType.Zoom)return n=e.data[0].pane,!0},check2:this.checkOverview,check2Invalidates1:!0}),i.default.vmMain.shouldShowHelp("helpTooltip")){setTimeout(function e(){if(i.default.tooltip.isOpenSticky())setTimeout(e,5e3);else{var a={text:"See the Help to learn more",element:i.default.element("helpButton"),arrowDirection:"left",onRight:!0};i.default.vmMain.closeHelp("helpTooltip"),g.a.listen("helpOpened",function e(){i.default.tooltip.hideSticky(a.text),g.a.unlisten("helpOpened",e)}),t(a)}},9e4)}this.tooltipIntroSection=this.addSection("tooltipIntro","Tooltip Intro",s,!0)}};new E},function(e,t,a){"use strict";var i=a(0),r=a(9);function n(e,t,a){this.isComplete=new r.a(!1),this.id=e,this.text=t,this.noRender=a,this.items=[],this.inOrder=!1,this.enforceOrder=!1,this.owner=void 0,this.numComplete=0,this.next=0}n.prototype={defaultShow:function(){this.isDisabled.set(!1)},loadFromSaveData:function(e){this.numComplete=0;for(var t=0,a=0;a<this.items.length;++a){var r=this.items[a];e[r.id]&&(r.isComplete.set(!0),this.numComplete++,this.inOrder&&(this.next=Math.max(this.next,a+1))),r.hiddenObservable&&r.hiddenObservable.get()||r.visibleObservable&&!r.visibleObservable.get()||t++}if((this.numComplete===t||e[this.id])&&this.isComplete.set(!0),this.inOrder&&0!==this.next&&this.next<t){var n=this.items[this.next];n&&(n.show(),!i.default.isKeyboardOpen&&this.owner.needsKeyboardOpen&&i.default.tooltip.hideTip())}},saveData:function(e,t){for(var a=0;a<this.items.length;++a){var r=this.items[a];try{i.default.PAssert(2044,r,"Item entries must exist")}catch(e){i.default.reportError(e)}r.isComplete.get()&&(e[r.id]=1)}t&&this.isComplete.get()&&(e[this.id]=1)},addStep:function(e){try{i.default.PAssert(2045,!!e.id==!!e.check,"Invalid help step")}catch(e){i.default.reportError(e)}!1!==e.if&&(e.isComplete||(e.isComplete=new r.a(!1)),this.inOrder?e.isDisabled||(e.isDisabled=new r.a(this.items.length>0)):e.isDisabled=new r.a(!1),e.isHotkeyOr=e.isHotkeyOr,e.show||(e.show=this.defaultShow.bind(e)),this.items.push(e))},complete:function(e){e.isComplete.get()||(e.isComplete.set(!0),this.numComplete++,this.numComplete===this.items.length&&this.isComplete.set(!0),this.owner.notifyOfChange(e))},forceComplete:function(){this.isComplete.set(!0),this.numComplete=this.items.length,this.owner.notifyOfChange()},check:function(e){try{i.default.PAssert(2046,!this.isComplete.get(),"Should never be checking items in a completed section")}catch(e){i.default.reportError(e)}for(var t=0;t<this.items.length;t++){var a=this.items[t];if(!a.isComplete.get()&&((!0===e||a.check&&a.check(e))&&(this.complete(a),this.inOrder&&t===this.next&&(this.next++,this.next<this.items.length&&this.items[this.next].show())),this.enforceOrder))break}}},t.a=n},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(5),s=a(9),o=a(10),l=0;function c(e,t){try{i.default.PAssert(1418,e,"Must provide valid message info")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1419,t,"Must provide a valid message owner")}catch(e){i.default.reportError(e)}if(this.id=e.id||"Message_"+l++,this.owner=t,this.timeout=e.timeout||5e3,this.text=new s.a(e.text),this.action=e.action||MessageAction.Default,this.isBig=e.big,this.data=e.data,this.hold=!e.timeout&&!1!==e.hold&&(e.hold||this.action!==MessageAction.Default),this.noIgnore=e.noIgnore,this.onCloseFn=e.onClose,this.clearTimeout=void 0,this._isVisible=!1,this.actionText=e.actionText,!this.actionText)switch(this.action){case MessageAction.Default:this.actionText="";break;case MessageAction.Reload:case MessageAction.ResetClient:this.actionText="RELOAD";break;case MessageAction.Okay:this.actionText="OKAY";break;case MessageAction.Blog:this.actionText="BLOG";break;case MessageAction.Undo:this.actionText="UNDO";break;case MessageAction.LoginScreen:this.actionText="LOGIN";break;case MessageAction.Contact:this.actionText="CONTACT";break;case MessageAction.OpenSettings:case MessageAction.OpenAccountSettings:case MessageAction.OpenLinkedSettings:case MessageAction.OpenGeneralSettings:case MessageAction.OpenCalendarSettings:this.actionText="SETTINGS";break;case MessageAction.OpenGoogleDrive:this.actionText="GOOGLE DRIVE";break;case MessageAction.OpenDisplaySettings:this.actionText="DISPLAY SETTINGS";break;case MessageAction.StartDemo:this.actionText="START DEMO"}}c.prototype={show:function(){this._isVisible||(this._isVisible=!0,this.hold||(this.clearTimeout=setTimeout(this.hide.bind(this),this.timeout)),this.owner.onMessageShow(this))},hide:function(e){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),e||this.owner.onMessageHide(this))},isVisible:function(){return this._isVisible},doAction:function(e){if(this.isVisible()){if(i.default.isFunction(this.action))this.action();else switch(this.action){case MessageAction.None:case MessageAction.Okay:case MessageAction.Default:break;case MessageAction.Reload:i.default.reload();break;case MessageAction.Login:n.a.removeURLParam("demo");break;case MessageAction.Demo:n.a.insertURLParam("demo","true");break;case MessageAction.ResetClient:d.clearData(function(){i.default.reload()});break;case MessageAction.OpenURL:var t=this.data?this.data.url:void 0;try{i.default.PAssert(1420,t,"Should always have a valid URL to navigate")}catch(e){i.default.reportError(e)}t&&i.default.openUrl(t);break;case MessageAction.Blog:i.default.openUrl("https://www.moo.do/blog/updates");break;case MessageAction.Undo:o.a.undoAction();break;case MessageAction.LoginScreen:n.a.removeURLParam("demo",!0),n.a.removeURLParam("dmode");break;case MessageAction.Contact:i.default.menus.openModalNew(Modals.ReportBug);break;case MessageAction.OpenSettings:i.default.menus.openSettings(r.a.SettingsSections.Plugins);break;case MessageAction.OpenGeneralSettings:i.default.menus.openSettings(r.a.SettingsSections.General);break;case MessageAction.OpenAccountSettings:i.default.menus.openSettings(r.a.SettingsSections.Account);break;case MessageAction.OpenLinkedSettings:i.default.menus.openSettings(r.a.SettingsSections.Linked);break;case MessageAction.OpenCalendarSettings:i.default.menus.openSettings(r.a.SettingsSections.GoogleCalendar);break;case MessageAction.OpenGoogleDrive:i.default.openUrl("https://drive.google.com");break;case MessageAction.OpenDisplaySettings:i.default.vmMain.isDisplaySettingsOpen.set(!0);break;case MessageAction.StartDemo:window.postMessage("resume","*");break;default:try{i.default.PAssert(1421,!1,"Invalid message action, add a new case here or pass in a function",this.action)}catch(e){i.default.reportError(e)}}this.hide()}},onTapIgnore:function(e){this.isVisible()&&!this.noIgnore&&this.hide()},setText:function(e){this.text.set(e)}},t.a=c},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(1),s=a(42),o=a(11),l=a(85),d=a(129),c=a(134),u=a(135),h=a(142),f=a(143),p=i.default.seconds(30);function m(){this._plugins={},this._activePlugins=[],this._loadedDependencies={},this._isOnline=navigator.onLine,this._iteratingPlugins=!1,this._hasAdjustedCacheSizeRatio=!1,this._queueTimeout=void 0,this._forcedLastPossible=!1,this._numOutstandingReqs=0,this._pluginRenderer=new l.a,this.init()}m.prototype={init:function(){r.a.forceBind("_pumpRequestQueues",this),r.a.forceBind("_handleRequestResponse",this),r.a.forceBind("_handleBatchRequestResponse",this),this._setupRequestQueues(),this._pluginRenderer.registerDefaultRenderers(),i.default.billingManager.hasPremiumFeatures()?(this.notifyDependencyLoad(PluginDependency.EarlyAccess),this.notifyDependencyLoad(PluginDependency.PremiumSub)):i.default.billingManager.hasEarlyAccess()&&this.notifyDependencyLoad(PluginDependency.EarlyAccess),i.default.isDemoMode()&&this.notifyDependencyLoad(PluginDependency.DemoMode),window.addEventListener("offline",this.goOffline.bind(this)),window.addEventListener("online",this.goOnline.bind(this)),o.a.listen("resetEverything",this._clearRequestQueues.bind(this)),log("Cache Size Ratio: ",this.getCacheSizeRatio())},printStats:function(e){if(log("---- Plugin Stats ----"),void 0!==e){var t=this._plugins[e];log(t.name),log(" Stats: ",t.getStats())}else for(var a=Object.keys(this._plugins),i=0;i<a.length;++i){var r=(t=this._plugins[a[i]]).getStats();log(t.name),log(" Stats: ",r)}log("----------------------")},dumpQueueState:function(){var e=Object.keys(this._plugins);console.log("Queue State: ["+this._numOutstandingReqs+"]");for(var t=0;t<e.length;++t){var a=this._plugins[e[t]];console.log(a.name),a.dumpRequestQueue(!1)}},dumpQueueStats:function(){for(var e=Object.keys(this._plugins),t=0;t<e.length;++t){var a=this._plugins[e[t]];console.log(a.name),a.dumpQueueStats()}},getStats:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getStats();else for(var a=Object.keys(this._plugins),i=0;i<a.length;++i){var r=this._plugins[a[i]];t[r.id]=r.getStats()}return t},getCacheStats:function(e,t){var a={};if(void 0!==e)this._plugins[e].getCacheStats(t);else for(var i=Object.keys(this._plugins),r=0,n=0;n<i.length;++n){this._plugins[i[n]].getCacheStats(function(e,n){n&&(a[e]=n),i.length===++r&&t(a)}.bind(this,i[n]))}},getState:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getState();else for(var a=Object.keys(this._plugins),i=0;i<a.length;++i){var r=this._plugins[a[i]];t[r.id]=r.getState()}return t},registerPlugins:function(){try{this.registerPlugin(new h.a)}catch(e){i.default.reportError(e)}try{this.registerPlugin(new d.a)}catch(e){i.default.reportError(e)}try{this.registerPlugin(new u.a)}catch(e){i.default.reportError(e)}try{this.registerPlugin(new f.a)}catch(e){i.default.reportError(e)}try{this.registerPlugin(new c.a)}catch(e){i.default.reportError(e)}},registerPlugin:function(e){try{i.default.PAssert(1297,!this._plugins[e.id],"Should never double-register a plguin")}catch(e){i.default.reportError(e)}this._plugins[e.id]=e,this.isAuthorized(e.id)&&this.loadPlugin(e.id)},getPlugin:function(e){return this._plugins[e]},getPluginFromPreviewCache:function(e){for(var t in this._plugins){var a=this._plugins[t];if(a._previewCache===e)return a}},loadPlugin:function(e){var t=this.getPlugin(e);try{i.default.PAssert(1298,t,"Must register a plugin before loading it")}catch(e){i.default.reportError(e)}this.activatePlugin(t)},unloadPlugin:function(e){},authorizePlugin:function(e,t,a){try{i.default.PAssert(1299,a&&i.default.isFunction(a),"Must provide a valid callback fn")}catch(e){i.default.reportError(e)}var r=this.getPlugin(e);try{i.default.PAssert(1300,r,"Must register a plugin before loading it")}catch(e){i.default.reportError(e)}r.authorize(t,function(e){this.onPluginAuthorized(r,e),a(e)}.bind(this))},deauthorizePlugin:function(e,t){try{i.default.PAssert(1301,t&&i.default.isFunction(t),"Must provide a valid callback fn")}catch(e){i.default.reportError(e)}var a=this.getPlugin(e);try{i.default.PAssert(1302,a,"Must register a plugin before loading it")}catch(e){i.default.reportError(e)}a.setSetting(a.Settings.IsEnabled,!1),this.deactivatePlugin(a),t(!0)},onPluginAuthorized:function(e,t){e.setSetting(e.Settings.IsEnabled,t),t&&this.activatePlugin(e)},activatePlugin:function(e){try{i.default.PAssert(1303,e,"Plugin must be valid to be activated")}catch(e){i.default.reportError(e)}this._activePlugins.indexOf(e.id)<0?e.activate(this._loadedDependencies)&&this._activePlugins.push(e.id):e.ensurePaneTypeIsActive()},deactivatePlugin:function(e){try{i.default.PAssert(1304,e,"Plugin must be valid to be deactivated")}catch(e){i.default.reportError(e)}this._activePlugins.indexOf(e.id)>=0&&(e.deactivate()&&this._activePlugins.remove(e.id))},isOnline:function(){return this._isOnline||i.default.isDemoMode()},goOnline:function(){this._isOnline=!0,setTimeout(function(){this._setupRequestQueues(!0);for(var e=0;e<this._activePlugins.length;++e){var t=this._plugins[this._activePlugins[e]];try{t.goOnline()}catch(e){this._reportPluginError(e)}}}.bind(this),2500)},goOffline:function(){this._isOnline=!1;for(var e=0;e<this._activePlugins.length;++e){var t=this._plugins[this._activePlugins[e]];try{t.goOffline()}catch(e){this._reportPluginError(e)}}},onDocumentShared:function(e){for(var t=0;t<this._activePlugins.length;++t){var a=this._plugins[this._activePlugins[t]];try{a.onDocumentShared(e)}catch(e){this._reportPluginError(e)}}},writeCaches:function(){for(var e=0;e<this._activePlugins.length;++e){var t=this._plugins[this._activePlugins[e]];try{t.saveOfflineCache()}catch(e){this._reportPluginError(e)}}},onShutdown:function(e){e&&this.writeCaches();for(var t=[],a=0;a<this._activePlugins.length;++a){var i=this._plugins[this._activePlugins[a]];try{var r=i.onShutdown();r&&t.push(r)}catch(e){this._reportPluginError(e)}}return t.length>0?t:void 0},onPurgeData:function(){for(var e=0;e<this._activePlugins.length;++e){var t=this._plugins[this._activePlugins[e]];try{t.clearOfflineCache(!0)}catch(e){this._reportPluginError(e)}}},onClearData:function(){for(var e=0;e<this._activePlugins.length;++e){var t=this._plugins[this._activePlugins[e]];try{t.clearData()}catch(e){this._reportPluginError(e)}}},getCacheSizeRatio:function(){var e=i.default.settings.get(Settings.cacheSizeRatio)||1;try{i.default.PAssert(1305,e>=0&&e<=1,"Invalid ratio value: ",e)}catch(e){i.default.reportError(e)}return e},hasAdjustedCacheSizeRatio:function(){return this._hasAdjustedCacheSizeRatio},_adjustCacheSizeRatio:function(){var e=this.getCacheSizeRatio();1===e&&i.default.sendEvent("CacheRatioChange","FromDefault");e>.35?e-=.1:i.default.sendEvent("CacheRatioChange","Minimum"),i.default.sendEvent("CacheRatioChange","Change",e),i.default.settings.set(Settings.cacheSizeRatio,e)},onCacheLimitExceeded:function(){if(!this._hasAdjustedCacheSizeRatio){this._hasAdjustedCacheSizeRatio=!0,this._adjustCacheSizeRatio();for(var e=0;e<this._activePlugins.length;++e){var t=this._plugins[this._activePlugins[e]];try{t.onCacheLimitExceeded()}catch(e){this._reportPluginError(e)}}}},getPluginsForType:function(e){var t;switch(e){case n.a.PluginType.Calendar:t=[PluginID.GCalendar];break;case n.a.PluginType.Email:t=[PluginID.Gmail];break;case n.a.PluginType.Storage:t=[PluginID.Drive];break;case n.a.PluginType.Unknown:t=[PluginID.Mailbird,PluginID.Moodo]}return t},hasAttachmentType:function(e,t){var a=!1;if(e.hasAttachments())for(var i=this.getPluginsForType(t),r=0;r<i.length;++r)if(e.hasPluginAttachment(i[r])){a=!0;break}return a},allowTextEditing:function(e){var t=!0;if(e&&e.hasAttachments())for(var a=e.getAttachments(),i=0;i<a.length;++i)if(!a[i].getPlugin().allowTextEditing(e,a[i])){t=!1;break}return t},validatePlugin:function(e){},runForEachPlugin:function(e){this._iteratingPlugins=!0;for(var t=0;t<this._activePlugins.length;++t)try{e(this.getPlugin(this._activePlugins[t]))}catch(e){i.default.reportError(e)}this._iteratingPlugins=!1},getAttachment:function(e,t){try{i.default.PAssert(1306,e.p,"Must specify the plugin string to be used: ",e)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1307,e.id,"Must specify the ID of the data to use from the plugin: ",e)}catch(e){i.default.reportError(e)}var a=this.getPlugin(e.p);try{i.default.PAssert(1308,a,"Must specify a valid plugin: ",e)}catch(e){i.default.reportError(e)}if(a)return a.isActive()||this.activatePlugin(a),a.getAttachment(e.id,t?e:void 0)},createDisplayElement:function(e,t){try{i.default.PAssert(1309,e.p,"Must specify the plugin string to be used")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1310,e.id,"Must specify the ID of the data to use from the plugin")}catch(e){i.default.reportError(e)}var a,r=this.getPlugin(e.p);if(r){var n=this.getAttachment(e,t);if(n)try{a=r.createDisplayElement(n)}catch(t){this._reportPluginError(t),a=this.createUnknownPluginElement(e.p)}else a=this.createUnknownPluginElement(e.p)}else a=this.createUnknownPluginElement(e.p);return a},createUnknownPluginElement:function(e){return{attrs:{cls:[],isUnknown:!0,plugin:PluginID.Moodo,"plugin-id":"Invalid"}}},measureAttachment:function(e,t){try{i.default.PAssert(1311,t&&t.attrs&&t.attrs.plugin,"Must have a valid plugin ID for measuring")}catch(e){i.default.reportError(e)}var a=0,r=this.getPlugin(t.attrs.plugin);try{i.default.PAssert(1312,r,"Should always be able to find a valid plugin: ",t.attrs.plugin)}catch(e){i.default.reportError(e)}return r&&(a=r.measureAttachment(e,t)),a},parseAttachmentEmbedString:function(e,t){try{i.default.PAssert(1313,e,"Must provide a valid string to parse")}catch(e){i.default.reportError(e)}var a=e.replace(/&quot;/g,'"').split(","),r={};if(a.forEach(function(e){var t=e.indexOf(":"),a=e.substr(0,t),i=e.substr(t+1,e.length-t-1);r[a]=i}),t){var n=a.length>2;r.displayElement=this.createDisplayElement(r,n)}return r},getAttachmentFromElement:function(e){var t=e.getAttribute("plugin"),a=e.getAttribute("plugin-id");try{i.default.PAssert(1314,t,"Element must have a plugin set")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1315,a,"Element must have a plugin ID set")}catch(e){i.default.reportError(e)}return this.getPlugin(t).getAttachment(a)},handleDropEvent:function(e,t){for(var a=!1,r=0;r<this._activePlugins.length&&!a;++r){var n=this._activePlugins[r],s=this.getPlugin(n);try{a=s.handleDropEvent(e,t)}catch(e){this._reportPluginError(e)}}return a||(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0||e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length>0)&&i.default.toasts.pushMessage({text:"Attaching files is a Premium feature, using the Drive plugin. Please enable Drive in the settings.",action:MessageAction.OpenSettings}),a},handleTapEvent:function(e,t,a,r){var n=!1,s=i.default.getPluginForElement(a.target);if(s){var o=s.getAttribute("plugin"),l=this.getPlugin(o);try{i.default.PAssert(1316,l,"Must be able to get a valid plugin from a plugin element")}catch(e){i.default.reportError(e)}if(l.isPluginBlocked())i.default.toasts.pushMessage(MessageID.PremiumRequired),n=!0;else{var d=s.getAttribute("plugin-id");try{i.default.PAssert(1317,d,"Must have a valid item ID for a plugin element")}catch(e){i.default.reportError(e)}try{n=l[r](e,t,d,a)}catch(e){this._reportPluginError(e)}}}return n},handleTapStart:function(e,t,a){return this.handleTapEvent(e,t,a,"handleTapStart")},handleTapClick:function(e,t,a){if(!t.isEditable||platform.mac&&a.metaKey||!platform.mac&&a.ctrlKey||i.default.hasClass(a.target,"plugin"))return this.handleTapEvent(e,t,a,"handleTapClick")},handleDoubleTap:function(e,t,a){return this.handleTapEvent(e,t,a,"handleDoubleTap")},isAuthorized:function(e){return!!i.default.isDemoMode()||!!this.getPlugin(e)&&!!this.getSetting(e,this.getPlugin(e).Settings.IsEnabled)},getSetting:function(e,t){return this.getPlugin(e).getSetting(t)},setSetting:function(e,t,a){return this.getPlugin(e).setSetting(t,a)},onAuthorizedSetting:function(e,t,a){this.getPlugin(e).onAuthorizedSetting(t,a)},isDependencyLoaded:function(e){return!!this._loadedDependencies[e]},notifyDependencyLoad:function(e,t){for(var a in this._loadedDependencies[e]=t||!0,this._plugins)try{this.getPlugin(a).onDependencyLoaded(e,t)}catch(e){this._reportPluginError(e)}},notifyDependencyUnload:function(e,t){},_handleBatchRequestResponse:function(e,t){try{i.default.PAssert(1319,e,"Plugin must be passed to response to know who is handling it")}catch(e){i.default.reportError(e)}this._numOutstandingReqs--;try{i.default.PAssert(1320,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(e){i.default.reportError(e)}try{e._handleBatchRequestResponse(t)}catch(e){this._reportPluginError(e)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()},_handleRequestResponse:function(e,t,a){try{i.default.PAssert(1321,t,"Plugin must be passed to response to know who is handling it")}catch(e){i.default.reportError(e)}if(!a){this._numOutstandingReqs--;try{i.default.PAssert(1322,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(e){i.default.reportError(e)}}try{t._handleRequestResponse(e,a)}catch(e){this._reportPluginError(e)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()},notifyNoOutstandingReqs:function(){try{i.default.PAssert(1323,0===this._numOutstandingReqs,"Should only notify when there are no outstanding reqs left")}catch(e){i.default.reportError(e)}0===this._numOutstandingReqs&&this._setupRequestQueues(!0)},notifyHasPendingRemoteRequest:function(){this._numOutstandingReqs<6&&this._setupRequestQueues(!0)},notifyAuthorizationAdded:function(e){this._numOutstandingReqs<6&&this._setupRequestQueues(!0),this.verifyAuthorization(e)},verifyAuthorization:function(e){for(var t=[],a=0;a<this._activePlugins.length;++a){var i=this._activePlugins[a],r=this.getPlugin(i);if(r.isEnabled()){var n=r.verifyAuthorization(e);n.length>0&&(t.pushArray(n),r.notifyUnauthorized(e,n))}}t.length>0&&this._reportInvalidScopes(e,t)},_reportInvalidScopes:function(e,t){i.default.settings.get(Settings.enableOfflineAuth)?(i.default.toasts.pushMessage(MessageID.MissingOffline),i.default.toasts.clearMessage(MessageID.LostPermission)):i.default.toasts.isMessageVisible(MessageID.MissingOffline)||i.default.toasts.isMessageVisible(MessageID.MissingOfflineMobile)||i.default.toasts.pushMessage(MessageID.LostPermission),i.default.reportError(new Error("Invalid scopes reported"),{accountID:e,scopes:t})},_setupRequestQueues:function(e){var t=e?1:p;this._forcedLastPossible||(clearTimeout(this._queueTimeout),this._queueTimeout=setTimeout(this._pumpRequestQueues,t)),this._forcedLastPossible=this._forcedLastPossible||!!e},_pumpRequestQueues:function(){this._runPumpRequestQueues(n.a.RequestPriority.UserBlocking),this._runPumpRequestQueues(n.a.RequestPriority.Default),this._runPumpRequestQueues(n.a.RequestPriority.Low)},_runPumpRequestQueues:function(e){var t=0;if(this.isOnline()){var a=6-this._numOutstandingReqs;try{i.default.PAssert(1324,a>=0,"Should never have more than max outstanding requests at any given point in time")}catch(e){i.default.reportError(e)}for(var r=0;a>0&&r<this._activePlugins.length;++r){var n=this._activePlugins[r],s=this.getPlugin(n),o=4-s.getNumOutstandingReqs();try{i.default.PAssert(1325,o>=0,"Must always have a postiive number of available plugin reqs")}catch(e){i.default.reportError(e)}var l=Math.min(a,o);if(l>0&&s.isReady()){var d=0;try{d=s._pumpRequestQueue(e,l,this._handleRequestResponse,this._handleBatchRequestResponse);try{i.default.PAssert(1326,d>=0,"Number of requests sent can never be negative")}catch(e){i.default.reportError(e)}}catch(e){this._reportPluginError(e)}try{i.default.PAssert(1327,a-d>=0,"Too Many requests sent")}catch(e){i.default.reportError(e)}t+=d,a-=d,this._numOutstandingReqs+=d}}}else 0;return this._forcedLastPossible=!1,this._setupRequestQueues(),t},_clearRequestQueues:function(){this._numOutstandingReqs=0;for(var e=0;e<this._activePlugins.length;++e){var t=this._activePlugins[e],a=this.getPlugin(t);try{a._clearRequestQueue()}catch(e){this._reportPluginError(e)}}},useRenderer:function(e,t){return this._pluginRenderer.useRenderer(e,t)},_reportPluginError:function(e){i.default.reportError(e)},parseEmailURL:function(e){var t={accountID:void 0,threadID:void 0,plugin:void 0},a=/https:\/\/mail.google.com\/mail\/b\/(.*)#all\/(.*)/g.exec(e);return a&&(t.accountID=a[1],t.threadID=a[2],t.plugin=this.getPlugin(PluginID.Gmail)),t},isAvailable:function(e){return this.getPlugin(e).isAvailable()},isActive:function(e){return this.getPlugin(e).isActive()},isEnabled:function(e){return this.getPlugin(e).isEnabled()},isGmailPaneEnabled:function(){return this.isEnabled(PluginID.Gmail)}},r.a.defineBase(m),r.a.extend(m.prototype,s.a),t.a=m},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(4),s=a(1),o=a(7),l=(a(17),a(39)),d=a(14),c=a(15),u=a(86),h=a(87),f=(a(85),a(48)),p=a(133),m=a(10),g=a(43);a(31);function v(){this._super.constructor.call(this,PluginID.Drive,"Drive"),this.displaySharedWithMe=!i.default.isDemoMode(),r.a.forceBind("sortFn",this),this.registerSetting("WriteAccess","writeAccess",!0),this.registerSetting("LastChangeId","lastChangeId"),this.registerSetting("DriveRootId","driveRootId"),this._folderCache=this.registerLocalCache("FolderCache",StorageType.IndexedDB,!0),this.declareProperty("titleLower",PluginLoad.Runtime,!1,""),this.declareProperty("pinToTop",PluginLoad.Runtime,!0,!1),this.declareProperty("title"),this.declareProperty("mimeType"),this.declareProperty("fileSize",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("alternateLink",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("isDeleted",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("modifiedDate",PluginLoad.Autocomplete,!0),this.declareProperty("parents",PluginLoad.Autocomplete,!0),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.DriveFile),this.useRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.DriveFile),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.DriveFile)}var y="application/octet-stream",S="application/vnd.google-apps.folder",E="application/vnd.google-apps.spreadsheet",P="application/vnd.google-apps.presentation",b="application/vnd.google-apps.document",C=c.a.REALTIME_MIMETYPE+"."+c.a.APP_ID,D="image/png",I="image/jpg",A="image/jpeg",M="image/gif",_=1,T=2,w=3,k=4,x=5,L=6,O=7,R="S~SharedWithMe",N="https://drive.google.com/open?id=",F="-------314159265358979323846",U="\r\n--"+F+"\r\n",B={getType:function(){return s.a.PluginType.Storage},getDataPane:function(){try{i.default.PAssert(1666,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){i.default.reportError(e)}return p.a},getPaneIcon:function(){return"icon-drive-file"},getPanePriority:function(){return 96},useItemStore:function(){return"Google Drive"},itemStoreOptions:function(){return{requireStoredEls:!1,parserFn:g.a.runParseSinglePlugin.bind(g.a)}},allowRemoteRequests:function(){return!0},onAuthorizedSetting:function(e,t){switch(e){case this.Settings.WriteAccess:t&&this._ensureAttachmentsAreShared()}},_ensureSpecialFolders:function(){var e=this.getDefaultItemStore();if(e){var t=e.getRoot();if(this.displaySharedWithMe&&!e.hasItem(R)){var a=i.default.generateTempId();this.cacheData(a,{title:"Shared With Me",titleLower:"shared with me",mimeType:S,pinToTop:!0});var r=this.getAttachment(a),n=e.createItem(R,this.getAttachmentEmbedString(r),t.id,{demandLoadChildren:!0});t.insertSorted(n,this.sortFn)}}},_load:function(){this._ensureSpecialFolders(),i.default.isDemoMode()||this.createRecurringTask("ChangeListUpdates",{delay:i.default.minutes(15),minDelay:i.default.minutes(2),runOnCreate:!0,pauseWhileIdle:!0,task:this.performChangeListUpdate.bind(this)})},_notifyFailedRequest:function(e){e&&e.error&&i.default.reportError(new Error("Failed Drive request: ",e.error.code),e)},refreshCurrentView:function(){this.hasRecurringTask("ChangeListUpdates")&&this.getRecurringTask("ChangeListUpdates").forceUpdate()},loadInitialData:function(){this._super.loadInitialData.call(this),this._ensureSpecialFolders();var e=new u.a(function(e){}.bind(this));setTimeout(function(){this._folderCache.onCacheMetadataReady(function(){this._folderCache.getMetadata("isSyncd",function(t){t||(log("Folder cache unsyncd - running folder sync"),this._folderCache.onCacheReady(function(){var t="trashed=false and mimeType contains '"+S+"'";this._requestRemoteFiles(T,e,t,999,function(e){this._folderCache.cacheEntry(e.id,this.serializeExternalData(e)),0}.bind(this),function(e){0}.bind(this)),this._folderCache.setMetadata("isSyncd",!0)}.bind(this)))}.bind(this))}.bind(this))}.bind(this),100);var t=!1,a=this.getDefaultItemStore(),i=a.getRoot(),r="trashed=false and 'root' in parents and mimeType != '"+C+"'";this._requestRemoteFiles(w,i,r,70,function(e){if(this.hasCacheData(e.id)||this._addRemoteEntry(e),!this._hasSameItem(e.id,i.id,a)){var t=a.createItem(this._createItemID(e.id,a),this._getTextForItem(e),i.id,{demandLoadChildren:e.mimeType===S});i.insertSorted(t,this.sortFn)}if(!this.getSetting(this.Settings.DriveRootId)&&e.parents)for(var r=0;r<e.parents.length;++r)e.parents[r].isRoot&&this.setSetting(this.Settings.DriveRootId,e.parents[r].id)}.bind(this),function(){t||(t=!0,this.finishedLoading())}.bind(this))},performChangeListUpdate:function(){var e=-1,t=this.getSetting(this.Settings.LastChangeId);this._requestChangeList(t,function(a){try{i.default.PAssert(1667,!t||parseInt(a.id)>parseInt(t),"Must have correctly ordered change entry")}catch(e){i.default.reportError(e)}e=a.id;try{!a.fileId||a.file&&a.file.mimeType===C||this._handleChange(a)}catch(e){i.default.reportError(e)}}.bind(this),function(t){t&&-1!=e&&this.setSetting(this.Settings.LastChangeId,e)}.bind(this))},_deleteFile:function(e){e.forEachItem(this.getDefaultItemStore(),function(e){e.parent().removeChild(e,ChangeType.Remote),e.parent(void 0)}.bind(this)),e.updateField("isDeleted",!0)},_handleChange:function(e){try{i.default.PAssert(1668,e&&(e.deleted||e.file),"Must have a valid formed change entry to handle")}catch(e){i.default.reportError(e)}if((e.deleted||e.file.mimeType===S)&&(e.deleted?this._folderCache.hasEntry(e.fileId,function(t){t&&this._folderCache.removeEntry(e.fileId)}.bind(this)):this._folderCache.cacheEntry(e.fileId,this.serializeExternalData(e.file))),!this.hasCacheData(e.fileId)&&!e.deleted&&e.file){for(var t=e.file.parents,a=!1,r=0;r<t.length;++r)if(this.hasCacheData(t[r].id)||t[r].isRoot){a=!0;break}a&&this._addRemoteEntry(e.file)}var n=this.getCacheData(e.fileId);if(n){e.deleted||this.dataHasChanged(n,e.file)&&this._addRemoteEntry(e.file);var s=this.getDefaultItemStore();if(e.deleted){var o=this.getAttachment(e.fileId);this._deleteFile(o)}else{var l=[];(o=this.getAttachment(e.fileId)).forEachItem(s,function(t){for(var a=!1,i=0;i<e.file.parents.length;++i){var r=e.file.parents[i];if(r.isRoot&&t.parent()&&t.parent().isRootItem()||t.parent()&&t.parent().hasAttachment(r.id)){a=!0,l.push(r.id);break}}t.parent()&&this._isSpecialFolder(t.parent().id)&&(a=!0,l.push(t.parent().id)),!a&&t.parent()&&(t.parent().removeChild(t,ChangeType.Remote),t.parent(void 0))}.bind(this));for(r=0;r<e.file.parents.length;++r){var d=e.file.parents[r];if(l.indexOf(d.id)<0)if(d.isRoot){var c=s.getRoot(),u=s.createItem(this._createItemID(e.fileId,s),this._getTextForItem(e.file),c.id,{demandLoadChildren:e.file.mimeType===S});c.insertSorted(u,this.sortFn)}else{this.getAttachment(d.id).forEachItem(s,function(t){var a=s.createItem(this._createItemID(e.fileId,s),this._getTextForItem(e.file),t.id,{demandLoadChildren:e.file.mimeType===S});t.insertSorted(a,this.sortFn)}.bind(this))}}if(this.displaySharedWithMe&&e.file.sharedWithMeDate&&l.indexOf(R)<0){var h=s.getItem(R);u=s.createItem(this._createItemID(e.fileId,s),this._getTextForItem(e.file),h.id,{demandLoadChildren:e.file.mimeType===S});h.insertSorted(u,this.sortFn)}}}},_isValidFileID:function(e){return e.indexOf("~")<0},_createItemID:function(e,t){try{i.default.PAssert(1669,e,"Must provide a fileID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1670,this._isValidFileID(e),"Invalid fileID - "+e)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1671,t,"Must provide a valid itemStore")}catch(e){i.default.reportError(e)}for(var a=e,r=0;t.hasItem(a)&&r<50;)a=e+"~"+ ++r;try{i.default.PAssert(1672,r<50,"SANITY: Should not have items with 50+ parents")}catch(e){i.default.reportError(e)}return a},_hasSameItem:function(e,t,a){for(var i=!1,r=e,n=0;a.hasItem(r)&&n<50;){var s=a.getItem(r);if(s&&s.parent()&&s.parent().id===t){i=!0;break}r=e+"~"+ ++n}return i},_isSpecialFolder:function(e){return e.startsWith("S~")},requestDemandLoadData:function(e,t){try{i.default.PAssert(1673,1===t.getNumAttachments(),"Should only have a single attachment for Drive Pane VMLIs")}catch(e){i.default.reportError(e)}var a,r=i.default.vmMain.paneManager.getPaneById(e),n=t.getAttachmentByPlugin(this.id);if(this._isSpecialFolder(t.id))switch(t.id){case R:a="trashed=false and sharedWithMe and mimeType != '"+C+"'";break;default:try{i.default.PAssert(1674,!1,"Invalid special folder ID")}catch(e){i.default.reportError(e)}}a||(a="trashed=false and '"+n.id+"' in parents and mimeType != '"+C+"'");var s=this.getActiveItemStore(e);this._requestRemoteFiles(w,t,a,70,function(e){if(this.hasCacheData(e.id)||this._addRemoteEntry(e),!this._hasSameItem(e.id,t.id,s)){var a=s.createItem(this._createItemID(e.id,s),this._getTextForItem(e),t.id,{demandLoadChildren:e.mimeType===S});t.insertSorted(a,this.sortFn)}}.bind(this),function(e){e||t.hasPaginationToken()||t.notifyLoadDataFailed(r)}.bind(this)),this.sendEvent("RequestDemandLoadData")},requestDataPage:function(e){this._requestRemoteFiles(x,e)},_ensureAncestorChain:function(e,t,a,r){try{i.default.PAssert(1675,a,"Must provide a valid success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1676,r,"Must provide a valid error callback")}catch(e){i.default.reportError(e)}if(t.parents&&t.parents.length)for(var n=t.parents.length,s=0,o=function(){++s===n&&a()},d=function(t){try{i.default.PAssert(1677,t,"Must provide valid fileInfo up ancestor chain")}catch(e){i.default.reportError(e)}this.hasCacheData(t.id)||this._addRemoteEntry(t),this._ensureAncestorChain(e,t,o,r)}.bind(this),c=function(e){if(e){var t=this.serializeExternalData(e);this._folderCache.cacheEntry(t.id,t),d(t)}else r({error:"Undefined success result."})}.bind(this),u=function(e,t){if(e)d(e);else{var a=l.a.fns("drive").files.get.packedFn,i={fileId:t};this._queueRemoteRequest(a,i,c,r,void 0,O)}}.bind(this),h=0;h<t.parents.length;++h){var f=t.parents[h].id;try{i.default.PAssert(1678,f,"Must supply a valid parent ID to query")}catch(e){i.default.reportError(e)}this._folderCache.getEntry(f,u)}else a()},_hasAttachmentChild:function(e,t){for(var a=!1,i=0;i<e.numItems();++i){if(e.itemAtIndex(i).hasAttachment(t)){a=!0;break}}return a},_attachAncestorChain:function(e,t){try{i.default.PAssert(1679,t,"Must provide a valid cache entry to create items for")}catch(e){i.default.reportError(e)}if(t.parents&&t.parents.length>0)for(var a=0;a<t.parents.length;++a){var r=t.parents[a];try{i.default.PAssert(1680,r&&r.id,"Must supply a valid parent ID to query")}catch(e){i.default.reportError(e)}if(r.isRoot){var n=e.getRoot();if(!this._hasAttachmentChild(n,t.id)){var s=e.createItem(this._createItemID(t.id,e),this._getTextForItem(t),n.id,{demandLoadChildren:t.mimeType===S});n.insertSorted(s,this.sortFn)}}else this._folderCache.getEntry(r.id,function(a){this._attachAncestorChain(e,a),this.getAttachment(a.id).forEachItem(e,function(a){if(!this._hasAttachmentChild(a,t.id)){var i=e.createItem(this._createItemID(t.id,e),this._getTextForItem(t),a.id,{demandLoadChildren:t.mimeType===S});a.insertSorted(i,this.sortFn)}}.bind(this))}.bind(this))}},getNextSearchPage:function(){this._lastCompletedSearch&&this._lastCompletedSearch.isValid()&&this._lastCompletedSearch.getNextPage()},runRemoteSearch:function(e,t,a,r){try{i.default.PAssert(1681,e,"Must provide a valid search")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1682,t,"Must provide a valid pane")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1683,i.default.isFunction(r),"Must provide a valid search callback")}catch(e){i.default.reportError(e)}var n=!1,s=0,o=0,l=0,d=new h.a(e,10,this.requestDataPage.bind(this)),c=function(){if(s===o&&n){log("Done Searching! "+s);var e=SearchResultStatus.Done;if(d.isValid())i.default.vmMain.paneManager.getPaneById(t).search.update(!0),d.isValid()&&d.hasMoreResults()?(log("Too many search results"),e=SearchResultStatus.TooMany):d.hasError()||l>0?e=SearchResultStatus.Error:0===s&&(e=SearchResultStatus.None),this._lastCompletedSearch=d;r(e)}}.bind(this),u=function(e){s++,this.hasCacheData(e.id)||this._addRemoteEntry(e);var a=this.getActiveItemStore(t);this._ensureAncestorChain(a,e,function(){d.isValid()&&this._attachAncestorChain(a,e),o++,c()}.bind(this),function(e){i.default.reportError(new Error("Error during remote search: ",e)),o++,l++,c()}.bind(this))}.bind(this),f=function(e){n=!0,c()}.bind(this),p=!1,m="trashed=false and (fullText contains '"+e+"')";return this._requestRemoteFiles(k,d,m,100,d.onEntry,function(e){d.onDone(e),p||(p=!0,d.isValid()&&(d.hasResults()?d.getNextPage(u,f):f(e)))}),this.sendEvent("RemoteSearch"),d},_requestRemoteFiles:function(e,t,a,r,n,s){var o;t&&t.hasPaginationToken()&&!t.paginationTokenInUse()?(a=(o=t.beginDataPageLoad()).getQuery(),r=o.getMaxResults(),n=o.getEntryCB(),s=o.getDoneCB()):t&&t.needsPaginationToken()&&(o=this.createPaginationToken(void 0,a,{},r,n,s),t.setPaginationToken(o),t.beginDataPageLoad()),r=r||70;try{i.default.PAssert(1684,n&&i.default.isFunction(n),"Must define a valid entry callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1685,s&&i.default.isFunction(s),"Must define a valid done callback")}catch(e){i.default.reportError(e)}var d,c,u=l.a.fns("drive").files.list.packedFn,h={fields:"items,nextPageToken",maxResults:r,q:a,pageToken:o&&o.hasMorePages()?o.getNextPageToken():void 0};o||!t?(d=function(e){if(e.items){i.default.vmMain.beginUpdateItems();for(var a=0;a<e.items.length;++a)n(e.items[a]);i.default.vmMain.commitUpdateItems()}e.nextPageToken&&o&&this.updatePaginationToken(o,e.nextPageToken),t&&o&&t.endDataPageLoad(!!e.nextPageToken),s(!0)}.bind(this),c=function(){o&&t.endDataPageLoad(!!o),s(!1)}.bind(this)):(d=function(){s(!0)},c=function(){s(!1)}),this._queueRemoteRequest(u,h,d,c,void 0,e)},getRemoteAttachmentData:function(e){var t=l.a.fns("drive").files.get.packedFn,a={fileId:e.id},r=function(t){try{i.default.PAssert(1686,!t||t.id===e.id,"If valid result, attachment should match remote file ID")}catch(e){i.default.reportError(e)}t&&(this._addRemoteEntry(t),(t.deleted||t.mimeType===S)&&(t.deleted?this._folderCache.hasEntry(t.id,function(e){e&&this._folderCache.removeEntry(t.id)}.bind(this)):this._folderCache.cacheEntry(t.id,this.serializeExternalData(t))))}.bind(this),n=function(t){if(i.default.isHTTPStatusCode(t,s.a.HTTPStatusCode.NotFound)){var a={id:e.id,mimeType:y,title:"Unknown",titleLower:"unknown",fileSize:0};this._addRemoteEntry(a),this._deleteFile(e)}else e.notifyDataRequestFailed(),this._notifyFailedRequest(t)}.bind(this);this._queueRemoteRequest(t,a,r,n,e,_)},_requestChangeList:function(e,t,a){if(e){try{i.default.PAssert(1687,t,"Must supply a valid entry CB")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1688,a,"Must provide a valid done CB")}catch(e){i.default.reportError(e)}var r=l.a.fns("drive").changes.list.packedFn,n={includeDeleted:!0,includeSubscribed:!0,maxResults:500,startChangeId:+e+1,fields:"items,nextPageToken"},s=function(r){var n=e;i.default.vmMain.beginUpdateItems();for(var s=0;s<r.items.length;++s){var o=r.items[s];try{i.default.PAssert(1689,o,"Must have a valid change entry")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1690,parseInt(o.id)<1e8,"Must have a valid entry ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1691,parseInt(o.id)>parseInt(n),"Must be ordered monotonic increasing")}catch(e){i.default.reportError(e)}n=o.id,t(o)}i.default.vmMain.commitUpdateItems(),r.nextPageToken?this._requestChangeList(n,t,a):a(!0)}.bind(this),o=function(e){a(!1)}}else r=l.a.fns("drive").changes.list.packedFn,n={includeDeleted:!0,includeSubscribed:!0,maxResults:1,startChangeId:1e8},s=function(e){var i=e.largestChangeId;t({id:i}),a(!0)},o=function(e){a(!1)};this._queueRemoteRequest(r,n,s,o,void 0,L)},_createRemoteEntry:function(e){var t={id:e.id,mimeType:e.mimeType,title:e.title,titleLower:e.title.toLowerCase(),alternateLink:e.alternateLink,fileSize:+e.fileSize,parents:e.parents,modifiedDate:e.modifiedDate?new Date(e.modifiedDate):void 0};if(t.parents)for(var a=0;a<t.parents.length;++a)this._updateParentsEntry(t.parents[a]);if(e.properties)for(a=0;a<e.properties.length;++a){if(e.properties[a].key===c.a.DocFolderTitleProperty){t.title=e.properties[a].value;break}if(e.properties[a].key===c.a.DefaultRootFolderProperty){t.title="Shared Files",t.pinToTop=!0;break}}return this.isFolder(t)&&(t.items=[]),t},_addRemoteEntry:function(e){var t=this._createRemoteEntry(e);this.cacheData(t.id,t)},createEntryFromLocal:function(e,t){if(this.isFolder(t)&&(t.items=[]),t.titleLower=t.title.toLowerCase(),t.modifiedDate=t.modifiedDate?new Date(t.modifiedDate):void 0,t.isDeleted=t.isDeleted||i.default.isTempId(e),t.parents)for(var a=0;a<t.parents.length;++a)this._updateParentsEntry(t.parents[a]);return t},_updateParentsEntry:function(e){this._folderCache.getEntry(e.id,function(t){t&&(e.title=t.title)})},isFolder:function(e){return e.mimeType===S},_getCompStringForItem:function(e){return e.hasPluginAttachment(this.id)?e.getAttachmentByPlugin(this.id).getTitleString():e.getParsedText()},_isItemPinnedToTop:function(e){return!!e.hasPluginAttachment(this.id)&&e.getAttachmentByPlugin(this.id).getField("pinToTop")},sortFn:function(e,t){return this._isItemPinnedToTop(e)?-1:this._isItemPinnedToTop(t)?1:this._getCompStringForItem(e).localeCompare(this._getCompStringForItem(t))},getAttachmentClass:function(e){var t=["plugin_drive"];return e.hasField("mimeType")?t.push(this.getMimetypeClass(e.getField("mimeType"))):t.push("plugin_drive_unk"),e.hasField("isDeleted")&&e.getField("isDeleted")&&t.push("fileDeleted"),t},getMimetypeClass:function(e){switch(e){case S:return"plugin_drive_folder";case E:return"plugin_drive_sheet";case P:return"plugin_drive_slide";case b:return"plugin_drive_doc";case D:case M:case I:case A:return"plugin_drive_image";default:return"plugin_drive_unk"}},isImage:function(e){return e.hasField("mimeType")&&"plugin_drive_image"===this.getMimetypeClass(e.getField("mimeType"))},googleScopes:function(e){return e||this.getSetting(this.Settings.WriteAccess)?[GScope.DriveFull]:[GScope.DriveMetadataRO]},getDependencies:function(){return[PluginDependency.LocalLoaded,PluginDependency.PremiumSub,PluginDependency.GoogleLogin]},onDependencyLoaded:function(e,t){if(this._super.onDependencyLoaded.call(this,e,t),e===PluginDependency.GoogleLogin){try{i.default.PAssert(1692,i.default.isArray(t),"Must provide a valid scope array")}catch(e){i.default.reportError(e)}this.getSetting(this.Settings.IsEnabled)&&(t.indexOf(GScope.DriveMetadataRO)<0&&t.indexOf(GScope.DriveFull)<0&&(i.default.toasts.pushMessage(MessageID.LostPermission),d.a.notifyUnauthorizedAccount("me",[GScope.DriveMetadataRO,GScope.DriveFull],"Missing Scope"),this.setSetting(this.Settings.IsEnabled,!1)),this.getSetting(this.Settings.WriteAccess)&&t.indexOf(GScope.DriveFull)<0&&(i.default.toasts.pushMessage(MessageID.LostPermission),d.a.notifyUnauthorizedAccount("me",[GScope.DriveFull],"Missing Write Scope"),this.setSetting(this.Settings.WriteAccess,!1)))}},isDependencyLoaded:function(e,t){var a=!1;switch(e){case PluginDependency.GoogleLogin:t&&(t.indexOf(GScope.DriveMetadataRO)>=0||t.indexOf(GScope.DriveFull)>=0)&&(a=!0);break;default:a=!0}return a},handleDropEvent:function(e,t){var a=e.dataTransfer?e.dataTransfer.getData("text/uri-list"):void 0;if(a&&a.startsWith(N)){var i=a.replace(N,""),r=i.indexOf("&"),n=i.substr(0,r);return t(this.getAttachment(n).getEmbedString()),!0}if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0){for(var s=0;s<e.dataTransfer.files.length;++s){var o=e.dataTransfer.files[s];this._handleDropFile(o,e,t)}return m.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.DriveUpload}),!0}if(e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length>0){for(s=0;s<e.clipboardData.items.length;++s){var l=e.clipboardData.items[s];(o=l?l.getAsFile():void 0)&&(o.name="Moo.do Upload "+Date.now(),this._handleDropFile(o,e,t))}return m.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.DriveUpload}),!0}return!1},isItemDroppable:function(e){var t=!0,a=e.getAttachmentByPlugin(this.id);try{i.default.PAssert(1693,a,"Should always have a valid attachment when copying from a Drive pane.")}catch(e){i.default.reportError(e)}a&&(a.getField("mimeType")===S&&(t=!1));return t},_handleDropFile:function(e,t,a){for(var r=!1,n=this.findCachedItemsByField("title",e.name),s=i.default.getPaneForElement(t.target),o=0;o<n.length;++o){var l=n[o];if(l.fileSize===e.size&&!l.isDeleted){var d=this.getAttachment(l.id);s&&s.isWriteable&&s.plugin!==this?a(this.getAttachmentEmbedString(d),!1):s&&s.plugin===this&&d.forEachItem(p,function(e){e.highlight()}),r=!0;break}}if(!r){var c=i.default.generateTempId();this.cacheData(c,{title:e.name,titleLower:e.name.toLowerCase(),mimeType:e.type});d=this.getAttachment(c);var u,h,f=s&&s.isWriteable&&s.plugin!==this,p=this.getDefaultItemStore();if(s&&s.isWriteable&&s.plugin!==this)a(this.getAttachmentEmbedString(d),!0);else if(this.getSetting(this.Settings.WriteAccess)){var m=t.target;(u=i.default.hasClass(m,"paneContent")?s.getItem():i.default.getItemForElement(m))&&!u.isHeader()&&(u=u.parent())}if(u){if(!u.isRootItem()){var g=u.getAttachmentByPlugin(this.id);try{i.default.PAssert(1694,g,"Drive items must have valid attachments")}catch(e){i.default.reportError(e)}h=g.id}}else u=p.getRoot(),h=this.getSetting(this.Settings.DriveRootId);this._upload(e,d,f,s.getPaneDoc(),h);try{i.default.PAssert(1695,!p.hasItem(d.id),"When uploading a new file, should never have duplicated items")}catch(e){i.default.reportError(e)}var v=p.createItem(d.id,this.getAttachmentEmbedString(d),u.id);u.insertSorted(v,this.sortFn)}},notifyDropFrom:function(e,t){try{i.default.PAssert(1696,e,"Must have a valid item that was dropped")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1697,t,"Must have a valid pane the item was dropped on")}catch(e){i.default.reportError(e)}if(!i.default.isDemoMode()){var a=e.getAttachmentByPlugin(this.id),r=t.getPaneDoc();r.shareFile(a.id,function(e,t){e||(this.getSetting(this.Settings.WriteAccess)&&t.code===s.a.HTTPStatusCode.Unauthorized&&this.setSetting(this.Settings.WriteAccess,!1),r.isShared()&&i.default.toasts.pushMessage(MessageID.ShareFailure))}.bind(this)),this.sendEvent("AttachmentDropped")}},notifyDropFromToEdit:function(e,t){if(!i.default.isDemoMode())if(this.getSetting(this.Settings.WriteAccess)){if(e.getAttachmentByPlugin(this.id)){var a=document.createEvent("Event");a.item=e,a.initEvent("cdrop",!0,!0),t.dispatchEvent(a)}this.sendEvent("AttachmentDroppedEdit")}else i.default.toasts.pushMessage(MessageID.NeedDrivePermission)},handleTapStart:function(e,t,a,i){return!0},handleTapClick:function(e,t,a,r){var s=this.getCacheData(a);if(s){var o,l=this.getAttachment(a);if(this.isPluginPane(t)&&this.isFolder(s))i.default.vmMain.zoomin(e),this.sendEvent("Tap_FolderZoom");else s.alternateLink?o=s.alternateLink:s.id?o=this._createDriveURL(s.id,s.mimeType):i.default.toasts.pushMessage({text:"Your file is still uploading, please try again in a minute.",action:MessageAction.Okay}),o&&(n.a.mac&&r.metaKey||!n.a.mac&&r.ctrlKey||!this.isImage(l)?o&&(i.default.isDemoMode()?i.default.toasts.pushMessage(MessageID.DemoPluginClick):(i.default.openUrl(o,r),this.sendEvent("Tap_OpenFileDesktop"))):(o="https://drive.google.com/uc?export=view&id="+s.id,i.default.menus.openLightbox(o)));return!0}return!1},createFolderURL:function(e){return"https://drive.google.com/drive/folders/"+e},_createDriveURL:function(e,t){var a="https://docs.google.com/";switch(t){case S:return a+"folderview?id="+e+"&usp=drivesdk";case E:return a+"spreadsheets/d/"+e+"/edit?usp=drivesdk";case b:return a+"document/d/"+e+"/edit?usp=drivesdk";case P:return a+"presentation/d/"+e+"/edit?usp=drivesdk";default:return a+"file/d/"+e+"/edit?usp=drivesdk"}},compactCacheField:function(e,t){var a;switch(t){case"alternateLink":e[t]!==this._createDriveURL(e.id,e.mimeType)&&(a=e[t]);break;default:a=e[t]}return a},supportOfflineCache:function(){return!0},usesPreviewCache:function(){return!0},matchAttachment:function(e,t){return e.getField("titleLower").indexOf(t)>=0},getBlockedText:function(e){return"Go Premium to view Drive files"},onDocumentShared:function(e){this.getSetting(this.Settings.WriteAccess)?e&&this._ensureAttachmentsAreShared():this.numActiveAttachments()>0&&i.default.toasts.pushMessage(MessageID.NoSharingWarning)},_ensureAttachmentsAreShared:function(){var e=i.default.vmMain.docManager.getOpenDoc();this.forEachActiveAttachment(function(t){e.shareFile(t.id,function(e){0})}.bind(this))},notifyAttachmentUnused:function(e,t){(this._super.notifyAttachmentUnused.call(this,e,t),i.default.isDemoMode())||i.default.vmMain.docManager.getOpenDoc().unshareFile(e.id,function(e){0})},_upload:function(e,t,a,r,n){e.size>20971520?(i.default.toasts.pushMessage(MessageID.WarnLargeFile),this.sendEvent("Upload_Large")):this.sendEvent("Upload");var s=new FileReader;s.readAsBinaryString(e),s.onload=function(o){var l=e.type||y,d=function(i){var r={title:e.name,mimeType:l,parents:n?[{id:n}]:[]};a&&i&&r.parents.push({id:i});var o=btoa(s.result),d=U+"Content-Type: application/json\r\n\r\n"+JSON.stringify(r)+U+"Content-Type: "+l+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+o+"\r\n---------314159265358979323846--",c=gapi.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+F+'"'},body:d}),u=function(e){this.changeID(t,t.id,e.id),this._addRemoteEntry(e)}.bind(this);c.execute(u)}.bind(this);if(a){try{i.default.PAssert(1698,r,"Must supply a valid paneDoc if sharing a file")}catch(e){i.default.reportError(e)}r.getDocumentFolder(function(e){d(e)})}else d()}.bind(this)},scheduleFile:function(e,t){m.a.beginAction();var a=e.getAttachmentByPlugin(this.id);try{i.default.PAssert(1699,a,"Must be able to get a valid attachment from item")}catch(e){i.default.reportError(e)}var r=s.a.MSPerHour,n=i.default.vmMain.getDefaultCalendarPlugin();if(n){var l=n.getDefaultExportCalendarID();if(l&&(i.default.isDemoMode()||n.getSetting(n.Settings.WriteAccess))){var d=a.getField("title"),c=this._createDriveURL(a.id,a.getField("mimeType"));n.createEventForEmail(l,d,c,t,r,function(e,t,a,r){e||t?t||i.default.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar.",action:MessageAction.Okay}):i.default.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){o.a.overQuota?i.default.toasts.pushMessage({text:"You are offline and tour computer's storage quota has been exceeded. Please free up space on your device. Please contact support@moo.do if you have questions.",action:MessageAction.Okay}):i.default.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:MessageAction.Okay})}})})}else i.default.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:MessageAction.OpenCalendarSettings})}else i.default.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule files.",action:MessageAction.OpenSettings});m.a.endAction()},findMatchExact:function(e){},findMatchLike:function(e,t){var a=e.toLowerCase(),i=this.findCachedItemsByFn(function(e){return e.titleLower.indexOf(a)>=0},t);return i.sort(function(e,t){return e.modifiedDate&&t.modifiedDate?Date.compare(e.modifiedDate,t.modifiedDate):e.modifiedDate?-1:t.modifiedDate?1:e.titleLower.localeCompare(t.titleLower)}),i}};r.a.inherit(f.a,v),r.a.extend(v.prototype,B),t.a=v},function(e,t,a){"use strict";var i=a(0),r=a(13),n={Unloaded:1,Waiting:2,Requesting:3,LoadedPreview:4,LoadedFull:5,FailedRequest:6,Updating:7};function s(e,t,a){this.id=t,this._oldLocalID=void 0,this._plugin=e,this._loadState=n.Unloaded,this._subscribers=[],this._countInUse=0,this._iteratingSubscribers=!1,this._numRemoteRequests=0,this._inlineData=a,this.load()}s.prototype={load:function(e){this._loadState=n.Waiting,this._plugin.requestData(this,e)},notifyDataRequested:function(){try{i.default.PAssert(2546,!this.isLoaded(),"Should not request additional data once loaded")}catch(e){i.default.reportError(e)}this._numRemoteRequests++,this._loadState=n.Requesting},notifyDataLoaded:function(e,t,a,r){try{i.default.PAssert(2547,t||this._loadState!==n.LoadedFull||i.default.isFlagSet(e,PluginLoad.Full),"Should not load preview data after full data has been loaded")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2548,!t||this._loadState===n.LoadedPreview||i.default.isFlagSet(e,PluginLoad.Full),"Incoming update much match previous type")}catch(e){i.default.reportError(e)}this._loadState=i.default.isFlagSet(e,PluginLoad.Full)?n.LoadedFull:n.LoadedPreview,this.onUpdate(!0,a,r)},notifyDataMutated:function(e,t){try{i.default.PAssert(2549,e&&i.default.isArray(e),"Must specify valid update fields when mutating attachment state manually")}catch(e){i.default.reportError(e)}this.onUpdate(!0,e,t)},notifyDataRequestFailed:function(){try{i.default.PAssert(2550,this._loadState===n.FailedRequest||this._loadState===n.Requesting||this._loadState===n.LoadedPreview,"Must be requesting remote data or a preview cache was able to service after the request was sent")}catch(e){i.default.reportError(e)}if(this._loadState===n.FailedRequest);else if(this._loadState===n.Requesting)this._loadState=n.FailedRequest;else if(this._loadState===n.LoadedPreview)try{i.default.PAssert(2551,!1,"Failed remote reuqest but serviced by preview cache, should not have made the request?")}catch(e){i.default.reportError(e)}else try{i.default.PAssert(2552,!1,"Invalid loadstate when remote request failed: ",this._loadState)}catch(e){i.default.reportError(e)}},isLoaded:function(){return this._loadState===n.LoadedPreview||this._loadState===n.LoadedFull},needsRemoteData:function(){return this._loadState!==n.LoadedFull},getOldID:function(){return this._oldLocalID},changeID:function(e){try{i.default.PAssert(2553,this.id!==e,"Change the ID of an attachment to the same value")}catch(e){i.default.reportError(e)}if(this.id!==e){var t=this.id;this.id=e,this._oldLocalID=t;try{i.default.PAssert(2554,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(e){i.default.reportError(e)}this._iteratingSubscribers=!0;for(var a=0;a<this._subscribers.length;++a)try{this._subscribers[a].onAttachmentIDChange(this,t)}catch(e){i.default.reportError(e)}this._iteratingSubscribers=!1,this._oldLocalID=void 0}},delayChangeID:function(){try{i.default.PAssert(2555,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(e){i.default.reportError(e)}this._iteratingSubscribers=!0;for(var e=0;e<this._subscribers.length;++e){var t=this._subscribers[e];try{var a=t.onAttachmentIDChange.bind(t,this,this.id);setTimeout(a,0)}catch(e){i.default.reportError(e)}}this._iteratingSubscribers=!1},isFieldDefined:function(e){return this._plugin.isFieldDefined(e)},hasField:function(e){return this._plugin.hasAttachField(this,e)},getField:function(e){return this._plugin.getAttachField(this,e)},updateField:function(e,t){return this._plugin.updateAttachField(this,e,t)},fieldsHaveParseEffect:function(e){return this._plugin.fieldsHaveParseEffect(e)},isFieldDefault:function(e){return this._plugin.isAttachFieldDefault(this,e)},fieldNeedsWrite:function(e,t){return this._plugin.fieldNeedsWrite(this,e,t)},getFieldAsDate:function(e){var t=this._plugin.getAttachField(this,e);if(t)return new Date(t).toString(r.a.getFormat(DFormat.MonthDay));try{i.default.PAssert(2556,!1,"Invalid attachment date field: ",this._plugin.id,e)}catch(e){i.default.reportError(e)}},getPlugin:function(){return this._plugin},getData:function(){return this._plugin.getCacheData(this.id)},getExportString:function(){return this._plugin.getAttachmentExportString(this)},getEmbedString:function(){return this._plugin.getAttachmentEmbedString(this)},getTitleString:function(){return this._plugin.getAttachmentTitleString(this)},unload:function(){this._loadState=n.Unloaded,this._plugin.releaseAttachment(this)},match:function(e){return!!this.isLoaded()&&this._plugin.matchAttachment(this,e)},markInUse:function(e){0===this._countInUse&&this._plugin.notifyAttachmentInUse(this,e),this._countInUse++},markUnused:function(e){this._countInUse--,0===this._countInUse&&this._plugin.notifyAttachmentUnused(this,e);try{i.default.PAssert(2557,this._countInUse>=0,"Should never have negative users of the attachment")}catch(e){i.default.reportError(e)}},isInUse:function(){return this._countInUse>0},subscribe:function(e){try{i.default.PAssert(2558,this._subscribers.indexOf(e)<0,"Must not double subscribe")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2559,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2560,e.onAttachmentUpdate,"Must specify a valid subscriber callback")}catch(e){i.default.reportError(e)}this._subscribers.push(e)},unsubscribe:function(e){try{i.default.PAssert(2562,this._subscribers.indexOf(e)>=0,"Subscriber should be active")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2563,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(e){i.default.reportError(e)}this._subscribers.remove(e)},forEachItem:function(e,t){try{i.default.PAssert(2565,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(e){i.default.reportError(e)}this._iteratingSubscribers=!0;for(var a=0;a<this._subscribers.length;++a)if(i.default.isVMLI(this._subscribers[a])&&(!e||this._subscribers[a].belongsToItemStore(e)))try{t(this._subscribers[a])}catch(e){i.default.reportError(e)}this._iteratingSubscribers=!1},onUpdate:function(e,t,a){try{i.default.PAssert(2566,!t||i.default.isArray(t),"Must supply a valid value for updateFields:",t)}catch(e){i.default.reportError(e)}if(a=a||ChangeType.Remote,e&&this.isInUse())try{this._plugin.notifyAttachmentUpdated(this)}catch(e){i.default.reportError(e)}if(e||(a|=ChangeType.PluginLoad),t)for(var r=0;r<t.length;++r)try{i.default.PAssert(2567,this._plugin.isFieldDefined(t[r]),"Invalid field supplied to be updated: ",t[r])}catch(e){i.default.reportError(e)}try{i.default.PAssert(2568,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(e){i.default.reportError(e)}this._iteratingSubscribers=!0;for(r=0;r<this._subscribers.length;++r)try{this._subscribers[r].onAttachmentUpdate(this,t,a)}catch(e){i.default.reportError(e)}this._iteratingSubscribers=!1},notifyItemTextChanged:function(e,t){this._plugin.notifyItemTextChanged(this,e,t)},notifyItemPropertyChanged:function(e,t,a){this._plugin.notifyItemPropertyChanged(this,e,t,a)},isLocalOnlyAttachment:function(){return i.default.isTempId(this.id)},isType:function(e){return this._plugin.getType()===e},isPlugin:function(e){return this._plugin.id===e},shouldBeDeleted:function(){return this.isFieldDefined("isDeleted")&&this.hasField("isDeleted")&&this.getField("isDeleted")&&this.isLocalOnlyAttachment()},hasFatalError:function(){return this._loadState===n.FailedRequest&&this._numRemoteRequests>3},hasInlineData:function(){return!!this._inlineData},getInlineData:function(){return this._inlineData},clearInlineData:function(){this._inlineData=void 0}},t.a=s},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(11);function s(e){this._taskCB=e,this._isRunning=!1,this._disabled=!1,this._workAvailable=!1,this._runCount=0,r.a.forceBind("handleLowImpactBegin",this),r.a.forceBind("_onTaskEndRun",this),n.a.listen("lowImpactBegin",this.handleLowImpactBegin)}s.prototype={getStats:function(){return{runCount:this._runCount,isRunning:this._isRunning,isDisabled:this._disabled}},disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},handleLowImpactBegin:function(){this._startTaskRun()},requestRun:function(){this._forceRun=!0,this._startTaskRun()},notifyWorkAvailable:function(){this._workAvailable=!0,i.default.vmMain.isLowImpact()&&!this._isRunning&&this._startTaskRun()},_startTaskRun:function(){if(!this._isRunning&&!this._disabled&&this._workAvailable){try{i.default.PAssert(2539,this._forceRun||i.default.vmMain.isLowImpact(),"Must always run a task during a low impact timeframe")}catch(e){i.default.reportError(e)}this._workAvailable=!1,this._isRunning=!0,this._runCount++,this._taskCB(this._onTaskEndRun)}},_onTaskEndRun:function(e){try{i.default.PAssert(2540,this._isRunning,"Must be currently running task to finish")}catch(e){i.default.reportError(e)}this._isRunning=!1,this._forceRun=!1,(e||this._workAvailable)&&(this._workAvailable=!0,i.default.vmMain.isLowImpact()&&this._startTaskRun())}},t.a=s},function(e,t,a){"use strict";var i=a(0),r=a(5);function n(e,t,a,r,n,s){try{i.default.PAssert(2541,i.default.isFunction(n),"Must supply a valid entry CB")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2542,i.default.isFunction(s),"Must supply a valid done CB")}catch(e){i.default.reportError(e)}this._nextPageToken=e,this._inUse=!1,this._q=t,this._info=a,this._maxResults=r,this._entryCB=n,this._doneCB=s}var s={updateToken:function(e){try{i.default.PAssert(2543,this._nextPageToken!==e,"Should never update token to be same value")}catch(e){i.default.reportError(e)}this._nextPageToken=e},getNextPageToken:function(){return this._nextPageToken},getInfo:function(){return this._info},getQuery:function(){return this._q},getEntryCB:function(){return this._entryCB},getDoneCB:function(){return this._doneCB},getMaxResults:function(){return this._maxResults},hasMorePages:function(){return!!this._nextPageToken},notifyBeginUse:function(){try{i.default.PAssert(2544,!this._inUse,"Should not currently be in use")}catch(e){i.default.reportError(e)}this._inUse=!0},notifyEndUse:function(){try{i.default.PAssert(2545,this._inUse,"Should always be using token when done")}catch(e){i.default.reportError(e)}this._inUse=!1},isInUse:function(){return this._inUse}};r.a.defineBase(n),r.a.extend(n.prototype,s),t.a=n},function(e,t,a){"use strict";var i=a(1),r=a(0),n=a(5),s=(a(7),a(9)),o=a(20),l=a(13);function d(e){this.plugin=r.default.vmMain.pluginManager.getPlugin(PluginID.Drive),this.type=this.plugin._paneType,this.title="Drive",this.paneClass="paneOutline panePlugin paneDrive noComplete",this.paneEmptyMessage="Loading Google Drive...",this.paneEmptySearchMessage="",this.titleContextMenuHeader="Open folder",this.dropEffect=function(){return i.a.DropEffect.Copy},this.isWriteable=!1,this.isDropTarget=!1,this.overrideCopyBehavior=!1,this.canAddItem=!1,this.supportCollapsing=!0,this.supportCompleting=!1,this.supportCheckbox=!1,this.supportOffline=!1,this.supportPerformArchive=!1,this.supportDataRefresh=!0,this.supportPagination=!0,this.supportSearchListenTextChanges=!1,this.supportSearchFlat=!1,this.supportClickOverviewScroll=!1,this.supportClone=!1,this.supportDates=!1,this.shouldUpdateOnTextChanged=!1,this.overviewTracksScroll=!1,this.hasMoreButtons=!0,this.searchFilters=["showOnlyMatches"],this._super.constructor.call(this,e),this._isSearchingRemote=new s.a(!1),this._currentSearch=void 0,this.initDrive()}var c={initDrive:function(){this.search.onChanged.listen(n.a.forceBind("notifySearchChanged",this)),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0},destroy:function(){this.search.onChanged.unlisten(this.notifySearchChanged),clearTimeout(this._searchTimeout),this._searchTimeout=void 0,this._super.destroy.call(this)},_getNotReadyStatus:function(){var e="Unknown Error: Unable to load pane data.",t=this.plugin.getUnloadedDependencies();return t&&(t.indexOf(PluginDependency.PremiumSub)>=0?e="Only available to premium subscribers.":t.indexOf(PluginDependency.GoogleLogin)>=0&&(e="Missing permissions for Google Drive access.")),e},getItemStore:function(){return this.plugin.getActiveItemStore(this.id)},getRootItem:function(){var e=this.getItemStore();return e?e.getRoot():void 0},bottomListMessage:function(){var e;return!this.isSearched()&&this.getItem().hasPaginationToken()&&(e="LOAD MORE"),e},searchACName:function(){},getPaneIcon:function(){return this.plugin.getPaneIcon()},requestDemandLoadData:function(e){this.plugin.requestDemandLoadData(this.id,e)},requestDataPage:function(e){this.plugin.requestDataPage(e)},updateContents:function(){this._super.updateContents.call(this)},onAfterLoaded:function(){this._super.onAfterLoaded.call(this)},onClose:function(){this._super.onClose.call(this)},_runRemoteSearch:function(){if(r.default.vmMain.paneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var e=this.search.getValue();this._lastSearchValue=e,this._lastSearchTime=Date.now(),this.isLoading.set(!0),this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0),this._currentSearch=this.plugin.runSearch(e,this.id,void 0,!1,function(e){switch(this.isLoading.set(!1),e){case SearchResultStatus.Done:this.paneTopText.set("");break;case SearchResultStatus.TooMany:this.paneTopText.set("Too many search results! Be more specific.");break;case SearchResultStatus.None:this.paneTopText.set("There were no search results");break;case SearchResultStatus.Error:this.paneTopText.set("There was an error running your search, try again.");break;default:try{r.default.PAssert(2232,!1,"Invalid search state: ",e)}catch(e){r.default.reportError(e)}}}.bind(this))}},notifySearchChanged:function(e){var t=this.search.getValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var a=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch.bind(this),a)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this.isLoading.set(!1),this.paneTopText.set("")},refreshPaneData:function(){this.plugin.refreshCurrentView(this.id)},notifyDropFrom:function(e,t){this.plugin.notifyDropFrom(e,t)},notifyDropFromToEdit:function(e,t){return this.plugin.notifyDropFromToEdit(e,t)},applyDropOnBlock:function(e,t){if(e.isDate){var a,n=e.dateTime||e.date;a=r.default.isString(n)?l.a.parseDate(n,i.a.DateFormat.MDY):n;try{r.default.PAssert(2233,r.default.isDateValid(a),"Must provide a valid date when scheduling an email",e.dateTime,e.date)}catch(e){r.default.reportError(e)}r.default.isDateValid(a)&&this.plugin.scheduleFile(t,a)}},dropEffectCopyBehavior:function(e,t){return this.plugin.isItemDroppable(e)?this._super.dropEffectCopyBehavior.call(this,e,t):void r.default.toasts.pushMessage(MessageID.DisabledFolderDrop)},refreshPaneData:function(){this.plugin.refreshCurrentView(this.id)},isSearchingRemote:function(){return this._isSearchingRemote.get()},_onRemoteDataLoaded:function(){},isItemHeader:function(e,t){if(t){var a=this.plugin,i=e.getAttachmentByPlugin(a.id),r=i&&a.getCacheData(i.id);return!r||a.isFolder(r)}return e.isHeader()}};n.a.inherit(o.a,d),n.a.extend(d.prototype,c),t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(4),s=(a(15),a(48)),o=a(18),l="Gmail";function d(){if(this._isBuiltin=!0,this._super.constructor.call(this,PluginID.Mailbird,"Mailbird"),this.declareProperty("subject",PluginLoad.Preview|PluginLoad.Full,!1,""),this.declareProperty("from",PluginLoad.Preview|PluginLoad.Full,!1,""),this.declareProperty("date",PluginLoad.Preview|PluginLoad.Full,!0,new Date),this.declareProperty("subjectLower",PluginLoad.Runtime,!1,""),this.declareProperty("fromLower",PluginLoad.Runtime,!1,""),this.declareProperty("unread",PluginLoad.Runtime,!0,!1),this.declareProperty("snippet",PluginLoad.Runtime,!0,""),this.declareProperty("count",PluginLoad.Runtime,!0,1),this.declareProperty("latestMessageAt",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("provider",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("threadID",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("hasAttachments",PluginLoad.Full,!0,!1),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.EmailThread),this.isMailbirdEmbed=n.a.embed===EmbedApps.Mailbird,this.isMailbirdEmbed){this.setSetting(this.Settings.IsEnabled,!0),i.default.nativeBridge.registerEmbedBridge(this);var e=i.default.nativeBridge.registerInboundAPI("mailbird");try{i.default.PAssert(1654,e,"Error creating native inbound API for mailbird")}catch(e){i.default.reportError(e)}e&&(e.registerVariable("_prevX"),e.registerVariable("_prevY"),e.registerFunction("dragOver",c.dragOver,!0),e.registerFunction("drop",c.drop,!0),e.registerFunction("dragLeave",c.dragLeave,!0),e.registerFunction("reportError",c.reportError,!0)),this._mailbirdOutAPI=i.default.nativeBridge.registerOutboundAPI("mailbird");try{i.default.PAssert(1655,this._mailbirdOutAPI,"Error creating native outbound API for mailbird")}catch(e){i.default.reportError(e)}this._mailbirdOutAPI&&(this._mailbirdOutAPI.requireFunction("selectConversation"),this._mailbirdOutAPI.requireFunction("selectConversationEx",!0),this._mailbirdOutAPI.requireFunction("scheduleNotifications",!0))}}var c={dragOver:function(e){var t=i.default.elementFromPoint(e.x,e.y);if(t){var a=void 0!==this._prevX?e.x-this._prevX:0,r=void 0!==this._prevY?e.y-this._prevY:0;this._prevX=e.x,this._prevY=e.y;var n={clientX:e.x,clientY:e.y,diffX:a,diffY:r,target:t,dataTransfer:{}};o.a.handleDragOver(n)}},drop:function(e){var t=i.default.elementFromPoint(e.x,e.y);var a={clientX:e.x,clientY:e.y,target:t,dataTransfer:{getData:function(t){if("mailbird/email"===t){var a={subject:e.subject||"",from:e.from||"",id:e.mailMessageId?e.mailMessageId:"mailbird_"+e.id,latestMessageAt:e.latestMessageAt};return e.gmailID&&(a.provider="Gmail",a.threadID=e.gmailID),a}}},preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn};setTimeout(function(){o.a.handleDrop(a)},0)},dragLeave:function(){o.a.handleDragLeave({target:document.getElementById("container")})},reportError:function(e){i.default.reportError(new Error(e))}},u={getPaneIcon:function(){return"icon-envelope"},useItemStore:function(){return"Mailbird"},_addRemoteEntry:function(e){var t={id:e.id,provider:e.provider,threadID:e.threadID,subject:e.subject,subjectLower:e.subject.toLowerCase(),from:e.from,fromLower:e.from.toLowerCase(),latestMessageAt:e.latestMessageAt};return this.cacheData(t.id,t),t},createEntryFromLocal:function(e,t){return t.subjectLower=t.subject.toLowerCase(),t.fromLower=t.from.toLowerCase(),t},getAttachmentClass:function(e){return["plugin_mailbird"]},isPluginBlocked:function(){return!1},handleEmbedMessage:function(e,t){switch(e){case"scheduledItems":if(this._mailbirdOutAPI.hasOptionalFunction("scheduleNotifications"))try{var a=JSON.stringify(t);this._mailbirdOutAPI.call("scheduleNotifications",a)}catch(e){i.default.reportError(e)}break;default:try{i.default.PAssert(1656,!1,"Unknown embed message: "+e)}catch(e){i.default.reportError(e)}}},handleDropEvent:function(e,t){try{i.default.PAssert(1657,t,"Must provide a valid callback to the drop event")}catch(e){i.default.reportError(e)}if(e.dataTransfer){var a=e.dataTransfer.getData("mailbird/email");if(a){var r=this._addRemoteEntry(a);t(this._getTextForItem(r));var n=this.getAttachment(r.id);try{i.default.PAssert(1658,n.isLoaded(),"Mailbird attachments must always be loaded after creation")}catch(e){i.default.reportError(e)}return this.writeAttachmentToPreviewCache(n),!0}}return!1},handleTapStart:function(e,t,a,i){return!0},handleTapClick:function(e,t,a,r){var n=this.getCacheData(a);if(n){if(this.isMailbirdEmbed){var s;if(!n.id.startsWith("mailbird_")&&this._mailbirdOutAPI.hasOptionalFunction("selectConversationEx")){var o=null;if("Gmail"===n.provider){try{i.default.PAssert(1659,n.threadID,"Must provide a valid Gmail ID if it is defined as the provider")}catch(e){i.default.reportError(e)}o=parseInt(n.threadID)}a=n.id;s=this._mailbirdOutAPI.call("selectConversationEx",o,a,n.latestMessageAt)}else{a=n.id.replace("mailbird_","");s=this._mailbirdOutAPI.call("selectConversation",a)}try{i.default.PAssert(1660,void 0!==s,"Must always receive a value back from Mailbird")}catch(e){i.default.reportError(e)}if(!0===s||!1===s)try{i.default.PAssert(1661,s,"Must have successfully selected the email conversation in Mailbird: ",n.id,n.provider)}catch(e){i.default.reportError(e)}else{try{i.default.PAssert(1662,s&&s.then,"Must have a valid promise object returned")}catch(e){i.default.reportError(e)}s.then(function(e){try{i.default.PAssert(1663,e,"Must have successfully selected the email conversation in Mailbird: ",n.id,n.provider)}catch(e){i.default.reportError(e)}},function(e){try{i.default.PAssert(1664,!1,"Failed to successfully select the email conversation in Mailbird: ",n.id,n.provider)}catch(e){i.default.reportError(e)}})}}else switch(n.provider){case l:i.default.openUrl("https://mail.google.com/mail/u/0/#inbox/"+n.threadID);break;default:i.default.toasts.pushMessage(MessageID.MailbirdClick)}return!0}return!1},getDisplayTags:function(e){return[]},getDisplayParticipants:function(e){return""},matchAttachment:function(e,t){return e.getField("fromLower").indexOf(t)>=0||e.getField("subjectLower").indexOf(t)>=0},findMatchExact:function(e){},findMatchLike:function(e,t){var a=e.toLowerCase();return this.findCachedItemsByFn(function(e){return e.subjectLower.indexOf(a)>=0||e.fromLower.indexOf(a)>=0},t)},supportOfflineCache:function(){return!0},usesPreviewCache:function(){return!0}};r.a.inherit(s.a,d),r.a.extend(d.prototype,u),t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(7),s=a(5),o=a(10),l=a(39),d=a(13),c=a(43),u=a(11),h=a(136),f=a(14),p=a(48),m=a(87),g=a(137),v=a(138),y=a(76),S=a(139),E=a(88),P=a(140),b=a(28),C=a(47),D=a(141);function I(){this._super.constructor.call(this,PluginID.Gmail,"Email"),this.SystemLabels=x,this.SpecialLabels=O,this._lastSyncTime=void 0,s.a.forceBind("threadSortFn",this),s.a.forceBind("threadSortPriorityFn",this),s.a.forceBind("labelSortFn",this),s.a.forceBind("labelVMLISortFn",this),s.a.forceBind("sortFn",this),s.a.forceBind("_fromComparator",this),s.a.forceBind("_toComparator",this),s.a.forceBind("_dateComparator",this),s.a.forceBind("_messagesComparator",this),s.a.forceBind("_shallowObjComparator",this),s.a.forceBind("isGmailItem",this),s.a.forceBind("_flushPendingDraftUpdates",this),s.a.forceBind("driveMessageContentSync",this),s.a.forceBind("_cleanupLocalCaches",this),s.a.forceBind("_handleDeferredSnoozeTask",this),s.a.forceBind("_cancelDeferredSnoozeTask",this),s.a.forceBind("_persistRemoteSnoozeTask",this),s.a.forceBind("_handleDeferredSendMailTask",this),s.a.forceBind("_cancelDeferredSendMailTask",this),s.a.forceBind("_persistRemoteSendMailTask",this),this._emailCache={},this._labelsByID={},this._labelsByName={},this._priorityLabels={},this._creatingDrafts={},this._pendingDraftUpdates={},this._pendingThreadLoads={},this._loadThreadMutex=0,this._activeDraftUpdates=0,this._accountSettings={},this._pendingSends={},this._draftCache={},this._unsyncdMessages={},this._pendingSyncdMessages={},this._numUnsyncdMessages=0,this._numSyncdMessages=0,this._outstandingContentSync=!1,this._undoStack=new h.a(10),this._generateUndoRedo(),this._syncingOfflineChanges=!1,this._draftFlushTimer=void 0,this.registerSetting("WriteAccess","writeAccess",!0),this.registerSetting("SyncTime","syncTime",!0,r.a.MaxGmailSyncTime.Free),this.registerSetting("SyncAccounts","syncAccounts",!0,["me"]),this.registerSetting("ArchiveOnSchedule","archiveOnSchedule",!0,!1),this.registerSetting("ArchiveOnOrganize","archiveOnOrganize",!0,!1),this.registerSetting("InsertSignatureAboveReplies","insertSignatureAboveReplies",!0,!1),this.addTrackedStat(A.EnsureLabelVMLI),this.addTrackedStat(A.CreateLabelVMLI),this.addTrackedStat(A.MergeThread),this.addTrackedStat(A.SyncdMessage),this.addTrackedStat(A.ErrorSyncdMessage),this.addTrackedStat(A.UnsyncdMessage),this.addTrackedStat(A.OldUnsyncdMessage),this.addTrackedStat(A.MessagesSyncd),this.addTrackedStat(A.MessageDataCached),this._threadCache=this.registerLocalCache("GmailThreadCache",StorageType.IndexedDB,!0,{noInMemoryCache:!0}),this._rawCache=this.registerLocalCache("RawCache",StorageType.IndexedDB,!1,{noInMemoryCache:!0}),this.registerDeferredTaskType(M.Snooze,this._handleDeferredSnoozeTask,this._cancelDeferredSnoozeTask,this._persistRemoteSnoozeTask),this.registerDeferredTaskType(M.SendMail,this._handleDeferredSendMailTask,this._cancelDeferredSendMailTask,this._persistRemoteSendMailTask),this._contentSyncTask=this.registerLowImpactTask("ContentSync",this.driveMessageContentSync),this._cacheCleanup=this.registerLowImpactTask("CacheCleanup",this._cleanupLocalCaches),this._lastCacheCleanup=0,i.default.isDemoMode()?this.declareProperty("accountID",PluginLoad.Preview|PluginLoad.Full|PluginLoad.Inline,!0,"me"):this.declareProperty("accountID",PluginLoad.Preview|PluginLoad.Full|PluginLoad.Inline),this.declareProperty("from",PluginLoad.Preview|PluginLoad.Full,!1,void 0,this._fromComparator),this.declareProperty("to",PluginLoad.Preview|PluginLoad.Full,!1,void 0,this._toComparator),this.declareProperty("subject",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("date",PluginLoad.Preview|PluginLoad.Full,!0,new Date(0),this._dateComparator),this.declareProperty("lastModifiedDate",PluginLoad.Full,!0,void 0,this._dateComparator),this.declareProperty("modifiedOffline",PluginLoad.Full,!0,!1),this.declareProperty("pendingSend",PluginLoad.Full,!0,!1),this.declareProperty("messages",PluginLoad.Full,!0,[],this._messagesComparator),this.declareProperty("snippet",PluginLoad.Full),this.declareProperty("participants",PluginLoad.Runtime,!0,[]),this.declareProperty("subjectLower",PluginLoad.Runtime),this.declareProperty("count",PluginLoad.Runtime),this.declareProperty("dataLoaded",PluginLoad.Runtime,!0,!1),this.declareProperty("isDeleted",PluginLoad.Runtime,!0,!1),this.declareProperty("labelIds",PluginLoad.Runtime,!0,[]),this.declareProperty("hasAttachments",PluginLoad.Full,!0,!1),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.EmailThread)}var A={EnsureLabelVMLI:"EnsureLabelVMLI",CreateLabelVMLI:"CreateLabelVMLI",MergeThread:"MergeThread",SyncdMessage:"SyncdMessage",ErrorSyncdMessage:"ErrorSyncdMessage",UnsyncdMessage:"UnsyncdMessage",OldUnsyncdMessage:"OldUnsyncdMessage",MessagesSyncd:"MessagesSyncd",MessageDataCached:"MessageDataCached"},M={Snooze:"snoozemail",SendMail:"sendmail"},_={FullSync:1,History:2,ThreadFull:3,ThreadMeta:4,Search:5,DataPage:6,Send:7,Labels:8,CreateLabel:9,ModifyLabels:10,Trash:11,ThreadLabel:12,DraftCreate:13,DraftUpdate:14,DraftDelete:15,DraftSend:16,DraftList:17,GetAttachment:18,MessageFull:19,SendAs:20},T="historyIDs",w="labels",k="sendAs",x={INBOX:"INBOX",SPAM:"SPAM",TRASH:"TRASH",UNREAD:"UNREAD",STARRED:"STARRED",IMPORTANT:"IMPORTANT",SENT:"SENT",DRAFT:"DRAFT",CHAT:"CHAT",CATEGORY_PERSONAL:"CATEGORY_PERSONAL",CATEGORY_SOCIAL:"CATEGORY_SOCIAL",CATEGORY_PROMOTIONS:"CATEGORY_PROMOTIONS",CATEGORY_UPDATES:"CATEGORY_UPDATES",CATEGORY_FORUMS:"CATEGORY_FORUMS"},L={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},O={ARCHIVED:"==MOODO_ARCHIVED==",ALLMAIL:"==MOODO_ALLMAIL=="},R={PRI0:"Moo.do/Priority High",PRI1:"Moo.do/Priority Medium",PRI2:"Moo.do/Priority Low"},N=["id","labelIds","messageID","draftID","decoded","mimeType","contentType","from","replyTo","to","cc","bcc","snippet","subject","date","internalDate","references","inReplyTo","listUnsubscribe","resources","cached","cachedError"],F="multipart/signed",U="multipart/related",B="message/partial",V="multipart/mixed",H="multipart/report",q="multipart/parallel",G="multipart/alternative",z="multipart/digest",W="multipart/encrypted",j="multipart/voice-message",K="text/calendar",Y="text/plain",X="text/html",Q="text/watch-html",J="text/x-watch-html",Z="inline",$="attachment",ee=["application","audio","example","image","message","model","video","text"],te=[G,V,Y,X,H],ae=[Y,X],ie=[K,j,W,V],re=["modifiedOffline","pendingSend","isDeleted","dataLoaded"],ne=/(?:[\"]?([^\"]*)[\"]?\s)?<(.*)>/g,se=/\'(.*)\'/g,oe=25,le={getType:function(){return r.a.PluginType.Email},_attachMetadataFields:function(){return re},getDataPane:function(){try{i.default.PAssert(1773,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){i.default.reportError(e)}return S.a},getPaneIcon:function(){return"icon-mail_outline"},getPanePriority:function(){return 97},useItemStore:function(){return"Gmail"},itemStoreOptions:function(){return{requireStoredEls:!1,enabledFilters:r.a.ItemStoreFilter.Priority,parserFn:c.a.runParseSinglePlugin.bind(c.a)}},allowRemoteRequests:function(){return!0},ensureAccountEmail:function(e){return"me"===e?this.getDefaultAccount():e},getDefaultAccount:function(){var e,t=i.default.getUserIdentifier();if(t){try{i.default.PAssert(1774,i.default.isDemoMode()||"me"!==t,'Should never return "me" as a valid user')}catch(e){i.default.reportError(e)}e=t}else{try{i.default.PAssert(1775,!1,'Unable to get default account name, returning "me"')}catch(e){i.default.reportError(e)}e="me"}return e},isSameAccount:function(e,t){return"me"===e&&(e=this.getDefaultAccount()),"me"===t&&(t=this.getDefaultAccount()),e===t},areItemsFromSameAccount:function(e,t){var a=this._getAccountIDFromItem(e),i=this._getAccountIDFromItem(t);return this.isSameAccount(a,i)},_handleAccountChanges:function(){var e=[];i.default.vmMain.paneManager.runForEachPane(function(t){var a=this._getAccountIDFromItem(t.getItem());try{i.default.PAssert(1776,a,"Missing Account ID: ",t.id,t.getItem().id)}catch(e){i.default.reportError(e)}this.hasSyncAccount(a)||e.push(t)}.bind(this),this.getPaneType());for(var t=0;t<e.length;++t)i.default.vmMain.paneManager.removePane(e[t]);0===e.length&&i.default.vmMain.paneManager.notifyPanes()},addSyncAccount:function(e,t){var a=this.getSetting(this.Settings.SyncAccounts).slice(0);try{i.default.PAssert(1777,a.indexOf(e)<0,"Must not double add sync accounts to list")}catch(e){i.default.reportError(e)}a.indexOf(e)<0&&a.push(e),this.setSetting(this.Settings.SyncAccounts,a),this.isActive()?(this._ensureLabel(e,x.INBOX,"Inbox",void 0,void 0,ChangeType.Local),this._ensureLabel(e,x.UNREAD,"Unread",void 0,void 0,ChangeType.Local),this._ensureLabel(e,O.ARCHIVED,"Archived",void 0,void 0,ChangeType.Local),this._ensureLabel(e,O.ALLMAIL,"All Mail",void 0,void 0,ChangeType.Local),this._forceLabelSync(function(){this._forceThreadSync(t)}.bind(this))):t(!0),this._handleAccountChanges()},removeSyncAccount:function(e,t){var a=this.getSetting(this.Settings.SyncAccounts).slice(0);try{i.default.PAssert(1778,a.indexOf(e)>=0,"Must be able to find sync account if removing")}catch(e){i.default.reportError(e)}if(a.remove(e),this.setSetting(this.Settings.SyncAccounts,a),this._clearCachedData(e,t),this.getDefaultItemStore()){var r=this.getVMLIForAccount(e);r&&(r.deleteSelf(ChangeType.Local),r.getItemStore().destroyItem(r.id))}this._handleAccountChanges()},_iterateSendAs:function(e){for(var t=this.getSyncAccounts(),a=!1,i=0;!a&&i<t.length;++i){var r=this.getAccountSetting(t[i],"sendAs");if(r)for(var n=0;n<r.length;++n){var s=r[n];if(e(t[i],s)){a=!0;break}}else e(t[i])}},getSignature:function(e){var t;return this._iterateSendAs(function(a,i){if(i&&i.sendAsEmail===e)return t=i.signature,!0}),t},getReplyToAddress:function(e){var t;return this._iterateSendAs(function(a,i){if(i&&i.sendAsEmail===e&&i.replyToAddress)return t=i.replyToAddress,!0}),t},_computeDisplayName:function(e,t){return!t.displayName&&t.isPrimary?f.a.getAccountName(e):t.displayName},getDisplayName:function(e){var t;return this._iterateSendAs(function(a,i){if(i&&i.sendAsEmail===e)return t=this._computeDisplayName(a,i),!0}.bind(this)),t},getDefaultSendingAccount:function(e){var t;return this._iterateSendAs(function(a,i){if(a===e&&i&&i.isDefault)return t=i.sendAsEmail,!0}),t||(t=e),t},getDefaultFromInfo:function(e){var t=this.getDefaultSendingAccount(e);try{i.default.PAssert(1779,t,"Must have found a valid account to send from")}catch(e){i.default.reportError(e)}return{text:this.getDisplayName(t),email:t}},getSendingAccounts:function(e){var t=[];return this._iterateSendAs(function(a,i){e&&e!==a||(i?"pending"!==i.verificationStatus&&t.push(i.sendAsEmail):t.push(a))}),t},getSyncAccount:function(e){var t;return this._iterateSendAs(function(a,i){if(i){if(i.sendAsEmail===e)return t=a,!0}else if(e===a)return t=a,!0}),t},getSendingAccountInfo:function(e){var t;return this._iterateSendAs(function(a,i){if(i){if(i.sendAsEmail===e)return t={text:this._computeDisplayName(a,i),email:e},!0}else if(e===a)return t={text:f.a.getAccountName(a),email:a},!0}.bind(this)),t},getSyncAccounts:function(){for(var e=this.getSetting(this.Settings.SyncAccounts)||["me"],t=[],a=0;a<e.length;++a)"me"===e[a]?t.push(this.getDefaultAccount()):t.push(e[a]);try{i.default.PAssert(1780,i.default.isDemoMode()||t.indexOf("me")<0,'Must not contain "me" as an account')}catch(e){i.default.reportError(e)}return i.default.arrayUniques(t)},numSyncAccounts:function(){return this.getSyncAccounts().length},hasSyncAccount:function(e){return this.getSyncAccounts().indexOf(e)>=0},_getSettingsSendAs:function(e){for(var t=this.getSyncAccounts(),a=t.length,i=0,r={},n=function(t,n,s){t&&(r[n]=s.sendAs),++i===a&&e(r)},s=0;s<t.length;++s)this._requestSettings(t[s],n)},_requestSettings:function(e,t){var a=l.a.fns("gmail").users.settings.sendAs.list.packedFn,i={userId:e},r=function(a){t(!1,e,a),this._notifyFailedRequest(e,a)}.bind(this);this._queueRemoteRequestMulti(e,a,i,function(a){t(!0,e,a)},r,void 0,_.SendAs)},_fromComparator:function(e,t){var a=!1;if(e||t){if(e&&t){try{i.default.PAssert(1781,!i.default.isString(e),"Old from must not be a string")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1782,!i.default.isString(t),"New from must not be a string")}catch(e){i.default.reportError(e)}e.text===t.text&&e.email===t.email&&(a=!0)}}else a=!0;return a},_toComparator:function(e,t){var a=!1;if(e||t){if(e&&t){try{i.default.PAssert(1783,i.default.isArray(e),"Old to must be an array")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1784,i.default.isArray(t),"New to must be an array")}catch(e){i.default.reportError(e)}a=t.equals(e)}}else a=!0;return a},_dateComparator:function(e,t){var a=!1;if(e||t){if(e&&t){i.default.isString(e)&&(e=this.parseDateHeader(e)),i.default.isString(t)&&(t=this.parseDateHeader(t));try{i.default.PAssert(1785,i.default.isDateValid(e),"Must be an old valid date to compare")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1786,i.default.isDateValid(t),"Must be a new valid date to compare")}catch(e){i.default.reportError(e)}i.default.isDateValid(e)&&i.default.isDateValid(t)&&(a=e.equals(t))}}else a=!0;return a},_messagesComparator:function(e,t){var a=!0;if(e&&t)if(e.length===t.length)for(var i=0;a&&i<t.length;++i){for(var r=e[i],n=t[i],s=0;s<N.length;++s){var o=N[s],l=!0;switch(o){case"from":l=this._fromComparator(r[o],n[o]);break;case"to":l=this._toComparator(r[o],n[o]);break;case"resources":case"listUnsubscribe":l=this._shallowObjComparator(r[o],n[o]);break;case"labelIds":l=n[o].equals(r[o]);break;case"date":case"internalDate":l=this._dateComparator(r[o],n[o]);break;default:l=r[o]===n[o]}l||(a=!1)}0}else a=!1;else a=!1;return a},_shallowObjComparator:function(e,t){var a=!1;if(e||t){if(e&&t)if(e===t)a=!0;else for(var i in a=!0,e)if(!t.hasOwnProperty(i)){a=!1;break}}else a=!0;return a},_offlineLoad:function(){this._threadCache.onCacheReady(function(){this._threadCache.onCacheMetadataReady(function(){i.default.isDemoMode()||this._threadCache.getMetadata(k,function(e){if(e)for(var t in e)this.setAccountSetting(t,"sendAs",e[t])}.bind(this)),this._threadCache.getMetadata(w,function(e){i.default.batchRenderUpdates(function(){var t=this.getSyncAccounts();!i.default.isDemoMode()&&e||(e={}),e.me&&!e[this.getDefaultAccount()]&&(e[this.getDefaultAccount()]=e.me),i.default.vmMain.beginUpdateItems();for(var a=0;a<t.length;++a){var r=t[a];this._ensureLabel(r,x.INBOX,"Inbox",void 0,void 0,ChangeType.Local),this._ensureLabel(r,x.UNREAD,"Unread",void 0,void 0,ChangeType.Local),this._ensureLabel(r,O.ARCHIVED,"Archived",void 0,void 0,ChangeType.Local),this._ensureLabel(r,O.ALLMAIL,"All Mail",void 0,void 0,ChangeType.Local);var n=e[r];if(n){for(var s in n){var o=n[s];if(!x[o.id]){var l=o.name||"LocalLabel"+Date.now();this._ensureLabel(r,s,l,o.oldestSync,o,ChangeType.Local)}}for(var s in x){l=L[s];this._ensureLabel(r,s,l,void 0,void 0,ChangeType.Local)}}this._ensureLabelVMLIsForAccount(r)}i.default.vmMain.commitUpdateItems(),this.notifyPanesReadyForLoad();var d=this._getMetadataSyncTime(),c=this._getUnreadSyncTime(),u=function(e){return t.indexOf(e.accountID)>=0&&e.date.isAfter(c)},h=function(e,t){e&&e.length>0&&i.default.batchRenderUpdates(function(){i.default.vmMain.beginUpdateItems();for(var a=0;a<e.length;++a){var r=e[a];try{i.default.PAssert(1787,r,"Must always contain a valid entry when retreiving data from preload")}catch(e){i.default.reportError(e)}if(r&&(!t||u(r))){var n=this.createEntryFromLocal(r.id,r);(this.isPriorityData(n)||r.date.isAfter(d))&&(this.cacheData(n.id,n),this._updateSpecialLabels(n))}}i.default.vmMain.commitUpdateItems()}.bind(this))}.bind(this);this._threadCache.requestPreloadData(function(e){i.default.isArray(e)?h(e,!0):this._threadCache.getFilterEntries(u,h)}.bind(this))}.bind(this))}.bind(this))}.bind(this))}.bind(this))},isPriorityData:function(e){var t=!1;return e.labelIds.indexOf(x.UNREAD)>=0?t=!0:e.labelIds.indexOf(R.PRI0)>=0?t=!0:e.labelIds.indexOf(R.PRI1)>=0?t=!0:e.labelIds.indexOf(R.PRI2)>=0&&(t=!0),t},_load:function(){i.default.isDemoMode()||this.createRecurringTask("GmailThreadSync",{delay:i.default.minutes(15),minDelay:i.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:i.default.minutes(2),task:this.runThreadSync.bind(this)}),this.runSettingsSync(),this.createRecurringTask("GmailLabelSync",{delay:i.default.minutes(30),minDelay:i.default.minutes(15),runOnCreate:!0,pauseWhileIdle:!0,async:!0,task:this.runLabelSync.bind(this)})},_notifyFailedRequest:function(e,t){try{i.default.PAssert(1788,i.default.isString(e),"Must supply a valid accountID string")}catch(e){i.default.reportError(e)}if(t&&t.error)if(t.error.code===r.a.HTTPStatusCode.Unauthorized)f.a.isDefaultEmail(e)?(i.default.toasts.pushMessage(MessageID.LostPermission),this.setSetting(this.Settings.IsEnabled,!1)):i.default.toasts.pushMessage(MessageID.LostLinked),f.a.notifyUnauthorizedAccount(e,[GScope.GmailCompose,GScope.GmailModify],t.error.message);else if(t.error.code===r.a.HTTPStatusCode.BadRequest)for(var a=t.error.errors,n=0;n<a.length;++n){a[n].reason===r.a.GoogleError.FailedPrecondition&&(i.default.toasts.pushMessage(MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else if(t.error.code===r.a.HTTPStatusCode.Forbidden)for(a=t.error.errors,n=0;n<a.length;++n){a[n].reason===r.a.GoogleError.InsufficientPermissions&&(i.default.toasts.pushMessage(MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else t.error.code>=400&&t.error.code<500&&this._reportErrorCode(t.error.code)&&i.default.reportError(new Error("Failed Gmail request: "+t.error.code),t)},_reportErrorCode:function(e){var t=!1;return e!==r.a.HTTPStatusCode.NotFound&&(t=!0),t},_notifySendFailed:function(){i.default.toasts.pushMessage(MessageID.EmailSendFail)},_createResourceCID:function(e,t){t||(t="UnnamedFile");for(var a=t,i=1;e.has(a);){var r=t.split(".");a=r[0]+"_"+i,r[1]&&(a+="."+r[1]),i++}return a},_createResource:function(e,t){try{i.default.PAssert(1789,e,"Must have valid resources lib to add to")}catch(e){i.default.reportError(e)}return{cid:this._createResourceCID(e,t.name),id:i.default.generateTempId(),attID:void 0,realAttrID:void 0,data:void 0,size:void 0,thumbnail:void 0,uploader:void 0,link:void 0,error:!1,disposition:$,parentType:V,mimeType:t.type,contentEncoding:void 0}},_getLinkedResourceString:function(e){return'<a cid="'+e.cid+'" style="background-color:#f3f3f3;border:1px solid #dddddd;padding:8px;width:396px;font-weight:bold;min-height:18px;display:block;border-radius:3px;margin-bottom:8px;" href="'+e.link+'"><img style="vertical-align:top;border:none;margin-right:8px;" src="https://ssl.gstatic.com/docs/doclist/images/icon_10_generic_list.png">'+e.cid+"</a>"},_removeAttachContent:function(e,t,a){var i,r=C.a.removeElementsByAttribute(t.decoded,"cid",a.cid);return i=r!==t.decoded,t.decoded=r,i},notifyAttachLinkedFile:function(e,t,a,i){var r={name:a.getField("title"),type:a.getField("mimeType")},n=this._createResource(t.resources,r);n.size=a.getField("fileSize"),n.link=a.getField("alternateLink"),this._shareAttachment(e,a.id,n,i),t.resources.add(n),e.notifyDataMutated(["hasAttachments"],ChangeType.Local)},notifyAttachFiles:function(e,t,a,r){for(var n=e.getField("accountID"),s=0;s<a.length;++s){var o=a[s],l=this._createResource(t.resources,o),d=function(t,a){e.notifyDataMutated(["hasAttachments"],ChangeType.Local)}.bind(this,l),c=function(t,a){t.error=!1,t.link=a.alternateLink,t.thumbnail=a.thumbnailLink,this._shareAttachment(e,a.id,t,r)}.bind(this,l),u=function(t){t.error=!0,i.default.toasts.pushMessage({text:"There was an error uploading your attachment.",actionText:"RETRY",action:function(){t.uploader.resume()}}),e.notifyDataMutated(["hasAttachments"],ChangeType.Local),r&&r(!1)}.bind(this,l);l.size=o.size,l.uploader=new D.a(o,n,d,c,u),l.uploader.upload(),t.resources.add(l)}e.notifyDataMutated(["messages"],ChangeType.Local)},_shareAttachment:function(e,t,a,n){try{i.default.PAssert(1790,t,"Must supply a valid fileID to share")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1791,a,"Must supply a valid resource object to share")}catch(e){i.default.reportError(e)}i.default.vmMain.remoteAPI().drivePermissionsPublic(t,function(t){a.error=!1,e.notifyDataMutated(["messages"],ChangeType.Local),n&&n(!0)}.bind(this),function(s){a.error=!0,i.default.isHTTPStatusCode(s,r.a.HTTPStatusCode.Forbidden)?i.default.toasts.pushMessage({text:"Sharing files/attachments in Google Drive is disabled on your domain. Please contact your domain administrator.",actionText:"OKAY",hold:!0}):i.default.toasts.pushMessage({text:"There was an error sharing your attachment.",actionText:"RETRY",action:function(){this._shareAttachment(e,t,a,n)}.bind(this)}),e.notifyDataMutated(["hasAttachments"],ChangeType.Local),n&&n(!1)}.bind(this))},removeAttachFiles:function(e,t,a){try{i.default.PAssert(1792,a,"Must always specify a valid resource to remove from the message")}catch(e){i.default.reportError(e)}var r=!1;return a.uploader&&!a.uploader.isDone()&&(a.uploader.cancel(),r=!0),t.resources.has(a.cid)&&t.resources.remove(a),r=this._removeAttachContent(e,t,a)||r,e.notifyDataMutated(["messages"],ChangeType.Local),r},notifyItemPropertyChanged:function(e,t,a,i){var r=this.attachmentIsArchived(e);t.belongsToItemStore(this.getDefaultItemStore())&&(t.dateCompleted&&!r&&this.archiveAttachment(e));"priority"===i?this.getAttachmentPriority(e)!==t.priority()&&this.setAttachmentPriority(e,t.priority()):"isArchived"===i&&(r&&!t.isArchived()?this.unarchiveAttachment(e):!r&&t.isArchived()&&(this.archiveAttachment(e),b.a.isOpenOnThread(e)&&b.a.reset()))},createLabelString:function(e){if(!L[e.toUpperCase()])return e},isDisplayTag:function(e,t){var a=!1;if(e&&e.shouldDisplayInMessageList()){var i=e.isCustom()||e.getLabelID()===x.DRAFT,r=t&&!t.isInbox()&&e.isInbox();if(i||r)switch(a=!0,e.getName()){case R.PRI0:case R.PRI1:case R.PRI2:case"Moo.do/Handled":case L.STARRED:a=!1}}return a},isDisplayHeader:function(e){var t=!1;this.isLabelItem(e)&&(this._getLabelIDFromItem(e)!==x.UNREAD&&(t=!0));return t},isMessageDraft:function(e){return e&&e.labelIds&&e.labelIds.indexOf(x.DRAFT)>=0},getDisplayTags:function(e,t,a){var i,r=e.getField("labelIds"),n=e.getField("accountID"),s=[];t&&(i=t.getItemLabel(!0));for(var o=0;o<r.length;++o){var l=this._getLabelByID(n,r[o]);if(this.isDisplayTag(l,i)){var d=a?l.getOutlineText():l.getDisplayText();d&&s.push(d)}}return s},_getParticipantDisplayName:function(e,t){var a;if(this.isMyAccountID(e.email))a="me";else if(e.text)if(1===t)a=e.text;else{var i=e.text.split(" ");a=i&&i.length>0?i[0]:e.email}else a=e.email;return a},getDisplayParticipants:function(e){for(var t=e.getField("participants"),a=[],i=0;i<t.length;++i)a.push(this._getParticipantDisplayName(t[i],t.length));return a.join(", ")},getDefaultDisplayItem:function(e){e=e||this.getDefaultAccount();var t=this._getLabelByID(e,x.INBOX);return this.getVMLIForLabel(e,t)},getEmailRootItem:function(){return E.a.getItems(r.a.FavoriteGroup.EmailRoot)[0]},hasEmailRootItem:function(){return E.a.hasItems(r.a.FavoriteGroup.EmailRoot)},createEmailRootItem:function(){try{i.default.PAssert(1793,!this.hasEmailRootItem(),"Should not create email root if it already exists")}catch(e){i.default.reportError(e)}var e=i.default.vmMain.itemStoreManager.getDefaultItemStore().getRoot(),t=n.a.createVMLI({text:"Email",favorites:[r.a.FavoriteGroup.EmailRoot]},{parent:e,changeType:ChangeType.AllLocal});return e.insertItem(t,0),i.default.toasts.pushMessage({text:'A new "Email" item was created at the top of your document for snoozed emails.',action:MessageAction.Okay,hold:!0}),t},ensureEmailItem:function(e){o.a.beginAction(),this.hasEmailRootItem()||this.createEmailRootItem();for(var t,a=this.getEmailRootItem(),i=a.getItems(),r=0;r<i.length;++r)if(i[r].getRawText()===e){t=i[r];break}return t||(t=n.a.createVMLI({text:e},{parent:a,changeType:ChangeType.AllLocal}),a.insertItem(t,0)),o.a.endAction(),t},getWaitingItem:function(e){e(this.ensureEmailItem("Waiting"))},allowTextEditing:function(e,t){var a=!0,i=this.getDefaultItemStore();return e.belongsToItemStore(i)&&(a=!1),a},getDraftForMessage:function(e,t,a,r){try{i.default.PAssert(1794,t,"Must have a valid thread ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1795,a,"Must have a valid message ID")}catch(e){i.default.reportError(e)}var n,s=this.getAttachment(t),o=s.getField("messages").indexOfWithProperty("id",a);try{i.default.PAssert(1796,o>=0,"Must be able to find the requested message")}catch(e){i.default.reportError(e)}var l=s.getField("messages")[o+1];l&&l.labelIds.indexOf(x.DRAFT)>=0?n=l:(this.createDraft(e,t,a,{from:r}),n=s.getField("messages")[o+1]);try{i.default.PAssert(1797,n.labelIds.indexOf(x.DRAFT)>=0,"Must return a valid draft")}catch(e){i.default.reportError(e)}return n},getDraftByID:function(e,t,a,r){var n,s;if(t){n=this.getAttachment(t),s=a?this._getMessageFromAttachment(n,a):n.getField("messages")[0];try{i.default.PAssert(1798,s.labelIds.indexOf(x.DRAFT)>=0,"Must be a valid draft")}catch(e){i.default.reportError(e)}}else{var o=this.createDraft(e,void 0,void 0,r);s=(n=this.getAttachment(o.threadID)).getField("messages")[0]}return{attach:n,draftMsg:s}},_notifyDraftMessage:function(e,t,a){try{i.default.PAssert(1799,e,"Must supply a valid accountID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1800,t&&!i.default.isTempId(t),"Must supply a valid threadID: ",t)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1801,a&&!i.default.isTempId(a),"Must supply a valid messageID: ",a)}catch(e){i.default.reportError(e)}setTimeout(function(){this.hasCacheData(t)&&this._getRemoteDraftID(e,t,a,function(e,a){a&&(log("DraftID: ",e),this.cacheData(t,this.getCacheData(t),!0,["messages"]))}.bind(this))}.bind(this),0)},_notifyLocalDraftDelete:function(e,t,a){},_getInlineResources:function(e){var t=new y.a;return e.resources.forEachResource(function(e){e.disposition===Z&&t.add(i.default.clone(e))}),t},createDraft:function(e,t,a,r){r=r||{};try{i.default.PAssert(1802,!r.body||!r.decoded,"Must not supply both a decoded field and a body")}catch(e){i.default.reportError(e)}this.sendEvent("CreateDraft");var n=i.default.generateTempId(),s=r.from||this.getDefaultFromInfo(e),o=r.body||r.decoded||"";""===o&&(o=this.createSignature(s.email));var l,d,c={id:n,modifiedOffline:!0,labelIds:[x.DRAFT],messageID:void 0,raw:"",decoded:o,mimeType:X,contentType:"text/html;charset=utf-8",from:s,replyTo:this.getReplyToAddress(s.email),to:r.to||[],cc:r.cc||[],bcc:r.bcc||[],snippet:"",subject:r.subject||"",date:new Date,references:void 0,inReplyTo:void 0,resources:new y.a};if(t){l=this.getCacheData(t);try{i.default.PAssert(1803,a,"When supplying a thread ID, must also supply a valid message ID")}catch(e){i.default.reportError(e)}var u=l.messages.indexOfWithProperty("id",a);try{i.default.PAssert(1804,u>=0,"If requesting a reply to a message, it must exist in the thread")}catch(e){i.default.reportError(e)}var h=l.messages[u];if(h&&(c.references=(i.default.isTempId(h.messageID)?"":h.messageID)+(h.references?" "+h.references:""),i.default.isTempId(h.messageID)||(c.inReplyTo=h.messageID),c.resources=this._getInlineResources(h)),l.messages.splice(u+1,0,c),this.hasAttachment(t)){var f=this.getAttachment(t);this._updateAttachmentFromMessages(f,ChangeType.Local),f.notifyDataMutated(["messages"],ChangeType.Local)}this.addModifiedOffline(l,["messages"]),d=l}else l={id:n,accountID:e,modifiedOffline:!0,messages:[c],labelIds:[x.DRAFT],subject:r.subject||"",from:e},d=this.createEntryFromLocal(n,l),this.cacheData(d.id,d);return this.cacheThreadData(d.id,this.serializeExternalData(d)),{threadID:d.id,draftID:n,messageID:a}},_updateDraftID:function(e,t,a){try{i.default.PAssert(1805,a,"Must provide a valid set of draft info")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1806,a.id&&a.message,"Draft info must contain valid data")}catch(e){i.default.reportError(e)}var r=e.isLocalOnlyAttachment();r&&(this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,a.message.threadId),this._threadCache.removeEntry(t));var n=this._findDraft(e,t,a.id);if(n){n.id=a.message.id;try{i.default.PAssert(1807,n.draftID===a.id,"Should have valid draft ID associated with the message")}catch(e){i.default.reportError(e)}this._draftCache[n.id]=a.id,r&&this.cacheData(e.id,e.getData()),this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[n.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[n.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}},_updateDraftFromSend:function(e,t,a){try{i.default.PAssert(1808,a,"Must provide a valid set of draft info")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1809,a.id&&a.threadId,"Draft info must contain valid data")}catch(e){i.default.reportError(e)}e.isLocalOnlyAttachment();if(e.isLocalOnlyAttachment()){this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,a.threadId);try{i.default.PAssert(1810,!i.default.isTempId(e.id),"After an ID change, should never be a temp ID")}catch(e){i.default.reportError(e)}this._threadCache.removeEntry(t)}var r=this._getMessageFromAttachment(e,t);r.id=a.id,r.labelIds=a.labelIds||[],this._updateAttachmentFromMessages(e,ChangeType.Remote),this._draftCache[r.id]=a.id,this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[r.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[r.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))},_createRemoteDraft:function(e,t,a){if(this._creatingDrafts[t])a(!1,{msg:"Already creating remote draft for given message"});else{this._creatingDrafts[t]=!0;var r=this._getMessageFromAttachment(e,t);if(r)this._createRFC822Message(e.getData(),r,!1,function(i){var n={raw:i};e.isLocalOnlyAttachment()||(n.threadId=e.id);var s=l.a.fns("gmail").users.drafts.create.packedFn,o={userId:e.getField("accountID"),resource:{message:n}},d=function(i){this._attachmentHasMessage(e,t)&&(delete this._creatingDrafts[t],r.draftID=i.id,this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(r,!1),this._pendingDraftUpdates[t]&&this._notifyPendingDraftUpdate(),this._updateDraftID(e,t,i),this._updateIsSavingDrafts()),a(!0)}.bind(this),c=function(i){delete this._creatingDrafts[t],this._updateIsSavingDrafts(),a(!1,i),this._notifyFailedRequest(e.getField("accountID"),i)}.bind(this);this._queueRemoteRequestMulti(e.getField("accountID"),s,o,d,c,void 0,_.DraftCreate)}.bind(this));else{try{for(var n=e.getField("messages"),s=0;s<n.length;++s)if(n[s].labelIds.indexOf(x.DRAFT)>=0){!0;break}var o={length:n.length};i.default.reportError(new Error("Unable to find valid draft for creation"),o)}catch(e){i.default.reportError(e)}a(!1,{msg:"Unable to find requested message in thread"})}}},_updateIsSavingDrafts:function(){i.default.isSavingDrafts=this._activeDraftUpdates>0||!i.default.isEmpty(this._pendingDraftUpdates)||!i.default.isEmpty(this._creatingDrafts)},_notifyPendingDraftUpdate:function(e,t,a,i){e&&t&&(this._pendingDraftUpdates[t]={attach:e,draftID:a,lastUpdate:Date.now()},i&&this._runDraftUpdate(t)),this._draftFlushTimer&&clearTimeout(this._draftFlushTimer),this._draftFlushTimer=setTimeout(this._flushPendingDraftUpdates,12e3),this._updateIsSavingDrafts()},_flushPendingDraftUpdates:function(){if(this.isOnline()){for(var e in this._pendingDraftUpdates)this._runDraftUpdate(e);this._draftFlushTimer=void 0}},_runDraftUpdate:function(e){if(!this._creatingDrafts[e]){var t=this._pendingDraftUpdates[e];try{i.default.PAssert(1811,t,"Must be able to find valid draft info for pending draft update")}catch(e){i.default.reportError(e)}this._updateRemoteDraft(t.attach,e,t.draftID,!1,function(e,t){e?i.default.toasts.clearMessage(MessageID.EmailUpdateFail):i.default.isHTTPStatusCode(t,r.a.HTTPStatusCode.NotFound)?i.default.toasts.clearMessage(MessageID.EmailUpdateFail):i.default.toasts.pushMessage(MessageID.EmailUpdateFail),this._updateIsSavingDrafts()}.bind(this)),delete this._pendingDraftUpdates[e],this.sendEvent("UpdateDraft")}},_clearPendingDraftUpdate:function(e,t){var a=this._pendingDraftUpdates[t];if(a){try{i.default.PAssert(1812,a.attach===e,"Must have the correct attachment for the draft update")}catch(e){i.default.reportError(e)}delete this._pendingDraftUpdates[t]}},hasPendingSends:function(){return this._pendingSends.length>0},notifyPendingSend:function(e,t){try{i.default.PAssert(1813,!this._pendingSends[t],"Must not have an already pending send for a message")}catch(e){i.default.reportError(e)}this._pendingSends[t]=e,i.default.isSendingEmail=!0},notifySent:function(e,t){try{i.default.PAssert(1814,this._pendingSends[t],"Must have a pending send to be sent")}catch(e){i.default.reportError(e)}delete this._pendingSends[t],this.hasPendingSends()||(i.default.isSendingEmail=!1)},notifySendError:function(e,t){try{i.default.PAssert(1815,this._pendingSends[t],"Must have a pending send to have an error")}catch(e){i.default.reportError(e)}delete this._pendingSends[t],this.hasPendingSends()||(i.default.isSendingEmail=!1)},onShutdown:function(){clearTimeout(this._draftFlushTimer),this._draftFlushTimer=void 0,this._flushPendingDraftUpdates(),this._updateIsSavingDrafts()},_getLinkedResources:function(e){var t=[];return e.forEachResource(function(e){"attachment"===e.disposition&&e.link&&t.push(e)}),t},_createDraftBody:function(e,t){var a;if(t){var i=this._getLinkedResources(t);if(i.length>0){for(var r="<br/><br/>",n=0;n<i.length;++n)r+=this._getLinkedResourceString(i[n]);a=e+'<var id="moodoAttach" moodoAttach="true">'+r+"</var>"}else a=e}else a=e;return a},updateDraft:function(e,t,a,r,n,s,o,l){try{i.default.PAssert(1816,i.default.isBoolean(s),"Must supply a valid bool for updateRemoteDraft")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1817,i.default.isBoolean(o),"Must supply a valid bool for forceFlush")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1818,i.default.isFunction(l),"Must supply a valid bool for cb")}catch(e){i.default.reportError(e)}var d=this._findDraft(e,t,a);if(d){if(d.to=r.to,d.from=r.from||d.from,d.cc=r.cc,d.bcc=r.bcc,d.subject=r.subject,d.decoded=this._createDraftBody(r.body||r.decoded,d.resources),d.snippet=n?i.default.escape(n.substring(0,30)):"",r.hasOwnProperty("resources")){try{i.default.PAssert(1819,d.resources instanceof y.a,"Resources must always be a valid resource lib")}catch(e){i.default.reportError(e)}d.resources=r.resources}this._updateAttachmentFromMessages(e,ChangeType.Local),e.notifyDataMutated(["messages"],ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(this.getCacheData(e.id))),!this._creatingDrafts[d.id]&&s?i.default.isTempId(d.id)?this._createRemoteDraft(e,d.id,function(e,t){e||i.default.toasts.pushMessage(MessageID.EmailUpdateFail),l(e,t)}):(this._notifyPendingDraftUpdate(e,d.id,d.draftID,o),l(!0)):(s&&this._notifyPendingDraftUpdate(e,d.id,d.draftID,o),l(!0)),this._updateIsSavingDrafts()}else{try{i.default.PAssert(1820,!1,"Unable to update draft as expected from compose window")}catch(e){i.default.reportError(e)}l(!1)}return{threadID:e.id,draftID:d.draftID,messageID:d.id}},_updateRemoteDraft:function(e,t,a,r,n){try{i.default.PAssert(1821,t&&a,"Must specify both a valid messageID and draftID"+t+"."+a)}catch(e){i.default.reportError(e)}var s=this._findDraft(e,t,a);try{i.default.PAssert(1822,s&&s.labelIds.indexOf(x.DRAFT)>=0,"Must be updating a valid draft"+!!s)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1823,!this._creatingDrafts[s.id],"Should not send a remote update while the original draft is being created")}catch(e){i.default.reportError(e)}this._activeDraftUpdates++,this._getRemoteDraftID(e.getField("accountID"),e.id,s.id,function(t){if(t)this._createRFC822Message(e.getData(),s,r,function(a){var i=l.a.fns("gmail").users.drafts.update.packedFn,r={userId:e.getField("accountID"),id:t,resource:{message:{raw:a,threadId:e.id}}},o=function(t){this._updateDraftID(e,s.id,t),this._activeDraftUpdates--,n(t)}.bind(this),d=function(t){n(void 0,t),this._activeDraftUpdates--,this._notifyFailedRequest(e.getField("accountID"),t)}.bind(this);this._queueRemoteRequestMulti(e.getField("accountID"),i,r,o,d,void 0,_.DraftUpdate)}.bind(this));else{try{i.default.PAssert(1824,!1,"Must always be able to get a valid draft ID when updating")}catch(e){i.default.reportError(e)}n(!1)}}.bind(this))},sendDraft:function(e,t,a,n,s){try{i.default.PAssert(1825,!e.getField("pendingSend"),"Should not try to re-send a message after it has already been sent")}catch(e){i.default.reportError(e)}var o=!0,l=this._findDraft(e,t,a),d=function(t,a){t?(e.updateField("pendingSend",!1),this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(l,!1),this.notifySent(e,l.id)):(i.default.isHTTPStatusCode(a,r.a.HTTPStatusCode.Network)||e.updateField("pendingSend",!1),this.notifySendError(e,l.id)),s(t,a)}.bind(this),c=this._verifyEmailRecipients(e,l.id,l.draftID);if(c||(c=this._verifyEmailAttachments(e,l.id,l.draftID)),c){o=!1;var u=i.default.toasts.pushMessage({text:c.message,action:MessageAction.Okay});c.handleMessageFn&&c.handleMessageFn(u),this.notifyPendingSend(e,l.id),d(!1)}else if(!n){e.updateField("pendingSend",!0),this.notifyPendingSend(e,l.id);var h=!1;this.onEmailReadyToSend(l,function(){try{i.default.PAssert(1826,!h,"Should not send an email twice")}catch(e){i.default.reportError(e)}h||(h=!0,e.isLocalOnlyAttachment()||i.default.isTempId(l.id)?this._sendEmail(e,l.id,l.draftID,d):this._sendRemoteDraft(e,l.id,d))}.bind(this))}return o},onEmailReadyToSend:function(e,t){var a=!0;e.resources.forEachResource(function(r){if(r.uploader&&!r.uploader.isDone())if(a=!1,r.uploader.hasError())try{i.default.PAssert(1827,!1,"Attachment has error when sending.")}catch(e){i.default.reportError(e)}else r.uploader.notifyOnComplete(this.onEmailReadyToSend.bind(this,e,t))}.bind(this)),a&&setTimeout(t,0)},_sendRemoteDraft:function(e,t,a){this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t),this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(r){if(r)this._updateRemoteDraft(e,t,r,!0,function(t){if(t&&t.message){var n=l.a.fns("gmail").users.drafts.send.packedFn,s={userId:e.getField("accountID"),resource:{id:r}},o=function(i){this._updateLocalDraftFromSend(e,t.message.id,i,a)}.bind(this),d=function(t){this._notifySendFailed(),a(!1,t),this._notifyFailedRequest(e.getField("accountID"),t)}.bind(this);this._queueRemoteRequestMulti(e.getField("accountID"),n,s,o,d,void 0,_.DraftSend)}else i.default.toasts.pushMessage(MessageID.EmailUpdateFail),a(!1)}.bind(this));else{try{i.default.PAssert(1828,!1,"Must always be able to get a valid draft ID when sending")}catch(e){i.default.reportError(e)}i.default.toasts.pushMessage(MessageID.EmailUpdateFail),a(!1)}}.bind(this))},_updateLocalDraftFromSend:function(e,t,a,r){try{i.default.PAssert(1829,a,"Must have a valid draft result")}catch(e){i.default.reportError(e)}var n=this._getMessageFromAttachment(e,t);try{i.default.PAssert(1830,n,"Must always be able to find the sent message")}catch(e){i.default.reportError(e)}n&&(this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(n,!1),this._updateDraftFromSend(e,t,a)),i.default.isDemoMode()||this._requestRemoteMessageData(e,a.id,function(e){try{i.default.PAssert(1831,e,"Should always be able to update message data after send")}catch(e){i.default.reportError(e)}}),r(!0)},runDiscardDraft:function(e){var t=this._getDraftFromAttachment(e);this.discardDraft(e,t.id,t.draftID,function(e){try{i.default.PAssert(1832,e,"Must be able to discard message draft")}catch(e){i.default.reportError(e)}})},discardDraft:function(e,t,a,r){var n=e.getData(),s=this._findDraft(e,t,a),o=n.messages.indexOf(s);i.default.isTempId(t)?r(!0):this._deleteRemoteDraft(e,t,r);s=n.messages[o];n.messages.splice(o,1),this._removeRemoteResources(s),this._updateAttachmentFromMessages(e,ChangeType.Local),this._clearPendingDraftUpdate(e,t),e.notifyDataMutated(["messages"],ChangeType.Local),this.cacheThreadData(n.id,this.serializeExternalData(n)),this.sendEvent("DiscardDraft")},_removeRemoteResources:function(e){e&&e.resources.forEachResource(function(e){e.uploader&&!e.uploader.isDone()&&e.uploader.cancel()})},_deleteRemoteDraft:function(e,t,a){try{i.default.PAssert(1833,!i.default.isTempId(t),"Should not try to remotely delete a local message")}catch(e){i.default.reportError(e)}this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(t){if(t){var n=l.a.fns("gmail").users.drafts.delete.packedFn,s={userId:e.getField("accountID"),id:t},o=function(t){i.default.isHTTPStatusCode(t,r.a.HTTPStatusCode.NotFound)?a(!0):a(!1,t),this._notifyFailedRequest(e.getField("accountID"),t)}.bind(this);this._queueRemoteRequestMulti(e.getField("accountID"),n,s,function(e){a(!0)},o,void 0,_.DraftDelete)}else{try{i.default.PAssert(1834,!1,"Must always be able to get a valid draft ID when deleting")}catch(e){i.default.reportError(e)}i.default.toasts.pushMessage(MessageID.EmailUpdateFail),a(!1)}}.bind(this))},_getRemoteDraftIDRaw:function(e,t,a,i){var r=l.a.fns("gmail").users.drafts.list.packedFn,n={userId:e,q:"rfc822msgid:"+t};this._queuePagedRemoteRequestMulti(e,r,n,a,i,void 0,_.DraftList,{getAllPages:!0,resultsField:"drafts"})},_getRemoteDraftID:function(e,t,a,n){try{i.default.PAssert(1835,i.default.isString(e),"Must provide a valid accountID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1836,i.default.isString(t)&&!i.default.isTempId(t),"Should not try to remotely get the draft ID of a local thread: ",t)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1837,i.default.isString(a)&&!i.default.isTempId(a),"Should not try to remotely get the draft ID of a local draft: ",a)}catch(e){i.default.reportError(e)}var s=this.getAttachment(t);try{i.default.PAssert(1838,s,"Must be able to find a valid attachment for the requested thread")}catch(e){i.default.reportError(e)}if(!s)return setTimeout(n,0,void 0,!1);var o=this._getMessageFromAttachment(s,a);try{i.default.PAssert(1839,o,"Must be able to find a valid message for the requested draft")}catch(e){i.default.reportError(e)}if(!o)return setTimeout(n,0,void 0,!1);if(o.draftID)setTimeout(n,0,o.draftID,!1);else{try{i.default.PAssert(1840,o.messageID&&!i.default.isTempId(o.messageID),"Must have a valid messageID for the draft being queried")}catch(e){i.default.reportError(e)}if(!o.messageID||i.default.isTempId(o.messageID))return setTimeout(n,0,void 0,!1);var l=function(l){try{i.default.PAssert(1841,l&&l.length<=1,"Must find only a single draft ID for a given message: ",l.length,o.messageID)}catch(e){i.default.reportError(e)}if(l){for(var d=0;d<l.length;++d){var c=l[d];if(1===l.length||c.message.threadId===t){try{i.default.PAssert(1842,!o.draftID||o.draftID===c.id,"Draft ID must either match or not be known yet")}catch(e){i.default.reportError(e)}o.draftID=c.id}}try{i.default.PAssert(1843,0===l.length||o.draftID,"Draft returned but IDs dont match: ",l[0]?l[0].message.threadId:"NO RESULT",t,l[0]?l[0].message.id:"NO RESULT",a)}catch(e){i.default.reportError(e)}}return o.draftID?n(o.draftID,!0):o.contentType&&o.mimeType&&o.decoded?void this._createRemoteDraft(s,o.id,function(a,s){return a?n(o.draftID,!0):(i.default.isHTTPStatusCode(s,r.a.HTTPStatusCode.NotFound)&&this._deleteCachedThread(e,t),n(void 0,!1))}.bind(this)):(this._notifyLocalDraftDelete(e,t,a),n(void 0,!1))}.bind(this),d=function(t){return this._notifyFailedRequest(e,t),n(void 0,!1)}.bind(this);this._getRemoteDraftIDRaw(e,o.messageID,l,d)}},_attachmentHasMessage:function(e,t){return e.getField("messages").indexOfWithProperty("id",t)>=0},_getMessageFromAttachment:function(e,t){var a=e.getField("messages"),r=a.indexOfWithProperty("id",t);try{i.default.PAssert(1847,r>=0,"Must have a vald draft")}catch(e){i.default.reportError(e)}return a[r]},_getDraftFromAttachment:function(e,t){for(var a,i=e.getField("messages"),r=0;r<i.length;++r)if(i[r].labelIds.indexOf(x.DRAFT)>=0){t&&t!==i[r].draftID||(a=i[r]);break}return a},_findDraft:function(e,t,a){var r,n=e.getField("messages"),s=n.indexOfWithProperty("id",t);if(s>=0)r=n[s];else if(a){var o=n.indexOfWithProperty("draftID",a);o>=0&&(r=n[o])}try{i.default.PAssert(1848,r,"Must be able to find a valid draft for given messageID/draftID")}catch(e){i.default.reportError(e)}return r},isAttachmentDraftOnly:function(e){return this.attachmentHasLabel(e,L.DRAFT)&&1===e.getField("messages").length},archiveAttachment:function(e){try{i.default.PAssert(1849,!this.attachmentIsArchived(e),"Should not archive a thread that is already archived")}catch(e){i.default.reportError(e)}return this.sendEvent("ArchiveMail"),this.removeLabelFromAttachment(e,L.INBOX)},unarchiveAttachment:function(e){try{i.default.PAssert(1850,this.attachmentIsArchived(e),"Thread must be unarchived to archive it")}catch(e){i.default.reportError(e)}return this.sendEvent("UnarchiveMail"),this.addLabelToAttachment(e,L.INBOX)},trashAttachment:function(e){return this.sendEvent("TrashMail"),this.trashMail(e.getField("accountID"),e.id,void 0,function(e){try{i.default.PAssert(1851,e,"Must have successfully trashed remote thread")}catch(e){i.default.reportError(e)}})},untrashAttachment:function(e){return this.sendEvent("UntrashMail"),this.untrashMail(e.getField("accountID"),e.id,void 0,function(e){try{i.default.PAssert(1852,e,"Must have successfully untrashed remote thread")}catch(e){i.default.reportError(e)}})},markAttachmentRead:function(e){return this.sendEvent("MarkMailRead"),this.removeLabelFromAttachment(e,L.UNREAD)},markAttachmentUnread:function(e){return this.sendEvent("MarkMailUnread"),this.addLabelToAttachment(e,L.UNREAD)},snoozeAttachment:function(e,t){this.sendEvent("SnoozeThread");var a=this._getLabelByName(e.getField("accountID"),"Moo.do/Snoozed");if(a&&!a.isLocalOnly()){var r=Date.now()+t,n=new Date(r);this.addLabelToAttachment(e,"Moo.do/Snoozed"),this.attachmentHasLabel(e,L.INBOX)&&this.removeLabelFromAttachment(e,L.INBOX),this.attachmentHasLabel(e,L.UNREAD)&&this.removeLabelFromAttachment(e,L.UNREAD);var s={scheduleDate:n.toISOString(),gidLinked:f.a.getAccountGID(e.getField("accountID")),threadID:e.id,labelID:a.getLabelID()};this.scheduleDeferredTask(e.id,M.Snooze,n,s)}else i.default.toasts.pushMessage({text:"Please restart the app and try again. There was an error syncing your labels with Gmail.",action:MessageAction.Okay})},unsnoozeAttachment:function(e){this.sendEvent("UnsnoozeThread"),this.removeLabelFromAttachment(e,"Moo.do/Snoozed"),this.addLabelToAttachment(e,L.INBOX),this.addLabelToAttachment(e,L.UNREAD),this.cancelDeferredTask(e.id,M.Snooze)},_handleDeferredSnoozeTask:function(e){var t=e.getData();try{i.default.PAssert(1853,t.gidLinked,"Must have valid accountID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1854,t.threadID,"Must have a valid threadID")}catch(e){i.default.reportError(e)}log("Handling deferred snooze: ",e);var a=f.a.getAccountEmail(t.gidLinked),r=new Date(t.scheduleDate);this.setLastModifiedDate(a,t.threadID,r),e.isPersistedRemote()?(this.removeLabelsFromMessage(a,t.threadID,void 0,[t.labelID],ChangeType.Auto),this.addLabelsToMessage(a,t.threadID,void 0,[x.INBOX,x.UNREAD],ChangeType.Auto)):(this.removeLabel(a,t.threadID,void 0,"Moo.do/Snoozed"),this.addLabel(a,t.threadID,void 0,L.INBOX),this.addLabel(a,t.threadID,void 0,L.UNREAD))},scheduleSendMessage:function(e,t,a){this.sendEvent("ScheduleMail");var i=Date.now()+a,r=new Date(i);this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(t){if(t){this.addLabelFromAttachment(e,"Moo.do/ScheduledSend");var i={delay:a,scheduleDate:r.toISOString(),gidLinked:f.a.getAccountGID(e.getField("accountID")),threadID:e.id,draftID:t,labelID:this._getLabelByName(e.getField("accountID"),"Moo.do/ScheduledSend").getLabelID()};this.scheduleDeferredTask(t,M.SendMail,r,i)}}.bind(this))},cancelSendMessage:function(e,t){this.sendEvent("UnscheduleMail"),this.removeLabelFromAttachment(e,"Moo.do/ScheduledSend"),this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(e){e&&this.cancelDeferredTask(e,M.SendMail)}.bind(this))},_handleDeferredSendMailTask:function(e){var t=e.getData();try{i.default.PAssert(1855,t.gidLinked,"Must have valid gidLinked")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1856,t.threadID,"Must have a valid threadID")}catch(e){i.default.reportError(e)}log("Handling deferred send mail: ",t)},_ensureNoPriority:function(e){var t=VMLIFlag.None;return this.attachmentHasLabel(e,R.PRI0)&&(this.removeLabelFromAttachment(e,R.PRI0),t=VMLIFlag.P0),this.attachmentHasLabel(e,R.PRI1)&&(this.removeLabelFromAttachment(e,R.PRI1),t=VMLIFlag.P1),this.attachmentHasLabel(e,R.PRI2)&&(this.removeLabelFromAttachment(e,R.PRI2),t=VMLIFlag.P2),t},getAttachmentPriority:function(e){return this._attachmentHasPriorityLabel(e,VMLIFlag.P0)&&VMLIFlag.P0||this._attachmentHasPriorityLabel(e,VMLIFlag.P1)&&VMLIFlag.P1||this._attachmentHasPriorityLabel(e,VMLIFlag.P2)&&VMLIFlag.P2||VMLIFlag.None},setAttachmentPriority:function(e,t){this.sendEvent("SetMailPriority");var a=this._ensureNoPriority(e);switch(t){case VMLIFlag.None:break;case VMLIFlag.P0:this.addLabelToAttachment(e,R.PRI0);break;case VMLIFlag.P1:this.addLabelToAttachment(e,R.PRI1);break;case VMLIFlag.P2:this.addLabelToAttachment(e,R.PRI2);break;default:try{i.default.PAssert(1857,!1,"Invalid priority for email attachment")}catch(e){i.default.reportError(e)}}return a},markAttachmentStarred:function(e){return this.sendEvent("StarMail"),this.addLabelToAttachment(e,L.STARRED)},markAttachmentUnstarred:function(e){return this.sendEvent("UnstarMail"),this.removeLabelFromAttachment(e,L.STARRED)},attachmentHasLabelByID:function(e,t){return this.hasLabelByID(e.getField("accountID"),e.id,void 0,t)},attachmentHasLabel:function(e,t){return this.hasLabel(e.getField("accountID"),e.id,void 0,t)},attachmentHasFullLabel:function(e,t){return this.hasFullLabel(e.getField("accountID"),e.id,t)},attachmentIsArchived:function(e){return this._threadIsArchived(e.getData())},addLabelToAttachment:function(e,t){return this.addLabel(e.getField("accountID"),e.id,void 0,t)},removeLabelFromAttachment:function(e,t){return this.removeLabel(e.getField("accountID"),e.id,void 0,t)},trashMail:function(e,t,a,r){var n=this.getAttachment(t);if(this.isAttachmentDraftOnly(n)){var s=n.getField("messages")[0];this.discardDraft(n,s.id,s.draftID,r)}else this.removeLabelsFromMessage(e,t,a,[x.INBOX],ChangeType.Local),this.addLabelsToMessage(e,t,a,[x.TRASH],ChangeType.Local),i.default.isTempId(t)?r(!0):this._trashRemoteMail(e,t,a,r)},untrashMail:function(e,t,a,r){this.removeLabelsFromMessage(e,t,a,[x.TRASH],ChangeType.Local),i.default.isTempId(t)?(this.addLabelsToMessage(e,t,a,[x.INBOX],ChangeType.Local),r(!0)):(this.addLabel(e,t,a,L.INBOX),this._untrashRemoteMail(e,t,a,r))},moveItem:function(e,t,a){return a.insertItem(t,0),[t,a]},unmoveItem:function(e,t,a){return a.removeChild(t,ChangeType.Local),[t,a]},hasLabelByID:function(e,t,a,r){try{i.default.PAssert(1858,!a,"We don't support individual queries on messages, only threads")}catch(e){i.default.reportError(e)}return this.getAttachment(t).getField("labelIds").indexOf(r)>=0},hasLabel:function(e,t,a,r){try{i.default.PAssert(1859,!a,"We don't support individual queries on messages, only threads")}catch(e){i.default.reportError(e)}var n=!1;if(!a){var s=this._getLabelByName(e,r,!0);s&&(n=this.hasLabelByID(e,t,a,s.getLabelID()))}return n},hasFullLabel:function(e,t,a){var i=!1,r=this.getCacheData(t),n=this._getLabelByName(e,a,!0);if(n&&r){var s=r.messages;i=!0;for(var o=0;o<s.length;++o)if(s[o].labelIds.indexOf(n.getLabelID())<0){i=!1;break}}return i},hasLabelLike:function(e,t,a){var i=!1,r=this.getAttachment(t);if(r){var n=r.getField("labelIds"),s=this._getAccountLib(e,this._labelsByID);if(s)for(var o=0;o<n.length;++o){var l=s[n[o]];l&&l.isMatched(a)&&(i=!0)}}return i},addLabel:function(e,t,a,r){try{i.default.PAssert(1860,!a,"We currently do not support setting labels on single messages")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1861,!this.hasLabel(e,t,a,r),"Should not add the same label to a thread/message twice")}catch(e){i.default.reportError(e)}var n=this._getLabelByName(e,r,!0);if(n)n.isLocalOnly()?this._createRemoteLabel(e,r,function(a){if(a){try{i.default.PAssert(1863,a,"Should have successfully created the remote label")}catch(e){i.default.reportError(e)}this._changeLabelID(e,n.getLabelID(),a.id),this._modifyRemoteThreadLabels(e,t,[a.id],void 0)}}.bind(this)):this._modifyRemoteThreadLabels(e,t,[n.getLabelID()],void 0);else{var s=i.default.generateTempId();n=this._ensureLabel(e,s,r,void 0,void 0,ChangeType.Local),this._ensureVMLIsForLabel(e,n),this._writeLabelsToCache(function(a){a&&this._createRemoteLabel(e,r,function(a){try{i.default.PAssert(1862,a,"Should have successfully created the remote label")}catch(e){i.default.reportError(e)}a&&(this._changeLabelID(e,s,a.id),this._modifyRemoteThreadLabels(e,t,[a.id],void 0))}.bind(this))}.bind(this))}return this.addLabelsToMessage(e,t,a,[n.getLabelID()],ChangeType.Local),r},removeLabel:function(e,t,a,r){try{i.default.PAssert(1864,!a,"We currently do not support setting labels on single messages")}catch(e){i.default.reportError(e)}var n=this._getLabelByName(e,r);try{i.default.PAssert(1865,n,"Must have valid label for gmail in order to remove")}catch(e){i.default.reportError(e)}return n&&(n.isLocalOnly()||this._modifyRemoteThreadLabels(e,t,void 0,[n.getLabelID()]),this.removeLabelsFromMessage(e,t,a,[n.getLabelID()],ChangeType.Local)),r},_threadIsArchived:function(e){if(e){var t=e.labelIds.indexOf(x.INBOX)>=0,a=this.hasFullLabel(e.accountID,e.id,L.TRASH),r=e.labelIds.indexOf(x.SPAM)>=0,n=this.hasFullLabel(e.accountID,e.id,L.DRAFT);return!(i.default.isTempId(e.id)||t||a||r||n)}return!1},_trashRemoteMail:function(e,t,a,r){try{i.default.PAssert(1866,!i.default.isTempId(t),"Should not try to trash local only threads")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1867,!a||!i.default.isTempId(a),"Should not try to trash local only messages")}catch(e){i.default.reportError(e)}var n,s;a?(n=l.a.fns("gmail").users.messages.trash.packedFn,s={userId:e,id:a}):(n=l.a.fns("gmail").users.threads.trash.packedFn,s={userId:e,id:t});var o=function(t){r(!1,t),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,n,s,function(e){r(!0)},o,void 0,_.Trash)},_untrashRemoteMail:function(e,t,a,r){try{i.default.PAssert(1868,!i.default.isTempId(t),"Should not try to untrash local only threads")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1869,!a||!i.default.isTempId(a),"Should not try to untrash local only messages")}catch(e){i.default.reportError(e)}var n,s;a?(n=l.a.fns("gmail").users.messages.untrash.packedFn,s={userId:e,id:a}):(n=l.a.fns("gmail").users.threads.untrash.packedFn,s={userId:e,id:t});var o=function(t){r(!1,t),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,n,s,function(e){r(!0)},o,void 0,_.Trash)},_createRemoteLabel:function(e,t,a){var n=l.a.fns("gmail").users.labels.create.packedFn,s={userId:e,resource:{name:t,labelListVisibility:"labelHide",messageListVisibility:"hide"}},o=function(t){i.default.isHTTPStatusCode(t,r.a.HTTPStatusCode.Conflict)?a&&a(void 0,t):(a&&a(void 0,t),this._notifyFailedRequest(e,t))}.bind(this);this._queueRemoteRequestMulti(e,n,s,function(e){a&&a(e)},o,void 0,_.CreateLabel)},_modifyRemoteThreadLabels:function(e,t,a,i,r){var n=l.a.fns("gmail").users.threads.modify.packedFn,s={userId:e,id:t,resource:{addLabelIds:a,removeLabelIds:i}},o=function(t){r&&r(void 0,t),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,n,s,function(e){r&&r(e)},o,void 0,_.ModifyLabels)},_ensureRemoteLabel:function(e,t,a,n){this._getLabelByName(e,t,!0)?n&&n(!0):(this._ensureLabel(e,i.default.generateTempId(),t,void 0,void 0,a),this._createRemoteLabel(e,t,function(e,t){try{i.default.PAssert(1870,e||i.default.isHTTPStatusCode(t,r.a.HTTPStatusCode.Conflict),"Should have successful root label creation")}catch(e){i.default.reportError(e)}n&&n(!!e)}))},_createInMemoryLabel:function(e,t,a,i,r,n){var s=new g.a(e,t,a,this._clampSyncTime(i),r,n);n[t]=s,this._ensureAccountLib(e,this._labelsByName)[a]=s},_updateLabelName:function(e,t){var a=e.getAccountID(),r=this._getAccountLib(a,this._labelsByName);try{i.default.PAssert(1871,r,"Must have valid label name bucket")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1872,r[e.getRawName()],"Must have valid label in bucket")}catch(e){i.default.reportError(e)}e.updateLabelName(t),delete r[e.getRawName()],r[t]=e},_ensureLabel:function(e,t,a,r,n,s){var o=this._ensureAccountLib(e,this._labelsByID);if(o[t])!i.default.isRemoteChange(s)&&o[t].hasName()||o[t].isSystemLabel()||this._updateLabelName(o[t],a);else{var l=this._getLabelByName(e,a,!0);if(l)l.isLocalOnly()&&!i.default.isTempId(t)?this._changeLabelID(e,l.getLabelID(),t):l.isLocalOnly()||(o[t]=l);else{try{i.default.PAssert(1874,a||!i.default.isTempId(t),"All local labels must have a valid name")}catch(e){i.default.reportError(e)}this._createInMemoryLabel(e,t,a,r,n,o)}}return o[t]},_clampSyncTime:function(e){return e&&e.isBefore(this._getMetadataSyncTime())?this._getMetadataSyncTime():e},_ensureLabelVMLIsForAccount:function(e){var t=this._getAccountLib(e,this._labelsByID);for(var a in t)this._ensureVMLIsForLabel(e,t[a])},_changeLabelID:function(e,t,a){var r=this._getLabelByID(e,t,!0);i.default.vmMain.beginUpdateItems(),r.updateLabelID(a),this._getAccountLib(e,this._labelsByID)[a]=r,this._ensureVMLIsForLabel(e,r),i.default.vmMain.commitUpdateItems(),this.forEachAttachment(function(e){var i=e.getField("labelIds");if(i.remove(t)>=0){for(var r=e.getField("messages"),n=0;n<r.length;++n)r[n].labelIds.remove(t)>=0&&r[n].labelIds.push(a);i.push(a),e.updateField("labelIds",i)}});var n=n||this.getDefaultItemStore(),s="L~"+e+"~"+t;n.hasItem(s)&&n.destroyItem(s)},labelExists:function(e,t){var a=this._getAccountLib(e,this._labelsByID);return a&&a[t]},_getLabelByID:function(e,t){try{i.default.PAssert(1875,e,"Must supply a valid accountID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1876,t,"Must supply a valid labelID")}catch(e){i.default.reportError(e)}var a=this._ensureAccountLib(e,this._labelsByID);if(!a[t]){var r=L[t];this._createInMemoryLabel(e,t,r,void 0,void 0,a)}return a[t]},_getLabelByName:function(e,t,a){try{i.default.PAssert(1877,this.hasSyncAccount(e),"Must provide a valid accountID with a matching sync account: "+e)}catch(e){i.default.reportError(e)}var r,n=this._getAccountLib(e,this._labelsByName);try{i.default.PAssert(1878,a||n,"Unable to find labelsByName for given account: "+e)}catch(e){i.default.reportError(e)}return n&&(r=n[t]),r},_getPriorityLabel:function(e,t){var a=this._ensureAccountLib(e,this._priorityLabels);if(!a[t]){var r;switch(t){case VMLIFlag.P0:r=R.PRI0;break;case VMLIFlag.P1:r=R.PRI1;break;case VMLIFlag.P2:r=R.PRI2;break;default:try{i.default.PAssert(1879,!1,"Invalid priority for email attachment")}catch(e){i.default.reportError(e)}}a[t]=this._getLabelByName(e,r)}return a[t]},_getAccountLib:function(e,t){try{i.default.PAssert(1880,e,"Must provide valid accountID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1881,t,"Must provide valid lib object")}catch(e){i.default.reportError(e)}var a;if(e)if(t[e])a=t[e];else for(var r in t)if(r.toUpperCase()===e.toUpperCase())try{i.default.PAssert(1882,!1,"Mismatch case request found for accountIDs: "+e,r)}catch(e){i.default.reportError(e)}return a},_ensureAccountLib:function(e,t){try{i.default.PAssert(1883,e,"Must provide valid accountID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1884,t,"Must provide valid lib object")}catch(e){i.default.reportError(e)}var a;if(e)if(t[e])a=t[e];else{for(var r in t)try{i.default.PAssert(1885,!e||!r||r.toUpperCase()!==e.toUpperCase(),"Dupe accountID found with non-matching case: "+e,r)}catch(e){i.default.reportError(e)}a=t[e]={}}return a},_deleteAccountLib:function(e,t){try{i.default.PAssert(1886,e,"Must provide valid accountID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1887,t,"Must provide valid lib object")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1888,t[e],"Trying to delete an account lib that doesnt exist: ",e)}catch(e){i.default.reportError(e)}delete t[e]},_attachmentHasPriorityLabel:function(e,t){var a=this._getPriorityLabel(e.getField("accountID"),t);return!!a&&e.getField("labelIds").indexOf(a.getLabelID())>=0},getLabels:function(e,t,a){var i=[],r=t.toLowerCase(),n=0,s=this._labelsByID[e];for(var o in s){var l=s[o];if(l.matchesText(r)&&this.isDisplayTag(l)&&i.indexOf(l)<0&&(i.push(l),n++),a&&n>=a)break}return i},_writeLabelsToCache:function(e){var t={};for(var a in this._labelsByID){t[a]={};var i=this._labelsByID[a];for(var r in i)t[a][r]=i[r].getSaveData()}this._threadCache.setMetadata(w,t,e)},_writeSendAsToCache:function(e){var t={};this._iterateSendAs(function(e,a){t[e]||(t[e]=[]),t[e].push(a)}),this._threadCache.setMetadata(k,t,e)},runLabelSync:function(e){this._threadCache.onCacheMetadataReady(function(){for(var t=function(t,a){i.default.vmMain.beginUpdateItems();var o={};if(a)for(var l=0;l<a.length;++l){var d,c=a[l];o[c.id]=!0,d="system"===c.type&&L[c.id]?L[c.id]:c.name,this._ensureLabel(t,c.id,d,void 0,c,ChangeType.Remote)}this._ensureLabelVMLIsForAccount(t),this._ensureRemoteLabel(t,"Moo.do",ChangeType.Local),this._ensureRemoteLabel(t,R.PRI0,ChangeType.Local),this._ensureRemoteLabel(t,R.PRI1,ChangeType.Local),this._ensureRemoteLabel(t,R.PRI2,ChangeType.Local),this._ensureRemoteLabel(t,"Moo.do/Snoozed",ChangeType.Local),this._ensureRemoteLabel(t,"Moo.do/Handled",ChangeType.Local),this._ensureRemoteLabel(t,"Moo.do/Scheduled",ChangeType.Local);var u=this._getAccountLib(t,this._labelsByID);if(u)for(var h in u){var f=u[h];if(f.isLocalOnly()){try{i.default.PAssert(1889,f.hasName(),"Label must have a valid name to be created on remote")}catch(e){i.default.reportError(e)}this._createRemoteLabel(t,f.getName(),function(e,a){a&&this._changeLabelID(t,e,a.id)}.bind(this,h))}else 0!==s||o[h]||f.isSystemOrSpecialLabel()||i.default.isDemoMode()||f.delete()}i.default.vmMain.commitUpdateItems(),this._writeLabelsToCache(),s+n===r&&e&&e()}.bind(this),a=this.getSyncAccounts(),r=a.length,n=0,s=0,o=function(e,a){n++,t(e,a.labels)},d=function(e,a){s++,t(e),this._notifyFailedRequest(e,a)}.bind(this),c=0;c<a.length;++c){var u=l.a.fns("gmail").users.labels.list.packedFn,h={userId:a[c],timeoutMS:0};this._queueRemoteRequestMulti(a[c],u,h,o.bind(this,a[c]),d.bind(this,a[c]),void 0,_.Labels)}}.bind(this))},getDescriptorForItem:function(e){try{i.default.PAssert(1891,e,"Must have a valid item to get a description for")}catch(e){i.default.reportError(e)}var t=this._getAccountIDFromItem(e),a=this._getLabelIDFromItem(e),r={accountID:t,labelID:a,threadID:this._getThreadIDFromItem(e)};if(t&&a){var n=this._getLabelByID(t,a);r.labelName=n.getName()}return r},handleItemChange:function(e,t){this._threadCache.onCacheReady(function(){this._threadCache.onCacheMetadataReady(function(){var a=this.getDescriptorForItem(e);if(a.labelID){try{i.default.PAssert(1892,a.accountID,"Must specify a valid accountID")}catch(e){i.default.reportError(e)}this._getThreadsForLabel(a.accountID,this._getLabelByID(a.accountID,a.labelID),e,function(e){try{i.default.PAssert(1893,e,"Expected success when querying for remote threads")}catch(e){i.default.reportError(e)}t&&t()})}}.bind(this))}.bind(this))},handleViewModeChange:function(e,t){t===r.a.GmailViewMode.Priority&&this._threadCache.onCacheReady(function(){var t=this._getAccountIDFromItem(e);try{i.default.PAssert(1894,t,"Missing Account ID: ",e.id)}catch(e){i.default.reportError(e)}var a=this._getLabelByName(t,R.PRI0);a&&this._getThreadsForLabel(t,a,void 0,function(e){try{i.default.PAssert(1895,e,"Expected success when querying for remote PRI0 threads")}catch(e){i.default.reportError(e)}});var r=this._getLabelByName(t,R.PRI1);r&&this._getThreadsForLabel(t,r,void 0,function(e){try{i.default.PAssert(1896,e,"Expected success when querying for remote PRI1 threads")}catch(e){i.default.reportError(e)}});var n=this._getLabelByName(t,R.PRI2);n&&this._getThreadsForLabel(t,n,void 0,function(e){try{i.default.PAssert(1897,e,"Expected success when querying for remote PRI2 threads")}catch(e){i.default.reportError(e)}})}.bind(this))},_getThreadsForLabel:function(e,t,a,r){try{i.default.PAssert(1898,t,"Must provide a valid label to get thrads for")}catch(e){i.default.reportError(e)}var n="-in:chats -in:spam label:"+t.getName(),s=t.getOldestSync();i.default.isDateValid(s)&&(n+=" before:"+Math.floor(s.getTime()/1e3));var o=new Date,l=function(t){if(t){var a=this._addRemoteEntry(e,t);a.internalDate.isBefore(o)&&(o=a.internalDate),this.cacheThreadData(a.id,this.serializeExternalData(a))}}.bind(this),d=function(e){t.setOldestSync(o),this._writeLabelsToCache(),r(e)}.bind(this),c=new P.a(l,d);this._requestRemoteThreads(e,_.ThreadLabel,a,n,oe,void 0,c.getEntryCB(),c.getDoneCB())},createOutlinePaneItem:function(e,t){for(var a=t.getItemStore(),r=e.getRawText(),n=e.getAttachmentByPlugin(this.id),s=this.getDisplayTags(n,void 0,!0),o=0;o<s.length;++o)r+=" #"+s[o];return a.createItem(i.default.generateTempId(),r,t.id,void 0,ChangeType.Local)},refreshCurrentView:function(){this._forceThreadSync()},goOnline:function(){this._forceThreadSync(this._notifyPendingDraftUpdate.bind(this))},loadInitialData:function(){this._super.loadInitialData.call(this),i.default.isDemoMode()&&this._forceThreadSync()},_forceThreadSync:function(e){this.hasRecurringTask("GmailThreadSync")&&this.getRecurringTask("GmailThreadSync").forceUpdate(e)},_forceLabelSync:function(e){this.hasRecurringTask("GmailLabelSync")&&this.getRecurringTask("GmailLabelSync").forceUpdate(e)},_syncOfflineChanges:function(e,t){try{i.default.PAssert(1899,!1,"Currently we do not perform a sync offline step for Gmail changes")}catch(e){i.default.reportError(e)}if(!this._syncingOfflineChanges){this._syncingOfflineChanges=!0;var a=0,n=0,s=0,o=[];(function(e,i){i===r.a.SyncResult.Success?n++:(s++,o.push({id:e,result:i})),a===n+s&&(this._syncingOfflineChanges=!1,t(n,s,o))}).bind(this);this._threadCache.getFilterEntries(function(e){return!!e.modifiedOffline},function(e){a=e.length;for(var t=0;t<e.length;++t){var r=this.createEntryFromLocal(e[t].id,e[t]);i.default.isTempId(r.id)}}.bind(this))}},_cleanupLocalCaches:function(e){try{i.default.PAssert(1900,i.default.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(e){i.default.reportError(e)}var t=0,a=0,r=this._getFullSyncTime(),n=this._getUnreadSyncTime(),s=this._getMetadataSyncTime();this._threadCache.getFilterEntries(function(e){return e&&e.date&&e.date.isBefore(r)},function(i){if(i)for(var r=0;r<i.length;++r){var o=i[r],l=!0;if(!o.date.isBefore(n))for(var d=0;l&&d<o.messages.length;++d){var c=o.messages[d];if(this.isPriorityData(c)){l=!1;break}}if(l){o.date.isBefore(s)&&(this._threadCache.removeEntry(o.id),t++);for(d=0;d<o.messages.length;++d){c=o.messages[d];this._rawCache.removeEntry(c.id),a++}}}log("Gmail Cache Pruned: ",t,a),e(!1)}.bind(this))},_cleanupRawCache:function(e){try{i.default.PAssert(1901,i.default.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(e){i.default.reportError(e)}var t=0,a=this._getUnreadSyncTime();this._rawCache.getFilterEntries(function(e){return!e.internalDate||new Date(parseInt(e.internalDate)).isBefore(a)},function(a){if(a)for(var i=0;i<a.length;++i){var r=a[i];this._rawCache.removeEntry(r.id),t++}log("Raw Cache Pruned: ",t),e()}.bind(this))},getAccountSetting:function(e,t){var a,i=this._getAccountLib(e,this._accountSettings);return i&&(a=i[t]),a},setAccountSetting:function(e,t,a){var i,r=this._ensureAccountLib(e,this._accountSettings);return i=r[t],r[t]=a,i},runSettingsSync:function(){this._getSettingsSendAs(function(e){for(var t in e)this.setAccountSetting(t,"sendAs",e[t]);this._writeSendAsToCache(function(){})}.bind(this))},_getSyncDays:function(){var e=this.getSetting(this.Settings.SyncTime);i.default.billingManager.isTrialOver()&&(e=r.a.MaxGmailSyncTime.Free);var t=i.default.vmMain.pluginManager.getCacheSizeRatio();return t<1&&t>0&&(e=Math.round(e*t)),e},_getMetadataSyncDays:function(){var e=Math.max(this.getSetting(this.Settings.SyncTime),15),t=i.default.vmMain.pluginManager.getCacheSizeRatio();return t<.5&&(e=Math.max(Math.round(e*t),7)),e},_getUnreadSyncTime:function(){var e=this._getSyncDays();return(new Date).addDays(-1.5*e)},_getFullSyncTime:function(){var e=this._getSyncDays();return(new Date).addDays(-e)},_getMetadataSyncTime:function(){var e=this._getMetadataSyncDays();return(new Date).addDays(-e)},_getFullSyncTimeStr:function(){return this._getSyncDays()+"d"},_getMetadataSyncTimeStr:function(){return this._getMetadataSyncDays()+"d"},runThreadSync:function(e){var t,a=0,n=0,s=[],o=[],l=function(l,d,c){l?(a++,s.push(d)):(n++,!i.default.isHTTPStatusCode(c,r.a.HTTPStatusCode.Network)&&i.default.vmMain.isOnline()&&o.push(d)),n+a===t&&(o.length>0?i.default.toasts.pushMessage(MessageID.EmailSyncFail):i.default.toasts.clearMessage(MessageID.EmailSyncFail),s.length>0&&this._contentSyncTask.requestRun(),e&&e(0===o.length))}.bind(this),d=!1,c=this._getSyncDays();void 0!==this._lastSyncTime&&this._lastSyncTime<c&&(d=!0,log("Forcing full gmail sync")),this._lastSyncTime=c,this._threadCache.onCacheMetadataReady(function(){this._threadCache.getMetadata(T,function(e){var a=this.getSyncAccounts();t=a.length;for(var i=0;i<a.length;++i){var r;if(!d){var n=e?e[a[i]]:void 0;r=n?n.historyID:void 0}this.performThreadSync(a[i],r,l)}}.bind(this))}.bind(this))},performThreadSync:function(e,t,a){t?(Date.now()-this._lastCacheCleanup>i.default.hours(12)&&(this._lastCacheCleanup=Date.now(),this._cacheCleanup.notifyWorkAvailable()),this._performThreadSyncPartial(e,t,a)):this._performThreadSyncFull(e,a)},_performThreadSyncFull:function(e,t){var a,r="-in:chats -in:spam newer_than:"+this._getMetadataSyncTimeStr(),n=this.getDefaultItemStore().getRoot();n.clearPaginationToken();var s=function(t){if(t&&(!a&&t.historyId&&(a=t.historyId,this.setHistoryID(e,a)),this._shouldCacheThread(t))){var i=this._addRemoteEntry(e,t);this.cacheThreadData(i.id,this.serializeExternalData(i))}}.bind(this),o=new P.a(s,function(a){t(a,e)});this._requestRemoteThreads(e,_.FullSync,n,r,999,0,o.getEntryCB(),o.getDoneCB()),this._getThreadsForLabel(e,this._getLabelByID(e,x.UNREAD),void 0,function(e){try{i.default.PAssert(1902,e,"Expect to be able to get all unread messages")}catch(e){i.default.reportError(e)}})},_compactHistoryEntries:function(e){for(var t={messages:{},messagesAdded:{},messagesDeleted:{},labelsAdded:{},labelsRemoved:{}},a=0;a<e.length;++a){var r=e[a],n=0;if(r.messagesAdded){for(var s=0;s<r.messagesAdded.length;++s){var o=r.messagesAdded[s].message;(l=t.messagesAdded[o.threadId])||(l=t.messagesAdded[o.threadId]=[]),l.indexOf(o.id)<0&&l.push(o.id)}n+=r.messagesAdded.length}if(r.messagesDeleted){for(s=0;s<r.messagesDeleted.length;++s){o=r.messagesDeleted[s].message;(l=t.messagesDeleted[o.threadId])||(l=t.messagesDeleted[o.threadId]=[]),l.indexOf(o.id)<0&&l.push(o.id)}n+=r.messagesDeleted.length}if(r.labelsAdded){for(s=0;s<r.labelsAdded.length;++s){o=r.labelsAdded[s].message;(l=t.labelsAdded[o.threadId])||(l=t.labelsAdded[o.threadId]={}),l[o.id]||(l[o.id]=[]),l[o.id].pushOnlyUniques(r.labelsAdded[s].labelIds)}n+=r.labelsAdded.length}if(r.labelsRemoved){for(s=0;s<r.labelsRemoved.length;++s){o=r.labelsRemoved[s].message;(l=t.labelsRemoved[o.threadId])||(l=t.labelsRemoved[o.threadId]={}),l[o.id]||(l[o.id]=[]),l[o.id].pushOnlyUniques(r.labelsRemoved[s].labelIds)}n+=r.labelsRemoved.length}try{i.default.PAssert(1903,0===n||n===r.messages.length,"Must have handled all or none of the generic messages")}catch(e){i.default.reportError(e)}if(0===n)for(s=0;s<r.messages.length;++s){var l;o=r.messages[s];(l=t.messages[o.threadId])||(l=t.messages[o.threadId]=[]),l.indexOf(o.id)<0&&l.push(o.id)}}var d={messages:[],messagesAdded:[],messagesDeleted:[],labelsAdded:[],labelsRemoved:[]};for(var c in t.messages)d.messages.push({id:c,msgIDs:t.messages[c]});for(var c in t.messagesAdded)t.messages[c]||d.messagesAdded.push({id:c,msgIDs:t.messagesAdded[c]});for(var c in t.messagesDeleted)t.messages[c]||d.messagesDeleted.push({id:c,msgIDs:t.messagesDeleted[c]});for(var c in t.labelsAdded)if(!t.labelsAdded[c])for(var u in t.labelsAdded[c])d.labelsAdded.push({id:c,msgID:u,labelIDs:t.labelsAdded[c][u]});for(var c in t.labelsRemoved)if(!t.messages[c])for(var u in t.labelsRemoved[c])d.labelsRemoved.push({id:c,msgID:u,labelIDs:t.labelsRemoved[c][u]});return d},_performThreadSyncPartial:function(e,t,a){var n=l.a.fns("gmail").users.history.list.packedFn,s={userId:e,startHistoryId:t},o={getAllPages:!0,maxPageResults:999,resultsField:"history",timeoutMS:0},d=function(e,t){log("History Sync Request Failed: ",e,t)}.bind(this),c=function(t,r,n){var s;n&&(s=n.historyId,this.setHistoryID(e,s)),i.default.vmMain.beginUpdateItems();var o=this._compactHistoryEntries(t);this._handleCompactHistory(e,o,d);i.default.vmMain.commitUpdateItems(),a(!0,e)}.bind(this),u=function(t){t&&t.error&&t.error.code===r.a.HTTPStatusCode.NotFound?this._clearCachedData(e,function(i){i?this.performThreadSync(e,void 0,a):a(!1,e,t)}.bind(this)):(a(!1,e,t),this._notifyFailedRequest(e,t))}.bind(this);this._queuePagedRemoteRequestMulti(e,n,s,c,u,void 0,_.History,o)},_handleCompactHistory:function(e,t,a){for(var i=0,r=0;r<t.messages.length;++r)for(var n=t.messages[r],s=0;s<n.msgIDs.length;++s)this._handleMessageUpdated(e,n.id,n.msgIDs[s],a),i++;for(r=0;r<t.messagesAdded.length;++r)for(n=t.messagesAdded[r],s=0;s<n.msgIDs.length;++s)this._handleMessageAdded(e,n.id,n.msgIDs[s],a),i++;for(r=0;r<t.messagesDeleted.length;++r)for(n=t.messagesDeleted[r],s=0;s<n.msgIDs.length;++s)this._handleMessageDeleted(e,n.id,n.msgIDs[s]),i++;for(r=0;r<t.labelsAdded.length;++r){n=t.labelsAdded[r];this._handleLabelsAdded(e,n.id,n.msgID,n.labelIDs),i++}for(r=0;r<t.labelsRemoved.length;++r){n=t.labelsRemoved[r];this._handleLabelsRemoved(e,n.id,n.msgID,n.labelIDs),i++}return i},_handleMessageAdded:function(e,t,a,i){this.refreshThreadCacheData(e,t,a,i)},_handleMessageDeleted:function(e,t,a){this._deleteCachedMessage(e,t,a)},_handleLabelsAdded:function(e,t,a,i){this.addLabelsToMessage(e,t,a,i,ChangeType.Remote)},_handleLabelsRemoved:function(e,t,a,i){this.removeLabelsFromMessage(e,t,a,i,ChangeType.Remote)},_handleMessageUpdated:function(e,t,a,i){this.refreshThreadCacheData(e,t,a,i)},getLastSyncTime:function(e,t){this._threadCache.getMetadata(T,function(a){var i;if(a){var r=a[e];r&&r.date&&(i=new Date(r.date))}t(i)})},getAllLastSyncTimes:function(e){this._threadCache.getMetadata(T,function(t){for(var a={},i=this.getSyncAccounts(),r=0;r<i.length;++r){var n=i[r],s=t?t[n]:void 0;s&&s.date?a[n]=new Date(s.date):a[n]=void 0}e(a)}.bind(this))},setHistoryID:function(e,t,a){try{i.default.PAssert(1905,i.default.isString(e),"Must provide a valid account ID to set history ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1906,i.default.isString(t),"Must provide a valid history ID to set")}catch(e){i.default.reportError(e)}this._threadCache.getMetadata(T,function(i){(i=i||{})[e]={historyID:t,date:Date.now()},this._threadCache.setMetadata(T,i,a)}.bind(this))},clearHistoryID:function(e,t){try{i.default.PAssert(1907,i.default.isString(e),"Must provide a valid account ID to clear history ID for")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1908,i.default.isFunction(t),"Must provide valid CB function when clearing history ID")}catch(e){i.default.reportError(e)}this._threadCache.getMetadata(T,function(a){a?(delete a[e],this._threadCache.setMetadata(T,a,t)):t(!1)}.bind(this))},clearCachedLabel:function(e,t){try{i.default.PAssert(1909,i.default.isString(e),"Must provide a valid account ID to clear history ID for")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1910,i.default.isFunction(t),"Must provide valid CB function when clearing history ID")}catch(e){i.default.reportError(e)}this._threadCache.getMetadata(w,function(a){a?(delete a[e],this._threadCache.setMetadata(w,a,t)):t(!1)}.bind(this))},_clearCachedData:function(e,t){this.clearHistoryID(e,function(a){a?this.clearCachedLabel(e,function(a){a?this.clearAccountThreadCache(e,t):t(!1)}.bind(this)):t(!1)}.bind(this))},clearAccountThreadCache:function(e,t){try{i.default.PAssert(1911,i.default.isString(e),"Must provide a valid account ID to clear thread cache for")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1912,i.default.isFunction(t),"Must provide valid CB function when clearing thread cache")}catch(e){i.default.reportError(e)}this._threadCache.getFilterEntries(function(t){return t.accountID===e},function(a){if(a){log("Clearing account thread cache: "+e);for(var i=0;i<a.length;++i){var r=a[i];if(this._threadCache.removeEntry(r.id),r.messages)for(var n=0;n<r.messages.length;++n)this._rawCache.removeEntry(r.messages[n].id)}t(!0)}else t(!1)}.bind(this))},requestDataPage:function(e,t){log("Data Page: ",e.hasPaginationToken()),e.hasPaginationToken()&&!e.paginationTokenInUse()?this._requestRemoteThreads(void 0,_.DataPage,e,void 0,oe,void 0,void 0,t):t(!0)},_requestRemoteThreads:function(e,t,a,r,n,s,o,d){var c;if(a&&a.hasPaginationToken()&&!a.paginationTokenInUse()){c=a.beginDataPageLoad();try{i.default.PAssert(1915,!r,"Should not define a new q for paged token")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1916,!o,"Should not define a new entryCB for paged token")}catch(e){i.default.reportError(e)}if(r=c.getQuery(),n=c.getMaxResults(),o=c.getEntryCB(),d){var u=d;d=function(){c.getDoneCB().apply(null,arguments),u.apply(null,arguments)}}else d=c.getDoneCB();e=e||c.getInfo().accountID}else a&&a.needsPaginationToken()&&(c=this.createPaginationToken(void 0,r,{accountID:e},n,o,d),a.setPaginationToken(c),a.beginDataPageLoad());n=n||oe;try{i.default.PAssert(1917,o&&i.default.isFunction(o),"Must define a valid entry callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1918,d&&i.default.isFunction(d),"Must define a valid done callback")}catch(e){i.default.reportError(e)}var h,f,p=l.a.fns("gmail").users.threads.list.packedFn,m={userId:e,maxResults:n,timeoutMS:s,q:r,pageToken:c&&c.hasMorePages()?c.getNextPageToken():void 0};c||!a?(h=function(t){if(t.nextPageToken&&c&&this.updatePaginationToken(c,t.nextPageToken),a&&c&&a.endDataPageLoad(!!t.nextPageToken),t.threads)for(var i=t.threads.length,r=0,n=0,s=function(e){e?(o(e),r++):(o(void 0),n++),r+n===i&&d(!0)},l=0;l<t.threads.length;++l){var u=t.threads[l];this._requestRemoteThreadMetadata(e,u.id,void 0,s)}else d(!0)}.bind(this),f=function(t){a&&c&&a.endDataPageLoad(c),d(!1),this._notifyFailedRequest(e,t)}.bind(this)):(h=function(){d(!0)},f=function(t){d(!1),this._notifyFailedRequest(e,t)}.bind(this)),this._queueRemoteRequestMulti(e,p,m,h,f,void 0,t)},_requestRemoteMessageData:function(e,t,a){try{i.default.PAssert(1919,!e.isLocalOnlyAttachment(),"Should never request remote data for a local only attachment")}catch(e){i.default.reportError(e)}var r=l.a.fns("gmail").users.messages.get.packedFn,n={userId:e.getField("accountID"),id:t,format:"full"},s=function(r){var n=this._parseMailMessage(r);try{i.default.PAssert(1920,n,"Must be able to parse message")}catch(e){i.default.reportError(e)}this._updateMessageData(e,t,n),a(!0)}.bind(this),o=function(t){a(!1,t),this._notifyFailedRequest(e.getField("accountID"),t)}.bind(this);this._queueRemoteRequestMulti(e.getField("accountID"),r,n,s,o,void 0,_.MessageFull)},_requestRemoteMessageDataRaw:function(e,t,a,i){var r=l.a.fns("gmail").users.messages.get.packedFn,n={userId:e,id:a,format:"full"},s=function(t){i(void 0,t),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,r,n,i,s,void 0,_.MessageFull)},_requestRemoteThreadDataRaw:function(e,t,a){var i=l.a.fns("gmail").users.threads.get.packedFn,r={userId:e,id:t,format:"full"},n=function(t){a(void 0,t),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,i,r,a,n,void 0,_.ThreadFull)},_requestRemoteThreadMetadata:function(e,t,a,i){var r=l.a.fns("gmail").users.threads.get.packedFn,n={userId:e,id:t,format:"metadata"},s=function(t){i(void 0,t),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,r,n,function(e){i(e)},s,a,_.ThreadMeta)},_persistRemoteSnoozeTask:function(e,t){var a=e.getData();i.default.XHR_PrivateAPI({type:"POST",path:"/tasks/snoozeMail",data:a,requireAuth:!0,autoRetry:!1,cb:this._handleRemotePersist.bind(this,t)})},_cancelDeferredSnoozeTask:function(e,t){var a=e.getData();i.default.XHR_PrivateAPI({type:"POST",path:"/tasks/snoozeMail/cancel",data:a,requireAuth:!0,autoRetry:!1,cb:function(e){t(e.status===r.a.HTTPStatusCode.Success)}})},_persistRemoteSendMailTask:function(e,t){var a=e.getData();i.default.XHR_PrivateAPI({type:"POST",path:"/tasks/sendMail",data:a,requireAuth:!0,autoRetry:!1,cb:this._handleRemotePersist.bind(this,t)})},_cancelDeferredSendMailTask:function(e,t){var a=e.getData();i.default.XHR_PrivateAPI({type:"POST",path:"/tasks/sendMail/cancel",data:a,requireAuth:!0,autoRetry:!1,cb:function(e){t(e.status===r.a.HTTPStatusCode.Success)}})},_handleRemotePersist:function(e,t){if(t.status!==r.a.HTTPStatusCode.Success)return e(!1);try{return e(!0,JSON.parse(t.response).data.messageID)}catch(t){return i.default.reportError(t),e(!1)}},_parseMailThread:function(e,t){for(var a=[],r=0;r<t.messages.length;++r){var n=this._parseMailMessage(t.messages[r]);try{i.default.PAssert(1921,n,"Must be able to parse each message")}catch(e){i.default.reportError(e)}n&&a.push(n)}var s=e.getField("messages");this._mergeMessagesData(s,a,["labelIds","draftID"]),e.updateField("dataLoaded",!0),e.updateField("messages",a),this._updateAttachmentFromMessages(e,ChangeType.Remote)},getAttachmentURL:function(e,t,a){return"https://mail.google.com/mail/b/"+e+"/?ui=2&view=att&disp=safe&zw"+("&th="+t)+("&attid="+a)},getPreviewURL:function(e){return e.link},reportMessage:function(e,t,a,r,n){var s=l.a.fns("gmail").users.messages.get.packedFn,o={userId:e,id:a,format:"full",forceNoDupe:!0};this._queueRemoteRequestMulti(e,s,o,this._sendReport.bind(this,n,r),function(){try{i.default.PAssert(1922,!1,"Failed to report message")}catch(e){i.default.reportError(e)}},void 0,_.MessageFull)},dumpMessage:function(e,t,a){var i=this.getAttachment(t),r=this._getMessageFromAttachment(i,a);console.log("Message Dump: ",r)},_sanitizeMessage:function(e){if(e.parts)for(var t=0;t<e.parts.length;++t)this._sanitizeMessage(e.parts[t]);if(e.body&&e.body.data){var a=this._runDecodeEmail(e);a&&a.mimeType===X?e.body.data=this._encodeEmail(C.a.sanitizeContent(a.decoded)):e.body.data=this._encodeEmail(C.a.sanitizePlaintext(a.decoded))}if(e.headers)for(t=0;t<e.headers.length;++t){var i=e.headers[t];switch(i.name.toUpperCase()){case"TO":case"CC":case"BCC":case"FROM":i.value=i.value.replace(/[A-Za-z0-9]/g,"#");break;case"SUBJECT":case"SNIPPET":i.value=new Array(i.name.length+1).join("#")}}},_sendReport:function(e,t,a){try{i.default.PAssert(1923,i.default.isBoolean(e),"Must provide a valid boolean for sendContent")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1924,i.default.isString(t),"Must provide a valid description string")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1925,i.default.isObject(a),"Must provide valid raw data")}catch(e){i.default.reportError(e)}try{log("Sending Message Report",a),e||this._sanitizeMessage(a.payload);var r={description:t,payload:a.payload};i.default.reportError(new Error("Report Message"),r)}catch(e){i.default.reportError(e)}},loadResource:function(e,t,a,i){if(this.hasCacheData(e)){var r=this.getAttachment(e),n=this._getMessageFromAttachment(r,t).resources.find(a);n?(n.data?i(n,a):this._requestRemoteAttachment(r.getField("accountID"),t,n.id,function(e,t){e&&(n.data=e,n.size=t),i(n,a)}),this.sendEvent("FetchAttachment")):i(void 0,a)}else i(void 0,a)},_requestRemoteAttachment:function(e,t,a,i){var r=l.a.fns("gmail").users.messages.attachments.get.packedFn,n={id:a,messageId:t,userId:e},s=function(t){i(void 0),this._notifyFailedRequest(e,t)}.bind(this);this._queueRemoteRequestMulti(e,r,n,function(e){i(e.data.replace(/-/g,"+").replace(/_/g,"/"),e.size)},s,void 0,_.GetAttachment)},_parseAttachment:function(e,t,a){try{i.default.PAssert(1926,e,"Must have valid multipart lib")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1927,a.body,"Must have a valid attachment body")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1928,a.body.attachmentId,"Must have a valid attachment ID")}catch(e){i.default.reportError(e)}var r,n,s,o,l,d="0."+a.partId;if(a.headers)for(var c=0;c<a.headers.length;++c){var u=a.headers[c];switch(u.name.toUpperCase()){case"CONTENT-ID":var h=/^<(.*)>$/.exec(u.value);n=r=h?h[1]:u.value;break;case"CONTENT-TRANSFER-ENCODING":l=u.value;break;case"CONTENT-DISPOSITION":var f=u.value.split(";");o=f[0]?f[0].toLowerCase():void 0;break;case"X-ATTACHMENT-ID":s=u.value}}r&&o!==$||!a.filename?!r&&a.body.attachmentId&&(r=a.body.attachmentId):r=a.filename;try{i.default.PAssert(1929,r,"Must be able to find a valid resource ID")}catch(e){i.default.reportError(e)}var p={cid:r,rawContentID:n,id:a.body.attachmentId,attID:d,realAttrID:s,data:void 0,size:a.body.size,uploader:void 0,disposition:o,parentType:t.mimeType,mimeType:a.mimeType,contentEncoding:l};e.add(p)},_decodeFlowed:function(e,t){return e.split(/\r?\n/).reduce(function(e,a,i){var r=e;return t&&(r=r.replace(/[ ]+$/,"")),/ $/.test(e)&&!/(^|\n)\-\- $/.test(e)||1===i?r+a:r+"\n"+a}).replace(/^ /gm,"")},_decodeEmail:function(e,t,a){try{i.default.PAssert(1930,i.default.isString(e),"Passing in an invalid string to decode")}catch(e){i.default.reportError(e)}var r;if(e)try{r=i.default.b64_to_utf8(e),"FLOWED"===a.format&&(r=this._decodeFlowed(r,a.delSp))}catch(e){i.default.reportError(e)}return r},_encodeEmail:function(e){var t;try{t=i.default.utf8_to_b64(e)}catch(e){i.default.reportError(e)}return t},_runDecodeEmail:function(e){try{i.default.PAssert(1931,e&&e.body,"Must pass in a valid part")}catch(e){i.default.reportError(e)}var t,a=this._getHeader(e,"Content-Transfer-Encoding"),r=!1;if(ie.indexOf(e.mimeType)>=0)return{decoded:t=this._generateMessageDisplayNode(e),mimeType:X,contentType:"text/html;charset=utf-8",name:"GeneratedContent",hasError:r};var n=this._getHeader(e,"Content-Type")||"text/html;charset=utf-8";try{i.default.PAssert(1932,n,"Must have a valid contentType")}catch(e){i.default.reportError(e)}var s=this._sanitizeContentType(n);return e.body&&e.body.data?t=this._decodeEmail(e.body.data,a,s):e.body&&e.body.attachmentId?t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>':(t="Unable to decode email content",r=!0),{decoded:t,mimeType:e.mimeType,contentType:s.type,name:s.name,hasError:r}},_runDecodeMessage:function(e){var t=this._decodeMessagePart(e);return 0===t.length&&e?te.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:ie.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:[]:t},_decodeMessagePart:function(e){var t=[];if(e)if(e.mimeType===V||e.mimeType===H||e.mimeType===B)for(var a=0;a<e.parts.length;++a){var i=this._decodeMessagePart(e.parts[a]);t.pushArray(i)}else if(e.mimeType===U||e.mimeType===F||e.mimeType===F||e.mimeType===G)for(a=e.parts.length-1;a>=0;a--){if(this._isValidDisplayPart(e.parts[a]))if((i=this._decodeMessagePart(e.parts[a])).length>0){t.pushArray(i);break}}else this._isValidDisplayPart(e)&&t.push(this._runDecodeEmail(e));return t},_combineMessageParts:function(e){var t="",a=Y,i="text/html;charset=utf-8",r=!1;if(e&&e.length>0){a=e[0].mimeType,i=e[0].contentType;for(var n=0;n<e.length;++n)ae.indexOf(e[n].mimeType)<0&&(r=!0);t=C.a.combineParts(e)}else t=" ";return a===Y&&(a=X,i=X+";charset="+i.split(";charset=")[1]),{decoded:t,mimeType:a,contentType:i,reportMessage:r}},_isValidDisplayPart:function(e){var t=!1;return!this._isResourcePart(e)&&te.indexOf(e.mimeType)>=0&&(t=!0),t},_isResourcePart:function(e){var t=!1;return e.filename?t=!0:this._getHeader(e,"CONTENT-ID")&&(this._getHeader(e,"CONTENT-DISPOSITION")||te.indexOf(e.mimeType)<0)&&(t=!0),t},_parseMessagePart:function(e,t){var a={parent:t,raw:e,mimeType:e.mimeType,children:[],resources:[]};switch(e.mimeType){case Y:case X:case z:break;case F:case B:case W:case U:case q:case H:case j:case V:for(var r=0;r<e.parts.length;++r){var n=e.parts[r],s=this._parseMessagePart(n,a);this._isResourcePart(n)?a.resources.push(s):a.children.push(s)}break;case G:for(r=0;r<e.parts.length;++r){s=this._parseMessagePart(e.parts[r],a);a.children.push(s)}break;default:var o=e.mimeType.split("/")[0];ee.indexOf(o)<0&&(log("Unknown Part Mimetype: ",e),i.default.reportError(new Error("Unknown attachment mimetype: "+e.mimeType)))}return a},_getMessageDisplay:function(e,t){switch(e.mimeType){case Y:case X:case V:case H:case q:t.push(e);break;case U:case F:case G:case B:for(var a=0;a<e.children.length;++a)this._getMessageDisplay(e.children[a],t);break;case Q:case J:break;case W:case K:case j:t.push(e);break;default:try{i.default.PAssert(1933,!1,"Should never have an unknown multipart mimetype in the tree: ",e.mimeType)}catch(e){i.default.reportError(e)}}},_getResourcesForNode:function(e,t){for(var a=e.resources,i=0;i<a.length;++i){var r=a[i].raw;this._parseAttachment(t,e,r)}e.raw&&e.raw.body&&e.raw.body.attachmentId&&this._parseAttachment(t,e.parent,e.raw)},_getResourcesForPart:function(e){var t=new y.a;if(e.mimeType===V||e.mimeType===H)for(var a=0;a<e.children.length;++a)this._getResourcesForNode(e.children[a],t);for(;e;)this._getResourcesForNode(e,t),e=e.parent;return t},_displayAttachment:function(e,t){var a=!1;return e.cid===t&&(e.disposition===$?a=!0:e.disposition===Z&&e.parentType===V&&(a=!0)),a},getMessageAttachments:function(e){var t=[];return e.resources.forEachResource(function(e){this._displayAttachment(e,e.cid)&&t.push(e)}.bind(this)),t},getMessageDisplayAttachments:function(e){var t,a=this.getMessageAttachments(e);if(e.initializedForDisplay)t=e.specialLinks?e.specialLinks.attachments:[];else{var i={ignoreQuotedAttachments:!!(e.labelIds.indexOf(x.DRAFT)>=0)};t=C.a.getAttachmentLinks(e.decoded,i)}for(var r=0;r<t.length;++r){var n=t[r];if(!e.resources.has(n.name)){var s=this._createResource(e.resources,n);s.link=n.href,a.push(s)}}return a},_verifyDKIM:function(e){var t=void 0;if(e)for(var a=e.split(";"),i=/([a-z]+)[=](.*)/i,r=0;r<a.length;++r){var n=a[r].trim();if(n){var s=i.exec(n);if(s)switch(t={},s[1]){case"d":t.domain=s[2];break;case"h":t.headers=s[2].split(":").map(Function.prototype.call,String.prototype.trim)}}}return t},_sanitizeContentType:function(e){var t="text/html;charset=utf-8";try{var a,r,n,s,o=e.replace(/[\"\']/g,"").split(";"),l=o[0].trim().toLowerCase();try{i.default.PAssert(1934,l===Y||l===X,"Unknown ContentType MediaType: "+l)}catch(e){i.default.reportError(e)}for(var d=1;d<o.length;++d){var c=o[d].trim();if(c){var u=c.indexOf("=");if(u>=1){var h=c.substr(0,u).trim(),f=c.substr(u+1).trim();if(h&&f)switch(h.toUpperCase()){case"CHARSET":a=f;break;case"FORMAT":r=f.toUpperCase();break;case"DELSP":n="YES"===f.toUpperCase();break;case"NAME":s=f;break;case"BOUNDARY":break;default:try{i.default.PAssert(1935,!1,"Unknown param in ContentType: "+c)}catch(e){i.default.reportError(e)}}else try{i.default.PAssert(1936,!1,"Malformed contentType part: ",e)}catch(e){i.default.reportError(e)}}else try{i.default.PAssert(1937,!1,"Invalid contentType part: ",e)}catch(e){i.default.reportError(e)}}}a||(a="utf-8"),l&&a&&(t=l+";charset="+a)}catch(e){i.default.reportError(e)}return{type:t,format:r,delSp:n,name:s}},_getHeader:function(e,t){var a;if(e&&e.headers)for(var i=0;i<e.headers.length;++i)if(e.headers[i].name.toUpperCase()===t.toUpperCase()){a=e.headers[i].value;break}return a},_generateMessageDisplayNode:function(e){try{i.default.PAssert(1939,ie.indexOf(e.mimeType)>=0,"Must be a valid mimeType to generate content from")}catch(e){i.default.reportError(e)}var t;if(e.body&&e.body.attachmentId)t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>';else{var a;switch(e.mimeType){case K:case j:case V:a="&nbsp;";break;case W:a="Unable to display encrypted message content.";break;default:a="Unable to display unknown content type: "+e.mimeType}t="<html><body>"+a+"</body></html>"}return t},_parseMailMessage:function(e){var t;try{t=this._parseMailMessageInternal(e)}catch(e){i.default.reportError(e)}return t},_parseMailMessageInternal:function(e){var t={},a=e.payload,r=!!a.body&&a.body.size>0;try{i.default.PAssert(1940,r!==a.mimeType.startsWith("multipart/")||a.mimeType===B,"Checking the body size should be the same as checking whether this is a multipart message")}catch(e){i.default.reportError(e)}this._verifyDKIM(this._getHeader(e.payload,"DKIM-Signature"));for(var n,s,o=e.payload.headers,l=0;l<o.length;++l){var d=o[l];switch(d.name.toUpperCase()){case"FROM":e.from=this.parseEmailAddress(d.value);break;case"REPLY-TO":e.replyTo=this.parseEmailAddress(d.value);break;case"TO":e.to=this.parseEmailAddresses(d.value);break;case"CC":e.cc=this.parseEmailAddresses(d.value);break;case"BCC":e.bcc=this.parseEmailAddresses(d.value);break;case"SUBJECT":e.subject=d.value;break;case"DATE":e.date=this.parseDateHeader(d.value);try{i.default.PAssert(1941,i.default.isDateValid(e.date),"Must have a valid message date: ",e.date)}catch(e){i.default.reportError(e)}break;case"MESSAGE-ID":e.messageID=d.value;break;case"REFERENCES":e.references=d.value;break;case"IN-REPLY-TO":e.inReplyTo=d.value;break;case"LIST-UNSUBSCRIBE":e.listUnsubscribe=d.value;break;default:0}}if(e.messageID||(e.messageID=i.default.generateTempId()),r)s=a;else{var c,u=this._parseMessagePart(a),h=[];this._getMessageDisplay(u,h);for(var f=h.length-1;!c&&f>=0;f--)if(te.indexOf(h[f].mimeType)>=0)c=h[f];else if(ie.indexOf(h[f].mimeType)>=0)c=h[f];else{log("Unknown bestNode mimepart: ",h[f]);try{i.default.PAssert(1942,!1,"Unknown mimePart display type: ",h[f].mimeType)}catch(e){i.default.reportError(e)}}c?(n=this._getResourcesForPart(c),s=c.raw):this._sendReport(!1,"Missing bestNode",e)}try{i.default.PAssert(1943,s,"Must have found a valid message part to display")}catch(e){i.default.reportError(e)}var p=this._runDecodeMessage(s);try{i.default.PAssert(1944,p.length>0,"Should have at least one decoded message part available")}catch(e){i.default.reportError(e)}if(0===p.length)try{var m=JSON.parse(JSON.stringify(e));this._sendReport(!0,"No valid decoded part",m)}catch(e){i.default.reportError(e)}var g=this._combineMessageParts(p);g&&(t={id:e.id,labelIds:e.labelIds,messageID:e.messageID,decoded:g.decoded,mimeType:g.mimeType,contentType:g.contentType,from:e.from,to:e.to||[],cc:e.cc,bcc:e.bcc,snippet:e.snippet,subject:e.subject||"",date:e.date,internalDate:e.internalDate?new Date(i.default.parseInt(e.internalDate)):new Date,references:e.references,inReplyTo:e.inReplyTo,listUnsubscribe:e.listUnsubscribe,resources:n||new y.a},g.reportMessage&&this._sendReport(!1,"Mismatch mimeType/contentType",e));return t},parseEmailAddress:function(e){ne.lastIndex=0;var t=ne.exec(e),a={};if(t){var i=se.exec(t[1]);a.text=i?i[1]:t[1],a.email=t[2]}else a.email=e;return a.email&&(a.email=a.email.replace(/[\r\n]/g,"")),a.text&&(a.text=a.text.replace(/[\r\n]/g,"")),a},parseEmailAddresses:function(e){for(var t=[],a=i.default.parseEmailAddresses(e),r=0;r<a.length;++r){var n=a[r];"contact"===n.type&&n.email&&t.push(n)}return t},parseDateHeader:function(e){var t=new Date(e);return i.default.isDateValid(t)||(t=d.a.parseDate(e,r.a.DateFormat.MDY)),t},runRemoteSearch:function(e,t,a,r){try{i.default.PAssert(1946,e,"Must provide a valid search")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1947,t,"Must provide a valid pane")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1948,a,"Must provide a valid bucket ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1949,i.default.isFunction(r),"Must provide a valid search callback")}catch(e){i.default.reportError(e)}var n="-in:chats -in:spam "+e,s=i.default.vmMain.paneManager.getPaneById(t),o=this._getAccountIDFromItem(s.getItem())||this.getDefaultAccount(),l=!1,d=0,c=0,u=new m.a(e,oe,this.requestDataPage.bind(this)),h=function(e){if(d===c&&l){log("Done Searching: ",d);var i=e?SearchResultStatus.Error:d>0?SearchResultStatus.Done:SearchResultStatus.None;u.isValid()&&this.swapInSearchBucket(a,t),r(i)}}.bind(this),f=function(e){if(d++,e){var t=this._addRemoteEntry(o,e),i=this.getBucketItemStore(a);this._ensureVMLIsForSearchResult(t,i),c++}else c++,0;h()}.bind(this),p=function(e){l=!0,h(!e)}.bind(this),g=!1,v=new P.a(u.onEntry,function(e){u.onDone(e),g||(g=!0,u.isValid()&&u.hasResults()?u.getNextPage(f,p):p(e))});return this._requestRemoteThreads(o,_.Search,void 0,n,oe,void 0,v.getEntryCB(),v.getDoneCB()),u},_addSearchCacheEntryInternal:function(e,t,a){var i=!1,r=this._ensureAccountLib(e,this._emailCache);return r[t]||(r[t]={}),r[t][a]||(r[t][a]=!0,i=!0),i},_removeSearchCacheEntryInternal:function(e,t,a){var i,r=this._getAccountLib(e,this._emailCache);return r&&r[t]&&(i=r[t][a],delete r[t][a]),i},_getSearchCacheLabelEntryInternal:function(e,t){var a,i=this._getAccountLib(e,this._emailCache);return i&&i[t]&&(a=i[t]),a},_addEmailToSearchCache:function(e,t){var a=!1;if(t&&i.default.isArray(t.labelIds))for(var r=0;r<t.labelIds.length;++r)a|=this._addSearchCacheEntryInternal(t.accountID,t.labelIds[r],e);return a},_removeEmailFromSearchCache:function(e,t){var a=!1;if(t&&i.default.isArray(t.labelIds))for(var r=0;r<t.labelIds.length;++r){var n=!!this._removeSearchCacheEntryInternal(t.accountID,t.labelIds[r],e);a|=n,n&&this._removeThreadLabelVMLI(t.accountID,e,t.labelIds[r])}return a},_addEmailLabelToSearchCache:function(e,t,a){return this._addSearchCacheEntryInternal(e,a,t)},_removeEmailLabelFromSearchCache:function(e,t,a){var i=!!this._removeSearchCacheEntryInternal(e,a,t);return i&&this._removeThreadLabelVMLI(e,t,a),i},runLocalItemSearch:function(e){var t=this.getDescriptorForItem(e.item),a=this._getSearchCacheLabelEntryInternal(t.accountID,t.labelID);if(a)for(var r in a){var n=this.getCacheData(r);try{i.default.PAssert(1950,n,"Must have valid data for search entry")}catch(e){i.default.reportError(e)}if(n){var s=this._ensureThreadLabelVMLI(n,t.labelID);e.comparator&&!e.comparator(s)||e.each&&e.each(s)}}},getRemoteAttachmentData:function(e){try{i.default.PAssert(1951,e.hasField("accountID"),"Must have a valid accountID for a thread")}catch(e){i.default.reportError(e)}if(e.hasField("accountID")){var t=function(t,a){t?this._addRemoteEntry(e.getField("accountID"),t):(e.notifyDataRequestFailed(),this._notifyFailedRequest(e.getField("accountID"),a))}.bind(this);this._requestRemoteThreadMetadata(e.getField("accountID"),e.id,e,t)}else e.notifyDataRequestFailed()},_updateThreadFromMessages:function(e){try{i.default.PAssert(1952,!e.isDeleted||0===e.messages.length,"Should never run an update on a deleted thread with messages")}catch(e){i.default.reportError(e)}var t=e.labelIds,a=i.default.getUserIdentifier();"me"===e.accountID&&"me"!==a&&(e.accountID=a),e.labelIds=[],e.date=void 0,e.participants=[],e.count=e.messages.length,e.snippet=e.count>0?e.messages[e.messages.length-1].snippet:"",e.hasPriority=!1;for(var r=0;r<e.messages.length;++r){var n=e.messages[r];try{i.default.PAssert(1953,n.id,"Each message must have a valid ID")}catch(e){i.default.reportError(e)}e.labelIds.pushOnlyUniques(n.labelIds);var s=n.labelIds.indexOf(x.DRAFT)>=0,o=!1;if(n.labelIds.indexOf(x.SENT)>=0)for(var l=0;l<n.to.length;++l){var d=n.to[l];if(this.isMyAccountID(d.email)){o=!0;break}}else o=!0;if((!e.date||n.date&&e.date.isBefore(n.date)&&!s&&o)&&(e.date=n.date),(!e.internalDate||n.internalDate&&e.internalDate.isBefore(n.internalDate))&&(e.internalDate=n.internalDate),n.from&&e.participants.indexOfWithProperty("email",n.from.email)<0&&e.participants.push(n.from),n.resources instanceof y.a)n.resources.forEachResource(function(t){this._displayAttachment(t,t.cid)&&(e.hasAttachments=!0)}.bind(this));else try{i.default.PAssert(1954,!1,"Message must always be a resource lib")}catch(e){i.default.reportError(e)}}return e.date=e.date?new Date(e.date):new Date(0),i.default.isDateValid(e.date)||(e.date=new Date(0)),e.internalDate=e.internalDate?new Date(e.internalDate):new Date,i.default.isDateValid(e.internalDate)||(e.internalDate=new Date),e.lastModifiedDate=e.lastModifiedDate?new Date(e.lastModifiedDate):e.date,i.default.isDateValid(e.lastModifiedDate)&&!e.lastModifiedDate.isBefore(e.date)||(e.lastModifiedDate=e.date),e.messages.length>0&&(e.subject=e.messages[0].subject,e.subjectLower=e.subject.toLowerCase(),e.from=e.messages[e.messages.length-1].from,e.to=e.messages[0].to),{labelsAdded:t?e.labelIds.removeArray(t):e.labelIds,labelsRemoved:t?t.removeArray(e.labelIds):void 0}},_updateAttachmentFromMessages:function(e,t){var a=this._updateThreadFromMessages(e.getData());this._handleThreadLabelUpdates(e.getData(),a.labelsAdded,a.labelsRemoved),e.notifyDataMutated(["labelIds","date","lastModifiedDate","count","snippet","subject","subjectLower","hasAttachments","from","to"],t)},_createRemoteEntry:function(e,t){for(var a={id:t.id,accountID:e,messages:[],labelIds:[]},r=0;r<t.messages.length;++r){var n=t.messages[r];try{i.default.PAssert(1955,n.id,"Message must have a valid id")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1956,!n.labelIds||n.labelIds.indexOf(x.CHAT)<0,"Should never receive a chat message")}catch(e){i.default.reportError(e)}n.labelIds&&n.labelIds.indexOf(x.DRAFT)>=0&&this._notifyDraftMessage(e,t.id,n.id);for(var s={id:n.id,messageID:void 0,internalDate:n.internalDate?new Date(i.default.parseInt(n.internalDate)):new Date,snippet:n.snippet,labelIds:n.labelIds||[],to:[],resources:new y.a,subject:""},o=0;o<n.payload.headers.length;++o){var l=n.payload.headers[o];switch(l.name.toUpperCase()){case"TO":s.to=this.parseEmailAddresses(l.value);break;case"FROM":s.from=this.parseEmailAddress(l.value);break;case"SUBJECT":s.subject=l.value;break;case"MESSAGE-ID":s.messageID=l.value;break;case"IN-REPLY-TO":s.inReplyTo=l.value;break;case"DATE":s.date=this.parseDateHeader(l.value);try{i.default.PAssert(1957,i.default.isDateValid(s.date),"Must have a valid message date: ",l.value)}catch(e){i.default.reportError(e)}}}i.default.isDateValid(s.date)||(s.date=s.internalDate),s.subject||(s.subject=""),s.messageID||(s.messageID=i.default.generateTempId()),a.messages.push(s)}return this._updateThreadFromMessages(a),a},_addRemoteEntry:function(e,t){var a=this._createRemoteEntry(e,t);if(this.hasCacheData(a.id)){var i=this.getCacheData(a.id);if(i){this._mergeThreadData(i,a);var r=this._updateThreadFromMessages(a);this._handleThreadLabelUpdates(a,r.labelsAdded,r.labelsRemoved)}var n=this.getChangedFields(i,a);if(this.cacheData(a.id,a,!!i,n),this.fieldsHaveParseEffect(n))if(this.hasAttachment(a.id))this.getAttachment(a.id).notifyDataMutated(n,ChangeType.Remote)}else this.cacheData(a.id,a),this._updateSearchPanes(a,a.labelIds,[]);return a},cacheData:function(e,t,a,i){this._verifyMessageState(t,!1);var r=this._addEmailToSearchCache(e,t);if(this._super.cacheData.call(this,e,t,a,i),t.messages&&this._checkUnsyncdMessageContent(t),r){var n=this.getDefaultItemStore();n&&n.updateItems()}},cacheThreadData:function(e,t){this._verifyMessageState(t,!0),this._threadCache.cacheEntry(e,t)},_verifyMessageState:function(e,t){},createEntryFromLocal:function(e,t){t.subjectLower=t.subject.toLowerCase(),t.messages=t.messages||[];for(var a=0;a<t.messages.length;++a){var r=t.messages[a];if(i.default.isString(r.date)?r.date=this.parseDateHeader(r.date):r.date||(r.date=new Date),i.default.isString(r.internalDate)?r.internalDate=new Date(r.internalDate):r.internalDate||(r.internalDate=new Date),r.to||(r.to=[]),r.resources){var n=r.resources;if(n instanceof y.a)r.resources=n.clone();else for(var s in r.resources=new y.a,n)r.resources.add(n[s])}else r.resources=new y.a;try{i.default.PAssert(1962,r.draftID||r.messageID||i.default.isTempId(r.id),"Remotely saved messages must have a valid message ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1963,i.default.isDateValid(r.date),"Must have a valid message date: ",r.date)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1964,i.default.isDateValid(r.internalDate),"Must have a valid internal message date: ",r.internalDate)}catch(e){i.default.reportError(e)}!i.default.isTempId(r.id)&&!r.draftID&&r.labelIds&&r.labelIds.indexOf(x.DRAFT)>=0&&this._notifyDraftMessage(t.accountID,e,r.id),r.decoded&&this.reportTrackedStat(A.MessageDataCached)}return this._updateThreadFromMessages(t),t},_updateMessageData:function(e,t,a){var r=e.getField("messages"),n=r.indexOfWithProperty("id",t);try{i.default.PAssert(1965,n>=0,"Must always be able to find the message being updated")}catch(e){i.default.reportError(e)}n>=0&&(this._mergeMessageData(r[n],a,["labelIds"]),r[n]=a,e.updateField("messages",r),this._updateAttachmentFromMessages(e,ChangeType.Remote))},_mergeMessageData:function(e,t,a){try{i.default.PAssert(1966,i.default.isObject(e),"Must pass in a valid old message")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1967,i.default.isObject(t),"Must pass in a valid new message")}catch(e){i.default.reportError(e)}if(e.modifiedOffline){var r=e.modifiedOffline;try{i.default.PAssert(1968,i.default.isArray(r),"Should not be receiving an update for an event that was created locally")}catch(e){i.default.reportError(e)}for(var n=0;n<r.length;++n)t[r[n]]=e[r[n]];t.modifiedOffline=e.modifiedOffline}if(a)for(n=0;n<a.length;++n)e.hasOwnProperty(a[n])&&(t[a[n]]=e[a[n]]);for(var s in e)switch(s){case"snippet":this._pendingDraftUpdates[e.id]&&(t[s]=e[s]);break;default:t.hasOwnProperty(s)||(t[s]=e[s])}},_mergeMessagesData:function(e,t,a){try{i.default.PAssert(1969,i.default.isArray(e),"Must have a valid old messages array")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1970,i.default.isArray(t),"Must have a valid new messages array")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1971,e!==t,"Should not pass in the same array for old and new")}catch(e){i.default.reportError(e)}for(var r=0;r<e.length;++r){var n=e[r],s=t.indexOfWithProperty("id",n.id);if(s>=0){var o=t[s];try{i.default.PAssert(1972,o,"Must have a valid new message")}catch(e){i.default.reportError(e)}this._mergeMessageData(n,o,a)}else if(n.labelIds.indexOf(x.DRAFT)>=0)if(i.default.isTempId(n.id)){var l=t.indexOfWithProperty("messageID",n.inReplyTo);try{i.default.PAssert(1973,l>=0,"Must be able to find the message being replied to")}catch(e){i.default.reportError(e)}l>=0&&t.splice(l+1,0,n)}else if(n.inReplyTo){var d=t.indexOfWithProperty("inReplyTo",n.inReplyTo);if(d>=0){o=t[d];try{i.default.PAssert(1974,o,"Must have a valid new message")}catch(e){i.default.reportError(e)}this._mergeMessageData(n,o,a)}}else try{i.default.PAssert(1975,!1,"Message is not in reply to anything and ID is not found: ",n.id,t.length,e.length)}catch(e){i.default.reportError(e)}}},_mergeThreadData:function(e,t){this.reportTrackedStat(A.MergeThread);try{i.default.PAssert(1976,!e.isDeleted,"Should never merge message data in a deleted thread")}catch(e){i.default.reportError(e)}if(this._mergeMessagesData(e.messages,t.messages,["resources","draftID"]),e.modifiedOffline){var a=e.modifiedOffline;try{i.default.PAssert(1977,i.default.isArray(a),"Should not be receiving an update for an event that was created locally")}catch(e){i.default.reportError(e)}for(var r=0;r<a.length;++r){switch(n=a[r]){case"messages":break;default:t[n]=e[n]}}t.modifiedOffline=e.modifiedOffline}for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n]);t.labelIds=e.labelIds},_shouldCacheThread:function(e){for(var t=!0,a=0;a<e.messages.length;++a){var i=e.messages[a];if(i.labelIds&&(i.labelIds.indexOf(x.SPAM)>=0||i.labelIds.indexOf(x.CHAT)>=0)){t=!1;break}}return t},_shouldCacheMessageData:function(e){var t=!1,a=this._getFullSyncTime(),i=this._getUnreadSyncTime();if(e.date.isAfter(a))t=!0;else if(e.date.isAfter(i))for(var r=0;r<e.messages.length;++r){var n=e.messages[r];if(this.isPriorityData(n)){t=!0;break}}return t},refreshThreadCacheData:function(e,t,a,i,n){this._requestRemoteThreadMetadata(e,t,void 0,function(a,s){if(a)if(this._shouldCacheThread(a)){var o=this._addRemoteEntry(e,a);this.cacheThreadData(t,this.serializeExternalData(o),n)}else this._deleteCachedThread(e,t,n);else s&&s.error&&s.error.code===r.a.HTTPStatusCode.NotFound?this._deleteCachedThread(e,t,n):(i(e,t),n&&n(!1))}.bind(this))},_deleteCachedThread:function(e,t,a){if(this.hasCacheData(t)){for(var r=this.getAttachment(t),n=r.getField("messages"),s=0;s<n.length;++s)i.default.menus.isComposeOpenForEmail(n[s].id)&&(this._clearPendingDraftUpdate(r,n[s].id),u.a.fireEvent("EmailCompose","onClosed",[]),i.default.menus.closeComposeEmail(r,n[s])),this._rawCache.removeEntry(n[s].id);r.updateField("isDeleted",!0),r.updateField("messages",[]),this._updateAttachmentFromMessages(r,ChangeType.Remote)}this._threadCache.removeEntry(t,function(e){try{i.default.PAssert(1978,e,"Should be able to delete the thread from the local thread cache")}catch(e){i.default.reportError(e)}a&&a(e)})},_deleteCachedMessage:function(e,t,a){try{i.default.PAssert(1979,a,"Must specify a valid message ID to remove from thread")}catch(e){i.default.reportError(e)}if(this.hasCacheData(t))for(var r=this.getAttachment(t),n=r.getField("messages"),s=0;s<n.length;++s)if(n[s].id===a){n.removeAt(s),this._updateAttachmentFromMessages(r,ChangeType.Remote),r.updateField("messages",n);break}this._threadCache.getEntry(t,function(e){if(e)for(var i=0;i<e.messages.length;++i)if(e.messages[i].id===a){e.messages.removeAt(i),this.cacheThreadData(t,e);break}}.bind(this)),this._rawCache.removeEntry(a)},setLastModifiedDate:function(e,t,a){this.hasCacheData(t)&&this.getAttachment(t).updateField("lastModifiedDate",a);this._threadCache.getEntry(t,function(e){e&&(e.lastModifiedDate=a,this.cacheThreadData(t,e))}.bind(this))},addLabelsToMessage:function(e,t,a,r,n){if(this.hasCacheData(t)){for(var s=this.getAttachment(t),o=s.getField("messages"),l=0;l<o.length&&(a&&o[l].id!==a||(o[l].labelIds.pushOnlyUniques(r),!a));++l);this._updateAttachmentFromMessages(s,n),s.updateField("messages",o)}this._threadCache.getEntry(t,function(e){if(e){for(var n=!1,s=0;s<e.messages.length;++s)if(!a||e.messages[s].id===a){e.messages[s].labelIds.pushOnlyUniques(r),this.cacheThreadData(t,e),n=!0;break}try{i.default.PAssert(1981,n,"Must have found message to add labels to")}catch(e){i.default.reportError(e)}}}.bind(this))},removeLabelsFromMessage:function(e,t,a,r,n){if(this.hasCacheData(t)){for(var s=this.getAttachment(t),o=s.getField("messages"),l=0;l<o.length;++l)if(!a||o[l].id===a){for(var d=0;d<r.length;++d)o[l].labelIds.remove(r[d]);if(a)break}this._updateAttachmentFromMessages(s,n),s.updateField("messages",o)}this._threadCache.getEntry(t,function(e){if(e){for(var n=!1,s=0;s<e.messages.length;++s)if(!a||e.messages[s].id===a){for(var o=0;o<r.length;++o)e.messages[s].labelIds.remove(r[o]);this.cacheThreadData(t,e),n=!0;break}try{i.default.PAssert(1982,n,"Must have found message to remove labels from")}catch(e){i.default.reportError(e)}}}.bind(this))},changeMessageAccount:function(e,t,a,r,n,s){try{i.default.PAssert(1983,s,"Must supply a valid from contact")}catch(e){i.default.reportError(e)}var o=r!==e.getField("accountID"),l=this._findDraft(e,t,a);return o&&this.discardDraft(e,l.id,l.draftID,function(e){try{i.default.PAssert(1984,e,"Must successfully delete remote draft")}catch(e){i.default.reportError(e)}}),l.from=s,l.replyTo=this.getReplyToAddress(s.email),l.decoded=C.a.replaceSignature(l.decoded,this.getSignature(n)),o?this.createDraft(r,void 0,void 0,l):this.updateDraft(e,l.id,l.draftID,l,l.snippet,!0,!0,function(e){try{i.default.PAssert(1985,e,"Must be able to successfully update the draft when swiching sending accounts")}catch(e){i.default.reportError(e)}})},_ensureVMLIsForSearchResult:function(e,t){try{i.default.PAssert(1986,t,"Should never be ensuring a search VMLI in the default item store")}catch(e){i.default.reportError(e)}var a="S~"+e.accountID,r=this._ensureVMLIsForAccount(a,t),n=this._createThreadID(a,"",e.id);if(!t.hasItem(n)){var s=t.createItem(n,this._getTextForItem(e),r.id);r.insertSorted(s,this.sortFn)}},_removeVMLIFromSearchResult:function(e,t){try{i.default.PAssert(1987,t,"Should never be ensuring a search VMLI in the default item store")}catch(e){i.default.reportError(e)}var a="S~"+e.accountID,r=this._createThreadID(a,"",e.id);t.hasItem(r)&&t.destroyItem(r)},_createThreadID:function(e,t,a){return"T~"+e+"~"+t+"~"+a},_getItemProps:function(e,t){var a;return t.isNamed(R.PRI0)?a={priority:VMLIFlag.P0}:t.isNamed(R.PRI1)?a={priority:VMLIFlag.P1}:t.isNamed(R.PRI2)&&(a={priority:VMLIFlag.P2}),a},_ensureThreadLabelVMLI:function(e,t,a){a=a||this.getDefaultItemStore();var i,r=this._getLabelByID(e.accountID,t),n=this._ensureVMLIsForLabel(e.accountID,r,a),s=this._createThreadID(e.accountID,t,e.id);if(this.reportTrackedStat(A.EnsureLabelVMLI),a.hasItem(s))i=a.getItem(s);else{this.reportTrackedStat(A.CreateLabelVMLI);var o=this._getItemProps(e,r);i=a.createItem(s,this._getTextForItem(e),n.id,o),n.insertSorted(i,this.threadSortFn,!1)}return i},_removeThreadLabelVMLI:function(e,t,a,i){i=i||this.getDefaultItemStore();var r=this._createThreadID(e,a,t);i.hasItem(r)&&i.destroyItem(r)},_getRequiredSearchLabels:function(e){for(var t=[x.INBOX],a=e.split(" "),i=0;i<a.length;++i){var r=a[i].split(":");r&&2===r.length&&("label"!==r[0]&&"category"!==r[0]&&"is"!==r[0]||t.push(r[1].toUpperCase()))}return t},_handleThreadLabelUpdates:function(e,t,a){i.default.vmMain.beginUpdateItems();var r=!1;if(t)for(var n=0;n<t.length;++n)r|=this._addEmailLabelToSearchCache(e.accountID,e.id,t[n]);if(a)for(n=0;n<a.length;++n)r|=this._removeEmailLabelFromSearchCache(e.accountID,e.id,a[n]);this._updateSpecialLabels(e),this._updateSearchPanes(e,t,a),r&&this.getDefaultItemStore().updateItems(),i.default.vmMain.commitUpdateItems()},_updateSearchPanes:function(e,t,a){i.default.vmMain.beginUpdateItems(),i.default.vmMain.paneManager.runForEachPane(function(r){if(r.isSearchingRemote()){var n=this.getActiveItemStore(r.id),s=r.search.getRemoteValue(),o=!1,l=!1;this._getRequiredSearchLabels(s).forEach(function(e){a&&a.indexOf(e)>=0?o=!0:t&&t.indexOf(e)>=0&&(l=!0)}),o?n!==this.getDefaultItemStore()&&(i.default.focusedPane===r&&0===t.length&&a&&1===a.length&&a[0]===x.UNREAD||this._removeVMLIFromSearchResult(e,n)):l&&n!==this.getDefaultItemStore()&&this._ensureVMLIsForSearchResult(e,n)}}.bind(this),this.getPaneType()),i.default.vmMain.commitUpdateItems()},_updateSpecialLabels:function(e){this._threadIsArchived(e)?this._addEmailLabelToSearchCache(e.accountID,e.id,O.ARCHIVED):this._removeEmailLabelFromSearchCache(e.accountID,e.id,O.ARCHIVED),this._addEmailLabelToSearchCache(e.accountID,e.id,O.ALLMAIL)},_ensureVMLIsForAccount:function(e,t){try{i.default.PAssert(1988,e,"Must specify a valid account ID")}catch(e){i.default.reportError(e)}var a="A~"+e,r=(t=t||this.getDefaultItemStore()).getItem(a);if(!r){var n=t.getRoot();r=t.createItem(a,e,n.id),n.insertSorted(r,this.sortFn)}return r},_ensureVMLIsForLabel:function(e,t,a){try{i.default.PAssert(1989,t,"Must specify a valid label")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1990,t instanceof g.a,"Must pass in a valid label object")}catch(e){i.default.reportError(e)}a=a||this.getDefaultItemStore();var r="L~"+e+"~"+t.getLabelID(),n=a.getItem(r),s=t.getDisplayText(!0);if(n)n.getParsedText()!==s&&n.setText(s,!0,ChangeType.Auto);else{var o;if(t.hasAncestors()){var l=this._getLabelByName(e,t.getParent().getRawName(),!0);o=l?this._ensureVMLIsForLabel(e,l,a):this._ensureVMLIsForAccount(e,a)}else o=this._ensureVMLIsForAccount(e,a);n=a.createItem(r,s,o.id),o.insertSorted(n,this.sortFn)}return n},getVMLIForAccount:function(e){return this._ensureVMLIsForAccount(e)},getVMLIForLabel:function(e,t){return this._ensureVMLIsForLabel(e,t)},getLabelForVMLI:function(e){var t,a=this.getDescriptorForItem(e);return a.accountID&&a.labelID&&(t=this._getLabelByID(a.accountID,a.labelID)),t},_getAccountIDFromItem:function(e){var t,a=e.id;a.startsWith("R~")&&(a=a.substr(2)),a.startsWith("A~")?(t=a.substr(2)).startsWith("S~")&&(t=t.substr(2)):a.startsWith("L~")?t=a.substring(2,a.indexOf("~",2)):a.startsWith("T~")&&(t=a.substring(2,a.indexOf("~",2)));try{i.default.PAssert(1991,!t||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(e){i.default.reportError(e)}return t},_getLabelIDFromItem:function(e){var t,a=e.id;a.startsWith("L~")?t=a.substr(a.indexOf("~",2)+1):a.startsWith("T~")&&(t=a.substr(a.indexOf("~",2)+1));try{i.default.PAssert(1992,!t||i.default.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1993,!t||t.length>3,"Label ID should be longer than a couple of chars")}catch(e){i.default.reportError(e)}return t},_getThreadIDFromItem:function(e){return this._getThreadID(e.id)},_getThreadID:function(e){var t;e.startsWith("T~")?t=e.substr(e.lastIndexOf("~")+1):e.startsWith("A~")||e.startsWith("L~")||e.startsWith("R~")||(t=e);try{i.default.PAssert(1994,!t||i.default.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in thread ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1995,!t||t.length>3,"Thread ID should be longer than a couple of chars")}catch(e){i.default.reportError(e)}return t},isAccountItem:function(e){return e.id.startsWith("A~")},isLabelItem:function(e){return e.id.startsWith("L~")},isThreadItem:function(e){return e.id.startsWith("T~")},getAttachmentClass:function(){return["plugin_gmail"]},googleScopes:function(){return[GScope.GmailModify,GScope.GmailCompose]},getDependencies:function(){return[PluginDependency.LocalLoaded,PluginDependency.GoogleLogin]},isDependencyLoaded:function(e,t){var a=!1;switch(e){case PluginDependency.GoogleLogin:t&&t.indexOf(GScope.GmailModify)>=0&&(a=!0);break;default:a=!0}return a},verifyAuthorization:function(e){return this.getSyncAccounts().indexOf(e)>=0?f.a.verifyLinkedTokenScopes(e,this.googleScopes()):[]},handleUnauthorized:function(e,t){this.isDefaultEmail(e)?this.setSetting(this.Settings.IsEnabled,!1):this.removeSyncAccount(e)},_activate:function(){var e=this.getDefaultAccount();this.hasSyncAccount(e)||this.addSyncAccount(e)},_deactivate:function(){},handleTapStart:function(e,t,a,i){return!0},handleTapClick:function(e,t,a,r){var n=r.target;try{i.default.PAssert(1996,t,"Gmail tapped but is not actually a pane",i.default.getElementPath(n))}catch(e){i.default.reportError(e)}if(t&&!this.isPluginPane(t))return this.openEmailByItem(e,t)},handleDoubleTap:function(e,t,a,i){this.openEmailByItem(e,t)},isMyAccountID:function(e){try{i.default.PAssert(1997,"me"!==e||i.default.isDemoMode(),"Should not be checking me")}catch(e){i.default.reportError(e)}var t=i.default.getUserIdentifier();try{i.default.PAssert(1998,i.default.isDemoMode()||"me"!==t,"Should not be checking against current account until loaded")}catch(e){i.default.reportError(e)}return e===t},createURLForThread:function(e){var t=e.getField("accountID");return"me"===t&&(t=i.default.getUserIdentifier()),"https://mail.google.com/mail/b/"+t+"#all/"+e.id},createPrintURLForThread:function(e){var t=e.getField("accountID");return"me"===t&&(t=i.default.getUserIdentifier()),"https://mail.google.com/mail/b/"+t+"/?ui=2&view=pt&search=all&th="+e.id},openEmailByItem:function(e,t,a){var r=e.getAttachmentByPlugin(PluginID.Gmail);if((r&&r!==b.a.getThreadAttach()||!b.a.isOpenOnPane(this)||a)&&this.getCacheData(r.id))return this.isAttachmentDraftOnly(r)?(this.sendEvent("Tap_DesktopDraft"),this.loadThread(r,function(e){i.default.menus.openComposeEmail(this,r.id)}.bind(this))):b.a.open(e,r,t,a),!0},_convertRawMessage:function(e,t,a,r){var n={id:t,payload:a},s=this._getMessageFromAttachment(e,t);try{i.default.PAssert(1999,s,"Must be able to get message metadata")}catch(e){i.default.reportError(e)}n.labelIds=s.labelIds,n.messageID=s.messageID,n.snippet=s.snippet,n.internalDate=a.internalDate,r(n)},getThreadData:function(e,t,a){if(0!==e.getField("messages").length)return this._getThreadData(e,t,a);this._requestRemoteThreadMetadata(e.getField("accountID"),e.id,void 0,function(i,n){var s=!0;i?this._addRemoteEntry(e.getField("accountID"),i):n&&n.error&&n.error.code===r.a.HTTPStatusCode.NotFound&&(s=!1),s?this._getThreadData(e,t,a):t(!1,"The conversation that you requested no longer exists.")}.bind(this))},_getThreadData:function(e,t,a){var n=e.getField("messages"),s=n.length,o=0,l=!1,d={};function c(){if(o===s&&l){for(var e={messages:[]},a=0,r=0;r<n.length;++r){var c=d[n[r].id];c?e.messages.push(c):++a}try{i.default.PAssert(2e3,e.messages.length+a===n.length,"Messages should always be found for thread")}catch(e){i.default.reportError(e)}0===n.length?t(void 0,"This message is not cached locally and we could not contact the remote server."):t(e)}}for(var u=0;u<n.length;++u){var h=n[u];this.getMessageData(e,h.id,function(e,t){e?d[e.id]=e:i.default.isHTTPStatusCode(t,r.a.HTTPStatusCode.NotFound)&&0,++o,c()}.bind(this),a)}l=!0,setTimeout(c.bind(this),0)},getMessageData:function(e,t,a,i){this._rawCache.getEntry(t,function(i){i?this._convertRawMessage(e,t,i,a):(log("Warning: Local message cache missing email display data: ",e.id,t),this._requestRemoteMessageDataRaw(e.getField("accountID"),e.id,t,a))}.bind(this))},_handleThreadLoaded:function(e,t,a,r){var n=this._pendingThreadLoads[e];try{i.default.PAssert(2001,n,"Must always have a valid pending load when handling laod")}catch(e){i.default.reportError(e)}if(delete this._pendingThreadLoads[e],n)for(var s=0;s<n.length;++s)try{n[s](t,a,r)}catch(e){i.default.reportError(e)}},loadThread:function(e,t){try{i.default.PAssert(2002,0===this._loadThreadMutex,"Should never have an outstanding lock on thread load")}catch(e){i.default.reportError(e)}this._loadThreadMutex++;var a=e.getField("accountID");f.a.isAuthorized(a,GScope.GmailModify)?this._loadThread(e,t,8e3):f.a.onUserAuthorized(a,function(){f.a.isAuthorized(a,GScope.GmailModify)?this._loadThread(e,t,8e3):t(!1,!1,"This thread belongs to an account ("+e.getField("accountID")+") you are not authorized to access.")}.bind(this),8e3),this._loadThreadMutex--},_loadThread:function(e,t,a){var r=this.isAttachmentDraftOnly(e),n=this._pendingThreadLoads[e.id];if(n)log("Duped pending thread load: ",e.id),n.push(t);else if(this._pendingThreadLoads[e.id]=[t],e.getField("dataLoaded")||e.isLocalOnlyAttachment()){for(var s=e.getField("messages"),o=!1,l=!1,d=0,c=0,u=s.length,h=0,f=function(){o&&d===c&&(u===h&&(l=!0),setTimeout(function(){this._handleThreadLoaded(e.id,!0,l)}.bind(this),0))}.bind(this),p=0;p<s.length;++p){var m=s[p];void 0===m.decoded?(m.decoded="",d++,this.getMessageData(e,m.id,function(t){if(c++,t){""===t.decoded&&(t.decoded=void 0);var a=this._parseMailMessage(t);try{i.default.PAssert(2003,a,"Must be able to parse message")}catch(e){i.default.reportError(e)}this._updateMessageData(e,a.id,a),l=!0}f()}.bind(this),a)):(m.decoded||m.labelIds.indexOf(x.DRAFT)>=0)&&h++}o=!0,f()}else if(r){var g=e.getField("messages")[0];this.getMessageData(e,g.id,function(t){if(t){var a=this._parseMailMessage(t);try{i.default.PAssert(2004,a,"Must be able to parse message")}catch(e){i.default.reportError(e)}this._updateMessageData(e,a.id,a)}l=!0,this._handleThreadLoaded(e.id,!0,l)}.bind(this),a)}else this.getThreadData(e,function(t,a){t&&this._parseMailThread(e,t),l=!0,this._handleThreadLoaded(e.id,!!e.getField("dataLoaded"),l,a)}.bind(this),a)},forceReloadMessage:function(e,t,a){this._requestRemoteMessageData(e,t,a)},_verifyEmailAttachments:function(e,t,a){var r,n,s=this._findDraft(e,t,a);return s?s.resources.forEachResource(function(e){e.uploader&&(e.uploader.hasError()?r="There was an error uploading one or more attachments. Please remove them or try uploading again.":e.uploader.isDone()||(r="One or more of your attachments is still uploading.",n=function(e){this.onEmailReadyToSend(s,function(){i.default.toasts.clearMessage(e)})}.bind(this)))}.bind(this)):r="Could not find message to verify attachments.",r?{message:r,handleMessageFn:n}:void 0},_verifyEmailRecipients:function(e,t,a){var r,n=this._findDraft(e,t,a);if(n)if(n.to&&0!==n.to.length)for(var s=0;s<n.to.length;++s){var o=n.to[s];o&&o.email?i.default.isEmail(o.email)||(r="You have entered an invalid email"):r="You have entered a contact with an invalid email address"}else r="You must enter at least one person to send this email to";else r="Unable to find the message you are trying to send";return r?{message:r}:void 0},_formatAddressText:function(e,t,a){return e?a?'"'+i.default.encodeMIMEHeader(e)+'" <'+t+">":'"'+e+'" <'+t+">":t},_createAddressTextFromTokens:function(e,t){var a="";if(e)for(var r=0;r<e.length;++r){var n=e[r];i.default.isEmail(n.email)&&(0!==r&&(a+=", "),a+=this._formatAddressText(n.text,n.email,t))}try{i.default.PAssert(2005,!a.startsWith(","),"Should not start with a comma")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2006,!a.endsWith(","),"Should not end with a comma")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2007,a.indexOf(",,")<0,"Should not have two commas in a row")}catch(e){i.default.reportError(e)}return a.trim()},_createRFC822Message:function(e,t,a,r){try{i.default.PAssert(2008,t,"Must specify a valid draft")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2009,t.contentType,"Must specify a valid content type for the draft")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2010,t.from,"Must be able to get the from information for a user.")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2011,!t.inReplyTo||t.inReplyTo.indexOf("undefined")<0,"Should not have an undefined message id in reply-to: "+t.inReplyTo)}catch(e){i.default.reportError(e)}try{i.default.PAssert(2012,!t.references||t.references.indexOf("undefined")<0,"Should not have an undefined message id in references: "+t.references)}catch(e){i.default.reportError(e)}var n=t.from.text,s=t.from.email,o=new v.a(this);o.updateFromDraft(e,t,n,s,a,function(){var e=o.generateBlob();r(this._encodeEmail(e))}.bind(this))},createSignature:function(e){var t=this.getSignature(e);return t?this.getSetting(this.Settings.InsertSignatureAboveReplies)?'<br/><br/><div class="gmail_signature">'+t+"</div><br/>":'<br/><br/>--<br/><div class="gmail_signature">'+t+"</div>":'<div class="gmail_signature"></div>'},createReplyQuote:function(e){var t;e&&(t='<br>\n<div class="gmail_extra">\n<br>\n<div class="gmail_quote">'+("On "+e.date.toString("MMM dd, y")+" at "+e.date.toString("hh:mm tt")+", "+i.default.escape(this._createAddressTextFromTokens([e.from]))+" wrote:")+'\n<br>\n<blockquote class="gmail_quote" style="margin:0 0 0 0.8ex;border-left:1px #ccc solid;padding-left:1ex">\n'+e.decoded+"\n</blockquote>\n</div>\n<br>\n</div>\n");return t},createForwardQuote:function(e){var t,a=i.default.isArray(e.to)?e.to:[e.to];return e&&(t='<br>\n<div class="gmail_quote">\n<br>\n---------- Forwarded message ----------<br>\nFrom: '+i.default.escape(this._createAddressTextFromTokens([e.from]))+"<br>\nDate: "+e.date.toString("ddd, MMM dd, y")+" at "+e.date.toString("hh:mm tt")+"<br>\nSubject: "+e.subject+"<br>\nTo: "+i.default.escape(this._createAddressTextFromTokens(a))+"\n<br>\n<br>\n"+e.decoded+"\n</div>\n<br>\n"),t},createMessageBody:function(e,t,a){var n,s=this.createSignature(t);if(a===r.a.EmailResponseMode.Reply||a===r.a.EmailResponseMode.ReplyAll)n=this.createReplyQuote(e);else if(a===r.a.EmailResponseMode.Forward)n=this.createForwardQuote(e);else try{i.default.PAssert(2013,!1,"Invalid email response mode: "+a)}catch(e){i.default.reportError(e)}return this.getSetting(this.Settings.InsertSignatureAboveReplies)?s+n:n+s},_sendEmail:function(e,t,a,i){this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t);var r=this._findDraft(e,t,a);this._createRFC822Message(e.getData(),r,!0,function(t){var a=function(t){this._updateLocalDraftFromSend(e,r.id,t,i)}.bind(this),n=function(t){this._notifySendFailed(),i(!1,t),this._notifyFailedRequest(e.getField("accountID"),t)}.bind(this),s={raw:t};e.isLocalOnlyAttachment()||(s.threadId=e.id);var o=l.a.fns("gmail").users.messages.send.packedFn,d={userId:e.getField("accountID"),resource:s};this._queueRemoteRequestMulti(e.getField("accountID"),o,d,a,n,void 0,_.Send)}.bind(this))},_shouldSaveMessageContent:function(e,t){return t.labelIds.indexOf(x.DRAFT)>=0},compactCacheField:function(e,t){var a;switch(t){case"messages":a=[];for(var r=e[t],n=0;n<r.length;++n){for(var s=r[n],o={},l=0;l<N.length;++l)o[N[l]]=s[N[l]];this._shouldSaveMessageContent(e,s)||(delete o.decoded,delete o.mimeType,delete o.contentType,delete o.listUnsubscribe);var d={};o.resources.forEachResource(function(e){var t=i.default.clone(e);delete t.data,delete t.size,delete t.uploader,d[e.id]=t}),o.resources=d,a.push(o)}break;default:a=e[t]}return a},_generateUndoRedo:function(){this._undoStack.registerOwner(this,this.id),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Archive,{undo:this.unarchiveAttachment,redo:this.archiveAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Unarchive,{undo:this.archiveAttachment,redo:this.unarchiveAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Trash,{undo:this.untrashAttachment,redo:this.trashAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Untrash,{undo:this.trashAttachment,redo:this.untrashAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.AddLabel,{undo:this.removeLabelFromAttachment,redo:this.addLabelToAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.RemoveLabel,{undo:this.addLabelToAttachment,redo:this.removeLabelFromAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.MarkRead,{undo:this.markAttachmentUnread,redo:this.markAttachmentRead}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.MarkUnread,{undo:this.markAttachmentRead,redo:this.markAttachmentUnread}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Star,{undo:this.markAttachmentUnstarred,redo:this.markAttachmentStarred}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Unstar,{undo:this.markAttachmentStarred,redo:this.markAttachmentUnstarred}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.SetPriority,{undo:this.setAttachmentPriority,redo:this.setAttachmentPriority}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Move,{undo:this.unmoveItem,redo:this.moveItem}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.Snooze,{undo:this.unsnoozeAttachment,redo:this.snoozeAttachment}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.ScheduleSend,{undo:this.cancelSendMessage,redo:this.scheduleSendMessage}),this._undoStack.registerAction(this.id,r.a.PluginAction.Gmail.DiscardDraft,{undo:i.default.emptyFn,redo:this.runDiscardDraft})},performAction:function(e,t,a,r,n){try{i.default.PAssert(2014,e,"Must supply a valid action")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2015,i.default.isBoolean(t),"Invalid preventUndo param")}catch(e){i.default.reportError(e)}var s;this.beginAction(t);var o=[a,r,n];try{s=this._undoStack.runAction(this.id,e,o)}catch(e){i.default.reportError(e)}if(this._undoStack.isUndoableAction()){var l=[a];i.default.isArray(s)?l.pushArray(s):l.push(s),this._undoStack.performAction(this.id,e,{undoParams:l,redoParams:o})}this.endAction()},performActions:function(e,t){this.beginAction(t);for(var a=0;a<e.length;++a)this.performAction(e[a].action,e[a].attach,e[a].param);this.endAction()},beginAction:function(e){this._undoStack.beginAction(e),o.a.beginAction()},endAction:function(){this._undoStack.endAction(),o.a.endAction()},handleUndo:function(){o.a.beginAction(),this._undoStack.undoAction(),o.a.endAction()},handleRedo:function(){o.a.beginAction(),this._undoStack.redoAction(),o.a.endAction()},supportOfflineCache:function(){return!0},supportOfflineLoad:function(){return!0},usesPreviewCache:function(){return!0},_matchParticipant:function(e,t){var a=!1;return e&&(e.text&&(a=e.text.toLowerCase().indexOf(t)>=0),!a&&e.email&&(a=e.email.toLowerCase().indexOf(t)>=0)),a},_matchLabels:function(e,t){return this.hasLabelLike(e.accountID,e.id,t)},_matchEntry:function(e,t){return e.subjectLower.indexOf(t)>=0||this._matchParticipant(e.from,t)||this._matchLabels(e,t)},matchAttachment:function(e,t){return this._matchEntry(e.getData(),t)},findMatchExact:function(e){},findMatchLike:function(e,t){var a=e.toLowerCase();return this.findCachedItemsByFn(function(e){return this._matchEntry(e,a)}.bind(this),t)},isGmailItem:function(e){return!!e.getAttachmentByPlugin(this.id)},itemHasLabelByID:function(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasLabelByID(a,t)},itemHasLabel:function(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasLabel(a,t)},itemHasFullLabel:function(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasFullLabel(a,t)},itemHasDraft:function(e){return this.itemHasLabelByID(e,x.DRAFT)},isItemUnread:function(e){return this.itemHasLabelByID(e,x.UNREAD)},isItemImportant:function(e){return this.itemHasLabelByID(e,x.IMPORTANT)},isItemStarred:function(e){return this.itemHasLabelByID(e,x.STARRED)},isItemArchived:function(e){var t=e.getAttachmentByPlugin(this.id);return!!t&&this.attachmentIsArchived(t)},isItemTrashed:function(e){return this.itemHasLabelByID(e,x.TRASH)},isItemFullTrashed:function(e){return this.itemHasFullLabel(e,L.TRASH)},isItemSpam:function(e){return this.itemHasLabelByID(e,x.SPAM)},isDisplayItem:function(e,t){var a=!1;return this.isItemSpam(e)||!this.isThreadItem(e)||this.isItemFullTrashed(e)&&!t||(a=!0),a},getItemPriority:function(e){return e.hasPluginAttachment(this.id)?this.getAttachmentPriority(e.getAttachmentByPlugin(this.id)):0},_getCompDateForItem:function(e){var t=0,a=e.getAttachmentByPlugin(this.id);if(a){var i=a.getField("lastModifiedDate");if(i)t=i.getTime();else{var r=a.getField("internalDate");r&&(t=r.getTime())}}return t},_timeCompare:function(e,t){return e>t?1:e<t?-1:0},threadSortFn:function(e,t){return this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))},threadSortPriorityFn:function(e,t){var a=e.getAttachmentByPlugin(this.id),i=t.getAttachmentByPlugin(this.id),r=this.getAttachmentPriority(a),n=this.getAttachmentPriority(i),s=this.attachmentHasLabelByID(a,x.STARRED),o=this.attachmentHasLabelByID(i,x.STARRED);return r>n?-1:r<n?1:s&&!o?-1:o&&!s?1:this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))},labelSortFn:function(e,t){return e.displayCompare(t)},labelVMLISortFn:function(e,t){var a=this._getLabelByID(this._getAccountIDFromItem(e),this._getLabelIDFromItem(e)),i=this._getLabelByID(this._getAccountIDFromItem(t),this._getLabelIDFromItem(t));return this.labelSortFn(a,i)},sortFn:function(e,t){return e.getParsedText().localeCompare(t.getParsedText())},getCssClass:function(e,t){if(t&&t.type===this.getPaneType())return i.default.classNames({starred:this.attachmentHasLabelByID(e,x.STARRED)},{unread:this.attachmentHasLabelByID(e,x.UNREAD)},{p0:this.attachmentHasLabel(e,R.PRI0)},{p1:this.attachmentHasLabel(e,R.PRI1)},{p2:this.attachmentHasLabel(e,R.PRI2)})},getTotalMessageCount:function(e){var t=this._threadCache;t.onCacheReady(function(){t.count(e)})},getSyncdMessageCount:function(e){var t=this._rawCache;t.onCacheReady(function(){t.count(e)})},getUnsyncdMessageCount:function(){return this._numUnsyncdMessages},getSyncdMessageCount:function(){return this._numSyncdMessages},_checkUnsyncdMessageContent:function(e){for(var t=0;t<e.messages.length;++t){var a=e.messages[t];a.cached?(this.reportTrackedStat(A.SyncdMessage),this._numSyncdMessages++):a.cachedError?this.reportTrackedStat(A.ErrorSyncdMessage):this._shouldCacheMessageData(e)?(this.reportTrackedStat(A.UnsyncdMessage),this._notifyUnsyncdMessage(e.accountID,e.id,a.id)):this.reportTrackedStat(A.OldUnsyncdMessage)}},_notifyUnsyncdMessage:function(e,t,a){i.default.isTempId(t)||i.default.isTempId(a)||(this._handleSyncContentCacheOp(this._unsyncdMessages,e,t,a),this._numUnsyncdMessages++,this._contentSyncTask.notifyWorkAvailable())},_notifyContentCached:function(e,t,a){this._numSyncdMessages++,this._handleSyncContentCacheOp(this._pendingSyncdMessages,e,t,a)},_handleSyncContentCacheOp:function(e,t,a,i){var r=this._ensureAccountLib(t,e);r[a]?!0!==r[a]&&r[a].indexOf(i)<0&&r[a].push(i):r[a]=!i||[i]},_removeUnsyncdMessage:function(e,t,a){this.reportTrackedStat(A.MessagesSyncd),this._numUnsyncdMessages--;var r=this._getAccountLib(e,this._unsyncdMessages);if(a){var n=r[t];n.remove(a),0===n.length&&delete r[t]}else delete r[t];i.default.isEmpty(r)&&this._deleteAccountLib(e,this._unsyncdMessages)},_setCachedFieldForMessage:function(e,t,a){if(this.hasCacheData(t))for(var i=this.getAttachment(t).getField("messages"),r=0;r<i.length;++r)(!0===a||a.indexOf(i[r].id)>=0)&&(i[r].cached=!0);this._threadCache.getEntry(t,function(e){if(e){for(var i=0;i<e.messages.length;++i){var r=e.messages[i];(!0===a||a.indexOf(r.id)>=0)&&(r.cached=!0)}this.cacheThreadData(t,e)}}.bind(this))},_updateCachedErrorFieldForMessage:function(e,t,a){if(this.hasCacheData(t))for(var i=this.getAttachment(t).getField("messages"),r=0;r<i.length;++r)(!0===a||a.indexOf(i[r].id)>=0)&&(i[r].cachedError?i[r].cachedError++:i[r].cachedError=1);this._threadCache.getEntry(t,function(e){if(e){for(var i=0;i<e.messages.length;++i){var r=e.messages[i];(!0===a||a.indexOf(r.id)>=0)&&(r.cached?r.cachedError++:r.cachedError=1)}this.cacheThreadData(t,e)}}.bind(this))},_processSyncdContent:function(){for(var e in this._pendingSyncdMessages){var t=this._pendingSyncdMessages[e];for(var a in t){var r=t[a];if(i.default.isArray(r)){for(var n=0;n<r.length;++n){var s=r[n];this._removeUnsyncdMessage(e,a,s)}this._setCachedFieldForMessage(e,a,r)}else!0===r&&this._removeUnsyncdMessage(e,a)}}this._pendingSyncdMessages={}},_processSyncErrors:function(e){for(var t in log("Process Sync Errors: ",e),e){var a=e[t];for(var r in a){var n=a[r];try{i.default.PAssert(2016,i.default.isArray(n),"Must have a valid message ID list")}catch(e){i.default.reportError(e)}for(var s=0;s<n.length;++s){var o=n[s];this._removeUnsyncdMessage(t,r,o)}this._updateCachedErrorFieldForMessage(t,r,n)}}},driveMessageContentSync:function(e){this._rawCache.onCacheReady(function(){if(i.default.vmMain.cacheManager.hasReportedQuotaError())return e(!1);this._outstandingContentSync=!0;this._runMessageContentSync(35,function(t,a){if(!t)try{this._processSyncErrors(a)}catch(e){i.default.reportError(e)}return this._processSyncdContent(),this._outstandingContentSync=!1,e(!i.default.isEmpty(this._unsyncdMessages))}.bind(this))}.bind(this))},_runMessageContentSync:function(e,t){var a=0,i=0,r=!1,n=0,s=0,o={};function l(e,a,l){if(e?n++:(s++,o[a]=l),r&&n+s===i){var d=0===s;t(d,d?void 0:o)}}var d=this.getSyncAccounts();for(var c in this._unsyncdMessages)if(d.indexOf(c)>=0&&(a+=this._syncMessageContentForAccount(c,this._unsyncdMessages[c],e-a,l),i++,a>=e))break;return r=!0,0===a&&setTimeout(function(){t(!0)},0),a},_syncMessageContentForAccount:function(e,t,a,i){var r=0,n=0,s=0,o=0,l={};function d(t,a,r){if(t?s++:(o++,l[a]=r),s+o===n){var d=0===o;i(d,e,d?void 0:l)}}for(var c in t)if(r+=this._syncMessageContentForThread(e,c,t[c],a-r,d),n++,r>=a)break;return!0,r},_syncMessageContentForThread:function(e,t,a,r,n){var s=0;if(i.default.isArray(a)){var o=!1,l=0,d=[];function c(a,i){if(i?(l++,this._notifyContentCached(e,t,a)):d.push(a),o&&l+d.length===s){var r=0===d.length;n(r,t,r?void 0:d)}}for(var u=0;u<a.length&&s<r;++u)this._requestRemoteMessageDataRaw(e,t,a[u],function(a,i,r){i?this._handleContentSyncdMessage(e,t,i,c.bind(this,a)):c.call(this,a,!1)}.bind(this,a[u])),s++;o=!0}else this._requestRemoteThreadDataRaw(e,t,function(a,i){a?this._handleContentSyncdThread(e,a,function(a){this._notifyContentCached(e,t),n(a,t)}.bind(this)):n(!1,t,!0)}.bind(this)),s++;return s},_handleContentSyncdMessage:function(e,t,a,i){a.payload.id=a.id,a.payload.internalDate=a.internalDate,this._rawCache.cacheEntry(a.id,a.payload,i)},_handleContentSyncdThread:function(e,t,a){for(var i=0;i<t.messages.length;++i){var r=t.messages[i];this._handleContentSyncdMessage(e,t.id,r,a)}},scheduleEmail:function(e,t){o.a.beginAction();var a=e.getAttachmentByPlugin(this.id);try{i.default.PAssert(2017,a,"Must be able to get a valid attachment from item")}catch(e){i.default.reportError(e)}var s=a.getField("subject"),l=this.createURLForThread(a),d=r.a.MSPerHour,c=i.default.vmMain.getDefaultCalendarPlugin();if(c){var u=c.getDefaultExportCalendarID();u&&(i.default.isDemoMode()||c.getSetting(c.Settings.WriteAccess))?c.createEventForEmail(u,s,l,t,d,function(e,t,r,s){e||t?t?(this.addLabelToAttachment(a,"Moo.do/Scheduled"),this.getSetting(this.Settings.ArchiveOnSchedule)&&this.archiveAttachment(a)):t||i.default.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:MessageAction.Okay}):i.default.toasts.pushMessage({text:"There was an error adding the email to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){n.a.overQuota?i.default.toasts.pushMessage({text:"You are offline and tour computer's storage quota has been exceeded. Please free up space on your device. Please contact support@moo.do if you have questions.",action:MessageAction.Okay}):i.default.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:MessageAction.Okay})}})}.bind(this)):i.default.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:MessageAction.OpenCalendarSettings})}else i.default.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule emails.",action:MessageAction.OpenSettings});o.a.endAction()},getIconForLabel:function(e){switch(e.getParsedText()){case"Inbox":return"inbox2";case"Starred":return"star";case"Important":return"exclamation";case"Sent Mail":return"send";case"Draft":return"drafts";case"Archived":return"inbox";case"Trash":return"delete";case"Primary":return"user";case"Social":return"group";case"Promotions":return"tag";case"Updates":return"flag";case"Forums":return"question_answer";case"Chat":return"chat";case"Spam":return"warning"}}};s.a.inherit(p.a,I),s.a.extend(I.prototype,le),t.a=I},function(e,t,a){"use strict";var i=a(0);function r(e){this._maxSize=e,this._groups=[],this._groupID=0,this._cursor=-1,this._performingActions=!1,this._actionsPreventUndo=!1,this._aggregateActions=0,this._currentAction=[],this._registeredOwners={},this._registeredActions={}}r.prototype={registerOwner:function(e,t){try{i.default.PAssert(2234,e,"Must supply a valid owner object")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2235,!this._registeredOwners[t],"Must not double define an owner")}catch(e){i.default.reportError(e)}this._registeredOwners[t]=e,this._registeredActions[t]={}},registerAction:function(e,t,a){try{i.default.PAssert(2236,e,"Must provide a valid owner")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2237,t,"Must provide a valid action ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2238,this._registeredOwners[e],"Must have already registered a valid owner")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2239,!this._registeredActions[e][t],"Must not double define an action for an owner")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2240,a,"Must pass in a valid undo/redo descriptor")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2241,i.default.isFunction(a.undo),"Must provide a valid undo fn")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2242,i.default.isFunction(a.redo),"Must provide a valid redo fn")}catch(e){i.default.reportError(e)}this._registeredActions[e][t]=a},_getOwner:function(e){try{i.default.PAssert(2243,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(e){i.default.reportError(e)}return this._registeredOwners[e.ownerID]},_getActionData:function(e){try{i.default.PAssert(2244,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2245,this._registeredActions[e.ownerID][e.actionID],"Must have previously registered action for owner")}catch(e){i.default.reportError(e)}return this._registeredActions[e.ownerID][e.actionID]},_useNextGroupID:function(){return++this._groupID},_getCurrentGroup:function(){return this._groups[this._cursor]},_createGroup:function(e){return{id:this._useNextGroupID(),events:e||[]}},_pushNewGroup:function(e){var t=this._createGroup(e);this._groups.length>this._cursor+1&&(this._groups=this._groups.slice(0,this._cursor+1)),this._groups.push(t),this._cursor<this._maxSize-1&&this._cursor++,this._groups.length>this._maxSize&&this._trimAction()},_trimAction:function(){this._groups.shift()},isUndoableAction:function(){return!this._actionsPreventUndo},beginAction:function(e){if(0===this._aggregateActions){try{i.default.PAssert(2246,0===this._currentAction.length,"Current actions should be flushed")}catch(e){i.default.reportError(e)}this._actionsPreventUndo=!!e}this._aggregateActions++},runAction:function(e,t,a){var i={ownerID:e,actionID:t},r=this._getOwner(i);return this._getActionData(i).redo.apply(r,a)},performAction:function(e,t,a){try{i.default.PAssert(2247,this._aggregateActions>0,"Must be in a begin/end action block")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2248,a,"Must provide valid data for the action")}catch(e){i.default.reportError(e)}this._currentAction.push({ownerID:e,actionID:t,data:a})},performActions:function(e){if(e&&e.length>0){this.beginAction();for(var t=0;t<e.length;++t){var a=e[t];this.performAction(a.ownerID,a.actionID,a.data)}this.endAction()}},endAction:function(){1===this._aggregateActions&&(this._currentAction.length>0&&(this._pushNewGroup(this._currentAction),this._currentAction=[]),this._actionsPreventUndo=!1),this._aggregateActions=Math.max(0,this._aggregateActions-1)},undoAction:function(){if(this._cursor>=0)for(var e=this._groups[this._cursor--],t=e.events.length-1;t>=0;t--){var a=e.events[t],i=this._getOwner(a);this._getActionData(a).undo.apply(i,a.data.undoParams)}},redoAction:function(){if(this._cursor>=-1&&this._cursor<this._groups.length-1)for(var e=this._groups[++this._cursor],t=0;t<e.events.length;++t){var a=e.events[t],i=this._getOwner(a);this._getActionData(a).redo.apply(i,a.data.redoParams)}}},t.a=r},function(e,t,a){"use strict";var i=a(0),r=a(1);function n(e,t,a,n,s,o){try{i.default.PAssert(2249,e,"Must specify a valid account ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2250,t,"Must specify a valid label ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2252,!n||i.default.isDateValid(n),"Must provide a valid oldestSync date")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2253,o,"Must supply a valid label store this label belongs to")}catch(e){i.default.reportError(e)}this._labelStore=o,this._accountID=e,this._labelID=t,this._fullName=a,this._minName=void 0,this._matchName=a?a.toUpperCase():void 0,this._oldestSync=n,this._numUnread=0,this._ancestors=[],this._isDeleted=!(!s||!s.isDeleted),this._labelListVisibility=s&&s.labelListVisibility?s.labelListVisibility:r.a.LabelListVisibility.Show,this._messageListVisibility=s&&s.messageListVisibility?s.messageListVisibility:r.a.MessageListVisibility.Show,this._origLabelID=void 0}var s={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},o={INBOX:100,UNREAD:99,STARRED:98,IMPORTANT:97,SENT:96,DRAFT:95,"==MOODO_ARCHIVED==":94,"==MOODO_ALLMAIL==":93,TRASH:92,CATEGORY_PERSONAL:80,CATEGORY_SOCIAL:79,CATEGORY_PROMOTIONS:78,CATEGORY_UPDATES:77,CATEGORY_FORUMS:76},l={"==MOODO_ARCHIVED==":"Archived","==MOODO_ALLMAIL==":"All Mail"},d={CATEGORY_PERSONAL:!0,CATEGORY_SOCIAL:!0,CATEGORY_PROMOTIONS:!0,CATEGORY_UPDATES:!0,CATEGORY_FORUMS:!0},c={DRAFT:!0,CHAT:!0,SENT:!0,SPAM:!0,"==MOODO_ALLMAIL==":!0};n.prototype={_getDisplayPriority:function(){return o[this.getLabelID()]||-1},displayCompare:function(e){var t=this.isSystemOrSpecialLabel(),a=e.isSystemOrSpecialLabel();return t&&a?this._getDisplayPriority()<e._getDisplayPriority()?1:-1:t?-1:a?1:this.getName().localeCompare(e.getName())},isDropTarget:function(){return!c[this.getLabelID()]},_getStoreLabel:function(e){var t,a=e.toUpperCase();for(var i in this._labelStore){var r=this._labelStore[i].getRawName();if(r&&r.toUpperCase()===a){t=this._labelStore[i];break}}return t},_computeAncestors:function(){try{i.default.PAssert(2254,this._fullName||this.isSystemLabel()||this.isSpecialLabel(),"Must specify a valid fullName to run _computeAncestors")}catch(e){i.default.reportError(e)}if(this._ancestors=[],!this.isSystemLabel()&&!this.isSpecialLabel()&&this._fullName&&this._fullName.indexOf("/")>0){for(var e=this._fullName.split("/"),t="",a=0;a<e.length-1;++a){t+=e[a];var r=this._getStoreLabel(t);r&&r!==this&&this._ancestors.push(r),t+="/"}this._computeMinName()}try{i.default.PAssert(2255,this._ancestors.indexOf(this)<0,"Self should never be in the ancestors list")}catch(e){i.default.reportError(e)}},_computeMinName:function(){for(var e=this.getRawName(),t=0;t<this._ancestors.length;++t){var a=this._ancestors[t].getMinName()+"/",i=e.indexOf(a);e=e.substr(i+a.length)}this._minName=e},getAccountID:function(){return this._accountID},getLabelID:function(){return this._labelID},getRawName:function(){return this._fullName},getMinName:function(){return this._minName?this._minName:this._fullName},getMatchName:function(){return this._matchName},isMatched:function(e){try{i.default.PAssert(2256,i.default.isString(e),"Must pass in a valid string for label name")}catch(e){i.default.reportError(e)}var t=!1,a=this.getMatchName();return e&&a&&a.indexOf(e.toUpperCase())>=0&&(t=!0),t},isNamed:function(e){try{i.default.PAssert(2257,i.default.isString(e),"Must pass in a valid string for label name")}catch(e){i.default.reportError(e)}var t=!1,a=this.getMatchName();return e&&a&&a===e.toUpperCase()&&(t=!0),t},getName:function(e){var t;if(s[this.getLabelID()])t=s[this.getLabelID()];else if(l[this.getLabelID()])t=l[this.getLabelID()];else if(e&&this._minName)t=this.getMinName();else if(this._fullName)t=this._fullName;else{try{i.default.PAssert(2258,!this.isLocalOnly(),"Should not have a local-only label without a name")}catch(e){i.default.reportError(e)}t=this.getLabelID()}return t||""},hasName:function(){return s[this.getLabelID()]||l[this.getLabelID()]||!!this._fullName},clearOldestSync:function(){this._oldestSync=void 0},getOldestSync:function(){return this._oldestSync},setOldestSync:function(e){try{i.default.PAssert(2259,i.default.isDateValid(e),"Must provide a valid oldestSync date")}catch(e){i.default.reportError(e)}this._oldestSync=e},getMessageListVisibility:function(){return this._messageListVisibility},getLabelListVisibility:function(){return this._labelListVisibility},isLocalOnly:function(){return i.default.isTempId(this.getLabelID())},updateLabelID:function(e){try{i.default.PAssert(2261,this.isLocalOnly(),"Should only ever modify local labels")}catch(e){i.default.reportError(e)}this._origLabelID=this.getLabelID(),this._labelID=e},updateLabelName:function(e){this._fullName=e,this._matchName=e.toUpperCase(),this._computeAncestors()},getSaveData:function(){return{id:this.getLabelID(),name:this._fullName,oldestSync:this.getOldestSync(),messageListvisibility:this.getMessageListVisibility(),labelListVisibility:this.getLabelListVisibility(),isDeleted:this._isDeleted}},getDisplayText:function(e){var t;return this.getName()&&(t=this.getName().startsWith("Moo.do/")?this.getName().substr("Moo.do".length+1):this.getName(e)),t},getOutlineText:function(){var e=this.getDisplayText();return e?e.replace(/ /g,"_"):void 0},matchesText:function(e){return this.getDisplayText().toLowerCase().indexOf(e)>=0},hasAncestors:function(){return!!this._fullName&&this.getAncestors().length>0},getAncestors:function(){return this._computeAncestors(),this._ancestors},getParent:function(){var e=this.getAncestors();return e[e.length-1]},isSystemLabel:function(){return!!s[this.getLabelID()]},isSpecialLabel:function(){return!!l[this.getLabelID()]},isSystemOrSpecialLabel:function(){return this.isSystemLabel()||this.isSpecialLabel()},isCategoryLabel:function(){return!!d[this.getLabelID()]},isArchived:function(){return"Archived"===this.getName()},isStarred:function(){return"Starred"===this.getName()},isInbox:function(){return"Inbox"===this.getName()},isDraft:function(){return"Draft"===this.getName()},isTrash:function(){return"Trash"===this.getName()},isCustom:function(){return!this.isSystemLabel()&&!this.isSpecialLabel()},getUnreadCount:function(){return this._numUnread},shouldDisplayInLabelList:function(){var e=!1;return this._isDeleted||(this.getLabelListVisibility()===r.a.LabelListVisibility.Show?e=!0:this.getLabelListVisibility()===r.a.LabelListVisibility.ShowIfUnread&&this.getUnreadCount()>0&&(e=!0)),e},shouldDisplayInMessageList:function(){return this._messageListVisibility===r.a.MessageListVisibility.Show},delete:function(){try{i.default.PAssert(2262,!this.isSystemOrSpecialLabel(),"Should never delete a special or system label")}catch(e){i.default.reportError(e)}this._isDeleted=!0}},t.a=n},function(e,t,a){"use strict";var i=a(0),r=a(47);function n(e){this._plugin=e,this._headers=[],this._mimeTree=void 0}var s=0;n.prototype={reset:function(){this._headers=[],this._mimeTree=void 0},getMessageText:function(e,t){return e.decoded},updateFromDraft:function(e,t,a,n,s,o){var l,d;if(this.reset(),this.addHeader("From",this._plugin._formatAddressText(a,n,!0)),this.addHeader("To",this._plugin._createAddressTextFromTokens(t.to,!0)),t.cc&&this.addHeader("Cc",this._plugin._createAddressTextFromTokens(t.cc,!0)),t.bcc&&this.addHeader("Bcc",this._plugin._createAddressTextFromTokens(t.bcc,!0)),this.addHeader("X-Mailer","Moo.do (https://moo.do)"),this.addHeader("Subject",i.default.encodeMIMEHeader(t.subject||"(no subject)")),t.inReplyTo){this.addHeader("In-Reply-To",t.inReplyTo.trim());var c=e.messages.indexOfWithProperty("messageID",t.inReplyTo);try{i.default.PAssert(2263,c>=0,"Must always be able to find the message being replied to")}catch(e){i.default.reportError(e)}l=e.messages[c]}t.references?d=t.references:l&&(d=(i.default.isTempId(l.messageID)?"":l.messageID)+(l.references?" "+l.references:"")),d&&this.addHeader("References",d.trim());var u,h=r.a.generatePlaintext(this.getMessageText(t,s),{}),f=this._getAttachedResources(t);if(f.length>0&&(u=this.createMimePart("multipart/mixed"),this.addMimePart(u)),h){var p=this.createMimePart("multipart/alternative");this.addMimePart(p,u);var m=this.createMimePart("text/plain",h,"7bit");this.addMimePart(m,p);var g=this._getInlineResources(t);if(g.length>0){var v=this.createMimePart("multipart/related");this.addMimePart(v,p);var y=this.createMimePart("text/html",this.getMessageText(t,s),"7bit");this.addMimePart(y,v);for(var S=0;S<g.length;++S){var E=g[S],P=this.createResourcePart(E);P&&this.addMimePart(P,v)}}else{y=this.createMimePart("text/html",this.getMessageText(t,s),"7bit");this.addMimePart(y,p)}}else{p=this.createMimePart(t.contentType||"text/html",this.getMessageText(t,s),"7bit");this.addMimePart(p,u)}if(u&&s){var b=0,C=function(){if(++b===f.length){for(var e=0;e<f.length;++e){var t=f[e],a=this.createResourcePart(t);a&&this.addMimePart(a,u)}o()}}.bind(this);for(S=0;S<f.length;++S)this._plugin.loadResource(e.id,t.id,f[S].cid,C)}else setTimeout(o,0)},_getInlineResources:function(e){var t=[];return e.resources.forEachResource(function(e){"inline"===e.disposition&&t.push(e)}),t},_getAttachedResources:function(e){var t=[];return e.resources.forEachResource(function(e){"attachment"===e.disposition&&e.id&&t.push(e)}),t},addHeader:function(e,t){try{i.default.PAssert(2264,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(e){i.default.reportError(e)}var a=t.trim().replace(/[\r\n]/g,"");this._headers.push(e+": "+a)},_generateBoundary:function(){return"=========3141592653589moodo"+Date.now()+ ++s},createMimePart:function(e,t,a,r){try{i.default.PAssert(2265,e,"Must supply a valid content type")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2266,void 0===t||a,"Must supply a valid content encoding")}catch(e){i.default.reportError(e)}return{boundary:this._generateBoundary(),contentType:e,content:t,contentEncoding:a,contentDisposition:r,children:[]}},createResourcePart:function(e){try{i.default.PAssert(2267,e&&e.data,"Must have valid data loaded for resource to embed it in message")}catch(e){i.default.reportError(e)}var t;if(e&&e.data){var a=e.mimeType+'; name="'+e.cid+'"',r=e.disposition+'; filename="'+e.cid+'"';(t=this.createMimePart(a,e.data,e.contentEncoding,r)).contentID=e.cid}return t},addMimePart:function(e,t){try{i.default.PAssert(2268,e,"Must supply a valid mime part")}catch(e){i.default.reportError(e)}if(t)t.children.push(e);else{try{i.default.PAssert(2269,!this._mimeTree,"Must not yet have a valid mime tree root")}catch(e){i.default.reportError(e)}this._mimeTree=e}},_mimePartToBlob:function(e){var t="\r\n",a=[];function r(e,t){if(t){try{i.default.PAssert(2270,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(e){i.default.reportError(e)}var r=t.trim().replace(/[\r\n]/g,"");a.push(e+": "+r)}}var n=e.contentType;(e.content||(n+='; boundary="'+e.boundary+'"'),r("MIME-Version","1.0"),r("Content-Type",n),r("Content-Transfer-Encoding",e.contentEncoding),r("Content-Disposition",e.contentDisposition),e.contentID)&&r("Content-ID","<"+e.contentID+">");if(t=a.join("\r\n").trim(),t+="\r\n",e.content)t+="\r\n"+e.content+"\r\n";else if(e.children&&e.children.length>0){for(var s=0;s<e.children.length;++s)t+="\r\n--"+e.boundary+"\r\n",t+=this._mimePartToBlob(e.children[s]);t+="--"+e.boundary+"--\r\n"}else t+="\r\n(no text)\r\n";return t},generateBlob:function(){var e=this._headers.join("\r\n").trim();return e+="\r\n"+this._mimePartToBlob(this._mimeTree)}},t.a=n},function(e,t,a){"use strict";var i=a(0),r=(a(7),a(1)),n=a(4),s=a(5),o=(a(10),a(9)),l=a(11),d=a(27),c=a(13),u=a(43),h=a(14),f=a(28),p=a(29),m=a(36),g=a(20);a(37);function v(e){this.isInitializing=!0,this.plugin=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail),this._lines=[{text:" ",start:0,length:1,width:0}],this.searchFilters=[{name:"unread",initialValue:1,icon:"icon-drafts",tooltip:"unread emails",remoteStringFn:this._remoteFnEmailUnread.bind(this),matchFn:this._matchFnEmailUnread.bind(this)},{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred emails",remoteStringFn:this._remoteFnStarred.bind(this),matchFn:this._matchFnStarred.bind(this)},{name:"priority",remoteStringFn:this._remoteFnPriority.bind(this),matchFn:this._matchFnPriority.bind(this)},{name:"category",remoteStringFn:this._remoteFnCategory.bind(this),matchFn:this._matchFnCategory.bind(this)}],this.type=this.plugin._paneType,this.title="Email",this.paneClass="panePlugin paneGmail",this.contextMenuMode=r.a.ContextMenuMode.Gmail,this.paneEmptyMessage="No emails here",this.paneEmptySearchMessageDefault="Press enter to search",this.paneEmptySearchMessage=this.paneEmptySearchMessageDefault,this.titleContextMenuHeader="Open label",this.overviewEmptyMessage="No labels",this.dropEffect=function(){return r.a.DropEffect.Copy},this.isWriteable=!1,this.overrideCopyBehavior=!1,this.supportCollapsing=!1,this.supportCompleting=!0,this.supportCheckbox=!0,this.supportOffline=!1,this.supportPerformArchive=!1,this.supportDataRefresh=!0,this.supportReportError=!0,this.supportCompose=!0,this.supportPagination=!0,this.supportVertLines=!1,this.supportSearchItemAutocomplete=!1,this.supportSearchListenTextChanges=!1,this.supportSearchFlat=!1,this.supportLocalSearch=!1,this.supportClone=!1,this.supportDeferredItemLoad=!0,this.supportCellTransition=!1,this.useLineCache=!1,this.shouldSearchMatchParents=!1,this.noOverviewStyle=!0,this.supportStarClick=!0,this.supportClickOverviewScroll=!1,this.shouldUpdateOnTextChanged=!1,this.overviewTracksScroll=!1,this.overviewHasPaneItems=!1,this.overviewPadLevels=-1,this.showRootOnRow2=!0,this.maxWidth=r.a.ExpandedPaneWidth,this._topBoxHeight=0,this._super.constructor.call(this,e),this.dragMarginTop=25,this.blocks=[],this.blocksByKey={},this._focusedTrash=!1,this.shouldCheckHeight=!0,this.maxScrollOffset=0,this.selectedIndex=new o.a(-1,this.onSelectedIndexChanged.bind(this)),this._isSearchingRemote=new o.a(!1),this._overviewAccount=new o.a,this._currentSearch=void 0,this._ignoreRestoreScroll=!0,this._failedPageRequest=new o.a(!1),this.viewState=new o.a(e.viewState||{viewMode:r.a.GmailViewMode.Date}),this.item.listen(this._onItemChange.bind(this)),this.viewState.listen(this._onViewStateChange.bind(this)),s.a.forceBind("onScroll",this),s.a.forceBind("_runRemoteSearch",this),s.a.forceBind("searchCompare",this),s.a.forceBind("onTopTextChanged",this),s.a.forceBind("headerSearchCompare",this),s.a.forceBind("onMultiselectReset",this),s.a.forceBind("changeView",this),s.a.forceBind("openViewMenu",this),this.initGmail(),this._firstSelectedItem=void 0,e.isExpanded&&(f.a.startOpenOnLoad(this),this._firstSelectedItem=e.selectedItem),this.isInitializing=void 0}var y={initGmail:function(){m.a.listen("reset",this.onMultiselectReset),this.search.isSearched()&&this.onSearchChanged(!0),this._onItemChange(this.getItem()),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0,this.paneTopText.listen(this.onTopTextChanged),l.a.listen("EmailCompose","onClosed",s.a.forceBind("onEmailComposeClosed",this)),l.a.listen("EmailPreview","onClosed",s.a.forceBind("onEmailPreviewClosed",this))},destroy:function(){clearTimeout(this._searchTimeout),this._searchTimeout=void 0,this.paneTopText.unlisten(this.onTopTextChanged),l.a.unlisten("EmailCompose","onClosed",this.onEmailComposeClosed),l.a.unlisten("EmailPreview","onClosed",this.onEmailPreviewClosed),m.a.unlisten("reset",this.onMultiselectReset),this._super.destroy.call(this)},onLoad:function(e){this._super.onLoad.call(this,e),this.addScrollListener(this.onScroll)},notifyPluginLoaded:function(){var e=this.deferredItemState;if(e){var t=this.getItemStore().getItem(e.itemID);t&&this.setItem(t,!0)}},getItemStore:function(){return this.plugin.getActiveItemStore(this.id)},getRootItem:function(){var e=this.getItemStore();return e?e.getRoot():void 0},getDefaultDisplayItem:function(e){return this.plugin.getDefaultDisplayItem(e)},searchCompare:function(e){var t=!1;return i.default.vmMain.isOnline()?(!this.isSearched()||!this.isLoading.get()&&this.paneTopText.get()||this.isRemoteSearchActive())&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0):this.search.isMatched(e,!1)&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0),t},runItemSearch:function(e){try{i.default.PAssert(2415,e,"Must supply a valid param set for local item search")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2416,e.item,"Gmail pane always expects a valid item when running local item search")}catch(e){i.default.reportError(e)}return e.item.belongsToItemStore(this.plugin.getDefaultItemStore())?this.plugin.runLocalItemSearch(e):this._super.runItemSearch.call(this,e)},getItemSearchParams:function(){var e=this.plugin.getLabelForVMLI(this.getItem());return this._focusedTrash=e&&e.isTrash(),{item:this.getItem(),comparator:this.searchCompare,pane:this}},setOverviewAccount:function(e){this._overviewAccount.set(e),this.updateHeaders(!0)},headerSearchCompare:function(e){if(this.plugin.isLabelItem(e)){var t=this.plugin.getLabelForVMLI(e);return!t||t.shouldDisplayInLabelList()}return!!this.plugin.isAccountItem(e)},getHeaderSearchParams:function(){return{item:this.plugin.getDefaultItemStore().getRoot(),comparator:this.headerSearchCompare,noCollapsed:!0,collapseAfterDepth:this.plugin.numSyncAccounts()>1?1:NaN,overview:!0,pane:this}},saveSelection:function(){return m.a.getSelectedItems(this)},restoreSelection:function(e){if(e.length>0){for(var t=[],a=0;a<e.length;a++){(i=this.indexOfItem(e[a]))>=0&&t.push(i)}if(t.length>1)this.selectedIndex.set(t[0],!1),m.a.setSelected(t,this);else if(1===t.length)this.selectIndex(t[0]);else{var i;(i=this.selectedIndex.get())>=this.numItems()&&(i=this.numItems()-1),this.selectIndex(i,!0)}}},_setItems:function(e,t){for(var a,i=this.saveSelection(),n=[],s={},o=this.getViewMode()===r.a.GmailViewMode.Date?this.plugin.threadSortFn:this.plugin.threadSortPriorityFn,l=0;l<e.length;++l){var d=e[l],c=this.plugin._getThreadIDFromItem(d);c&&!s[c]&&(n.insertSorted(d,o),this._firstSelectedItem&&d.id===this._firstSelectedItem&&(a=d),s[c]=!0)}if(this.updateOutline(n),this.restoreSelection(i),a&&e.length>0){var u=this.indexOfItem(a);u>=0&&(this.selectIndex(u),requestAnimationFrame(function(){this.setScrollOffset(this.getScrollTop(),ScrollDuration.Snap)}.bind(this))),this._firstSelectedItem=void 0}},setHeaders:function(e,t){if(!this._overviewAccount.get()){var a=this.plugin.getDescriptorForItem(this.getItem());this._overviewAccount.set(a.accountID)}this._allHeaders=e;for(var r=[],n={},s={},o=0;o<this._allHeaders.length;++o){var l,d=this._allHeaders[o];if(n[l=this.plugin._getAccountIDFromItem(d)]||(n[l]=[]),this.plugin.isAccountItem(d))s[l]=d;else{var c=n[l];this.plugin.isDisplayHeader(d)&&c.insertSorted(d,this.plugin.labelVMLISortFn)}}var u=n[this._overviewAccount.get()];if(u){var h=s[l];try{i.default.PAssert(2417,h,"Must have valid account item")}catch(e){i.default.reportError(e)}if(h)for(o=0;o<u.length;++o){if(o>0){var f=this.plugin.getLabelForVMLI(u[o-1]),p=this.plugin.getLabelForVMLI(u[o]);(f.isSystemOrSpecialLabel()&&!p.isSystemOrSpecialLabel()||!f.isCategoryLabel()&&p.isCategoryLabel())&&r.push({type:"hr",id:"hr"+l+o,sizeInPane:this.heightOverviewHR})}r.push(u[o])}}this.headers.set(r)},heightOverviewHR:function(){return 4},getTitleList:function(){if(this.getItem().isDescendantOf(this.getRootItem())){var e=this.plugin.getDescriptorForItem(this.getItem()),t=this.plugin.getVMLIForAccount(e.accountID);return t===this.getItem()?[this.getItem(),"Everything"]:this.plugin.numSyncAccounts()>1?[t,this.getItem()]:[this.getItem()]}return[this.getItem()]},onClickTitle:function(e){this.plugin.isAccountItem(e)?e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(e)):e===this.getRootItem()?e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(this.getItem())):this.plugin.isLabelItem(e)||(e=this.plugin.getDefaultDisplayItem()),this._super.onClickTitle.call(this,e)},onTopTextChanged:function(){this.topBoxHeight.set(this.paneTopText.get()?36:0)},searchACName:function(){},getPaneIcon:function(){return this.plugin.getPaneIcon()},requestDataPage:function(e){this.isLoadingNewPage.set(!0),this.plugin.requestDataPage(e,this.onDataPagedIn.bind(this))},dropEffectCopyBehavior:function(e,t){try{i.default.PAssert(2418,!e.belongsToSameItemStore(t),"Dropping onto a Gmail pane is not supported")}catch(e){i.default.reportError(e)}return this.plugin.createOutlinePaneItem(e,t)},refreshPaneData:function(){this.plugin.refreshCurrentView(this.id)},reportPaneError:function(){i.default.menus.openModalNew(Modals.ReportBug)},_onItemChange:function(e){m.a.reset(this),this._clearCurrentSearch();var t=this.plugin.getLabelForVMLI(e);this._focusedTrash=t&&t.isTrash(),e.hasPaginationToken()||this.plugin.handleItemChange(e,function(){this.isLoading.set(!1)}.bind(this))},_onViewStateChange:function(){m.a.reset(this),this.plugin.handleViewModeChange(this.getItem(),this.getViewMode()),this.updateItemsImmediate(!0,void 0,void 0,!0),i.default.vmMain.paneManager.updatePaneStateForPane(this),this.setScrollOffset(0)},getItemLabel:function(e){var t=e?this.getActualPaneItem():this.getItem();return this.plugin.getLabelForVMLI(t)},onDataPagedIn:function(e){e?this._failedPageRequest.set(!1):this._failedPageRequest.set(!0),this.isLoadingNewPage.set(!1)},onScroll:function(){if(!this.isLoadingNewPage.get()&&!this.isSearched()){var e=this._infiniteList.getMaxScrollOffset();this.getScrollOffset()>=e&&this.requestDataPage(this.getItem())}},_matchFnEmailUnread:function(e,t){var a=this.plugin.isItemUnread(t);if(e)return a&&e>0||!a&&e<0?r.a.MatchState.Yes:r.a.MatchState.No},_matchFnStarred:function(e,t){var a=this.plugin.isItemStarred(t);if(e)return a&&e>0||!a&&e<0?r.a.MatchState.Yes:r.a.MatchState.No},_matchFnPriority:function(e,t){return this.plugin.getItemPriority(t)>=e?r.a.MatchState.Yes:r.a.MatchState.No},_matchFnCategory:function(e,t){return e?this.plugin.itemHasLabel(t,e)?r.a.MatchState.Yes:r.a.MatchState.No:r.a.MatchState.Yes},_remoteFnEmailUnread:function(e){var t;switch(e){case-1:t="-in:trash -is:unread";break;case 1:t="-in:trash is:unread";break;default:t=""}return t},_remoteFnStarred:function(e){var t;switch(e){case-1:t="-is:starred";break;case 1:t="is:starred";break;default:t=""}return t},_remoteFnPriority:function(e){var t;switch(e){case VMLIFlag.P0:t="label:Moo.do/Priority High";break;case VMLIFlag.P1:t="label:Moo.do/Priority Medium";break;case VMLIFlag.P2:t="label:Moo.do/Priority Low";break;default:t=""}return t},_remoteFnCategory:function(e){return e?"category:"+e:""},handleStatusClick:function(){var e=this.plugin._getAccountIDFromItem(this.getItem());(h.a.getAccountError(e)&&h.a._hasLinkedAccount(e)||h.a.verifyLinkedTokenScopes(e,[GScope.GmailModify]).length>0)&&(h.a.isDefaultEmail(e)?i.default.menus.openSettings(r.a.SettingsSections.Plugins):i.default.menus.openSettings(r.a.SettingsSections.Linked))},_getLoadingMessage:function(){var e,t=this.plugin._getAccountIDFromItem(this.getItem());h.a.isAuthorized(t,GScope.GmailModify)?e="Loading...":e=h.a.getAccountError(t)&&h.a._hasLinkedAccount(t)||h.a.verifyLinkedTokenScopes(t,[GScope.GmailModify]).length>0?"Error Authorizing. Click here to fix.":"Authorizing...";return e},bottomListMessage:function(){var e;return this.getItem().hasPaginationToken()&&(e=this._failedPageRequest.get()?"RETRY LOAD":this.isLoadingNewPage.get()||this.getItem().paginationTokenInUse()?"Loading...":"Click to load more emails"),e},_onRemoteDataLoaded:function(){},sizeOfItem:function(e,t,a){return"blockHeader"===e.type?40:a?this._super.sizeOfItem.call(this,e,t,a):a?d.a.lineItemHeight(e,this,1):r.a.EmailItemHeight},onClickItem:function(e,t,a){i.default.vmMain.activeInput.get()&&i.default.vmMain.activeInput.get().blur();var r=!0;if((n.a.mac&&a.metaKey||!n.a.mac&&a.ctrlKey)&&m.a.getSelected(this).length>0)m.a.toggleSelected(e,this),r=!1;else if(a.shiftKey){var s=m.a.getFirstSelectedIndex(this),o=m.a.getLastSelectedIndex(this);e<s?s=e:e>o&&(o=e),m.a.selectInOrder(s,o,this),r=!1}else if(i.default.hasClass(a.target,"emailLabel")){var l=a.target.textContent,d=t.getAttachmentByPlugin(this.plugin.id).getField("accountID"),c=this.plugin._getLabelByName(d,l);try{i.default.PAssert(2419,c,"Must be able to get a valid label if clicking a valid label: ",l)}catch(e){i.default.reportError(e)}if(c){var u=this.plugin.getVMLIForLabel(d,c);i.default.vmMain.zoomin(u),r=!1}}else i.default.hasClass(a.target,"itemCheckbox")||this.selectIndex(e);r&&t.onClick(e,a)},onRightClickItem:function(e,t,a){(m.a.numSelectedInPane(this)<=1||!m.a.isSelected(e,this))&&this.selectIndex(e),this._super.onRightClickItem.call(this,e,t,a),a.preventDefault(),a.stopPropagation()},handleLeftSideTap:function(e,t){this.toggleStar(e)},handleRightSideTap:function(e,t){if(e&&e.hasPluginAttachment(this.plugin.id)){var a=this.getItemLabel(!0),r=!a.isArchived();this.archiveItem(r,e),a.isInbox()||a.isArchived()||this.removeItemFromCurrentLabel(e);var n=this.selectedIndex.get();n>=this.numItems()&&(n=this.numItems()-1),this.selectIndex(n,!0),i.default.vmMain.redoLastMouseMove()}},onMultiselectReset:function(e){this===e&&this.selectedIndex.set(-1)},selectIndex:function(e,t){var a=this.selectedIndex.get();this.selectedIndex.set(e,t),e>=0?m.a.setSelected([e],this):m.a.reset(this),(t||a!==e)&&this.selectedIndex.notify(),this.isLoading.get()||i.default.vmMain.paneManager.updatePaneStateForPane(this)},selectItem:function(e,t){if(e){var a=this.indexOfItem(e);a>=0&&this.selectIndex(a,t)}else this.selectIndex(-1,t)},onSelectedIndexChanged:function(e){if(f.a.isOpenOnPane(this))if(e>=0){var t=this.itemAtIndex(e);this.openEmailByItem(t)}else e<0&&f.a.reset()},_runRemoteSearch:function(){if(i.default.vmMain.paneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var e=this.search.getRemoteValue(),t=this.plugin.getDescriptorForItem(this.item.get());if(t.labelID){var a=this.plugin._getLabelByID(t.accountID,t.labelID);a.isSpecialLabel()||a.isInbox()||!a.hasName()||(e+=" label:"+a.getName())}this._lastSearchValue=e,this._lastSearchTime=Date.now(),this.paneEmptySearchMessage="",this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._clearCurrentSearch();var r="R~"+this.getActualPaneItem().id+"~"+i.default.generateTempId();log("Gmail Remote Search ItemID: ",r),this._currentSearch=this.plugin.runSearch(e,this.id,r,!0,function(e){if(!this._destroyed&&this._isSearchingRemote.get())switch(this.paneEmptySearchMessage=e===SearchResultStatus.Done?this.paneEmptySearchMessageDefault:"",this.isLoading.set(!1),e){case SearchResultStatus.Done:this.paneTopText.set(""),this.setScrollOffset(0);break;case SearchResultStatus.TooMany:this.paneTopText.set("Too many search results! Be more specific.");break;case SearchResultStatus.None:this.paneTopText.set("There were no search results");break;case SearchResultStatus.Error:this.paneTopText.set("There was an error running your search, try again.");break;default:try{i.default.PAssert(2420,!1,"Invalid search state: ",e)}catch(e){i.default.reportError(e)}}}.bind(this))}},_clearCurrentSearch:function(){this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0)},onSearchChanged:function(e){var t=this.search.getRemoteValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var a=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch,a)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this._clearCurrentSearch(),this.isLoading.set(!1),this.paneTopText.set("")},isSearchingRemote:function(){return this._isSearchingRemote.get()},isRemoteSearchActive:function(){return this.plugin.isRemoteSearchBucketActive(this.id)},onEmailComposeClosed:function(){var e=this.plugin,t=e.getDefaultAccount(),a=e._getLabelByID(t,e.SystemLabels.DRAFT),i=e.getVMLIForLabel(t,a);this.item.get()===i&&this.selectIndex(-1)},onEmailPreviewClosed:function(){0},applyToSelection:function(e){var t=this.saveSelection();m.a.applyFnToSelected(e,this),this.restoreSelection(t)},_autocompletePopup:function(e,t,a){if(!e.elementDisplay){var i=m.a.getFirstSelectedIndex(this),r=this.elementAtIndex(i);e.elementDisplay=r}e.onSelected=function(i){this.plugin.beginAction(),e.item?t(e.item,i):m.a.applyFnToSelected(function(e){t(e,i)},this),a&&a(),this.plugin.endAction()}.bind(this),p.a.showPopup(e)},getPaddingForPaneObject:function(e,t){return t?this._super.getPaddingForPaneObject.call(this,e,t):24},getWidth:function(){return this.rect.get().width},getFirstSelectedItem:function(){return m.a.getFirstSelectedItem()},getFirstSelectedIndex:function(){return m.a.getFirstSelectedIndex()},moveItem:function(e,t,a){this.plugin.beginAction(),a||(e=e.clone(t,ChangeType.Local));var n=e.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(2422,n,"Must be able to get a valid attachment")}catch(e){i.default.reportError(e)}this.plugin.performAction(r.a.PluginAction.Gmail.Move,!1,n,e,t),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(r.a.PluginAction.Gmail.Archive,!1,n),this.plugin.attachmentHasLabel(n,"Moo.do/Handled")||this.plugin.performAction(r.a.PluginAction.Gmail.AddLabel,!1,n,"Moo.do/Handled"),this.plugin.endAction()},autocompleteSchedule:function(e,t){var a=this.selectedIndex.get();this._super.autocompleteSchedule.call(this,e,function(){a>=this.numItems()&&(a=this.numItems()-1),this.selectIndex(a,!0),t&&t()}.bind(this))},autocompleteSnooze:function(e,t,a){var i=this.selectedIndex.get();this._super.autocompleteSnooze.call(this,e,t,function(){i>=this.numItems()&&(i=this.numItems()-1),this.selectIndex(i,!0),a&&a()}.bind(this))},autocompleteMove:function(e,t){e=e||{};var a=this.selectedIndex.get();e.positionOffset={left:40},this._super.autocompleteMove.call(this,e,function(){a>=this.numItems()&&(a=this.numItems()-1),this.selectIndex(a,!0),t&&t()}.bind(this))},autocompleteCreateTask:function(){var e=this,t=this.selectedIndex.get();if(!isNaN(t)){var a=this.elementAtIndex(t),n=m.a.getSelectedItems(this);i.default.menus.openItemEditor({element:a,pane:this,selectIndex:0,addOnSave:!0,side:"bottom",children:n,positionOffset:{left:10},options:[{text:"Archive email",value:i.default.vmMain.pluginManager.getSetting(PluginID.Gmail,PluginSettingsID.Gmail.ArchiveOnOrganize),cb:function(){for(var t=0;t<n.length;t++){var a=n[t].getAttachmentByPlugin(e.plugin.id);e.plugin.performAction(r.a.PluginAction.Gmail.Archive,!1,a)}}}],beginSave:function(){i.default.vmMain.beginUpdateItems(),e.plugin.beginAction();for(var t=0;t<n.length;t++){var a=n[t].getAttachmentByPlugin(e.plugin.id);e.plugin.attachmentHasLabel(a,"Moo.do/Handled")||e.plugin.performAction(r.a.PluginAction.Gmail.AddLabel,!1,a,"Moo.do/Handled")}},endSave:function(t){e.plugin.endAction(),i.default.vmMain.commitUpdateItems()}})}},toggleStarSelected:function(){this._super.toggleStarSelected.call(this),this.updateItems()},toggleStar:function(e){var t=e.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(2423,t,"Must be able to get a valid attachment")}catch(e){i.default.reportError(e)}var a=t.getPlugin();a.isItemStarred(e)?a.performAction(r.a.PluginAction.Gmail.Unstar,!1,t):a.performAction(r.a.PluginAction.Gmail.Star,!1,t),this.updateItems()},_openSelectedInMode:function(e){var t=m.a.getFirstSelectedIndex(this);this.selectIndex(t);var a=this.itemAtIndex(t);this.openEmailByItem(a,e)},replySelected:function(){this._openSelectedInMode(r.a.EmailResponseMode.Reply)},replyAllSelected:function(){this._openSelectedInMode(r.a.EmailResponseMode.ReplyAll)},forwardSelected:function(){this._openSelectedInMode(r.a.EmailResponseMode.Forward)},archiveSelected:function(e){this.plugin.beginAction(),this.applyToSelection(this.archiveItem.bind(this,e)),this.plugin.endAction()},archiveItem:function(e,t){var a=t.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(2424,a,"Must be able to get a valid attachment")}catch(e){i.default.reportError(e)}!e&&this.plugin.isItemArchived(t)?this.plugin.performAction(r.a.PluginAction.Gmail.Unarchive,!1,a):e&&!this.plugin.isItemArchived(t)&&this.plugin.performAction(r.a.PluginAction.Gmail.Archive,!1,a)},deleteSelected:function(e,t){this.plugin.beginAction(),this.applyToSelection(this._deleteItem.bind(this,t)),this.plugin.endAction()},_deleteItem:function(e,t){var a=t.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(2425,a,"Must be able to get a valid attachment")}catch(e){i.default.reportError(e)}var n=this.plugin.getLabelForVMLI(this.getItem());e&&n&&n.isDraft()&&this.plugin.itemHasDraft(t)?this.plugin.performAction(r.a.PluginAction.Gmail.DiscardDraft,!0,a):!e&&this.plugin.isItemFullTrashed(t)?this.plugin.performAction(r.a.PluginAction.Gmail.Untrash,!1,a):e&&!this.plugin.isItemFullTrashed(t)&&this.plugin.performAction(r.a.PluginAction.Gmail.Trash,!1,a)},applyPriorityToSelection:function(e,t){var a=e,n=!0;this.plugin.beginAction(),this.applyToSelection(function(s){var o=s.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(2426,o,"Must be able to get a valid attachment")}catch(e){i.default.reportError(e)}t&&n&&(this.plugin.getAttachmentPriority(o)===e&&(a=VMLIFlag.None),n=!1),this.plugin.performAction(r.a.PluginAction.Gmail.SetPriority,!1,o,a),this.updateItems()}.bind(this)),this.plugin.endAction()},handleUndo:function(){this.plugin.handleUndo()},handleRedo:function(){this.plugin.handleRedo()},keyMoveDown:function(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(m.a.isInverted(this)&&1===m.a.numSelectedInPane(this)&&m.a.setInverted(!1,this),m.a.isInverted(this)?(t=m.a.getFirstSelectedIndex(this),m.a.removeSelected(t,this)):(t=this.indexOfNextVMLI(m.a.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(m.a.addSelected(t,this),this.scrollIndexIntoView(t,ScrollDuration.Default))):(t=this.indexOfNextVMLI(m.a.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(this.selectIndex(t),this.scrollIndexIntoView(t,ScrollDuration.Default))},keyMoveUp:function(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(m.a.isInverted(this)||1!==m.a.numSelectedInPane(this)||m.a.setInverted(!0,this),m.a.isInverted(this)?(t=this.indexOfPrevVMLI(m.a.getFirstSelectedIndex(this)))>=0&&(m.a.addSelected(t,this),this.scrollIndexIntoView(t,ScrollDuration.Default)):(t=m.a.getLastSelectedIndex(this),m.a.removeSelected(t,this))):(t=this.indexOfPrevVMLI(m.a.getFirstSelectedIndex(this)))>=0&&(this.selectIndex(t),this.scrollIndexIntoView(t,ScrollDuration.Default))},keydown:function(e){var t=!e.metaKey&&!e.ctrlKey&&!e.altKey;if(!t||e.normCode!==KeyCode.DownArrow&&e.normCode!==KeyCode.J)if(!t||e.normCode!==KeyCode.UpArrow&&e.normCode!==KeyCode.K){if(this.selectedIndex.get()>=0&&!i.default.menus.isContextMenuOpen()){if(n=this.itemAtIndex(this.selectedIndex.get())){var a=t;switch(e.normCode){case KeyCode.Enter:f.a.isOpenOnPane(this)||this.openEmailByItem(n);break;case KeyCode.Slash:case KeyCode.E:if(t){e.shiftKey&&f.a.isOpenOnPane(this)&&f.a.close();var r=!this.getItemLabel(!0).isArchived();this.archiveSelected(r)}break;case KeyCode.BackSpace:case KeyCode.Delete:this.deleteSelected(this.plugin.isGmailItem,!0);break;case KeyCode.C:t&&this.autocompleteSchedule();break;case KeyCode.D:t&&this.autocompleteSnooze();break;case KeyCode.M:case KeyCode.V:t&&this.autocompleteMove();break;case KeyCode.T:t&&this.autocompleteCreateTask();break;case KeyCode.L:this.autocompleteLabel({item:n});break;case KeyCode.I:t&&this.markReadSelected(!0);break;case KeyCode.U:t&&this.markReadSelected(!1);break;case KeyCode.D8:case KeyCode.S:t&&this.toggleStarSelected();break;case KeyCode.R:t&&(e.shiftKey?this.replyAllSelected():this.replySelected());break;case KeyCode.A:t&&this.replyAllSelected();break;case KeyCode.F:t&&this.forwardSelected();break;case KeyCode.D1:this.applyPriorityToSelection(VMLIFlag.P0,!0);break;case KeyCode.D2:this.applyPriorityToSelection(VMLIFlag.P1,!0);break;case KeyCode.D3:e.shiftKey?this.deleteSelected(this.plugin.isGmailItem,!0):this.applyPriorityToSelection(VMLIFlag.P2,!0);break;case KeyCode.Y:this.search.isSearched()||(this.plugin.beginAction(),this.applyToSelection(this.removeItemFromCurrentLabel.bind(this)),this.plugin.endAction());break;case KeyCode.Z:this.handleUndo();break;case KeyCode.P:if(1===m.a.numSelectedInPane(this)){var n=m.a.getFirstSelectedItem(this),s=this.plugin.createPrintURLForThread(n.getAttachmentByPlugin(this.plugin.id));i.default.printPage(s)}break;case KeyCode.G:if(1===m.a.numSelectedInPane(this)){n=m.a.getFirstSelectedItem(this);var o=this.plugin.createURLForThread(n.getAttachmentByPlugin(this.plugin.id));i.default.openUrl(o)}break;default:a=!1}a&&e.preventDefault()}}}else this.keyMoveUp(e),e.preventDefault();else this.keyMoveDown(e),e.preventDefault()},removeItemFromCurrentLabel:function(e){var t=this.getItemLabel(!0);try{i.default.PAssert(2427,t,"Must be able to find a valid label for pane")}catch(e){i.default.reportError(e)}var a=e.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(2428,a,"Must be able to get a valid attachment")}catch(e){i.default.reportError(e)}t&&(t.isCustom()?this.plugin.performAction(r.a.PluginAction.Gmail.RemoveLabel,!1,a,t.getName()):t.isInbox()?this.plugin.performAction(r.a.PluginAction.Gmail.Archive,!1,a):t.isArchived()?this.plugin.performAction(r.a.PluginAction.Gmail.Unarchive,!1,a):t.isStarred()&&this.plugin.performAction(r.a.PluginAction.Gmail.Unstar,!1,a))},canAcceptDragOver:function(e,t,a,r){if(e&&this.type===e.type&&(r||e&&this!==e)){var n,s=e.getItemLabel();if(r){var o=i.default.getElementParent(a);n=o&&i.default.getItemForElement(o)}else n=this.getItem();if(n&&this.plugin.isLabelItem(n)&&this.plugin.areItemsFromSameAccount(t,n)){var l=this.plugin.getLabelForVMLI(n);if(l!==s&&l.isDropTarget())return!0}}return!1},_handleDragOverPane:function(e,t,a,i,r,n,s){return{targetElement:a,targetItem:this.getItem()}},_handleDragDrop:function(e,t,a,n){if(a){var s,o=t.pane,l=o.getItemLabel(),d=a.targetItem,c=this.plugin.getLabelForVMLI(d);if(e.hasPluginAttachment(this.plugin.id)&&this.plugin.areItemsFromSameAccount(e,d)){s=e.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(2429,s,"Must be able to get a valid attachment")}catch(e){i.default.reportError(e)}this.plugin.beginAction(),this.plugin.performAction(r.a.PluginAction.Gmail.RemoveLabel,!1,s,l.getName()),this.plugin.attachmentHasLabel(s,c.getName())||this.plugin.performAction(r.a.PluginAction.Gmail.AddLabel,!1,s,c.getName()),o.notifyDropFrom(e,this),this.plugin.endAction()}}},notifyDropFrom:function(e,t){if(this.selectIndex(-1),t.type===PaneMode.Task){var a=e.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(2430,a,"Must be able to get a valid attachment")}catch(e){i.default.reportError(e)}this.plugin.attachmentHasLabel(a,"Moo.do/Handled")||(this.plugin.beginAction(),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(r.a.PluginAction.Gmail.RemoveLabel,!1,a,"Inbox"),this.plugin.performAction(r.a.PluginAction.Gmail.AddLabel,!1,a,"Moo.do/Handled"),this.plugin.endAction());var n=this.plugin.getAttachmentPriority(a);n!==VMLIFlag.None&&e.priority(n,ChangeType.Local),this.plugin.attachmentHasLabelByID(a,"STARRED")&&e.isStarred(!0,ChangeType.Local)}},maxWidthOfPaneObject:function(){return this.getWidth()-56},allowZoom:function(e){var t=!1;return this.plugin.isLabelItem(e)&&(t=!0),t},performOverviewAction:function(e){if(this.plugin.isAccountItem(e)){e.setCollapsed(!e.isCollapsed(this,!0),this,!0);var t=e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(e));i.default.vmMain.zoomin(t),i.default.sendEvent("Menu","OverviewZoom_Gmail")}},setItem:function(e,t){return this.isLoading.set(!0),this.selectIndex(-1),this._super.setItem.call(this,e,t)},isItemHeader:function(e,t){if(!t)return e.isHeader();for(var a=this.plugin,i=e.getItems(),r=0;r<i.length;r++)if(a.isLabelItem(i[r])||a.isAccountItem(i[r]))return!0},getActualPaneItem:function(){return this.plugin._defaultZoomItems[this.id]||this.item.get()},canResetMultiselect:function(){return!f.a.isOpenOnPane(this)||0===this.numItems()},setExpanded:function(e,t){this._super.setExpanded.call(this,e,t),e||this===i.default.focusedPane||m.a.reset(this)},applyDropOnBlock:function(e,t){var a=e,n=t.getAttachmentByPlugin(this.plugin.id);try{i.default.PAssert(2431,n,"Must be able to get a valid attachment")}catch(e){i.default.reportError(e)}if(a.isDate){var s,o=a.dateTime||a.date;s=i.default.isString(o)?c.a.parseDate(o,r.a.DateFormat.MDY):o;try{i.default.PAssert(2432,i.default.isDateValid(s),"Must provide a valid date when scheduling an email",a.dateTime,a.date)}catch(e){i.default.reportError(e)}i.default.isDateValid(s)&&this.plugin.scheduleEmail(t,s)}else{var l;a.isStarred?this.plugin.performAction(r.a.PluginAction.Gmail.Star,!1,n):a.p0||a.isImportant?l=VMLIFlag.P0:a.p1?l=VMLIFlag.P1:a.p2&&(l=VMLIFlag.P2),l&&this.plugin.performAction(r.a.PluginAction.Gmail.SetPriority,!1,n,l)}},getSaveInfo:function(){var e=this._super.getSaveInfo.call(this);e.viewState=this.viewState.get();var t=m.a.getFirstSelectedItem(this);return e.selectedItem=t?t.id:void 0,e},setIgnoreRestoreScroll:function(){},getSwipeMenuItems:function(){var e=this;return{leftOuter:{text:"Add to Outline",icon:"icon-align-left",color:"#09d",fn:function(t){e.autocompleteMove({item:t,position:"autocomplete"})}},leftInner:{text:"Snooze",icon:"icon-access_time",color:"#2a6",fn:function(t){e.autocompleteSnooze({item:t,position:"autocomplete"})}},rightInner:{text:"Archive",icon:"icon-check",color:"#0c0",fn:function(t){var a=e.getItemLabel(!0),i=!a.isArchived();e.archiveItem(i,t),a.isInbox()||a.isArchived()||e.removeItemFromCurrentLabel(t)}},rightOuter:{text:"Delete",icon:"icon-delete",color:"#a30",fn:function(t){e._deleteItem(!0,t)}}}},onTapAddItem:function(e){i.default.menus.openComposeEmail(i.default.vmMain.getDefaultEmailPlugin())},isOverviewVisibleInPane:function(){return!0},getMinItemSize:function(){return r.a.EmailItemHeight},widthOfDrag:function(e){return this.getWidth()},getStyledLinesForPaneObject:function(e,t){if(t)return this._super.getStyledLinesForPaneObject.call(this,e,t);var a=e.item;return a.els||i.default.vmMain.runSingleParse(a,ChangeType.Auto),u.a.generateStyledLines(a.els,this._lines,this)},viewModeIcon:function(){return"Date"===this.getViewMode()?"icon-access_time":"icon-exclamation"},openViewMenu:function(e){i.default.menus.openContextMenu({componentName:"ReactContextMenuGmailSort",element:e.target,pane:this,onSelected:this.changeView})},changeView:function(e){this.viewMode.set(e),this.updateItems(!1,!0)},getViewMode:function(){return this.viewState.get().viewMode},setViewMode:function(e){var t=this.viewState.get();t.viewMode!==e&&(t.viewMode=e,this.viewState.set(t,!0))}};s.a.inherit(g.a,v),s.a.extend(v.prototype,y),t.a=v},function(e,t,a){"use strict";var i=a(0),r=a(5),n=5e3;function s(e,t,a){try{i.default.PAssert(2435,i.default.isFunction(e),"Must provide a valid entry callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2436,i.default.isFunction(t),"Must provide a valid done callback")}catch(e){i.default.reportError(e)}this._entryCB=e,this._doneCB=t,this._delay=a||n,this._flushTimeout=void 0,this._entries=[],r.a.forceBind("_onEntry",this),r.a.forceBind("_onDone",this),r.a.forceBind("_flushEntries",this),r.a.forceBind("_flushEntriesWatchdog",this)}s.prototype={getEntryCB:function(){return this._onEntry},getDoneCB:function(){return this._onDone},_onEntry:function(e){e&&this._entries.push(e),this._flushTimeout||(this._flushTimeout=setTimeout(this._flushEntriesWatchdog,this._delay))},_onDone:function(e,t){i.default.vmMain.beginUpdateItems(),this._flushEntries();try{this._doneCB(e,t)}catch(e){i.default.reportError(e)}i.default.vmMain.commitUpdateItems()},_flushEntriesWatchdog:function(){0},_flushEntries:function(){this._flushTimeout&&(clearTimeout(this._flushTimeout),this._flushTimeout=void 0),i.default.vmMain.beginUpdateItems();for(var e=0;e<this._entries.length;++e)try{this._entryCB(this._entries[e])}catch(e){i.default.reportError(e)}this._entries=[],i.default.vmMain.commitUpdateItems()}},t.a=s},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(15),s=a(14);function o(e,t,a,r,n){this.file=e,this.contentType=e.type,this.email=t,this.onComplete=r||i.default.emptyFn,this.onError=n||i.default.emptyFn,this.onProgress=a||i.default.emptyFn,this._callbacks=[],this.offset=0,this.chunkSize=1048576,this._isDone=!1,this._isRunning=!1,this._hasStarted=!1,this._isCanceled=!1,this._hasError=!1;this.url=this._buildURL(void 0,{uploadType:"resumable"}),this._percent=0}o.prototype={upload:function(){if(this._hasStarted=!0,i.default.isDemoMode())setTimeout(function(){this.onComplete()}.bind(this),2e3);else if(s.a.isCurrentlyAuthorized("me")){var e=s.a.getDefaultAccessToken();if(e){var t={Authorization:"Bearer "+e,"Content-Type":"application/json","X-Upload-Content-Length":this.file.size,"X-Upload-Content-Type":this.contentType};n.a.getAttachFolder(function(e){var a,n={title:this.file.name,mimeType:this.contentType,parents:e?[{id:e}]:[]};try{a=JSON.stringify(n)}catch(e){i.default.reportError(e)}a?i.default.XHR({url:this.url,type:"POST",headers:t,data:a,autoRetry:!0,cb:function(e){if(e.status<r.a.HTTPStatusCode.BadRequest){var t=e.getResponseHeader("Location");this.url=t,this._runUpload()}else this._onError(e)}.bind(this)}):this._onError()}.bind(this))}}else this._onError()},_runUpload:function(){try{i.default.PAssert(2437,this.url,"Must have a valid remote URL to run upload")}catch(e){i.default.reportError(e)}this._isRunning=!0;var e=Math.min(this.offset+this.chunkSize,this.file.size),t=this.file.slice(this.offset,e),a={"Content-Type":this.contentType,"Content-Range":"bytes "+this.offset+"-"+(e-1)+"/"+this.file.size,"X-Upload-Content-Type":this.contentType};i.default.XHR({url:this.url,type:"PUT",headers:a,data:t,autoRetry:!0,cb:function(e){if(e.status===r.a.HTTPStatusCode.Success||e.status===r.a.HTTPStatusCode.Created)this.isCanceled()||this._onComplete(e);else if(e.status===r.a.HTTPStatusCode.PermRedirect){var t=this._extractRange(e.getResponseHeader("Range"));this.offset=t,this._onProgress(this.offset/this.file.size),this.isCanceled()||this._runUpload()}else this._onError(e)}.bind(this)})},resume:function(){try{i.default.PAssert(2438,!this.isDone(),"Should not resume a completed upload")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2439,this._hasStarted,"Must have started an upload to resume it")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2440,this.url,"Must have a valid remote URL to resume upload")}catch(e){i.default.reportError(e)}if(this._hasError=!1,this._isCanceled=!1,this._isRunning)0;else if(this._isRunning=!0,this._hasStarted&&this.url){var e={"Content-Range":"bytes */"+this.file.size,"X-Upload-Content-Type":this.contentType};i.default.XHR({url:this.url,type:"PUT",headers:e,autoRetry:!0,cb:function(e){if(e.status===r.a.HTTPStatusCode.PermRedirect){var t=this._extractRange(e.getResponseHeader("Range"));this.offset=t,this._onProgress(this.offset/this.file.size),this._runUpload()}else this._onError(e)}.bind(this)})}else this.upload()},cancel:function(){try{i.default.PAssert(2441,!this._isDone,"Cannot cancel an upload that is already complete")}catch(e){i.default.reportError(e)}this._isCanceled=!0,this._isRunning=!1},_onError:function(e){this._hasError=!0,this._isRunning=!1,this.onError()},_onComplete:function(e){try{i.default.PAssert(2442,!this._isDone,"Should not call the complete CB twice")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2443,!this._isCanceled,"Should not be able to complete a canceled upload")}catch(e){i.default.reportError(e)}this._isDone=!0,this._isRunning=!1;var t={};if(e&&e.response)try{t=JSON.parse(e.response)}catch(e){i.default.reportError(e)}this._onProgress(1),this.onComplete(t);for(var a=0;a<this._callbacks.length;++a)try{this._callbacks[a](t)}catch(e){i.default.reportError(e)}this._callbacks=[]},_onProgress:function(e){try{i.default.PAssert(2444,!this._hasError,"Should not make forward progress when an error has occurred")}catch(e){i.default.reportError(e)}this._percent=e,this.onProgress(e)},_extractRange:function(e){return i.default.parseInt(e.match(/\d+/g).pop())+1},_buildQueryString:function(e){return e=e||{},Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},_buildURL:function(e,t){var a="https://www.googleapis.com/upload/drive/v2/files/";e&&(a+=e);var i=this._buildQueryString(t);return i&&(a+="?"+i),a},notifyOnComplete:function(e){try{i.default.PAssert(2445,this._callbacks.indexOf(e)<0,"Should not include fn twice")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2446,!this.isDone(),"Should not notify on complete after done")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2447,!this.hasError(),"Should not notify on complete after error")}catch(e){i.default.reportError(e)}this._callbacks.push(e)},isCanceled:function(){return this._isCanceled},isDone:function(){return this._isDone},isRunning:function(){return this._isRunning},hasError:function(){return this._hasError},getPercent:function(){return this._percent}},t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(5),n=(a(4),a(39)),s=a(48);function o(){this._isBuiltin=!0,this._super.constructor.call(this,PluginID.Moodo,"Moodo"),this.setSetting(this.Settings.IsEnabled,!0),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.Unknown),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.Unknown)}var l=1,d=3,c=4,u=5,h=6,f=7,p=8,m=9,g=10,v=11,y=12,S=13,E="createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)",P={isPluginBlocked:function(){return!1},allowRemoteRequests:function(){return!0},getRemoteAttachmentData:function(e){this.cacheData(e.id,{})},runRemoteSingleRequest:function(e,t,a,i){this._queueRemoteRequest(e,t,a,i,void 0,l)},runRemotePagedRequest:function(e,t,a,i,r,n){this._queuePagedRemoteRequest(e,t,a,i,void 0,n,r)},drivePermissionsInsert:function(e,t,a,r,s){try{i.default.PAssert(1665,i.default.isEmail(t),"Should pass in a valid email address")}catch(e){i.default.reportError(e)}var o=n.a.fns("drive").permissions.insert.packedFn,l={fileId:e,sendNotificationEmails:a,resource:{value:t,type:"user",role:"writer",withLink:!1}};this._queueRemoteRequest(o,l,r,s,void 0,d)},drivePermissionsDelete:function(e,t,a,i){var r=n.a.fns("drive").permissions.delete.packedFn,s={fileId:e,permissionId:t};this._queueRemoteRequest(r,s,a,i,void 0,c)},drivePermissionsList:function(e,t,a){var i=n.a.fns("drive").permissions.list.packedFn,r={fileId:e,fields:"items(id,name,role,type,emailAddress)"};this._queueRemoteRequest(i,r,t,a,void 0,u)},drivePermissionsPublic:function(e,t,a){var i=n.a.fns("drive").permissions.insert.packedFn,r={fileId:e,sendNotificationEmails:!1,resource:{type:"anyone",role:"reader",withLink:!0}};this._queueRemoteRequest(i,r,t,a,void 0,d)},driveFilesGet:function(e,t,a){var i=n.a.fns("drive").files.get.packedFn,r={fileId:e,fields:E};this._queueRemoteRequest(i,r,t,a,void 0,h)},driveFilesList:function(e,t,a,i){var r=n.a.fns("drive").files.list.packedFn,s={q:e,fields:"items(createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)),nextPageToken"};this.runRemotePagedRequest(r,s,t,a,i,f)},driveFilesTrash:function(e,t,a){var i=n.a.fns("drive").files.trash.packedFn,r={fileId:e};this._queueRemoteRequest(i,r,t,a,void 0,p)},driveFilesUntrash:function(e,t,a){var i=n.a.fns("drive").files.untrash.packedFn,r={fileId:e};this._queueRemoteRequest(i,r,t,a,void 0,p)},drivePropertiesInsert:function(e,t,a,i,r){var s=n.a.fns("drive").properties.insert.packedFn,o={fileId:e,resource:{key:t,value:a,visibility:"PRIVATE"}};this._queueRemoteRequest(s,o,i,r,void 0,m)},drivePropertiesUpdate:function(e,t,a,i,r){var s=n.a.fns("drive").properties.update.packedFn,o={fileId:e,propertyKey:t,resource:{key:t,value:a,visibility:"PRIVATE"}};this._queueRemoteRequest(s,o,i,r,void 0,g)},driveParentsInsert:function(e,t,a,i){var r=n.a.fns("drive").parents.insert.packedFn,s={fileId:e,resource:{id:t}};this._queueRemoteRequest(r,s,a,i,void 0,v)},driveParentsDelete:function(e,t,a,i){var r=n.a.fns("drive").parents.delete.packedFn,s={fileId:e,parentId:t};this._queueRemoteRequest(r,s,a,i,void 0,y)},driveChildrenList:function(e,t,a,i){var r=n.a.fns("drive").children.list.packedFn,s={folderId:e,fields:"items(id),nextPageToken"};this.runRemotePagedRequest(r,s,t,a,i,S)}};r.a.inherit(s.a,o),r.a.extend(o.prototype,P),t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(5),n=(a(4),a(1)),s=a(7),o=(a(8),a(15),a(17),a(49)),l=a(48),d=a(13),c=a(26),u=a(14),h=a(25),f=a(10),p=a(39),m=1,g=4;function v(){this._super.constructor.call(this,PluginID.GCalendar,"Calendar"),this.pluginMargin=4,this.pluginPadding=14,this._numEntriesSyncd=0,this._calendarList={},r.a.forceBind("_flushEventUpdateQueue",this),r.a.forceBind("_purgeOldData",this),this.registerSetting("WriteAccess","writeAccess",!0),this.registerSetting("ImportCalendars","importCalendars",!0),this.registerSetting("ExportCalendar","exportCalendar",!0),this.registerSetting("WeeksPast","weeksPast",!0,m),this.registerSetting("WeeksFuture","weeksFuture",!0,g),this.registerSetting("DisplayOverdueInAgenda","displayOverdueInAgenda",!0,!1),this.registerSetting("SyncNewEvents","syncNewEvents",!0,!0),this.registerSetting("SyncDraggedEvents","syncDraggedEvents",!0,!0),this.registerSetting("CreateLocalEvents","createLocalEvents",!0,!0),this._updateSyncTimes(),h.a.addHotkey("CalendarEvent",!1,KeyCode.C,n.a.Primary.Never,n.a.Shift.No,this.hotkeyCreateEvent.bind(this)),this._eventCache=this.registerLocalCache("EventCache",StorageType.IndexedDB,!0),this._cacheCleanup=this.registerLowImpactTask("CacheCleanup",this._purgeOldData),this.declareProperty("isInvalid",PluginLoad.Runtime,!0,!1),i.default.isDemoMode()?this.declareProperty("calendarID",PluginLoad.Preview|PluginLoad.Full|PluginLoad.Inline,!0,"me"):this.declareProperty("calendarID",PluginLoad.Preview|PluginLoad.Full|PluginLoad.Inline),this.declareProperty("summary",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("status",PluginLoad.Preview|PluginLoad.Full,!0,"confirmed"),this.declareProperty("startTime",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("endTime",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("allDayEvent",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("recurringEventId",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("eid",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("isComplete",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("isArchived",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("isStarred",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("priority",PluginLoad.Preview|PluginLoad.Full,!0,VMLIFlag.None),this.declareProperty("locked",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("modifiedOffline",PluginLoad.Full,!0,!1),this.declareProperty("source",PluginLoad.Full,!0),this.declareProperty("location",PluginLoad.Full,!0),this.declareProperty("description",PluginLoad.Full,!0),this.declareProperty("attendees",PluginLoad.Full,!0),this.declareProperty("organizer",PluginLoad.Full,!0),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.CalendarEvent),this.useRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.CalendarEvent),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.CalendarEvent),this._pendingCreates={},this._syncingOfflineChanges=!1,this._hasInitializedTasks=!1,this._purgeOldDataTimeout=void 0,this._eventUpdateTimeout=void 0,this._eventUpdateQueue={},this._propConverter={},this._propConverter[b.IsComplete]=i.default.parseDate,this._propConverter[b.IsArchived]=i.default.parseBoolean,this._propConverter[b.IsStarred]=i.default.parseBoolean,this._propConverter[b.Priority]=this.parsePriority.bind(this)}var y=["description","end","start","status","summary","extendedProperties"],S="syncTokens",E="calendarList",P="MDCProp_",b={IsComplete:"isComplete",Priority:"priority",IsStarred:"isStarred",IsArchived:"isArchived"},C=["modifiedOffline"],D={Settings:1,EventSync:2,PropUpdate:3,CalendarList:4,Colors:5,SingleEvent:6,CreateEvent:7,EventUpdate:8,OfflineUpdate:9,DeleteEvent:10,CreateCalendar:11,SummaryUpdate:12},I={getType:function(){return n.a.PluginType.Calendar},_attachMetadataFields:function(){return C},allowRemoteRequests:function(){return!0},useItemStore:function(){return"Google Calendar"},itemStoreOptions:function(){return{listenToItemStateChanged:!0,enabledFilters:n.a.ItemStoreFilter.Dates}},supportOfflineLoad:function(){return!0},supportOfflineCache:function(){return!0},usesPreviewCache:function(){return!0},googleScopes:function(){return this.getSetting(this.Settings.WriteAccess)?[GScope.Calendar]:[GScope.CalendarRO]},getDependencies:function(){return[PluginDependency.LocalLoaded,PluginDependency.PremiumSub,PluginDependency.GoogleLogin]},onDependencyLoaded:function(e,t){if(this._super.onDependencyLoaded.call(this,e,t),e===PluginDependency.GoogleLogin){try{i.default.PAssert(1700,i.default.isArray(t),"Must provide a valid scope array")}catch(e){i.default.reportError(e)}this.getSetting(this.Settings.IsEnabled)&&(t.indexOf(GScope.CalendarRO)<0&&t.indexOf(GScope.Calendar)<0&&(i.default.toasts.pushMessage(MessageID.LostPermission),u.a.notifyUnauthorizedAccount("me",[GScope.CalendarRO,GScope.Calendar],"Missing Scope"),this.setSetting(this.Settings.IsEnabled,!1)),this.getSetting(this.Settings.WriteAccess)&&t.indexOf(GScope.Calendar)<0?(i.default.toasts.pushMessage(MessageID.LostPermission),u.a.notifyUnauthorizedAccount("me",[GScope.Calendar],"Missing Write Scope"),this.setSetting(this.Settings.WriteAccess,!1)):!this.getSetting(this.Settings.WriteAccess)&&t.indexOf(GScope.Calendar)>=0&&this.setSetting(this.Settings.WriteAccess,!0))}},hasSettingsError:function(){var e=!1;if(this.verifyAuthorization(u.a.getDefaultEmail()).length>0)e=!0;else{var t=!!this.getSetting(this.Settings.ExportCalendar),a=!!this.getSetting(this.Settings.WriteAccess);t&&!a&&(e=!0)}return e},isDependencyLoaded:function(e,t){var a=!1;switch(e){case PluginDependency.GoogleLogin:t&&(t.indexOf(GScope.CalendarRO)>=0||t.indexOf(GScope.Calendar)>=0)&&(a=!0);break;default:a=!0}return a},getBlockedText:function(e){return""},computeBatchGroupID:function(e){var t="me";return e.data&&e.data.calendarId&&(t=e.data.calendarId),t},_serializeDate:function(e){return e instanceof Date?e.toISOString():i.default.isNumber(e)?new Date(e).toISOString():e},compactCacheField:function(e,t){var a;switch(t){case"startTime":case"endTime":a=this._serializeDate(e[t]);break;default:a=e[t]}return a},_updateSyncTimes:function(){var e=-(this.getSetting(this.Settings.WeeksPast)||m),t=this.getSetting(this.Settings.WeeksFuture)||g;try{i.default.PAssert(1701,i.default.isNumber(e)&&e<=0,"Invalid value for weeksPast: ",e)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1702,i.default.isNumber(t)&&t>=0,"Invalid valid for weeksFuture: ",t)}catch(e){i.default.reportError(e)}var a=Math.min(-7,e),r=Math.max(20,t);this._minSyncStartTime=(new Date).clearTime().addWeeks(a),this._maxSyncStartTime=(new Date).clearTime().addWeeks(r),this._syncTokenDuration=i.default.weeks(10),this._minDisplayStartTime=(new Date).clearTime().addWeeks(e),this._maxDisplayStartTime=(new Date).clearTime().addWeeks(t);try{i.default.PAssert(1703,this._minDisplayStartTime.isBefore(this._maxDisplayStartTime),"Must have a valid start display date")}catch(e){i.default.reportError(e)}},_shouldDisplayTime:function(e,t){return t>=this._minDisplayStartTime&&t<=this._maxDisplayStartTime||e>=this._minDisplayStartTime&&e<=this._maxDisplayStartTime},_filterDates:function(e,t,a){return function(i){var r=new Date(i[e]);return r>=t&&r<=a}},_getEndClearTime:function(){return this._minDisplayStartTime.clone().addDays(-1)},_purgeOldData:function(e){this._eventCache.onCacheReady(function(){this._eventCache.getFilterEntries(this._filterDates("startTime",new Date(0),this._getEndClearTime()),function(t){if(t){log("Removing "+t.length+" old calendar entries.");for(var a=0;a<t.length;++a)this._eventCache.removeEntry(t[a].id)}e&&e(!1)}.bind(this))}.bind(this))},_offlineLoad:function(){this._eventCache.onCacheMetadataReady(function(){this._eventCache.getMetadata(E,function(e){i.default.isEmpty(this._calendarList)&&(this._calendarList=e||{}),this._eventCache.onCacheReady(function(){var e=this._filterDates("startTime",this._minDisplayStartTime,this._maxDisplayStartTime),t=function(t,a){i.default.batchRenderUpdates(function(){i.default.vmMain.beginUpdateItems();for(var r=this.getDefaultItemStore(),n=r.getRoot(),s=0;s<t.length;++s){var o=t[s];if(!a||e(o)){var l=this.createEntryFromLocal(o.id,o);this.cacheData(l.id,l,void 0,void 0,ChangeType.Auto);try{i.default.PAssert(1704,!r.hasItem(l.id),"Load should never try to create a VMLI that has already been created")}catch(e){i.default.reportError(e)}if(this._eventNeedsItem(l)){if(l.source){var d=i.default.vmMain.pluginManager.parseEmailURL(l.source.url);if(d.plugin&&!d.plugin.hasCacheData(d.threadID)){var c=d.plugin.createEntryFromLocal(d.threadID,{accountID:d.accountID,subject:l.source.title});d.plugin.cacheData(d.threadID,c)}}var u=this._createItem(r,l,n.id);n.insertItem(u)}}}i.default.vmMain.commitUpdateItems(),this._cacheCleanup.notifyWorkAvailable()}.bind(this))}.bind(this);this._eventCache.requestPreloadData(function(a){i.default.isArray(a)?t(a,!0):this._eventCache.getFilterEntries(e,t)}.bind(this))}.bind(this))}.bind(this))}.bind(this))},_load:function(){i.default.isDemoMode()||(this.createRecurringTask("CalendarListSync",{delay:i.default.hours(2),minDelay:i.default.hours(1),runOnCreate:!0,pauseWhileIdle:!0,async:!0,asyncTimeout:i.default.minutes(2),task:this.runCalendarListSync.bind(this)}),this.createRecurringTask("CalendarEventSync",{delay:i.default.minutes(15),minDelay:i.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:i.default.minutes(2),task:this.runCalendarSync.bind(this)}),this._hasInitializedTasks=!0)},goOnline:function(){this._hasInitializedTasks&&this.getRecurringTask("CalendarEventSync").forceUpdate()},handleTapStart:function(e,t,a,i){return!0},handleTapClick:function(e,t,a,r){var n=this.getCacheData(a);if(n){this.getAttachment(a);var s="https://www.google.com/calendar/event?eid="+n.eid+"&authuser="+u.a.getDefaultEmail();if(n.eid)i.default.isDemoMode()?i.default.toasts.pushMessage(MessageID.DemoPluginClick):(i.default.openUrl(s,r),this.sendEvent("Tap_OpenGCalendarDesktop"));return!0}return!1},_durationToString:function(e){var t,a,i;(t=Math.round(e/6e4))>0&&(t-=60*(a=Math.floor(t/60)),a>0&&(a-=24*(i=Math.floor(a/24))));var r="";return i>0&&(r+=i+"d "),a>0&&(r+=a+"h "),t>0&&(r+=t+"m "),r.trim()},_createItemDateText:function(e){return e.allDayEvent?e.startTime.toString(d.a.getFormat(DFormat.MonthDayYear)):e.startTime.toString(d.a.getFormat(DFormat.DayYearTime))},_createItemDurationText:function(e){var t,a=e.endTime-e.startTime;if(e.allDayEvent)if(a>i.default.days(1)){var r=e.endTime.clone();r.addMilliseconds(-1),t="until "+r.toString(d.a.getFormat(DFormat.MonthDayYear))}else t="";else t=this._durationToString(a);return t},_createItemSummaryText:function(e){var t;if(e.source&&e.source.url){var a=i.default.vmMain.pluginManager.parseEmailURL(e.source.url);a.plugin&&(t=a.plugin._getTextForItem({id:a.threadID}))}return t||(t=e.summary?e.summary.replace(/\u2000/g,""):""),t},_createItemText:function(e){try{i.default.PAssert(1705,e,"Must specify a valid attachment")}catch(e){i.default.reportError(e)}var t=this._createItemDateText(e),a=this._createItemDurationText(e),r=this._createItemSummaryText(e);return this._assembleItemText(e,t,a,r)},_assembleItemText:function(e,t,a,i){return i+" "+n.a.DatePrefix+t+" "+(a?a+" ":"")+this._getTextForItem(e)},_eventNeedsItem:function(e){return"cancelled"!==e.status&&!e.isArchived},_createItem:function(e,t,a){var r;try{i.default.PAssert(1706,this._eventNeedsItem(t),"Item must always be required to cause create")}catch(e){i.default.reportError(e)}i.default.isDateValid(t.isComplete)&&(r=t.isComplete);var n={date:t.startTime.getTime(),dateText:this._createItemDateText(t),dateFormat:d.a.getCurrentDateFormat(),priority:t.priority,isComplete:!!t.isComplete,isArchived:t.isArchived,dateCompleted:r,isStarred:t.isStarred,duration:void 0,durationText:void 0};t.allDayEvent||(n.duration=t.endTime-t.startTime,n.durationText=this._createItemDurationText(t));var s=e.createItem(t.id,this._createItemText(t),a,n,ChangeType.Auto);if(t.description){var o=e.createItem(t.id+"_note",t.description,s.id,{isNote:!0},ChangeType.Auto);s.setNote(o,ChangeType.Auto)}return s},getRemoteAttachmentData:function(e,t){try{i.default.PAssert(1707,e.hasField("calendarID"),"Must have a valid calendarID for an event")}catch(e){i.default.reportError(e)}if(e.hasField("calendarID")){var a=e.getField("calendarID"),r=p.a.fns("calendar").events.get.packedFn,n={eventId:e.id,calendarId:a},s=function(t){try{i.default.PAssert(1708,!t||t.id===e.id,"If valid result, attachment should match remote event ID")}catch(e){i.default.reportError(e)}if(t){var r=this._addRemoteEntry(a,t);this._eventCache.cacheEntry(t.id,this.serializeExternalData(r))}}.bind(this);this._queueRemoteRequest(r,n,s,function(){e.notifyDataRequestFailed()},e,D.SingleEvent)}else e.updateField("status","cancelled")},_createRemoteEntry:function(e,t){var a,r,n,s=!1;try{i.default.PAssert(1709,t.start,"Must always have valid start data")}catch(e){i.default.reportError(e)}if(t.start.dateTime){try{i.default.PAssert(1710,t.end.dateTime,"End date format should always match start")}catch(e){i.default.reportError(e)}a=new Date(t.start.dateTime),r=new Date(t.end.dateTime)}else if(t.start.date){try{i.default.PAssert(1711,t.end.date,"End date format should always match start")}catch(e){i.default.reportError(e)}var o=t.start.date.split("-"),l=t.end.date.split("-");a=new Date(o[0],o[1]-1,o[2]),r=new Date(l[0],l[1]-1,l[2]),s=!0}t.htmlLink&&(n=t.htmlLink.split("?eid=")[1]);var d={id:t.id,calendarID:e,status:t.status,summary:t.summary,startTime:a,endTime:r,allDayEvent:s,recurringEventId:t.recurringEventId,eid:n,isComplete:this._getRemoteProperty(t,b.IsComplete),isArchived:this._getRemoteProperty(t,b.IsArchived),isStarred:this._getRemoteProperty(t,b.IsStarred),priority:this._getRemoteProperty(t,b.Priority),locked:t.locked||!1,attendees:t.attendees,location:t.location,description:t.description,organizer:t.organizer?t.organizer.displayName||t.organizer.email||t.organizer.id:"Unknown"};return t.source&&(d.source={title:t.source.title,url:t.source.url}),d},_addRemoteEntry:function(e,t){var a=this._createRemoteEntry(e,t);return this.cacheData(a.id,a),a},createEntryFromLocal:function(e,t){return t.startTime=t.startTime?new Date(t.startTime):void 0,t.endTime=t.endTime?new Date(t.endTime):void 0,t.isComplete=this._propConverter[b.IsComplete](t.isComplete),t.isArchived=this._propConverter[b.IsArchived](t.isArchived),t.isStarred=this._propConverter[b.IsStarred](t.isStarred),t.priority=this._propConverter[b.Priority](t.priority),t},_notifyFailedRequest:function(e,t){e&&e.error&&(e.error.code===n.a.HTTPStatusCode.Unauthorized?(i.default.toasts.pushMessage(MessageID.LostPermission),u.a.notifyUnauthorizedAccount("me",[GScope.CalendarRO,GScope.Calendar],e.error.message)):e.error.code>=400&&e.error.code<500&&i.default.reportError(new Error("Failed GCalendar request: "+e.error.code),e))},_getRemoteProperty:function(e,t){try{i.default.PAssert(1712,e,"Must provide valid event info")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1713,t,"Must provide valid remote prop")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1714,this._propConverter[t],"Missing prop converter: ",t)}catch(e){i.default.reportError(e)}var a;return e.extendedProperties&&e.extendedProperties.private&&(a=e.extendedProperties.private[P+t]),this._propConverter[t]&&(a=this._propConverter[t](a)),a},_updateAttachFromData:function(e,t){var a=[];for(var i in t)t.hasOwnProperty(i)&&e.isFieldDefined(i)&&(e.updateField(i,t[i]),a.push(i));return a},_runRemoteUpdate:function(e,t,a,r,n,s){try{i.default.PAssert(1715,this.getSetting(this.Settings.WriteAccess),"Should not be calling _runRemoteUpdate without proper permission")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1716,!e.getField("locked"),"Should never try to modify an event that is locked")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1717,i.default.isBoolean(t)||i.default.isArray(t),"Must specify a boolean or list of fields for modified value")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1718,i.default.isFunction(r),"Must provide a valid localDoneCB")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1719,i.default.isFunction(n),"Must provide a valid remoteDoneCB")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1720,i.default.isFunction(s),"Must provide a valid allDoneCB")}catch(e){i.default.reportError(e)}var o,l,d,c;function u(e,t,a){try{i.default.PAssert(1721,i.default.isFunction(e),"Must supply a valid CB function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1722,void 0!==t,"Must always pass success back from CB")}catch(e){i.default.reportError(e)}if(e.apply(this,Array.prototype.slice.call(arguments,1)),e===r){try{i.default.PAssert(1723,void 0===this._localSuccess,"Local CB called twice")}catch(e){i.default.reportError(e)}o=t,d=a}else if(e===n){try{i.default.PAssert(1724,void 0===this._remoteSuccess,"Remote CB called twice")}catch(e){i.default.reportError(e)}l=t,c=a}void 0!==o&&void 0!==l&&s(o,l,d,c)}var h=this.getCacheData(e.id);try{i.default.PAssert(1725,h,"Performing update on event that does not have local data")}catch(e){i.default.reportError(e)}h?(this.addModifiedOffline(h,t),this._eventCache.cacheEntry(e.id,this.serializeExternalData(h),function(i){i||u(r,!1),a(function(a,s){if(a){var o=this.getCacheData(e.id),l=!0!==t&&t;this.removeModifiedOffline(o,l),i&&this._eventCache.cacheEntry(e.id,this.serializeExternalData(o),function(e){u(r,e)}),u(n,!0)}else i&&u(r,!1),u(n,!1,s)}.bind(this))}.bind(this))):(u(r,!1),u(n,!1))},_updateEvent:function(e,t,a,i,r,n){var s=this._updateAttachFromData(e,t),o=function(i){this._updateRemoteEvent(e.getField("calendarID"),e.id,t,a,i)}.bind(this);this._runRemoteUpdate(e,s,o,i,r,n)},_updateRemoteEvent:function(e,t,a,r,s){try{i.default.PAssert(1726,this.getSetting(this.Settings.WriteAccess),"Should not be calling _updateRemoteEvent without proper permission")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1727,this.hasWritePermissionForCalendar(e),"Should not be calling _updateRemoteEvent for a read-only calendar")}catch(e){i.default.reportError(e)}var o=this._createEventUpdateInfo(a),l=p.a.fns("calendar").events.patch.packedFn,d={calendarId:e,eventId:t,resource:o},c=function(a){if(a&&a.error&&a.error.code===n.a.HTTPStatusCode.NotFound)this._eventCache.removeEntry(t),s(!0);else{var r=Object.keys(o);if(log("Failed Update: ",e,t,r),i.default.isHTTPStatusCode(a,n.a.HTTPStatusCode.Forbidden)&&!this.isRateLimitError(a)){var l=this.getCacheData(t);l&&(l.locked=!0),this.cacheData(t,l,!0,["locked"])}s(!1,a),this._notifyFailedRequest(a,e)}}.bind(this);this._queueRemoteRequest(l,d,function(){s(!0)},c,void 0,D.EventUpdate||r)},_updateRemoteProperty:function(e,t,a,i,r,n){e.updateField(t,a);var s={},o=void 0===a?null:a;s[P+t]=o;var l={extendedProperties:{private:s}},d=function(t){this._updateRemoteEvent(e.getField("calendarID"),e.id,l,D.PropUpdate,t)}.bind(this);this._runRemoteUpdate(e,[t],d,i,r,n)},_getStartEndFromDateInfo:function(e,t){var a,r,n,s=!1;if(e instanceof Date)e.hasTimeOfDay()||(s=!0),a=e,r=e.clone().addMilliseconds(t);else if(e instanceof o.a)a=e.getStartDate(),r=e.getEndDate(),n=e.toICal();else try{i.default.PAssert(1728,!1,"Should always have a valid date")}catch(e){i.default.reportError(e)}return{startTime:a,endTime:r,allDayEvent:s,recurrence:n}},deleteCalendarEventForItem:function(e,t,a,i,r){this.sendEvent("DeleteEvent");var n=function(a){var i=e.getCalendarRawText().replace(t.getEmbedString(),"");e.setText(i,!0,ChangeType.Local),t.isLocalOnlyAttachment()?(t.updateField("status","cancelled"),a(!0)):this.deleteCalendarEvent(t,a)}.bind(this);this._runRemoteUpdate(t,["status"],n,a,i,r)},deleteCalendarEvent:function(e,t){try{i.default.PAssert(1729,!e.isLocalOnlyAttachment(),"Should never make a remote request to delete a local-only event")}catch(e){i.default.reportError(e)}var a=p.a.fns("calendar").events.delete.packedFn,r={calendarId:e.getField("calendarID"),eventId:e.id},s=function(){var a=this.getDefaultItemStore();e.updateField("status","cancelled"),e.forEachItem(a,function(e){e.parent()&&(e.parent().removeChild(e),e.parent(void 0))}),this._eventCache.cacheEntry(e.id,this.serializeExternalData(e.getData())),t(!0)}.bind(this),o=function(a){a&&a.error&&a.error.code===n.a.HTTPStatusCode.Gone?s():a&&a.error&&a.error.code===n.a.HTTPStatusCode.NotFound?s():(t(!1,a),this._notifyFailedRequest(a,e.getField("calendarID")))}.bind(this);this._queueRemoteRequest(a,r,function(){s()},o,void 0,D.DeleteEvent)},forceRemoteEventSync:function(){if(!i.default.isDemoMode()&&this._hasInitializedTasks){if(this.hasRecurringTask("CalendarEventSync"))this.getRecurringTask("CalendarEventSync").forceUpdate();if(this.hasRecurringTask("CalendarListSync"))this.getRecurringTask("CalendarListSync").forceUpdate()}},getDefaultExportCalendarID:function(){return i.default.isDemoMode()?"DemoCal":this.getSetting(this.Settings.ExportCalendar)},isExportCalendarID:function(e){return this.getSetting(this.settings.ExportCalendar)===e},hasWritePermissionForAttach:function(e){var t=!1;if(this.getSetting(this.Settings.WriteAccess)){var a=e.getField("calendarID"),i=this._getCalendarInfo(a);i&&("writer"!==i.accessRole&&"owner"!==i.accessRole||(t=!0))}return t},hasWritePermissionForCalendar:function(e){var t=!1;if(this.getSetting(this.Settings.WriteAccess)){var a=this._getCalendarInfo(e);a&&("writer"!==a.accessRole&&"owner"!==a.accessRole||(t=!0))}return t},getCalendarBackgroundColor:function(e){var t="rgba(0, 120, 255, 0.85)",a=this._getCalendarInfo(e);return a&&a.backgroundColor&&(t=a.backgroundColor),t},getCalendarForegroundColor:function(e){var t="#000000",a=this._getCalendarInfo(e);return a&&a.foregroundColor&&(t=a.foregroundColor),t},getCalendarDisplayProps:function(e){var t,a=this._getCalendarInfo(e);return a&&"reader"===a.accessRole&&(t={style:{backgroundImage:"url(/img/stripe.png)",backgroundRepeat:"repeat"}}),t},shouldDisplayOverdueInAgenda:function(){return this.getSetting(this.Settings.DisplayOverdueInAgenda)},createEventForEmail:function(e,t,a,r,n,s){try{i.default.PAssert(1730,i.default.isString(e),"Must provide a valid calendarID for email")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1731,i.default.isString(t),"Must provide a valid subject")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1732,i.default.isString(a),"Must provide a valid email url")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1733,i.default.isDateValid(r),"Must provide a valid schedule date")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1734,i.default.isNumber(n),"Must provide a valid event duration")}catch(e){i.default.reportError(e)}this.sendEvent("AddEmailEvent");var o={duration:n,summary:t,date:r,source:{title:t,url:a}};this.createNewCalendarEvent(e,o,function(e,t){if(e){var a=this.getDefaultItemStore();if(!a.hasItem(e.id)){i.default.vmMain.beginUpdateItems();var r=a.getRoot(),n=this._createItem(a,e,r.id);r.insertItem(n),i.default.vmMain.commitUpdateItems()}}}.bind(this),function(){},s)},createEventForItem:function(e){if(!i.default.isDateSoft(e.getDateText())&&!e.hasPluginAttachment(this.id)&&(e.date()||e.repeatDate())){var t=this.getDefaultExportCalendarID();t?e.date()?(this.sendEvent("AddSingleEvent"),this.newCalendarEventForItem(t,e,function(t,a,r,n){t||a?a?f.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddToGCal,data:{item:e}}):n&&n.error&&-1===n.error.code?f.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddToGCal,data:{item:e}}):i.default.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:MessageAction.Okay}):r&&!1===r.isValid?i.default.toasts.pushMessage({text:"The event you are trying to create is not valid.",action:MessageAction.Okay}):i.default.toasts.pushMessage({text:"There was an error creating your calendar event. It has not been properly saved.",actionText:"LEARN MORE",action:function(){s.a.overQuota?i.default.toasts.pushMessage({text:"You are offline and tour computer's storage quota has been exceeded. Please free up space on your device. Please contact support@moo.do if you have questions.",action:MessageAction.Okay}):i.default.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:MessageAction.Okay})}})})):(this.sendEvent("AddRepeatEvent"),i.default.toasts.pushMessage({text:"Moo.do does not currently support adding repeated dates to Google Calendar.",action:MessageAction.Okay})):i.default.toasts.pushMessage({text:"Please select a valid Google Calendar to save your events to.",action:MessageAction.OpenSettings})}},hotkeyCreateEvent:function(){this.isActive()&&!this.isPluginBlocked()&&i.default.vmMain.applyToSelection(this.createEventForItem.bind(this))},newCalendarEventForItem:function(e,t,a){try{i.default.PAssert(1735,t,"Must provide a valid item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1736,t.date()||t.repeatDate(),"Item must have a valid date")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1737,!t.hasPluginAttachment(PluginID.GCalendar),"Must not already have a valid calendar attachment associated with the item")}catch(e){i.default.reportError(e)}var r=!0,s=t.getDuration();s||(s=t.allDayDate()?i.default.days(1):36e5);var o={duration:s,summary:t.getCalendarParsedText()};if(t.date())o.date=t.date();else if(t.repeatDate()){try{i.default.PAssert(1738,!1,"Repeated dates are not yet supported")}catch(e){i.default.reportError(e)}r=!1}if(t.hasNote()&&(o.description=t.getNote().getParsedText()),t.hasAttachmentType(n.a.PluginType.Email)){var l=t.getAttachmentByType(n.a.PluginType.Email);o.source={title:l.getField("subject"),url:l.getPlugin().createURLForThread(l)}}r?this.createNewCalendarEvent(e,o,function(e,a){if(e)if(t.isDestroyed()){var r=this.getDefaultItemStore();if(!r.hasItem(e.id)){i.default.vmMain.beginUpdateItems();var s=r.getRoot(),o=this._createItem(r,e,s.id);s.insertItem(o),i.default.vmMain.commitUpdateItems()}}else{var l=t.getCalendarRawText()+" "+n.a.DatePrefix+t.getDateText();t.getDurationText()?l+=" "+t.getDurationText():t.allDayDate()||(l+=" 1hr"),l+=" "+this._getTextForItem(e),t.setText(l,!0,ChangeType.Local)}}.bind(this),function(){},a):a(!1,!1,{isValid:!1})},createNewCalendarEvent:function(e,t,a,r,n){try{i.default.PAssert(1739,t,"Must have valid event info passed in")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1740,t.date,"Must have valid date for event")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1741,void 0!==t.duration,"Must have a valid event duration")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1742,t.summary,"Must have a valid event summary")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1743,i.default.isFunction(a),"Must supply a valid local done CB")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1744,i.default.isFunction(r),"Must supply a valid remote done CB")}catch(e){i.default.reportError(e)}var s=i.default.generateTempId(),o=this._getStartEndFromDateInfo(t.date,t.duration),l={id:s,calendarID:e,status:"confirmed",summary:t.summary,source:t.source,description:t.description,startTime:o.startTime,endTime:o.endTime,allDayEvent:o.allDayEvent,recurrence:o.recurrence,organizer:u.a.getDefaultEmail(),modifiedOffline:!0};this.cacheData(s,l),this._eventCache.cacheEntry(s,l,function(t){a(l,t);var s=function(t){this._createRemoteEventFromCacheData(e,l,function(){},t,n)}.bind(this),o=this.getAttachment(l.id);i.default.isDemoMode()?(r(!0),n(t,!0)):this._runRemoteUpdate(o,!0,s,function(){},r,function(){this.getDefaultItemStore().updateItems()}.bind(this))}.bind(this))},_createRemoteEventFromCacheData:function(e,t,a,r,n){try{i.default.PAssert(1745,!this._pendingCreates[t.id],"Should never try and double create a calendar event")}catch(e){i.default.reportError(e)}var s,o,l,d;function c(e,t,c){try{i.default.PAssert(1746,i.default.isFunction(e),"Must supply a valid CB function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1747,void 0!==t,"Must always pass success back from CB")}catch(e){i.default.reportError(e)}if(e.apply(this,Array.prototype.slice.call(arguments,1)),e===a){try{i.default.PAssert(1748,void 0===this._localSuccess,"Local CB called twice")}catch(e){i.default.reportError(e)}s=t,l=c}else if(e===r){try{i.default.PAssert(1749,void 0===this._remoteSuccess,"Remote CB called twice")}catch(e){i.default.reportError(e)}o=t,d=c}void 0!==s&&void 0!==o&&n(s,o,l,d)}this._pendingCreates[t.id]=!0,this._createNewRemoteEvent(e,t,function(n,s){delete this._pendingCreates[t.id],i.default.vmMain.beginUpdateItems();var o=this.getAttachment(t.id);if(n){var l=t.id;this.changeID(o,o.id,n.id);var d=this.getDefaultItemStore(),u=d.getRoot();d.hasItem(l)&&d.destroyItem(l),this._eventCache.removeEntry(l,function(e){try{i.default.PAssert(1750,e,"Must always successfully remove the temp cached event: "+t.id)}catch(e){i.default.reportError(e)}});var h=this._addRemoteEntry(e,n),f=this._createItem(d,h,u.id);u.insertItem(f),this._eventCache.cacheEntry(n.id,this.serializeExternalData(h),c.bind(this,a)),o.updateField("isInvalid",!1),c(r,!0)}else o.updateField("isInvalid",!0),c(a,!1),c(r,!1,s);i.default.vmMain.commitUpdateItems()}.bind(this))},_createNewRemoteEvent:function(e,t,a){try{i.default.PAssert(1751,t,"Must specify valid event info")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1752,t.startTime instanceof Date,"Must have a valid start time")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1753,t.endTime instanceof Date,"Must have a valid end time")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1754,t.summary,"Must have a valid event title")}catch(e){i.default.reportError(e)}var r,n;t.allDayEvent?(r={date:t.startTime.toString("yyyy-MM-dd")},n={date:t.endTime.toString("yyyy-MM-dd")}):(r={dateTime:t.startTime.toISOString()},n={dateTime:t.endTime.toISOString()});var s=p.a.fns("calendar").events.insert.packedFn,o={calendarId:e,resource:{start:r,end:n,recurrence:t.recurrence,summary:t.summary,description:t.description,status:t.status,source:t.source}},l=function(t){a(void 0,t),this._notifyFailedRequest(t,e)}.bind(this);this._queueRemoteRequest(s,o,function(e){a(e)},l,void 0,D.CreateEvent)},getImportCalendarList:function(){return this.getSetting(this.Settings.ImportCalendars)||[]},getReadableCalendarList:function(e){return this._getCalendarList("reader",e)},getWritableCalendarList:function(e){return this._getCalendarList("writer",e)},getFullCalendarList:function(e){var t=this.getSetting(this.Settings.ImportCalendars);this.getReadableCalendarList(function(a){if(t&&a){var r=t.map(function(e){if(!i.default.isObject(e))return{id:e,accessRole:"none"};var t=i.default.clone(e);return t.accessRole="none",t}).filter(function(e){for(var t=0;t<a.length;++t)if(a[t].id===e.id)return!1;return!0});a.pushArray(r)}e(a)})},createCalendar:function(e,t){var a=p.a.fns("calendar").calendars.insert.packedFn,i={resource:{summary:e}},r=function(e){t(),this._notifyFailedRequest(e,void 0)}.bind(this);this._queueRemoteRequest(a,i,function(e){t(e)},r,void 0,D.CreateCalendar),this.sendEvent("CreateCalendar")},_getCalendarList:function(e,t){var a=p.a.fns("calendar").calendarList.list.packedFn,i={minAccessRole:e,userId:"me"},r=function(e){t(),this._notifyFailedRequest(e,void 0)}.bind(this);this._queuePagedRemoteRequest(a,i,function(e){t(e)},r,void 0,D.CalendarList,{getAllPages:!0,timeoutMS:0})},handleEventUpdate:function(e,t){this._numEntriesSyncd++;var a=this.getDefaultItemStore();if("cancelled"===t.status){if(this._eventCache.removeEntry(t.id),this.hasCacheData(t.id))(o=this.getAttachment(t.id)).updateField("status","cancelled"),o.forEachItem(a,function(e){e.parent()&&(e.parent().removeChild(e,ChangeType.Remote),e.parent(void 0))})}else{var r=this.getCacheData(t.id),n=this._createRemoteEntry(e,t);r&&r.modifiedOffline&&this._mergeEventData(r,n),this.cacheData(n.id,n),this._eventCache.cacheEntry(t.id,this.serializeExternalData(n));var s=a.getRoot(),o=this.getAttachment(t.id);this._beginIgnorePropertyChanges();try{this.updateVMLIsFromUpdate(o,r,n)}catch(e){i.default.reportError(e)}if(this._endIgnorePropertyChanges(),!a.hasItem(n.id)&&this._shouldDisplayTime(n.startTime,n.endTime)&&this._eventNeedsItem(n)){var l=this._createItem(a,n,s.id);s.insertItem(l)}}},_mergeEventData:function(e,t){try{i.default.PAssert(1757,e.modifiedOffline,"Should only merge events that were locally modified")}catch(e){i.default.reportError(e)}var a=e.modifiedOffline;try{i.default.PAssert(1758,i.default.isArray(a),"Should not be receiving an update for an event that was created locally")}catch(e){i.default.reportError(e)}for(var r=0;r<a.length;++r){var n=a[r];0,t[n]=e[n]}t.modifiedOffline=e.modifiedOffline},updateVMLIsFromUpdate:function(e,t,a){try{i.default.PAssert(1759,e,"Must provide a valid attachment")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1760,a,"Must provide valid new data")}catch(e){i.default.reportError(e)}if(t)e.forEachItem(void 0,function(e){var i,r,s=!1,o=e.getParsedText();if(this.areDatesEqual(t.startTime,a.startTime)||(i=this._createItemDateText(a),o=o.replace(n.a.DatePrefix+e.getDateText(),n.a.DatePrefix+i),s=!0),t.endTime-t.startTime!=a.endTime-a.startTime){if(r=this._createItemDurationText(a),e.getDurationText())o=o.replace(e.getDurationText(),r);else{var l=n.a.DatePrefix+(i||e.getDateText());o=o.replace(l,l+" "+r)}s=!0}if(t.summary!==a.summary&&!e.hasAttachmentType(n.a.PluginType.Email)){var d=i||e.getDateText(),c=r||e.getDurationText(),u=a.summary?a.summary.replace(/\u2000/g,""):"";o=this._assembleItemText(a,d,c,u),s=!0}if(t.description!==a.description&&e.belongsToItemStore(this.getDefaultItemStore()))if(e.hasNote())a.description?(h=e.getNote()).setText(a.description,!0,ChangeType.Remote):e.setNote(void 0,ChangeType.Remote);else if(a.description){var h,f=a.id+"_note";this.getDefaultItemStore().hasItem(f)?(h=this.getDefaultItemStore().getItem(f)).setText(a.description,!0,ChangeType.Remote):h=this.getDefaultItemStore().createItem(f,a.description,e.id,{isNote:!0},ChangeType.Remote),e.setNote(h,ChangeType.Remote)}if(this.areDatesEqual(t.isComplete,a.isComplete)||e.isComplete(!!a.isComplete,ChangeType.Remote),t.isArchived!==a.isArchived&&e.isArchived(a.isArchived,ChangeType.Remote),t.isStarred!==a.isStarred&&e.isStarred(a.isStarred,ChangeType.Remote),t.priority!==a.priority&&e.priority(a.priority,ChangeType.Remote),s){var p=e.generateSaveText(o);e.setText(p,!0,ChangeType.Remote)}}.bind(this));else{var r=this._createItemText(a);e.forEachItem(void 0,function(e){e.setText(r,!0,ChangeType.Remote)}.bind(this))}},setSyncToken:function(e,t,a){try{i.default.PAssert(1761,i.default.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1762,i.default.isString(t),"Must provide a valid calendar ID to clear sync token for")}catch(e){i.default.reportError(e)}this._eventCache.getMetadata(S,function(i){i=i||{};var r=Date.now()+this._syncTokenDuration;i[e]={token:t,date:Date.now(),expires:r},this._eventCache.setMetadata(S,i,a)}.bind(this))},clearSyncToken:function(e,t){try{i.default.PAssert(1763,i.default.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1764,i.default.isFunction(t),"Must provide valid CB function when clearing sync token")}catch(e){i.default.reportError(e)}this._eventCache.getMetadata(S,function(a){a?(delete a[e],this._eventCache.setMetadata(S,a,t)):t(!1)}.bind(this))},clearCalendarEventCache:function(e,t){try{i.default.PAssert(1765,i.default.isString(e),"Must provide a valid calendar ID to clear event cache for")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1766,i.default.isFunction(t),"Must provide valid CB function when clearing event cache")}catch(e){i.default.reportError(e)}this._eventCache.getFilterEntries(function(t){return t.calendarID===e},function(a){if(a){log("Clearing calendar cache: "+e);for(var i=0;i<a.length;++i)this._eventCache.removeEntry(a[i].id);t(!0)}else t(!1)}.bind(this))},_calendarSyncComplete:function(e,t){if(t.length>0){if(c.a.notifySyncError(t),!i.default.isOffline())for(var a=0;a<t.length;++a){t[a].result!==n.a.SyncResult.FailureNetwork&&i.default.toasts.pushMessage(MessageID.CalendarSync)}}else c.a.notifySyncError(void 0),i.default.toasts.clearMessage(MessageID.CalendarSync);var r=this.getSetting(this.Settings.ExportCalendar);if(r){var s=!1;for(a=0;a<t.length;++a)if(t[a].id===r){s=!0;break}s||this._syncOfflineChanges(this._notifyOfflineSyncFailures)}},_shouldExpireToken:function(e){var t=!0;return e&&(e.expires?t=e.expires<Date.now():e.date&&(t=e.date+this._syncTokenDuration<Date.now())),t},_getCalendarInfo:function(e){return this._calendarList[e]},allowTextEditing:function(e,t){var a=!1;if(this.getSetting(this.Settings.WriteAccess)){var i=t.getField("calendarID");(this.hasWritePermissionForCalendar(i)||t.isLocalOnlyAttachment())&&(a=!0)}return a},_createCalendarFromRemote:function(e){var t={id:e.id,summary:e.summary,accessRole:e.accessRole};return i.default.isValidColor(e.backgroundColor)&&(t.backgroundColor=e.backgroundColor),i.default.isValidColor(e.foregroundColor)&&(t.foregroundColor=e.foregroundColor),t},runCalendarListSync:function(e){this.getReadableCalendarList(function(t){if(t){this._calendarList={};for(var a=0;a<t.length;++a){var r=t[a];this._calendarList[r.id]=this._createCalendarFromRemote(r)}i.default.toasts.clearMessage(MessageID.CalendarSync);var n=this.getDefaultExportCalendarID();n&&!this._calendarList[n]&&(this.setSetting(this.Settings.ExportCalendar,void 0),i.default.toasts.pushMessage({text:"Your export calendar no longer exists, please select another.",action:MessageAction.OpenSettings})),this._eventCache.onCacheMetadataReady(function(){this._eventCache.setMetadata(E,this._calendarList)}.bind(this))}else i.default.isOffline()||i.default.toasts.pushMessage(MessageID.CalendarSync);e&&e()}.bind(this))},_notifyTokenExpired:function(e){this._purgeOldDataTimeout&&clearTimeout(this._purgeOldDataTimeout),this._purgeOldDataTimeout=setTimeout(this._purgeOldData,0)},_notifyCalendarUnsyncd:function(e){log("Detected calendar "+e+" is no longer syncd"),this._clearCachedData(e,function(t){t||log("Failure unsyncing calendar "+e)}),this._clearCalendarItems(e)},_clearCalendarItems:function(e){var t=this.getDefaultItemStore();i.default.vmMain.beginUpdateItems(),t.forEach(function(a){a.hasAttachments()&&(a.getAttachment(0).getField("calendarID")===e&&t.destroyItem(a.id))}),i.default.vmMain.commitUpdateItems()},_getSyncResultFromResult:function(e,t){var a=n.a.SyncResult.Success;if(t&&t.error&&t.error.code){var i=t.error.code;if(i===n.a.HTTPStatusCode.Unauthorized){var r=this._getCalendarInfo(e);a=r&&"owner"===r.accessRole?n.a.SyncResult.FailureOAuth:r&&"writer"===r.accessRole?n.a.SyncResult.FailureNoWrite:n.a.SyncResult.FailureNoRead}else a=i===n.a.HTTPStatusCode.NotFound?n.a.SyncResult.FailureNoRead:i===n.a.HTTPStatusCode.Network?n.a.SyncResult.FailureNetwork:i===n.a.HTTPStatusCode.Forbidden?n.a.SyncResult.FailureNoRead:n.a.SyncResult.FailureUnknown}return a},runCalendarSync:function(e){var t=0,a=0,r=[],s=[],o=function(o,l,d){try{i.default.PAssert(1767,a<t,"Should never have more calendars syncd than we tried to sync")}catch(e){i.default.reportError(e)}o?r.push({id:l,result:n.a.SyncResult.Success}):s.push({id:l,result:this._getSyncResultFromResult(l,d)}),++a===t&&(this._calendarSyncComplete(r,s),e&&e())}.bind(this);this._eventCache.onCacheMetadataReady(function(){this._eventCache.getMetadata(S,function(a){this._updateSyncTimes();var r=this.getSetting(this.Settings.ImportCalendars);if(r&&r.length>0){t=r.length;for(var n=0;n<r.length;++n){var s=r[n];i.default.isObject(s)||(s={id:r[n]});var l,d=a?a[s.id]:void 0;this._shouldExpireToken(d)?(this._notifyTokenExpired(s.id),l=void 0):l=d.token,this.performCalendarSync(s.id,l,o)}for(var c in a){var u=!1;for(n=0;n<r.length;++n){s=r[n];if(i.default.isObject(s)||(s={id:r[n]}),s.id===c){u=!0;break}}u||this._notifyCalendarUnsyncd(c)}}else this._clearAllData(),this._calendarSyncComplete([],[]),e&&e()}.bind(this))}.bind(this))},performCalendarSync:function(e,t,a){try{i.default.PAssert(1768,i.default.isString(e),"Must provide a valid calendar ID for each sync op")}catch(e){i.default.reportError(e)}var r=p.a.fns("calendar").events.list.packedFn,s={calendarId:e,singleEvents:!0};t?s.syncToken=t:(s.timeMin=this._minSyncStartTime.toISOString(),s.timeMax=this._maxSyncStartTime.toISOString());var o=function(t,r,n){var s;n&&(s=n.nextSyncToken,this.setSyncToken(e,s)),i.default.vmMain.beginUpdateItems();for(var o=0;o<t.length;++o)this.handleEventUpdate(e,t[o]);i.default.vmMain.commitUpdateItems(),a(!0,e)}.bind(this),l=function(t){t&&t.error&&t.error.code===n.a.HTTPStatusCode.Gone?this._clearCachedData(e,function(i){i?this.performCalendarSync(e,void 0,a):a(!1,e,t)}.bind(this)):(a(!1,e,t),this._notifyFailedRequest(t,e))}.bind(this);this._queuePagedRemoteRequest(r,s,o,l,void 0,D.EventSync,{getAllPages:!0,timeoutMS:0})},_createEventUpdateInfo:function(e){var t={};for(var a in e)e.hasOwnProperty(a)&&y.indexOf(a)>=0&&(t[a]=e[a]);return t},_notifyOfflineSyncFailures:function(e,t,a){t>0&&(c.a.notifySyncError(a),log("Failed to sync offlineChanges: ",t))},_syncOfflineChanges:function(e){if(!this._syncingOfflineChanges){this._syncingOfflineChanges=!0;var t=0,a=0,r=0,s=[],o=function(i,o){o===n.a.SyncResult.Success?a++:(r++,s.push({id:i,result:o})),t===a+r&&(this._syncingOfflineChanges=!1,e(a,r,s))}.bind(this);this._eventCache.getFilterEntries(function(e){return!!e.modifiedOffline},function(e){t=e.length;for(var a=0;a<e.length;++a){var r=this.createEntryFromLocal(e[a].id,e[a]);r.isInvalid||(i.default.isTempId(r.id)&&!this._pendingCreates[r.id]?this._createRemoteEventFromCacheData(r.calendarID,r,function(){},function(e,t,a){o(e,this._getSyncResultFromResult(e,a))}.bind(this,r.calendarID),function(){}):this.hasWritePermissionForCalendar(r.calendarID)?this._updateRemoteEvent(r.calendarID,r.id,r,D.OfflineUpdate,function(e,t,a){t?(delete r.modifiedOffline,this._eventCache.cacheEntry(r.id,r,function(t){o(e,t?n.a.SyncResult.Success:n.a.SyncResult.FailureUnknown)})):o(e,this._getSyncResultFromResult(e,a))}.bind(this,r.calendarID)):(delete r.modifiedOffline,this._eventCache.cacheEntry(r.id,r,function(e,t){o(e,t?n.a.SyncResult.Success:n.a.SyncResult.FailureUnknown)}.bind(this,r.calendarID))))}}.bind(this))}},_getEventDuration:function(e){try{i.default.PAssert(1769,!e.getField("allDayEvent"),"All day events do not have valid durations")}catch(e){i.default.reportError(e)}var t=e.getField("startTime"),a=e.getField("endTime");try{i.default.PAssert(1770,t&&a,"Must always have valid start and end times")}catch(e){i.default.reportError(e)}return a-t},_computeItemDates:function(e,t,a){try{i.default.PAssert(1771,t.getDate()||t.getRepeatDateString(),"Must have a valid date")}catch(e){i.default.reportError(e)}var r,n;t.getDate()&&(n=(r=t.getDate().clone()).clone().addMilliseconds(t.getDuration())),t.allDayDate()?(e.start={date:r.toString("yyyy-MM-dd"),dateTime:null},e.end={date:n.toString("yyyy-MM-dd"),dateTime:null}):(e.start={dateTime:r.toISOString(),date:null},e.end={dateTime:n.toISOString(),date:null}),e.startTime=r,e.endTime=n},_queueEventUpdate:function(e,t){if(this._updateAttachFromData(e,t),this._eventUpdateTimeout&&clearTimeout(this._eventUpdateTimeout),this._eventUpdateTimeout=setTimeout(this._flushEventUpdateQueue,2e3),!e.isLocalOnlyAttachment()){var a=this._eventUpdateQueue[e.id];if(a)for(var i in t)t.hasOwnProperty(i)&&(a.info[i]=t[i]);else this._eventUpdateQueue[e.id]={attach:e,info:t}}},onShutdown:function(){if(s.a.overQuota&&!i.default.isEmpty(this._pendingCreates))return"Some of your calendar events may have not been fully saved. Continue?"},_flushEventUpdateQueue:function(){this._eventUpdateTimeout=void 0;var e=function(e,t,a,r){e||t?i.default.toasts.clearMessage(MessageID.CalendarSaveFail):i.default.toasts.pushMessage(MessageID.CalendarSaveFail)};for(var t in this._eventUpdateQueue)if(this._eventUpdateQueue.hasOwnProperty(t)){var a=this._eventUpdateQueue[t];this._updateEvent(a.attach,a.info,D.SummaryUpdate,function(){},function(){},e)}this._eventUpdateQueue={}},_handleAttachDeleted:function(e,t){if(t.belongsToItemStore(this.getDefaultItemStore())){var a=e.getField("status");this.deleteCalendarEvent(e,function(r){if(r){var n=function(){this._updateEvent(e,{status:a},D.UndoDelete,function(){},function(e){e||i.default.toasts.pushMessage({text:"There was an error re-adding the event to your calendar",actionText:"RETRY",action:n,timeout:1e4})},function(){});var r=this._createItemText(e.getData());t.setText(r,!0,ChangeType.Local),t.parent()||t.parent(this.getDefaultItemStore().getRoot()),t.getIndex()<0&&t.parent().insertItem(t)}.bind(this);i.default.toasts.pushMessage({text:"Event removed from your calendar.",actionText:"UNDO",action:n,timeout:1e4})}else i.default.toasts.pushMessage({text:"There was an error removing the event from your calendar.",actionText:"RETRY",action:this._handleAttachDeleted.bind(this,e,t),timeout:1e4})}.bind(this))}},notifyItemTextChanged:function(e,t,a){if(a)this._handleAttachDeleted(e,t);else if(e.getField("recurringEventId")&&t.getCalendarParsedText()===e.getField("summary"))i.default.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"});else if(!i.default.isDemoMode())if(t.getDate()){var r,s=t.getCalendarParsedText(),o=e.getField("summary"),l=e.getField("source");if(t.hasAttachmentType(n.a.PluginType.Email)){var d=t.getAttachmentByType(n.a.PluginType.Email);r={title:d.getField("subject"),url:d.getPlugin().createURLForThread(d)}}var c={summary:s,start:void 0,end:void 0,source:void 0},u=!1;s!==o&&(u=!0),l&&!r||!l&&r?u=!0:l&&r&&(l.title===r.title&&l.url===r.url||(u=!0));var h=t.getDate(),f=e.getField("startTime");this.areDatesEqual(f,h)||(u=!0);var p=t.getEndDate(),m=e.getField("endTime");this.areDatesEqual(m,p)||(u=!0),u&&(this._computeItemDates(c,t,e),c.source=r,this._queueEventUpdate(e,c)),e.updateField("isInvalid",!1)}else e.updateField("isInvalid",!0)},_beginIgnorePropertyChanges:function(){this._ignoringPropertyChanges=!0},_endIgnorePropertyChanges:function(){this._ignoringPropertyChanges=!1},_isIgnoringPropertyChanges:function(){return this._ignoringPropertyChanges},notifyItemPropertyChanged:function(e,t,a){if(this.getSetting(this.Settings.WriteAccess)&&!e.getField("locked")&&this.hasWritePermissionForCalendar(e.getField("calendarID"))&&(!i.default.isRemoteChange(a)||!this._isIgnoringPropertyChanges())){var r=e.getField("isComplete"),n=e.getField("isArchived"),s=e.getField("isStarred"),o=e.getField("priority"),l=t.dateCompleted,d=t.isArchived(),c=t.isStarred(),u=t.priority(),h=function(){},f=function(){},p=function(e,t,a,r){e||t?i.default.toasts.clearMessage(MessageID.CalendarSaveFail):i.default.toasts.pushMessage(MessageID.CalendarSaveFail)};this.areDatesEqual(r,l)||(i.default.isLocalChange(a)?this._updateRemoteProperty(e,"isComplete",l,h,f,p):e.updateField("isComplete",l)),n!==d&&(i.default.isLocalChange(a)?this._updateRemoteProperty(e,"isArchived",d,h,f,p):e.updateField("isArchived",d)),s!==c&&(i.default.isLocalChange(a)?this._updateRemoteProperty(e,"isStarred",c,h,f,p):e.updateField("isStarred",c)),o!==u&&(i.default.isLocalChange(a)?this._updateRemoteProperty(e,"priority",u,h,f,p):e.updateField("priority",u))}},_clearCachedData:function(e,t){this.clearSyncToken(e,function(a){a?this.clearCalendarEventCache(e,t):t&&t(!1)}.bind(this))},_clearAllData:function(e){this._eventCache.clearMetadata(function(t){t?this._eventCache.clearCache(function(t){e&&e(t)}):e&&e(!1)}.bind(this)),this.getDefaultItemStore().clearStore()},getAttachmentClass:function(e){var t=["plugin_gcalendar"];return e.isLoaded()&&(e.getField("isInvalid")&&t.push("invalid"),"cancelled"===e.getField("status")&&t.push("eventDeleted")),t},getAttachmentTooltip:function(e){var t;return this.isPluginBlocked()?t="Go premium to view calendar events":e.isLoaded()?(e.isLocalOnlyAttachment()?t="Syncing event...":e.getField("isInvalid")&&(t="Item has an invalid date"),"cancelled"===e.getField("status")&&(t="Item was deleted from Google Calendar")):t="Plugin is loading data",t},matchAttachment:function(e,t){var a=n.a.DatePrefix+e.getField("startTime").toString(d.a.getFormat(DFormat.ShortDayTime));return(e.getField("summary")||"").indexOf(t)>=0||a.indexOf(t)>=0},areDatesEqual:function(e,t){var a=!1;return e&&t?i.default.isDateValid(e)&&i.default.isDateValid(t)&&(a=e.equals(t)):a=!e&&!t,a},parsePriority:function(e){var t=i.default.parseInt(e);return isNaN(t)&&(t=VMLIFlag.None),t},fieldsHaveParseEffect:function(e){return(!e||1!==e.length||"isComplete"!==e[0])&&this._super.fieldsHaveParseEffect.call(this,e)}};r.a.inherit(l.a,v),r.a.extend(v.prototype,I),t.a=v},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(7),s=a(5),o=a(4),l=a(45),d=a(11),c=a(8),u=a(9),h=a(19),f=a(10),p=a(35),m=(a(145),a(37)),g=a(31);window.__TOTAL_PANES=0;function v(){this.enableTempPanePosition=!1,this.totalWidth=new u.a(0),this._panesById={},this._panes=new h.a,this.displayPanes=new h.a,this.isLoading=new u.a(!0),this._isInitialStateLoaded=!1,this.animatePaneSwap=!1,this._iteratingPanes=!1,this._savedPaneState=void 0,i.default.getLoginState()===LoginState.LOGGED_IN&&this.setupInitialTimeout(),this.init()}v.prototype={init:function(){p.a.init(),s.a.forceBind("onResize",this),s.a.forceBind("updateDisplayPanes",this),this._panes.listen(this.updateDisplayPanes),g.a.sidebarChanged.listen(this.onResize),o.a.onResize.listen(this.onResize),d.a.listen("panesChanged",this.updateDisplayPanes),setTimeout(function(){i.default.intro.isVisible.listen(this.onResize)}.bind(this),0),this.onResize()},onPluginGmailToggled:function(){this.savePaneState(),this.loadPanesFromState()},loadInitialState:function(){var e=i.default.isDemoMode()&&s.a.getURLParam("panes"),t=e&&e.split(":");t||this.loadPanesFromState(),t&&this.loadDemoPanes(t),this._isInitialStateLoaded=!0,p.a.selectedChanged.listen(this.onWorkspaceChanged.bind(this))},loadDemoPanes:function(e){this.clearPanes();for(var t=0;t<e.length;t++){var a=e[t].split(",");if("help"===a[0])i.default.vmMain.showHelp();else{var s=a[0],o={};if("1"===s||"Outline"===s?(s=PaneMode.Task,o.viewState={viewMode:r.a.TaskViewMode.Outline}):("2"===s||"Calendar"===s)&&(s=PaneMode.Task,o.viewState={viewMode:r.a.TaskViewMode.Calendar_Week}),a.length>1){if(a[1]){for(var d={text:a[1]},u=a[1].split(" "),h=0;h<u.length;h++){var f=!1,p="-"===u[h][0],m=u[h].replace("-","");if(m.indexOf("//")>=0)f=!0,d.complete=p?-1:1;else if(m.indexOf("*")>=0)f=!0,d.starred=p?-1:1;else if(m.indexOf("!")>=0){var g;f=!0,3===m.length?g=VMLIFlag.P0:2===m.length?g=VMLIFlag.P1:1===m.length&&(g=VMLIFlag.P2),d.priority=g}f&&(d.text=d.text.replace(u[h],""))}o.search=d}var v=void 0;a[2]&&(v=n.a.getModel(a[2])),o.item=v||n.a.getRootModel()}var y=l.a.createPane(s,o);y&&this.addPaneAtIndex(y)}}var S=this.getPaneAtIndex(0);try{i.default.PAssert(1272,S,"Must always have at least one valid pane in demo mode")}catch(e){i.default.reportError(e)}S&&(c.a.setFocusedPane(S),i.default.vmMain.zoomin(S.getItem(),!0))},getStats:function(e){var t={};return void 0===e?this.runForEachPane(function(e){t[e.id]=e.getStats()}):t=this.getPaneById(e).getStats(),t},setupInitialTimeout:function(){0===this._panes.length()&&(this._initialTimeout=setTimeout(this._timeoutLoadFailed.bind(this),3e4))},_timeoutLoadFailed:function(){i.default.reportError(new Error("Pane Load Timeout")),this._initialTimeout=void 0},notifyPanes:function(){this._panes.notify()},getPaneTopPadding:function(){return i.default.paneTop},onResize:function(){this.updatePaneRects()},getNextPaneID:function(){return++window.__TOTAL_PANES+"P"+Date.now()},getAllPerPaneState:function(e,t){for(var a=[],i=this.paneCount(),r=0;r<i;++r){var n=this.getPaneAtIndex(r);a.push(n.getPerPaneState(e,t))}return a},setAllPerPaneState:function(e,t,a){for(var i=this.paneCount(),r=0;r<i;++r){this.getPaneAtIndex(r).setPerPaneState(e,t,a)}},deletePerPaneState:function(e,t){var a=this.getPaneById(e);a&&a.deletePerPaneState(t)},addWorkspace:function(){try{i.default.PAssert(1273,!0,"Should never add a new workspace on mobile")}catch(e){i.default.reportError(e)}var e=p.a.add();return this.switchToWorkspace(e),e},switchToWorkspace:function(e){this.savePaneState(!0),p.a.switchTo(e)},getPaneState:function(){return p.a.getPaneState()},hasLoadedPaneState:function(){return p.a.hasLoadedPaneState()},savePaneState:function(e){try{i.default.PAssert(1274,!this._isLoading,"Bad stuff! Saving pane state during load")}catch(e){i.default.reportError(e)}if(this._isInitialStateLoaded){var t=this.recreatePaneState();p.a.savePaneState(t,e)}},updatePaneStateForPane:function(e){try{i.default.PAssert(1275,e,"Must pass in a valid pane to update")}catch(e){i.default.reportError(e)}this.savePaneState()},recreatePaneState:function(){var e=[];return this.runForEachPane(function(t){e.push(t.getSaveInfo())}),e},loadPaneFromState:function(e){if(e.id&&this.isPaneActive(e.id))return this._panesById[e.id];var t=e.item||e.focus,a=t&&n.a.getModel(t);a&&a.isDeleted()&&(a=void 0);var r,s=e.type||"PaneTask",o=i.default.clone(e);return o.item=a,o.deferredItemID=a?void 0:t,o.offset=e.offset,o.id&&this.isPaneActive(o.id)||(r=l.a.createPane(s,o))&&(e.id=r.id,e.showarch&&r.showArchived.set(!0),r.applyItemState(e.itemState)),r},loadPanesFromState:function(){var e=this.getPaneState();if(e){var t=!1;this._isLoading=!0;var a=[];if(i.default.vmMain.beginUpdateItems(),this.paneCount()>0){for(var r=0;r<this.paneCount();++r){var n=this.getPaneAtIndex(r);a.push(n.id),this.unloadPane(n)}this._panes.set([])}for(r=0;r<e.length;++r){var s=e[r];a.indexOf(s.id)>=0&&(s.id=this.getNextPaneID()),(n=this.loadPaneFromState(s))?(this.addPaneAtIndex(n,void 0,!0,!1),c.a.setFocusedPane(n,!0),i.default.vmMain.zoomin(n.getItem(),!0)):(e.splice(r,1),t=!0,--r)}this.paneCount()>0&&c.a.setFocusedPane(this.getPaneAtIndex(0)),this._isLoading=!1,t&&this.savePaneState(),this.notifyPanes(),i.default.vmMain.commitUpdateItems()}},isPaneActive:function(e){return!!this._panesById[e]},createDefaultPane:function(){if(p.a.length()<2){var e=l.a.createPane(PaneMode.Task,{id:this.getNextPaneID(),isDefaultPane:!0,isOverviewVisible:!0});this.addPaneAtIndex(e),c.a.setFocusedPane(this.getPaneAtIndex(0)),i.default.vmMain.zoomin(i.default.vmMain.root(),!0)}},createPaneAtIndex:function(e,t,a,r){try{i.default.PAssert(1278,e,"Must supply a valid pane type")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1279,!this._iteratingPanes,"Should not change pane array while iterating")}catch(e){i.default.reportError(e)}isNaN(t)&&(t=this.paneCount()),(a=a||{}).id=a.id||this.getNextPaneID();var n=l.a.createPane(e,a);return n?this.addPaneAtIndex(n,t,!1,r):i.default.reportError(new Error("Invalid pane created: "+e+" | "+t)),n},addPaneAtIndex:function(e,t,a,n){try{i.default.PAssert(1280,e,"Must supply a valid pane")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1281,!this._panesById[e.id],"Should never add the same pane twice")}catch(e){i.default.reportError(e)}if(this._panesById[e.id]=e,this.enableTempPanePosition&&this._panes.length()>0&&t===this._panes.length()){var s=this._panes.get()[this._panes.length()-1];this.tempPositionForNewPane={pane:s,left:s.rect.get().left+r.a.PaneSpaceSize}}if(isNaN(t)?this._panes.push(e,n):this._panes.splice(t,0,e,n),e.init(),e.isExpanded.listen(this.onResize),this.tempPositionForNewPane&&(this.tempPositionForNewPane=null,setTimeout(this.onResize.bind(this),0)),this.ensurePaneInView(e),!a){var o=this.getPaneState();isNaN(t)?o.push(e.getSaveInfo()):o.splice(t,0,e.getSaveInfo()),this.savePaneState()}},unloadPane:function(e){e.isExpanded.unlisten(this.onResize),d.a.fireEvent("paneRemoved",[e]);try{i.default.PAssert(1282,this._panesById[e.id],"Should never add the same pane twice")}catch(e){i.default.reportError(e)}this._panesById[e.id]=void 0,e.destroy()},removePaneAtIndex:function(e,t,a){try{i.default.PAssert(1283,!isNaN(e),"Must supply a valid index to remove from")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1284,!this._iteratingPanes,"Should not change pane array while iterating")}catch(e){i.default.reportError(e)}this.getPaneAtIndex(e);var r,n=this._panes.splice(e,1,void 0,t)[0];try{i.default.PAssert(1285,n,"Must have removed a valid pane")}catch(e){i.default.reportError(e)}return this.unloadPane(n),this.getPaneState().splice(e,1),this.savePaneState(),r=n.id,this.ensurePaneInView(),r},removePanesByType:function(e){var t=[];this.runForEachPane(function(e){t.push(e)},e);for(var a=0;a<t.length;++a)this.removePane(t[a])},indexOfPaneType:function(e){return this._panes.indexOfWithProperty("type",e)},swapToPane:function(e,t){try{i.default.PAssert(1287,!1,"We only perform pane swapping on mobile")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1288,!this._iteratingPanes,"Should not change pane array while iterating")}catch(e){i.default.reportError(e)}m.a.setOverviewVisibility(i.default.focusedPane,!1);var a=this.indexOfPaneType(e);a<0&&(this.loadPanesFromState(),a=this.indexOfPaneType(e));var r=this._panes.get()[a];this.animatePaneSwap=t;try{i.default.PAssert(1289,r,"Swapping to undefined pane",e,this._panes.length())}catch(e){i.default.reportError(e)}return c.a.setFocusedPane(r),this.mobilePaneSelected.set(e),this.savePaneState(),r},removeFocusedPane:function(){return this.removePane(i.default.focusedPane)},removePane:function(e){var t=this.getPaneIndex(e);return this.removePaneAtIndex(t)},clearPanes:function(e){try{i.default.PAssert(1290,i.default.isDemoMode(),"Should only be clearing panes in demo mode")}catch(e){i.default.reportError(e)}c.a.setFocusedPane(void 0),this.runForEachPane(function(e){e.destroy()}),this._panesById={},this._panes.set([],e)},clearPaneCaches:function(){this.runForEachPane(function(e){e.getInfiniteList().clearCache()})},getPaneAtIndex:function(e){return this._panes.get()[e]},getPaneIndex:function(e){return this._panes.get().indexOf(e)},getFocusedPaneIndex:function(){return this.getPaneIndex(i.default.focusedPane)},getPaneById:function(e){try{i.default.PAssert(1293,this._panesById[e],"Should never request a pane that is not currently loaded")}catch(e){i.default.reportError(e)}return this._panesById[e]},getPanesByType:function(e){for(var t=[],a=this.paneCount(),i=0;i<a;++i){var r=this.getPaneAtIndex(i);e&&r.type!==e||t.push(r)}return t},paneCount:function(){return this._panes.get().length},runForEachPane:function(e,t){this._iteratingPanes=!0;for(var a=this.paneCount(),r=0;r<a;++r){var n=this.getPaneAtIndex(r);try{i.default.PAssert(1294,!n.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(e){i.default.reportError(e)}if(!t||n.type===t)try{e(n)}catch(e){i.default.reportError(e)}}this._iteratingPanes=!1},applyFnToPanes:function(e,t){this._iteratingPanes=!0;for(var a=this.paneCount(),r=0;r<a;++r){var n=this.getPaneAtIndex(r);try{i.default.PAssert(1295,!n.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(e){i.default.reportError(e)}if(!t||n.type===t){var s=n[e];try{i.default.PAssert(1296,s,"Must provide a valid function name for the given pane type")}catch(e){i.default.reportError(e)}try{s.apply(n,Array.prototype.slice.call(arguments,2))}catch(e){i.default.reportError(e)}}}this._iteratingPanes=!1},dragPaneTo:function(e,t,a){for(var i,r=this._panes.get(),n=r.indexOf(e),s=-1,o=Number.MAX_VALUE,l=this.paneCount(),d=0;d<l;++d){var c=this.getPaneAtIndex(d).rect.get(),u=Math.abs(d<=n?c.left-t:c.right-a);u<o&&(o=u,s=d)}if(s>=0){var h=r.indexOf(e);h!==s&&(r.splice(s,0,r.splice(h,1)[0]),this._panes.set(r),this.savePaneState(),i=!0)}return i},paneSortFn:function(e,t){return e.uniquePaneID-t.uniquePaneID},clearLoadTimeout:function(){clearTimeout(this._initialTimeout),this._initialTimeout=void 0},updateDisplayPanes:function(){this._initialTimeout&&this.clearLoadTimeout();for(var e=this._panes.get().slice(0).sort(this.paneSortFn),t=[],a=0;a<e.length;++a){var i=e[a];i.isOverviewVisible()&&t.push({type:"overview",pane:i}),t.push({type:"pane",pane:i}),i.isExpanded.get()&&t.push({type:"emailPreview",pane:i})}this.updatePaneRects(),this.displayPanes.set(t),this.isLoading.set(!1)},updatePaneRects:function(){var e,t,a=this._panes.get(),n=g.a.getSidebarWidth(),s=o.a.windowWidth()-(g.a.getSidebarWidth()-2),l=o.a.windowHeight()-this.getPaneTopPadding();if(i.default.isDemoInIframe()&&(s-=5),a.length>0){var c,u=r.a.PaneSpaceSize,h=[],f=[],p=0;for(t=0;t<a.length;t++)(e=a[t]).isExpanded.get()?(f[t]=r.a.ExpandedPaneWidth,p+=o.a.emailPreviewSize()+r.a.ExpandedPaneWidth):h.push({index:t,pane:e}),e.getOverview().isVisible.get()?p+=r.a.OverviewWidth:t>0&&(p+=u);for(var m=s-p;h.length>0;){var v=Math.floor(m/h.length),y=-1,S=v;for(t=0;t<h.length;t++)(e=h[t].pane).maxWidth<S&&(y=t,S=e.maxWidth);if(y>=0)c=h[y].pane.maxWidth,f[h[y].index]=c,p+=c,m-=c,h.splice(y,1);else{var E=-1,P=v;for(t=0;t<h.length;t++)(e=h[t].pane).minWidth>P&&(E=t,P=e.minWidth);if(!(E>=0)){for(t=0;t<h.length;t++)f[h[t].index]=v,p+=v;break}c=h[E].pane.minWidth,f[h[E].index]=c,p+=c,m-=c,h.splice(E,1)}}var b=Math.max((s-p)/2,0),C=Math.floor(b)+n,D=!1;for(C!==Math.round(b)&&(D=p+1===s),i.default.isDemoInIframe()&&(C+=2),t=0;t<a.length;t++)e=a[t],c=f[t]+(D&&t===a.length-1?1:0),e.isOverviewVisible()?C+=r.a.OverviewWidth:0!==t&&(C+=u),this.tempPositionForNewPane&&e.rect.get()?(e.rect.get().width=c,e.rect.notify()):e.rect.set({left:C,top:0,width:c,height:l,right:C+c,bottom:l,isFirst:0===t}),C+=c,e.isExpanded.get()&&(C+=o.a.emailPreviewSize());i.default.intro&&i.default.intro.isVisible&&i.default.intro.isVisible.get()&&(C+=u,i.default.intro.position.set(C))}if(this.tempPositionForNewPane){var I=a[a.length-1].rect.get(),A=this.tempPositionForNewPane;I.left=A.left+A.pane.rect.get().width}this.totalWidth.set(C),d.a.fireEvent("paneSizeChanged",[])},ensurePaneInView:function(e){if(i.default.vmMain.panesContainer){if(!e){var t=this._panes.get();e=t[t.length-1]}if(e){var a=e.rect.get();if(a){var r=a.width+(e.isExpanded.get()?o.a.emailPreviewSize():0),n=o.a.windowWidth()-(g.a.getSidebarWidth()-2),s=i.default.vmMain.getScrollOffset(),l=a.left-s,d=a.left+r-s;(l<0||d>n)&&i.default.vmMain.setScrollOffset(a.left+r-n)}}}},hasScrollbar:function(){return this.totalWidth.get()>o.a.windowWidth()},onWorkspaceChanged:function(){this.loadPanesFromState()},_addPaneByButton:function(e,t,a,r){var n=this.createPaneAtIndex(e,void 0,{viewState:{viewMode:t},item:a});n&&(f.a.performAction(TrackerType.UIAction,{type:TrackerUIAction.AddPane,data:{type:e,pane:n}}),i.default.sendEvent("Menu","AddPane_"+e)),n.onAdded(r)},addPaneByButton:function(e,t,a,r){i.default.vmMain.paneFactory.canCreatePane(e)&&this._addPaneByButton(e,t,a,r)}},s.a.defineBase(v),t.a=v},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(9),s=a(45);function o(){}o.prototype={init:function(){this._isLoaded=!1,this._isSaving=!1,this._docID=void 0,this._state=void 0,this._historyOfPanes={},this.selected=new n.a(PaneMode.Task),i.default.settings.listen("settingChanged",Settings.DefaultGroup,Settings.paneHistoryMobile,this.onSettingChanged.bind(this))},getDocID:function(){return this._docID||(this.trackPaneState()?this._docID=i.default.settings.get(Settings.gdocId):this._docID="TEST"),this._docID},loadPanesFromState:function(){try{i.default.PAssert(1623,this.getDocID(),"Should have a docID before loading mobile panes from state")}catch(e){i.default.reportError(e)}this.load();var e=[];return i.default.vmMain.pluginManager.isGmailPaneEnabled()&&e.push(this.loadPaneFromState(PaneMode.Gmail)),e.push(this.loadPaneFromState(PaneMode.Task)),e},loadPaneFromState:function(e){var t,a=this.getHistoryByType(e);return(t=a&&a.length>0&&a[0].type===e?i.default.vmMain.paneManager.loadPaneFromState(a[0]):s.a.createPane(e)).init(),t},hasLoadedPaneState:function(){return!!this._historyOfPanes},getPaneState:function(){this._historyOfPanes||this.load();var e=[];return i.default.vmMain.pluginManager.isGmailPaneEnabled()&&e.push(this.getHistoryByType(PaneMode.Gmail)[0]),e.push(this.getHistoryByType(PaneMode.Task)[0]),e},savePaneState:function(e){try{i.default.PAssert(1624,e&&e.length>0,"Must provide at least one valid pane")}catch(e){i.default.reportError(e)}if(e[0]){var t=this.getDocumentState();try{i.default.PAssert(1625,t,"Document pane state must exist")}catch(e){i.default.reportError(e)}if(t){try{i.default.PAssert(1626,t.panes,"Panes must be defined here")}catch(e){i.default.reportError(e)}t.panes||(t.panes={});for(var a=0;a<e.length;a++){var r=e[a];this._historyOfPanes[r.type]=t.panes[r.type]=[r]}}}this.save()},getDocumentState:function(){var e=this.getDocID();return this._state[e]},getHistoryByType:function(e){var t=this._historyOfPanes[e];return t&&t[0]||(this._historyOfPanes[e]=[]),this._historyOfPanes[e]},migrateFromPaneState:function(e){var t={};for(var a in e)if(e.hasOwnProperty(a)){var i=e[a];t[a]=this.createDefaultState(i),i[0]&&(t[a].selected=i[0].type)}return t},createDefaultState:function(e){var t={selected:PaneMode.Task,panes:{}};if(e)for(var a=0;a<e.length;a++)t.panes[e[a].type]=[e[a]];return t},load:function(){var e,t,a=this.getDocID(),n=!1;if(a){if(this.trackPaneState()){var s=i.default.settings.get(Settings.paneHistoryMobile);if(s)try{t="A",e=JSON.parse(s),t="AA"}catch(e){i.default.reportError(e),t="AB"}else{t="B",n=!0;var o=r.a.storage.getItem("paneState");if(o){try{o=JSON.parse(o),t="BA"}catch(e){t="BB",i.default.reportError(e),o={}}e=this.migrateFromPaneState(o)}else t="C"}}else t="D";var l=(e=e||{})[a];l||(l=e[a]=this.createDefaultState([]),n=!0),l.selected||(l.selected=PaneMode.Task);try{i.default.PAssert(1627,l.panes,"Should have panes set by now",t)}catch(e){i.default.reportError(e)}l.panes||(l.panes={}),this._state=e,this._historyOfPanes=l.panes||{},this.selected.set(l.selected),n&&this.save()}else this._state={},this.selected.set(PaneMode.Task);this._isLoaded=!0},save:function(){if(this.trackPaneState()){this._isSaving=!0;var e=this.getDocumentState();try{i.default.PAssert(1628,e,"Document pane state must exist")}catch(e){i.default.reportError(e)}e&&(e.selected=this.selected.get());try{i.default.settings.set(Settings.paneHistoryMobile,JSON.stringify(this._state))}catch(e){i.default.reportError(e)}this._isSaving=!1}},trackPaneState:function(){return!i.default.isRunningScript()&&!i.default.isDemoMode()},onSettingChanged:function(){this._isSaving||this.load()}};new o},function(e,t,a){"use strict";var i=a(0),r=(a(4),a(15)),n=a(147),s=a(148);function o(){this._activeDocuments={},this._activeTypes={},this._authorizedTypes={},this._listeners=[],this.init()}window.DocType={GRealtime:0,GAppData:1},o.prototype={init:function(){var e=function(){window.gapi.drive?(this._activateType(DocType.GRealtime),this._activateType(DocType.GAppData)):(i.default.reportError(new Error("Fatal error while loading google drive - did not add self to gapi")),window.addEventListener("gapiDriveLoaded",e.bind(this)))}.bind(this);window.gapi&&window.gapi.drive?e():window.addEventListener("gapiDriveLoaded",e.bind(this))},_activateType:function(e){if(this._activeTypes[e])try{i.default.PAssert(1267,!1,"Should only be activating a doc type once")}catch(e){i.default.reportError(e)}else this._activeTypes[e]=!0,this._authorizedTypes[e]&&this._notifyListeners(e)},_authorizeType:function(e){this._authorizedTypes[e]||(this._authorizedTypes[e]=!0,this._activeTypes[e]&&this._notifyListeners(e))},registerForReadyNotification:function(e,t){if(i.default.isArray(this._listeners[e]))this._listeners[e].push(t);else if(void 0===this._listeners[e])this._listeners[e]=[t];else{try{i.default.PAssert(1268,-1===this._listeners[e],"After a type is loaded, do not queue listners")}catch(e){i.default.reportError(e)}t()}},_notifyListeners:function(e){if(i.default.isArray(this._listeners[e]))for(var t=0;t<this._listeners[e].length;++t)this._listeners[e][t]();this._listeners[e]=-1},notifyGoogleAuthorization:function(){for(var e=r.a.getAuthorizedScopes(),t=0;t<e.length;++t)switch(e[t]){case GScope.Drive:case GScope.DriveFull:this._authorizeType(DocType.GRealtime);break;case GScope.DriveAppData:this._authorizeType(DocType.GAppData)}},createDocument:function(e,t){try{i.default.PAssert(1269,e,"Must provide a document type")}catch(e){i.default.reportError(e)}t=t||i.default.generateTempId();try{i.default.PAssert(1270,!this._activeDocuments[t],"Should not name two documents the same thing")}catch(e){i.default.reportError(e)}var a;switch(e){case DocType.GRealtime:a=new n.a(t);break;case DocType.GAppData:a=new s.a(t);break;default:try{i.default.PAssert(1271,!1,"Invalid document type requested",e)}catch(e){i.default.reportError(e)}}return this._activeDocuments[t]=a,a}},t.a=o},function(e,t,a){"use strict";var i=a(5),r=a(89),n=a(17);function s(e){this._super.constructor.call(this,DocType.GRealtime,e),this.init()}var o={init:function(){},open:function(e,t,a,i){n.a.driveRealtimeLoad(e,this.setLoadFn(t),this.setInitFn(a),this.setErrorFn(i))},close:function(){}};i.a.inherit(r.a,s),i.a.extend(s.prototype,o),t.a=s},function(e,t,a){"use strict";var i=a(5),r=a(89);function n(e){this._super.constructor.call(this,DocType.GAppData,e),this.init()}var s={init:function(){},open:function(e,t,a,i){gapi.drive.realtime.loadAppDataDocument(this.setLoadFn(t),this.setInitFn(a),this.setErrorFn(i))},close:function(){}};i.a.inherit(r.a,n),i.a.extend(n.prototype,s),t.a=n},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(150);function s(){this._tasks={},this.init()}var o={init:function(){window.addEventListener("focus",this._handleFocus.bind(this)),window.addEventListener("blur",this._handleBlur.bind(this))},getStats:function(){var e={};for(var t in this._tasks)e[t]=this._tasks[t].getStats();return e},createRecurringTask:function(e,t){try{i.default.PAssert(1341,!this._tasks[e],"Must not register multiple tasks with the same ID")}catch(e){i.default.reportError(e)}var a=new n.a(e,t);return this._tasks[e]=a,a},getRecurringTask:function(e){try{i.default.PAssert(1342,this._tasks[e],"Must only retreive a valid recurring task")}catch(e){i.default.reportError(e)}return this._tasks[e]},hasRecurringTask:function(e){return!!this._tasks[e]},cancelRecurringTask:function(e){try{i.default.PAssert(1343,this._tasks[e],"Must only cancel a valid recurring task")}catch(e){i.default.reportError(e)}this._tasks[e].cancel(),delete this._tasks[e]},_handleFocus:function(){for(var e in this._tasks)this._tasks[e].notifyOfResume()},_handleBlur:function(){for(var e in this._tasks)this._tasks[e].notifyOfSuspend()}};r.a.extend(s.prototype,o),t.a=s},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(51),s="Suspend",o="Resume",l="AsyncSkip",d="SyncSkip",c="Run",u="AsyncBegin",h="AsyncComplete",f="AsyncAbort",p="AsyncTimeout";function m(e,t){try{i.default.PAssert(1611,t,"Must provide a valid set of task options: "+e)}catch(e){i.default.reportError(e)}this._id=e,this._iterationID=void 0,this._isAsync=t.async,this._isAsyncRunning=!1;try{i.default.PAssert(1613,t.task&&i.default.isFunction(t.task),"Must provide a valid task function")}catch(e){i.default.reportError(e)}this._task=t.task,this._delay=t.delay;try{i.default.PAssert(1614,void 0===t.asyncTimeout||t.async,"Should never specify an async timeout for a non-async task")}catch(e){i.default.reportError(e)}this._asyncTimeout=t.asyncTimeout||0,this._pauseWhileIdle=t.pauseWhileIdle||!1,this._minDelayOnResume=t.minDelayOnResume||!1;try{i.default.PAssert(1615,this._pauseWhileIdle||!this._minDelayOnResume,"Must use pauseWhileIdle to support minDelayOnResume")}catch(e){i.default.reportError(e)}this._suspended=!1,this._remainingTime=0,this._lastUpdate=t.runOnCreate?0:Date.now(),this._asyncStartTime=-1,this._numUpdatesRun=0,this._numUpdatesSkipped=0,this._numUpdatesAsyncSkipped=0,this._numAsyncAborts=0,this._numAsyncTimeouts=0,this._minDelay=t.minDelay||0,this._lastSetDelay=this._delay,this._runningTimeout=void 0,this._asyncAbortTimeout=void 0,this._updateIsRunning=!1,this._isCancelled=!1,this._updateTimes=new n.a(10),this._actions=new n.a(20),this.init()}var g={init:function(){r.a.forceBind("_runUpdate",this),r.a.forceBind("_notifyAsyncComplete",this),r.a.forceBind("_handleAsyncAbortTimeout",this),this._lastUpdate>0?(clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,this._delay)):this._runUpdate()},getStats:function(){var e={numUpdatesRun:this._numUpdatesRun,numUpdatesSkipped:this._numUpdatesSkipped,numUpdatesAsyncSkipped:this._numUpdatesAsyncSkipped,numAsyncAborts:this._numAsyncAborts,numAsyncTimeouts:this._numAsyncTimeouts,updateIsRunning:this._updateIsRunning,isAsync:this._isAsync,isAsyncRunning:this._isAsyncRunning,cancelled:this._isCancelled,suspended:this._suspended,lastUpdate:this._lastUpdate,asyncRunTime:this._asyncRunTime(),timeSinceLastUpdate:this._timeSinceLastUpdate(),updateTimes:this._updateTimes.ordered(),actions:this._actions.ordered()};return e},cancel:function(){this._isCancelled=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0},abortAsync:function(){this._numAsyncAborts++,this.performAction(f),this._notifyAsyncAborted()},performAction:function(e){try{i.default.PAssert(1616,e,"Invalid action reported")}catch(e){i.default.reportError(e)}this._actions.push({action:e,time:Date.now()})},notifyOfSuspend:function(){this._pauseWhileIdle&&(this.performAction(s),this._suspended=!0,this._remainingTime=Math.max(0,this._lastSetDelay-this._timeSinceLastUpdate()),clearTimeout(this._runningTimeout),this._runningTimeout=void 0)},notifyOfResume:function(){if(this._pauseWhileIdle){this.performAction(o);var e,t=!this._suspended;if(this._suspended=!1,this._minDelayOnResume)e=Math.max(0,this._minDelay-this._timeSinceLastUpdate());else{try{i.default.PAssert(1617,t||this._remainingTime>=0,"Must have a valid remaining time set for task")}catch(e){i.default.reportError(e)}e=this._remainingTime,this._remainingTime=-1}e=Math.max(500,e),clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e)}},isAsync:function(){return this._isAsync},isAsyncRunning:function(){return this.isAsync()&&this._isAsyncRunning},_notifyUpdateAsyncSkipped:function(){this._numUpdatesAsyncSkipped++,this.performAction(l)},_notifyUpdateSkipped:function(){this._numUpdatesSkipped++,this.performAction(d)},_notifyUpdateRun:function(){this._lastUpdate=Date.now(),this._updateTimes.push(this._lastUpdate),this._numUpdatesRun++,this.performAction(c)},_timeSinceLastUpdate:function(){return Date.now()-this._lastUpdate},_asyncRunTime:function(){var e=0;return this._asyncStartTime>0&&(e=Date.now()-this._asyncStartTime),e},_notifyAsyncBegin:function(){return this.performAction(u),this._isAsyncRunning=!0,this._iterationID=i.default.generateTempId(),this._asyncStartTime=Date.now(),this._asyncTimeout&&(this._asyncAbortTimeout=setTimeout(this._handleAsyncAbortTimeout,this._asyncTimeout)),this._iterationID},_notifyAsyncComplete:function(){this.performAction(h),this._isAsyncRunning=!1,this._asyncStartTime=-1,this._iterationID=void 0,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)},_notifyAsyncAborted:function(){this._isAsyncRunning=!1,this._asyncStartTime=-1,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)},_handleAsyncAbortTimeout:function(){this._numAsyncTimeouts++,this.performAction(p),this._notifyAsyncAborted()},_runUpdate:function(e){try{i.default.PAssert(1618,!this._isCancelled,"Should never run a cancelled task")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1620,!this._updateIsRunning,"Should not run another update while already running one: "+this._id)}catch(e){i.default.reportError(e)}if(!this._updateIsRunning){if(this._updateIsRunning=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0,this._notifyUpdateRun(),this.isAsync())if(this.isAsyncRunning())this._asyncTimeout&&this._asyncTimeout<this._asyncRunTime()?(this.abortAsync(),setTimeout(this._runUpdate.bind(this,e),0)):this._notifyUpdateAsyncSkipped();else{var t=this._notifyAsyncBegin();try{this._task(function(){try{i.default.PAssert(1622,t===this._iterationID,"Callback is only valid while task is considered running")}catch(e){i.default.reportError(e)}this._notifyAsyncComplete(),e&&e.apply(this,arguments)}.bind(this))}catch(e){i.default.reportError(e),this._notifyAsyncComplete()}}else try{this._task()}catch(e){i.default.reportError(e)}this._runningTimeout=setTimeout(this._runUpdate,this._delay),this._lastSetDelay=this._delay,this._remainingTime=this._delay,this._updateIsRunning=!1}},requestUpdate:function(){if(this._timeSinceLastUpdate()>this._minDelay)this._runUpdate();else{this._notifyUpdateSkipped();var e=this._minDelay-this._timeSinceLastUpdate();clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e),this._lastSetDelay=this._minDelay}},forceUpdate:function(e){this._runUpdate(e)},breakOnNextUpdate:function(){0}};r.a.extend(m.prototype,g),t.a=m},function(e,t,a){"use strict";var i=a(0),r=a(152),n=a(58);function s(){this._taskCache=n.a.registerLocalCache("DeferredTasks","DeferredTasks",StorageType.LocalStorage),this._registeredTypes={},this._deferredTasks={},this._stats={},this.init()}s.prototype={init:function(){this._taskCache.onCacheReady(function(){this._taskCache.loadAll(function(e){try{i.default.PAssert(1328,e,"Must be able to load task cache")}catch(e){i.default.reportError(e)}this._taskCache.getFilterEntries(function(){return!0},function(e){for(var t=0;t<e.length;++t){var a=e[t];this.scheduleTask(a.id,a.type,new Date(a.scheduleDate),a.isCanceled,a.remoteID,a.data,!0)}}.bind(this))}.bind(this))}.bind(this))},getLastSyncDate:function(){var e=i.default.settings.get(Settings.lastTaskSync);try{i.default.PAssert(1329,!e||i.default.isString(e),"Must have a valid string sync date")}catch(e){i.default.reportError(e)}return e},getStats:function(){return{}},notifyRemoteTasks:function(e){for(var t=0;t<e.length;++t)this._handleRemoteTask(e[t]);i.default.settings.set(Settings.lastTaskSync,new Date)},_handleRemoteTask:function(e){log("Remote Task: ",e),this.scheduleTask(e.data.threadID,e.type,new Date(e.data.scheduleDate),!1,e.messageID,e.data)},registerTaskType:function(e,t,a,r){try{i.default.PAssert(1330,!this._registeredTypes[e],"Must not double register task type")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1331,i.default.isFunction(t),"Must register a valid run callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1332,i.default.isFunction(a),"Must register a valid cancel callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1333,i.default.isFunction(r),"Must register a valid persist callback")}catch(e){i.default.reportError(e)}this._registeredTypes[e]={cbRun:t,cbCancel:a,cbPersistRemote:r}},_notifyTaskComplete:function(e){this._removeTask(e)},scheduleTask:function(e,t,a,n,s,o,l){try{i.default.PAssert(1334,e,"Must supply a valid task ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1335,t,"Must supply a valid task type")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1336,i.default.isDateValid(a),"Must always have a valid scheduled date available")}catch(e){i.default.reportError(e)}this._taskCache.onCacheReady(function(){try{i.default.PAssert(1337,this._registeredTypes[t],"Must request a valid registered task type")}catch(e){i.default.reportError(e)}if(this._deferredTasks[e]){var d=this._deferredTasks[e];try{i.default.PAssert(1338,d.getType()===t,"Task types must match")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1339,d.getScheduleDate().equals(a),"Task schedule dates must match")}catch(e){i.default.reportError(e)}}else{var c=this._registeredTypes[t];if(c){var u=new r.a(e,t,a,n,s,o,c.cbRun,c.cbCancel,c.cbPersistRemote);if(this._deferredTasks[e]){log("Overriding existing task");try{i.default.PAssert(1340,this._deferredTasks[e].type===t,"Should only update deferred tasks of the same type")}catch(e){i.default.reportError(e)}}this._addTask(e,u,l),n?u.cancel():u.schedule()}}}.bind(this))},cancelTask:function(e,t){this._deferredTasks[e].cancel()},_updateTask:function(e){var t=this._deferredTasks[e];this._taskCache.cacheEntry(e,t.getSaveData())},_addTask:function(e,t,a){this._deferredTasks[e]=t,a||this._updateTask(e)},_removeTask:function(e){this._deferredTasks[e]=void 0,this._taskCache.removeEntry(e)}},t.a=s},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(14);function s(e,t,a,n,s,o,l,d,c){this._id=e,this._remoteID=s,this._type=t;try{i.default.PAssert(1602,i.default.isDateValid(a),"Must specify a valid schedule date for deferred task")}catch(e){i.default.reportError(e)}this._scheduleDate=a,this._timeout=void 0,this._data=o,this._cbRun=l,this._cbCancel=d,this._cbPersistRemote=c,this._hasRun=!1,this._isCanceled=n,this._destroyed=!1,r.a.forceBind("runTask",this),r.a.forceBind("_onCanceled",this),r.a.forceBind("_onPersistedRemote",this)}s.prototype={schedule:function(){try{i.default.PAssert(1603,!this._timeout,"Should not schedule the same task multiple times")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1604,!this._hasRun,"Should not schedule a task once it has already run once")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1605,!this._isCanceled,"Should not schedule canceled tasks")}catch(e){i.default.reportError(e)}var e=Math.max(0,this._scheduleDate.getTime()-Date.now());this._timeout=setTimeout(this.runTask,e),!this._remoteID&&e>0&&n.a.onUserAuthorized("me",function(){try{this._cbPersistRemote(this,this._onPersistedRemote)}catch(e){i.default.reportError(e)}}.bind(this))},_onCanceled:function(e){e&&(this._destroyed=!0,i.default.vmMain.deferredTaskManager._notifyTaskComplete(this._id))},_onPersistedRemote:function(e,t){e&&(this._remoteID=t,i.default.vmMain.deferredTaskManager._updateTask(this._id))},reschedule:function(e){try{i.default.PAssert(1606,!this._hasRun,"Should never reschedule a task that has already run")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1607,!this._isCanceled,"Should not reschedule canceled tasks")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1608,this._timeout,"Must always have already schedule a task that is being rescheduled")}catch(e){i.default.reportError(e)}clearTimeout(this._timeout),this._timeout=void 0,this._scheduleDate=e,this.schedule()},cancel:function(){try{i.default.PAssert(1609,this._timeout||this._remoteID,"Must always have already scheduled (locally or remotely) a task that is being canceled")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1610,!this._hasRun,"Should not cancel tasks that have already been run")}catch(e){i.default.reportError(e)}this._isCanceled=!0,clearTimeout(this._timeout),this._timeout=void 0,this._remoteID&&n.a.onUserAuthorized("me",function(){try{this._cbCancel(this,this._onCanceled)}catch(e){i.default.reportError(e)}}.bind(this)),i.default.vmMain.deferredTaskManager._updateTask(this._id)},runTask:function(){this._timeout=void 0,this._hasRun=!0;try{this._cbRun(this)}catch(e){i.default.reportError(e)}i.default.vmMain.deferredTaskManager._notifyTaskComplete(this._id)},getData:function(){return this._data},getType:function(){return this._type},getScheduleDate:function(){return this._scheduleDate},getSaveData:function(){return{id:this._id,remoteID:this._remoteID,type:this._type,scheduleDate:this._scheduleDate,data:this._data,isCanceled:this._isCanceled}},isPersistedRemote:function(){return!!this._remoteID}},t.a=s},function(e,t,a){"use strict";var i=a(0),r=a(7),n=a(5),s=a(15),o=a(84),l=a(19);function d(){this._openDocuments={},this._docMap={},this._docList=new l.a,this._docListTrashed=new l.a,this._isLoading=!1,this._hasError=!1,this._hasLoadedDocList=!1,this._hasTrashedDocuments=!1,this._loadingCallbacks=[],this.init()}d.prototype={init:function(){0},hasTrashedDocuments:function(){return this._hasTrashedDocuments},loadDocList:function(e){try{i.default.PAssert(1349,this._loadingCallbacks.indexOf(e)<0,"Should never add the same callback twice to doc list load")}catch(e){i.default.reportError(e)}if(this._loadingCallbacks.push(e),!this._isLoading){this._isLoading=!0,this._hasTrashedDocuments=!1;var t=[],a="mimeType='"+s.a.MoodoMimetype+"'",r={maxPageResults:999,maxPages:12},n=function(e,a){try{i.default.PAssert(1350,!a,"Should not have additional results when requesting a file list")}catch(e){i.default.reportError(e)}for(var r=0;r<e.length;++r)e[r].appDataContents||e[r].labels.trashed?e[r].labels.trashed&&(this._hasTrashedDocuments=!0,t.push(new o.a(e[r],!0))):this.loadDocFromData(e[r],!0,!1);this._docListTrashed.set(t),this._docList.notify();for(r=0;r<this._loadingCallbacks.length;++r)try{this._loadingCallbacks[r](!0)}catch(e){i.default.reportError(e)}this._loadingCallbacks=[],this._isLoading=!1,this._hasLoadedDocList=!0,this.isOpenDocTrashed()&&(i.default.menus.confirm("Your document is in the Trash in Google Drive. If it gets deleted from Drive, your data will be lost, so we recommend restoring it. Do you want to restore it now?",function(e){if(e){var t=this.getOpenDoc();i.default.vmMain.remoteAPI().driveFilesUntrash(t.id,function(){i.default.toasts.pushMessage({text:"Successfully removed your document from the trash.",action:MessageAction.Okay})},function(e){var t=i.default.vmMain.getUserEmail();i.default.toasts.pushMessage({text:"There was an error moving your document out of the trash. Click to try manually removing.",action:MessageAction.OpenURL,actionText:"UNTRASH",data:{url:"https://drive.google.com/drive/u/"+t+"/search?q=mimetype=application/vnd.google-apps.drive-sdk.597847337936%20is:trashed"}}),i.default.reportError(new Error("Failed to untrash doc: "+e.error.code),e)})}}.bind(this)),i.default.reportError(new Error("Open doc trashed: "+this.getOpenDoc().id)))}.bind(this),l=function(e,t){this._hasError=!0;for(var a=0;a<this._loadingCallbacks.length;++a){try{this._loadingCallbacks[a](!1,e)}catch(e){i.default.reportError(e)}this._loadingCallbacks=[],this._isLoading=!1}}.bind(this);i.default.vmMain.remoteAPI().driveFilesList(a,n,l,r)}},loadDocFromData:function(e,t,a){try{i.default.PAssert(1351,e,"Must provide valid data to load doc from")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1352,e.id,"Must have valid doc id in data")}catch(e){i.default.reportError(e)}var r=this._docMap[e.id];return r?r.updateData(e,t):(r=new o.a(e,t),this.setDoc(r,a)),r},setDoc:function(e,t){try{i.default.PAssert(1353,e,"Must supply a valid doc to set")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1354,!this._docMap[e.id],"Should never override an existing doc with a new one")}catch(e){i.default.reportError(e)}this._docMap[e.id]=e,this._docList.insertSorted(e,this.sortFn,t)},sortFn:function(e,t){return e.getTitle().localeCompare(t.getTitle())},getAutoDefaultDoc:function(){var e;try{for(var t in this._docMap){var a=this._docMap[t];if(e){var r=new Date(e.getData().lastViewedByMeDate);new Date(a.getData().lastViewedByMeDate).isAfter(r)&&(e=a)}else e=a}}catch(e){i.default.reportError(e)}return e},getDoc:function(e){return this._docMap[e]},hasDoc:function(e){return!!this._docMap[e]},getDocList:function(){return this._docList},isOpenDocTrashed:function(){var e=!1;if(this._hasLoadedDocList){var t=this.getOpenDoc();t&&(e=t.isTrashed())}return e},deleteDoc:function(e,t){var a=this._docMap[e];try{i.default.PAssert(1355,a,"Must be deleting a document that we know about")}catch(e){i.default.reportError(e)}a.deleteData(function(i){i&&(delete this._docMap[e],this._docList.remove(a),a.isOpen()&&(delete this._openDocuments[e],r.a.clearDataAndReload(!0))),t(i)}.bind(this))},deleteAllDocs:function(e){s.a.deleteAllFiles(this._docList.get(),e)},createNewDoc:function(){return new o.a},isLoading:function(){return this._isLoading},getOpenDoc:function(){var e;for(var t in this._openDocuments){e=this._openDocuments[t];break}return e},isDocOpen:function(e){return!!this._openDocuments[e]},setDocOpened:function(e){try{i.default.PAssert(1356,e,"Must specify a valid ID when opening a doc")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1357,!this._openDocuments[e],"Document must not have already been opened")}catch(e){i.default.reportError(e)}var t=this._docMap[e];try{i.default.PAssert(1358,t,"Must supply a valid ID matching a created doc")}catch(e){i.default.reportError(e)}this._openDocuments[e]=t},setDocClosed:function(e){var t=this._openDocuments[e];try{i.default.PAssert(1359,t,"Must have a valid opened doc")}catch(e){i.default.reportError(e)}delete this._openDocuments[e]}},n.a.defineBase(d),t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(1),s=a(42),o=a(155),l=a(43);function d(){this._itemStores={},this._iteratingStores=!1,this.Events={StoreAdded:"StoreAdded",StoreRemoved:"StoreRemoved"},this.init()}d.prototype={init:function(){var e=n.a.ItemStoreFilter.Dates|n.a.ItemStoreFilter.Priority;this.registerItemStore("DefaultStore",void 0,{isReadonly:!1,isDestructible:!1,listenToItemStateChanged:!0,enabledFilters:e}),this._tempItemStore=this.registerItemStore("TempStore",void 0,{isReadonly:!0,isDestructible:!0,trackGlobally:!1,noRegister:!0})},registerItemStore:function(e,t,a){try{i.default.PAssert(1344,!this._itemStores[e],"Should only register a single item store per plugin: ",e)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1345,!this._iteratingStores,"Should never add a store while iterating")}catch(e){i.default.reportError(e)}var r=!0,s=!0,d=!0,c=!0,u=!1,h=n.a.ItemStoreFilter.None,f=l.a.runParseText.bind(l.a);a&&(void 0!==a.isReadonly&&(r=a.isReadonly),void 0!==a.isDestructible&&(s=a.isDestructible),void 0!==a.enabledFilters&&(h=a.enabledFilters),void 0!==a.parserFn&&(f=a.parserFn),void 0!==a.trackGlobally&&(d=a.trackGlobally),void 0!==a.requireStoredEls&&(c=a.requireStoredEls),void 0!==a.listenToItemStateChanged&&(u=a.listenToItemStateChanged));var p=new o.a(e,r,s,d,c,u,h,f,t);return a&&a.noRegister||(this._itemStores[e]=p,this.fireEvent(this.Events.StoreAdded,p.getEnabledFilters(),[p])),p},unregisterItemStore:function(e){try{i.default.PAssert(1346,this._itemStores[e],"Must register an item store before destroying it")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1347,!this._iteratingStores,"Should never remove a store while iterating")}catch(e){i.default.reportError(e)}var t=this._itemStores[e];delete this._itemStores[e],t.destroy(),this.fireEvent(this.Events.StoreRemoved,t.getEnabledFilters(),[t])},getItemStore:function(e){try{i.default.PAssert(1348,this._itemStores[e],"Must register an item store before using it")}catch(e){i.default.reportError(e)}return this._itemStores[e]},getDefaultItemStore:function(){return this._itemStores.DefaultStore},getTempItemStore:function(){return this._tempItemStore},runForEachStore:function(e,t){for(var a in t=t||n.a.ItemStoreFilter.None,this._iteratingStores=!0,this._itemStores){var r=this._itemStores[a];if(t===n.a.ItemStoreFilter.None||r.areFiltersEnabled(t))try{e(r)}catch(e){i.default.reportError(e)}}this._iteratingStores=!1}},r.a.defineBase(d),r.a.extend(d.prototype,s.a),t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(11),s=a(156);function o(e,t,a,r,n,s,o,l,d){this.id=e;try{i.default.PAssert(1633,i.default.isFunction(l),"Must supply a valid parser")}catch(e){i.default.reportError(e)}this._readonly=!!t,this._isDestructible=!!a,this._enabledFilters=o,this._trackGlobally=!!r,this._requireStoredEls=!!n,this._listenToItemStateChanged=!!s,this._parser=l,this._owner=d,this._root=void 0,this._data={},this._destroyed=!1,this.init()}o.prototype={init:function(){r.a.forceBind("updateItems",this),r.a.forceBind("_markPaneDirty",this),this._listenToItemStateChanged&&n.a.listen("itemStateChanged",this.updateItems)},getParser:function(){return this._parser},areFiltersEnabled:function(e){return i.default.isAtLeastOneFlagSet(this._enabledFilters,e)},getEnabledFilters:function(){return this._enabledFilters},isOwner:function(e){return this._owner===e},destroy:function(){try{i.default.PAssert(1634,this._isDestructible,"Item store must be destructible to destroy")}catch(e){i.default.reportError(e)}this._listenToItemStateChanged&&n.a.unlisten("itemStateChanged",this.updateItems),this._destroyed=!0,this.clearStore(),this._root.destroy(),this._root=void 0,this._owner=void 0,r.a.destroy(this)},checkDestroyed:function(){try{i.default.PAssert(1635,!this._destroyed,"Should not be using a destroyed item store")}catch(e){i.default.reportError(e)}},trackGlobally:function(){return this._trackGlobally},requireStoredEls:function(){return this._requireStoredEls},clearStore:function(){if(this._isDestructible){for(var e in i.default.vmMain.beginUpdateItems(),this._data)this._root&&e===this._root.id||this._data[e].destroy();i.default.vmMain.commitUpdateItems()}this._data={},this._root&&(this._root.items.set([]),this._data[this._root.id]=this._root)},createRoot:function(e,t){return this.checkDestroyed(),this._root=this.createItem(e,t,void 0,{isRoot:!0},ChangeType.None),this._root},setRoot:function(e){this.checkDestroyed();try{i.default.PAssert(1636,e,"Must specify a valid root item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1637,e.belongsToItemStore(this),"Root item must belong to this item store")}catch(e){i.default.reportError(e)}this._root=e},createItem:function(e,t,a,r,n){try{i.default.PAssert(1638,a||r&&r.isRoot,"Must always sepcify a valid parentID when creating a new item")}catch(e){i.default.reportError(e)}this.checkDestroyed();try{i.default.PAssert(1639,!this._data[e],"Should never double-create for the same item, should use update instead")}catch(e){i.default.reportError(e)}var o;if(void 0===n&&(n=ChangeType.None),a){o=this._data[a];try{i.default.PAssert(1640,o,"Parent must be valid if defined")}catch(e){i.default.reportError(e)}}var l={id:e,text:t};if(r)for(var d in r)r.hasOwnProperty(d)&&(l[d]=r[d]);var c=new s.a(l,{store:this,parent:o,changeType:n,canDestroy:this._isDestructible,noSave:this._readonly});return this._data[c.id]=c,c},createItemRaw:function(e,t){try{i.default.PAssert(1641,t.parent||t&&(t.isRoot||t.noSave||t.noParentOkay),"Must always sepcify a valid parentID when creating a new item")}catch(e){i.default.reportError(e)}this.checkDestroyed();try{i.default.PAssert(1642,!!t.canDestroy===this._isDestructible,"When creating raw items, canDestroy must match")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1643,!!t.noSave===this._readonly,"When creating raw items, noSave must match")}catch(e){i.default.reportError(e)}t.store=this;var a=new s.a(e,t);try{i.default.PAssert(1644,!this._data[a.id],"Should not create an item that already exists in this store")}catch(e){i.default.reportError(e)}return this._data[a.id]=a,a},destroyItem:function(e){try{i.default.PAssert(1645,this._isDestructible,"ItemStore must be destructible to destroy items")}catch(e){i.default.reportError(e)}var t=this._data[e];try{i.default.PAssert(1646,t,"Must always destroy a valid item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1647,!t.isDestroyed(),"Should never destroy an item twice")}catch(e){i.default.reportError(e)}t.parent()&&(t.parent().removeChild(t,ChangeType.Local),t.parent(void 0)),t.destroy(),delete this._data[e]},modifyItemID:function(e,t){try{i.default.PAssert(1648,e.belongsToItemStore(this),"Item must belong to this item store")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1649,e.id!==t,"Must actually be modifying the item ID")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1650,this._data[e.id],"Must have a valid item stored under the current ID: "+e.id+" - "+t+" - "+e.isDestroyed())}catch(e){i.default.reportError(e)}try{i.default.PAssert(1651,!this._data[t],"Must not be overwriting an existing item"+e.id+" - "+t+" - "+e.isDestroyed())}catch(e){i.default.reportError(e)}delete this._data[e.id],this._data[t]=e},manualModifyItemID:function(e,t){try{i.default.PAssert(1652,!this._data[t],"Must not be overwriting an existing item"+e+" - "+t)}catch(e){i.default.reportError(e)}var a=this._data[e];try{i.default.PAssert(1653,a,"Must have valid item to change its ID")}catch(e){i.default.reportError(e)}a&&(delete this._data[e],this._data[t]=a)},getItem:function(e){return this.checkDestroyed(),this._data[e]},hasItem:function(e){return this.checkDestroyed(),!!this._data[e]},getRoot:function(){return this.checkDestroyed(),this._root},isRoot:function(e){return this.checkDestroyed(),this._root===e},getCount:function(){return this.checkDestroyed(),Object.keys(this._data).length},forEach:function(e){for(var t in this.checkDestroyed(),this._data)this._data[t]&&e(this._data[t])},_markPaneDirty:function(e){e.usesItemStore(this)&&(e===i.default.focusedPane?e.setItemsWillBeDirty():e.setItemsDirty())},updateItems:function(e){e&&!e.belongsToItemStore(this)||(i.default.vmMain.paneManager.runForEachPane(function(t){t.usesItemStore(this)&&(t.preventUpdateItemsForItem&&t.preventUpdateItemsForItem.item===e?t.setItemsWillBeDirty():t.setItemsDirty())}.bind(this)),i.default.vmMain.updateAllItems())}},r.a.defineBase(o),t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(4),s=a(1),o=a(7),l=a(17),d=a(157),c=a(158),u=a(159),h=a(10),f=a(49),p=a(13),m=a(9),g=a(19),v=a(38),y=a(11),S=a(24),E=a(88),P=a(27),b=a(8);window.__TOTAL_ITEMS=0,window.__TOTAL_ARCHIVED_ITEMS=0,window.__TOTAL_ARCHIVE_PARENTS=0;var C=new Date(9e12);function D(e,t){this.__ISVMLI=!0,this.isInitialized=!1;try{i.default.PAssert(2060,t,"Each VMLI must be given a set of additional info")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2061,i.default.isValidChangeType(t.changeType),"Must specify a valid change type when creating a VMLI")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2062,t.store,"Must supply a valid itemStore for each VMLI")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2063,!t.parent||t.parent._store===t.store,"All VMLIs in a tree must share the same owner")}catch(e){i.default.reportError(e)}if(this.__TEMP_InitCalled=!1,this.__TEMP_InitParseCalled=!1,this.__TEMP_ParseCalled=!1,this.__TEMP_SkippedInitParsed=!1,!e.id&&e.data&&e.data.id)e.id=e.data.id;else if(e.id&&e.data)try{i.default.PAssert(2064,e.id===e.data.id,"If passing in a local id and a remote ID, they should match")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2065,void 0===e.v,"We should never be passing in 'v'")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2066,void 0===e.extern,"We should never be passing in 'extern'")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2067,t.store,"Must specify a valid item store this item belongs to")}catch(e){i.default.reportError(e)}this._store=t.store,this._parent=t?t.parent:void 0,this._rawText=e.data?"":e.text,this._searchText=e.data?"":e.text?e.text.toLowerCase():"",this._parsedText=void 0,this._notePreviewText=void 0,this.els=void 0,this._isArchived=e.isArchived||!1,this._numArchivedAncestors=this._parent?this._parent._numArchivedAncestors+(this._parent.isArchived()?1:0):0,this._numArchivedDescendants=0,this._isArchived&&this._notifyAncestorsArchived(!0),r.a.forceBind("itemsHasMutated",this),this.items=new g.a([],this.itemsHasMutated),this._note=void 0,this.itemChanged=new v.a,this._archivedItems=void 0,this._demandLoadChildren=e.demandLoadChildren||!1,this._loadedOnDemandData=!this._demandLoadChildren,this._paginationToken=void 0,this._canDestroy=t.canDestroy||!1,this._destroyed=!1,this._date=void 0,this._dateFormat=e.dateFormat,this._repeatDate=void 0,this._attachments=void 0,this.draggedInPane=new m.a(!1);var a=VMLIFlag.None;e.isComplete&&(a|=VMLIFlag.Complete),e.isStarred&&(a|=VMLIFlag.Starred),e.isNote&&(a|=VMLIFlag.Note),e.isArchived&&(a|=VMLIFlag.Archived),e.priority&&(a|=e.priority),this.flags=new m.a(a),this.prefix=void 0,this._favorites=void 0,this._dateText=e.dateText,this.dateCreated=e.dateCreated?new Date(e.dateCreated):new Date,this.dateCompleted=e.dateCompleted?new Date(e.dateCompleted):void 0,this._durationMS=e.duration,this._durationText=e.durationText,this._activeTags=void 0,this._isDeleted=e.isDeleted||!1,this.modifiedOffline=void 0,this.modifiedOfflineText=void 0,this.highlightTimeout=void 0,this.data=void 0,this._version=window.UninitializedVersion,this._versionText=window.UninitializedVersion,this._versionRemote=void 0,this._versionRemoteText=void 0,this.lastFindPass=0,this.isEditable=new m.a(t.isEditable||!1),this.levelsDeep=new m.a(this._parent?this._parent.levelsDeep.get()+1:0),this.isHighlighted=new m.a,window.__TOTAL_ITEMS++,e.isArchived&&window.__TOTAL_ARCHIVED_ITEMS++,this._needsParse=!1,this.isLoaded=void 0,this.init(e,t),r.a.forceBind("dragScroll",this),r.a.forceBind("onTouchHoldTimeout",this),r.a.forceBind("sizeInPane",this),r.a.forceBind("onInsertLink",this),this.isInitialized=!0}D.prototype={getReactKey:function(){return this._store.id+this.id},notifyDemandLoadUpdate:function(e,t){e&&!this._loadedOnDemandData&&(t.requestDemandLoadData(this),this.notifyLoadedData())},notifyLoadedData:function(){this._loadedOnDemandData=!0},notifyLoadDataFailed:function(e){this.setCollapsed(!1,e,!1),this._loadedOnDemandData=!1},isDemandLoad:function(){return this._demandLoadChildren},isDemandNotYetLoaded:function(){return this._demandLoadChildren&&!this._loadedOnDemandData},showInOverview:function(e){return this.numItems()>0||this._demandLoadChildren||e&&this.hasArchivedChildren()},paginationTokenInUse:function(){try{i.default.PAssert(2068,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(e){i.default.reportError(e)}return this._paginationToken.isInUse()},hasPaginationToken:function(){return!!(this.flags.get()&VMLIFlag.HasPageToken)},needsPaginationToken:function(){return!this.hasPaginationToken()&&!this._paginationToken},setPaginationToken:function(e){try{i.default.PAssert(2069,e,"Should never be setting an undefined token - use clear instead")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2070,!this._paginationToken,"Should never be overriding a pagination token - clear then set")}catch(e){i.default.reportError(e)}this._paginationToken=e,this.setFlags(this.flags.get()|VMLIFlag.HasPageToken)},clearPaginationToken:function(){this._paginationToken&&this._paginationToken.isInUse()&&this._paginationToken.notifyEndUse(),this._paginationToken=void 0,this.setFlags(this.flags.get()&~VMLIFlag.HasPageToken)},beginDataPageLoad:function(){try{i.default.PAssert(2072,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2073,!this._paginationToken.isInUse(),"Token should not already be in use when beginning a page load")}catch(e){i.default.reportError(e)}return this._paginationToken.notifyBeginUse(),this._paginationToken},endDataPageLoad:function(e){try{i.default.PAssert(2075,this._paginationToken,"Should always have a valid pagination token when done loading a data page")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2076,this._paginationToken.isInUse(),"Token should always be in use when running a request")}catch(e){i.default.reportError(e)}e?this._paginationToken.notifyEndUse():this.setFlags(this.flags.get()&~VMLIFlag.HasPageToken)},notifyPaginationUpdate:function(){try{i.default.PAssert(2077,this._paginationToken,"Must have a valid token to get next page of data")}catch(e){i.default.reportError(e)}this._paginationToken&&i.default.focusedPane.requestDataPage(this)},canHaveNote:function(){var e=this.belongsToItemStore(i.default.vmMain.itemStoreManager.getDefaultItemStore()),t=this.belongsToItemStore(i.default.vmMain.itemStoreManager.getTempItemStore());return e||t},createNote:function(){try{i.default.PAssert(2078,!this.isNote(),"Should never create a note on a note item")}catch(e){i.default.reportError(e)}var e;return this.hasNote()?e=this.getNote():(e=this.getItemStore().createItem(i.default.generateTempId(),"",this.id,{isNote:!0,forceSave:!0},ChangeType.AllLocal),this.setNote(e,ChangeType.Local)),e},editNote:function(){var e=i.default.focusedPane,t=b.a.getStartObject();if(this.isNote())b.a.selectIndex(b.a.getStartIndex(),this.getParsedText().length);else{this.hasNote()||(h.a.beginAction(),this.createNote(),h.a.endAction());var a=this.getNote(),r=e.indexOfObject(t);setTimeout(function(){b.a.selectIndex(r+1,a.getParsedText().length)},0)}},hasNote:function(){return void 0!==this._note},getNote:function(){try{i.default.PAssert(2079,this.hasNote(),"Must have a note to get one")}catch(e){i.default.reportError(e)}return this._note},setNote:function(e,t){try{i.default.PAssert(2080,i.default.isValidChangeType(t),"Must supply a valid changeType")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2081,!e||this.belongsToSameItemStore(e),"Note must belong to the same item store")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2082,!this.isNote(),"Should never set a note on a note")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2083,!this._note||!e,"Should never set a note multiple times on a single item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2084,!e||e.isNote(),"Should only set items that are notes as notes")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2085,!e||!e.isDeleted(),"Should note set a deleted note")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2086,!e||e instanceof D,"Note must be a valid VMLI")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2087,!e||e.parent()===this,"Should always have a valid parent set before setting note on item")}catch(e){i.default.reportError(e)}var a=this._note;if(this._note=e,this.shouldSave()){var r=e?e.id:void 0;this.save({note:r},SaveFlag.Prop),i.default.isLocalChange(t)&&!i.default.isUndoRedoChange(t)&&(h.a.beginAction(),l.a.noteSet(this,e),h.a.endAction()),e||!a||a.isDeleted()||o.a.deleteItem(a,t)}y.a.fireEvent("itemNoteSet",[{item:this}]),this.itemsHasMutated()},isNote:function(e){if(void 0===e)return this._isFlagHelper(VMLIFlag.Note);if(e!==this._isFlagHelper(VMLIFlag.Note)){var t=e?this.flags.get()|VMLIFlag.Note:this.flags.get()&~VMLIFlag.Note;this.setFlags(t)}},addFavorite:function(e,t){this._favorites||(this._favorites=[]);try{i.default.PAssert(2088,!this._favorites.indexOf(e)<0,"Must not already be in the favorites group")}catch(e){i.default.reportError(e)}if(this._favorites.push(e),E.a.notifyAdd(this,e),this.shouldSave()){var a={favorites:this._favorites};i.default.isLocalChange(t)&&!i.default.isUndoRedoChange(t)&&(l.a.saveChanges(this,a),a=i.default.clone(a)),this.save(a,SaveFlag.Prop)}},removeFavorite:function(e,t){try{i.default.PAssert(2089,this._favorites,"Must always have favorites defined before removing from item")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2090,!this._favorites.indexOf(e)>=0,"Must already be in the favorites group")}catch(e){i.default.reportError(e)}if(this._favorites.remove(e),E.a.notifyRemove(this,e),this.shouldSave()){var a={favorites:this._favorites};i.default.isLocalChange(t)&&!i.default.isUndoRedoChange(t)&&(l.a.saveChanges(this,a),a=i.default.clone(a)),this.save(a,SaveFlag.Prop)}},setFavorites:function(e,t){for(var a=(e||[]).removeArray(this._favorites),r=(this._favorites||[]).removeArray(e),n=0;n<r.length;++n)E.a.notifyRemove(this,r[n]);for(n=0;n<a.length;++n)E.a.notifyAdd(this,a[n]);if(this._favorites=e,this.shouldSave()){var s=[];for(n=0;n<e.length;n++)s[n]=i.default.clone(e[n],!0);var o={favorites:s};i.default.isLocalChange(t)&&!i.default.isUndoRedoChange(t)&&(l.a.saveChanges(this,o),o=i.default.clone(o)),this.save(o,SaveFlag.Prop)}},getFavorites:function(){return this._favorites},shouldSave:function(){return this._shouldSave},canDestroy:function(){return this._canDestroy},_getLineStyle:function(){return this.flags.get()&i.default.LSMask},_getPriority:function(){return this.flags.get()&i.default.PMask},getPadding:function(e,t,a){try{i.default.PAssert(2091,e&&e.getItem(),"Invalid pane")}catch(e){i.default.reportError(e)}if(this.isNote())return this.parent().getPadding(e,t,a);if(isNaN(a)){var r;if(t)r=1;else if(e.isSearchedFlat()){for(var n=this;n;){if(e.search.isFlatSearchResult(n)){r=n.levelsDeep.get()-1;break}n=n.parent()}try{i.default.PAssert(2092,!isNaN(r),"Item has no root depth",!!this.parent())}catch(e){i.default.reportError(e)}isNaN(r)&&(r=1)}else r=e.getItem().levelsDeep.get();a=this.levelsDeep.get()-r-(t?e.overviewPadLevels:1)}return this.getPaddingForLevel(a,e,t)},getPaddingForLevel:function(e,t,a){var r;e=Math.max(e,0),r=a?i.default.overviewPaddingStart+e*i.default.overviewPaddingIncrement:S.a.itemIndentStart(t)+e*S.a.itemIndentSize(t);try{i.default.PAssert(2093,i.default.isNumber(r),"Must have a valid padding")}catch(e){i.default.reportError(e)}return r},_updateStylePadding:function(e,t){try{i.default.PAssert(2094,this._parent,"Must have a valid parent to update padding, root should never change")}catch(e){i.default.reportError(e)}var a=e+(this.isNote()?0:1),r=this.levelsDeep.get()!==a;if(r||t){r&&this.levelsDeep.set(a);for(var n=this.getItems(),s=0;s<n.length;++s)n[s]._updateStylePadding(a,t)}},setFlags:function(e){this.flags.set(e)},getPriorityProps:function(){var e=this.flags.get();return i.default.priorityMapOut[e&i.default.PMask]+" "},styleProps:function(e){var t=this.flags.get(),a=this.isHeader()&&!e.isSearchedFlat()?"pHeader ":"";t&VMLIFlag.Highlighted&&e!==i.default.focusedPane&&(a+="highlight "),this.isArchived()&&(a+="archived "),this.isPrefixHeader()?a+="itemHeader ":this.isPrefixTask()?a+="itemTask ":this.isPrefixBullet()?a+="itemBullet ":this.isPrefixNumList()&&(a+="itemNumList "),this.prefix&&(a+="hasPrefix "),e.isItemTopLevel(this)&&(a+="topLevel ");var r=!1;if(t&VMLIFlag.Complete?(!this.repeatDate()||this.dateCompleted&&this.dateCompleted.getTime()===C.getTime())&&(r=!0):!(t&VMLIFlag.Note)&&t&VMLIFlag.DisplayComplete&&(r=!0),r?(a+="pComplete ",e.search.isMatchStuckHiding(this)||(a+="pDisplayComplete c-foreground-super-faded c-before-super-faded ")):t&i.default.PMask?a+=i.default.priorityMapOut[t&i.default.PMask]+" ":a+="pNormal ",t&VMLIFlag.Starred&&!(t&VMLIFlag.Complete||t&VMLIFlag.DisplayComplete)&&(a+="pStar c-star "),t&VMLIFlag.Note){a+="pNote c-foreground-faded ";var n=this.parent().flags.get();(n&VMLIFlag.Complete||n&VMLIFlag.DisplayComplete)&&(a+="pComplete c-foreground-super-faded c-before-super-faded "),n&i.default.PMask&&(a+=i.default.priorityMapOut[n&i.default.PMask]+" "),n&VMLIFlag.Starred&&!(n&VMLIFlag.Complete||n&VMLIFlag.DisplayComplete)&&(a+="pStar c-star "),t&VMLIFlag.Multiline&&(a+="multiline ")}var s=this.getAttachments();if(s)for(var o=0;o<s.length;++o){var l=s[o];if(l.isLoaded()){var d=l.getPlugin().getCssClass(l,e);d&&(a+=d)}}return a},onAttachmentIDChange:function(e,t){this.setText(this.getParsedText(),!0,ChangeType.Local)},onAttachmentUpdate:function(e,t,a){e.fieldsHaveParseEffect(t)&&(P.a.clearCacheForItem(this.id),this.parseText(!0,a),y.a.fireEvent("itemTextChanged",[{item:this}]))},setAttachments:function(e,t){var a=!1;if(!this._attachments&&e&&(this._attachments=[]),this._attachments){for(var i=this._attachments,r=0;r<i.length;++r)e.indexOf(i[r])<0&&(i[r].unsubscribe(this),i[r].notifyItemTextChanged(this,!0),this.shouldSave()&&i[r].markUnused(t),a=!0);for(r=0;r<e.length;++r){var n=e[r];if(i.indexOf(n)<0){if(n.shouldBeDeleted()){var s=n.getEmbedString(),o=this.getRawText().replace(s,"File failed to upload");return void requestAnimationFrame(function(){this.setText(o,!0,ChangeType.Local)}.bind(this))}n.subscribe(this),this.shouldSave()&&n.markInUse(t),a=!0}}a&&(this._attachments=e)}a&&this.itemChanged.notify()},getAttachment:function(e){try{i.default.PAssert(2095,this._attachments,"Must have valid attachments in order to query")}catch(e){i.default.reportError(e)}if(this._attachments)return this._attachments[e]},hasAttachment:function(e){if(this._attachments)for(var t=0;t<this._attachments.length;++t)if(this._attachments[t].id===e)return!0;return!1},hasPluginAttachment:function(e){try{i.default.PAssert(2096,e,"Must provide a valid plugin type to query")}catch(e){i.default.reportError(e)}if(this._attachments)for(var t=0;t<this._attachments.length;++t)if(this._attachments[t].getPlugin().id===e)return!0;return!1},getAttachmentById:function(e){try{i.default.PAssert(2097,this._attachments,"Must have valid attachments in order to query")}catch(e){i.default.reportError(e)}if(this._attachments)for(var t=0;t<this._attachments.length;++t)if(this._attachments[t].id===e)return this._attachments[t]},getAttachmentByType:function(e){try{i.default.PAssert(2098,e,"Must provide a valid plugin type to query")}catch(e){i.default.reportError(e)}if(this._attachments)for(var t=0;t<this._attachments.length;++t){var a=this._attachments[t];if(a.isType(e))return a}},getAttachmentByPlugin:function(e){try{i.default.PAssert(2099,e,"Must provide a valid plugin type to query")}catch(e){i.default.reportError(e)}if(this._attachments)for(var t=0;t<this._attachments.length;++t){var a=this._attachments[t];if(a.isPlugin(e))return a}},getAttachments:function(){if(this._attachments&&this._attachments.length>0)return this._attachments},hasAttachments:function(){return this._attachments&&this._attachments.length>0},getNumAttachments:function(){return this._attachments?this._attachments.length:0},hasAttachmentType:function(e){return i.default.vmMain.pluginManager.hasAttachmentType(this,e)},copyProperties:function(e){this.isStarred(e.isStarred(),ChangeType.Auto),this.isComplete(e.isComplete(),ChangeType.Auto),this.priority(e.priority(),ChangeType.Auto)},moveNote:function(e,t){try{i.default.PAssert(2100,e.hasNote(),"Must have a note to move")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2101,!this.hasNote(),"Must not already have a note")}catch(e){i.default.reportError(e)}var a=e.getNote();e.setNote(void 0,t),a&&(a.parent(this),this.setNote(a,t))},parent:function(){if(1===arguments.length){try{i.default.PAssert(2102,arguments[0]instanceof D||void 0===arguments[0],"Parent must be a VMLI")}catch(e){i.default.reportError(e)}var e=arguments[0],t=this._parent;try{i.default.PAssert(2103,!e||e._store===this._store,"All VMLIs in the same tree must share the same owner")}catch(e){i.default.reportError(e)}if(e!==t)if(void 0!==e){var a=this._numArchivedDescendants+(this.isArchived()?1:0);this._notifyAncestorsArchived(!1,a),this._parent=e,this._notifyAncestorsArchived(!0,a),this._numArchivedAncestors=this._parent._numArchivedAncestors+(this._parent.isArchived()?1:0),this._notifyDescendantsArchived(!0,this._numArchivedAncestors),this._updateStylePadding(this._parent.levelsDeep.get(),!1)}else{this._parent=e;var r=t._numArchivedAncestors+(t.isArchived()?1:0);this._numArchivedAncestors-=r,this._notifyDescendantsArchived(!1,r);a=this._numArchivedDescendants+(this.isArchived()?1:0);this._notifyAncestorsArchived(!1,a)}}return this._parent},getParser:function(){var e,t=this.getItemStore();return t&&(e=t.getParser()),e},requireStoredEls:function(){var e=this.getItemStore();return!!e&&e.requireStoredEls()},getItemStore:function(){try{i.default.PAssert(2104,this._store,"Should never be getting the item store from a destroyed VMLI")}catch(e){i.default.reportError(e)}return this._store},belongsToSameItemStore:function(e){return this.getItemStore()===e.getItemStore()},belongsToItemStore:function(e){return this.getItemStore()===e},archivedItems:function(e){return this._archivedItems||(this._archivedItems=new g.a,window.__TOTAL_ARCHIVE_PARENTS++),e?this._archivedItems.get():this._archivedItems},hasArchivedChildren:function(){return void 0!==this._archivedItems&&this._archivedItems.get().length>0},notifyItemPropertyChanged:function(e,t){if(this.hasAttachments())for(var a=this.getAttachments(),i=0;i<a.length;++i)a[i].notifyItemPropertyChanged(this,e,t)},_notifyAncestorsArchived:function(e,t){var a=this.parent();try{i.default.PAssert(2105,void 0===t||t>=0,"Must not specify a zero or negative number")}catch(e){i.default.reportError(e)}if((t=void 0===t?1:t)>0)for(;a;){e?a._numArchivedDescendants+=t:a._numArchivedDescendants-=t;try{i.default.PAssert(2106,a._numArchivedDescendants>=0,"Must never have a negative number of archived descendants")}catch(e){i.default.reportError(e)}a=a.parent()}},_notifyDescendantsArchived:function(e,t){try{i.default.PAssert(2107,void 0===t||t>=0,"Must not specify a zero or negative number")}catch(e){i.default.reportError(e)}if((t=void 0===t?1:t)>0){e?this._numArchivedAncestors+=t:this._numArchivedAncestors-=t;try{i.default.PAssert(2108,this._numArchivedAncestors>=0,"Must never have a negative number of archived ancestors")}catch(e){i.default.reportError(e)}for(var a=this.getItems(),r=0;r<a.length;++r)a[r]._notifyDescendantsArchived(e,t);if(this.hasArchivedChildren()){var n=this.archivedItems(!0);for(r=0;r<n.length;++r)n[r]._notifyDescendantsArchived(e,t)}}},isArchived:function(e,t){if(void 0!==e){try{i.default.PAssert(2109,i.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(e){i.default.reportError(e)}var a=this._isArchived;if(this._isArchived=e,e!==a){void 0!==this._parsedText&&void 0!==this.els||this.parseText(!0,t);for(var r=this.getItems(),n=0;n<r.length;++n)r[n]._notifyDescendantsArchived(this._isArchived);if(this.hasArchivedChildren()){var s=this.archivedItems(!0);for(n=0;n<s.length;++n)s[n]._notifyDescendantsArchived(this._isArchived)}this._notifyAncestorsArchived(this._isArchived);var o=this._isFlagHelper(VMLIFlag.Archived);this._isFlagHelper(VMLIFlag.Archived,!o),this.notifyItemPropertyChanged(t,"isArchived"),y.a.fireEvent("itemStateChanged",[this])}}return this._isArchived},hasArchivedDescendant:function(){return this._numArchivedDescendants>0},hasArchivedAncestor:function(){return this._numArchivedAncestors>0},getArchivedAncestor:function(e){for(var t,a=e?this:this.parent();void 0!==a&&(!a.isArchived()||(t=a,e));)a=a.parent();return t},getLevelsToArchivedAncestor:function(e){try{i.default.PAssert(2112,e||!this.isArchived(),"Should not be getting the archived ancestor for an archived item")}catch(e){i.default.reportError(e)}for(var t=0,a=0,r=e?this:this.parent();void 0!==r&&(a++,!r.isArchived()||(t=a,e));)r=r.parent();return t},isHidden:function(e){try{i.default.PAssert(2113,e,"Must specify the pane for the item being checked")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2114,!e||e.search,"Pane search obj must exist: ",e.isDestroyed())}catch(e){i.default.reportError(e)}return!(!e||!e.search)&&!e.search.isMatched(this)},getRawText:function(){return this._rawText},getParsedText:function(){try{i.default.PAssert(2115,!1===this._needsParse,"Text should be parsed before calling get")}catch(e){i.default.reportError(e)}return void 0!==this._parsedText?this._parsedText:this._rawText},getSearchText:function(e){if(e){var t=e.search.getItemSearchText(this);if(t)return t}try{i.default.PAssert(2116,void 0!==this._searchText,"Item should always have search text")}catch(e){i.default.reportError(e)}return this._searchText},setRawText:function(e){void 0!==e&&null!==e||(e="");try{i.default.PAssert(2117,e.indexOf(window.AttachChar)<0,"Should never have an AttachChar present in raw text")}catch(e){i.default.reportError(e)}this._rawText=e,this._searchText=this.generateTitleText().toLowerCase(),this._parsedText=void 0,this._notePreviewText=void 0,this._needsParse=!0},setParsedText:function(e){this._parsedText=e,this._needsParse=!1,this._searchText=this.generateTitleText().toLowerCase()},priority:function(e,t){if(void 0===e)return this._getPriority();try{i.default.PAssert(2119,i.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(e){i.default.reportError(e)}try{i.default.PAssert(2120,null===e||i.default.priorityMapOut[e],"Priority must be defined in globals")}catch(e){i.default.reportError(e)}var a=this._getPriority();if(e!==a){var r=this.flags.get(),n=r&~i.default.PCMask|e;if(r&VMLIFlag.Complete&&(n&=~VMLIFlag.Complete),this.setFlags(n),this.shouldSave()){var s,o={priority:e};i.default.isLocalChange(t)&&!i.default.isUndoRedoChange(t)?(l.a.saveChanges(this,o),o=i.default.clone(o),s=SaveFlag.Text):s=SaveFlag.None,this.save(o,s)}this.notifyItemPropertyChanged(t,"priority"),y.a.fireEvent("itemStateChanged",[this]),h.a.performAction(TrackerType.Update,{itemID:this.id,field:"priority",newValue:e,oldValue:a})}},isScheduled:function(){return!!this._date||!!this._repeatDate},getDuration:function(e,t){if(e){var a=e.search.getItemDuration(this);if(a)return a}var i=this._durationMS||0;return t&&(i=10*Math.round(i/10)),i},setDuration:function(e){this._durationMS!==e&&(this._durationMS=e,y.a.fireEvent("itemStateChanged",[this]))},getDurationText:function(){return this._durationText||""},setDurationText:function(e){this._durationText=e},getDateText:function(e){if(e){var t=e.search.getItemDateText(this);if(t)return t}return this._dateText},setDateText:function(e){this._dateText=e},getItemDateString:function(){var e=s.a.DatePrefix+this.getDateText();return this.getDurationText()&&(e+=" "+this.getDurationText()),e},getEndDate:function(e){try{i.default.PAssert(2121,this.date(),"Must have a valid date")}catch(e){i.default.reportError(e)}var t=this.getDate(e);return t?t.clone().addMilliseconds(this.getDuration(e,!0)):void 0},isMultidayEvent:function(){var e=!1;if(this.date()&&this.getDuration()>0){var t=this.getEndDate();this.date().isSameDay(t)||(e=!0)}return e},getStickySearchInfo:function(){return{prefix:this.getPrefix(),date:this.date(),dateText:this._dateText,repeatDate:this.repeatDate(),duration:this.getDuration(),tags:this.getTags(),contacts:this.getContacts(),searchText:this.getSearchText()}},date:function(e,t){if(void 0!==e){try{i.default.PAssert(2123,null===e||i.default.isDateValid(e),"Must pass in a valid date object")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2124,i.default.isValidChangeType(t),"Must have a valid changeType")}catch(e){i.default.reportError(e)}if(e!==this._date){null===e&&(e=void 0);try{i.default.PAssert(2125,void 0===e||!isNaN(e.getTime()),"Must be setting a valid date")}catch(e){i.default.reportError(e)}this._date=e,i.default.timeline.updateNotifications(this),y.a.fireEvent("itemStateChanged",[this]),i.default.isLocalChange(t)&&h.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ChangeDate,data:{itemID:this.id,date:e}})}}return this.getDate()},getDate:function(e){if(e){var t=e.search.getItemDate(this);if(t)return t}return this._date},getDateFormat:function(){return this._dateFormat},setDateFormat:function(e){this._dateFormat=e},repeatDate:function(e){if(e){var t=e.search.getItemRepeatDate(this);if(t)return t}return this._repeatDate},setRepeatDate:function(e,t){if(void 0!==e){try{i.default.PAssert(2126,!e||e instanceof f.a,"Must pass in a valid repeat date object")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2127,i.default.isValidChangeType(t),"Must have a valid changeType")}catch(e){i.default.reportError(e)}e!==this._repeatDate&&(null===e&&(e=void 0),this._repeatDate=e,!e&&this.dateCompleted&&this.dateCompleted.getTime()!==C.getTime()&&this.isComplete(!1,t),i.default.timeline.updateNotifications(this),y.a.fireEvent("itemStateChanged",[this]),i.default.isLocalChange(t)&&h.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ChangeDate,data:{itemID:this.id,date:e}}))}else 0},allDayDate:function(){return this._date?!this._date.hasTimeOfDay():!!this.repeatDate()&&!this.repeatDate().hasTimeOfDay()},_isFlagHelper:function(e,t){if(void 0===t)return!!(this.flags.get()&e);var a=t?this.flags.get()|e:this.flags.get()&~e;this.setFlags(a)},isDeleted:function(e,t){if(void 0!==e){try{i.default.PAssert(2128,i.default.isValidChangeType(t),"Must supply a valid changetype to delete an item: "+t)}catch(e){i.default.reportError(e)}this._isDeleted=e;for(var a=0;this._favorites&&a<this._favorites.length;++a){var r=this._favorites[a];e?E.a.notifyRemove(this,r):E.a.notifyAdd(this,r)}if(this._attachments){var n=this._attachments;for(a=0;a<n.length;++a)e?(n[a].unsubscribe(this),this.shouldSave()&&n[a].markUnused(t)):(n[a].subscribe(this),this.shouldSave()&&n[a].markInUse(t))}}return this._isDeleted},isImportant:function(){return this._getPriority()},forceComplete:function(e,t){return this.isComplete(e,t,!0)},isDisplayComplete:function(){return this._isFlagHelper(VMLIFlag.DisplayComplete)},computeDisplayComplete:function(){var e=this.parent(),t=e&&!this.isComplete()&&(e.isComplete()||e._isFlagHelper(VMLIFlag.DisplayComplete));this._isFlagHelper(VMLIFlag.DisplayComplete,t)},propagateDisplayComplete:function(e){this.computeDisplayComplete();for(var t=0;t<this.numItems();t++){var a=this.itemAtIndex(t);a.isComplete()||a.propagateDisplayComplete()}},isComplete:function(e,t,a){if(void 0===e)return this._isFlagHelper(VMLIFlag.Complete)&&(!this.repeatDate()||this.dateCompleted&&this.dateCompleted.getTime()===C.getTime());var r={isComplete:e};try{i.default.PAssert(2129,i.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(e){i.default.reportError(e)}if(e!==this._isFlagHelper(VMLIFlag.Complete)||this.repeatDate()){if(e){if(this.repeatDate()){try{i.default.PAssert(2130,!this.dateCompleted||this.dateCompleted.getTime()!==C.getTime(),"If the passed in value is true then the repeated date should never be forced")}catch(e){i.default.reportError(e)}if(a)this.dateCompleted=C;else{var n=this.repeatDate().nextComplete(this.dateCompleted),s=this.repeatDate().nextActive(this.dateCompleted);if(s){if(i.default.isLocalChange(t)&&!i.default.isUndoRedoChange(t)){r.isComplete=!1,this.dateCompleted=s,h.a.beginAction(),i.default.focusedPane.setIgnoreRestoreScroll();var d=n.hasTimeOfDay()?DFormat.DayYearTime:DFormat.MonthDayYear,c=this.getRawText().replace(this.getDateText(),n.toString(p.a.getFormat(d))),u=o.a.createVMLI({text:c,isComplete:!0,dateCompleted:Date.now()},{parent:this.parent(),changeType:ChangeType.AllLocal});this.parent().insertItem(u,this.getIndex()),this.repeatDate().setStartDate(s),r.repeatDate=this.repeatDate().toString(),y.a.fireEvent("itemStateChanged",[this]),i.default.vmMain.runSingleParse(this,t|ChangeType.Property),h.a.endAction()}}else this.dateCompleted=C,i.default.isLocalChange(t)&&!i.default.isUndoRedoChange(t)&&i.default.vmMain.runSingleParse(this,t|ChangeType.Property),a=!0}r.dateCompleted=this.getDateCompletedTime()}else this.dateCompleted||(this.dateCompleted=new Date,r.dateCompleted=this.getDateCompletedTime());i.default.isLocalChange(t)&&i.default.aggregateEvent("ItemCompleted")}else this.dateCompleted=void 0,r.dateCompleted=void 0,a=!0;var f;if(this.shouldSave())i.default.isLocalChange(t)&&!i.default.isUndoRedoChange(t)?(l.a.saveChanges(this,r),r=i.default.clone(r),f=SaveFlag.Text):f=SaveFlag.None,this.save(r,f);this.notifyItemPropertyChanged(t,"isComplete"),h.a.performAction(TrackerType.Update,{itemID:this.id,field:"isComplete",newValue:e,oldValue:!e})}!a&&this.repeatDate()||(this._isFlagHelper(VMLIFlag.Complete,r.isComplete),this.propagateDisplayComplete(),i.default.timeline.updateNotifications(this),y.a.fireEvent("itemStateChanged",[this]))},isStarred:function(e,t){if(void 0===e)return this._isFlagHelper(VMLIFlag.Starred);try{i.default.PAssert(2131,i.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(e){i.default.reportError(e)}if(e!==this._isFlagHelper(VMLIFlag.Starred)){var a=this.flags.get();e&&a&VMLIFlag.Complete&&(a&=~VMLIFlag.Complete);var r=e?a|VMLIFlag.Starred:a&~VMLIFlag.Starred;this.setFlags(r);var n,s={isStarred:e};if(this.shouldSave())i.default.isLocalChange(t)&&!i.default.isUndoRedoChange(t)?(l.a.saveChanges(this,s),s=i.default.clone(s),n=SaveFlag.Text):n=SaveFlag.None,this.save(s,n);this.notifyItemPropertyChanged(t,"isStarred"),y.a.fireEvent("itemStateChanged",[this]),h.a.performAction(TrackerType.Update,{itemID:this.id,field:"isStarred",newValue:e,oldValue:!e})}},isHeader:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)},getVisibleChildren:function(e){if(!this.isNote()){for(var t=this.getItems(),a=[],i=0;i<t.length;i++)t[i].isHidden(e)||a.push(t[i]);return a}},hasVisibleChildren:function(e){if(this.isNote())return!1;for(var t=this.getItems(),a=0;a<t.length;a++)if(!t[a].isHidden(e))return!0;return!1},hasHeaderChildren:function(){if(this.isNote())return!1;for(var e=this.getItems(),t=0;t<e.length;t++)if(e[t].isHeader())return!0;return!1},getCollapsedField:function(e,t){return t?s.a.PerPaneStateField.CollapsedOverview:i.default.settings.get(Settings.searchExpandsCollapsed)&&e.isSearched()?s.a.PerPaneStateField.CollapsedSearch:s.a.PerPaneStateField.Collapsed+(e.viewState?e.getViewMode():"")},isCollapsed:function(e,t){try{i.default.PAssert(2132,e,"Must specify the pane for the item being checked for collapsed")}catch(e){i.default.reportError(e)}if(!e||e.isSearchedFlat())return!1;var a=e.getPerPaneState(this.id,this.getCollapsedField(e,t));return void 0===a&&(a=this.isDemandLoad()?0===this.numItems()||!e.isSearched()&&!t:e.getCollapsedDefault(this,t)),!!a},setCollapsed:function(e,t,a,r){try{i.default.PAssert(2133,t,"Must specify the pane for the item being checked for collapsed")}catch(e){i.default.reportError(e)}if(!t)return!1;var n=this.isCollapsed(t,a);void 0!==e&&(e&&!this.isCollapsible()||(t.setPerPaneState(this.id,this.getCollapsedField(t,a),e),!1!==r&&i.default.vmMain.paneManager.updatePaneStateForPane(t),h.a.performAction(TrackerType.Update,{itemID:this.id,field:"isCollapsed",pane:t,newValue:e,oldValue:n}),this.isDemandLoad()&&this.notifyDemandLoadUpdate(!e,i.default.focusedPane),e!==n&&t.updateItems())),this.itemChanged.notify()},setCollapsedQuiet:function(e,t){t.setPerPaneState(this.id,this.getCollapsedField(t,!1),e)},toggleCollapsed:function(e){try{i.default.PAssert(2134,e,"Must specify the pane that this item is being collapsed in")}catch(e){i.default.reportError(e)}P.a.clearCacheForItem(this.id),this.setCollapsed(!this.isCollapsed(e,!1),e,!1)},isCollapsible:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)},isDraggable:function(){return!this.isNote()},setTags:function(e){var t=!(this._activeTags&&e&&this._activeTags.equals(e));this._activeTags=e,t&&y.a.fireEvent("itemStateChanged",[this])},getTags:function(e){if(e){var t=e.search.getItemTags(this);if(t)return t}return this._activeTags},setContacts:function(e){var t=!(this._activeContacts&&e&&this._activeContacts.equals(e));this._activeContacts=e,t&&y.a.fireEvent("itemStateChanged",[this])},getContacts:function(e){if(e){var t=e.search.getItemContacts(this);if(t)return t}return this._activeContacts},hasCompletedAncestor:function(){for(var e=this.parent();e;){if(e.isComplete())return!0;e=e.parent()}},hasTime:function(){return this.date()?this.date().hasTimeOfDay():this.repeatDate()?this.repeatDate().hasTimeOfDay():!!this.dateCompleted},getTimeOfDay:function(){return this.date()?this.date().getTimeOfDay():this.repeatDate()?this.repeatDate().getTimeOfDay():this.dateCompleted?this.dateCompleted.getTimeOfDay():0},_formatDateTime:function(e){return e.toString(p.a.getFormat(DFormat.ShortTime))},getDisplayDateWithDuration:function(e,t){var a=this.getDate(t);if(a){var i=this.getEndDate(t);a=a.clone().clearTime().equals(a)?a:i.clone().clearTime().equals(a)?i:a}else this.repeatDate(t)&&(a=this.repeatDate(t).getDateOnDay(e));return a},time:function(){var e,t=this.date();if(this.dateCompleted&&this.isComplete())e=this._formatDateTime(this.dateCompleted);else if(t){if(t.hasTimeOfDay())if(this.getDuration()>0){var a=this.getDisplayDateWithDuration(this);a.equals(t)?e="<div>"+this._formatDateTime(t)+'</div><div class="c-foreground-very-faded">'+this._formatDateTime(this.getEndDate())+"</div>":a.equals(this.getEndDate())&&(e="Ends "+this._formatDateTime(this.getEndDate()))}else e=this._formatDateTime(this.date())}else this.repeatDate()&&this.repeatDate().hasTimeOfDay()&&(e=this.repeatDate().getTime(p.a.getFormat(DFormat.ShortTime)));return e},createDateString:function(e){return e.isBefore(Date.today().addWeeks(1))?e.toString(p.a.getFormat(DFormat.LongDayTime)):e.toString(p.a.getFormat(DFormat.ShortDayTime))},fullTime:function(){var e=this.date();if(!e)return"";this.createDateString(e)},isVersionUninitialized:function(e){var t;switch(e){case VersionType.Structure:t=this._version;break;case VersionType.Text:t=this._versionText;break;default:t=-2;try{i.default.PAssert(2135,!1,"Invalid version type")}catch(e){i.default.reportError(e)}}return(t||0)===window.UninitializedVersion},setVersion:function(e,t){try{i.default.PAssert(2136,i.default.isNumber(t),"Must always be setting a version to a number: ",t)}catch(e){i.default.reportError(e)}switch(e){case VersionType.Structure:this._version=t;break;case VersionType.Text:this._versionText=t;break;default:try{i.default.PAssert(2137,!1,"Invalid version type")}catch(e){i.default.reportError(e)}}},getVersion:function(e){var t;switch(e){case VersionType.Structure:t=this._version;break;case VersionType.Text:t=this._versionText;break;default:t=-2;try{i.default.PAssert(2138,!1,"Invalid version type")}catch(e){i.default.reportError(e)}}return t||0},setRemoteVersion:function(e,t){try{i.default.PAssert(2139,void 0===t||i.default.isNumber(t),"Must always be setting a remote version to a number: ",t)}catch(e){i.default.reportError(e)}switch(e){case VersionType.Structure:this._versionRemote=t;break;case VersionType.Text:this._versionRemoteText=t;break;default:try{i.default.PAssert(2140,!1,"Invalid version type")}catch(e){i.default.reportError(e)}}},getRemoteVersion:function(e,t){var a;switch(e){case VersionType.Structure:a=this._versionRemote;break;case VersionType.Text:a=this._versionRemoteText;break;default:a=-2;try{i.default.PAssert(2141,!1,"Invalid version type")}catch(e){i.default.reportError(e)}}return a||t?a:0},isLocalVersionNewer:function(e){return this.getVersion(e)==this.getRemoteVersion(e)||void 0===this.getRemoteVersion(e,!0)},isRemoteVersionNewer:function(e){return!this.isLocalVersionNewer(e)},init:function(e,t){this._shouldSave=!(t&&t.noSave);try{i.default.PAssert(2142,!this._shouldSave||!this._demandLoadChildren,"Should never be saving results of demand loaded items")}catch(e){i.default.reportError(e)}if(e.data){try{i.default.PAssert(2143,this.shouldSave(),"Should never be loading from remote with item that doesnt save")}catch(e){i.default.reportError(e)}var a=l.a.getVersion(e.data,VersionType.Structure),r=l.a.getVersion(e.data,VersionType.Text);this.setRemoteVersion(VersionType.Structure,a),this.setRemoteVersion(VersionType.Text,r),h.a.beginAction(),this.initFromGDrive(e.data),h.a.endAction(),this.setRemoteVersion(VersionType.Structure,void 0),this.setRemoteVersion(VersionType.Text,void 0)}else{if(void 0!==e.version&&this.setVersion(VersionType.Structure,e.version),void 0!==e.versionText&&this.setVersion(VersionType.Text,e.versionText),this.modifiedOffline=e.modifiedOffline,this.modifiedOfflineText=e.modifiedOfflineText,this.modifiedOffline,this.modifiedOfflineText,i.default.vmMain.isLoaded&&this.shouldSave()&&l.a.isConnected()&&e.id!==o.a.rootId?o.a.initializeItem(this):this.id=e.id||i.default.generateTempId(),e.date){var n=new Date(e.date);i.default.isDateValid(n)?this.date(n,t.changeType):i.default.reportError(new Error("Initial invalid date: ",e.date))}if(e.repeatDate){var s=new f.a(e.repeatDate);s.isValid()?this.setRepeatDate(s,t.changeType):i.default.reportError(new Error("Initial invalid repeat date: "+e.repeatDate))}e.dateCompleted&&(this.dateCompleted=new Date(e.dateCompleted)),e.favorites&&this.setFavorites(e.favorites,t.changeType),this.computeDisplayComplete(),(e.items&&e.items.length>0||e.note)&&this.updateItems(e.items,e.note,t.changeType)}if(this.__TEMP_InitCalled=!0,!this.isArchived()||i.default.vmMain.hasDisplayedArchivedItems()){try{i.default.PAssert(2144,t,"Currently we have required properties in extraInfo")}catch(e){i.default.reportError(e)}var d=t?t.changeType:ChangeType.Auto;try{i.default.PAssert(2145,i.default.isValidChangeType(d),"Must supply a valid changetype to VMLIs")}catch(e){i.default.reportError(e)}this.__TEMP_InitParseCalled=!0,this.parseText(!0,t.changeType|ChangeType.ItemLoad)}else this.__TEMP_SkippedInitParsed=!0;var c;this.shouldSave()&&!i.default.isAutoChange(t.changeType)?(i.default.isLocalChange(t.changeType)?(c=SaveFlag.All,(this.date()||this.repeatDate())&&l.a.saveChanges(this,this.getMetaTextSaveData()),this.isComplete()&&l.a.saveChanges(this,{isComplete:this.isComplete()}),this.priority()&&l.a.saveChanges(this,{priority:this.priority()}),this.isStarred()&&l.a.saveChanges(this,{isStarred:this.isStarred()})):c=SaveFlag.None,this.getItemStore().trackGlobally()&&o.a.setModel(this),this.save(void 0,c)):this.getItemStore().trackGlobally()&&o.a.setModel(this);i.default.isLocalChange(t.changeType)&&i.default.aggregateEvent("ItemCreated")},onLoad:function(e){this.isLoaded||(!this.isDemandLoad()||this.isCollapsed(e,!1)||e.isSearched()||this.notifyDemandLoadUpdate(!0,e),this.isLoaded=!0)},destroy:function(){try{i.default.PAssert(2146,this._canDestroy,"VMLI must be explicitly marked as destroyable")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2147,!this.shouldSave()||i.default.isDemoMode(),"Should never destory a saveable VMLI")}catch(e){i.default.reportError(e)}var e=this.getItemStore();if(this._destroyed=!0,this._attachments){for(var t=this._attachments,a=0;a<t.length;++a){t[a].unsubscribe(this)}this._attachments=void 0}e.trackGlobally()&&o.a.clearModel(this.id),this.items.unlisten(this.itemsHasMutated),y.a.fireEvent("itemStateChanged",[this]),this._store=void 0,r.a.destroy(this)},isDestroyed:function(){return this._destroyed},getACText:function(){return this.getParsedText()},resetDriveData:function(){this._versionRemote=void 0,this._versionRemoteText=void 0,this.data&&this.data.removeAllEventListeners(),this.data=void 0},isFullscreen:function(){return i.default.focusedItem===this},findItem:function(e){var t=this.getIndexOf(e.id,!1);return t>=0?{index:t,arr:this.items,isArchived:!1}:this.hasArchivedChildren()&&(t=this.getIndexOf(e.id,!0))>=0?{index:t,arr:this.archivedItems(),isArchived:!0}:void 0},updateItems:function(e,t,a){var r=!1,n=!1;if(e&&e.length>0){var s,d;this.data&&(s=l.a.get(this.data,"items"),d=l.a.get(this.data,"archivedItems"));try{i.default.PAssert(2150,!this.hasChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2151,!this.hasArchivedChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(e){i.default.reportError(e)}for(var c=0;c<e.length;++c){var u=e[c],h=void 0;if(u instanceof D?h=u:i.default.isString(u)&&(h=o.a.getModel(u)),h){var f=o.a.getItem(h.parent().id);if(f&&f.id!==this.id){var p=f.items.indexOf(h.id);try{i.default.PAssert(2154,-1===p,"Expect that the old parent has been notified")}catch(e){i.default.reportError(e)}var m=h.getIndex();m>-1&&h.parent().removeChildAtIndex(m,a)}h.parent(this)}else if("object"!=typeof u){var g=o.a.getItem(u);try{i.default.PAssert(2152,g,"Referenced item doesn't exist",u)}catch(e){i.default.reportError(e)}g&&(h=o.a.createVMLI(g,{parent:this,changeType:a}))}else{try{i.default.PAssert(2153,u,"Item must exist otherwise we arent creating anything")}catch(e){i.default.reportError(e)}u&&(h=o.a.createVMLI(u,{parent:this,changeType:a}))}try{i.default.PAssert(2155,h,"There must be a model at this point")}catch(e){i.default.reportError(e)}h&&(h.isArchived()?(n=!0,this.archivedItems(!0).push(h),!d&&this.data&&(d=l.a.ensureItemList(this,!0)),d&&d.push(h.data)):(r=!0,this.items.push(h),!s&&this.data&&(s=l.a.ensureItemList(this,!1)),s&&s.push(h.data)))}}if(t){try{i.default.PAssert(2156,!this._note,"Must not already have a valid note set")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2157,i.default.isString(t),"Note must be a valid ID")}catch(e){i.default.reportError(e)}var v=o.a.getModel(t);if(!v){g=o.a.getItem(t);try{i.default.PAssert(2158,g,"Referenced note doesn't exist",t)}catch(e){i.default.reportError(e)}g&&(g.isNote=!0,v=o.a.createVMLI(g,{parent:this,changeType:a}))}try{i.default.PAssert(2159,v,"Must have a valid note VM at this point")}catch(e){i.default.reportError(e)}this._note=v,r=!0}r&&this.itemsHasMutated(),n&&this.archivedItems().notify()},addItemAtIndex:function(e,t,a){try{i.default.PAssert(2160,a,"Must pass pane when adding item at index")}catch(e){i.default.reportError(e)}h.a.beginAction();var r=a.createVMLI({text:e},{parent:this,changeType:ChangeType.AllLocal,isEditable:!0});return this.insertItem(r,t),h.a.performAction(TrackerType.Create,{itemID:r.id,parent:this.id,position:isNaN(t)?this.numItems()-1:t,text:e}),this.isCollapsed(a,!1)&&this.setCollapsed(!1,a),h.a.endAction(),r},insertItem:function(e,t){try{i.default.PAssert(2161,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2162,e,"Must specify a valid item to be inserted")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2163,!e.isArchived(),"Should not be inserting an archived item into the items array")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2164,this.belongsToSameItemStore(e),"Items must belong to the same item store")}catch(e){i.default.reportError(e)}isNaN(t)?this.items.push(e):this.items.splice(t,0,e),this.shouldSave()&&o.a.insertItem(this,e,t)},insertSorted:function(e,t,a){try{i.default.PAssert(2165,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2166,e,"Must specify a valid item to be inserted")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2167,!e.isArchived(),"Should not be inserting an archived item into the items array")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2168,t,"Must supply a valid comparator")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2169,this.belongsToSameItemStore(e),"Items must belong to the same item store")}catch(e){i.default.reportError(e)}var r=this.items.insertSorted(e,t,a);this.shouldSave()&&o.a.insertItem(this,e,r)},moveTo:function(e,t){var a=e.parent,r=e.index,n=e.shouldBeArchived,s=e.noVersion;e.underlying,e.fromTab;try{i.default.PAssert(2170,a instanceof D,"New parent must be a valid VMLI")}catch(e){i.default.reportError(e)}void 0===r&&(r=-1),void 0===n&&(n=!1);var l=this.parent(),d=l.findItem(this);if(d){var c=r,u=r;if(l===a){if(d.index===c)return;d.index<c&&c--}i.default.vmMain.beginUpdateItems(),d.arr.splice(d.index,1);var h=n?a.archivedItems():a.items;if(c<0?h.push(this,!1):h.splice(c,0,this,!1),this.parent(a),h.notify(),this.hasNote()&&this.getNote().itemChanged.notify(),i.default.vmMain.commitUpdateItems(),this.shouldSave()){var f={index:u,isArchived:n};o.a.moveItem({item:this,newInfo:f,oldParent:l,oldInfo:d,noVersion:s},t)}if(n)try{i.default.PAssert(2171,this.isArchived(),"If moving to an archived array, the item should already be archived")}catch(e){i.default.reportError(e)}else try{i.default.PAssert(2172,!this.isArchived(),"If moving to a non-archived array item should not already be archived")}catch(e){i.default.reportError(e)}l.propagateDisplayComplete(),a.propagateDisplayComplete()}},getItemsArrayForSave:function(){try{i.default.PAssert(2173,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}for(var e=[],t=this.getItems(),a=0;a<t.length;++a)e.push(t[a].id);if(this.hasArchivedChildren()){var r=this.archivedItems(!0);for(a=0;a<r.length;++a)e.push(r[a].id)}return e},getDateTime:function(){if(this.date())return this.date().getTime()},getRepeatDateString:function(e){if(this.repeatDate())return this.repeatDate().toString()},getDateCompletedTime:function(){if(this.dateCompleted)return this.dateCompleted.getTime()},isForceCompleted:function(){return!(!this.dateCompleted||!this.dateCompleted.equals(C))},getMetaTextSaveData:function(){var e,t,a=this.getDate(),i=this.repeatDate();return void 0!==a&&(e=a.getTime()),void 0!==i&&(t=i.toString()),{date:e,dateFormat:this.getDateFormat(),repeatDate:t,dateCompleted:this.getDateCompletedTime()}},_generateNotificationEntry:function(e){var t,a=e.toJSON(),r=new Date(e);try{i.default.PAssert(2174,i.default.isDateValid(r),"Must provide a valid alert date: "+e+" - "+this.getDateText())}catch(e){i.default.reportError(e)}return t=e.hasTimeOfDay()?r.addMinutes(-i.default.settings.get(Settings.notificationDelay)).toJSON():r.addDays(-1).clearTime().addHours(17).toJSON(),{id:this.id,text:this.getParsedTextWithoutPrefix(),date:a,alertDate:t}},getNotificationEntries:function(){try{i.default.PAssert(2175,this.date()||this.repeatDate(),"Must have a valid date")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2176,!this.allDayDate(),"All day dates should not be scheduled")}catch(e){i.default.reportError(e)}if(!this.allDayDate())try{if(this.date())return this._generateNotificationEntry(this.date());if(this.repeatDate()){for(var e=[],t=this.repeatDate().getDates(!0),a=0;a<t.length;++a){var r=this._generateNotificationEntry(t[a]);r.id=r.id+"_"+a,e.push(r)}return e}}catch(e){return void i.default.reportError(e)}},getDebugData:function(){return{id:this.id,parent:this._parent?this._parent.id:void 0,items:this.isNote()?void 0:this.getItemsArrayForSave(),text:this.getRawText(),note:this.hasNote()?this.getNote().id:void 0,isNote:this.isNote(),isArchived:this.isArchived(),isDeleted:this.isDeleted(),version:this.getVersion(VersionType.Structure),versionText:this.getVersion(VersionType.Text),modifiedOffline:this.modifiedOffline,modifiedOfflineText:this.modifiedOfflineText}},getFullSaveData:function(){try{i.default.PAssert(2177,this.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}var e={id:this.id,text:this.getRawText(),date:this.getDateTime(),repeatDate:this.getRepeatDateString(),dateText:this.getDateText(),dateCreated:this.dateCreated.getTime(),dateCompleted:this.getDateCompletedTime(),duration:this.getDuration(),durationText:this.getDurationText(),dateFormat:this.getDateFormat(),favorites:this.getFavorites()||void 0,priority:this._getPriority()||void 0,isComplete:this.isComplete()||void 0,isStarred:this.isStarred()||void 0,note:this.hasNote()?this.getNote().id:void 0,isArchived:this.isArchived()||void 0,isNote:this.isNote()||void 0,isDeleted:void 0,version:this.getVersion(VersionType.Structure),versionText:this.getVersion(VersionType.Text),modifiedOffline:this.modifiedOffline,modifiedOfflineText:this.modifiedOfflineText};return this.isNote()||(e.items=this.getItemsArrayForSave()),e},save:function(e,t){try{i.default.PAssert(2178,this.shouldSave(),"Item must be marked as saveable")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2179,void 0!==t,"Must specify saveFlags for the changes that are being saved")}catch(e){i.default.reportError(e)}e?o.a.getItem(this.id)||e.id?(e.items&&(e.items=this.getItemsArrayForSave(),i.default.isFlagSet(t,SaveFlag.Prop)||(this.modifiedOffline=!1,e.modifiedOffline=!1)),void 0!==e.text&&(i.default.isFlagSet(t,SaveFlag.Text)||(this.modifiedOfflineText=!1,e.modifiedOfflineText=!1),y.a.fireEvent("itemTextChanged",[{item:this,force:t===SaveFlag.None}]))):e=this.getFullSaveData():e=this.getFullSaveData();o.a.saveChanges(this,e,t)},highlight:function(){var e=this;this.highlightTimeout?(this.isHighlighted.set(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=void 0,setTimeout(function(){e.isHighlighted.set(!0)},0)):this.isHighlighted.set(!0),this.highlightTimeout=setTimeout(function(){e.isHighlighted.set(!1)},2e3)},getElement:function(e){},getSpan:function(e){},getOverviewElement:function(e){},removeChild:function(e,t){try{i.default.PAssert(2182,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2183,!e.isNote(),"Do not use remove child to remove notes from items")}catch(e){i.default.reportError(e)}var a;if(e.isArchived()){try{i.default.PAssert(2186,this.hasArchivedChildren(),"For a child to be archived, this item must have valid archived children")}catch(e){i.default.reportError(e)}if(this.hasArchivedChildren()){if((a=this.archivedItems(!0).remove(e))>=0)this.shouldSave()&&o.a.removeItem(this,a,e,!0,t);else{try{i.default.PAssert(2187,!1,"Archived child not found in parent")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2188,this===e.parent(),"Parent of archived child is not set to this item, should not remove: "+e.parent())}catch(e){i.default.reportError(e)}}this.archivedItems().notify()}}else if((a=this.items.remove(e))>=0)this.shouldSave()&&o.a.removeItem(this,a,e,!1,t);else{try{i.default.PAssert(2184,!1,"Child not found in parent")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2185,this===e.parent(),"Parent of child is not set to this item, should not remove: "+e.parent())}catch(e){i.default.reportError(e)}}return a},removeChildAtIndex:function(e,t){try{i.default.PAssert(2189,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2190,!this.itemAtIndex(e).isArchived())}catch(e){i.default.reportError(e)}var a=this.items.removeAt(e);return this.shouldSave()&&o.a.removeItem(this,e,a,!1,t),a},archiveChild:function(e,t){try{i.default.PAssert(2191,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2192,!e.isNote(),"Do not use archive child on notes")}catch(e){i.default.reportError(e)}var a=!1;if(!e.isArchived()){h.a.beginAction(),e.isArchived(!0,t),this.archivedItems().push(e);var r=this.items.remove(e);try{i.default.PAssert(2193,r>=0,"Must be able to find child in items list")}catch(e){i.default.reportError(e)}this.shouldSave()&&o.a.archiveItem(this,r,e,t),h.a.endAction(),a=!0}return a},unarchiveChild:function(e,t){try{i.default.PAssert(2194,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2195,!e.isNote(),"Do not use unarchive child on notes")}catch(e){i.default.reportError(e)}var a=!1;if(e.isArchived()){h.a.beginAction();try{i.default.PAssert(2196,e.isArchived(),"Child must be archived to be unarchived")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2197,this.hasArchivedChildren(),"Parent must have archived children to unarchive a child")}catch(e){i.default.reportError(e)}e.isArchived(!1,t);var r=this.archivedItems(!0).remove(e);this.items.push(e),this.shouldSave()&&o.a.unarchiveItem(this,r,e,t),this.archivedItems().notify(),h.a.endAction(),a=!0}return a},_moveChildrenHelper:function(e,t){var a=e.newParent,r=e.index,n=e.isArchived;try{i.default.PAssert(2198,void 0!==a&&void 0!==n,"_moveChildrenHelper is missing parameters")}catch(e){i.default.reportError(e)}var s=n?this.archivedItems(!0):this.getItems();if(s.length>0){var o=n?a.archivedItems(!0):a.getItems();!n&&(isNaN(r)||r<0)&&(r=o.length);for(var l=0;s.length>0;){try{i.default.PAssert(2199,s[l]!==a,"Should never be reparenting to a child")}catch(e){i.default.reportError(e)}var d=s[0].id;s[0].moveTo({parent:a,index:r+l,shouldBeArchived:n,underlying:!0},t),h.a.performAction(TrackerType.Move,{itemID:d,oldParent:this.id,oldPosition:l,newParent:a.id,newPosition:r+l}),l++}}},moveChildren:function(e,t,a){try{i.default.PAssert(2200,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2201,this.id!==e.id,"Do not use moveChildren to move a child to the same parent")}catch(e){i.default.reportError(e)}if(e.parent()===this){var r=this.removeChild(e,a);h.a.performAction(TrackerType.Delete,{itemID:e.id,parent:this.id,position:r})}i.default.vmMain.beginUpdateItems(),this._moveChildrenHelper({newParent:e,index:t,isArchived:!1},a),this._moveChildrenHelper({newParent:e,index:t,isArchived:!0},a),i.default.vmMain.commitUpdateItems()},deleteSelf:function(e){this.parent().deleteChild(this,void 0,void 0,e),this.parent(void 0)},deleteChild:function(e,t,a,r){try{i.default.PAssert(2202,e,"Must provide a valid child to delete")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2203,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}if(h.a.beginAction(),i.default.vmMain.beginUpdateItems(),e.isNote())this.setNote(void 0,r);else if(e.hasChildren()||e.hasArchivedChildren())if(t)e.moveChildren(t,a,r);else for(var n=e.getItems(),s=n.length-1;s>=0;s--)e.deleteChild(n[s],void 0,void 0,r);if(e.hasNote()&&e.setNote(void 0,r),!e.isDeleted()){if(!e.isNote()){var l=this.removeChild(e,r);h.a.performAction(TrackerType.Delete,{itemID:e.id,parent:this.id,position:l})}this.shouldSave()&&o.a.deleteItem(e,r)}e.notifyItemPropertyChanged(r,"isDeleted"),y.a.fireEvent("itemStateChanged",[this]),i.default.timeline.updateNotifications(e),i.default.vmMain.commitUpdateItems(),h.a.endAction()},replaceChild:function(e,t,a){try{i.default.PAssert(2204,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2205,!e.isNote(),"Old child should not be a note")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2206,!t.isNote(),"New child should not be a note")}catch(e){i.default.reportError(e)}var r=e.getIndex();this.items.removeAt(r),h.a.performAction(TrackerType.Delete,{itemID:e.id,parent:this.id,position:r}),o.a.deleteItem(e,a),t.moveTo({parent:this,index:r},a),o.a.removeItem(this,r+1,e,!1,a),e.moveChildren(t,t.numChildren(),a);var n=t.parent().id;if(n!==this.id){var s=t.parent().items.remove(t);h.a.performAction(TrackerType.Move,{itemID:t.id,oldParent:n,oldPosition:s,newParent:this.id,newPosition:r})}},getChildren:function(){if(!this.isNote())return this.hasNote()?[this.getNote()].concat(this.getItems()):this.getItems()},getChild:function(e){try{i.default.PAssert(2207,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2208,e>=0,"Child index is out of range: ",e)}catch(e){i.default.reportError(e)}try{i.default.PAssert(2209,e<this.numItems(),"Child index out of range: ",e,this.numItems())}catch(e){i.default.reportError(e)}return this.itemAtIndex(e)},getFirstChild:function(){try{i.default.PAssert(2210,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}return this.hasChildren()?this.itemAtIndex(0):void 0},isFirstChild:function(){try{i.default.PAssert(2211,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}return!!this.parent()&&this.parent().getFirstChild()===this},getLastChild:function(){try{i.default.PAssert(2212,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}return this.hasChildren()?this.itemAtIndex(this.numItems()-1):void 0},isLastChild:function(){try{i.default.PAssert(2213,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}return!!this.parent()&&this.parent().getLastChild()===this},isDescendantOf:function(e){for(var t=this.parent();t&&t!==e;)t=t.parent();return void 0!==t},getChildIndex:function(e){try{i.default.PAssert(2214,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2215,!e.isNote(),"Should not get the index of an item note")}catch(e){i.default.reportError(e)}return this.getIndexOf(e.id,e.isArchived())},getIndexOf:function(e,t){try{i.default.PAssert(2216,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2217,i.default.isString(e),"ID must be a valid string: "+i.default.getObjectInfo(e))}catch(e){i.default.reportError(e)}var a,r=-1;if(t?this.hasArchivedChildren()&&(a=this.archivedItems(!0)):a=this.getItems(),a)for(var n=0;n<a.length;++n)if(a[n].id===e){r=n;break}return r},getRemoteIndexOf:function(e,t){try{i.default.PAssert(2218,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2219,!e.isNote(),"Should never be getting a remote child index of a note")}catch(e){i.default.reportError(e)}var a=l.a.getItemList(this.data,t),r=-1;return a&&(r=a.indexOf(e)),r},getIndex:function(){try{i.default.PAssert(2221,!this.isNote(),"Should never be getting a child index of a note")}catch(e){i.default.reportError(e)}return this.parent().getChildIndex(this)},hasChildren:function(){return!this.isNote()&&this.numItems()>0},numChildren:function(){try{i.default.PAssert(2222,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}return this.numItems()},canZoom:function(){return!this.isNote()&&(this.numChildren()>0||this.getParsedText().length>0)},parents:function(e){for(var t=[],a=this.parent();a&&a!==e;)t.splice(0,0,a),a=a.parent();return t},getArchivedTitle:function(){for(var e="",t=this.parent();t.parent();)e=t.getParsedText()+(e?" | "+e:""),t=t.parent();return e||(e=o.a.getRootModel().getParsedText()),e},getSiblings:function(e){try{i.default.PAssert(2223,!this.isNote(),"Notes cannot use this function")}catch(e){i.default.reportError(e)}e=e||0;var t=[];if(this.parent())for(var a=this.parent().getItems(),r=e,n=a.length;r<n;r++)a[r]!==this&&t.push(a[r]);return t},nextSibling:function(){var e=this.getIndex();return this.parent().getItems()[e+1]},isRootItem:function(){var e=this.getItemStore();return!!e&&e.isRoot(this)},clone:function(e,t){try{i.default.PAssert(2224,!i.default.isAutoChange(t),"Cloning should always be a user action")}catch(e){i.default.reportError(e)}var a=e.getItemStore().createItemRaw({text:this.getRawText(),isComplete:this.isComplete(),dateText:this.getDateText(),date:this.date(),dateFormat:this.getDateFormat(),duration:this.getDuration(),durationText:this.getDurationText(),priority:this.priority(),isStarred:this.isStarred(),isNote:this.isNote()},{parent:e,changeType:t});a.shouldSave()&&i.default.isLocalChange(t)&&a.save(void 0,SaveFlag.None);for(var r=0;r<this.numItems();++r){var n=this.itemAtIndex(r).clone(a,t);a.insertItem(n)}if(this.hasNote()){var s=this.getNote().clone(a,t);a.setNote(s,t)}return a},getItems:function(){return this.items.get()},itemAtIndex:function(e){return this.items.get()[e]},numItems:function(){return this.items.get().length},itemsHasMutated:function(){try{i.default.PAssert(2225,!this._destroyed,"Item should not fire mutation events once destroyed: ",this.id)}catch(e){i.default.reportError(e)}!this._destroyed&&this.isInitialized&&(P.a.clearCacheForItem(this.id),y.a.fireEvent("itemBoldChanged",[{item:this}]),this.getItemStore().updateItems(this),this.itemChanged.notify())},numChildrenRecursive:function(){var e=0,t={item:this,each:function(t){e++}};return i.default.searchVMLIs(t),e},isOnDate:function(e){var t=this.date(),a=this.repeatDate();if(t){if(e.hasTimeOfDay()){if(t.equals(e))return!0}else if(t.clone().clearTime().equals(e))return!0}else if(a&&a.includesDate(e))return!0},getCalendarColor:function(){var e;if(this.isComplete())return"#ddd";if(this.hasAttachmentType(s.a.PluginType.Calendar)){var t=this.getAttachmentByType(s.a.PluginType.Calendar);e=t.getPlugin().getCalendarBackgroundColor(t.getField("calendarID"))}else e="rgba(0, 153, 221, 0.85)";return e},getCalendarDisplayProps:function(){var e;if(this.hasAttachmentType(s.a.PluginType.Calendar)){var t=this.getAttachmentByType(s.a.PluginType.Calendar);e=t.getPlugin().getCalendarDisplayProps(t.getField("calendarID"))}return e},allowTextEditing:function(){var e=!0;return(n.a.android&&this.hasAttachments()||!i.default.vmMain.pluginManager.allowTextEditing(this))&&(e=!1),e},getPreviousItem:function(){var e=this.parent(),t=e.getChildIndex(this);if(t>0)return e.getChild(t-1)}},r.a.defineBase(D),r.a.extend(D.prototype,d.a),r.a.extend(D.prototype,c.a),r.a.extend(D.prototype,Object(u.a)(D)),t.a=D},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(7),s=a(4),o=a(18),l=(a(23),a(8)),d=a(11),c=a(36),u=(a(37),{dragStart:function(e,t){var a=e.pane||i.default.focusedPane;try{i.default.PAssert(2448,!0,"Should not be able to drag/drop on timeline on mobile")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2449,a.isItemDraggable(this),"Pane must be draggable in order to start a drag")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2450,o.a.startDragItem,"Should always have a valid item to start dragging from")}catch(e){i.default.reportError(e)}var r=i.default.getElementParent(e.startSrc||e.target);try{i.default.PAssert(2451,r,"Must have a valid target node")}catch(e){i.default.reportError(e)}if(r){var n,s;if(o.a.startDragItem=void 0,o.a.dragItem=this,a.isViewCalendar()||t)n=[{item:this,levelsDeep:0}];else{var l=i.default.getPaneObjectForElement(r),d=this.levelsDeep.get(),c=l.levelsDeep;if(n=[l],s=l.block,!this.isCollapsed(a)){var u=this.getVisibleChildren(a),h={},f=[];h[this.id]=l;for(var p=0;p<u.length;p++){var m=u[p],g={item:m,levelsDeep:m.levelsDeep.get()-d+c,index:l.index+p+1,parentObject:h[m.parent().id]};h[m.id]=g,f.push(g)}n=n.concat(f)}}var v=i.default.offset(r),y=v.left,S=v.top;i.default.vmMain.paneManager.runForEachPane(function(e){e.addScrollListener(this.dragScroll)}.bind(this));var E={x:e.eventX,y:e.eventY},P={dropEffect:a.dropEffect(this),item:this,element:r,block:s,pane:a};o.a.start(this,n,y,S,a,E,P,t),i.default.disableMouseMove=!0}},dragMove:function(e){try{i.default.PAssert(2452,o.a.startInfo,"Must have started a drag to be valid")}catch(e){i.default.reportError(e)}if(o.a.startInfo){if("touchmove"===e.type){if(!e.cancelable)return void this.dragEnd(e);e.returnValue=!1,e.returnFalse=!0,e.preventDefault(),e.stopPropagation()}var t=e.eventX-o.a.startInfo.x,a=e.eventY-o.a.startInfo.y,r=i.default.elementFromPoint(e.eventX,e.eventY);o.a.setTransform(t,a),r&&o.a.handleDragOver({item:this,target:r,dataTransfer:o.a.dataTransfer,diffY:e.diffY,clientX:e.eventX,clientY:e.eventY,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn})}},dragScroll:function(e){if(o.a.isDragging){var t={eventX:l.a.mousePos.x,eventY:l.a.mousePos.y,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,diffY:0};this.dragMove(t)}},dragEnd:function(e){i.default.disableMouseMove=!1,o.a.stop(),e.target!==document.documentElement&&o.a.handleDrop({target:e.target,clientX:e.clientX,clientY:e.clientY,dataTransfer:o.a.dataTransfer,fromDropBucket:e.fromDropBucket,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn}),o.a.finish(),i.default.vmMain.paneManager.runForEachPane(function(e){e.getInfiniteList().hasScrollListener(this.dragScroll)&&e.removeScrollListener(this.dragScroll)}.bind(this)),i.default.disableMouseMove=!1},onTouchHoldTimeout:function(e){this._destroyed||(i.default.isKeyboardOpen?this.isLoupeOpen=!0:i.default.focusedPane&&i.default.focusedPane.isDropTarget&&this.isDraggable()&&i.default.focusedPane.isItemDraggable(this)&&!i.default.findParent(e.target,"androidInput")&&(this.isEditable.set(!1),o.a.startDragItem=this,this.dragStart(e),this.dragMove(e)))},checkDragOnStart:function(e){o.a.startDragItem=this,i.default.preventDefault(e),i.default.stopPropagation(e)},checkDragOnMove:function(e,t){if(o.a.startDragItem&&(!s.a.touch||Math.abs(e.distanceY)>i.default.ClickThreshold&&Math.abs(e.distanceX)<i.default.ClickThreshold)){var a=e.pane||i.default.focusedPane;o.a.startDragItem===this&&this.isDraggable()&&a.isItemDraggable(this)&&this.dragStart(e,t)}o.a.isDragging&&(this.dragMove(e),i.default.preventDefault(e),i.default.stopPropagation(e))},checkDragOnEnd:function(e){o.a.startDragItem=void 0,o.a.isDragging&&this.dragEnd(e)},onStart:function(e,t){var a=i.default.focusedPane;if(i.default.scrollAtTouchStart=a.getScrollOffset(),i.default.hasClass(t.target,"paneScroller"))s.a.useCustomScroller&&t.preventDefault();else if(i.default.hasClass(t.target,"prefixNumList"))t.preventDefault(),t.stopImmediatePropagation();else if(i.default.hasClass(t.target,"emptyItemAddButton"))i.default.menus.openContextMenu({componentName:"ReactContextMenuAddItem",element:t.target,item:this}),t.preventDefault(),t.stopImmediatePropagation();else if(i.default.hasClass(t.target,"link")){var r=t.target.getAttribute("data-href"),n=l.a.isSelected(e,a);n||s.a.mac&&t.metaKey||!s.a.mac&&t.ctrlKey||!i.default.isUrlImage(r)?(s.a.mac&&t.metaKey||!s.a.mac&&t.ctrlKey||i.default.findParent(t.target,"appLink",2)&&!n)&&(i.default.openUrl(r,t),i.default.handlerPreventStop(t)):(i.default.menus.openLightbox(r),i.default.handlerPreventStop(t))}else this.isDraggable()&&a.isItemDraggable(this)&&(i.default.hasClass(t.target,"collapser")||i.default.hasClass(t.target,"itemMenuIcon")||i.default.hasClass(t.target,"agendaTime")||i.default.hasClass(t.target,"itemEditButton")||i.default.hasClass(t.target,"itemPrefix")||i.default.findParent(t.target,"plugin")&&!a.isEditable)?(this.checkDragOnStart(t),i.default.vmMain.updateCursorFromEvent(t)):i.default.hasClass(t.target,"itemCheckbox")||(i.default.hasClass(t.target,"itemIgnoreText")?(t.preventDefault(),t.stopImmediatePropagation()):i.default.vmMain.pluginManager.handleTapStart(this,a,t))},onMove:function(e,t){this.checkDragOnMove(e,!1)},onClick:function(e,t){var a=i.default.focusedPane,d=(i.default.getPaneObjectForElement(t.target),!1);if(d)d.pane.moveItem(d.item,this),o.a.stopDraggingToOutline();else if(i.default.hasClass(t.target,"prefixHeader")||i.default.hasClass(t.target,"prefixBullet"))i.default.vmMain.zoomin(this,!1,!0),t.preventDefault(),t.stopImmediatePropagation();else if((i.default.hasClass(t.target,"itemPrefix")||i.default.hasClass(t.target,"collapser")||i.default.hasClass(t.target,"itemMenuIcon"))&&(s.a.mac&&t.metaKey||!s.a.mac&&t.ctrlKey))i.default.vmMain.zoomin(this,!1,!0),t.preventDefault(),t.stopImmediatePropagation();else if(i.default.hasClass(t.target,"collapser"))a.handleLeftSideTap(this,t),t.preventDefault(),t.stopImmediatePropagation();else if(i.default.hasClass(t.target,"itemMenuIcon"))this.openItemMenu(t),t.preventDefault(),t.stopImmediatePropagation();else{if(i.default.hasClass(t.target,"itemCheckbox"))a.handleRightSideTap(this,t),t.preventDefault(),t.stopImmediatePropagation();else if(i.default.hasClass(t.target,"prefixTask"))a.supportCompleting&&(i.default.vmMain.beginCompleteAction(),this.isComplete(!this.isComplete(),ChangeType.Local),a.selectNearestItem(e),i.default.vmMain.endCompleteAction()),t.preventDefault(),t.stopImmediatePropagation();else if(i.default.hasClass(t.target,"itemAddButton")){var u=i.default.getDefaultItemText();this.addItemAtIndex(u,0,a);var h=a.indexOfNextVMLI(e,!1,!0);l.a.selectIndex(h,0),t.preventDefault(),t.stopImmediatePropagation()}else if(i.default.hasClass(t.target,"itemEditButton"))l.a.reset(),i.default.menus.openContextMenu({componentName:"ReactItemDetailsPopup",element:i.default.findParent(t.target,"item"),item:this,pane:a,selectIndex:0}),t.preventDefault(),t.stopImmediatePropagation();else if("SPAN"===t.target.tagName&&i.default.hasClass(t.target,"itemDataPageLoad"))this.notifyPaginationUpdate();else if(i.default.hasClass(t.target,"tag")){l.a.reset(),c.a.reset();u=t.target.textContent;t.shiftKey?a.search.setValue(u):a.search.toggleText(u,s.a.mac&&t.metaKey||!s.a.mac&&t.ctrlKey)}else if(i.default.hasClass(t.target,"contact")){if(s.a.mac&&t.metaKey||!s.a.mac&&t.ctrlKey){l.a.reset();u=t.target.textContent;t.shiftKey?a.search.setValue(u):a.search.addToValue(u)}else{u=t.target.textContent;var f=n.a.contactManager.findMatchExact(u[0]===r.a.ContactPrefix?u.substr(1):u);f&&i.default.menus.openContextMenu({componentName:"ReactContextMenuContactDetails",position:"bottom",element:t.target,contact:f})}0}else if(i.default.hasClass(t.target,"date")){if(s.a.mac&&t.metaKey||!s.a.mac&&t.ctrlKey){l.a.reset();u=t.target.textContent;t.shiftKey?a.search.setValue(u):a.search.addToValue(u)}}else if(i.default.hasClass(t.target,"email")){if(s.a.mac&&t.metaKey||!s.a.mac&&t.ctrlKey){var p=i.default.vmMain.getDefaultEmailPlugin();if(p.isActive()){l.a.reset();var m={to:[{text:"",email:u=t.target.textContent}]};i.default.menus.openComposeEmail(p,void 0,void 0,m)}}}else if(i.default.vmMain.pluginManager.handleTapClick(this,a,t))o.a.isDragging&&this.dragEnd(t);else{i.default.autocomplete&&i.default.autocomplete.hide()}}},onEnd:function(e){d.a.isListening("touchHoldTimeout",this.onTouchHoldTimeout)&&d.a.unlisten("touchHoldTimeout",this.onTouchHoldTimeout),this.checkDragOnEnd(e),i.default.itemMenuOpenedOn===this&&i.default.menus.menuItemSelected(e.target),this.isLoupeOpen=!1,i.default.vmMain.updateCursorFromEvent(e)},onCancel:function(e){o.a.isDragging&&this.dragEnd(e)},openItemMenu:function(e){i.default.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"menu"+this.id+e.clientX+e.clientY,element:e.target,item:this,pane:i.default.focusedPane,useItem:!0,pos:{left:e.pageX,top:e.pageY}})},onRightClick:function(e,t){this.openItemMenu(t),t.preventDefault(),t.stopPropagation()},onDoubleClick:function(e,t){var a=i.default.focusedPane;i.default.vmMain.pluginManager.handleDoubleTap(this,a,t)&&o.a.isDragging&&this.dragEnd(t)},onAutocompleteTapped:function(e,t,a){try{i.default.PAssert(2454,a,"Must be tracking the current AC tag")}catch(e){i.default.reportError(e)}var r=this.getParsedText(),n=l.a.getStartOffset()-a.length,s=r.substr(0,n)+e+r.substr(l.a.getStartOffset()+1);l.a.getPane().focus(),this.setText(s,!0,ChangeType.Local),l.a.selectIndex(l.a.getStartIndex(),n+t)}});t.a=u},function(e,t,a){"use strict";var i=a(17),r=a(0),n=a(1),s=(a(4),a(10)),o=a(49),l=a(27),d=a(43),c=a(8),u=a(11),h={_runAndGetSaveData:function(e,t,a){try{r.default.PAssert(2455,t,"We do not support deferred text paring")}catch(e){r.default.reportError(e)}if(this.shouldSave())var i=this.getMetaTextSaveData();if(this.setRawText(this.generateSaveText(e)),this.parseText(t,a),this.shouldSave()){var n=this.getMetaTextSaveData(),s={};for(var o in n)i[o]!==n[o]&&(s[o]=n[o])}return s},setText:function(e,t,a){try{r.default.PAssert(2456,r.default.isLocalChange(a)||!e||e.indexOf(window.AttachChar)<0,"Should never be setting text with an attach char in it")}catch(e){r.default.reportError(e)}try{r.default.PAssert(2457,this.isNote()||!e||e.indexOf("\n")<0,"Non-notes should never have newlines")}catch(e){r.default.reportError(e)}try{r.default.PAssert(2458,!e||r.default.isRemoteChange(a)||e.indexOf(window.TextSpace)<0,"Should never insert text space into item when editing locally")}catch(e){r.default.reportError(e)}a|=ChangeType.Text;var n=this.isPrefixHeader();!this.isNote()&&e&&e.indexOf("\n")>=0&&(e=e.replace(/\n/g," ")),this.isInitialized&&l.a.clearCacheForItem(this.id);var s,o=this._runAndGetSaveData(e,t,a);this.shouldSave()&&(o.text=this.generateSaveText(e),r.default.isLocalChange(a)&&!r.default.isUndoRedoChange(a)?(i.a.saveChanges(this,o),s=SaveFlag.Text):s=SaveFlag.None,o.dateText=this.getDateText(),o.durationText=this.getDurationText(),this.save(o,s));this.isPrefixHeader()!==n&&u.a.fireEvent("itemStateChanged",[this])},metricsInPane:function(e,t){var a;try{var i=t>=0&&c.a.isSelected(t,e),n=e.objectAtIndex(t);a=l.a.measurePaneObject(n,e,i)}catch(e){r.default.reportError(e)}return a},sizeInPane:function(e,t,a){if(a)return n.a.OverviewItemHeightDesktop;if(this.isNote())return l.a.lineItemHeight(this,e,1);var i=e.objectAtIndex(t),r=this.metricsInPane(e,t).height;return this.shouldShowParents(i,e)&&(r+=n.a.HeightAgendaParents),r},shouldShowParents:function(e,t){return t.type===PaneMode.Task&&!t.isSearchedFlat()&&(t.isViewTag()||t.isViewAgenda()||t.isViewContact()||t.isViewPriority())&&!e.item.isNote()&&0===e.levelsDeep&&e.item.parent()!==t.getItem()},generateExportText:function(e,t){return void 0!==e&&null!==e?this._generateUsableText(e,"getExportString",t):null},generateSaveText:function(e,t){return void 0!==e&&null!==e?this._generateUsableText(e,"getEmbedString",t):null},generateTitleText:function(){var e=this.getParsedTextWithoutPrefix();return this.hasAttachments()?this._generateUsableText(e,"getTitleString").replace(/[\*_]/g,""):e},_generateUsableText:function(e,t,a){try{r.default.PAssert(2459,this.hasAttachments()||e.indexOf(window.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(e){r.default.reportError(e)}var i=e;if(this.hasAttachments()&&e.indexOf(window.AttachChar)>=0){var n=a||0,s=this.getNumAttachments();i=e.replace(/\u2000/g,function(){if(n<s){var e=this.getAttachment(n);return n++,e.isLoaded()?e[t]():""}try{r.default.PAssert(2460,!1,"Unable to find valid attachment for AttachChar")}catch(e){r.default.reportError(e)}return""}.bind(this));try{r.default.PAssert(2461,i.indexOf(window.AttachChar)<0,"Should convert all attachments to their string form")}catch(e){r.default.reportError(e)}}return i},splitUsableText:function(e,t,a){try{r.default.PAssert(2462,this.hasAttachments()||e.indexOf(window.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(e){r.default.reportError(e)}var i=e.substring(0,t)+e.substring(a),n=t;if(this.hasAttachments()&&e.indexOf(window.AttachChar)>=0){var s=0,o=this.getNumAttachments();i=e.replace(/\u2000/g,function(e,a){if(s<o){var i=this.getAttachment(s);s++;var r=i.getEmbedString();return a<t&&(n+=Math.max(r.length-1,0)),r}return window.AttachChar}.bind(this));try{r.default.PAssert(2463,i.indexOf(window.AttachChar)<0,"Should convert all attachments to their string form")}catch(e){r.default.reportError(e)}}return{before:i.substring(0,n),after:i.substring(n)}},parseText:function(e,t,a){try{r.default.PAssert(2464,!this.isDestroyed(),"Must not parse a destroyed VMLI")}catch(e){r.default.reportError(e)}try{r.default.PAssert(2465,e,"Currently we only support immediate parsing")}catch(e){r.default.reportError(e)}try{r.default.PAssert(2466,r.default.isValidChangeType(t),"Must specify a valid changetype")}catch(e){r.default.reportError(e)}var i;if(this.__TEMP_ParseCalled=!0,e){if(this.isNote())i=d.a.parseNote(this);else{var n=this.getParser();try{r.default.PAssert(2467,n,"Must be able to get valid parse function for item")}catch(e){r.default.reportError(e)}if(!n)return;i=n(this,t)}r.default.isFlagSet(t,ChangeType.Local)&&i.numContacts>0&&s.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddContact,data:[{itemID:this.id}]})}else try{r.default.PAssert(2468,!1,"Should always be using immediate parse")}catch(e){r.default.reportError(e)}var o=this.isPrefixNumList(),l=this.styleText(i,e,t,a);return this.itemChanged.notify(),this.isInitialized&&this.isPrefixNumList()!==o&&u.a.fireEvent("numListChanged",[]),l},styleText:function(e,t,a,i){try{r.default.PAssert(2469,t,"Currently we only support full parses")}catch(e){r.default.reportError(e)}try{r.default.PAssert(2470,r.default.isValidChangeType(a),"Must specify a valid changetype")}catch(e){r.default.reportError(e)}try{r.default.PAssert(2471,!(!e&&t),"In a full parse, styleInfo should always be defined")}catch(e){r.default.reportError(e)}var n=!1;if(e){this.prefix=e.prefix,t&&this.setParsedText(e.parsedText);try{r.default.PAssert(2472,e.els||r.default.isFlagSet(a,ChangeType.ItemLoad),"Must always return an els list")}catch(e){r.default.reportError(e)}if(e.els&&(this.els=e.els),this.prefix&&s.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SetPrefix,data:{itemID:this.id,prefix:this.prefix}}),e.dates){0===e.dates.length&&(this.date()||this.repeatDate())&&(this.setDateText(void 0),this.setDurationText(void 0),this.repeatDate()&&!this.isForceCompleted()&&(this.dateCompleted=void 0,i&&(n=!0,i.dateCompleted=void 0)),this.setDateFormat(void 0),this.date(null,a),this.setRepeatDate(null,a),this.setDuration(0),i&&(n=!0,i.date=void 0,i.dateText=void 0,i.dateFormat=void 0,i.repeatDate=void 0,i.duration=void 0,i.durationText=void 0));for(var l=0;l<e.dates.length;++l){var d=e.dates[l];if(d.type===DateType.Once)this.getDateText()!==d.origText&&(this.setDateText(d.origText),i&&(n=!0,i.dateText=d.origText)),d.date&&this.date()&&d.date==this.date()||(!!d.date^!!this.date()||d.dateFormat!==this.getDateFormat()||this.date()&&d.date.getTime()!==this.date().getTime())&&(this.setDateFormat(d.dateFormat),this.date(d.date,a),i&&(n=!0,i.date=d.date?d.date.getTime():void 0,i.dateFormat=d.dateFormat)),this.repeatDate()&&(this.setRepeatDate(null,a),i&&(n=!0,i.repeatDate=void 0));else if(d.type===DateType.Repeat){var c=d.oldText||d.text;this.getDateText()!==c&&(this.setDateText(c),i&&(n=!0,i.dateText=c));var u=new o.a(d);u.isValid()?(!this.repeatDate()||d.dateFormat!==this.getDateFormat()||!u.equals(this.repeatDate())||!!u^!!this.repeatDate())&&((!u||this.repeatDate()&&!this.repeatDate().getStartDate().equals(u.getStartDate()))&&(this.isForceCompleted()||(this.dateCompleted=void 0,i&&(n=!0,i.dateCompleted=void 0))),this.setDateFormat(d.dateFormat),this.setRepeatDate(u,a),i&&(n=!0,i.repeatDate=u.toString())):r.default.reportError(new Error("Local invalid repeat date: "+d)),this.date()&&(this.date(null,a),i&&(n=!0,i.date=void 0))}}}else(this.date()||this.repeatDate())&&t&&(this.setDateText(void 0),this.setDurationText(void 0),this.repeatDate()&&!this.isForceCompleted()&&(this.dateCompleted=void 0,i&&(n=!0,i.dateCompleted=void 0)),this.setDateFormat(void 0),this.date(null,a),this.setRepeatDate(null,a),this.setDuration(0),i&&(n=!0,i.date=void 0,i.dateText=void 0,i.dateFormat=void 0,i.repeatDate=void 0,i.duration=void 0,i.durationText=void 0));if(e.durations&&e.durations.length>0)for(l=0;l<e.durations.length;++l){var h=e.durations[l];this.setDuration(h.duration),this.setDurationText(h.durationText)}else this.getDuration()>0&&(this.setDuration(0),this.setDurationText(void 0),i&&(n=!0,i.duration=void 0,i.durationText=void 0));if((e.tags||this._activeTags)&&this.setTags(e.tags),(e.contacts||this._activeContacts)&&this.setContacts(e.contacts),e.attachments||this.hasAttachments()){var f=[];for(l=0;e.attachments&&l<e.attachments.length;++l){var p=r.default.vmMain.pluginManager.getAttachment(e.attachments[l]);p&&(f.push(p),r.default.isLocalChange(a)&&!p.getOldID()&&p.notifyItemTextChanged(this,!1))}this.setAttachments(f,a)}}return n},getCalendarRawText:function(){return this.getRawText().replace(this.getItemDateString(),"").replace(/^ +/g,"").replace(/ +$/g,"")},getCalendarParsedText:function(){var e;this.hasAttachmentType(n.a.PluginType.Email)?e=this.getAttachmentByType(n.a.PluginType.Email).getField("subject"):e=this.getParsedTextWithoutPrefix().replace(this.getItemDateString(),"").replace(/\u2000/g,"");return e.trim()},getStyledTextAsOneLine:function(e,t){var a;return t&&(a='<span class="numChildren c-foreground-super-faded">'+this.numItems()+"</span>"),d.a.generateHTML(this.els,!1,void 0,e,a)},hasText:function(){var e=this.getParsedText();return this.getDateText()&&(e=e.replace(n.a.DatePrefix+this.getDateText(),"")),(e=e.replace(/ /g,"")).length>0},setPrefix:function(e){var t=this.getRawText(),a=this.getPrefix();a&&(t=t.substr(a.length)),this.prefix=e,t=(e?e+" ":"")+t,this.setText(t,!0,ChangeType.Local)},getPrefix:function(){return this.prefix?this.prefix+" ":""},getPrefixLength:function(){return this.prefix?this.prefix.length+1:0},isPrefixHeader:function(e){var t;return e&&(t=e.search.getItemPrefix(this)),void 0===t&&(t=this.prefix),t&&0===t.indexOf(n.a.Prefix.Header)},isPrefixTask:function(){return this.prefix&&this.prefix===n.a.Prefix.Task||this.prefix===n.a.Prefix.Task2||this.prefix===n.a.Prefix.Task3||this.prefix===n.a.Prefix.Task4},isPrefixBullet:function(){return this.prefix&&this.prefix===n.a.Prefix.Bullet||this.prefix===n.a.Prefix.Bullet2||this.prefix===n.a.Prefix.Bullet3},isPrefixNumList:function(){return this.prefix&&this.prefix[0]>=0&&this.prefix[0]<10},hasPrefix:function(){return!!this.prefix},numListNumber:function(){if(this.isPrefixNumList()){for(var e=1,t=this.parent(),a=this.getIndex()-1;a>=0;--a,++e){var i=t.getChild(a);if(!i||!i.isPrefixNumList())break}return e}},shouldCopyPrefix:function(){return this.isPrefixTask()||this.isPrefixBullet()||this.isPrefixNumList()},getParsedTextWithoutPrefix:function(){var e=this.getPrefix(),t=this.getParsedText();return e?t.substr(e.length):t},applyFormatToSelection:function(e,t,a,i){var r,s,o,l=this.getParsedText(),d=t,c=a,u=!1;for(o=t;o>=Math.max(t-e.length,0);o--)if(l.substr(o,e.length)===e){r=o;break}for(o=a-e.length;o<=a;o++)if(l.substr(o,e.length)===e){s=o;break}return isNaN(r)||isNaN(s)||i===n.a.SetMode.Yes?i!==n.a.SetMode.No&&(d=t+e.length,c=a+e.length,l=l.substr(0,t)+e+l.substr(t,a-t)+e+l.substr(a),u=!0):(d=r,c=s-e.length,l=l.substr(0,r)+l.substr(r+e.length,s-r-e.length)+l.substr(s+e.length)),this.setText(l,!0,ChangeType.Local),{didSet:u,selStart:d,selEnd:c}},insertLinkAtSelection:function(){if(c.a.isValid()&&c.a.getStartIndex()===c.a.getEndIndex()){var e=c.a.getStartOffset(),t=c.a.getEndOffset(),a=this.getRawText().substr(e,t-e);r.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:c.a.getEndElement(),onInsertLink:this.onInsertLink,text:a})}},onInsertLink:function(e){if(c.a.isValid()&&c.a.getStartIndex()===c.a.getEndIndex()){var t=c.a.getStartOffset(),a=c.a.getEndOffset(),i=this.getRawText(),r=i.substr(t,a-t),n=a+e.text.length+e.url.length+4-r.length;i=i.substr(0,t)+"["+e.text+"]("+e.url+")"+i.substr(a),this.setText(i,!0,ChangeType.Local),c.a.selectIndex(c.a.getStartIndex(),n)}}};t.a=h},function(e,t,a){"use strict";var i=a(0),r=a(7),n=a(17),s=a(10),o=a(49),l=a(8);t.a=function(e){function t(e,s){var o;if(s)for(var l=0;l<s.length;++l){var d=s.get(l);try{i.default.PAssert(2473,d,"Item must exist to get it from the array")}catch(e){i.default.reportError(e)}if(d&&d.id){n.a.setItemParent(d,e);var c=r.a.getModel(d.id);c?c.linkToGDrive(d):(o=d,n.a.cacheItem(o),a(o,n.a.get(o,"note")),t(o,n.a.get(o,"items")),t(o,n.a.get(o,"archivedItems")))}else{if(d)try{i.default.reportError(new Error("Item in list without defined ID: "+i.default.getObjectInfo(d)+" : "+JSON.stringify(d)))}catch(e){i.default.reportError(e)}else i.default.reportError(new Error("Removing undefined/null value form remote list"));s.remove(l),l--}}}function a(e,t){if(t){n.a.setItemParent(t,e);var a=r.a.getModel(t.id);a?a.linkToGDrive(t):n.a.cacheItem(t)}}return{changeTypeFromEvent:function(e){var t;return this.isLocalEvent(e)?(t=ChangeType.Local,s.a.undoRedoActive&&(t|=ChangeType.UndoRedo)):t=ChangeType.Remote,t},linkToGDrive:function(e,r){try{i.default.PAssert(2474,e,"Must be passing in valid data")}catch(e){i.default.reportError(e)}if(!this.data){if(e){try{i.default.PAssert(2475,void 0===e.connectIdentifier,"Should never have a connect identifier present during link")}catch(e){i.default.reportError(e)}e.connectIdentifier=n.a.connectIdentifier(),this.data=e,n.a.cacheItem(e)}this.setRemoteVersion(VersionType.Structure,n.a.getVersion(e,VersionType.Structure)),this.setRemoteVersion(VersionType.Text,n.a.getVersion(e,VersionType.Text)),r&&(this.setVersion(VersionType.Structure,this.getRemoteVersion(VersionType.Structure)),this.setVersion(VersionType.Text,this.getRemoteVersion(VersionType.Text))),a(e,n.a.get(e,"note")),t(e,n.a.get(e,"items")),t(e,n.a.get(e,"archivedItems"))}},initFromGDrive:function(e){try{i.default.PAssert(2480,e,"To initialize from gdrive a valid remote data object must be passed in")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2481,!s.a.undoRedoActive,"Should not be initializing new VMLIs from gdrive during undo/redo")}catch(e){i.default.reportError(e)}if(e){if(this.data=e,e.connectIdentifier)try{i.default.PAssert(2484,e.connectIdentifier===n.a.connectIdentifier(),"Should never have a connect identifier present during link")}catch(e){i.default.reportError(e)}else e.connectIdentifier=n.a.connectIdentifier();if(n.a.getItemParent(this.data))try{i.default.PAssert(2485,n.a.getItemParent(this.data).id===this.parent().id,"Item parent must match")}catch(e){i.default.reportError(e)}else this.parent()&&n.a.setItemParent(this.data,this.parent().data);n.a.cacheItem(this.data);var t=void 0===this.id||this.forceModifiedItems,a=t?void 0:{},r=!1;this.id=e.id;try{r=this.resolveMisc(a)||r,(r=this.resolveText(a)||r)&&i.default.vmMain.addParseItem(this,ChangeType.Remote|ChangeType.DocLoad|ChangeType.All),this.computeDisplayComplete(),this.isNote()||this.resolveItems(a)}catch(e){i.default.reportError(e)}if(t){try{i.default.PAssert(2486,void 0===a,"If doing a full save, remoteChanges should always be undefined")}catch(e){i.default.reportError(e)}this.setVersion(VersionType.Structure,this.getRemoteVersion(VersionType.Structure)),this.setVersion(VersionType.Text,this.getRemoteVersion(VersionType.Text)),this.save(null,SaveFlag.None)}else if(!i.default.isEmpty(a)){!0!==a.isDeleted&&(a.isDeleted=void 0);try{i.default.PAssert(2487,a.hasOwnProperty("version")||a.hasOwnProperty("versionText"),"If making remote changes, the version should have changed")}catch(e){i.default.reportError(e)}a.hasOwnProperty("version")&&this.setVersion(VersionType.Structure,a.version),a.hasOwnProperty("versionText")&&this.setVersion(VersionType.Text,a.versionText),this.save(a,SaveFlag.None)}n.a.attachEventsToItem(this)}else i.default.reportError(new Error("FATAL ERROR - No remote data for item"))},resolveText:function(e){var t=!1;if(this.modifiedOfflineText&&!this.forceModifiedItems)if(this.isLocalVersionNewer(VersionType.Text))n.a.saveChanges(this,{text:this.getRawText()});else{var a=n.a.get(this.data,"text");try{i.default.PAssert(2488,void 0!==a,"Every item should have text associated with it from gdrive")}catch(e){i.default.reportError(e)}var s=!1;if(this.getRawText()!==a&&(s=!0),s)if(this.isNote())this.setText(a,!0,ChangeType.Remote|ChangeType.DocLoad|ChangeType.Text),i.default.vmMain.addModifiedItem(this,ChangeType.Remote|ChangeType.DocLoad|ChangeType.Text),e&&(e.text=this.getRawText(),e.modifiedOfflineText=!1);else{var o=this.getIndex(),l=r.a.createVMLI({text:this.getRawText()},{parent:this.parent(),changeType:ChangeType.Local|ChangeType.DocLoad});this.parent().insertItem(l,o+1),this.setText(a,!0,ChangeType.Remote|ChangeType.DocLoad),i.default.vmMain.addModifiedItem(this,ChangeType.Remote|ChangeType.Text|ChangeType.DocLoad),e&&(e.text=this.getRawText(),e.dateText=this.getDateText(),e.dateFormat=this.getDateFormat(),e.durationText=this.getDurationText())}else e&&(e.modifiedOfflineText=!1);e&&(e.versionText=this.getRemoteVersion(VersionType.Text),i.default.vmMain.addModifiedItem(this,ChangeType.Remote|ChangeType.Text|ChangeType.DocLoad,e))}else if(this.isRemoteVersionNewer(VersionType.Text)){a=n.a.get(this.data,"text");try{i.default.PAssert(2489,void 0!==a,"Every item should have text associated with it from gdrive")}catch(e){i.default.reportError(e)}this.getRawText()!==a&&(this.setText(a,!0,ChangeType.Remote|ChangeType.DocLoad),e&&(e.text=this.getRawText(),e.dateText=this.getDateText(),e.dateFormat=this.getDateFormat(),e.durationText=this.getDurationText()),this.isVersionUninitialized(VersionType.Text)||(t=!0)),e&&this.getVersion(VersionType.Text)!==this.getRemoteVersion(VersionType.Text)&&(e.versionText=this.getRemoteVersion(VersionType.Text),i.default.vmMain.addModifiedItem(this,ChangeType.Remote|ChangeType.Text|ChangeType.DocLoad,e))}return t},resolveMisc:function(e){var t=this.modifiedOfflineText&&this.isLocalVersionNewer(VersionType.Text),a=!1,r=!1;if(t||this.isRemoteVersionNewer(VersionType.Structure)||this.isRemoteVersionNewer(VersionType.Text)){var s={},l=n.a.get(this.data,"dateFormat");(l||this.getDateFormat())&&this.getDateFormat()!==l&&(t?(s.dateFormat=this.getDateFormat(),r=!0):(this.setDateFormat(l,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad),e&&(e.dateFormat=this.getDateFormat())));var d=n.a.get(this.data,"date");if((d||this.date())&&(!this.date()||this.date().getTime()!==d))if(t&&this.date())s.date=this.date().getTime(),r=!0;else{if(d){var c=new Date(d);this.date(c,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad)}else this.date(null,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad);e&&(e.date=this.getDateTime()),this.isVersionUninitialized(VersionType.Text)||(a=!0)}var u=n.a.get(this.data,"dateCompleted");if((u||this.dateCompleted)&&(!this.dateCompleted||!u||this.dateCompleted.getTime()!==u))if(t)s.dateCompleted=this.dateCompleted?this.dateCompleted.getTime():void 0,r=!0;else{var h=u;try{i.default.PAssert(2490,"string"!=typeof u,"Invalid date format stored")}catch(e){i.default.reportError(e)}this.dateCompleted=new Date(h),e&&(e.dateCompleted=h)}var f=n.a.get(this.data,"repeatDate");if((f||this.repeatDate())&&(!this.repeatDate()||!this.repeatDate().equals(f)))if(t&&this.repeatDate())s.repeatDate=this.repeatDate().toString(),r=!0;else{if(f){var p=new o.a(f);p.isValid()?this.setRepeatDate(p,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad):i.default.reportError(new Error("Remote init invalid repeat date: "+f))}else this.setRepeatDate(null,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad);e&&(e.repeatDate=this.getRepeatDateString()),this.isVersionUninitialized(VersionType.Text)||(a=!0)}var m=n.a.get(this.data,"dateCreated");if(!this.dateCreated||!m||this.dateCreated.getTime()!==m)if(t)s.dateCreated=this.dateCreated?this.dateCreated.getTime():void 0,r=!0;else{h=m;try{i.default.PAssert(2491,"string"!=typeof m,"Invalid date format stored")}catch(e){i.default.reportError(e)}this.dateCreated=new Date(h),e&&(e.dateCreated=h)}var g=n.a.get(this.data,"priority");(g||this.priority())&&this.priority()!==g&&(t?(s.priority=this.priority(),r=!0):(null===g&&(g=VMLIFlag.None),this.priority(g,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad)));var v=n.a.get(this.data,"isStarred");(v||this.isStarred())&&this.isStarred()!==v&&(t?(s.isStarred=this.isStarred(),r=!0):(null===v&&(v=!1),this.isStarred(v,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad)));var y=n.a.get(this.data,"isComplete");(y||this.isComplete())&&this.isComplete()!==y&&(t?(s.isComplete=this.isComplete(),r=!0):(null===y&&(y=!1),this.isComplete(y,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad)));var S=n.a.get(this.data,"favorites");if((S||this.getFavorites())&&S!=this.getFavorites()&&(t?(s.favorites=this.getFavorites(),r=!0):(null===S&&(S=void 0),this.setFavorites(S,ChangeType.Remote|ChangeType.Property|ChangeType.DocLoad))),t){try{i.default.PAssert(2492,r===!i.default.isEmpty(s),"Verify modLocal is computed properly. It should track any changes to localChanges")}catch(e){i.default.reportError(e)}!0===r&&n.a.saveChanges(this,s)}}return a},resolveNote:function(e){var t=n.a.get(this.data,"note"),a=this.hasNote()?this.getNote():void 0;if(t)if(a)a.initFromGDrive(t);else{var s=r.a.getItem(t.id);if(s){if(s.isDeleted){try{i.default.PAssert(2493,i.default.isReconnected||!a,"The local model should never exist when an item has been marked as deleted locally")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2494,s.modifiedOffline,"How did the note get deleted if it wasn't modified offline?")}catch(e){i.default.reportError(e)}n.a.getVersion(t,VersionType.Structure)==s.version?n.a.noteSet(this,void 0):(a=r.a.createVMLI({data:t,isNote:!0},{parent:this,changeType:ChangeType.Remote|ChangeType.DocLoad}),r.a.undeleteItem(a,ChangeType.AllRemote|ChangeType.DocLoad),this.setNote(a,ChangeType.AllRemote|ChangeType.DocLoad),i.default.vmMain.addModifiedItem(a,ChangeType.AllRemote|ChangeType.DocLoad))}}else a=r.a.createVMLI({data:t,isNote:!0},{parent:this,changeType:ChangeType.Remote|ChangeType.DocLoad}),this.setNote(a,ChangeType.AllRemote),i.default.vmMain.addModifiedItem(a,ChangeType.AllRemote|ChangeType.DocLoad)}else a&&(r.a.initializeItem(a),n.a.noteSet(this,a))},resolveItemsHelper:function(e,t){var a,s,o,l,d,c=n.a.getItemList(this.data,e);d=e?this.hasArchivedChildren()?this.archivedItems(!0):[]:this.getItems();try{i.default.PAssert(2495,d,"Item arrays must exist")}catch(e){i.default.reportError(e)}for(a=0;c&&a<c.length;a++)if(s=c.get(a)){try{i.default.PAssert(2497,void 0===n.a.loadSeen[s.id]||!1===n.a.loadSeen[s.id],"Items can only be seen once on the remote.")}catch(e){i.default.reportError(e)}if(n.a.loadSeen[s.id]=this.id,(M=this.getIndexOf(s.id,e))>=0)(o=d[M]).initFromGDrive(s);else if(_=r.a.getItem(s.id),o=r.a.getModel(s.id),_)if(_.isDeleted){try{i.default.PAssert(2499,_.modifiedOffline,"How did the item get deleted if it wasn't modified offline?")}catch(e){i.default.reportError(e)}if(n.a.getVersion(s,VersionType.Structure)==_.version)n.a.itemRemoved({item:this,index:a,numToRemove:1,isArchived:e}),a--;else{if(o){try{i.default.PAssert(2500,void 0===o.parent(),"Should never have a parent if deleted")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2501,o.data===s,"Local model should match remote data")}catch(e){i.default.reportError(e)}o.parent(this)}else o=r.a.createVMLI({data:s,isArchived:e},{parent:this,changeType:ChangeType.Remote|ChangeType.DocLoad});r.a.undeleteItem(o,ChangeType.Remote|ChangeType.DocLoad),d.splice(a,0,o),l=!0,i.default.vmMain.addModifiedItem(o,ChangeType.Remote|ChangeType.Structure|ChangeType.DocLoad)}}else if(o&&o.modifiedOffline)if(o.isLocalVersionNewer(VersionType.Structure)){try{i.default.PAssert(2502,n.a.loadSeen[s.id]===this.id)}catch(e){i.default.reportError(e)}n.a.loadSeen[s.id]=!1}else o.moveTo({parent:this,index:a,shouldBeArchived:e},ChangeType.Remote|ChangeType.DocLoad),o.initFromGDrive(s),l=!0,i.default.vmMain.addModifiedItem(o,ChangeType.Remote|ChangeType.Structure|ChangeType.DocLoad);else o?(o.moveTo({parent:this,index:a,shouldBeArchived:e},ChangeType.Remote|ChangeType.DocLoad),o.initFromGDrive(s),l=!0,i.default.vmMain.addModifiedItem(o,ChangeType.Remote|ChangeType.Structure|ChangeType.DocLoad)):i.default.reportError(new Error("Local model does not exist for local item that was not deleted."));else{try{i.default.PAssert(2498,!o,"The local model should never exist if there is no corresponding item entry")}catch(e){i.default.reportError(e)}o=r.a.createVMLI({data:s,isArchived:e},{parent:this,changeType:ChangeType.Remote|ChangeType.DocLoad}),d.splice(a,0,o),l=!0,i.default.vmMain.addModifiedItem(o,ChangeType.AllRemote|ChangeType.DocLoad)}}else try{i.default.PAssert(2496,s,"Item in remote list does not exist")}catch(e){i.default.reportError(e)}if(r.a.hasLocalData){for(a=0;a<d.length;a++)if(o=d[a],n.a.loadSeen[o.id]!==this.id)if(s=o.data){if(o.modifiedOffline&&o.isLocalVersionNewer(VersionType.Structure)){if(m=n.a.findInTree(s))n.a.itemMoved({item:o,newInfo:{index:a,isArchived:e},oldParent:m.parent,oldInfo:m});else{var u=n.a.getDeletedCacheItem(s.id);if(u){try{i.default.PAssert(2509,!n.a.getItemParent(u),"Deleted items should never have parents")}catch(e){i.default.reportError(e)}n.a.restoreDeletedItem(s.id),n.a.itemAdded({item:this,addedItem:s,index:a,isArchived:e})}}o.initFromGDrive(s)}}else if(o.modifiedOfflineText){var h,f=[];if(e?o.hasArchivedChildren()&&(h=o.archivedItems(!0)):h=o.getItems(),h)for(var p=0;p<h.length;++p)if(h[p].data&&h[p].isLocalVersionNewer(VersionType.Structure)){var m=n.a.findInTree(h[p].data);try{i.default.PAssert(2504,m,"Item should be found in tree")}catch(e){i.default.reportError(e)}m&&f.push({parent:m.parent,child:h[p]})}for(r.a.initializeItem(o),n.a.itemAdded({item:this,addedItem:o,index:a,isArchived:e}),p=0;p<f.length;++p){var g=f[p];try{i.default.PAssert(2505,g,"Must have valid data to remove")}catch(e){i.default.reportError(e)}var v=g.child.isArchived(),y=n.a.getItemList(g.parent,v);try{i.default.PAssert(2506,y,"The item has children, it must have a list")}catch(e){i.default.reportError(e)}var S=y.indexOf(g.child.data);try{i.default.PAssert(2507,S>=0,"Remote item must be in the parents list")}catch(e){i.default.reportError(e)}n.a.itemRemoved({item:g.parent,index:S,numToRemove:1,isArchived:v})}o.initFromGDrive(o.data)}else{try{i.default.PAssert(2508,r.a.getItem(o.id),"Trying to delete an item locally that doesn't exist locally")}catch(e){i.default.reportError(e)}this.deleteChild(o,void 0,void 0,ChangeType.Remote|ChangeType.DocLoad),a--,l=!0,i.default.vmMain.addModifiedItem(o,ChangeType.Remote|ChangeType.Structure|ChangeType.DocLoad)}if(!e&&c&&(c.length>0||d.length>0)){var E,P=[],b=[],C=c.asArray(),D=!1;for(a=0;a<C.length;++a){var I=C[a].id;if(!I)try{i.default.PAssert(2510,I,"Item in list without an ID defined: "+JSON.stringify(C[a]))}catch(e){i.default.reportError(e)}var A=r.a.getModel(I);try{i.default.PAssert(2511,A,"If the remote ID exists the local item should have been created.")}catch(e){i.default.reportError(e)}var M=this.getIndexOf(I);A&&A.modifiedOffline&&A.isLocalVersionNewer(VersionType.Structure)?M>=0?P.push(M):(E||(E=[]),log(this.id+": Item in remote array not found in local array: ",I),E.push(I)):M>=0?(b.push(I),M!==a&&(D=!0)):(E||(E=[]),log(this.id+": Item in remote array not found in local array: ",I),E.push(I))}if(D||P.length>0){for(P.sort(i.default.numberComparator),a=0;a<P.length;a++){var _;(_=d[P[a]])&&b.splice(P[a],0,_.id)}for(E&&E.length>0&&(b=b.concat(E)),a=0;a<b.length;++a){var T=b[a];for(p=a;p<c.length;++p)if(T===(L=c.get(p)).id){if(a!==p){var w=r.a.getModel(L.id),k={index:p,isArchived:!1},x={index:a,isArchived:!1};n.a.itemMoved({item:w,newInfo:x,oldParent:this,oldInfo:k}),l=!0,i.default.vmMain.addModifiedItem(w,ChangeType.Remote|ChangeType.Structure)}break}}for(a=0;a<b.length;++a)for(T=b[a],p=a;p<d.length;++p){var L;if(T===(L=d[p]).id){a!==p&&(L.moveTo({parent:this,index:a,shouldBeArchived:!1},ChangeType.Remote),l=!0,i.default.vmMain.addModifiedItem(L,ChangeType.Remote|ChangeType.Structure));break}}}}}l&&(e?this.hasArchivedChildren()&&this.archivedItems().notify():this.getItemStore().updateItems(this),e&&!this.hasArchivedChildren()&&this.archivedItems().set(d),t&&(t.items=this.getItemsArrayForSave(),t.version=this.getRemoteVersion(VersionType.Structure)))},resolveItems:function(e){try{i.default.PAssert(2517,!this.isNote(),"Should never resolve items on a note")}catch(e){i.default.reportError(e)}this.resolveItemsHelper(!1,e),this.resolveItemsHelper(!0,e),this.resolveNote(e)},isMoveEvent:function(e){var t=!1;return e.type===gapi.drive.realtime.EventType.VALUES_ADDED?t=void 0!==e.movedFromList&&null!==e.movedFromList:e.type===gapi.drive.realtime.EventType.VALUES_REMOVED&&(t=void 0!==e.movedToList&&null!==e.movedToList),t},isLocalEvent:function(e){var t=e.isLocal;if(s.a.undoRedoActive)try{i.default.PAssert(2518,t,"Must be a local event during undo/redo")}catch(e){i.default.reportError(e)}return t},onValueChanged:function(e){if(!e.isLocal||s.a.undoRedoActive){var t=i.default.translateFieldOut(e.property);if(this.id===e.target.id){var a=this.changeTypeFromEvent(e)|ChangeType.Property,r=!1;switch(t){case"version":case"versionText":var l="_"+t,d=n.a.get(this.data,t);if(d>this[l]||void 0===this[l]){var c={};"version"===t?c.modifiedOffline=!1:"versionText"===t&&(c.modifiedOfflineText=!1),c[t]=this[l]=d,this.save(c,SaveFlag.None)}break;case"priority":this.priority(e.newValue,a);break;case"isComplete":this.isComplete(e.newValue,a);break;case"isStarred":this.isStarred(e.newValue,a);break;case"dateCompleted":this.dateCompleted=e.newValue?new Date(e.newValue):null,this.save({dateCompleted:e.newValue},SaveFlag.None),r=!0;break;case"isArchived":this.isArchived(e.newValue,a),this.save({isArchived:e.newValue},SaveFlag.None);break;case"dateFormat":this.setDateFormat(e.newValue),this.save({dateFormat:e.newValue},SaveFlag.None);break;case"date":this.date(e.newValue?new Date(e.newValue):null,a),this.save({date:e.newValue},SaveFlag.None);break;case"repeatDate":var u=e.newValue?new o.a(e.newValue):null;!u||u.isValid()?(this.setRepeatDate(u,a),this.save({repeatDate:e.newValue},SaveFlag.None)):i.default.reportError(new Error("Remote invalid repeat date: "+e.newValue));break;case"allDayDate":break;case"note":e.newValue?this.addRemoteNote(e.newValue,a):this.hasNote()&&this.removeRemoteNote(a);break;case"items":case"archivedItems":var h=!("items"===t);if(e.newValue)for(var f=0;f<e.newValue.length;++f){var p=e.newValue.get(f);this.addRemoteItem(p,f,h,a)}else{try{i.default.PAssert(2520,0===e.oldValue.length,"Expected no items in list")}catch(e){i.default.reportError(e)}this.removeAllRemoteItems(h)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None);break;case"dateCreated":break;case"text":this.onTextChanged(e);break;default:ShouldLog(LogLevels.Error)&&log("Unhandled value changed remotely: ",t,e)}r&&this.parseText(!0,a)}}},onTextChanged:function(e){if(!e.isLocal||s.a.undoRedoActive){var t=this.changeTypeFromEvent(e)|ChangeType.Text,a=n.a.get(this.data,"text");if(a!==this.getRawText()&&(this.setText(a,!0,t),s.a.undoRedoActive)){var r=TrackerType.SetText;s.a.notifyStateChangedFromUndoRedo(r,{itemID:this.id,position:i.default.findFirstDiff(e.newValue,e.oldValue,!1,!0),text:e.newValue})}}},addRemoteItem:function(e,t,a,i){n.a.cacheItem(e);var o=e.id,l=a?this.archivedItems():this.items,d=l.get();if(t<d.length&&d[t].id===o)log("Skipping addRemoteItem - "+t+" vs. "+d.length);else{var c=r.a.getModel(o);c||(c=r.a.createVMLI({data:e},{parent:this,changeType:i})),n.a.setItemParent(e,this.data),c.isDeleted()&&(c.isDeleted(!1,i),c.save(null,SaveFlag.None)),c.isArchived()!==a&&(c.isArchived(a,ChangeType.Remote),c.save({isArchived:a},SaveFlag.None)),c.parent(this),l.splice(t,0,c),s.a.undoRedoActive&&s.a.notifyStateChangedFromUndoRedo(TrackerType.Create,{itemID:c.id,parent:this.id,position:t,text:n.a.get(e,"text")})}},removeAllRemoteItems:function(e){var t;if(e?this.hasArchivedChildren()&&(t=this.archivedItems()).set([]):(t=this.items).set([]),t)for(var a=0;a<t.get().length;++a)n.a.setItemParent(t.get()[a],void 0)},removeRemoteItem:function(e,t,a,o,l){var d;if(a){try{i.default.PAssert(2521,this.hasArchivedChildren(),"Must have a valid item list to remove from")}catch(e){i.default.reportError(e)}d=this.archivedItems()}else d=this.items;var c=d.get()[t];if(c&&c.id===e.id){try{i.default.PAssert(2522,c,"Expect a valid local item to remove")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2523,e.id===c.id,"Remote item should match local items")}catch(e){i.default.reportError(e)}if(o&&(n.a.setItemParent(e,void 0),n.a.removeItemFromCache(e.id)),s.a.undoRedoActive){var u=i.default.getPreviousItem(c);s.a.notifyStateChangedFromUndoRedo(TrackerType.Delete,{itemID:c.id,parent:this.id,position:t,previous:u?u.id:void 0})}d.splice(t,1),o&&r.a.deleteItem(c,l)}},addRemoteNote:function(e,t){try{i.default.PAssert(2524,!this.hasNote(),"State of note should always match when adding")}catch(e){i.default.reportError(e)}var a=e.id;n.a.cacheItem(e);var s=r.a.getModel(a);s||(s=r.a.createVMLI({data:e,isNote:!0},{parent:this,changeType:t}));try{i.default.PAssert(2525,s.isNote(),"Must always be a valid note")}catch(e){i.default.reportError(e)}s.parent(this),s.isDeleted()&&(s.isDeleted(!1,t),s.save(null,SaveFlag.None)),this.setNote(s,t)},removeRemoteNote:function(e){try{i.default.PAssert(2526,this.hasNote(),"State of note should always match when removing")}catch(e){i.default.reportError(e)}var t=this.getNote();this.setNote(void 0,e),t.isDeleted()||r.a.deleteItem(t,e)},onListAdded:function(e){if(!e.isLocal||s.a.undoRedoActive){n.a.numChanges++;var t=this.changeTypeFromEvent(e),a=!1,r=!0,o=n.a.get(this.data,"items");if(o&&e.target.id===o.id)r=e.target.id===o.id;else{var l=n.a.get(this.data,"archivedItems");l&&e.target.id===l.id&&(a=!0),r=l&&e.target.id===l.id}if(r){var d,c,u;e.values.length>0?(u=(c=e.index)+e.values.length,d=function(t){return e.values[t]}):(c=0,u=e.target.length,d=function(t){return e.target.get(t)}),this.isMoveEvent(e);for(var h=c;h<u;++h){var f=d(h-c);try{i.default.PAssert(2529,f,"Always expect a valid item at each index")}catch(e){i.default.reportError(e)}this.addRemoteItem(f,h,a,t)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None),this._selectionBeforeBlur=void 0}else log("Skipping list add due to invalid target")}},onListRemoved:function(e){if(!e.isLocal||s.a.undoRedoActive){var t=this.changeTypeFromEvent(e);n.a.numChanges++;var a=!1,r=!0,o=n.a.get(this.data,"items");if(o&&e.target.id===o.id)r=e.target.id===o.id;else{var l=n.a.get(this.data,"archivedItems");l&&e.target.id===l.id&&(a=!0),r=l&&e.target.id===l.id}if(r){for(var d=e.index,c=d+e.values.length,u=this.isMoveEvent(e),h=c-1;h>=d;h--){var f=h-d;try{i.default.PAssert(2535,!!e.values[f],"Always expect a valid item at each index")}catch(e){i.default.reportError(e)}var p=e.values[f];this.removeRemoteItem(p,h,a,!u,t)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None),this._selectionBeforeBlur=void 0}else log("Skipping list remove due to invalid target")}},onListSet:function(e){try{i.default.PAssert(2536,!1,"What? This shouldn't happen!",e)}catch(e){i.default.reportError(e)}},onObjectChanged:function(e){if(e.ocHandled)return ShouldLog(LogLevels.Warning|LogLevels.Verbose)&&log("Event Already Handled: ",e.ocHandled,"-",this.id,e.events[0].type),!1;var t;if(n.a.numChanges++,e.ocHandled=this.id,e.stopPropagation(),e.isLocal&&!s.a.undoRedoActive)return!1;n.a.lastChangeTime.set(Date.now()),s.a.undoRedoActive||(t=l.a.save(),l.a.reset()),i.default.vmMain.beginUpdateItems();for(var a=0;a<e.events.length;++a){var r=e.events[a];if(r.ocHandled)log("Sub-Event Already Handled: ",r.ocHandled,"-",this.id,r.type);else{r.ocHandled=this.id;try{switch(r.type){case gapi.drive.realtime.EventType.TEXT_DELETED:case gapi.drive.realtime.EventType.TEXT_INSERTED:this.onTextChanged(r);break;case gapi.drive.realtime.EventType.VALUES_ADDED:this.onListAdded(r);break;case gapi.drive.realtime.EventType.VALUES_REMOVED:this.onListRemoved(r);break;case gapi.drive.realtime.EventType.VALUE_CHANGED:this.onValueChanged(r);break;case gapi.drive.realtime.EventType.VALUES_SET:try{i.default.PAssert(2537,!1,"VALUES_SET should never be triggered")}catch(e){i.default.reportError(e)}break;default:try{i.default.PAssert(2538,!1,"Unexpected event type")}catch(e){i.default.reportError(e)}}}catch(e){i.default.reportError(e)}}}return i.default.vmMain.commitUpdateItems(),t&&l.a.restore(t),!1}}}},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(14),s=a(19);function o(){this._items=new s.a,this._remoteItems=void 0,this._localLoaded=!1,this._cache=i.default.vmMain.cacheManager.registerLocalCache("QuickAdd","QuickAdd",StorageType.IndexedDB),this._itemStore=i.default.vmMain.itemStoreManager.registerItemStore("QuickAdd",this,{isReadonly:!0}),this._itemStore.createRoot("QuickAddRoot","Quick Add"),this._cache.onCacheReady(function(){this._cache.loadAll(function(e,t){e&&this._notifyLocalItems(t)}.bind(this))}.bind(this))}o.prototype={notifyRemoteItems:function(e){i.default.settings.set(Settings.lastQuickAddSync,new Date),this._localLoaded?(this._remoteItems=void 0,this._cache.onCacheReady(function(){i.default.vmMain.beginUpdateItems();for(var t=0;t<e.length;++t){var a=e[t];if(a.dateConsumed)!!this.removeTextEntry(a.quickAddID)&&this._cache.removeEntry(a.quickAddID);else this.addTextEntry(a.quickAddID,a.text,a.note)&&this._cache.cacheEntry(a.quickAddID,{id:a.quickAddID,isPersisted:!0,text:a.text,note:a.note})}i.default.vmMain.commitUpdateItems()}.bind(this))):this._remoteItems=e},_notifyLocalItems:function(e){i.default.vmMain.beginUpdateItems();for(var t=0;e&&t<e.length;++t){var a=e[t];this.addTextEntry(a.id,a.text,a.note),a.isPersisted||this.persistTextEntry(a.id,!0)}this._localLoaded=!0,this._remoteItems&&this.notifyRemoteItems(this._remoteItems),i.default.vmMain.commitUpdateItems()},runQuickAddSync:function(e){i.default.XHR_PrivateAPI({type:"POST",path:"/quick/list",data:{lastQuickAddSync:this.getLastSyncDate()},requireAuth:!0,cb:function(t){if(t.status===r.a.HTTPStatusCode.Success)try{var a=JSON.parse(t.response).data;if(a.quickAddItems){try{i.default.PAssert(1363,i.default.isArray(a.quickAddItems),"Must be an array of items")}catch(e){i.default.reportError(e)}this.notifyRemoteItems(a.quickAddItems)}}catch(e){i.default.reportError(e)}e&&e()}.bind(this)})},getLastSyncDate:function(){var e=i.default.settings.get(Settings.lastQuickAddSync);try{i.default.PAssert(1364,!e||i.default.isString(e),"Must have a valid string sync date")}catch(e){i.default.reportError(e)}return e},addItemEntry:function(e,t){this.hasItemEntry(e)||this._items.push({id:e.id,item:e,pane:t})},addTextEntry:function(e,t,a){var i=!1;if(!this.hasTextEntry(e)){var r=this._itemStore.getRoot(),n=this._itemStore.createItem(e,t,r.id,ChangeType.Local);r.insertItem(n,0),this._items.push({id:e,isText:!0,item:n,text:t,note:a}),i=!0}return i},removeItemEntry:function(e){var t=this._items.indexOfWithProperty("id",e.id);if(t>=0)return this._items.splice(t,1)[0]},removeTextEntry:function(e){var t=this._items.indexOfWithProperty("id",e);if(t>=0)return this._items.splice(t,1)[0]},hasItemEntry:function(e){var t=this.getItemEntry(e);return!(!t||t.isText)},hasTextEntry:function(e){var t=this.getTextEntry(e);return!(!t||!t.isText)},getItemEntry:function(e){var t=this._items.indexOfWithProperty("id",e.id);return this._items.get()[t]},getTextEntry:function(e){var t=this._items.indexOfWithProperty("id",e);return this._items.get()[t]},getItems:function(){return this._items},_notifyPersisted:function(e){var t=this.getTextEntry(e);t&&this._cache.onCacheReady(function(){this._cache.cacheEntry(e,{id:e,text:t.text,note:t.note,isPersisted:!0})}.bind(this))},_notifyConsumed:function(e){this._cache.onCacheReady(function(){this._cache.removeEntry(e)}.bind(this))},persistTextEntry:function(e,t){n.a.onUserAuthorized("me",function(){this._persistTextEntry(e,t)}.bind(this))},_persistTextEntry:function(e,t){try{i.default.PAssert(1365,this.hasTextEntry(e),"Must be persisting a valid text entry")}catch(e){i.default.reportError(e)}var a=this.getTextEntry(e);if(a){t||this._cache.onCacheReady(function(){this._cache.cacheEntry(e,{id:e,text:a.text,note:a.note,isPersisted:!1})}.bind(this));var n={quickAddID:e,text:a.text};a.note&&(n.note=a.note),i.default.XHR_PrivateAPI({type:"POST",path:"/quick/add",data:n,requireAuth:!0,cb:function(t){if(t.status===r.a.HTTPStatusCode.Success)this._notifyPersisted(e);else if(t.status===r.a.HTTPStatusCode.BadRequest)try{JSON.parse(t.responseText).code===PrivateAPIErrorCodes.AlreadyExists&&this._notifyPersisted(e)}catch(e){i.default.reportError(e)}}.bind(this)})}},consumeTextEntry:function(e){try{i.default.PAssert(1366,this.hasTextEntry(e),"Must be persisting a valid text entry")}catch(e){i.default.reportError(e)}this.removeTextEntry(e),this._cache.onCacheReady(function(){this._cache.removeEntry(e)}.bind(this));var t={quickAddID:e};i.default.XHR_PrivateAPI({type:"POST",path:"/quick/consume",data:t,requireAuth:!0,cb:function(t){t.status===r.a.HTTPStatusCode.Success&&this._notifyConsumed(e)}.bind(this)})},hasItems:function(){return this._items.get().length>0}},t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(4),n=a(5),s=a(26),o=a(9);function l(){this.notificationItems={},this.numNotificationItemsChanged=0,this.scheduledItems={},this.notifiedItems={},this.scheduleTimeout=void 0,this.oldSoftDates=["now","next","soon","later","someday"],this.agendaSort=new o.a(i.default.settings.get(Settings.agendaSort)||this.createDefaultAgendaSort()),n.a.forceBind("showHTML5Notification",this),n.a.forceBind("setupNotifications",this)}window.__FULL_NOTIFICATION_UPDATES=0,window.__SINGLE_NOTIFICATION_UPDATES=0,l.prototype={clearDailyCaches:function(){},addNotification:function(e){try{i.default.PAssert(714,e,"Must provide a valid item to schedule notifications for")}catch(e){i.default.reportError(e)}this.notificationItems[e.id]=e,this.numNotificationItemsChanged++,this.scheduleTimeout||(this.scheduleTimeout=setTimeout(this.setupNotifications,500))},removeNotification:function(e){try{i.default.PAssert(715,e,"Must provide a valid item to unschedule notifications for")}catch(e){i.default.reportError(e)}this.notificationItems[e.id]&&(this.notificationItems[e.id]=void 0,this.numNotificationItemsChanged++,this.scheduleTimeout||(this.scheduleTimeout=setTimeout(this.setupNotifications,500)))},clearNotifications:function(){for(var e in this.notificationItems)this.notificationItems.hasOwnProperty(e)&&(this.notificationItems[e]=void 0,this.numNotificationItemsChanged++);this.scheduleTimeout||(this.scheduleTimeout=setTimeout(this.setupNotifications.bind(this),500))},shouldNotify:function(e,t){t||(t=new Date);var a=e.date();return!i.default.isDateSoft(e.getDateText())&&!e.isDestroyed()&&!e.isDeleted()&&!e.isComplete()&&!e.hasCompletedAncestor()&&!e.allDayDate()&&!e.isArchived()&&(a&&a>t&&a-Date.now()<864e5||e.repeatDate())},updateNotifications:function(e){if(r.a.supportsNotifications()&&s.a.isNotificationsEnabled()&&!i.default.isDemoMode()){0;var t=new Date;e?(window.__SINGLE_NOTIFICATION_UPDATES++,this.shouldNotify(e,t)?this.addNotification(e):this.removeNotification(e)):(window.__FULL_NOTIFICATION_UPDATES++,this.clearNotifications(),i.default.searchVMLIs({item:i.default.vmMain.root(),includeArchived:!1,each:function(e){this.shouldNotify(e,t)&&this.addNotification(e)}.bind(this)}))}},setupNotifications:function(){try{i.default.PAssert(716,r.a.supportsNotifications(),"Platform must support notifications")}catch(e){i.default.reportError(e)}var e=[];for(var t in this.notificationItems)if(this.notificationItems.hasOwnProperty(t)){var a=this.notificationItems[t];if(a&&a.getNotificationEntries){var n=a.getNotificationEntries();if(n)if(i.default.isArray(n))for(var s=0;s<n.length;++s)e.push(n[s]);else e.push(n)}else delete this.notificationItems[t]}if(r.a.usesHTML5Notifications()){var o=new Date;for(var l in this.scheduledItems)if(this.scheduledItems.hasOwnProperty(l)){var d=!1;for(s=0;s<e.length;++s)if(e[s].id===l){d=!0;break}d||this.cancelHTML5Notification(l)}var c=o.clone().addDays(2);for(s=0;s<e.length;++s){var u=e[s],h=(new Date(u.alertDate),new Date(u.date));this.notifiedItems[u.id]||this.scheduledItems[u.id]&&this.scheduledItems[u.id].timestamp===h.getTime()||h.isAfter(o)&&h.isBefore(c)&&this.scheduleHTML5Notification(u)}0}else i.default.nativeBridge.isEnabled()?i.default.nativeBridge.sendToApp("scheduledItems",e):i.default.nativeBridge.hasEmbedBridge()&&i.default.nativeBridge.sendToEmbed("scheduledItems",e);this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0},scheduleHTML5Notification:function(e){var t=new Date(e.alertDate),a=new Date(e.date),r=Math.max(t.getTime()-Date.now(),0),n=a.getTime()-Date.now();try{i.default.PAssert(717,n>=0,"Should always schedule notifications in the future")}catch(e){i.default.reportError(e)}this.cancelHTML5Notification(e.id),e.timeout=setTimeout(this.showHTML5Notification.bind(this,e),r),this.scheduledItems[e.id]=e},cancelHTML5Notification:function(e){var t=this.scheduledItems[e];t&&t.timeout&&(clearTimeout(t.timeout),t.timeout=void 0)},showHTML5Notification:function(e){try{i.default.PAssert(718,r.a.supportsHTML5Notifications(),"Must support HTML5 notifications to display them")}catch(e){i.default.reportError(e)}var t=new Date(e.alertDate),a=new Date(e.date);if(a.isAfter(new Date)){try{i.default.PAssert(719,t.isBefore(a),"Alert must always be before actual event")}catch(e){i.default.reportError(e)}var n=Math.round((a.getTime()-Date.now())/6e4);new Notification(e.text,{body:"in "+n+" minutes",icon:"/img/favicon-96x96.png"});0}else 0;this.notifiedItems[e.id]=!0},createDefaultAgendaSort:function(){return{overdue:-2,"#now":-1,starred:1,important:2,"#next":3,"#soon":101,"#later":301,"#someday":1401}},getDateForKey:function(e){return this.oldSoftDates.indexOf(e)>=0&&(e="#"+e),this.agendaSort.get()[e]},saveAgendaSort:function(e){this.agendaSort.set(e),i.default.settings.set(Settings.agendaSort,e),i.default.vmMain.paneManager.runForEachPane(function(e){e.isViewAgenda()&&e.setItemsDirty()}),i.default.vmMain.updateAllItems()}},t.a=l},function(e,t,a){"use strict";var i=a(1),r=a(0),n=a(4),s=a(18),o=a(8),l=a(9),d=a(19),c=a(11),u=i.a.TooltipDelay;function h(){this.tooltip=new l.a,this.tooltipsSticky=new d.a,this.displayElement=void 0,this.isSticky=!1,this.displayTimeout=void 0,this.init()}h.prototype={init:function(){n.a.touch||(c.a.listen("mouseover",this.handleEleOver.bind(this)),c.a.listen("mouseout",this.handleEleOut.bind(this)),window.addEventListener("mouseout",this.windowOut.bind(this)),document.addEventListener("mousedown",this.hideTip.bind(this),!0))},windowOut:function(e){(e.pageX>=n.a.windowWidth()||e.pageY>=n.a.windowHeight()||e.pageX<=0||e.pageY<=0)&&this.hideTip()},register:function(e,t){this.update(e,t)},update:function(e,t){e.setAttribute("tooltip",t)},displayTip:function(e){try{r.default.PAssert(814,e,"When display a tooltip, must pass in some info")}catch(e){r.default.reportError(e)}clearTimeout(this.displayTimeout),this.displayTimeout=void 0;var t=this.displayElement=e.element;if(e&&t&&t.offsetWidth>0&&t.offsetHeight>0){var a=e.text;this.isSticky=e.sticky;try{r.default.PAssert(815,a,"When display a tooltip, elements should always have valid data set")}catch(e){r.default.reportError(e)}if(a){var i={text:a,hotkey:e.hotkey,element:t,blue:e.blue,sticky:e.sticky,maxWidth:e.maxWidth,onRight:e.onRight,arrowClass:e.arrowDirection||"hidden"};e.sticky?this.tooltipsSticky.push(i):this.tooltip.set(i)}}},tipOut:function(e){var t=!0;e.target&&(t=r.default.isAttachedToDoc(e.target)&&!r.default.findParent(e.target,"tooltip")),t&&this.hideTip()},getAttr:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltip")||e.getAttribute("data-tooltip"))},getAttrHotkey:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltipHotkey")||e.getAttribute("data-tooltiphotkey"))},handleEleOver:function(e){try{r.default.PAssert(816,r.default.isDOMNode(e.target),"Must have a valid DOM node: ",typeof e.target)}catch(e){r.default.reportError(e)}var t,a,i;if(e.target&&((t=this.getAttr(e.target))?i=e.target:(t=this.getAttr(e.target.parentElement))&&(i=e.target.parentElement),a=this.getAttrHotkey(i),t&&this.displayElement!==i&&!s.a.isDragging&&!o.a.isMouseDown())){clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),u,{element:i,offset:{y:5},text:t,hotkey:a})}},handleEleOut:function(e){this.tipOut(e)},isOpenSticky:function(){return this.tooltipsSticky.get().length>0},hideSticky:function(e){for(var t=this.tooltipsSticky.get(),a=0;a<t.length;a++)if(t[a].text===e){this.tooltipsSticky.removeAt(a);break}},hideTip:function(){this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,this.tooltip.set(void 0)}},t.a=h},function(e,t,a){"use strict";var i=a(0),r=a(5),n=a(4);function s(){this.useServiceWorker="serviceWorker"in navigator,this.updateWaitTime=i.default.minutes(120),this.notifiedOfNew=!1,this.isFinished=!1,this.downloadingTimeout=0,this.lastUpdate=0,this.startStatus=window.applicationCache?window.applicationCache.status:-2,this.continuedUpdate=!1,this.updateActionDone=!1,this.fnToRun=[],this.requiredUpdate=!1,this.appUpdatePending=!1,this.runUpdate=!1,this.init()}s.prototype={init:function(){this.startStatus===window.applicationCache.OBSOLETE&&this.onCacheObsolete(),this.useServiceWorker?(navigator.serviceWorker.addEventListener("message",function(e){"ServiceWorker_Activated"===e.data?this.onUpdateReady():"ServiceWorker_Installed"===e.data&&setTimeout(this.onUpdateReady.bind(this),2e3)}.bind(this)),r.a.hasURLParam("swupdate")&&setTimeout(function(){r.a.hasURLParam("swupdate")&&r.a.removeURLParam("swupdate",!0)},2e3)):log("Cache Status: "+this.startStatus),window.applicationCache?(window.applicationCache.addEventListener("noupdate",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("cached",this.onFirstUpdateReady.bind(this)),window.applicationCache.addEventListener("downloading",this.onUpdateDownloading.bind(this)),window.applicationCache.addEventListener("updateready",this.onUpdateReady.bind(this)),window.applicationCache.addEventListener("obsolete",this.onCacheObsolete.bind(this)),window.applicationCache.addEventListener("error",this.onUpdateError.bind(this)),window.applicationCache.status>=window.applicationCache.UPDATEREADY||document.documentElement.attributes.getNamedItem("manifest")||this.onCacheLoadFinished()):this.onCacheLoadFinished()},update:function(){if(Date.now()-this.lastUpdate>this.updateWaitTime){this.lastUpdate=Date.now();try{this.useServiceWorker?window.__registeredServiceWorker&&window.__registeredServiceWorker.update():window.applicationCache&&window.applicationCache.status===window.applicationCache.IDLE&&window.applicationCache.update()}catch(e){}}},checkForUpdate:function(e,t){this.requiredUpdate=!!e,this.runUpdate=!!t,this.appUpdatePending?this.appUpdatePending&&this.runUpdate&&i.default.reload(!this.useServiceWorker):this.update()},endRunUpdate:function(){this.runUpdate=!1},runOnFinish:function(e){try{i.default.PAssert(835,0===this.fnToRun.length,"Only a single callback is allowed to be run at this point.")}catch(e){i.default.reportError(e)}this.isFinished?setTimeout(e,0):this.fnToRun.push(e)},onUpdateReady:function(){this.appUpdatePending||(log("Cache: New version available"),this.appUpdatePending=!0,r.a.hasURLParam("swupdate")||r.a.insertURLParam("swupdate",!0,!0),this.useServiceWorker?log("Service worker has update"):window.applicationCache&&this.startStatus===window.applicationCache.UNCACHED&&log("Cache Update from UNCACHED state. ERROR."),this.onCacheLoadFinished(),this.updateAction())},onFirstUpdateReady:function(){log("Cache: first update")},onUpdateError:function(e){n.a.demo||i.default.vmMain&&!i.default.vmMain.isOnline()||(log("Update Error: ",e),"quota"===e.reason&&i.default.toasts.pushMessage({text:"A new version of Moo.do is available but you do not have enough free disk space to update. You may want to clear up some disk space.",actionText:"OKAY"})),this.onCacheLoadFinished()},onUpdateDownloading:function(){log("Cache: New version downloading")},onCacheObsolete:function(){this.onUpdateReady()},onCacheLoadFinished:function(){if(!this.isFinished){this.isFinished=!0;for(var e=0;e<this.fnToRun.length;++e)this.fnToRun[e]()}},notifyOfUpdate:function(){this.notifiedOfNew||(this.notifiedOfNew=!0,i.default.setAppCacheUpdateState(!0))},updateAction:function(){this.runUpdate||!n.a.isPageVisible()?i.default.reload(!this.useServiceWorker):this.requiredUpdate&&i.default.menus.alert({text:"A software update is required to continue. Please reload to update.",actionText:"RELOAD",callback:i.default.reload}),i.default.sendEvent("AppCache","Update")}},t.a=s},function(e,t,a){"use strict";var i=a(0),r=a(4),n=a(1),s=a(10),o=a(15),l=a(17),d=a(44),c=a(165),u=a(166),h=a(11),f=(a(36),a(31)),p=a(25),m=a(8);function g(){if(r.a.app)try{this.backlog=[],this._iOS7Queue=[],this._iOS7QueueTimeout=void 0,this.flushingBacklog=!1,this.isPokingBackground=!1,this.setupFns=[],this.setupFns[AppPlatform.iOS]=this.setupiOS.bind(this),this.setupFns[AppPlatform.Android]=this.setupAndroid.bind(this),this.setupFns[AppPlatform.WinPhone]=void 0,this.setupFns[AppPlatform.Chrome]=this.setupChrome.bind(this),this.setupFns[AppPlatform.Electron]=this.setupElectron.bind(this),this.sendFns=[],this.sendFns[AppPlatform.iOS]=this.sendToAppiOS.bind(this),this.sendFns[AppPlatform.Android]=this.sendToAppAndroid.bind(this),this.sendFns[AppPlatform.WinPhone]=void 0,this.sendFns[AppPlatform.Chrome]=this.sendToAppChrome.bind(this),this.sendFns[AppPlatform.Electron]=this.sendToAppElectron.bind(this),this.setupFn=this.setupFns[r.a.appPlatform],this.sendFn=this.sendFns[r.a.appPlatform],this.init(),this._isEnabled=!0}catch(e){log("Native API Bridge Disabled"),i.default.reportError(e)}else this._isEnabled=!1;if(this._embedBridge=void 0,r.a.app||r.a.embed){try{i.default.PAssert(836,void 0===window.__MoodoBridge,"Must not have a previous bridge in place")}catch(e){i.default.reportError(e)}window.__MoodoBridge={},this._canRegisterAPIs=!0,this._inboundAPIs={},this._outboundAPIs={}}}g.prototype={init:function(){try{i.default.PAssert(837,this.setupFn,"Must have a valid setup function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(838,this.sendFn,"Must have a valid send function")}catch(e){i.default.reportError(e)}this.setupFn&&this.sendFn&&(this.initAppEvents(),this.setupFn(),this.backlog=i.default.nativeBacklog,this.flushBacklog(),r.a.isFeatureEnabled(n.a.Feature.OAuth)&&o.a.addOAuthMethod(OAuthSchemeType.Native),window.__testNative=function(e,t){log("Sending To App: "+e),this.nativeBridge.sendToApp(e,t)}.bind(this))},isEnabled:function(){return this._isEnabled},flushBacklog:function(){this.flushingBacklog=!0;for(var e=0;e<this.backlog.length;++e){var t=this.backlog[e];this.sendToApp(t.method,t.data)}this.flushingBacklog=!1},addToBacklog:function(e,t){try{i.default.PAssert(839,!this.flushingBacklog,"Should never be adding to backload while flushing it")}catch(e){i.default.reportError(e)}this.flushingBacklog||this.backlog.push({method:e,data:t})},registerEmbedBridge:function(e){try{i.default.PAssert(840,e,"Must supply a valid embed bridge")}catch(e){i.default.reportError(e)}try{i.default.PAssert(841,r.a.embed,"Must be embedded")}catch(e){i.default.reportError(e)}this._embedBridge=e},hasEmbedBridge:function(){return!!this._embedBridge},sendToEmbed:function(e,t){try{i.default.PAssert(842,this.hasEmbedBridge(),"Must have a valid embed bridge to send message: ",e)}catch(e){i.default.reportError(e)}this._embedBridge.handleEmbedMessage(e,t)},registerInboundAPI:function(e){try{i.default.PAssert(843,!this._inboundAPIs[e],"Should not have already registered an outbound API with this name")}catch(e){i.default.reportError(e)}if(this._canRegisterAPIs){var t=new c.a(e);return this._inboundAPIs[e]=t,t}},registerOutboundAPI:function(e){try{i.default.PAssert(844,!this._outboundAPIs[e],"Should not have already registered an outbound API with this name")}catch(e){i.default.reportError(e)}if(this._canRegisterAPIs){var t=new u.a(e);return this._outboundAPIs[e]=t,t}},initAppEvents:function(){window.appEvents=this.appEvents,window.reportLowMemory=this.appEvents.reportLowMemory,window._SENDJSMESSAGE_=this.handleNativeMessage},setupChrome:function(){window.addEventListener("message",this.onChromeMessage.bind(this))},setupAndroid:function(){},setupiOS:function(){this.setupiOSUI(),l.a.registerSaveNotify(this.onSaveChange.bind(this))},setupiOSUI:function(){this.iframeApp=document.createElement("IFRAME"),this.iframeApp.setAttribute("height","1px"),this.iframeApp.setAttribute("width","1px"),this.iframeApp.id="appComm",document.documentElement.appendChild(this.iframeApp)},setupElectron:function(){this.ipcBridge=electronRequire("electron").ipcRenderer,this.ipcBridge.on("appEvents",function(e,t){this.handleNativeMessage(t.action,t.data)}.bind(this))},onSaveChange:function(e){this.isPokingBackground&&(this.sendToApp("pokeChanged",e>0?"true":"false"),this.isPokingBakground=!1)},onChromeMessage:function(e){if(0===e.origin.indexOf("chrome"))if(this.appWindow&&this.appOrigin||(this.appWindow=event.source,this.appOrigin=event.origin,setTimeout(this.flushBacklog.bind(this),0)),e.data&&i.default.isString(e.data)){var t=e.data.indexOf(":"),a=e.data.substr(0,t),r=e.data.substr(t+1);switch(a){case"chrome":switch(log("Chrome Message: ",a,"->",r),r){case"start":this.sendToApp("loaded");break;default:log("Unhandled Chrome Message: ",r)}break;default:this.handleNativeMessage(a,r)}}else log("Invalid Chrome Message: ",e.data)},sendToApp:function(e,t){try{i.default.PAssert(845,r.a.app,"Only use native bridge when creating an app")}catch(e){i.default.reportError(e)}try{i.default.PAssert(846,this.sendFn,"Must have a valid send method for the native bridge")}catch(e){i.default.reportError(e)}var a=!1;try{var n;t&&(n=i.default.isString(t)?t:JSON.stringify(t)),this.sendFn&&(this.sendFn(e,n),a=!0)}catch(e){i.default.reportError(e)}return a},sendToAppiOS:function(e,t){r.a.ioswk?this.sendToAppiOS8(e,t):this.sendToAppiOS7(e,t)},sendToAppiOS7:function(e,t){if(this.iframeApp){var a="duchess://"+e;void 0!==t&&(a+="//"+t),this._addiOS7Queue(a)}else this.addToBacklog(e,t)},_addiOS7Queue:function(e){this._iOS7Queue.push(e),this._iOS7QueueTimeout||(this._iOS7QueueTimeout=setTimeout(this._pumpiOS7Queue.bind(this),17))},_pumpiOS7Queue:function(){var e=this._iOS7Queue.shift();try{i.default.PAssert(847,e,"Must have a valid href",e)}catch(e){i.default.reportError(e)}this.iframeApp.src=e,this._iOS7Queue.length>0?this._iOS7QueueTimeout=setTimeout(this._pumpiOS7Queue.bind(this),17):this._iOS7QueueTimeout=void 0},sendToAppiOS8:function(e,t){if(window.webkit.messageHandlers&&window.webkit.messageHandlers.MoodoEvents){var a=e;void 0!==t&&(a+="//"+t),window.webkit.messageHandlers.MoodoEvents.postMessage(a)}else this.addToBacklog(e,t)},sendToAppAndroid:function(e,t){window.AppInterface&&void 0!==window.AppInterface.sendAppMessage&&null!==window.AppInterface.sendAppMessage?window.AppInterface.sendAppMessage(e,t):this.addToBacklog(e,t)},sendToAppChrome:function(e,t){if(this.appWindow){var a=e+":";void 0!==t&&(a+=t),this.appWindow.postMessage(a,"*")}else this.addToBacklog(e,t)},sendToAppElectron:function(e,t){if(this.ipcBridge){var a=e+":";void 0!==t&&(a+=t),this.ipcBridge.send("moodo-message",a)}else this.addToBacklog(e,t)},handleNativeMessage:function(e,t){try{window.appEvents[e]?window.appEvents[e](t):e.startsWith("-")||i.default.reportError(new Error("Calling invalid JS method from native: "+e))}catch(e){i.default.reportError(e)}},appEvents:{undo:function(){log("Native Undo"),i.default.sendEvent("Hotkey","ShakeUndo"),s.a.undoAction()},redo:function(){log("Native Redo"),i.default.sendEvent("Hotkey","ShakeRedo"),s.a.redoAction()},selectAll:function(){i.default.focusedPane&&d.a.handleSelectAll(i.default.focusedPane)},kbsize:function(e){e>0&&+e!==r.a.getKBSize()&&(r.a.setKBSize(e),i.default.keyboardToolbar&&i.default.keyboardToolbar.updatePosition())},closeKeyboard:function(){0},enterBackground:function(){i.default.AppCache&&i.default.AppCache.checkForUpdate(!1,!0),i.default.vmMain.onUnload()},enterForeground:function(){l.a.poke(),i.default.checkForRemoteChanges(),i.default.AppCache&&i.default.AppCache.endRunUpdate(),h.a.fireEvent("enterForeground",[])},backButtonPressed:function(){m.a.fireKeyEvent(document.documentElement,{normCode:KeyCode.Escape})},quickAddItems:function(e){try{for(var t=e.replace(/\r/g," ").replace(/\n/g," "),a=JSON.parse(t),r=0;r<a.length;++r){var n=a[r];log("Quick Add Item: ",n),i.default.vmMain.dropBucket.addTextEntry(n.key,n.value),i.default.vmMain.dropBucket.persistTextEntry(n.key)}i.default.nativeBridge.sendToApp("quickAddConsumed",[])}catch(t){i.default.reportError(t,e)}},pokeBackground:function(){i.default.nativeBridge.isPokingBackground=!0,l.a.poke()},reportLowMemory:function(e){i.default.handleLowMemory(e)},statusBarTap:function(){i.default.focusedPane&&i.default.focusedPane.setScrollOffset(0,ScrollDuration.Default)},features:function(e){try{var t=JSON.parse(e);t.oauth&&(r.a._enableFeature(n.a.Feature.OAuth),o.a.addOAuthMethod(OAuthSchemeType.Native)),t.version&&r.a.recordAppSubVersion(t.version),!1===t.notifications&&r.a.disallowNativeNotifications()}catch(e){i.default.reportError(e)}},notifyOAuth:function(e){try{i.default.isString(e)&&(e=JSON.parse(e)),o.a.handleNativeOAuthResponse(e)}catch(e){i.default.reportError(e)}},onMenuClick:function(e){if("NewMessage"===e||"NewEmail"===e){var t=i.default.vmMain.getDefaultEmailPlugin();t.isEnabled()?i.default.menus.openComposeEmail(t):i.default.toasts.pushMessage(MessageID.NeedGmailPermission)}else"NewPane"===e?p.a.hotkeyAddPane():"NewItem"===e?p.a.hotkeyNewItem():"Preferences"===e?i.default.menus.openSettings():"DisplaySettings"===e?i.default.menus.openDisplaySettings():"ToggleSidebar"===e?f.a.toggleSidebar():i.default.reportError(new Error("Unknown Native Menu Click: "+e))},reportError:function(e){i.default.reportError(new Error("Native Error: "+e))},downloadProgress:function(e){i.default.handleNativeDownloadProgress(e)}}},t.a=g},function(e,t,a){"use strict";var i=a(0),r=a(5);function n(e){try{i.default.PAssert(1398,void 0===window.__MoodoBridge[e],"Registering an Inbound API that already exists on the window object",e)}catch(e){i.default.reportError(e)}this._name=e,this._publicObj={},this._privateObj={},window.__MoodoBridge[e]=this._publicObj,this.init()}n.prototype={init:function(){},_createWrapper:function(e){return function(){try{return e.apply(this,arguments)}catch(e){i.default.reportError(e)}}},registerFunction:function(e,t,a){try{i.default.PAssert(1399,e,"Name must be provided to register function")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1400,t,"A valid function must be provided to register")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1401,void 0===this._privateObj[e],"Re-registering an api function on private obj",e)}catch(e){i.default.reportError(e)}try{i.default.PAssert(1402,void 0===this._publicObj[e],"Re-registering an api function on public obj",e)}catch(e){i.default.reportError(e)}this._privateObj[e]=t.bind(this._privateObj),a&&(this._publicObj[e]=this._createWrapper(this._privateObj[e]))},registerVariable:function(e,t,a){try{i.default.PAssert(1403,e,"Name must be provided to register variable")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1404,!a,"Public variables are not currently supported")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1405,void 0===this._privateObj[e],"Re-registering an api variable on private obj")}catch(e){i.default.reportError(e)}try{i.default.PAssert(1406,void 0===this._publicObj[e],"Re-registering an api variable on public obj")}catch(e){i.default.reportError(e)}this._privateObj[e]=t}},r.a.defineBase(n),t.a=n},function(e,t,a){"use strict";var i=a(0),r=a(5);function n(e){this._name=e,this._apiLoaded=!1,this._apiError=!1,this._listeners=void 0,this._requiredFns=[],this._missingFns=void 0,this.init()}n.prototype={init:function(){i.default.isObject(window[this._name])?this.onAPILoaded():(r.a.forceBind("_checkAPI",this),setTimeout(this._checkAPI,1e3))},_checkAPI:function(){try{i.default.PAssert(1407,!this._apiLoaded,"Should not be checking for API load if already loaded")}catch(e){i.default.reportError(e)}i.default.isObject(window[this._name])&&this.onAPILoaded(),this._apiLoaded||setTimeout(this._checkAPI,1e3)},onAPILoaded:function(){this._apiLoaded=!0;for(var e=0;e<this._requiredFns.length;++e)i.default.isFunction(window[this._name][name])||(this._apiError=!0,this._addMissingFn(name));this.notifyListeners()},requestNotification:function(e){this._apiLoaded?setTimeout(e,0):this._listeners?this._listeners.push(e):this._listeners=[e]},notifyListeners:function(){try{i.default.PAssert(1408,this._apiLoaded,"API must be loaded to notify listeners")}catch(e){i.default.reportError(e)}if(this._listeners)for(var e=0;e<this._listeners.length;++e)this._listeners[e]();this._listeners=void 0},requireFunction:function(e,t){try{i.default.PAssert(1409,this._requiredFns.indexOf(e)<0,"Should not double require a single function")}catch(e){i.default.reportError(e)}this._requiredFns.push(e),this._apiLoaded&&(i.default.isFunction(window[this._name][e])||t||(this._apiError=!0,this._addMissingFn(e)))},_addMissingFn:function(e){if(this._missingFns){try{i.default.PAssert(1410,this._missingFns.indexOf(e)<0,"Should not be missing the same function multiple times")}catch(e){i.default.reportError(e)}this._missingFns.push(e)}else this._missingFns=[e]},hasOptionalFunction:function(e){try{i.default.PAssert(1411,this._requiredFns.indexOf(e)>=0,"Must be querying for a registered function")}catch(e){i.default.reportError(e)}return!!window[this._name]&&!!window[this._name][e]},call:function(e){try{i.default.PAssert(1412,this._apiLoaded,"Trying to call an API function before it is loaded",e)}catch(e){i.default.reportError(e)}if(this._apiLoaded){var t=Array.prototype.slice.call(arguments,1);try{return window[this._name][e].apply(window[this._name],t)}catch(e){i.default.reportError(e)}}}},r.a.defineBase(n),t.a=n},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(5),s=a(4),o=a(13),l=a(15),d=a(9),c=a(19),u=a(14),h=a(24),f=["4.95","49.95","5","49"],p=s.a.demo;function m(){this._premiumStatus=new d.a(PremiumStatus.Unknown),p&&this._premiumStatus.set(PremiumStatus.Active),this.hasPremiumFeaturesObservable=new c.a([this._premiumStatus],function(){return this.hasPremiumFeatures()}.bind(this)),this._lastSignupError=-1,this._earlyAdopter=!1,this._inviteCode=void 0,this._referredBy=void 0,this._joinDate=void 0,this._premiumStartDate=void 0,this._premiumEndDate=void 0,this._premiumCode=void 0,this._premiumCodeExpired=!1,this._nextBillingDate=void 0,this._trialStart=void 0,this._trialDuration=void 0,this._trialExtended=void 0,this._pricingSelected=r.a.Pricing.None,this._billingIdentifier=void 0,this._hasValidBillingData=new d.a(!1),this.daysLeftInTrial=new d.a(-1),this.inviteCodeError=new d.a,this.inviteEmailError=new d.a,this.inviteEmailSuccess=new d.a,this.init()}m.prototype={init:function(){if(this._premiumStatus.listen(function(e,t){i.default.vmMain&&i.default.vmMain.pluginManager&&(this.hasPremiumFeatures()?(i.default.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.EarlyAccess),i.default.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.PremiumSub)):this.hasEarlyAccess()&&i.default.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.EarlyAccess)),e!==t&&t&&h.a.onSettingChanged()}.bind(this)),p)setTimeout(function(){u.a.setConnected()},1500);else{var e=i.default.settings.get(Settings.premiumStatus),t=n.a.getURLParam("premium");if(void 0!==t&&n.a.removeURLParam("premium",!0),void 0!==e){0;var a=i.default.settings.get(Settings.trialStart)||Date.now(),s=i.default.settings.get(Settings.trialDuration)||0,o=i.default.settings.get(Settings.trialExtended)||!1;this._updateTrialDaysLeft(a,s,o);var l=i.default.settings.get(Settings.premiumEndDate)||Date.now();this._premiumEndDate=new Date(l),this.setPremiumStatus(e),t&&setTimeout(function(){i.default.menus.openSettings(r.a.SettingsSections.Account)},100)}this.checkRemotePremiumStatus()}},runServerPing:function(e){i.default.XHR_PrivateAPI({type:"POST",path:"/user/ping",data:{platformConfig:s.a.getUserPlatformConfig()},requireAuth:!0,cb:function(t){t.status!==r.a.HTTPStatusCode.Success&&log("Failed to notify server of lastSeen: ",t.status,t.response),e&&e()}})},checkRemotePremiumStatus:function(){try{i.default.PAssert(915,!i.default.isDemoMode()||!1,"Should not be querying for premium status in demo mode")}catch(e){i.default.reportError(e)}u.a.setConnecting(),u.a.onUserAuthorized("me",function(){var e=this.getBillingIdentifier(),t={email:e,gid:u.a.getDefaultGID(),lastTaskSync:i.default.settings.get(Settings.lastTaskSync),lastQuickAddSync:i.default.settings.get(Settings.lastQuickAddSync),clientVersion:window.__jsVersion,platformConfig:s.a.getUserPlatformConfig()};i.default.XHR_PrivateAPI({type:"POST",path:"/billing/getStatus",data:t,requireAuth:!0,autoRetry:!0,maxRetries:6,cb:function(t){var a=n.a.hasURLParam("invite"),s=!1;if(u.a.setNotConnecting(),t.status===r.a.HTTPStatusCode.Success&&t.response)try{u.a.setConnected();var o=JSON.parse(t.response).data;if(this.setBillingData(o),o.linkedAccounts)for(var d=0;d<o.linkedAccounts.length;++d)try{var c=o.linkedAccounts[d],h=PrivateAPIErrorCodes.Success;c.token||(h=PrivateAPIErrorCodes.TokenMissing),u.a.updateServerLinkedAccount(c.email,c.gid,c.name,c.scopes,c.token,h)}catch(e){i.default.reportError(e)}if(u.a.isAccountValidLinked(e)?u.a.notifyRemoteAccountsLinked():(log("Missing account token: ",e),l.a.ensureScopeAccess(function(e){try{i.default.PAssert(916,e,"Must always be able to receive permission for unknown scopes")}catch(e){i.default.reportError(e)}u.a.notifyRemoteAccountsLinked()})),o.tasks&&i.default.vmMain.deferredTaskManager.notifyRemoteTasks(o.tasks),o.quickAddItems&&i.default.vmMain.dropBucket.notifyRemoteItems(o.quickAddItems),window.__GLOBAL_CLOCK||i.default.vmMain.recurringTaskManager.hasRecurringTask("ServerPing")||i.default.vmMain.recurringTaskManager.createRecurringTask("ServerPing",{delay:i.default.hours(24),minDelay:i.default.hours(24),runOnCreate:!1,pauseWhileIdle:!1,minDelayOnResume:!1,async:!0,task:this.runServerPing.bind(this)}),a){s=!0,i.default.sendEvent("Billing","URLReferralCode");var f=n.a.getURLParam("invite");i.default.XHR_PrivateAPI({type:"POST",path:"/sharing/setReferral",data:{email:this.getBillingIdentifier(),refCode:f},requireAuth:!0,autoRetry:!0,cb:function(e){if(e.status===r.a.HTTPStatusCode.Success){switch(i.default.toasts.clearMessage(MessageID.InviteFailure),i.default.toasts.clearMessage(MessageID.InviteInvalid),f.toUpperCase()){case"PRODUCTHUNT":i.default.toasts.pushMessage({text:"You have successfully applied your ProductHunt promotion. Thanks for checking out Moo.do!"});break;default:i.default.toasts.pushMessage(MessageID.InviteSuccess)}n.a.removeURLParam("invite",!0),this.checkRemotePremiumStatus()}else try{var t=JSON.parse(e.response).data;["PRODUCTHUNT","UMICHEDU"].indexOf(f.toUpperCase())<0&&(t.code===PrivateAPIErrorCodes.InvalidReferralCode||t.code===PrivateAPIErrorCodes.InvalidParameter?i.default.toasts.pushMessage(MessageID.InviteInvalid):i.default.toasts.pushMessage(MessageID.InviteFailure))}catch(e){i.default.reportError(e)}}.bind(this)})}if(i.default.isFlagSet(o.loginFlags,r.a.LoginFlags.TrialAutoReset)&&i.default.toasts.pushMessage({text:"Your premium trial was reset. Please visit your account settings to learn more.",action:MessageAction.OpenSettings}),o.premiumStatus===PremiumStatus.Trial){try{i.default.PAssert(917,void 0!==o.trialStart,"Must have a valid trialStart set")}catch(e){i.default.reportError(e)}try{i.default.PAssert(918,void 0!==o.trialDuration,"Must have a valid trialDuration set")}catch(e){i.default.reportError(e)}if(o.trialStart&&o.trialDuration)try{var p=new Date(o.trialStart).getTime();i.default.settings.set(Settings.trialStart,p),i.default.settings.set(Settings.trialDuration,o.trialDuration),i.default.settings.set(Settings.trialExtended,o.trialExtended),this._updateTrialDaysLeft(p,o.trialDuration,o.trialExtended)}catch(e){i.default.reportError(e)}else this.setPremiumStatus(PremiumStatus.TrialOver),i.default.settings.set(Settings.trialStart,Date.now()),i.default.settings.set(Settings.trialDuration,0);i.default.isFlagSet(o.loginFlags,r.a.LoginFlags.OldUserNewTrial)&&i.default.vmMain.oldUserNewTrial()}else if(o.premiumStatus===PremiumStatus.CanceledUser||o.premiumStatus===PremiumStatus.CanceledPastDue)if(o.premiumEndDate)try{var m=new Date(o.premiumEndDate).getTime();i.default.settings.set(Settings.premiumEndDate,m)}catch(e){i.default.reportError(e)}else i.default.settings.set(Settings.premiumEndDate,Date.now());else o.premiumStatus===PremiumStatus.TrialOver?(this.daysLeftInTrial.set(-1),i.default.isFlagSet(o.loginFlags,r.a.LoginFlags.TrialOver)&&this.notifyTrialOver()):o.premiumStatus===PremiumStatus.Active?(i.default.toasts.clearMessage(MessageID.TrialOver),i.default.settings.get(Settings.notifiedTrialOver)&&i.default.settings.set(Settings.notifiedTrialOver,!1)):i.default.isFlagSet(o.loginFlags,r.a.LoginFlags.NewUser)&&u.a.getSignupUserData(function(e){i.default.reportSignup(e.email,e)})}catch(e){i.default.reportError(e)}else try{if(t.response)(o=JSON.parse(t.response)).code===PrivateAPIErrorCodes.NoSignupFound?(s=!0,u.a.getSignupUserData(function(e){i.default.reportSignup(e.email,e,function(e){e?this.checkRemotePremiumStatus():this._reportRemoteStatusFailure()}.bind(this))}.bind(this))):this._reportRemoteStatusFailure();else this._reportRemoteStatusFailure()}catch(e){this._reportRemoteStatusFailure(),i.default.reportError(e)}a&&!s&&i.default.toasts.pushMessage(MessageID.InviteFailure)}.bind(this)})}.bind(this))},setLastSignupError:function(e){this._lastSignupError=e},_reportRemoteStatusFailure:function(){i.default.sendEvent("Billing","RemoteStatusFailure")},_updateTrialDaysLeft:function(e,t,a){var r=t-Math.ceil((Date.now()-e)/864e5);try{i.default.PAssert(919,r<=320,"Sanity check on trial length",r)}catch(e){i.default.reportError(e)}this._trialStart=e,this._trialDuration=t,this._trialExtended=a,this.daysLeftInTrial.set(r),this._premiumStatus.get()===PremiumStatus.Trial&&r<0?(this.setPremiumStatus(PremiumStatus.TrialOver),this.notifyTrialOver()):this._premiumStatus.get()===PremiumStatus.Trial&&r<5&&this.notifyTrialEndSoon()},getBillingIdentifier:function(){var e;this._billingIdentifier||(e=u.a.isCurrentlyAuthorized("me")?u.a.getDefaultEmail():i.default.getActiveUser())&&(this._billingIdentifier=e);return this._billingIdentifier},onBillingIdentifierAvailable:function(e){this._billingIdentifier?setTimeout(e,0):u.a.onUserAuthorized("me",e)},onConnected:function(e){return u.a.onConnected(e)},hasPremium:function(){return this._premiumStatus.get()===PremiumStatus.Active||this._premiumStatus.get()===PremiumStatus.PastDue},isTrialState:function(){return this._premiumStatus.get()===PremiumStatus.Trial||this._premiumStatus.get()===PremiumStatus.TrialOver},isCanceledState:function(){return this._premiumStatus.get()===PremiumStatus.CanceledUser||this._premiumStatus.get()===PremiumStatus.CanceledPastDue},canceledUserHasPremiumAccess:function(){return this.isCanceledState()&&this.getPremiumEndDate().getTime()>Date.now()},isInFreeMonthAndPremium:function(){return(this.hasPremium()||this.canceledUserHasPremiumAccess())&&this._nonReferralDiscounts>=100},hasSubscription:function(){return!this._premiumCode},setBillingData:function(e){try{i.default.PAssert(920,e,"Must have a valid data bundle")}catch(e){i.default.reportError(e)}this._earlyAdopter=e.earlyAdopter,this._loginFlags=e.loginFlags||r.a.LoginFlags.None,this._inviteCode=e.inviteCode,this._referredBy=e.referredBy,this._joinDate=e.joinDate?new Date(parseInt(e.joinDate)):new Date,this._premiumStartDate=e.premiumStartDate?new Date(parseInt(e.premiumStartDate)):new Date,this._premiumEndDate=e.premiumEndDate?new Date(parseInt(e.premiumEndDate)):new Date,this._premiumCode=e.premiumCode,this._premiumCodeExpired=e.premiumCodeExpired||!1,this._nextBillingDate=e.nextBillingDate?new Date(parseInt(e.nextBillingDate)):new Date,this._trialStart=e.trialStart?new Date(parseInt(e.trialStart)):new Date,this._trialDuration=e.trialDuration||0,this._trialExtended=e.trialExtended||!1,i.default.settings.set(Settings.isUnsubscribed,!!e.isUnsubscribed),i.default.settings.set(Settings.monthlyInvoice,!!e.monthlyInvoice),i.default.settings.set(Settings.invoiceEmail,e.invoiceEmail),i.default.settings.set(Settings.invoiceCompany,e.invoiceCompany),i.default.settings.set(Settings.invoiceAddress,e.invoiceAddress),this.setPremiumStatus(e.premiumStatus),this._hasValidBillingData.set(!0)},setPremiumStatus:function(e){try{i.default.PAssert(921,i.default.isNumber(e),"Status must be a valid number",e)}catch(e){i.default.reportError(e)}try{i.default.PAssert(922,e>0&&e<8,"Should be a valid status identifier",e)}catch(e){i.default.reportError(e)}e!==this._premiumStatus.get()&&(this._premiumStatus.set(e),i.default.settings.set(Settings.premiumStatus,e),i.default.fireCustomEvent("premiumStatusChanged"),i.default.setDimension(r.a.Analytics.Dimensions.PremiumStatus,e))},hasValidBillingData:function(){return this._hasValidBillingData.get()},getPremiumStatus:function(){return this._premiumStatus.get()},getInviteCode:function(){return this._inviteCode},getJoinDate:function(){return this._joinDate||new Date},getPremiumStartDate:function(){return this._premiumStartDate||new Date},getPremiumEndDate:function(){return this._premiumEndDate||new Date},hasTrialExtended:function(){return this._trialExtended||!1},isEligibleForTrialExtension:function(){return!1},getNextBillingDate:function(){return this._nextBillingDate||new Date},hasEarlyAccess:function(){return this.hasPremiumFeatures()||this.canceledUserHasPremiumAccess()},onTapCancelSubscription:function(e,t){i.default.sendEvent("Billing","SubCancelTapped");var a=function(){t&&i.default.isFunction(t)&&t()};return i.default.menus.confirm("Are you sure you want to cancel your subscription?",function(e){e?(i.default.sendEvent("Billing","SubCancelYES"),i.default.XHR_PrivateAPI({type:"POST",path:"/billing/cancel",data:{email:this.getBillingIdentifier()},requireAuth:!0,cb:function(e){var t;if(200===e.status&&e.response){var r;try{r=JSON.parse(e.response)}catch(e){i.default.reportError(e)}if(r){var n=r.data,s=new Date(n.premiumEndDate).getTime();this._premiumEndDate=new Date(s),i.default.settings.set(Settings.premiumEndDate,s),this.setPremiumStatus(PremiumStatus.CanceledUser),t="Your premium subscription has been canceled. Please contact support@moo.do if you need assistance."}else t="There was a server error, please try again in a few minutes or contact support@moo.do."}else t="There was a server error, please try again in a few minutes or contact support@moo.do.";i.default.menus.alert({text:t,actionText:"OKAY"}),a()}.bind(this)})):(a(),i.default.sendEvent("Billing","SubCancelNO"))}.bind(this)),!0},getCustomPurchaseURL:function(){var e=i.default.vmMain.getUserID(),t=i.default.vmMain.getUserEmail(),a=u.a.getDefaultAccessToken();return window.location.protocol+"//"+window.location.host+"/purchase/#gid="+encodeURIComponent(e)+"&email="+encodeURIComponent(t)+"&token="+encodeURIComponent(a)},_openPaymentWindow:function(e){if(s.a.requireCustomPurchase)i.default.openUrl(this.getCustomPurchaseURL());else if(s.a.requireCustomPaypal){var t="Credit Card";i.default.menus.options("If you are using PayPal, a new window will be opened to complete your purchase.",["PayPal",t],function(a){(a===t||"PayPal"===a)&&(a===t?i.default.menus.openModalNew(Modals.Billing,{isUpdate:e}):"PayPal"===a&&i.default.openUrl(this.getCustomPurchaseURL()))}.bind(this))}else i.default.menus.openModalNew(Modals.Billing,{isUpdate:e})},onTapUpdatePaymentMethod:function(){this._openPaymentWindow(!1)},onTapViewInvoices:function(){i.default.XHR_PrivateAPI({type:"GET",path:"/billing/listTransactions",requireAuth:!0,cb:function(e){var t;try{t=JSON.parse(e.response)}catch(e){i.default.reportError(e)}200===e.status&&t?i.default.menus.openModalNew(Modals.Invoices,t.data):i.default.menus.alert({text:"There was an error retreiving your invoice data. Please contact support@moo.do.",callback:i.default.emptyFn})}})},onTapDeleteAccount:function(e,t){try{i.default.PAssert(927,t&&i.default.isFunction(t),"Delete account cannot be called without a callback")}catch(e){i.default.reportError(e)}i.default.sendEvent("Billing","DeleteAccountTapped");var a=function(){t&&i.default.isFunction(t)&&t()},r=function(e){e?(i.default.sendEvent("Billing","DeleteAccountYES"),l.a.deleteAccount(function(e,t){e||t===l.a.DeleteErrorCode.RootFolder?i.default.vmMain.docManager.deleteAllDocs(function(e){e?i.default.XHR_PrivateAPI({type:"POST",path:"/tracking/delete",data:{email:this.getBillingIdentifier()},requireAuth:!0,cb:function(e){200===e.status?i.default.menus.alert({text:"Your account has been successfully deleted.",actionText:"OKAY",callback:function(){i.default.vmSetup.logout()}}):i.default.menus.alert({text:"There was an error removing your email address from our server. Please contact support@moo.do for further assistance with code 3.",actionText:"OKAY"}),a()}}):(i.default.menus.alert({text:"There was an error deleting your Moo.do documents. Please contact support@moo.do for further assistance with code 2.",actionText:"OKAY"}),a())}.bind(this)):(i.default.menus.alert({text:"There was an error deleting your shared account data. Please contact support@moo.do for further assistance with code 1.",actionText:"OKAY"}),a())}.bind(this))):(a(),i.default.sendEvent("Billing","DeleteAccountNO"))}.bind(this);return i.default.menus.openModalNew(Modals.DeleteAccount,{callback:r}),!0},getInviteUrl:function(){return"https://www.moo.do/"},getSelectText:function(){return"Select and press "+s.a.cmdChar+" + C to copy to clipboard"},wasInvited:function(){return!!this._referredBy},submitInviteCode:function(e,t){if(e&&e.length>2)return i.default.sendEvent("Billing","EnterRefCode"),i.default.XHR_PrivateAPI({type:"POST",path:"/sharing/setReferral",data:{email:this.getBillingIdentifier(),refCode:e},requireAuth:!0,autoRetry:!0,cb:function(e){if(e.response){try{var a=JSON.parse(e.response)}catch(e){i.default.reportError(e)}if(200===e.status&&a){var r=a.data;this._referredBy=r.referredBy,this._premiumStatus.set(r.premiumStatus);var n=new Date(r.trialStart).getTime();this._updateTrialDaysLeft(n,r.trialDuration,r.trialExtended),this.inviteCodeError.set(""),i.default.sendEvent("Billing","EnterRefCodeSuccess")}else{if(a)switch(a.code){case PrivateAPIErrorCodes.AlreadyReferred:this.inviteCodeError.set(""),this.checkRemotePremiumStatus();break;case PrivateAPIErrorCodes.InvalidReferralCode:this.inviteCodeError.set("Referral code not found");break;default:this.inviteCodeError.set("Unable to use referral code")}else this.inviteCodeError.set("Unable to contact server");i.default.sendEvent("Billing","EnterRefCodeFailure")}}else this.inviteCodeError.set("Unable to contact server"),i.default.sendEvent("Billing","EnterRefCodeFailure");t&&t()}.bind(this)}),!0;this.inviteCodeError.set("Please enter a valid code")},sendInviteEmail:function(e,t){if(e&&e.length>0){for(var a=[],r=/.+@.+\..+/i,n=[],s=0;s<e.length;++s){r.lastIndex=0;var o=e[s];o&&(o=o.trim(),null===r.exec(o)?a.push(o):n.push(o))}if(0===a.length)return i.default.sendEvent("Billing","SendReferralEmail",n.length),i.default.XHR_PrivateAPI({type:"POST",path:"/sharing/sendReferral",data:{fromUser:this.getBillingIdentifier(),toEmailList:n},requireAuth:!0,autoRetry:!1,cb:function(e){if(t&&t(),200===e.status&&e.response){var a;try{a=JSON.parse(e.response).data}catch(e){i.default.reportError(e)}if(a&&0!==a.length){for(var r,n=[];s<a.length;++s)n.push(a[0].email),r||(r=a[0].reason);"exists"===r?this.inviteEmailError.set("One or more of the users is already a Moo.do user."):this.inviteEmailError.set("One or more of your emails could not be sent.")}else this.inviteEmailSuccess.set("Invite emails sent!"),this.inviteEmailError.set(""),setTimeout(function(){this.inviteEmailSuccess.set("")}.bind(this),4e3)}else this.inviteEmailError.set("Sorry! There was an error sending emails, please try again later.")}.bind(this)}),!0;this.inviteEmailError.set("Please enter a valid email: "+a[0])}},joinDateText:function(){return this.getJoinDate().toString(o.a.getFormat(DFormat.LongStrDate))},premiumStartDateText:function(){return this.getPremiumStartDate().toString(o.a.getFormat(DFormat.LongStrDate))},premiumEndDateText:function(){return this.getPremiumEndDate().toString(o.a.getFormat(DFormat.LongStrDate))},nextBillingDateText:function(){return this.getNextBillingDate().toString(o.a.getFormat(DFormat.LongStrDate))},shareTwitter:function(){var e="https://twitter.com/share?url="+escape(this.getInviteUrl())+"&text=I love this new organization app!";this.showPopup(e,550,420),i.default.sendEvent("Billing","ShareTwitter")},shareFacebook:function(){var e="https://www.facebook.com/sharer/sharer.php?u="+escape(this.getInviteUrl());this.showPopup(e,600,303),i.default.sendEvent("Billing","ShareFacebook")},shareGoogle:function(){var e="https://plus.google.com/share?url="+this.getInviteUrl();this.showPopup(e,500,650),i.default.sendEvent("Billing","ShareGoogle")},showPopup:function(e,t,a){var i=t,r=a,n=window.screen.height,s=window.screen.width,o="scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+i+",height="+r+",left="+Math.round(s/2-i/2)+",top="+Math.round(n/2-r/2);window.open(e,null,o)},onTapSignupMonth:function(){this._pricingSelected=this.getMonthlyPricing(),this._openPaymentWindow(!1),i.default.sendEvent("Billing","OpenSignupModal")},onTapSignupYear:function(){this._pricingSelected=this.getYearlyPricing(),this._openPaymentWindow(!1),i.default.sendEvent("Billing","OpenSignupModal")},onTapCodeSignup:function(){i.default.menus.openModalNew(Modals.EnterCode,{}),i.default.sendEvent("Blling","OpenEnterCodeModal")},redeemCode:function(e){i.default.isString(e)&&e.length>10?i.default.XHR_PrivateAPI({type:"POST",path:"/billing/useCode",requireAuth:!0,autoRetry:!0,data:{code:e},cb:function(t){if(t.status===r.a.HTTPStatusCode.Success)try{var a=JSON.parse(t.response).data;this._premiumStartDate=new Date(i.default.parseInt(a.premiumStartDate)),this._premiumEndDate=new Date(i.default.parseInt(a.premiumEndDate)),this._nextBillingDate=new Date(i.default.parseInt(a.nextBillingDate)),this._premiumCode=e,this._premiumCodeExpired=!1,this.setPremiumStatus(a.premiumStatus),i.default.toasts.pushMessage({text:"Success! Thank you for going premium!",timeout:8e3})}catch(e){i.default.reportError(e)}else t.status===r.a.HTTPStatusCode.BadRequest?i.default.toasts.pushMessage({text:"The code that you entered was not valid or has already been used.",timeout:8e3}):i.default.toasts.pushMessage({text:"There was an error processing your request. Please contact support@moo.do for help.",timeout:8e3})}.bind(this)}):i.default.toasts.pushMessage({text:"The code that you entered was not valid.",timeout:8e3})},getMonthlyPricing:function(){return this._earlyAdopter?r.a.Pricing.EarlyMonthly:r.a.Pricing.RegMonthly},getYearlyPricing:function(){return this._earlyAdopter?r.a.Pricing.EarlyYearly:r.a.Pricing.RegYearly},getMonthlyPrice:function(){return f[this.getMonthlyPricing()]},getYearlyPrice:function(){return f[this.getYearlyPricing()]},getPlanPrice:function(e){return f[e]},notifyTrialOver:function(){if(!i.default.settings.get(Settings.notifiedTrialOver)){if(!i.default.toasts)return void setTimeout(this.notifyTrialOver.bind(this),0);i.default.toasts.pushMessage(MessageID.TrialOver),i.default.settings.set(Settings.notifiedTrialOver,!0)}},notifyTrialEndSoon:function(){if(!i.default.settings.get(Settings.notifiedTrialEndSoon)){if(!i.default.toasts)return void setTimeout(this.notifyTrialEndSoon.bind(this),0);i.default.toasts.pushMessage(MessageID.TrialEndSoon),i.default.settings.set(Settings.notifiedTrialEndSoon,!0)}},isTrialOver:function(){var e=!1;return this._premiumStatus.get()===PremiumStatus.TrialOver?e=!0:this._premiumStatus.get()!==PremiumStatus.CanceledUser&&this._premiumStatus.get()!==PremiumStatus.CanceledPastDue||this.canceledUserHasPremiumAccess()||(e=!0),e},startTrial:function(){try{i.default.PAssert(928,!this.isTrialOver(),"Should never try to start a trial once it is over")}catch(e){i.default.reportError(e)}i.default.XHR_PrivateAPI({type:"POST",path:"/billing/startTrial",requireAuth:!0,autoRetry:!0,cb:function(e){if(e.status===r.a.HTTPStatusCode.Success){this._premiumStatus.set(PremiumStatus.Trial);try{var t=JSON.parse(e.response).data,a=new Date(t.trialStart).getTime();i.default.settings.set(Settings.trialStart,a),i.default.settings.set(Settings.trialDuration,t.trialDuration),i.default.settings.set(Settings.trialExtended,t.trialExtended),this._updateTrialDaysLeft(a,t.trialDuration,t.trialExtended)}catch(e){i.default.reportError(e)}}else if(e.status===r.a.HTTPStatusCode.BadRequest)try{(t=JSON.parse(e.response)).code===PrivateAPIErrorCodes.TrialOver&&(i.default.toasts.pushMessage({text:"Your free trial of Premium has ended. Please contact support@moo.do to extend.",actionText:"OKAY"}),this._premiumStatus.set(PremiumStatus.TrialOver))}catch(e){i.default.reportError(e)}else{try{i.default.PAssert(929,!1,"Failed to start trial for user")}catch(e){i.default.reportError(e)}i.default.toasts.pushMessage({text:"There was an error starting your trial. Please contact support@moo.do.",action:MessageAction.Contact})}}.bind(this)})},extendTrial:function(){i.default.XHR_PrivateAPI({type:"POST",path:"/billing/extendTrial",requireAuth:!0,autoRetry:!0,cb:function(e){if(e.status===r.a.HTTPStatusCode.Success){this._premiumStatus.set(PremiumStatus.Trial);try{var t=JSON.parse(e.response).data,a=new Date(t.trialStart).getTime();i.default.settings.set(Settings.trialStart,a),i.default.settings.set(Settings.trialDuration,t.trialDuration),i.default.settings.set(Settings.trialExtended,t.trialExtended),this._updateTrialDaysLeft(a,t.trialDuration,t.trialExtended)}catch(e){i.default.reportError(e)}}else{try{i.default.PAssert(930,!1,"Failed to extend trial for user")}catch(e){i.default.reportError(e)}i.default.toasts.pushMessage({text:"There was an error restarting your trial. Please contact support@moo.do.",action:MessageAction.Contact})}}.bind(this)})},hasPremiumFeatures:function(){return this.hasPremium()||this._premiumStatus.get()===PremiumStatus.Trial||this.canceledUserHasPremiumAccess()},getBillingPeriod:function(){return this._pricingSelected}},t.a=m},function(e,t,a){"use strict";var i=a(0),r=a(4),n=a(1),s=a(2),o=a.n(s),l=a(41),d=(a.n(l),a(3)),c=(a(5),a(8)),u=a(18),h=a(31),f=a(169),p=a(186),m=a(188),g=a(189),v=a(190),y=a(216),S=a(249),E=a(252),P=a(254),b=a(260),C=a(262),D=a(263),I=a(266),A=a(268),M=a(269),_=a(270),T=a(271),w=a(273),k=a(6),x=d.a.createClass({displayName:"ReactMain",componentDisplay:n.a.ComponentDisplay.Everywhere,init:function(){var e=r.a.blockClient();if(void 0!==e){i.default.errorPlatformInfo=e;var t,a=e.platform;a?t=e.update?"iOS App"===a?"Please update your iOS app to the latest version in the App Store.":"Android App"===a?"Please update your Android app to the latest version in the Play Store.":"Firefox"===a?'Please update your Firefox browser to use Moo.do. Moo.do requires at least Firefox 16. See <a href="https://support.mozilla.org/en-US/kb/update-firefox-latest-version">https://support.mozilla.org/en-US/kb/update-firefox-latest-version</a> for more information.':"Chrome"===a?'Please update your Chrome browser to use Moo.do. Moo.do requires at least Chrome 26. See <a href="https://support.google.com/chrome/answer/95414">https://support.google.com/chrome/answer/95414</a> for more information.':"Native Android"===a?"Please update your Android device to use Moo.do. Moo.do requires at least Android 2.1.":"Internet Explorer"===a?'Please update your Internet Explorer browser to use Moo.do. Moo.do requires at least Internet Explorer 10. See <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">http://windows.microsoft.com/en-us/internet-explorer/download-ie</a> for more information.':"Safari"===a?'Please update your Safari browser to use Moo.do. Moo.do requires at least Safari 6.1. See <a href="http://support.apple.com/kb/HT6103">http://support.apple.com/kb/HT6103</a> for more information.':"Please update your browser to use Moo.do. If you are unable to update your browser, please let us know. Thanks!":"Sorry, we don't support "+a+" yet. Please let us know that you're interested in using "+a+" and we will make it a higher priority. Thanks!":e.version?t="Please update your app to the latest version of Moo.do. Thanks!":e.cacheUpdate&&(t="There was an issue while updating the app, "+r.a.actionVerb()+" to try again.",i.default.AppCache.update()),r.a.app&&i.default.nativeBridge.sendToApp("localLoaded"),t&&(this.platformError=t)}},componentDidMount:function(){this.setPanesContainer(),document.addEventListener("keydown",this.keydown),document.addEventListener("keypress",this.keypress),document.addEventListener("keyup",this.keyup),this.listenToDispatcher("panesChanged"),i.default.settings.listen("settingChanged",Settings.DefaultGroup,Settings.closedHelps,this.onClosedHelpsChanged),i.default.settings.listen("settingChanged",Settings.DefaultGroup,Settings.inTooltipIntro,this.updateState)},componentDidUpdate:function(){this.setPanesContainer()},setPanesContainer:function(){var e=this.props.main;e.panesContainer||(e.panesContainer=this.refs.panes)},onClickErrorRefresh:function(){i.default.AppCache.runOnFinish(function(){i.default.reload(!i.default.AppCache.useServiceWorker)},!0)},onClickErrorDownload:function(){i.default.openUrl(r.a.getAppDownloadURL())},onClosedHelpsChanged:function(e,t){!t||!t.firstRunIntro||e&&e.firstRunIntro||this.updateState()},_isOkToSendKey:function(e){return!e.defaultPrevented&&c.a.getPane()&&!(i.default.menus.isContextMenuOpen()&&!i.default.menus.isAutocompleteOpen())&&!i.default.menus.isModalOpen()&&!this.props.main.activeInput.get()},keydown:function(e){if(this._isOkToSendKey(e)&&c.a.getPane().keydown(e),e.target===document.body&&e.normCode===KeyCode.BackSpace)return e.handled=!0,e.preventDefault(),!1},keypress:function(e){this._isOkToSendKey(e)&&c.a.getPane().keypress(e)},keyup:function(e){this._isOkToSendKey(e)&&c.a.getPane().keyup(e)},onMouseDownPanes:function(e){"panes"===e.target.id&&c.a.reset()},getState:function(){var e=this.props.main,t=e.paneManager;return{panes:t.displayPanes,failedInitialDocLoad:e.failedInitialDocLoad,showTrashedDocumentError:e._isShowingTrashedDocumentError,isHelpShowing:i.default.intro.isVisible,helpPosition:i.default.intro.position,isWindowFocused:c.a.isWindowFocused,isDragging:u.a.isVisible,isDraggingPane:u.a.isDraggingPane,isLoading:t.isLoading,animatePaneSwap:t.animatePaneSwap,isDraggingSidebar:h.a.isDraggingSidebar,showSidebar:h.a.showSidebar,cursor:e.cursor,loginState:i.default.vmSetup.loginState,isLoggedIn:i.default.vmSetup.isLoggedIn(),isMainRendered:e.isRendered,showIntroPopup:i.default.settings.get(Settings.inTooltipIntro)&&e.shouldShowHelp("firstRunIntro")}},render:function(){for(var e=this.state,t=[],a=0;a<e.panes.length;++a){var n=e.panes[a],s=n.type,d=n.pane;if(d.hasBeenActive)if("overview"===s)t.push(o.a.createElement(C.a,{key:"overview"+d.id,pane:d}));else if("pane"===s)switch(d.type){case PaneMode.Task:t.push(o.a.createElement(p.a,{key:"pane"+d.id,pane:d}));break;case PaneMode.Archived:case PaneMode.Drive:t.push(o.a.createElement(f.a,{key:"pane"+d.id,pane:d}));break;case PaneMode.Gmail:t.push(o.a.createElement(m.a,{key:"pane"+d.id,pane:d}));break;default:try{i.default.PAssert(1429,!1,"Invalid pane mode requested"+d.type)}catch(e){i.default.reportError(e)}}else"emailPreview"===s&&t.push(o.a.createElement(D.a,{key:"emailPreview"+d.id,pane:d}))}var c=e.cursor;e.isDraggingSidebar&&(c="cursor-ew-resize");var u,x,L=i.default.classNames("renderedContent c-foreground c-bg-app",c,{windowBlurred:!e.isWindowFocused},{draggingItems:!!e.isDragging||e.isDraggingPane},{draggingPane:e.isDraggingPane});if(e.showTrashedDocumentError)u=o.a.createElement(M.a,{key:"trashError"});else if(this.platformError)u=o.a.createElement("div",{className:"centerVHFlex",style:{width:540,lineHeight:1.5}},o.a.createElement("div",null,o.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.platformError}}),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement(k.a,{display:"block",onClick:this.onClickErrorRefresh},"Reload"),o.a.createElement("br",null),o.a.createElement(k.a,{display:"block",onClick:this.onClickErrorDownload},"Download app")));else if(e.isLoggedIn){if(e.isMainRendered)if(!e.isLoading||i.default.isDemoMode()||e.failedInitialDocLoad){var O,R=i.default.classNames("panes c-background",{noPanes:0===t.length},{noClick:e.isDraggingSidebar},{transition:h.a.sidebarTransitioning}),N={left:-1,bottom:r.a.isMailbirdSidebar()?40:0,top:h.a.shouldShowTopBar()?r.a.isNativeMac()?36:32:0};if(e.isHelpShowing){var F={};F[r.a.transform.react]="translate("+e.helpPosition+"px,0)",O=o.a.createElement("div",{id:"helpPlaceholder",style:F})}x=o.a.createElement("div",{id:"panes",className:R,ref:"panes","data-moo-id":"panes",style:N,onMouseDown:this.onMouseDownPanes},t.length>0?t:o.a.createElement(ReactAddPaneArea,null),O),u=o.a.createElement("div",{id:"container",className:L},r.a.mac&&r.a.isNativeApp()&&o.a.createElement("div",{className:"appTopBar desktopDrag c-bg-app"}),o.a.createElement(P.a,{main:this.props.main}),x,e.showIntroPopup&&o.a.createElement(_.a,null),this.props.main.getDefaultEmailPlugin()&&o.a.createElement(b.a,null),o.a.createElement(y.a,null),o.a.createElement(S.a,null),o.a.createElement(E.a,null),o.a.createElement(v.a,null),o.a.createElement(g.a,null),o.a.createElement(I.a,null),o.a.createElement(T.a,null),i.default.isDemoInIframe()&&o.a.createElement(A.a,null))}else u=o.a.createElement("div",{key:"loadingRemote",id:"loadingRemote",className:"c-foreground-light centerVH"},o.a.createElement("div",{className:"loading loading20"}),o.a.createElement("div",{className:"loadingText"},"Loading file"))}else u=o.a.createElement(w.a,null);return o.a.createElement(l.CSSTransitionGroup,{transitionName:"reactFadeMain",transitionEnterTimeout:300,transitionLeaveTimeout:100},u)}});t.a=x},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=(a(20),a(62)),c=(a(12),a(16),a(30),a(6)),u=l.a.createClass({displayName:"ReactPaneList",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){var e=this.props.pane;return{rect:e.rect,hasCollapsed:e.hasCollapsedObs,_allowCollapsingObs:e.search.getFilter("showOnlyMatches"),allowCollapsing:!e.search.getFilterValue("showOnlyMatches")}},render:function(){var e=this.state,t=this.props.pane,a=e.hasCollapsed,s=(a?"Uncollapse":"Collapse")+" all items in view",l=n.a.secModKey+" + Shift + .",u=r.a.PaneHeaderButtonWidth,h=r.a.PaneHeaderButtonHeight;return o.a.createElement(d.a,{pane:t,minItemHeight:i.default.minItemHeight},o.a.createElement("div",{className:"f1",key:"headerButtons"},t.supportCollapsing&&o.a.createElement(c.a,{icon:a?"icon-angle-down":"icon-angle-right",iconSize:16,width:u,height:h,onClick:t.toggleCollapseAll.bind(t),tooltip:s,tooltipHotkey:l,enabled:e.allowCollapsing})))}});t.a=u},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3).a.createClass({displayName:"ReactWrapper",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){return i.default.clone(this.props.observe)},render:function(){var e=this.props,t=this.state;if(e.render)return e.render(t,e);var a=e.component||"div";return e=i.default.extend({style:e.renderStyle(t,e)},e),s.a.createElement(a,e,e.children)}});t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(7),n=a(1),s=a(4),o=a(10),l=a(2),d=a.n(l),c=a(3),u=(a(20),a(36)),h=a(35),f=a(172),p=a(173),m=a(12),g=a(16),v=a(6),y=(a(37),a(174),c.a.createClass({displayName:"ReactPaneHeader",componentDisplay:n.a.ComponentDisplay.Everywhere,init:function(){0},getState:function(){var e=this.props.pane,t={isOverviewVisible:e.overview.isVisible,item:e.item,showingArchived:e.showArchived,isSearchFocused:e.search.isFocused,isFocused:e.isFocused,titles:e.getTitleList()};return t},componentDidMount:function(e){0},onUnmount:function(e){0},onBeforeChanged:function(e,t){this.refs},onPaneScroll:function(e){var t=this.props.pane.getScrollOffset();if(void 0===this.paneScrollOffset&&(this.paneScrollOffset=t),t!==this.paneScrollOffset&&t>0){var a=this.headerRow2Position.get()+this.paneScrollOffset-t;this.headerRow2Position.set(i.default.clamp(a,-n.a.PaneHeaderRow2Height,0))}this.paneScrollOffset=t},onMouseDown:function(e){e.button===ButtonCode.Left&&this.props.startDragging(e)},onMouseDownMore:function(e){i.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})},numComplete:function(){return this.props.pane.getItemsToArchive().length},cloneBoard:function(e){h.a.cloneBoard(void 0,e)},_clonePane:function(e,t){var a=i.default.vmMain.paneManager.getPaneIndex(t),n=t.getSaveInfo();n.item=r.a.getModel(n.item),delete n.id,i.default.vmMain.paneManager.createPaneAtIndex(e,a+1,n)},onClickClonePane:function(e){this._clonePane(e,this.props.pane)},onTapOverviewButtonMobile:function(){0},onTapMoreButtonMobile:function(){0},onTapMultiselectMobile:function(){0},onTapCloseTopStatus:function(){0},onTapClearMultiselect:function(){u.a.setSelected([])},onTapUndoMobile:function(){o.a.undoAction()},onClickStar:function(){this.cloneBoard(this.props.pane)},onClickArchiveCompleted:function(){var e=this.props.pane,t=this.numComplete();i.default.menus.confirm("Are you sure you want to archive "+t+" completed item"+(t>1?"s":"")+"?",function(t){t&&e.archiveCompleted()})},onDoubleClickHeader:function(e){i.default.hasClass(e.target,"paneDraggable")&&this.props.pane.scrollToTop(ScrollDuration.Default)},renderContextMenuMobile:function(){},renderContextMenu:function(e){var t=this.props.pane,a=t.supportDataRefresh||t.supportReportError;return d.a.createElement(m.a,{key:"contextMenuPaneHeader",element:e.element},d.a.createElement(d.a.Fragment,null,d.a.createElement(g.a,{icon:"icon-close",onClick:t.onTapClosePane.bind(t)},"Close"),d.a.createElement("hr",null)),d.a.createElement(g.a,{icon:"icon-star_border",onClick:this.onClickStar},"Open pane in new board"),t.supportClone&&s.a.isFeatureEnabled(n.a.Feature.ClonePane)&&d.a.createElement(g.a,{icon:"icon-align-left",onClick:this.onClickClonePane.bind(this,PaneMode.Task)},"Clone Pane"),t.supportPerformArchive&&d.a.createElement(g.a,{icon:"icon-task",disabled:0===this.numComplete(),onClick:this.onClickArchiveCompleted},"Archive Completed Items"),a&&d.a.createElement("hr",null),t.supportDataRefresh&&d.a.createElement(g.a,{icon:"icon-spinner",onClick:t.onTapRefreshData.onClick.bind(t)},"Force refresh"),t.supportReportError&&d.a.createElement(g.a,{icon:"icon-warning",onClick:t.onTapReportError.onClick.bind(t)},"Report Error"))},renderTopStatus:function(e,t){},render:function(){var e=this.state,t=this.props.pane,a=this.getChildByKey("headerButtons"),r=n.a.PaneHeaderButtonWidth,s=n.a.PaneHeaderButtonHeight,o=i.default.classNames("paneHeader c-background c-border",{focused:e.isFocused},{oneRow:1===e.titles.length&&!t.showRootOnRow2},{twoRows:e.titles.length>1||t.showRootOnRow2});return d.a.createElement("div",{className:o,onDoubleClick:this.onDoubleClickHeader},d.a.createElement("div",{className:"paneHeaderRow paneHeaderRow1 flexbox",onMouseDown:this.onMouseDown},d.a.createElement(v.a,{className:"overviewButton",icon:"icon-menu",iconSize:15,width:r,height:s,onClick:t.onTapOverviewButton.bind(t),tooltip:(e.isOverviewVisible?"Close":"Open")+" Overview"}),d.a.createElement("div",{className:"f1",style:{maxWidth:8}}),d.a.createElement("span",{className:"titles titlesRow1"},t.supportViewMenu&&d.a.createElement(p.a,{pane:t,item:e.titles[e.titles.length-1],viewMode:!0}),!t.supportViewMenu&&d.a.createElement(p.a,{pane:t,item:e.titles[0],paneName:!0})),d.a.createElement("div",{className:"f1",style:{maxWidth:8}}),d.a.createElement(f.a,{pane:t}),d.a.createElement("div",{className:"f1 paneDraggable"}),a&&d.a.Children.map(a.props.children,function(e){return e}),d.a.createElement(v.a,{className:"paneCloseButton",icon:"icon-more_horiz",iconSize:18,width:r,height:s,onMouseDown:this.onMouseDownMore,tooltip:"Pane Options"})),(e.titles.length>1||t.showRootOnRow2)&&d.a.createElement("div",{className:"paneHeaderRow paneHeaderRow2 flexbox paneDraggable",onMouseDown:this.onMouseDown},d.a.createElement("div",{className:"paneHeaderRow2Inner"},e.titles.map(function(a,i){return d.a.createElement(p.a,{key:"title_"+i,pane:t,item:a,first:0===i,last:i===e.titles.length-1})}))))}}));t.a=y},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(29),d=a(26),c=a(8),u=a(90),h=a(21),f=a(6),p=o.a.createClass({displayName:"ReactSearch",componentDisplay:r.a.ComponentDisplay.Everywhere,componentDidMount:function(){this.props.pane.search.UI=this,this.listenTo(this.props.pane.search.onChanged),this.forceUpdate()},getState:function(){for(var e=this.props.pane,t=e.search,a={search:t.value,calendars:d.a.GCalendarsAvailable,displayCalendars:e.displayCalendars,displayLocalItems:e.displayLocalItems},i=0;i<t.filters.length;i++){var r=t.filters[i];a[r.name]=r.value,a[r.name+"Enabled"]=r.enabled}return a},onChange:function(e){this.props.pane.search.setValue(e)},onParsed:function(e){this.props.pane.search.onParsed(e)},setSearch:function(e,t){this.props.pane.search.setValue(e),!1!==t&&this.setSelectionOffset(e.length)},getSelectionOffset:function(){return this.refs.input.getSelectionOffset()},setSelectionOffset:function(e){this.refs.input.setSelectionOffset(e)},onFocus:function(){var e=this.props.pane,t=e.search;t&&(this._selectionBeforeBlur=c.a.save(),c.a.reset(),t.isFocused.set(!0),l.a.hide(),i.default.sendEvent("SearchFocus","Desktop"),i.default.menus.isContextMenuOpen("ReactContextMenuSearch")||i.default.menus.openContextMenu({componentName:"ReactContextMenuSearch",key:"search"+e.id+(e.viewMode?e.getViewMode():""),element:this.refs.searchBox,positionOffset:{top:4},noBackdrop:!0,pane:e,onClosed:this.blur}))},onBlur:function(){var e=this.props.pane.search;e&&e.isFocused.set(!1)},focus:function(){this.refs.input.focus(),this.refs.input.selectEnd()},blur:function(){this.refs.input&&this.refs.input.blur()},onTapBox:function(e){},onTapX:function(e){var t=this.props.pane;if(this.state.search.length>0){var a=c.a.save();this.setSearch("",!1),a&&t.restoreSelection(a),i.default.preventDefault(e),i.default.sendEvent("Menu","ClearSearch")}else this.focus(),i.default.sendEvent("Menu","FocusSearch")},onKeyDown:function(e){this.saveScrollOfTop();var t=this.props.pane;if(e.keyCode===KeyCode.Enter&&(t.search.update(!0,!0),this.setSelectionOffset(this.state.search.length)),e.keyCode===KeyCode.Tab||e.keyCode===KeyCode.Enter){var a=t.indexOfFirstItem();if(a>=0){var r=a,n=this._selectionBeforeBlur;n&&(c.a.restore(n)?(this._selectionBeforeBlur=void 0,r=n.startIndex):n=null),n||(this.blur(),t.selectIndex(a,0),setTimeout(function(){t.selectIndex(a,0)},0)),c.a.focusPane(t),r>=0&&i.default.focusedPane.scrollIndexIntoView(r,ScrollDuration.Default)}else t.type===PaneMode.Task&&t.addItem(e);e.preventDefault(),e.stopPropagation()}},onAutocompleteSelected:function(e){e.item&&i.default.vmMain.zoomin(e.item)},onClickFilters:function(){this.focus()},saveScrollOfTop:function(){this.props.pane.getInfiniteList().saveScrollOfTop(!0)},onClickPriority:function(){this.props.pane.search.setFilter("priority",0)},renderSearchButton:function(e){var t=this.props.pane;return s.a.createElement(u.a,{key:e.name,filter:e,filterValue:e.value.get(),search:t.search})},renderSearchPriority:function(){var e=this.props.pane.search.filter_priority.value.get(),t=e===VMLIFlag.P0?0:e===VMLIFlag.P1?1:e===VMLIFlag.P2&&2,a=i.default.classNames("searchPriority searchP"+t+" selected");return s.a.createElement("span",{key:"priority",className:a,onClick:this.onClickPriority})},render:function(){for(var e=this.state,t=this.props.pane,a=t.search,i=e.search,n=i.length>0?"icon-close":"",o=r.a.SearchHeight,l=[],d=0;d<a.filters.length;d++){var c=a.filters[d];c.enabled.get()&&c.value.get()&&(c.icon?l.push(this.renderSearchButton(c)):"priority"===c.name&&l.push(this.renderSearchPriority()))}t.isViewDates()&&t.isCalFilterActive()&&l.push(s.a.createElement("div",{className:"searchButton icon-calendar selected yes",onClick:this.onClickFilters}));var u=s.a.createElement(f.a,{className:"searchX c-button noShrink",width:24,height:o,icon:n,onClick:this.onTapX}),p=s.a.createElement("div",{className:"searchInnerWrap",ref:"searchInnerWrap"},s.a.createElement(h.a,{ref:"input",className:"search",id:"search",height:o,value:i,onChange:this.onChange,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,onParsed:this.onParsed,parse:!0,placeholder:"Search",autocompleteMode:"all",border:!1,autocompleteElementDisplay:this.refs.searchBox,padding:{left:0,right:0},onAutocompleteSelected:this.onAutocompleteSelected,supportSearchItemAutocomplete:t.supportSearchItemAutocomplete,noShowAutocomplete:!0}));return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"searchWrap"},s.a.createElement("div",{className:"searchBox c-bg-light flexbox",ref:"searchBox"},s.a.createElement("div",{className:"searchBoxInner flexbox"},p,u),l.length>0&&s.a.createElement("div",{className:"searchButtons noShrink"},l))))}});t.a=p},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=(a(37),a(30)),d=a(12),c=a(16),u=a(53),h=o.a.createClass({displayName:"ReactTitle",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(e){var t=e.item,a=e.pane,i={customName:a.name,rootText:a.titleOfFirstItem,viewState:a.viewState,viewMode:a.getViewMode()};return e.viewMode?a.name.get()?i.text=a.name.get():i.text=r.a.TaskViewModeTextSimple[i.viewMode]:e.paneName?i.text=a.title:e.first&&!a.showRootOnRow2?i.text=a.titleOfFirstItem():(i.text=this.getTextForItem(t),i.jsx=this.getJSXForItem(t),i.html=this.getHTMLForItem(t)),i},init:function(){this._onMount()},_onMount:function(e){(e=e||this.props).viewMode||this.listenTo(e.item.itemChanged)},componentWillReceiveProps:function(e){e.viewMode===this.props.viewMode&&this.props.item===e.item||(this.refreshListeners(),this._onMount(e),this.updateState(e))},onMouseDown:function(e){this._holdTimeout=setTimeout(this.openContextMenu,150,{target:e.target})},onMouseUp:function(){this.clearHoldTimeout()},onClick:function(e){var t=this.props;i.default.isString(t.item)||(t.last?this.openContextMenu(e):t.pane.onClickTitle(t.item))},onRightClick:function(e){e.preventDefault(),this.openContextMenu(e)},onDoubleClick:function(e){var t=this.props.pane;i.default.isString(this.props.item)||t.onDoubleClickTitle()},onClickMenuItem:function(e){this.props.pane.onClickTitle(e)},clearHoldTimeout:function(){clearTimeout(this._holdTimeout),this._holdTimeout=void 0},getTextForItem:function(e){return e.generateTitleText()},getHTMLForItem:function(e){return e.getStyledTextAsOneLine(!1,!1)},getJSXForItem:function(e){var t=this.getTextForItem(e),a=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail);if(a.isLabelItem(e)){var r=a.getIconForLabel(e),n=i.default.classNames("labelText",{hasIcon:!!r});return s.a.createElement("span",{className:n},s.a.createElement("i",{className:r&&"c-foreground-light icon-"+r}),t)}},openContextMenu:function(e){var t=this.props,a=t.pane,r=t.item,n=r.parent()?r.parent().items.get():r.items.get();this.clearHoldTimeout(),i.default.menus.openContextMenu({fn:this.renderContextMenuSiblings,element:e.target,item:r,pane:a,siblings:n})},renderContextMenuSiblings:function(e){var t=this;return s.a.createElement(d.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:e.element,maxHeight:400},s.a.createElement(l.a,{topHeader:!0},this.props.pane.titleContextMenuHeader),e.siblings.map(function(a){var i=t.getJSXForItem(a);return s.a.createElement(c.a,{key:a.id,active:a===e.item,onClick:t.onClickMenuItem.bind(t,a)},i)}))},render:function(){var e,t=this.props,a=this.state,r=t.item,n=!t.viewMode&&r.parent(),o=a.text,l=i.default.classNames("titleWrapper",t.className,{"c-foreground":t.last},{"c-foreground-very-faded c-color-hover":!t.last&&!t.viewMode&&!t.paneName},{last:t.last},{firstRow:t.viewMode||t.paneName},{viewMode:t.viewMode}),d=i.default.classNames("title");if(t.viewMode)e="<b>Click</b> to change view mode or name this pane";else{var c="<b>Click</b> to zoom to ";e=t.last?n?c+"a sibling of "+o:c+"an item in the "+o:c+o+".\n<b>Press and hold</b> to zoom to a"+(n?" sibling of ":"n item in the ")+o+"."}return s.a.createElement(u.a,{className:l,"data-tooltip":e,onClick:this.onClick,onDoubleClick:this.onDoubleClick,onMouseDown:t.viewMode?t.pane.openViewMenu:this.onMouseDown,onMouseUp:this.onMouseUp,onContextMenu:this.onRightClick,ripple:!1},(a.jsx||!a.html)&&s.a.createElement("span",{className:d},a.jsx||a.text),!(a.jsx||!a.html)&&s.a.createElement("span",{className:d,dangerouslySetInnerHTML:{__html:a.html}}))}});t.a=h},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(3),l=(a(20),a(6));o.a.createClass({displayName:"ReactMobileFilterBar",componentDisplay:r.a.ComponentDisplay.Everywhere,componentDidMount:function(){this.listenTo(this.props.pane.search.onChanged)},getState:function(){for(var e=this.props.pane.search,t={},a=0;a<e.filters.length;a++){var i=e.filters[a];t[i.name]=i.value}return t},openMobileFilterMenu:function(){i.default.menus.toggleContextMenu({componentName:"ReactContextMenuMobileFilter",position:"search-right",pane:this.props.pane})},renderSearchButton:function(e){var t=e.value,a=i.default.classNames("searchFilterButton selected",e.icon,{yes:t>0},{no:t<0});return s.a.createElement("div",{key:e.name,className:a})},renderSearchPriorityButton:function(e){var t=e.value,a=i.default.classNames("searchPriorityButton",{p0:t===VMLIFlag.P0},{p1:t===VMLIFlag.P1},{p2:t===VMLIFlag.P2},{selected:t===e.value}),n={height:r.a.PaneHeaderRow2ButtonHeight,lineHeight:r.a.PaneHeaderRow2ButtonHeight+"px"};return s.a.createElement("div",{key:e.name,className:a,style:n})},render:function(){for(var e=this.props.pane.search,t=[],a=0;a<e.filters.length;a++){var i=e.filters[a];i.enabled.get()&&i.value&&(i.icon?t.push(this.renderSearchButton(i)):"priority"===i.name&&t.push(this.renderSearchPriorityButton(i)))}var n=t.length>0;return s.a.createElement("div",{className:"mobileFilterBar flexbox"},s.a.createElement(l.a,{icon:n?null:"icon-filter_list",iconSize:17,fontSize:14,height:r.a.PaneHeaderRow2ButtonHeight,paddingLeft:0,paddingRight:0,color:"#444",onClick:this.openMobileFilterMenu,ripple:!n},t))}})},function(e,t,a){"use strict";a(0);var i=a(1),r=(a(4),a(2)),n=a.n(r),s=a(3),o=(a(20),s.a.createClass({displayName:"ReactHiddenInput",componentDisplay:i.a.ComponentDisplay.Desktop,getState:function(){return{position:this.props.pane.caretPosition}},getElement:function(){return this.refs.hiddenInput},render:function(){this.state;var e=this.state.position,t={};return e&&(t.left=e.left,t.top=e.top),n.a.createElement("div",{style:t,contentEditable:"true",className:"paneHiddenInput",ref:"hiddenInput"},TextSpace)}}));t.a=o},function(e,t,a){"use strict";var i=a(1),r=a(4),n=a(2),s=a.n(n),o=a(3),l=a(24),d=(a(20),a(8)),c=o.a.createClass({displayName:"ReactCaret",componentDisplay:i.a.ComponentDisplay.Desktop,init:function(){this.createObservables({isOn:!1})},componentDidMount:function(){document.addEventListener("mousedown",this.startAnim),document.addEventListener("mouseup",this.startAnim)},onUnmount:function(){document.removeEventListener("mouseup",this.startAnim),document.removeEventListener("mousedown",this.startAnim),clearTimeout(this.animTimeout)},getState:function(){var e=this.props.pane;return{info:e.caretPosition,isWindowFocused:d.a.isWindowFocused,activePane:d.a.pane,isPaneActive:d.a.isWindowFocused.get()&&d.a.getPane()===e}},onAfterChanged:function(e,t){e.isPaneActive&&e.info&&(e.isPaneActive!==t.isPaneActive||e.info!==t.info)&&this.startAnim(e)},startAnim:function(e){this.animTick(!0,e)},animTick:function(e,t){(t=t||this.state).isPaneActive&&t.info&&(clearTimeout(this.animTimeout),this.isOn.set(e||!this.isOn.get()),this.animTimeout=setTimeout(this.animTick,500))},render:function(){var e=this.state,t=this.state.info,a=t&&t.item,i=t&&t.pane,n={height:"18px"};return t&&e.isPaneActive&&d.a.isValid()&&d.a.getStartItem()?(t.isVisible&&(n.height=a&&i&&l.a.lineHeightForItem(a,i)+"px",n.opacity=e.isOn?1:0),n[r.a.transform.react]="translate3d("+t.left+"px, "+t.top+"px, 0)"):n[r.a.transform.react]="translate3d(-1000px, -1000px, 0)",s.a.createElement("div",{className:"caret c-bg-caret",style:n})}});t.a=c},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(28),d=a(24),c=a(8),u=a(36),h=a(27),f=(a(37),function(e,t,a){var i=t.overview,r=t.pane;return a.isHeader&&(r.supportCollapsing||i)&&!r.isSearchedFlat()&&!e.isNote()&&!(i&&0===a.levelsDeep)}),p=function(e,t,a,i){return 0===t&&a.isPrefixNumList()&&(e=e.replace('<span class="itemPrefix','<span data-listnum="'+i.numListNumber+'" class="itemPrefix')),e=e||TextSpace},m=function(e,t){var a=e.item||e;return!t.isViewAgenda()&&a.isNote()&&a.parent().getPrefix()&&(!e.block||e.block.item!==a.parent())&&r.a.PrefixWidth+r.a.LineLeftPad},g=function(e,t,a){return d.a.paddingForItemTop(e,a)+(e.shouldShowParents(t,a)?r.a.HeightAgendaParents:0)},v=function(e){return e.overview||e.cell.paneObject.levelsDeep>0?d.a.itemIndentSize()-1:20},y={onMount:function(e,t,a,i,r){var n=i.pane,s=i.overview;e.listenTo(t.itemChanged),e.listenToDispatcher("numListChanged"),e.listenToDispatcher("EmailPreview","onClosed"),e.listenToDispatcher("EmailPreview","openThreadChanged"),n&&!s&&t.onLoad(n),e.setData(e.refs.li,t)},onUnmount:function(e){e.disposeDispatcherListeners()},onUpdate:function(e,t,a,i,r,n){},getState:function(e,t,a,r){var n=r.pane,s=r.overview;if(n.isDestroyed())return{};var o=c.a.isSelected(a,n),d={flags:t.flags,levelsDeep:t.levelsDeep,styleProps:t.styleProps(n),isHovered:c.a.isReactCellHovered(e),showVerticalLines:!s&&n.supportVertLines&&i.default.settings.get(Settings.showVerticalLines,Settings.UISettingsGroup),isSelected:!s&&n===i.default.focusedPane&&u.a.isSelected(a,n),hasSelection:!!o,hasNote:t.hasNote(),isCollapsed:t.isCollapsed(n,s),isHighlighted:t.isHighlighted,dropBucketItems:!1,numListNumber:t.isPrefixNumList()&&t.numListNumber(),draggedInPane:t.draggedInPane,isBeingDragged:t.draggedInPane.get()===n||!1,isMatchStuckHiding:n.search.isMatchStuckHiding(t)};if(s){if(d.paneItem=n.item,d.lines=[t.getStyledTextAsOneLine(!1,!1)],n.type===PaneMode.Gmail){var h=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail),f=t.getParsedText(),p=h.getIconForLabel(t);p&&(d.lines[0]='<span class="labelText hasIcon"><i class="c-foreground-light icon-'+p+'"></i>'+f+"</span>")}d.isOverviewAtTop=n.getOverview().isItemAtTop(t),d.isOverviewDragHover=n.getOverview().isItemDragHovered(t),d.isOverviewVisibleInPane=n.type===PaneMode.Task?n.getItem()!==n.getRootItem()&&n.isOverviewVisibleInPane(t):t===n.getItem(),d.isOverviewFocused=n.getItem()===t,d.isOverviewRoot=n.getRootItem()===t}else{var m=t.getAttachmentByPlugin(PluginID.Gmail);if(d.isEmailOpen=m&&(n.type===PaneMode.Gmail&&d.isSelected||m===l.a.getThreadAttach()&&l.a.isOpenOnPane(n)),d.lines=n.getStyledLinesForPaneObject(r.cell.paneObject,s,d.hasSelection),d.selected=d.selectedText=d.selectedStart=d.selectedEnd=void 0,o){var g=c.a.getSelectionAtIndex(a);!0===g?d.selected=!0:g.start!==g.end&&(d.selectedStart=g.start,d.selectedEnd=g.end)}else d.selectedText=void 0;t.isNote()&&(d.parentFlags=t.parent().flags,d.parentStyleProps=t.parent().styleProps(n))}return d.isHeader=n.isItemHeader(t,s),d},render:function(e,t,a,s,l,u,y,S,E){var P=l.pane,b=l.cell.paneObject,C=l.overview,D=(P.isWriteable,null),I=P.getPaddingForPaneObject(b,C),A=i.default.classNames("item c-foreground",S,u.styleProps,{"c-border-light ":!C},{"c-background":!C},{"overviewItem c-button-overview":C},{overviewAncestor:C&&u.isOverviewAncestor},{overviewFocused:C&&u.isOverviewFocused},{"c-background-overview-selected":C&&u.isOverviewVisibleInPane},{overviewRoot:C&&u.isOverviewRoot},{overviewAtTop:C&&u.isOverviewAtTop},{overviewDragHover:C&&u.isOverviewDragHover},{collapsed:u.isCollapsed},{itemBeingDragged:u.isBeingDragged},{faded:u.faded},{selected:!1},{"c-background-item-selected":u.isEmailOpen},{editable:D},{highlighted:u.isHighlighted&&P!==i.default.focusedPane},{firstItem:0===s},{hasSelection:u.hasSelection},{hasNote:u.hasNote},{hasPrefix:!!a.getPrefixLength()},{blockHeader:b.isBlockHeader},{"c-foreground-very-faded":b.isBlockHeader&&u.isCollapsed},{stuckMatch:u.isMatchStuckHiding},{checked:a.isComplete()},{swiping:!!E});if(C||(y=i.default.extend({fontSize:d.a.fontSizeForItem(a,P),lineHeight:d.a.lineHeightForItem(a,P)+"px"},y)),n.a.android&&D){var M={paddingLeft:I,height:y.height,paddingTop:d.a.paddingForItemTop(a,P),paddingRight:n.a.windowWidth()-P.maxWidthOfPaneObject(b)-I};return o.a.createElement("li",{"data-moo-id":t,className:A,style:y,ref:"li",contentEditable:D},o.a.createElement("textarea",{className:"androidInput",ref:"androidInput",style:M,defaultValue:a.getParsedText(),onInput:P.onInputAndroid,onChange:i.default.emptyFn}))}return o.a.createElement("li",{"data-moo-id":t,className:A,style:y,ref:"li",contentEditable:D},function(e,t,a,r,s){var l=r.lines,c=a.pane,u=a.overview,h=a.cell.paneObject,f=!u&&c.maxWidthOfPaneObject(h),v=[];try{i.default.PAssert(2674,l,"If an item is being rendered it must have styled lines")}catch(e){i.default.reportError(e)}if(l){try{i.default.PAssert(2675,!isNaN(s),"Should always have a valid number for padding")}catch(e){i.default.reportError(e)}var y={width:f};n.a.isFirefox||a.padInsteadOfTransformLines?y.marginLeft=s:u?y.paddingLeft=s:y[n.a.transform.react]="translateX("+s+"px)",u||t.isNote()?l=[l[0]||TextSpace]:f<i.default.MinItemWidth&&(l=["..."]);for(var S=0;S<l.length;++S){var E=i.default.classNames("line",{"c-bg-light":r.isBeingDragged},{first:0===S},{blockHeaderText:S===l.length-1&&h.isBlockHeader},{last:S===l.length-1}),P=l[S],b=i.default.extend({paddingTop:!u&&0===S&&g(t,h,c),paddingBottom:!u&&S===l.length-1&&d.a.paddingForItemBottom(t,c),height:!u&&d.a.lineHeightForItem(t,c)+"px",paddingLeft:m(h,c)},y);P=p(P,S,t,r),!a.overview&&c.isViewOutline()&&r.isHovered&&t.isPrefixHeader()&&!c.isSearchedFlat()&&S===l.length-1&&(P+='<span data-tooltip="Add new item to project" class="itemAddButton itemIgnoreText icon-add c-button" />'),c.isViewProject()&&h.isBlockHeader&&(P+='<span class="blockHeaderNumItems itemIgnoreText ns c-foreground-faded" data-num-items="'+h.block.items.length+'" />'),v.push(o.a.createElement("span",{className:E,key:"line_"+S,style:b,dangerouslySetInnerHTML:{__html:P}}))}}return v}(0,a,l,u,I),function(e,t,a,i,r){var n=a.pane;if(!a.overview&&t.shouldShowParents(a.cell.paneObject,n)){var s=t.parents(n.getItem()).map(function(e,t){return e.generateTitleText()}).join(" > "),l={paddingTop:d.a.paddingForItemTop(t,n),paddingLeft:r};return s&&o.a.createElement("div",{className:"itemParents c-foreground-very-faded",style:l,"data-tooltip":s},s)}}(0,a,l,0,I),function(e,t,a,i,r){if(i.showVerticalLines&&r>d.a.itemIndentStart(a.pane)){var n=a.pane.extraPaddingForPaneObject(a.cell.paneObject),s=d.a.itemIndentStart(a.pane)+n+6,l=r-s;if(l>0){var c={left:s,width:l};return o.a.createElement("div",{className:"vertLines",style:c})}}}(0,0,l,u,I),function(e,t,a,r,s){var l=a.pane,c=a.cell.paneObject,u=v(a);if(!a.overview&&l.supportMenuIcon&&r.isHovered&&!t.isNote()&&""!==t.getParsedText()&&(!l.isViewAgenda()||!l.shouldShowTime(a.cell.paneObject))){var h={width:s-5-(f(t,a,r)?u:0),paddingRight:u-20,height:d.a.lineHeightForItem(t,l)+"px",marginTop:g(t,c,l)+"px"},p=i.default.classNames("itemMenuIcon",{"c-foreground-super-faded c-color-hover":!r.isEmailOpen},{"c-background-item-selected":r.isEmailOpen}),m="<b>Drag</b> to move.<br><b>Click</b> to open menu.<br><b>"+n.a.priModKey+" + Click</b> to zoom in.";return o.a.createElement("div",{className:p,style:h,"data-tooltip":m},o.a.createElement("i",{className:"icon-drag-handle"}))}}(0,a,l,u,I),function(e,t,a,r,s){var l=a.overview,c=a.cell.paneObject,u=a.pane;if(r.isHovered&&""===t.getParsedText()){var h=i.default.classNames("emptyItemAddButton icon-add c-background c-shadow-light"),p={marginLeft:1===r.levelsDeep?-4:-12};return p[n.a.transform.react]="translateX("+(s-24)+"px)",o.a.createElement("div",{className:h,style:p})}if(f(t,a,r)){var m=i.default.classNames("collapser c-foreground-super-faded c-color-hover",{"collapsed icon-angle-right":r.isCollapsed},{"icon-angle-down":!r.isCollapsed}),y={left:s-5-v(a),lineHeight:!l&&d.a.lineHeightForItem(t,u)+"px",paddingTop:!l&&g(t,c,u)+"px"},S=(n.a.secModKey,"<b>Click</b> to "+(r.isCollapsed?"expand":"collapse")+" item.<br><b>"+n.a.priModKey+" + Click</b> to zoom in.");return o.a.createElement("div",{className:m,style:y,"data-tooltip":S})}}(0,a,l,u,I),function(e,t,a,r){var n,s,l=a.overview,d=a.pane;return l||t.isNote()?l&&r.isHovered&&d.supportClickOverviewScroll&&r.isOverviewVisibleInPane&&!r.isOverviewFocused&&(n=i.default.classNames("itemCheckbox c-button","itemOverviewZoom","icon-unfold_less"),s="Scroll to item"):d.supportCheckbox&&r.isHovered?n=i.default.classNames("itemCheckbox c-button","icon-check",{checked:t.isComplete()}):d.supportArchiving&&t.isArchived()&&(n=i.default.classNames("itemCheckbox c-button","itemUnarchive","icon-task"),s="Unarchive"),n&&o.a.createElement("div",{"data-tooltip":s,className:n,style:{}})}(0,a,l,u),C&&u.isHovered&&o.a.createElement("div",{className:"overviewOptions icon-more_horiz c-button"}),!C&&P.isViewAgenda()&&function(e,t,a){var r=a.pane,n=a.cell.paneObject;if(r.shouldShowTime(n)){var s=r.getItemDisplayTime(n),l=s.indexOf("<div")>=0,d=i.default.classNames("agendaTime cursor-grab",{twoLines:l},{allDay:"All day"===s}),c={paddingTop:g(t,n,r)+"px"};return o.a.createElement("div",{className:d,style:c,dangerouslySetInnerHTML:{__html:s}})}}(0,a,l),!C&&(u.selected||void 0!==u.selectedStart)&&function(e,t,a,s,l){var u=[],f=a.pane,p=a.cell.paneObject,g=f.maxWidthOfPaneObject(p);if(s.selected){var v={top:0,width:g,height:s.height};v[n.a.transform.react]="translateX("+l+"px)",u.push(o.a.createElement("span",{key:"selStart",className:"textSelected",style:v}))}else if(void 0!==s.selectedStart){var y,S=s.lines.reduce(function(e,t){return e+i.default.unescape(t).length},0),E=s.selectedStart,P=s.selectedEnd;E<0&&(E=0),P<0&&(P=S,y=!0);var b=h.a.getCaretOffset(p,f,E,c.a.preferLineStart),C=h.a.getCaretOffset(p,f,P,c.a.preferLineStart),D=d.a.paddingForItemTop(t,f),I=d.a.paddingForItemBottom(t,f),A=d.a.lineHeightForItem(t,f),M=!t.isNote()&&C.line>b.line,_=t.shouldShowParents(p,f)?r.a.HeightAgendaParents:0,T=b.line*A+(b.line>0?D:0)+_,w=C.line*A+D+_,k=A+(0===b.line?D:0)+(b.line===s.lines.length-1?I:0);if(b.lineOffset<b.lineLength||!M){var x={top:T,width:M||y?g-b.left:C.left-b.left,height:k,marginLeft:m(p,f)};x[n.a.transform.react]="translateX("+(b.left+l)+"px)",u.push(o.a.createElement("span",{key:"selStart",className:"textSelected",style:x}))}if(M){var L=w-T,O=A+(C.line===s.lines.length-1?I:0),R=y?g:C.left;if(L>=2*A){var N=w-k-T,F={top:T+A+(0===b.line?D:0),width:g,height:N};F[n.a.transform.react]="translateX("+l+"px)",u.push(o.a.createElement("span",{key:"selMid",className:"textSelected",style:F}))}var U={top:w,width:R,height:O};U[n.a.transform.react]="translateX("+l+"px)",u.push(o.a.createElement("span",{key:"selEnd",className:"textSelected",style:U}))}}return u}(0,a,l,u,I),E)}};t.a=y},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(8),l=a(24),d={onMount:function(e,t,a,i){e.listenTo(i.pane.dragHoveredBlock)},getState:function(e,t,a,i){return{isHovered:i.cell.paneObject.block===i.pane.dragHoveredBlock.get()}},onClickNewProject:function(e,t){var a=t.pane,i=a.getItem().numItems(),n=a.addItemToPane(r.a.Prefix.Header+" ",i),s=a.indexOfItem(n);o.a.selectIndex(s,0)},render:function(e,t,a,r,n,o,d,c){var u,h=a.block,f=h.isCollapsed(),p=i.default.classNames(c,"blockHeader noItem c-border-light flexbox",{blockHeaderDate:h.isDate},{"c-tag":n.pane.isViewTag()},{"c-contact":n.pane.isViewContact()},{agendaBlockRed:!f&&h.isOverdue},{dragHovered:o.isHovered},{"collapsed c-foreground-very-faded":f},{firstBlock:0===r}),m=i.default.classNames("blockCollapser c-foreground-super-faded",{"icon-angle-down":!f&&!h.isNewProject},{"icon-angle-right":f&&!h.isNewProject}),g={paddingBottom:l.a.paddingForBlockHeader()},v=s.a.createElement("span",{className:"blockHeaderNumItems c-foreground-faded"},h.numItems());if(h.isDate){var y,S=h.date,E=Date.today(),P=S.isToday()?"Today":S.isSameDay((new Date).clearTime().addDays(1))?"Tomorrow":S.toString("dddd"),b=i.default.classNames("blockHeaderText blockHeaderDayName f1 ib",{"c-foreground-light":!f});S.getMonth()===E.getMonth()&&S.getYear()===E.getYear()||(y=S.toString("MMMM"),b+=" diffMonth"),S.getYear()!==E.getYear()&&(y+=", "+S.toString("yyyy")),u=s.a.createElement(s.a.Fragment,null,s.a.createElement("span",{className:"blockHeaderDateNum"},S.getDate()),s.a.createElement("span",{className:b,style:g},P&&s.a.createElement("div",null,P,v),y&&s.a.createElement("div",{className:"blockHeaderMonth"},y)))}else if(h.isNewProject)u=s.a.createElement("span",{className:"blockHeaderText pointer f1 c-foreground-ultra-faded",style:g,onClick:this.onClickNewProject.bind(this,e,n)},"New project");else{var C=h.isStarred&&s.a.createElement("i",{className:"icon-star"})||h.isImportant&&s.a.createElement("i",null,"!");u=s.a.createElement("span",{className:"blockHeaderText f1",style:g},C,h.text,v)}return s.a.createElement("li",{ref:"li","data-moo-id":t,className:p,style:d},s.a.createElement("span",{className:m,onClick:h.toggleCollapsed}),u)}};t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(2),n=a.n(r),s={render:function(e,t,a,r,s,o,l){var d=i.default.classNames("hr c-border-heavy",s.className);return n.a.createElement("li",{"data-moo-id":t,className:d,style:l},a.text)}};t.a=s},function(e,t,a){"use strict";var i=a(0),r=a(2),n=a.n(r),s=(a(8),{onClick:function(e,t){var a=t.block;a.addFn(a)},render:function(e,t,a,r,s,o,l,d){d=i.default.classNames(d,"taskAddButton");var c=a.block;return n.a.createElement("li",{ref:"li","data-moo-id":t,className:d,style:l},!c.noAddButton&&n.a.createElement("div",{className:"c-foreground-ultra-faded",onClick:this.onClick.bind(this,e,a,r)},n.a.createElement("i",{className:"icon-add"}),"Add item"))}});t.a=s},function(e,t,a){"use strict";var i=a(0),r=a(2),n=a.n(r),s=a(182),o={getState:function(e,t,a,i){return{paneRect:i.pane.rect}},render:function(e,t,a,r,o,l,d){var c,u=o.pane,h=i.default.classNames("calendarWeek c-bg-app","flexbox",o.className),f=u.getWidth()+1,p=Math.floor(f/7),m=f-7*p,g=0,v=0;m>0&&(g=Math.ceil(m/2),v=m-g),d.height+=1;for(var y=0;y<a.dates.length;y++){var S=a.dates[y];S&&1===(S=S.date).getDate()&&(c=S.toString("MMMM"),S.getYear()!==Date.today().getYear()&&(c+=S.toString(" yyyy")))}return n.a.createElement("li",{"data-moo-id":t,className:h,style:d},a.dates.map(function(e,t){var a=p+(0===t?g:0)+(6===t?v:0);return n.a.createElement(s.a,{key:e.date.getTime(),pane:u,date:e.date,items:e.items,index:t,left:t*p+(t>0?g:0),width:a})}),c&&n.a.createElement("div",{className:"calendarMonthTitle c-bg-app"},c))}};t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(11),d=(a(7),a(13)),c=(a(10),a(20),a(18)),u=a(46),h=o.a.createClass({displayName:"ReactMonthDay",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){l.a.listen("endDrag",this.onDragEnd),this.createObservables({isHovered:!1}),this.listenToDispatcher("dateChanged")},arePropsEqual:function(e,t,a){return"items"===e?t===a||t&&a&&t.length===a.length:"date"===e?t===a||t&&a&&t.equals(a):void 0},areStatesEqual:function(e,t,a){if("items"===e){if(!t||!a||t.length!==a.length)return!1;for(var i=0;i<t.length;i++)if(t[i].time!==a[i].time||t[i].item!==a[i].item)return!1;return!0}},componentWillReceiveProps:function(e){e.items!==this.props.items&&this.updateState(e)},getState:function(e){var t={};if(e.items){for(var a=[],i=[],r=0;r<e.items.length;r++){var n=e.items[r];if(!n.isNote()){var s=n.date()||n.repeatDate()&&n.repeatDate().getStartDate(),o=s.hasTimeOfDay()&&s.toString(d.a.getFormat(DFormat.ShortTime));o?i.push({time:o,item:n}):a.push({item:n})}}t.items=a.concat(i)}return t},onMouseDown:function(e){e.preventDefault()},onMouseEnter:function(){if(c.a.isDragging){this.isHovered.set(!0);var e=c.a.dragItem.date();c.a.setBlockTarget({date:this.props.date,dateTime:e&&e.hasTimeOfDay()&&e,isDate:!0})}},onDragEnd:function(){this.isHovered.set(!1)},onMouseLeave:function(){this.isHovered.set(!1)},onDoubleClick:function(e){var t=this.props,a=t.pane,i=t.date,r=a.item.get(),n=d.a.getAppendDateText(i);a.openItemEditor({element:e.target,text:" @"+n,parent:r,selectIndex:0,pos:{top:e.clientY},addOnSave:!0})},render:function(){var e,t=this.props,a=this.state,n=t.date,o=0===n.getDay()||6===n.getDay(),l=n.getDate(),d=Date.getDaysInMonth(n.getFullYear(),n.getMonth()),c=i.default.classNames("dateBlock c-border",{firstDay:1===n.getDate()},{lastDay:n.getDate()===d},{"weekend c-bg-faded":o},{"c-background":!o},{hoveredInDrag:a.isHovered},{today:n.isToday()}),h={left:t.left-1,width:t.width+1},f=i.default.classNames("dateBlockDay");if(a.items){for(var p=[],m=!1,g=0;g<a.items.length;g++){(v=a.items[g]).time&&v.item.hasAttachmentType(r.a.PluginType.Calendar)&&(m=!0)}for(g=0;g<a.items.length;g++){var v,y=(v=a.items[g]).time,S=v.item,E=m&&y,P=i.default.classNames("dateBlockItem flexbox",{hasCircle:E}),b=null;if(E){var C={background:S.hasAttachmentType(r.a.PluginType.Calendar)&&S.getCalendarColor()};b=s.a.createElement("div",{className:"monthItemColorCircle",style:C})}p.push(s.a.createElement("div",{className:P,key:S.id},b,s.a.createElement(u.a,{className:"itemInCalendar",item:S,pane:t.pane,coloredInCalendar:!y&&S.getCalendarColor(),showPriority:!0,allowDrag:!0,editOnClick:!0}),y&&t.width>100&&s.a.createElement("span",{className:"itemTime"},y)))}e=(t.items||a.isHovered)&&s.a.createElement("div",{className:"dateBlockItems"},p)}return s.a.createElement("div",{className:c,style:h,onMouseDown:this.onMouseDown,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onDoubleClick:this.onDoubleClick},s.a.createElement("div",{className:f},l),e)}});t.a=h},function(e,t,a){"use strict";var i=a(0),r=a(4),n=a(2),s=a.n(n),o=a(184),l={getState:function(e,t,a,i){return{numAllDay:i.pane.numAllDay}},render:function(e,t,a,n,l,d,c){var u=l.pane,h=i.default.classNames("calendarDay",l.className);return s.a.createElement(o.a,{"data-moo-id":t,component:"li",className:h,date:a.date,items:a.items,pane:u,height:c.height,transform:c[r.a.transform.react],width:u.getDayWidth()})}};t.a=l},function(e,t,a){"use strict";var i=a(1),r=a(0),n=a(4),s=a(13),o=a(2),l=a.n(o),d=a(3),c=(a(20),a(18)),u=a(46),h=(a(93),a(32),d.a.createClass({displayName:"ReactCalendarDay",componentDisplay:i.a.ComponentDisplay.Desktop,init:function(){this.createObservables({hoveredTime:void 0,hoveredDuration:void 0,isResizing:!1}),this.listenToDispatcher("dateChanged"),this.listenToDispatcher("endDrag")},arePropsEqual:function(e,t,a){return"items"===e?t===a||t&&a&&t.length===a.length:"date"===e?t===a||t&&a&&t.equals(a):void 0},areStatesEqual:function(e,t,a){if("items"===e){if(!t||!a||t.length!==a.length)return!1;for(var i=0;i<t.length;i++)if(!t[i].date.equals(a[i].date)||t[i].item!==a[i].item||t[i].duration!==a[i].duration)return!1;return!0}},componentWillReceiveProps:function(e){e.date.equals(this.props.date)&&e.items===this.props.items||this.updateState(e)},getState:function(e){var t=e.date.isToday(),a={isToday:t,todayTime:t&&new Date,numAllDay:e.pane.numAllDay};if(a.heightHeader=e.pane.getHeightAllDay(),e.items){a.items=[];for(var i=0;i<e.items.length;i++){var r=e.items[i];if(!r.isNote()){var n=r.date()||r.repeatDate()&&r.repeatDate().getStartDate();a.items.push({date:n,duration:r.getDuration(),item:r})}}}return a},componentDidMount:function(){this.state.isToday&&this.runTimeTimer()},onUnmount:function(){clearTimeout(this.timeTimeout)},componentDidUpdate:function(e){this.props.date.equals(e.date)||(this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0))},onBeforeChanged:function(e,t){return e.isToday?this.runTimeTimer():t.isToday&&!e.isToday&&clearTimeout(this.timeTimeout),!t.hoveredTime||c.a.isDragging||this.resizing||(this.hoveredTime.set(void 0,!1),this.hoveredDuration.set(void 0,!1),e.hoveredTime=void 0,e.hoveredDuration=void 0),e},runTimeTimer:function(){clearTimeout(this.timeTimeout),this.timeTimeout=setTimeout(this.updateState,3e5)},resetHovered:function(){this.resizing&&(this.resizing.component&&this.resizing.component.stopResizing(),this.resizing=void 0,this.isResizing.set(!1)),this.mouseDownAtTime=void 0,this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0)},onMouseUp:function(e){document.removeEventListener("mouseup",this.onMouseUp),this.resizing&&this.resizing.placeholder?this.addTime(this.hoveredTime.get(),this.hoveredDuration.get(),e):this.resetHovered()},onMouseLeave:function(){this.resizing||this.resetHovered()},getTimeFromMouseEvent:function(e){var t=e.clientY;return c.a.isDragging&&c.a.startPane&&c.a.startPane.isViewDates()&&c.a.startInfo&&(t+=12-(c.a.startInfo.y-c.a.position.top)),t-=r.default.findParent(e.target,"calendarDayTimes").getBoundingClientRect().top,Math.floor(t/(i.a.CalendarDayViewBlockHeight+1)*4)/4},onMouseDown:function(e){document.addEventListener("mouseup",this.onMouseUp),r.default.hasClass(e.target,"calendarDayTimes")&&(this.mouseDownAtTime=this.getTimeFromMouseEvent(e)),e.preventDefault()},onMouseMove:function(e){if(void 0!==this.mouseDownAtTime&&(this.resizing={placeholder:!0,pivot:this.mouseDownAtTime},this.mouseDownAtTime=void 0),c.a.isDragging){var t=this.getTimeFromMouseEvent(e);if(!isNaN(t)){var a=1,n=c.a.dragItem;n&&n.getDuration()&&(a=n.getDuration()/i.a.MSPerHour),this.hoveredDuration.set(a,!1),this.hoveredTime.set(t),(u=this.props.date.clone()).setHours(Math.floor(t)),u.setMinutes(60*(t-Math.floor(t))),c.a.setBlockTarget({date:u,dateTime:u,duration:1!==a?a:null,isDate:!0})}}else if(this.resizing){t=this.getTimeFromMouseEvent(e);if(!isNaN(t)){var s=this.resizing,o=s.pivot,l=t>=o?o:t,d=Math.floor(4*(t>=o?t-o+.5:o-t))/4;if(!isNaN(l)&&d>=.25)if(s.item){var u,h={isDate:!0};(u=this.props.date.clone()).setHours(Math.floor(l)),u.setMinutes(Math.round(60*(l-Math.floor(l)))),h.duration=d,h.date=h.dateTime=u,r.default.vmMain.beginUpdateItems();var f=this.props.pane;f.applyDropOnBlock(h,s.item,f),r.default.vmMain.commitUpdateItems()}else s.placeholder&&(d===this.hoveredDuration.get()&&l===this.hoveredTime.get()||(this.hoveredDuration.set(d,!1),this.hoveredTime.set(l,!0)))}}},onMouseEnterAllDay:function(){if(c.a.isDragging){var e=this.props.date;this.hoveredDuration.set(1,!1),this.hoveredTime.set(-1),c.a.setBlockTarget({date:e,isDate:!0,allDay:!0})}},onDoubleClickTimes:function(e){var t=this.getTimeFromMouseEvent(e);this.addTime(t,1,e)},addTime:function(e,t,a){var i=this.props,r=i.pane,n=i.date,o=r.item.get(),l=s.a.getAppendDateText(n,e,t);r.openItemEditor({element:a.target,text:" @"+l,parent:o,selectIndex:0,pos:{left:a.clientX,top:a.clientY},addOnSave:!0,onClosed:this.resetHovered})},onItemResizeStart:function(e,t,a){if(e.hasTime()){var n=e.getTimeOfDay(),s=e.getDuration()/i.a.MSPerHour||1,o=r.default.round(n/i.a.MSPerHour,4),l=a?o:o+s;return this.resizing={item:e,component:t,pivot:l},this.isResizing.set(!0),!0}},addToDay:function(e,t,a,i){e.push({t:t,dur:a,item:i,top:t,bottom:t+a,obj:i})},packItems:function(e){e=e.sort(function(e,t){return e.top<t.top?-1:e.top>t.top?1:e.bottom<t.bottom?-1:e.bottom>t.bottom?1:0});for(var t=[],a=[],i=null,r=0;r<e.length;r++){var n=e[r];if(n.isPlaceholder)a=a.concat.apply(a,this.packEvents([[n]]));else{null!==i&&n.top>=i&&(this.packEvents(t),a=a.concat.apply(a,t),t=[],i=null);for(var s=!1,o=0;o<t.length;o++){var l=t[o];if(!this.collidesWith(l[l.length-1],n)){l.push(n),s=!0;break}}s||t.push([n]),(null===i||n.bottom>i)&&(i=n.bottom)}}return t.length>0&&(this.packEvents(t),a=a.concat.apply(a,t)),a},packEvents:function(e){for(var t=e.length,a=0;a<t;a++)for(var i=e[a],r=0;r<i.length;r++){var n=i[r],s=this.expandEvent(n,a,e);n.pos=a/t*95,n.width=95*s/t}return e},collidesWith:function(e,t){return e.bottom>t.top&&e.top<t.bottom},expandEvent:function(e,t,a){for(var i=1,r=t+1;r<a.length;r++){for(var n=a[r],s=0;s<n.length;s++){var o=n[s];if(this.collidesWith(e,o))return i}i++}return i},renderItems:function(){var e,t=this.props,a=this.state,n=a.items,s=[],o=a.hoveredTime,d=a.hoveredDuration;for(e=0;e<n.length;e++){var c=n[e].item,h=t.pane.getItemPlacementOnDate(c,t.date);h&&this.addToDay(s,h.time,h.duration,c)}isNaN(o)||isNaN(d)||s.push({t:o,dur:d,top:o,bottom:o+d,isPlaceholder:!0});var f,p=this.packItems(s);if(p.length)for(f=[],e=0;e<p.length;e++){var m=p[e],g=m.isPlaceholder,v=this.props.pane,y={height:m.dur*i.a.CalendarDayViewBlockHeight+Math.ceil(m.dur),left:g?0:m.pos+"%",width:g?"95%":m.width+"%",top:Math.floor(m.t*(i.a.CalendarDayViewBlockHeight+1))},S=r.default.classNames("dayTimeBlock abs",{placeholder:g});f.push(l.a.createElement("div",{className:S,key:g?"placeholder":m.item.id,style:y},m.item&&l.a.createElement(u.a,{className:"itemInCalendar itemInCalendarResizable",item:m.item,pane:v,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}return f},renderItemsAllDay:function(){for(var e=this.props,t=this.state,a=t.items,i=e.pane,r=[],n=t.hoveredTime,s={},o=0;o<a.length;o++){var d=a[o].item;e.pane.getItemPlacementOnDate(d,e.date)||r.push(l.a.createElement("div",{className:"dayTimeBlock",key:d.id,style:s},l.a.createElement(u.a,{className:"itemInCalendar",item:d,pane:i,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}return!isNaN(n)&&n<0&&r.push(l.a.createElement("div",{className:"dayTimeBlock placeholder",key:"placeholder"})),r},render:function(){var e,t,a,s,o,d,c=this.props,u=this.state,h=(c.pane,c.date),f=0===h.getDay()||6===h.getDay(),p=this.renderItemsAllDay();if(u.isToday){var m=u.todayTime,g={top:Math.floor((m.getHours()+m.getMinutes()/60)*(i.a.CalendarDayViewBlockHeight+1))};d=l.a.createElement("div",{className:"calendarDayTimeLine",style:g})}e={width:c.width},t={top:u.heightHeader+30+3,height:c.height-u.heightHeader,width:c.width},a={height:u.heightHeader,minHeight:u.heightHeader},e[n.a.transform.react]=t[n.a.transform.react]=c.transform;var v=r.default.classNames("allDay c-border-heavy f1 preventScrollPropagate",{"c-bg-faded weekend":f}),y=r.default.classNames("calendarDayTimes c-border-heavy",{"c-bg-faded":f});s=l.a.createElement("ul",{className:v,style:a,onMouseEnter:this.onMouseEnterAllDay,onDoubleClick:this.addTime.bind(this,void 0,void 0),onMouseLeave:this.onMouseLeave},p),o=l.a.createElement("div",{className:y,style:t,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onDoubleClick:this.onDoubleClickTimes,onMouseLeave:this.onMouseLeave},l.a.createElement("div",{className:"calendarDayGradient"}),this.renderItems(),d);var S,E={className:r.default.classNames("calendarDay",{"weekend c-bg-faded":f},{today:u.isToday},{resizing:u.isResizing},c.className),"data-moo-id":c["data-moo-id"]};return h.getYear()!==Date.today().getYear()&&(S=h.toString(", yyyy")),l.a.createElement(c.component,E,l.a.createElement("div",{className:"calendarDayHeader c-background c-border-heavy flexbox flexvert",style:e},l.a.createElement("div",{className:"dayTitle"},l.a.createElement("span",null,h.toString("ddd MMM ")),l.a.createElement("span",{className:"dayTitleDay"},h.getDate()),S&&l.a.createElement("span",null,S)),s),o)}}));t.a=h},function(e,t,a){"use strict";var i=a(0),r=a(4),n=a(1),s=a(2),o=a.n(s),l=a(8),d=a(3),c=a(6),u=d.a.createClass({displayName:"ReactFormattingToolbar",componentDisplay:n.a.ComponentDisplay.Desktop,getState:function(){return{position:l.a.itemHighlightPosition,pane:l.a.getPane(),numSelected:l.a.getSelectedItems().length}},onClickFormat:function(e){i.default.vmMain.applyFormatToSelection(e)},onClickPrefix:function(e){i.default.vmMain.applyPrefixToSelection(e)},onClickNote:function(){var e=l.a.getStartItem();e&&e.editNote()},onClickLink:function(){l.a.getStartItem().insertLinkAtSelection()},render:function(){var e=this.state,t=this.props,a=r.a.priModKey,i=e.position;if(e.position&&e.pane===t.pane){var s=Math.min(Math.max(Math.floor(i.x),139),e.pane.getWidth()-135-4),l={height:36,width:270,marginLeft:-135};return l[r.a.transform.react]="translate3d("+s+"px,"+Math.floor(i.y)+"px,0)",o.a.createElement("div",{className:"formattingToolbar c-popup c-bg-sidebar c-shadow-popup",style:l},o.a.createElement(c.a,{icon:"icon-format_bold",width:32,height:36,iconSize:19,onClick:this.onClickFormat.bind(this,"**"),tooltip:"Bold",tooltipHotkey:a+" + B"}),o.a.createElement(c.a,{icon:"icon-format_italic",width:32,height:36,iconSize:19,onClick:this.onClickFormat.bind(this,"*"),tooltip:"Italic",tooltipHotkey:a+" + I"}),o.a.createElement("div",{className:"divider"}),o.a.createElement(c.a,{icon:"icon-hash",width:32,height:36,iconSize:18,onClick:this.onClickPrefix.bind(this,n.a.Prefix.Header),tooltip:"Project",tooltipHotkey:n.a.Prefix.Header+"&nbsp;&nbsp; Space"}),o.a.createElement(c.a,{icon:"prefixTask",width:32,height:36,iconSize:20,onClick:this.onClickPrefix.bind(this,n.a.Prefix.Task),tooltip:"Task",tooltipHotkey:n.a.Prefix.Task+"&nbsp;&nbsp; Space"}),o.a.createElement(c.a,{icon:"icon-bullet",width:32,height:36,iconSize:26,onClick:this.onClickPrefix.bind(this,n.a.Prefix.Bullet),tooltip:"Bulleted list",tooltipHotkey:n.a.Prefix.Bullet+"&nbsp;&nbsp; Space"}),o.a.createElement(c.a,{icon:"icon-numlist",width:32,height:36,iconSize:14,onClick:this.onClickPrefix.bind(this,n.a.Prefix.NumList),tooltip:"Numbered list",tooltipHotkey:n.a.Prefix.NumList+"&nbsp;&nbsp; Space"}),o.a.createElement("div",{className:"divider"}),o.a.createElement(c.a,{icon:"icon-link",enabled:1===e.numSelected,width:32,height:36,iconSize:18,onClick:this.onClickLink,tooltip:"Create link",tooltipHotkey:a+" + K"}),o.a.createElement(c.a,{icon:"icon-sticky-note-o",enabled:1===e.numSelected,width:32,height:36,iconSize:14,onClick:this.onClickNote,tooltip:"Add note",tooltipHotkey:"Shift + Enter"}))}return null}});t.a=u},function(e,t,a){"use strict";var i=a(1),r=a(0),n=a(2),s=a.n(n),o=a(3),l=a(4),d=a(62),c=a(93),u=a(187),h=a(6),f=i.a.TaskViewMode,p=o.a.createClass({displayName:"ReactPaneTask",componentDisplay:i.a.ComponentDisplay.Everywhere,init:function(){this.listenToDispatcher("dateChanged");var e=r.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar);e.onSettingChanged(e.Settings.IsEnabled,this.updateState),this.listenToSetting(Settings.dayWeekStart)},getState:function(){var e=this.props.pane,t=r.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar);return{rect:e.rect,hasCollapsed:e.hasCollapsedObs,_allowCollapsingObs:e.search.getFilter("showOnlyMatches"),allowCollapsing:!e.search.getFilterValue("showOnlyMatches"),viewState:e.viewState,viewMode:e.getViewMode(),isCalendarView:e.isViewCalendar(),hasPremiumFeatures:r.default.billingManager.hasPremiumFeaturesObservable,date:(new Date).getDate(),isGCalEnabled:t.isEnabled(),dayWeekStart:r.default.settings.get(Settings.dayWeekStart)}},onClickToday:function(){this.props.pane.scrollToToday(ScrollDuration.Default)},onClickJumpBack:function(){this.props.pane.scrollJump(-1,ScrollDuration.Default)},onClickJumpForward:function(){this.props.pane.scrollJump(1,ScrollDuration.Default)},onClickAddItem:function(e){this.props.pane.addItemWithPrefix(void 0,e)},onClickAddItemPopup:function(e){this.props.pane.openItemEditor({element:e.target,addOnSave:!0})},onClickViewMode:function(e){this.props.pane.setViewMode(e)},render:function(){var e,t,a,n=this.state,o=this.props.pane,p=this.state.viewMode,m=i.a.TaskViewModeText[p],g=n.rect.width>550,v=i.a.PaneHeaderButtonWidth,y=i.a.PaneHeaderButtonHeight,S=r.default.classNames(n.isCalendarView?"calendar"+i.a.TaskViewModeText[p]+"View c-background":"",{showingButtons:n.isCalendarView}),E=n.hasCollapsed,P=(E?"Uncollapse":"Collapse")+" all items in view",b=l.a.secModKey+" + Shift + .",C=o.isViewAgenda()&&[f.Agenda_Today,f.Agenda_Week,f.Agenda_All]||o.isViewCalendar()&&[f.Calendar_Day,f.Calendar_Week,f.Calendar_Month],D=s.a.createElement(u.a,{day:this.state.date,height:22,width:22,onClick:this.onClickToday});return a=s.a.createElement("div",{key:"headerButtons"},o.isViewDates()&&s.a.createElement("div",{className:"calendarButtons"},o.isViewCalendar()&&s.a.createElement("div",{className:"borderButtons ib c-border-light"},s.a.createElement(h.a,{icon:"icon-caret-left",width:g?20:14,height:22,onClick:this.onClickJumpBack,enabled:n.isCalendarView,tooltip:"Previous "+m}),D,s.a.createElement(h.a,{icon:"icon-caret-right",width:g?20:14,height:22,onClick:this.onClickJumpForward,enabled:n.isCalendarView,tooltip:"Next "+m})),o.isViewAgenda()&&D,g&&s.a.createElement("div",{className:"viewModeButtons borderButtons ib c-border-light"},C.map(function(e){return s.a.createElement(h.a,{height:22,selected:n.viewMode===e,onClick:this.onClickViewMode.bind(this,e),key:e},i.a.TaskViewModeText[e])}.bind(this)))),o.supportCollapsing&&!o.isViewCalendar()&&s.a.createElement(h.a,{icon:E?"icon-angle-down":"icon-angle-right",iconSize:16,width:v,height:y,onClick:o.toggleCollapseAll.bind(o),tooltip:P,tooltipHotkey:b,enabled:n.allowCollapsing})),o.isViewCalendar()?e=p===f.Calendar_Month?s.a.createElement("div",{className:"calendarMonthDays belowHeader c-background c-border-heavy flexbox",key:"overlay"},0===n.dayWeekStart&&s.a.createElement("div",null,"SUN"),s.a.createElement("div",null,"MON"),s.a.createElement("div",null,"TUE"),s.a.createElement("div",null,"WED"),s.a.createElement("div",null,"THU"),s.a.createElement("div",null,"FRI"),s.a.createElement("div",null,"SAT"),1===n.dayWeekStart&&s.a.createElement("div",null,"SUN")):s.a.createElement(c.a,{pane:o,key:"overlay",trackPane:!0,showAllDay:!0}):o.isViewAgenda()?t=s.a.createElement("div",{className:"flexbox flex-center addItemButton c-foreground-very-faded"},s.a.createElement(h.a,{onClick:this.onClickAddItemPopup},"Add Item")):(o.isViewOutline()||o.isViewProject())&&(t=s.a.createElement("div",{className:"flexbox flex-center addItemButton c-foreground-very-faded"},s.a.createElement(h.a,{icon:"icon-edit",iconSize:14,width:44,onClick:this.onClickAddItem.bind(this,""),tooltip:"Add item"}),s.a.createElement(h.a,{icon:"icon-hash",iconSize:14,width:44,onClick:this.onClickAddItem.bind(this,i.a.Prefix.Header),tooltip:"Add project"}),s.a.createElement(h.a,{icon:"icon-check",iconSize:14,width:44,onClick:this.onClickAddItem.bind(this,i.a.Prefix.Task),tooltip:"Add task"}),s.a.createElement(h.a,{icon:"icon-bullet",iconSize:20,width:44,onClick:this.onClickAddItem.bind(this,i.a.Prefix.Bullet),tooltip:"Add bullet"}),s.a.createElement(h.a,{icon:"icon-numlist",iconSize:12,width:44,onClick:this.onClickAddItem.bind(this,i.a.Prefix.NumList),tooltip:"Add numbered list"}))),s.a.createElement(d.a,{pane:o,itemsObs:this.itemsObs,className:S,minItemHeight:20},e,t&&s.a.createElement("div",{key:"topBox"},t),a,void 0)}});t.a=p},function(e,t,a){"use strict";var i=a(1),r=(a(0),a(2)),n=a.n(r),s=a(3),o=a(6),l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},d=s.a.createClass({displayName:"FancyCalendarDayButton",componentDisplay:i.a.ComponentDisplay.Desktop,render:function(){return n.a.createElement(o.a,l({},this.props,{className:"fancyCalendarDayButton",iconSize:16,padding:0,tooltip:"Jump to Today",icon:"icon-calendar-o",center:!0}),this.props.day)}});t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(3),l=(a(20),a(28)),d=a(62),c=a(12),u=a(30),h=a(16),f=a(6),p=o.a.createClass({displayName:"ReactPaneGmail",componentDisplay:r.a.ComponentDisplay.Everywhere,componentDidMount:function(){this.listenTo(this.props.pane.search.onChanged)},getState:function(){var e=this.props.pane;return e.isDestroyed()?{}:{rootItem:e.item,messages:l.a.messages,isActivePane:l.a.activePane===e,viewState:e.viewState,viewMode:e.getViewMode()}},onHoldViewButton:function(e){i.default.menus.openContextMenu({fn:this.renderContextMenuSort,element:e.target})},onClickViewButton:function(){var e=this.state.viewMode===r.a.GmailViewMode.Priority?r.a.GmailViewMode.Date:r.a.GmailViewMode.Priority;this.setViewMode(e),i.default.menus.closeContextMenu()},renderContextMenuSort:function(e){return s.a.createElement(c.a,{key:"contextMenuGmailSort",id:"contextMenuGmailSort",element:e.element},s.a.createElement(u.a,null,"Sort by"),s.a.createElement(h.a,{icon:"icon-access_time",onClick:this.setViewMode.bind(this,r.a.GmailViewMode.Date)},r.a.GmailViewMode.Date),s.a.createElement(h.a,{icon:"icon-exclamation",onClick:this.setViewMode.bind(this,r.a.GmailViewMode.Priority)},r.a.GmailViewMode.Priority))},setViewMode:function(e){this.props.pane.setViewMode(e)},renderViewButton:function(){var e=this.state.viewMode===r.a.GmailViewMode.Date?"icon-access_time":"icon-exclamation";return s.a.createElement(f.a,{key:"sort",tooltip:"Sort Order",icon:e,iconSize:14,width:r.a.PaneHeaderButtonWidth,height:r.a.PaneHeaderButtonHeight,onClick:this.onClickViewButton,onHold:this.onHoldViewButton})},render:function(){this.props.pane;return s.a.createElement(d.a,{key:"pane",pane:this.props.pane,minItemHeight:i.default.minItemHeight},s.a.createElement("div",{key:"headerButtons"},this.renderViewButton()))}});t.a=p},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=a(18),c=a(46),u=a(6),h=l.a.createClass({displayName:"ReactDragDrop",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){var e=d.a,t=(i.default.vmMain.paneManager,{items:e.draggingItems,activePane:e.activePane,pane:e.startPane,position:e.position,transform:e.transform,isDragging:e.isVisible,linePosition:e.linePosition,fromOverview:e.fromOverview,dropBucketItems:i.default.vmMain.dropBucket.getItems(),onlineText:i.default.vmMain.onlineText(),contextMenus:i.default.menus.contextMenuStack});return t},onClickDropBucket:function(){this.state.dropBucketItems.length>0&&i.default.menus.toggleContextMenu({componentName:"ReactContextMenuDropBucket",position:"bottom",pane:i.default.focusedPane})},onClickCancelDragToOutline:function(){d.a.stopDraggingToOutline()},render:function(){var e,t,a,r,s=this.state,l=s.pane,d=s.items;if(l&&s.isDragging){for(var h=[],f=0;f<d.length;f++)h[f]=s.pane.getPaddingForPaneObject(d[f])-8;if(d&&d.length>0&&s.position&&s.transform){var p=[],m=Math.min(d.length,10);for(f=0;f<m;++f){var g=h[f];p.push(o.a.createElement(c.a,{key:"drag_"+f,pane:l,item:d[f].item,paneObject:d[f],renderLikePane:!0,noNotes:s.fromOverview,padding:g}))}var v=d.length-m;v>0&&p.push(o.a.createElement("div",{className:"dotdotdot",key:"dotdotdot"},"... plus "+v+" more ..."));var y=s.position,S={left:y.left+8,top:y.top,width:l.widthOfDrag(d[0]),maxWidth:l.getWidth()},E=s.transform;S[n.a.transform.react]="translate3d("+E.left+"px, "+E.top+"px, 0)",e=o.a.createElement("ul",{id:"dragUL",style:S,className:"popup c-shadow-popup c-background"},p)}if(s.linePosition&&s.activePane){var P=s.linePosition,b={width:P.width,height:P.height},C=i.default.classNames({isLine:!P.height});b[n.a.transform.react]="translate("+P.left+"px, "+P.top+"px)",t=o.a.createElement("div",{id:"dragLine",style:b,className:C})}r=i.default.classNames("from_"+l.type,s.activePane.paneClass)}s.pane,i.default.focusedPane;var D,I,A=s.dropBucketItems,M=s.onlineText?60:44,_={top:s.dropBucketTop,bottom:!s.dropBucketTop&&M+24},T=i.default.classNames("dragTarget mobileDropBucket",{showIcon:!0},{hovered:"dragToSave"===s.dragTargetHovered});i.default.classNames("dragTarget mobileDragToOutline",{hovered:"dragToOutline"===s.dragTargetHovered});A.length>0&&!i.default.menus.isContextMenuOpen()&&(D=o.a.createElement(u.a,{width:50,height:50,color:"white",iconSize:20,style:_,key:"bucket",className:T,onClick:this.onClickDropBucket,enabled:i.default.focusedPane&&i.default.focusedPane.type===PaneMode.Task},o.a.createElement("span",{className:"bucketIcon"},o.a.createElement("i",{className:"icon-content_paste"}),A.length>0&&o.a.createElement("div",null,A.length)))),a=o.a.createElement("div",{className:"dragTargets"},D,I);var w=s.draggingToOutline&&o.a.createElement("div",{className:"draggingToOutlineArea flexbox"},o.a.createElement("div",{className:"f1"},"Tap a destination for this email"),o.a.createElement(u.a,{color:"white",height:60,onClick:this.onClickCancelDragToOutline},"CANCEL"));return o.a.createElement("div",{id:"dragdrop",className:r},e,t,w,a)}});t.a=h},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(41),l=(a.n(o),a(3)),d=a(18),c={ReactContextMenuOverviewOptions:a(191),ReactContextMenuGmailSort:a(192),ReactContextMenuSearch:a(193),ReactContextMenuNameBoard:a(196),ReactContextMenuSelectGmailAccount:a(197),ReactContextMenuAddItem:a(198),ReactContextMenuCalendars:a(199),ReactContextMenuInsertLink:a(200),ReactContextMenuContactDetails:a(201),ReactNotePopup:a(202),ReactContextMenuDropBucket:a(203),ReactItemDetailsPopup:a(204),ReactContextMenuEmailDetails:a(206),ReactContextMenuItem:a(207),ReactContextMenuOnlineStatus:a(208),ReactContextMenuPanes:a(96),ReactContextMenuAuthorize:a(209),ReactContextMenuDocuments:a(210),ReactContextMenuHelp:a(212),ReactContextMenuShare:a(213),ReactContextMenuPaneMode:a(214),ReactContextMenuOptions:a(215)},u=l.a.createClass({displayName:"ReactContextMenus",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){return{contextMenus:i.default.menus.contextMenuStack,noFade:i.default.menus.contextMenuNoFade,isDragging:d.a.isVisible}},onClickBackground:function(e){var t=i.default.menus.getTopContextMenu();i.default.menus.closeContextMenu(t),i.default.preventDefault(e),i.default.stopPropagation(e)},render:function(){for(var e=this.state,t=[],a=0;a<e.contextMenus.length;a++){var r=e.contextMenus[a];if(r.noBackdrop||t.push(s.a.createElement("div",{key:"backdrop_"+a,className:"contextMenusBackdrop",onMouseDown:this.onClickBackground})),r.fn)t.push(r.fn(r));else if(r.componentName){r.key=r.key||r.componentName,r.id=r.id||r.key;var n=c[r.componentName].default;t.push(s.a.createElement(n,r))}}var l=i.default.classNames("contextMenusReact",{open:t.length>0},{takeClick:t.length>0&&!r.noBackdrop},{none:0===t.length},{hideBackground:e.noFade});return s.a.createElement(o.CSSTransitionGroup,{className:l,transitionName:"contextMenuAnim",transitionEnterTimeout:150,transitionLeaveTimeout:200},t)}});t.a=u},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(8),d=a(12),c=a(16),u=o.a.createClass({displayName:"ReactContextMenuOverviewOptions",componentDisplay:r.a.ComponentDisplay.Desktop,onClickScroll:function(){var e=this.props;e.pane.overview.scrollItemIntoView(e.item)},onClickAddSubproject:function(){var e=this.props;i.default.vmMain.zoomin(e.item),e.pane.addProject()},onClickZoom:function(){this.props.item.canZoom()&&(l.a.setFocusedPane(this.props.pane),i.default.vmMain.zoomin(this.props.item))},render:function(){this.props.pane;return s.a.createElement(d.a,{key:"contextMenuGmailSort",id:"contextMenuGmailSort",element:this.props.element},s.a.createElement(c.a,{icon:"icon-unfold_less",onClick:this.onClickScroll},"Scroll to item in pane"),s.a.createElement(c.a,{icon:"icon-add",onClick:this.onClickAddSubproject},"Add subproject"),s.a.createElement(c.a,{icon:"icon-zoom-in",onClick:this.onClickZoom},"Zoom In"))}});t.default=u},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a(0);var i=a(1),r=a(2),n=a.n(r),s=a(3),o=a(12),l=a(16),d=a(30),c=s.a.createClass({displayName:"ReactContextMenuGmailSort",componentDisplay:i.a.ComponentDisplay.Desktop,setViewMode:function(e){this.props.onSelected(e)},render:function(){this.props.pane;return n.a.createElement(o.a,{key:"contextMenuGmailSort",id:"contextMenuGmailSort",element:this.props.element},n.a.createElement(d.a,null,"Sort by"),n.a.createElement(l.a,{icon:"icon-access_time",onClick:this.setViewMode.bind(this,i.a.GmailViewMode.Date)},i.a.GmailViewMode.Date),n.a.createElement(l.a,{icon:"icon-exclamation",onClick:this.setViewMode.bind(this,i.a.GmailViewMode.Priority)},i.a.GmailViewMode.Priority))}});t.default=c},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(29),d=a(26),c=a(90),u=a(194),h=a(6),f=a(12),p=a(30),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},g=r.a.TaskSortMode,v=o.a.createClass({displayName:"ReactContextMenuSearch",componentDisplay:r.a.ComponentDisplay.Desktop,getState:function(){var e=this.props.pane,t=e.search,a={hasFilter:!1,matches:l.a.matches,showHelp:i.default.vmMain.shouldShowHelp("searchHelp"),viewState:e.viewState,viewMode:e.getViewMode(),sortModeBlocks:e.supportsSortBlocks()&&e.getSortModeBlocks(),sortModeItems:e.supportsSortItems()&&e.getSortModeItems()};e.isViewDates()&&(a.calendars=d.a.GCalendarsAvailable,a.displayCalendars=e.displayCalendars,a.displayLocalItems=e.displayLocalItems);for(var r=0;r<t.filters.length;r++){var n=t.filters[r];a[n.name]=n.value,a[n.name+"Enabled"]=n.enabled,0!==n.value.get()&&(a.hasFilter=!0)}return a},componentDidMount:function(){this.listenTo(this.props.pane.search.onChanged),i.default.settings.listen("settingChanged",Settings.DefaultGroup,Settings.closedHelps,this.updateState)},onUnmount:function(){i.default.settings.unlisten("settingChanged",Settings.DefaultGroup,Settings.closedHelps,this.updateState)},onClickSelectCalendars:function(e){i.default.menus.openContextMenu({componentName:"ReactContextMenuCalendars",element:e.target,pane:this.props.pane})},saveScrollOfTop:function(){this.props.pane.getInfiniteList().saveScrollOfTop(!0)},onToggleButton:function(e){this.saveScrollOfTop(),this.props.pane.search.toggleFilter(e)},setPriority:function(e){this.saveScrollOfTop();var t=this.props.pane.search;t.getFilterValue("priority")===e&&(e=0),t.setFilter("priority",e)},onClickCloseHelp:function(){i.default.vmMain.closeHelp("searchHelp")},onClickShowHelp:function(){i.default.vmMain.uncloseHelp("searchHelp")},setSortMode:function(e,t){this.props.pane["setSortMode"+(e?"Blocks":"Items")](t)},renderSortMode:function(e,t){if(!e||this.props.pane.supportsSortBlocksMode(t)){var a=i.default.classNames("c-border-light",{selected:t===this.state["sortMode"+(e?"Blocks":"Items")]});return s.a.createElement(h.a,{className:a,height:r.a.SearchHeight,onClick:this.setSortMode.bind(this,e,t)},r.a.TaskSortModeText[t])}},renderSearchButton:function(e){var t=this.props.pane;return s.a.createElement(c.a,{key:e.name,filter:e,filterValue:e.value.get(),search:t.search,hasBorder:!0})},renderSearchPriority:function(){var e=this.props.pane.search.filter_priority.value.get(),t=i.default.classNames("searchPriorities",{hasSelected:!!e}),a=i.default.classNames("searchPriority searchP0",{selected:e===VMLIFlag.P0}),r=i.default.classNames("searchPriority searchP1",{selected:e===VMLIFlag.P1}),n=i.default.classNames("searchPriority searchP2",{selected:e===VMLIFlag.P2});return s.a.createElement("span",{key:"priority",className:t},s.a.createElement("span",{className:a,"data-tooltip":"Show only high priority",onClick:this.setPriority.bind(this,VMLIFlag.P0)}),s.a.createElement("span",{className:r,"data-tooltip":"Show medium priority and higher",onClick:this.setPriority.bind(this,VMLIFlag.P1)}),s.a.createElement("span",{className:n,"data-tooltip":"Show low priority and higher",onClick:this.setPriority.bind(this,VMLIFlag.P2)}))},render:function(){for(var e=this.props,t=this.props.pane,a=this.state,n=t.search,o=[],l=[],d=0;d<n.filters.length;d++){var c=n.filters[d];c.enabled.get()&&(c.isOption?l.push(this.renderSearchButton(c)):c.icon?o.push(this.renderSearchButton(c)):"priority"===c.name&&o.push(this.renderSearchPriority()))}if(t.isViewDates()){var v=t.isCalFilterActive(),y=i.default.classNames("buttonCalendars",{selected:v});l.push(s.a.createElement(h.a,{key:"calendars",height:26,className:y,onClick:this.onClickSelectCalendars,padding:8,tooltip:"Select calendars to display in this pane"},"Calendars"))}return s.a.createElement(f.a,m({},e,{key:"contextMenuSearch"+t.id,id:"contextMenuSearch",maxHeight:400,element:e.element}),s.a.createElement("div",{className:"flexbox"},o.length>0&&s.a.createElement("div",null,s.a.createElement(p.a,null,"Filters"),s.a.createElement("div",{className:"searchFilters c-border-light"},o)),l.length>0&&s.a.createElement("div",null,s.a.createElement(p.a,null,"Options"),s.a.createElement("div",{className:"searchFilters c-border-light"},l)),s.a.createElement("div",{className:"f1"}),!a.showHelp&&s.a.createElement(h.a,{className:"searchHelpButton",icon:"icon-question",iconSize:12,width:28,height:28,onClick:this.onClickShowHelp})),t.supportsSortBlocks()&&s.a.createElement("div",null,s.a.createElement(p.a,null,"Sort ",r.a.TaskViewModeTextSimple[a.viewMode]),s.a.createElement("div",{className:"searchFilters sortBlocks c-border-light"},this.renderSortMode(!0,g.None),this.renderSortMode(!0,g.Alphabetical),this.renderSortMode(!0,g.NumItems),this.renderSortMode(!0,g.Priority),this.renderSortMode(!0,g.Date),this.renderSortMode(!0,g.Created),this.renderSortMode(!0,g.Completed))),t.supportsSortItems()&&s.a.createElement("div",null,s.a.createElement(p.a,null,"Sort Items"),s.a.createElement("div",{className:"searchFilters sortBlocks c-border-light"},this.renderSortMode(!1,g.None),this.renderSortMode(!1,g.Alphabetical),this.renderSortMode(!1,g.NumItems),this.renderSortMode(!1,g.Priority),this.renderSortMode(!1,g.Date),this.renderSortMode(!1,g.Created))),(a.matches.length>0||a.showHelp)&&s.a.createElement("hr",null),a.matches.length>0&&s.a.createElement(u.a,{onlyMatches:!0,matches:a.matches,onSelected:this.onAutocompleteSelected}),a.showHelp&&0===a.matches.length&&s.a.createElement("div",{className:"rel"},s.a.createElement(p.a,null,"Hints"),s.a.createElement(h.a,{className:"searchHintsClose",icon:"icon-close",iconSize:12,width:28,height:28,onClick:this.onClickCloseHelp}),s.a.createElement("div",{className:"searchHints c-foreground-light"},s.a.createElement("div",null,s.a.createElement("b",null,"-word")," hide items including word"),s.a.createElement("div",null,s.a.createElement("b",null,"@date")," show items on date"),s.a.createElement("div",null,s.a.createElement("b",null,"#tag")," show items with #tag"),s.a.createElement("div",null,s.a.createElement("b",null,"+name")," show items with +name"))))}});t.default=v},function(e,t,a){"use strict";var i=a(0),r=a(4),n=a(1),s=a(13),o=a(2),l=a.n(o),d=a(34),c=a.n(d),u=a(3),h=a(29),f=a(46),p=a(94),m=(a(195),a(6)),g=a(21),v=a(32),y=a(12),S=a(16),E=u.a.createClass({displayName:"ReactAutocomplete",componentDisplay:n.a.ComponentDisplay.Everywhere,init:function(){var e=this.props;this.createObservables({selectedIndex:e.elementInput||e.fromPane||e.onlyMatches?0:-1,expanded:!1})},componentDidMount:function(){if(this.hasOwnInput()){var e=this.refs.input;e.focus(),e.updateAutocomplete(this.props.item)}document.addEventListener("keydown",this.onInputKeyDown,!0)},componentWillReceiveProps:function(e){this.props.matches!==e.matches&&this.updateState(e)},onUnmount:function(){document.removeEventListener("keydown",this.onInputKeyDown,!0)},onBeforeChanged:function(e,t){var a=this.refs;if(e.matches!==t.matches&&!e.hasSpecialMatches){this.expanded.set(!1,!1),e.expanded=!1;var i=!a.input||!this.props.allowCustom&&a.input.getValue()&&this.state.matches.length>0?0:-1;this.selectedIndex.set(i,!1),e.selectedIndex=i}},onAfterChanged:function(e,t){e.matches.length>t.matches.length&&setTimeout(function(){this.refs.contextMenu&&this.refs.contextMenu.updateState()}.bind(this),0)},getState:function(e){var t=this.getSpecialMatches();return{matches:e.matches||t||h.a.matches,hasSpecialMatches:!!t,kbsize:r.a.kbsize,owner:h.a.owner}},updateTextFromIndex:function(){if(this.hasOwnInput()){var e=this.refs.input,t=this.selectedIndex.get(),a="";if(t>=0){var i=this.state.matches[t];a=this.getInsertText(i)}e.setValue(a),e.selectEnd()}},onInputKeyDown:function(e){var t=this.state,a=this.props;if(a.allowCustom&&e.keyCode===KeyCode.Enter)this.onSelected(),i.default.preventDefault(e),i.default.stopPropagation(e);else if(t.matches.length>0){var r=this.selectedIndex.get();if(e.keyCode===KeyCode.DownArrow||e.keyCode===KeyCode.UpArrow){if(e.keyCode===KeyCode.UpArrow?--r<(a.allowCustom?-1:0)&&(r=t.matches.length-1):e.keyCode===KeyCode.DownArrow&&++r>t.matches.length-1&&(r=a.allowCustom?-1:0),r!==this.selectedIndex.get()&&(this.selectedIndex.set(r),this.updateTextFromIndex(),r>=0)){var n=this.refs["item_"+this.selectedIndex.get()];try{i.default.PAssert(2677,n,"Item must exist in autocomplete to be scrolled to")}catch(e){i.default.reportError(e)}if(n){var s=c.a.findDOMNode(n);i.default.scrollIntoView(s,ScrollDuration.Default)}}i.default.preventDefault(e)}else e.keyCode===KeyCode.RightArrow?this.expanded.set(r):e.keyCode===KeyCode.Enter&&r>=0&&(this.onSelected(),i.default.preventDefault(e),i.default.stopPropagation(e))}},onEscapeKey:function(){this.hide(!0)},hide:function(e){h.a.hide(e)},onMouseOver:function(e){this.selectedIndex.set(e)},onClick:function(e){this.selectedIndex.set(e),this.updateTextFromIndex(),this.onSelected()},onButtonClick:function(){this.onSelected()},hasOwnInput:function(){return!this.props.elementInput&&!this.props.fromPane&&!this.props.onlyMatches},onSelected:function(){var e,t,a=this.props,i=this.state,r={owner:i.owner,index:a.indexInPane};if(a.allowCustom)(a.allowEmpty||this.refs.input.getValue())&&(t={text:this.refs.input.getValue()});else{var n=this.selectedIndex.get();t=this.state.matches[n]}t&&("contact"===t.type&&"email"===this.props.mode?(e=h.a.insertMatch(""),r.token=t):"item"===t.type?(e=h.a.insertMatch(""),r.item=t.item):e=h.a.insertMatch(this.getInsertText(t)),e&&(r.value=e.text,r.offset=e.offset),a.onSelected?a.onSelected(r):i.owner&&i.owner.onAutocompleteSelected&&i.owner.onAutocompleteSelected(r),this.hide())},getInsertText:function(e){return"email"===this.props.mode?e.text+" <"+e.email+">":"snooze"===e.type?e.insertText:e.text},insertHighlight:function(e){var t=[],a=h.a.getText(),i=e.toUpperCase().indexOf(a.toUpperCase());return i>=0&&a.length>0?(i>0&&t.push(e.substr(0,i)),t.push(l.a.createElement("span",{key:"match",className:"ac-match c-bg-autocomplete-highlight"},e.substr(i,a.length))),e.length>i+a.length&&t.push(e.substr(i+a.length))):t=e,t},onClickExpand:function(e,t){this.expanded.set(e),t.stopPropagation()},onClickExpandedInput:function(e){e.stopPropagation()},onSelectedAddChild:function(){var e=this.props,t=this.state,a=t.expanded,i=t.matches[a];if(e.onSelected){var r={item:i.item,subItemText:this.refs.inputAdd.getValue()};e.onSelected(r)}},getSpecialMatches:function(){if("snooze"===this.props.mode){var e=new Date,t=e.getHours(),a=e.getDay(),r=e.clone().clearTime().addHours(Math.min(t+3,23+59/60)),n=e.clone().clearTime();t<18?n.addHours(19):n.addHours(Math.min(t+2,23+59/60));var o=e.clone().clearTime();a<6?o.addDays(6-e.getDay()).addHours(9):6===a?o.addDays(1).addHours(9):o.addHours(Math.min(t+3,23+59/60));var l=e.clone().clearTime();a>0?l.addDays(8-e.getDay()).addHours(9):l.addDays(1).addHours(9);var d=e.clone().clearTime().addDays(1).addHours(9),c=e.clone().clearTime().addDays(1).addHours(19);return[{type:"snooze",icon:"icon-access_time",iconColor:"#f30",text:"Later Today",insertText:"Today "+r.toString(s.a.getFormat(DFormat.ShortTime)),date:r,showDay:!1},{type:"snooze",icon:"icon-access_time",iconColor:"#fa0",text:"Tonight",insertText:"Today "+n.toString(s.a.getFormat(DFormat.ShortTime)),date:n,showDay:!1},{type:"snooze",icon:"icon-access_time",iconColor:"#fd0",text:"Tomorrow Morning",insertText:"Tomorrow "+d.toString(s.a.getFormat(DFormat.ShortTime)),date:d,showDay:!0},{type:"snooze",icon:"icon-access_time",iconColor:"#2a6",text:"Tomorrow Night",insertText:"Tomorrow "+c.toString(s.a.getFormat(DFormat.ShortTime)),date:c,showDay:!0},{type:"snooze",icon:"icon-access_time",iconColor:i.default.colorBlue,text:"This Weekend",insertText:o.toString(s.a.getFormat(DFormat.NoPadShortDayTime)),date:o,showDay:!0},{type:"snooze",icon:"icon-access_time",iconColor:"#b0d",text:"Next Week",insertText:l.toString(s.a.getFormat(DFormat.NoPadShortDayTime)),date:l,showDay:!0}]}},onCloseButton:function(){i.default.menus.closeContextMenu()},setText:function(e){this.refs.input.setValue(e)},renderSpecialAutocomplete:function(){0},renderRightContent:function(){var e=this.state;if(e.matches.length>0&&e.selectedIndex>=0){var t,a=e.matches[e.selectedIndex];if("contact"===a.type&&(t=l.a.createElement(p.a,{contact:a})),t)return l.a.createElement("div",{className:"newAutocompleteRightContent c-border"},t)}},renderObject:function(e,t){var a;switch(e.type){case"contact":if(e.text&&e.email){a=this.insertHighlight(e.text);var r=this.insertHighlight(" <"+e.email+">");return l.a.createElement("span",null,l.a.createElement("span",{className:"contact c-contact"},a),r)}if(e.email)return e.email;if(e.text)return a=this.insertHighlight(e.text),l.a.createElement("span",{className:"contact c-contact"},a);break;case"tag":return a=this.insertHighlight(e.text),l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{className:"tag c-tag"},a),l.a.createElement("span",{className:"number c-foreground-faded"},e.count));case"date":return a=this.insertHighlight(e.text),l.a.createElement("span",{className:"date c-date"},a);case"snooze":var s=(e.showDay?e.date.toString("dddd")+" ":"")+e.date.toString("h:mm tt");return l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{className:"snoozeDate"},e.text),l.a.createElement("span",{className:"snoozeDetail"},s));case"item":var o=e.item,d=i.default.parentTextForItem(o),c=t===this.state.expanded,u=i.default.classNames("autocompleteItem flexbox",{hasParent:!!d},{itemExpanded:c}),h=this.props.mode===n.a.AutocompleteMode.Move;return l.a.createElement("div",{className:u},l.a.createElement("div",{className:"autocompleteItemInside f1"},d&&l.a.createElement("div",{className:"parentPath c-foreground-very-faded"},d),l.a.createElement(f.a,{key:o.id,item:o}),h&&c&&l.a.createElement(g.a,{ref:"inputAdd",placeholder:"Add subitem",buttonText:"MOVE TO CHILD",focused:!0,onButtonClick:this.onSelectedAddChild,onClick:this.onClickExpandedInput})),h&&l.a.createElement(m.a,{icon:c?"icon-angle-down":"icon-angle-right",className:"autocompleteExpand",width:46,height:46,onClick:this.onClickExpand.bind(this,t),tooltip:"Add sub-item"}));case n.a.AutocompleteMode.GmailLabel:return a=this.insertHighlight(e.text),l.a.createElement("span",null,a);default:try{i.default.PAssert(2678,!1,"Invalid insert text",e.type)}catch(e){i.default.reportError(e)}}},render:function(){for(var e=this.state,t=this.props,a=[],r=0;r<e.matches.length;r++){var n=e.matches[r],s=i.default.classNames("c-border-light autocomplete_"+n.type,{selected:r===e.selectedIndex});a.push(l.a.createElement(S.a,{key:r,ref:"item_"+r,icon:n.icon,iconColor:n.iconColor,className:s,onMouseOver:this.onMouseOver.bind(this,r),canClose:!1,noMouseUp:!0,onClick:this.onClick.bind(this,r)},this.renderObject(n,r)))}var o,d=t.text,c=t.buttonText;this.hasOwnInput()&&(o=!!t.allowEmpty||(t.allowCustom?void 0:e.selectedIndex>=0));var u,h,f=i.default.classNames("newAutocomplete flexbox",t.className,{contextMenuMobile:!1},{flexvert:this.hasOwnInput()},{hasOwnInput:this.hasOwnInput()},{expanded:!1!==e.expanded}),p={minWidth:260,maxWidth:320};this.hasOwnInput()&&(u=l.a.createElement("div",{className:"newAutocompleteTopBar flexbox c-border-heavy"},l.a.createElement(g.a,{ref:"input",display:"block",className:"f1",placeholder:d,autocompleteMode:t.mode,padding:{left:16,right:16},tokens:t.tokens,onTokenRemoved:t.onTokenRemoved,border:!1,buttonText:c,onEscape:this.onEscape,buttonEnabled:o,onButtonClick:this.onButtonClick})));var m=l.a.createElement(v.a,{className:"autocompleteMatches f1",style:p},a);return t.onlyMatches?m:l.a.createElement(y.a,{className:f,id:t.id,element:t.elementDisplay,maxWidth:"none",height:!1,positionOffset:t.positionOffset,position:t.position,useElementPosition:!0,overflowHeight:"shrink",ref:"contextMenu"},u,h,!h&&m,this.renderRightContent())}});t.a=E},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(29),a(2)),s=a.n(n),o=a(3),l=(a(50),0),d=1,c=2,u=4,h=8,f=["now","soon","later","someday"],p=["today","tomorrow"],m=["next"],g=["mon","tue","wed","thu","fri","sat","sun"],v=["january","february","march","april","may","june","july","august","september","october","november","december"],y=["every"],S=["first","other","last"],E=[0,1,2,3,4,5,6],P=f.concat(y);P.concat(p).concat(S).concat(m).concat(g).concat(v),o.a.createClass({displayName:"ReactAutocompleteDates",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.text="",this.createObservables({nextDateWord:l})},isInMode:function(e){return 0===e?0===this.state.nextDateWord:i.default.isFlagSet(this.state.nextDateWord,e)},getShortMonth:function(e){return Date.CultureInfo.abbreviatedMonthNames[e]},getLongMonth:function(e){return Date.CultureInfo.monthNames[e]},getShortDay:function(e){return Date.CultureInfo.abbreviatedDayNames[e]},getLongDay:function(e){return Date.CultureInfo.dayNames[e]},getMonthList:function(){var e=(new Date).getMonth()-1;e<0&&(e=12+e);for(var t=e+1+5,a=[],i=e;i<t;++i){var r=i%12;a.push(r)}return a},nextWordOptions:function(e){var t=e.toLowerCase().split(" "),a=t[t.length-1];if(""===a&&(a=t[t.length-2]),f.indexOf(a)>=0)return l;if(y.indexOf(a)>=0)return d|h;if(S.indexOf(a)>=0)return d;if(p.indexOf(a)>=0)return u;if(m.indexOf(a)>=0)return d;if(g.indexOf(a)>=0)return u;if(v.indexOf(a)>=0)return c;var i=parseInt(a,10);return isNaN(i)?a.indexOf(":")>=0?u:l:u},onTapDate:function(e){var t=e.target;if("SPAN"===t.nodeName){var a=t.textContent.trim(),r=this.nextWordOptions(a),n=r===l;this.nextDateWord.set(r),this.text+=a,i.default.findParentID(t,"autocompleteHours",2)||i.default.findParentID(t,"autocompleteMinutes",2)||(this.text+=" "),console.log(a,r,n),this.props.setText(this.text)}},render:function(){var e=this,t=(this.state.nextDateWord,""===this.text);return s.a.createElement("div",{id:"autocompleteDates",className:"f1",onClick:this.onTapDate},(this.isInMode(l)||this.isInMode(d))&&s.a.createElement("div",{id:"autocompleteDate"},s.a.createElement("div",{className:i.default.classNames({disabled:!t})},P.map(function(e){return s.a.createElement("span",{key:e},e)})),!this.isInMode(h)&&s.a.createElement("div",{className:i.default.classNames({disabled:!t})},s.a.createElement("span",null,"today"),s.a.createElement("span",null,"tomorrow"),s.a.createElement("span",null,"next")),this.isInMode(h)&&s.a.createElement("div",null,s.a.createElement("span",null,"first"),s.a.createElement("span",null,"other"),s.a.createElement("span",null,"last")),s.a.createElement("div",{id:"datePickerDays"},E.map(function(t){var a=e.getLongDay(t);return s.a.createElement("span",{key:a},e.getShortDay(t))})),s.a.createElement("div",{className:i.default.classNames({disabled:!t})},e.getMonthList().map(function(t){var a=e.getLongMonth(t);return s.a.createElement("span",{key:a},e.getShortMonth(t))}))),this.isInMode(c)&&s.a.createElement("div",{id:"autocompleteDay"},s.a.createElement("div",{className:"flexcolumn"},s.a.createElement("div",{className:"autocompleteDays"},Array.apply(0,Array(31)).map(function(e,t){return s.a.createElement("span",{key:t},t+1)})))),this.isInMode(u)&&s.a.createElement("div",{id:"autocompleteTime"},s.a.createElement("div",{className:"flexcolumn"},s.a.createElement("div",{id:"autocompleteHours"},Array.apply(0,Array(12)).map(function(e,t){return s.a.createElement("span",{key:t},t+1)}))),s.a.createElement("div",{className:"flexcolumn"},s.a.createElement("div",{id:"autocompleteMinutes"},s.a.createElement("span",null,":15"),s.a.createElement("span",null,":30"),s.a.createElement("span",null,":45"))),s.a.createElement("div",{className:"flexcolumn"},s.a.createElement("div",{id:"autocompleteAMPM"},s.a.createElement("span",null,"am"),s.a.createElement("span",null,"pm")))))}})},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(3),l=a(25),d=a(35),c=a(6),u=a(12),h=a(30),f=a(21),p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};var m=o.a.createClass({displayName:"ReactContextMenuNameBoard",componentDisplay:r.a.ComponentDisplay.Desktop,getHotkeys:function(){return[l.a.create(KeyCode.Escape,!0,r.a.Primary.Either,r.a.Shift.Either,this.onClickCancel),l.a.create(KeyCode.Enter,!0,r.a.Primary.Either,r.a.Shift.Either,this.onClickSave)]},onClickSave:function(){var e=this.refs.input.getValue();!this.props.workspace?i.default.menus.closeContextMenu("ReactContextMenuNameBoard",e):d.a.renameWorkspace(this.props.workspace,e)?(i.default.tooltip.hideTip(),i.default.menus.closeContextMenu("ReactContextMenuNameBoard"),this.updateState()):i.default.tooltip.displayTip({text:"Please give this board a unique name.",element:this.refs.menu})},onClickCancel:function(){i.default.menus.closeContextMenu("ReactContextMenuNameBoard",!1)},render:function(){var e=this.props,t=e.workspace,a=function(e,t){var a={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a}(e,["workspace"]),i=(t?"Rename":"Name new")+" board";return s.a.createElement(u.a,p({},a,{key:"contextMenuEditBoard",id:"contextMenuEditBoard",width:400}),s.a.createElement(h.a,{padding:0,border:!1},i),s.a.createElement(f.a,{value:t?this.props.workspace.name:"",focused:!0,ref:"input"}),s.a.createElement("div",{className:"fancyModalButtons center"},s.a.createElement(c.a,{primary:!0,width:100,onClick:this.onClickSave},"SAVE"),s.a.createElement(c.a,{width:100,onClick:this.onClickCancel},"CANCEL")))}});t.default=m},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(12),d=a(16),c=a(30),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},h=o.a.createClass({displayName:"ReactContextMenuSelectGmailAccount",componentDisplay:r.a.ComponentDisplay.Everywhere,addPane:function(e){this.props.onSelected(e)},render:function(){var e=this,t=this.props,a=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail),r=a.getSyncAccounts();return s.a.createElement(l.a,u({},t,{key:"contextMenuTitle",id:"contextMenuTitle",maxHeight:400}),t.showHeader&&s.a.createElement(c.a,{topHeader:!0},"Open Gmail Account"),r.map(function(t){var i=a.getDefaultDisplayItem(t);return s.a.createElement(d.a,{key:t,onClick:e.addPane.bind(e,i)},t)}))}});t.default=h},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(12),d=a(16),c=(a(30),o.a.createClass({displayName:"ReactContextMenuAddItem",componentDisplay:r.a.ComponentDisplay.Desktop,onClickPrefix:function(e){i.default.vmMain.applyPrefixToSelection(e,this.props.item)},onClickHR:function(){this.props.item.setText("---",!0,ChangeType.Local)},render:function(){return s.a.createElement(l.a,{key:"contextMenuAddItem",id:"contextMenuAddItem",element:this.props.element},s.a.createElement(d.a,{icon:"icon-hash",hotkey:r.a.Prefix.Header+" Space",onClick:this.onClickPrefix.bind(this,r.a.Prefix.Header)},"Project"),s.a.createElement(d.a,{icon:"icon-check",hotkey:r.a.Prefix.Task+" Space",onClick:this.onClickPrefix.bind(this,r.a.Prefix.Task)},"Task"),s.a.createElement(d.a,{icon:"icon-bullet",hotkey:r.a.Prefix.Bullet+" Space",onClick:this.onClickPrefix.bind(this,r.a.Prefix.Bullet)},"Bullet"),s.a.createElement(d.a,{icon:"icon-numlist",hotkey:r.a.Prefix.NumList+" Space",iconSize:14,onClick:this.onClickPrefix.bind(this,r.a.Prefix.NumList)},"Numbered List"),s.a.createElement(d.a,{icon:"icon-hr",hotkey:"---",iconSize:14,onClick:this.onClickHR},"Horizontal Line"))}}));t.default=c},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(10),d=a(6),c=a(33),u=a(12),h=a(30),f=a(16),p=o.a.createClass({displayName:"ReactContextMenuCalendars",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({anyCalendarsSync:this.computeAnyCalendarsSync()}),l.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenCalendarsMenu})},getState:function(){var e=this.props.pane;return{displayCalendars:e.displayCalendars,displayLocalItems:e.displayLocalItems}},getSyncCalendars:function(){return i.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar).getImportCalendarList()},computeAnyCalendarsSync:function(){for(var e=this.props.pane.displayCalendars.get(),t=this.getSyncCalendars(),a=0,i=0;i<t.length;i++)!1!==e[t[i].id]&&a++;return a>0},onChangeDisplayCalendar:function(e,t){this.props.pane.setDisplayCalendar(e,t),this.anyCalendarsSync.set(this.computeAnyCalendarsSync())},onChangeDisplayLocal:function(e){this.props.pane.setDisplayLocal(e)},onChangeAllCalendars:function(e){for(var t=this.props.pane,a=this.getSyncCalendars(),i=this.state.displayCalendars,r=0;r<a.length;r++){var n=a[r];i[n.id]!==e&&t.setDisplayCalendar(n,e)}},onClickAdd:function(){i.default.menus.closeContextMenu(),i.default.menus.openSettings(r.a.SettingsSections.GoogleCalendar)},render:function(){var e=this.state,t=this.props,a=i.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar),r=this.getSyncCalendars(),n=e.displayCalendars;return s.a.createElement(u.a,{key:"contextMenuSelectCalendars",id:"contextMenuSelectCalendars",element:t.element},s.a.createElement(f.a,null,s.a.createElement(c.a,{checked:e.displayLocalItems,onChange:this.onChangeDisplayLocal},"Display local events")),s.a.createElement(h.a,null,s.a.createElement(c.a,{checked:e.anyCalendarsSync,onChange:this.onChangeAllCalendars,size:14},"Google Calendars")),r&&r.map(function(e){var t=a.getCalendarBackgroundColor(e.id);return s.a.createElement(f.a,{key:e.id},s.a.createElement(c.a,{checked:!1!==n[e.id],checkedColor:t,onChange:this.onChangeDisplayCalendar.bind(this,e)},e.summary||e.id))}.bind(this)),(!r||0===r.length)&&s.a.createElement("div",{className:"center",style:{marginTop:8}},s.a.createElement(d.a,{raised:!0,primary:!0,onClick:this.onClickAdd},"ADD CALENDARS")))}});t.default=p},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=(a(26),a(25)),d=a(21),c=a(12),u=a(6),h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},f=o.a.createClass({displayName:"ReactContextMenuInsertLink",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){var e=this.props.text;null===new RegExp(/\S{2,}\.[^0-9.\s]{2,}\S*$/).exec(e)?this.text=e:this.link=e},getHotkeys:function(){return[l.a.create(KeyCode.Enter,!0,r.a.Primary.Either,r.a.Shift.Either,this.onClick),l.a.create(KeyCode.Escape,!0,r.a.Primary.Either,r.a.Shift.Either,this.close)]},componentDidMount:function(){var e;(e=this.link||!this.text?this.refs.text:this.refs.link).focus(),e.selectEnd()},close:function(){i.default.menus.closeContextMenu()},onClick:function(){var e=this.refs.text.getValue(),t=this.refs.link.getValue();this.close(),e&&t&&(t.startsWith("http")||(t="http://"+t),this.props.onInsertLink({text:e,url:t}))},render:function(){return s.a.createElement(c.a,h({},this.props,{key:"contextMenuInsertLink",id:"contextMenuInsertLink"}),s.a.createElement("div",{className:"flexbox"},s.a.createElement("span",null,"Text"),s.a.createElement(d.a,{className:"f1",ref:"text",height:28,width:260,value:this.text})),s.a.createElement("div",{className:"flexbox"},s.a.createElement("span",null,"Link"),s.a.createElement(d.a,{className:"f1",ref:"link",height:28,width:260,value:this.link})),s.a.createElement("div",{className:"flexbox"},s.a.createElement(u.a,{primary:!0,raised:!0,onClick:this.onClick},"INSERT")))}});t.default=f},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(94),d=a(12),c=o.a.createClass({displayName:"ReactContextMenuContactDetails",componentDisplay:r.a.ComponentDisplay.Everywhere,onClose:function(){i.default.menus.closeContextMenu("ReactContextMenuContactDetails")},render:function(){return s.a.createElement(d.a,{key:"contextMenuContactDetails",id:"contextMenuContactDetails",element:this.props.element,position:this.props.position},s.a.createElement(l.a,{contact:this.props.contact,onClose:this.onClose}))}});t.default=c},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(8),d=a(4),c=a(11),u=a(95),h=a(12),f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},p=o.a.createClass({displayName:"ReactNotePopup",componentDisplay:r.a.ComponentDisplay.Everywhere,componentDidMount:function(){c.a.listen("windowResize",this.onResize)},onResize:function(){this.updateState(),setTimeout(function(){this.refs.menu.updateState()}.bind(this),300)},onUnmount:function(){var e=this.props.item;c.a.unlisten("windowResize",this.onResize),l.a.selectIndex(this.props.index-1,e.getParsedText().length)},onKeyPress:function(e){d.a.getKeyCode(e)!==KeyCode.Enter||!e.shiftKey||e.altKey||e.ctrlKey||e.metaKey||(i.default.menus.closeContextMenu(),e.preventDefault(),e.stopPropagation())},getState:function(){return{maxWidth:this.props.pane.getWidth()-20}},render:function(){var e=this.props,t=this.state.maxWidth;return s.a.createElement(h.a,f({},this.props,{key:e.note.id+"_Note",id:"contextMenuNote",width:600,maxWidth:t,bottom:!1,ref:"menu"}),s.a.createElement(u.a,{ref:"noteText",item:e.item,focused:!0,onKeyPress:this.onKeyPress,selectionStart:e.selectionStart,selectionEnd:e.selectionEnd}))}});t.default=p},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=(a(4),a(10)),s=a(2),o=a.n(s),l=a(3),d=a(29),c=(a(20),a(50)),u=a(18),h=a(11),f=(a(8),a(46)),p=a(6),m=a(12),g=a(16),v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},y=l.a.createClass({displayName:"ReactContextMenuDropBucket",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({draggingItem:void 0})},componentDidMount:function(){h.a.listen("droppedItem",this.onItemDropped)},onUnmount:function(){h.a.unlisten("droppedItem",this.onItemDropped)},getState:function(){return{items:i.default.vmMain.dropBucket.getItems(),isDragging:u.a.isVisible}},createEvent:function(e,t){var a=i.default.findChild(t.target,"item")||i.default.findParent(t.target,"item",5);return{fromDropBucket:!0,startSrc:a,target:a,clientX:t.clientX,clientY:t.clientY,eventX:t.eventX||t.clientX,eventY:t.eventY||t.clientY,pageX:t.pageX,pageY:t.pageY,preventDefault:i.default.emptyFn,stopPropagation:i.default.emptyFn,stopImmediatePropagation:i.default.emptyFn,pane:e.pane}},onMouseDown:function(e,t){e.item},onClickItem:function(e,t){if(!i.default.hasClass(t.target,"fancyButton")){var a={mode:r.a.AutocompleteMode.Move,text:"Select item to move to",buttonText:"MOVE",elementDisplay:t.target,onSelected:function(t){n.a.beginAction();var a=e.item.clone(t.item,ChangeType.Local);t.item.insertItem(a,0),e.item.parent().removeChild(e.item,ChangeType.Local),i.default.vmMain.dropBucket.removeTextEntry(e.id),0===this.state.items.length&&i.default.menus.closeContextMenu(),n.a.endAction()}.bind(this)};d.a.showPopup(a)}},onMouseMove:function(e,t){e.item},onMouseUp:function(e,t){e.item},onCloseButton:function(e,t){e.item&&i.default.vmMain.dropBucket.hasItemEntry(e.item)&&i.default.vmMain.dropBucket.removeItemEntry(e.item),i.default.vmMain.dropBucket.hasTextEntry(e.id)&&i.default.vmMain.dropBucket.consumeTextEntry(e.id),t.stopPropagation()},onItemDropped:function(e){i.default.vmMain.dropBucket.hasItemEntry(e)&&i.default.vmMain.dropBucket.removeItemEntry(e),i.default.vmMain.dropBucket.hasTextEntry(e.id)&&i.default.vmMain.dropBucket.removeTextEntry(e.id)},_renderBucketItem:function(e,t){return e.item?o.a.createElement(f.a,{item:e.item,index:t,allowDrag:!0,inAutocomplete:!0}):o.a.createElement(c.a,null,e.text)},render:function(){for(var e=this.props,t=this.state,a=[],r=0;r<t.items.length;r++){var n=t.items[r],s=n.item,l=n.id,d={width:"100%",overflow:"hidden"},u=i.default.classNames({dragging:t.draggingItem===s});d.maxWidth="335px",a.push(o.a.createElement(g.a,{key:l,className:u,onClick:this.onClickItem.bind(this,n),clickCloses:!1,hasButtons:!0,hoverEffects:!0},o.a.createElement(c.a,{style:d,onMouseDown:this.onMouseDown.bind(this,n),onMouseMove:this.onMouseMove.bind(this,n),onMouseUp:this.onMouseUp.bind(this,n)},this._renderBucketItem(n,r)),o.a.createElement(p.a,{icon:"icon-close",width:"48px",iconSize:20,onClick:this.onCloseButton.bind(this,n)})))}return o.a.createElement(m.a,v({},e,{key:"contextMenuDropBucket",id:"contextMenuDropBucket",supportArrows:!0}),a)}});t.default=y},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=(a(7),a(2)),s=a.n(n),o=a(3),l=a(10),d=a(4),c=a(11),u=(a(44),a(25)),h=a(46),f=a(95),p=a(205),m=a(33),g=a(21),v=a(6),y=a(12),S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},E=o.a.createClass({displayName:"ReactItemDetailsPopup",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({canSyncDate:!1,addingLocal:!0})},getHotkeys:function(){return[u.a.create(KeyCode.Escape,!0,r.a.Primary.Either,r.a.Shift.Either,this.onEscape),u.a.create(KeyCode.C,!0,r.a.Primary.Never,r.a.Shift.No,this.onHotkeyCreateEvent)]},getState:function(){var e=this.props.item;return{flags:e.flags,maxWidth:this.props.pane&&Math.min(this.props.pane.getWidth()-20,500),isStarred:e.isStarred(),priority:e.priority()}},componentDidMount:function(){this.props.item.itemChanged.listen(this.onItemChanged),c.a.listen("windowResize",this.onResize),c.a.listen("panesChanged",this.onResize)},onResize:function(){this.updateState(),setTimeout(function(){this.refs.menu&&this.refs.menu.updateState()}.bind(this),300)},onUnmount:function(){this.props.item.itemChanged.unlisten(this.onItemChanged);var e=this.props;if(e.addOnSave&&this.needsSave){var t=this.addItem();e.beginSave&&e.beginSave();try{var a=e.options;if(a)for(var r=0;r<a.length;r++){var n=a[r],s=this.refs[n.text];if(s&&s.getValue())try{n.cb(t)}catch(e){i.default.reportError(e)}}if(e.children)for(r=0;r<e.children.length;r++){var o=e.children[r].clone(t,ChangeType.Local);t.insertItem(o)}var l=i.default.vmMain.getDefaultCalendarPlugin(),d=this.refs.checkAddCalendar;l&&l.isAvailable()&&d&&d.getValue()&&l.createEventForItem(t)}catch(e){i.default.reportError(e)}e.endSave&&e.endSave()}c.a.unlisten("windowResize",this.onResize),c.a.unlisten("panesChanged",this.onResize)},onItemChanged:function(){var e=this.props.item;this.canSyncDate.set(!(!e.getDateText()||i.default.isDateSoft(e.getDateText())||!e.date()&&!e.repeatDate()))},onHotkeyCreateEvent:function(){var e=i.default.vmMain.getDefaultCalendarPlugin(),t=this.props.item;e&&(this.props.addOnSave?this.state.canSyncDate&&this.refs.checkAddCalendar&&this.refs.checkAddCalendar.setValue(!0):(e.createEventForItem(t),t.itemChanged.notify()))},onKeyPress:function(e){d.a.getKeyCode(e)===KeyCode.Enter?(this.save(),e.preventDefault()):this.wasAKeyPressed=!0},save:function(){this.props.item.hasText()?(this.needsSave=!0,i.default.menus.closeContextMenu()):i.default.toasts.pushMessage({text:"Please enter text for the item before adding it.",timeout:2e3})},addItem:function(){var e=this.props.item,t=!0,a=i.default.vmMain.getDefaultCalendarPlugin();if(a&&a.isAvailable()&&this.refs.checkAddLocal&&(t=this.refs.checkAddLocal.getValue()),e.getRawText().length>0){if(t){var r=this.props.parent,n=this.refs.addTo.getItem(),s=0;n&&(s=(r=n.item).numItems()),l.a.beginAction();var o=e.clone(r,ChangeType.AllLocal),d=this.refs.noteText.getValue();if(d){var c=o.createNote();c&&c.setText(d,!0,ChangeType.Local)}return r.insertItem(o,s),l.a.endAction(),o}return e}return!1},onEscape:function(){this.wasEscapeKeyPressed=!0,i.default.menus.closeContextMenu()},onNoteValueSet:function(){this.refs.menu.updateState()},onKeyDownNote:function(e){d.a.getKeyCode(e)===KeyCode.Enter&&d.a.mac&&e.metaKey&&this.save()},onClickStar:function(){var e=this.props.item;e.isStarred(!e.isStarred(),ChangeType.Local)},setPriority:function(e){var t=this.props.item;t.priority()===e&&(e=VMLIFlag.None),t.priority(e,ChangeType.Local)},onChangeAddToCalendar:function(e){!e&&this.refs.checkAddLocal&&this.refs.checkAddLocal.setValue(!0)},onChangeAddLocal:function(e){!e&&this.refs.checkAddCalendar&&this.refs.checkAddCalendar.setValue(!0),this.addingLocal.set(e)},render:function(){var e,t=this.props,a=this.state,r=t.pane,n=t.item,o=this.state.maxWidth,l=i.default.parentTextForItem(n),d=t.children||(r?r.getSubItems(n,!0):[]),c=n.allowTextEditing(),u=c&&(n.canHaveNote()||n.hasNote()),E=a.canSyncDate,P=i.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar),b=P.isActive()&&i.default.vmMain.pluginManager.getSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.SyncNewEvents),C=P.isActive()&&i.default.vmMain.pluginManager.getSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.CreateLocalEvents),D=P&&P.isAvailable();if(d.length>0){e=[];for(var I=-d[0].getPadding(r),A=0;A<d.length;A++){var M=d[A];e.push(s.a.createElement(h.a,{key:M.id,item:M,pane:t.pane,padded:!0,allowDrag:!1,paddingOffset:I,maxWidth:508}))}}var _=10,T=i.default.classNames("c-foreground-faded",{disabled:!a.addingLocal});return s.a.createElement(y.a,S({},t,{key:n.id+"_Edit",id:"contextMenuItemDetails",className:"flexbox flexvert",width:540,maxWidth:o,bottom:!1,onEscape:this.onEscape,ref:"menu"}),s.a.createElement(p.a,{component:this,target:"buttonSave",tabIndex:_++}),l&&s.a.createElement("div",{className:"detailsSection flexbox itemContext c-foreground-faded"},s.a.createElement("div",{className:"c-foreground-faded"},"Parents"),s.a.createElement("div",null,l)),s.a.createElement("div",{className:"detailsSection flexbox noShrink"},s.a.createElement("div",{className:"c-foreground-faded"},"Item text"),s.a.createElement(h.a,{ref:"item",className:"detailsItem c-background c-border",item:n,maxWidth:508,onKeyPress:this.onKeyPress,selectIndex:t.selectIndex,showPriority:!0,shouldSave:!t.addOnSave,autocompleteMode:"all",tabIndex:_,inItemDetails:!0,pane:r,editable:c})),t.addOnSave&&s.a.createElement("div",{className:"detailsSection flexbox"},s.a.createElement("div",{className:T},"Add to"),s.a.createElement(g.a,{autocompleteMode:"item",height:33,placeholder:"Select item to add to",tabIndex:_++,ref:"addTo",disabled:!a.addingLocal})),u&&s.a.createElement("div",{className:"detailsSection flexbox"},s.a.createElement("div",{className:"c-foreground-faded"},"Note"),s.a.createElement(f.a,{className:"c-border",ref:"noteText",item:n,heightEmpty:34,heightValue:150,onValueSet:this.onNoteValueSet,onKeyDown:this.onKeyDownNote,tabIndex:_++})),s.a.createElement("div",{className:"detailsSection flexbox"},s.a.createElement("div",{className:"c-foreground-faded"},"Options"),s.a.createElement("span",{className:"itemDetailOption c-border pointer",onClick:this.onClickStar},s.a.createElement("span",{className:"c-foreground-super-faded"},"Star:"),s.a.createElement("i",{className:i.default.classNames("starButton icon-star c-foreground-super-faded",{selected:a.isStarred})})),s.a.createElement("span",{className:"itemDetailOption c-border"},s.a.createElement("span",{className:"c-foreground-super-faded"},"Priority:"),s.a.createElement("span",{className:i.default.classNames("searchPriority searchP0",{selected:a.priority===VMLIFlag.P0}),onClick:this.setPriority.bind(this,VMLIFlag.P0)}),s.a.createElement("span",{className:i.default.classNames("searchPriority searchP1",{selected:a.priority===VMLIFlag.P1}),onClick:this.setPriority.bind(this,VMLIFlag.P1)}),s.a.createElement("span",{className:i.default.classNames("searchPriority searchP2",{selected:a.priority===VMLIFlag.P2}),onClick:this.setPriority.bind(this,VMLIFlag.P2)}))),t.addOnSave&&(D||t.options)&&s.a.createElement("div",{className:"detailsSection"},D&&E&&s.a.createElement(m.a,{key:"addLocal",initialChecked:C,ref:"checkAddLocal",onChange:this.onChangeAddLocal,tabIndex:E?_++:void 0},"Create Moo.do item"),D&&E&&s.a.createElement(m.a,{key:"addToCalendar",initialChecked:b,ref:"checkAddCalendar",onChange:this.onChangeAddToCalendar,tabIndex:E?_++:void 0},"Add to Google Calendar"),t.options&&t.options.map(function(e){return s.a.createElement(m.a,{key:e.text,initialChecked:e.value,ref:e.text,tabIndex:_++},e.text)})),e&&s.a.createElement("div",{className:"detailsSection"},s.a.createElement("div",{className:"c-foreground-faded"},"Subitems"),s.a.createElement("div",{className:"children c-border"},e)),t.addOnSave&&s.a.createElement("div",{className:"bottomRow flexbox"},s.a.createElement(v.a,{onClick:this.onEscape},"CANCEL"),s.a.createElement(v.a,{primary:!0,marginLeft:8,onClick:this.save,tabIndex:_++,ref:"buttonSave"},"SAVE")),s.a.createElement(p.a,{component:this,target:"item",tabIndex:_++}))}});t.default=E},function(e,t,a){"use strict";var i=a(2),r=a.n(i),n=a(3),s=a(1),o=n.a.createClass({displayName:"FancyFocusGuard",componentDisplay:s.a.ComponentDisplay.Desktop,onFocus:function(){var e=this.props.component.refs[this.props.target];e&&e.focus()},render:function(){return r.a.createElement("input",{className:"fancyFocusGuard",onFocus:this.onFocus,tabIndex:this.props.tabIndex})}});t.a=o},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(13),d=a(12),c=o.a.createClass({displayName:"ReactContextMenuEmailDetails",componentDisplay:r.a.ComponentDisplay.Desktop,_generateParticipantTextExpanded:function(e){return e.text?s.a.createElement("span",null,s.a.createElement("b",null,e.text)," <"+e.email+">"):e.email},renderLabels:function(){for(var e=i.default.vmMain.getDefaultEmailPlugin(),t=this.props.accountID,a=this.props.message.labelIds,r=[],n=0;n<a.length;n++){var o=e._getLabelByID(t,a[n]);r.push(s.a.createElement("div",{key:n},o.getName()))}return this.renderLine("labels",r)},renderParticipants:function(e){var t=this.props.message[e].map(function(e,t){return s.a.createElement("div",{key:t},this._generateParticipantTextExpanded(e))}.bind(this));return this.renderLine(e,t)},renderLine:function(e,t){return s.a.createElement("div",{className:"emailDetailsLine flexbox"},s.a.createElement("div",null,e+":"),s.a.createElement("span",{className:"f1"},t))},render:function(){var e=this.props.message,t=e.date,a=t.toString(l.a.getFormat(DFormat.DayMonthDateYear))+" at "+t.toString(l.a.getFormat(DFormat.ShortTime));return s.a.createElement(d.a,{key:"contextMenuEmailDetails",id:"contextMenuEmailDetails",element:this.props.element},this.renderLine("from",this._generateParticipantTextExpanded(e.from)),e.to&&this.renderParticipants("to"),e.cc&&this.renderParticipants("cc"),e.bcc&&this.renderParticipants("bcc"),this.renderLine("date",a),this.renderLine("subject",e.subject),e.labelIds&&this.renderLabels())}});t.default=c},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(4),n=a(1),s=a(2),o=a.n(s),l=a(3),d=a(45),c=a(8),u=a(14),h=a(6),f=a(12),p=a(30),m=a(16),g=l.a.createClass({displayName:"ReactContextMenuItem",componentDisplay:n.a.ComponentDisplay.Desktop,init:function(){this.mod=r.a.secModKey,this.priMod=r.a.priModKey,this.props.useItem||this.props.pane.applyToSelection(function(e){return this.item=e,this.hasSelection=!0,!1}.bind(this)),this.item||(this.item=this.props.item,this.hasSelection=!1);try{i.default.PAssert(2589,this.item,"Must have a valid item")}catch(e){i.default.reportError(e)}},onClickComplete:function(){this.hasSelection?i.default.vmMain.applyFnToSelection("isComplete",{toggle:!0,value2:ChangeType.Local}):this.item.isComplete(!this.item.isComplete(),ChangeType.Local)},onClickStar:function(){this.hasSelection?i.default.vmMain.applyFnToSelection("isStarred",{toggle:!0,value2:ChangeType.Local}):this.item.isStarred(!this.item.isStarred(),ChangeType.Local)},onClickPriority:function(e){this.hasSelection?this.props.pane.applyPriorityToSelection(e):this.item.priority(e,ChangeType.Local),i.default.menus.closeContextMenu()},onClickIndent:function(e){c.a.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:e})},onClickMove:function(){this.props.pane.autocompleteMove()},onClickCreateTask:function(){this.props.pane.autocompleteCreateTask()},onClickNote:function(){this.item.editNote()},onClickCollapse:function(){this.item.toggleCollapsed(this.props.pane)},onClickZoom:function(){this.item.canZoom()&&(c.a.setFocusedPane(this.props.pane),i.default.vmMain.zoomin(this.item))},onClickZoomNewPane:function(){var e=this.props.pane;if(this.item.canZoom()){var t=i.default.vmMain.paneManager.getPaneIndex(e)+1,a=e.getSaveInfo();a.item=this.item,delete a.id;var r=d.a.createPane(PaneMode.Task,a);return i.default.vmMain.paneManager.addPaneAtIndex(r,t),c.a.setFocusedPane(r),r.onAdded(),!1}},onClickGoto:function(){i.default.scrollToAndHighlightItem(this.item,this.props.pane)},onClickArchive:function(){var e=this.props.pane;if(e.isWriteable)if(this.hasSelection)e.archiveSelected(!0);else{var t=this.props.item;t.parent().archiveChild(t,ChangeType.Local)}},onClickUnarchive:function(){i.default.focusedPane.runUnarchive(this.item)},onClickDelete:function(){var e=this.item,t=this.props.pane;if(e.isNote()){var a=c.a.getStartIndex(),r=e.parent();e.parent().setNote(void 0,ChangeType.Local),c.a.selectIndex(a-1,r.getParsedText().length)}else if(t.isWriteable)if(t.isViewDates()&&!e.hasAttachmentType(n.a.PluginType.Calendar)&&e.hasChildren()){i.default.menus.options("The item you are deleting has children.",["Remove Date","Delete All"],function(t){if("Remove Date"===t){var a=e.getParsedText().replace(e.getItemDateString(),"");e.setText(a,!0,ChangeType.Local)}else"Delete All"===t&&e.deleteSelf(ChangeType.Local)}.bind(this))}else this.hasSelection?t.deleteSelected():this.props.item.deleteSelf(ChangeType.Local)},onClickAddCalendar:function(){var e=i.default.vmMain.getDefaultCalendarPlugin(),t=this.item;e&&(e.createEventForItem(t),t.itemChanged.notify())},onClickDeleteCalendar:function(){var e=this.item,t=this.props.pane;if(e.hasAttachmentType(n.a.PluginType.Calendar)){var a=e.getAttachmentByPlugin(PluginID.GCalendar);try{i.default.PAssert(2590,a,"Must be able to get a valid attachment")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2591,this.item,"Must have a valid item")}catch(e){i.default.reportError(e)}var r=a.getPlugin();r.hasWritePermissionForAttach(a)?(c.a.reset(),r.deleteCalendarEventForItem(this.item,a,i.default.emptyFn,i.default.emptyFn,function(e,a,r,n){a?t.updateItems():i.default.toasts.pushMessage({text:"There was an error removing the event from your Google Calendar.",action:MessageAction.Okay})})):i.default.toasts.pushMessage(MessageID.ReadOnlyCalendar)}},onClickReply:function(){this.hasSelection?this.props.pane.replySelected():this.props.pane.openEmailByItem(this.item,n.a.EmailResponseMode.Reply)},onClickReplyAll:function(){this.hasSelection?this.props.pane.replyAllSelected():this.props.pane.openEmailByItem(this.item,n.a.EmailResponseMode.ReplyAll)},onClickForward:function(){this.hasSelection?this.props.pane.forwardSelected():this.props.pane.openEmailByItem(this.item,n.a.EmailResponseMode.Forward)},onClickRead:function(){var e=this.item,t=e.getAttachmentByType(n.a.PluginType.Email),a=t.getPlugin(),i=a.isItemUnread(e);this.hasSelection?this.props.pane.markReadSelected(i):i?a.performAction(n.a.PluginAction.Gmail.MarkRead,t):a.performAction(n.a.PluginAction.Gmail.MarkUnread,t)},onClickStarGmail:function(){if(this.hasSelection)this.props.pane.toggleStarSelected();else{var e=this.item.getAttachmentByType(n.a.PluginType.Email),t=e.getPlugin();t.isItemStarred(this.item)?t.performAction(n.a.PluginAction.Gmail.Unstar,e):t.performAction(n.a.PluginAction.Gmail.Star,e)}},onClickSnooze:function(){this.props.pane.autocompleteSnooze()},onClickLabel:function(){this.props.pane.autocompleteLabel()},onClickSchedule:function(){this.props.pane.autocompleteSchedule()},onClickArchiveGmail:function(){var e=this.item,t=e.getAttachmentByType(n.a.PluginType.Email),a=t.getPlugin(),i=a.isItemArchived(e);"PaneGmail"===this.props.pane.type&&this.hasSelection?this.props.pane.archiveSelected(!i):i?a.performAction(n.a.PluginAction.Gmail.Unarchive,!1,t):a.performAction(n.a.PluginAction.Gmail.Archive,!1,t)},onClickDeleteGmail:function(){var e=this.item,t=e.getAttachmentByType(n.a.PluginType.Email).getPlugin(),a=t.isItemFullTrashed(e);this.hasSelection?this.props.pane.deleteSelected(t.isGmailItem,!a):t.isGmailItem(e)&&(this.onClickDeleteCalendar(),e.deleteSelf(ChangeType.Local))},onClickPrefix:function(e){i.default.vmMain.applyPrefixToSelection(e,!this.hasSelection&&this.item)},onViewInDrive:function(){var e=this.item.getAttachmentByPlugin(PluginID.Drive),t=e.getPlugin(),a=e.getData();if(a&&a.parents){var r=a.parents[0];if(r){var n=r.id,s=t.createFolderURL(n);i.default.openUrl(s)}}},renderMenuDate:function(){return o.a.createElement("span",null,o.a.createElement(m.a,{icon:"icon-calendar",hotkey:r.a.secModKeyForce+" + C",onClick:this.onClickAddCalendar},"Add to Google Calendar"))},renderMenuNote:function(){return o.a.createElement("span",null,o.a.createElement(m.a,{icon:"icon-edit",hotkey:"Shift + Enter",onClick:this.onClickNote},"Edit"),o.a.createElement(m.a,{icon:"icon-delete",onClick:this.onClickDelete},"Delete"))},renderMenuDefault:function(){var e,t=this.props.pane,a=this.item,s=this.mod,l=this.priMod,d=t.isViewDates(),c=!t.isViewCalendar(),u=t.supportIndent&&!a.isNote()&&0!==a.getIndex()&&!t.search.isFlatSearchResult(a),f=t.supportIndent&&!a.isNote()&&a.parent()!==i.default.focusedItem&&!(t.search.isFlatSearchResult(a)||t.search.isFlatSearchResult(a.parent()));if(i.default.vmMain.getDefaultCalendarPlugin()&&a.date())if(a.hasAttachmentType(n.a.PluginType.Calendar)){var g=a.getAttachmentByType(n.a.PluginType.Calendar);e=o.a.createElement(m.a,{icon:"icon-delete",disabled:!g.getPlugin().hasWritePermissionForAttach(g),onClick:this.onClickDeleteCalendar},"Delete Event")}else e=o.a.createElement(m.a,{icon:"icon-calendar",hotkey:c&&r.a.secModKeyForce+" + C",onClick:this.onClickAddCalendar},"Add to Google Calendar");return o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,{icon:"icon-check",hotkey:c&&s+" + /",onClick:this.onClickComplete},a.isComplete()?"Uncomplete":"Complete"),o.a.createElement(m.a,{icon:"icon-zoom-in",hotkey:c&&l+" + Enter",onClick:this.onClickZoom},"Zoom In"),o.a.createElement(m.a,{icon:"icon-star",hotkey:c&&s+" + 8",onClick:this.onClickStar},a.isStarred()?"Unstar":"Star"),o.a.createElement(p.a,{hotkey:c&&s+" + #"},"Priority"),o.a.createElement("div",{className:"horizontalMenu"},o.a.createElement(h.a,{className:"c-border-heavy",id:"itemPriorityNone",width:24,height:24,tooltip:c&&s+" + 0",onClick:this.onClickPriority.bind(this,VMLIFlag.None)}),o.a.createElement(h.a,{className:"c-border-heavy",id:"itemPriorityLow",width:24,height:24,tooltip:c&&s+" + 3",onClick:this.onClickPriority.bind(this,VMLIFlag.P2)}),o.a.createElement(h.a,{className:"c-border-heavy",id:"itemPriorityMed",width:24,height:24,tooltip:c&&s+" + 2",onClick:this.onClickPriority.bind(this,VMLIFlag.P1)}),o.a.createElement(h.a,{className:"c-border-heavy",id:"itemPriorityHigh",width:24,height:24,tooltip:c&&s+" + 1",onClick:this.onClickPriority.bind(this,VMLIFlag.P0)})),o.a.createElement(p.a,null,"Item Type"),o.a.createElement("div",{className:"horizontalMenu"},o.a.createElement(h.a,{className:"c-border-heavy",iconSize:14,width:24,height:24,tooltip:"None",onClick:this.onClickPrefix.bind(this,null)}),o.a.createElement(h.a,{className:"c-border-heavy",icon:"icon-hash",iconSize:16,width:24,height:24,tooltip:"Project",onClick:this.onClickPrefix.bind(this,n.a.Prefix.Header)}),o.a.createElement(h.a,{className:"c-border-heavy",icon:"icon-check",iconSize:15,width:24,height:24,tooltip:"Task",onClick:this.onClickPrefix.bind(this,n.a.Prefix.Task)}),o.a.createElement(h.a,{className:"c-border-heavy",icon:"icon-bullet",iconSize:28,width:24,height:24,tooltip:"Bullet",onClick:this.onClickPrefix.bind(this,n.a.Prefix.Bullet)}),o.a.createElement(h.a,{className:"c-border-heavy",icon:"icon-numlist",iconSize:13,width:24,height:24,tooltip:"Numbered List",onClick:this.onClickPrefix.bind(this,n.a.Prefix.NumList)})),e&&o.a.createElement("hr",null),e,o.a.createElement("hr",null),u&&o.a.createElement(m.a,{icon:"icon-format_indent_increase",hotkey:"Tab",onClick:this.onClickIndent.bind(this,!1)},"Indent"),f&&o.a.createElement(m.a,{icon:"icon-format_indent_decrease",hotkey:"Shift + Tab",onClick:this.onClickIndent.bind(this,!0)},"Unindent"),!d&&o.a.createElement(m.a,{icon:"icon-align-left",hotkey:r.a.secModKeyForce+" + M",onClick:this.onClickMove},"Move"),o.a.createElement("hr",null),!d&&o.a.createElement(m.a,{icon:"icon-sticky-note-o",hotkey:"Shift + Enter",onClick:this.onClickNote},"Add Note"),o.a.createElement(m.a,{icon:"icon-zoom-in-plus",onClick:this.onClickZoomNewPane},"Open in New Pane"),o.a.createElement(m.a,{icon:"icon-keyboard-tab",hotkey:c&&s+" + G",onClick:this.onClickGoto},"Go to in all panes"),o.a.createElement("hr",null),o.a.createElement(m.a,{icon:"icon-task",onClick:this.onClickArchive},"Archive Item"),o.a.createElement(m.a,{icon:"icon-delete",onClick:this.onClickDelete},"Delete"))},renderMenuArchived:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,{icon:"icon-task",onClick:this.onClickUnarchive},"Unarchive"),o.a.createElement(m.a,{icon:"icon-delete",onClick:this.onClickDelete},"Delete"))},renderMenuDrive:function(){var e=this.props.pane,t=this.item,a=t.isCollapsed(e,!1),i=e.supportCollapsing&&(t.isHeader()||t.hasChildren()),r=t.isHeader()||t.hasChildren();return o.a.createElement(o.a.Fragment,null,e.plugin&&o.a.createElement(m.a,{disabled:!i,icon:a?"icon-add":"icon-minus",hotkey:this.mod+" + ,",onClick:this.onClickCollapse},a?"Uncollapse":"Collapse"),e.plugin&&o.a.createElement(m.a,{disabled:!r,icon:"icon-zoom-in",hotkey:this.priMod+" + Enter",onClick:this.onClickZoom},"Zoom In"),o.a.createElement(m.a,{onClick:this.onViewInDrive},"View in Drive"),!e.plugin&&o.a.createElement("hr",null))},renderMenuGCalendar:function(e){return e.getPlugin().hasWritePermissionForAttach(e)?o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,{icon:"icon-check",onClick:this.onClickComplete},e.getField("isComplete")?"Uncomplete":"Complete"),o.a.createElement(m.a,{icon:"icon-task",onClick:this.onClickArchive},e.getField("isArchived")?"Unarchive":"Archive"),o.a.createElement("hr",null),o.a.createElement(m.a,{className:"mat-subheader"},"Priority"),o.a.createElement("div",{id:"contextMenuPriority",className:"horizontalMenu"},o.a.createElement(h.a,{className:"c-border-heavy",id:"itemPriorityNone",onClick:this.onClickPriority.bind(this,VMLIFlag.None)}),o.a.createElement(h.a,{className:"c-border-heavy",id:"itemPriorityLow",onClick:this.onClickPriority.bind(this,VMLIFlag.P2)}),o.a.createElement(h.a,{className:"c-border-heavy",id:"itemPriorityMed",onClick:this.onClickPriority.bind(this,VMLIFlag.P1)}),o.a.createElement(h.a,{className:"c-border-heavy",id:"itemPriorityHigh",onClick:this.onClickPriority.bind(this,VMLIFlag.P0)})),o.a.createElement("hr",null),o.a.createElement(m.a,{icon:"icon-delete",onClick:this.onClickDeleteCalendar},"Delete Event")):o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,{icon:"icon-warning"},"Read-Only Event"))},renderMenuGmail:function(e){var t=this.item,a=this.mod,i="PaneGmail"===this.props.pane.type,r=e.getPlugin(),n=r.isItemUnread(t),s=r.isItemStarred(t),l=r.isItemArchived(t),d=r.isItemFullTrashed(t),c=u.a.isLinkedAccountAuthorized(e.getField("accountID"),GScope.GmailModify),f=o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,{icon:"icon-reply",hotkey:i&&"R",onClick:this.onClickReply},"Reply"),o.a.createElement(m.a,{icon:"icon-reply-all",hotkey:i&&"Shift + R",onClick:this.onClickReplyAll},"Reply All"),o.a.createElement(m.a,{icon:"icon-forward",hotkey:i&&"F",onClick:this.onClickForward},"Forward"),o.a.createElement("hr",null));return o.a.createElement(o.a.Fragment,null,f,i&&o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,{icon:n?"icon-drafts":"icon-unread",iconSize:14,hotkey:n?"":"U",onClick:this.onClickRead},n?"Mark as read":"Mark as unread"),o.a.createElement(m.a,{icon:"icon-star",hotkey:i?"8":a+" + 8",onClick:this.onClickStarGmail},s?"Unstar":"Star"),o.a.createElement("hr",null),o.a.createElement(m.a,{className:"mat-subheader",hotkey:a+" + #"},"Priority"),o.a.createElement("div",{id:"contextMenuPriority",className:"horizontalMenu"},o.a.createElement(h.a,{className:"c-border-heavy",id:"itemPriorityNone",onClick:this.onClickPriority.bind(this,VMLIFlag.None)}),o.a.createElement(h.a,{className:"c-border-heavy",id:"itemPriorityLow",onClick:this.onClickPriority.bind(this,VMLIFlag.P2)}),o.a.createElement(h.a,{className:"c-border-heavy",id:"itemPriorityMed",onClick:this.onClickPriority.bind(this,VMLIFlag.P1)}),o.a.createElement(h.a,{className:"c-border-heavy",id:"itemPriorityHigh",onClick:this.onClickPriority.bind(this,VMLIFlag.P0)})),o.a.createElement("hr",null),o.a.createElement(m.a,{disabled:!c,icon:"icon-access_time",hotkey:"D",onClick:this.onClickSnooze},"Snooze"),o.a.createElement(m.a,{icon:"icon-tag",hotkey:i&&"L",onClick:this.onClickLabel},"Label"),o.a.createElement(m.a,{icon:"icon-check",hotkey:"T",onClick:this.onClickCreateTask},"Create Task"),o.a.createElement(m.a,{icon:"icon-align-left",hotkey:"M",onClick:this.onClickMove},"Add to Outline"),o.a.createElement(m.a,{icon:"icon-calendar",hotkey:"C",onClick:this.onClickSchedule},"Add To Calendar"),o.a.createElement("hr",null),o.a.createElement(m.a,{disabled:d,icon:"icon-task",hotkey:"E",onClick:this.onClickArchiveGmail},l?"Unarchive":"Archive"),o.a.createElement(m.a,{disabled:d,icon:"icon-delete",hotkey:i&&"Backspace",onClick:this.onClickDeleteGmail},d?"Undelete":"Delete")))},render:function(){var e,t,a=this.props,r=a.pane,s=this.item,l=a.element,d=i.default.getPluginForElement(l);if(d){var c=d.getAttribute("plugin");if(s.hasPluginAttachment(c))switch(c){case PluginID.Drive:t=this.renderMenuDrive();break;case PluginID.GCalendar:t=this.renderMenuGCalendar(s.getAttachmentByPlugin(c));break;case PluginID.Gmail:t=this.renderMenuGmail(s.getAttachmentByPlugin(c))}r.plugin||(e=t,t=void 0)}else if(i.default.hasClass(l,"date")){i.default.vmMain.getDefaultCalendarPlugin()&&(t=s.hasAttachmentType(n.a.PluginType.Calendar)?this.renderMenuGCalendar(s.getAttachmentByPlugin(PluginID.GCalendar)):this.renderMenuDate())}else s.isNote()&&(t=this.renderMenuNote());if(!t){var u=r.getContextMenuMode(s);switch(u){case n.a.ContextMenuMode.Default:t=this.renderMenuDefault();break;case n.a.ContextMenuMode.Archived:t=this.renderMenuArchived();break;case n.a.ContextMenuMode.Gmail:t=this.renderMenuGmail(s.getAttachmentByPlugin(PluginID.Gmail));break;case n.a.ContextMenuMode.Calendar:t=this.renderMenuGCalendar(s.getAttachmentByPlugin(PluginID.GCalendar));break;default:try{i.default.PAssert(2592,!1,"Unknown context menu mdoe: "+u)}catch(e){i.default.reportError(e)}}}return o.a.createElement(f.a,{id:"contextMenuItem",element:a.element,supportArrows:!0,pos:a.pos,noBackdrop:a.noBackdrop},e,t)}});t.default=g},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(4),s=a(7),o=a(17),l=a(15),d=a(2),c=a.n(d),u=a(3),h=a(13),f=a(14),p=a(12),m=a(16),g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},v=u.a.createClass({displayName:"ReactContextMenuOnlineStatus",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({syncTimes:{}}),i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail).getAllLastSyncTimes(function(e){this.syncTimes.set(e)}.bind(this)),this.listenTo(f.a.onAccountsUpdated)},getState:function(){var e=i.default.vmMain,t=e.gdriveStatus(),a={gDriveStatus:e.gDriveStatusObs,lastChangeTime:o.a.lastChangeTime,lastSyncText:this.getLastSyncText(),isOnline:t!==DriveStatus.Offline,undoRedoDisabled:!e.canRunUndoRedo(),isTrashed:e.docManager.isOpenDocTrashed(),hasTrashedDocs:e.docManager.hasTrashedDocuments(),isBlocked:i.default.hasOnlineBlockingError(),isCookiesBlocked:i.default.hasCookieBlockingError(),supportsOffline:!!window.applicationCache,overQuota:s.a.overQuota,nearQuota:!s.a.overQuota&&n.a.isNearStorageQuota,hasUnsavedData:o.a.hasPotentialUnsavedData(),cacheRatioWarning:!s.a.overQuota&&parseFloat(i.default.vmMain.pluginManager.getCacheSizeRatio())<.6,isConnected:t===DriveStatus.Saving||t===DriveStatus.Saved};return a.hasWarning=a.isTrashed||a.hasTrashedDocs||a.overQuota||a.nearQuota||a.hasUnsavedData||a.isBlocked||a.isCookiesBlocked||a.undoRedoDisabled||a.cacheRatioWarning||!a.supportsOffline,a},getLastSyncText:function(){var e,t=o.a.lastChangeTime.get();t>0?e="Last Sync: "+new Date(t).toString(h.a.getFormat(DFormat.LongDayTime)):e="Not synced";return e},_handleTrashClick:function(e){var t="https://drive.google.com/drive/u/"+i.default.vmMain.getUserEmail()+"/search?q=mimetype=application/vnd.google-apps.drive-sdk.597847337936%20is:trashed";i.default.openUrl(t,e)},_handleQuotaOverClick:function(){i.default.toasts.pushMessage({text:"Your computer's offline storage quota has been exceeded. Please try freeing space on your device. Offline access will not work.",action:MessageAction.Okay})},_handleQuotaNearClick:function(){i.default.toasts.pushMessage({text:"Your computer's offline storage quota is almost exceeded. Please try freeing space on your device, running out will cause offline access to not work.",action:MessageAction.Okay})},_handleUnsavedClick:function(){i.default.toasts.pushMessage({text:"Your local changes have been unable to be persisted to disk and have not been saved remotely. You must reconnect to the internet to save them. Free up disk space to prevent this happening.",action:MessageAction.Okay})},_handleRatioClick:function(){i.default.toasts.pushMessage({text:"Due to low disk space your cache size was restricted. View your General Settings to reset your cache size.",action:MessageAction.OpenGeneralSettings})},_handleBlockClick:function(){},_handleCookiesClick:function(){},_handleStatusClick:function(){this.state.isConnected||l.a.ensureDocConnection()},_handleIconWarningClick:function(e){try{i.default.PAssert(2588,!0,"User should never see account warnings on mobile")}catch(e){i.default.reportError(e)}f.a.isDefaultEmail(e)?i.default.menus.openSettings(r.a.SettingsSections.Plugins):i.default.menus.openSettings(r.a.SettingsSections.Linked)},componentDidUpdate:function(){this.refs.menu.updateState()},_renderAccounts:function(){var e,t,a,r,n=this.state,s=[];for(var o in n.syncTimes)if(n.syncTimes.hasOwnProperty(o)){var l=n.syncTimes[o];if(e=void 0,t=void 0,a=void 0,r=l?o+": "+l.toString(h.a.getFormat(DFormat.ShortDayTime)):o+": Not synced",f.a.isConnected()){var d=f.a.getAccountError(o);if(d)e="icon-warning",t=d,a=this._handleIconWarningClick.bind(this,o);else i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail).verifyAuthorization(o).length>0&&(e="icon-warning",t="Missing authorization",a=this._handleIconWarningClick.bind(this,o))}s.push(c.a.createElement(m.a,{key:o,icon:e,iconTooltip:t,onClickIcon:a},r))}return s.length>0&&c.a.createElement("div",null,c.a.createElement("hr",null),c.a.createElement(m.a,{className:"onlineStatusHeader"},"Email accounts"),s)},render:function(){var e=this.state,t=this._renderAccounts();return c.a.createElement(p.a,g({},this.props,{ref:"menu",key:"contextMenuOnlineStatus",id:"contextMenuOnlineStatus",element:this.props.element}),c.a.createElement(m.a,{className:"onlineStatusHeader"},"File Content"),c.a.createElement(m.a,{tooltip:"Force Reconnect",onClick:this._handleStatusClick},e.lastSyncText),e.hasWarning&&c.a.createElement("div",null,c.a.createElement("hr",null),c.a.createElement(m.a,{className:"onlineStatusHeader"},"Warnings"),e.isBlocked&&c.a.createElement(m.a,{tooltip:"Learn More",onClick:this._handleBlockClick},i.default.blockedMessage),e.isCookiesBlocked&&c.a.createElement(m.a,{tooltip:"Learn More",onClick:this._handleCookiesClick},"Cookies are blocked. Unable to keep you logged in."),!e.supportsOffline&&c.a.createElement(m.a,{tooltip:"Learn More",onClick:this._handleOfflineClick},"Your browser does not support offline access"),e.isTrashed&&c.a.createElement(m.a,{tooltip:"View Trash",onClick:this._handleTrashClick},"Document is in the trash"),e.hasTrashedDocs&&c.a.createElement(m.a,{tooltip:"View Trash",onClick:this._handleTrashClick},"Trashed documents detected"),e.overQuota&&c.a.createElement(m.a,{tooltip:"Learn More",onClick:this._handleQuotaOverClick},"Disk quota exceeded"),e.nearQuota&&c.a.createElement(m.a,{tooltip:"Learn More",onClick:this._handleQuotaNearClick},"Nearly out of disk space"),e.hasUnsavedData&&c.a.createElement(m.a,{tooltip:"Learn More",onClick:this._handleUnsavedClick},"Unsaved changes will be lost"),e.cacheRatioWarning&&c.a.createElement(m.a,{tooltip:"Learn More",onClick:this._handleRatioClick},"Your data is not efficiently being cached"),e.undoRedoDisabled&&c.a.createElement(m.a,null,"You cannot undo/redo while offline")),t)}});t.default=v},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(26),d=a(12),c=a(6),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},h=o.a.createClass({displayName:"ReactContextMenuAuthorize",componentDisplay:r.a.ComponentDisplay.Everywhere,onClickEnable:function(){l.a.refresh(),l.a.toggleOfflineFeatures(!0,this.onEnable)},onEnable:function(e){e&&i.default.menus.closeContextMenu()},render:function(){return s.a.createElement(d.a,u({},this.props,{key:"contextMenuAuthorize",id:"contextMenuAuthorize"}),s.a.createElement("div",null,this.props.message),s.a.createElement("div",{className:"center"},s.a.createElement(c.a,{primary:!0,raised:!0,onClick:this.onClickEnable},"ENABLE")))}});t.default=h},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(3),l=a(211),d=(a(32),a(12)),c=a(16),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},h=o.a.createClass({displayName:"ReactContextMenuDocuments",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){var e=i.default.vmMain.vmPicker;return{files:i.default.vmMain.docManager._docList,showError:e.showError,isLoading:e.isLoading}},render:function(){var e=i.default.vmMain.vmPicker,t=this.props,a=this.state;i.default.classNames("flexbox flexvert",{loading:a.isLoading||0===a.files.length});return a.showError?s.a.createElement(d.a,u({},t,{key:"contextMenuDocuments",id:"contextMenuDocuments",supportArrows:!0}),s.a.createElement(c.a,{onClick:e.onTapReloadDocuments.bind(e)},a.showError)):a.isLoading||0===a.files.length?s.a.createElement(d.a,u({},t,{key:"contextMenuDocuments",id:"contextMenuDocuments",loading:!0,supportArrows:!0})):s.a.createElement(d.a,u({},t,{key:"contextMenuDocuments",id:"contextMenuDocuments",supportArrows:!0,maxWidth:360,maxHeight:500}),s.a.createElement(c.a,{id:"addDocument",onClick:e.onTapAddDocument.bind(e),icon:"icon-add",iconSize:18},"New File"),s.a.createElement("hr",null),a.files.map(function(e){return s.a.createElement(l.a,{key:"file_"+e.id,file:e})}))}});t.default=h},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(10),s=a(2),o=a.n(s),l=a(3),d=a(16),c=l.a.createClass({displayName:"ReactFile",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){var e=this.props.file;return{isShared:e._isShared,title:e._title,isOpen:e.isOpen()}},onClickDocumentTitle:function(){var e=this.props.file;i.default.vmMain.vmPicker.openDocument(e),n.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocument})},onClickDocumentSettings:function(){var e=this.props.file;i.default.vmMain.vmPicker.openSharing(e),i.default.sendEvent("Menu","OpenSharing"),n.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocSharing})},render:function(){var e=this.state;return o.a.createElement(d.a,{icon:e.isShared?"icon-user":"icon-settings",active:e.isOpen,selected:this.props.selected,tooltip:"Open "+e.title,iconTooltip:"Share / Rename / Delete",onClick:this.onClickDocumentTitle,onClickIcon:this.onClickDocumentSettings},e.title)}});t.a=c},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(11),d=a(12),c=a(16),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},h=o.a.createClass({displayName:"ReactContextMenuHelp",componentDisplay:r.a.ComponentDisplay.Desktop,componentDidMount:function(){l.a.fireEvent("helpOpened",[])},onClickVideo:function(){var e="https://www.youtube.com/watch?v="+r.a.IntroVideoID;i.default.openUrl(e)},onClickGetStarted:function(){var e=i.default.createPath("help/basics");i.default.openUrl(e)},onClickGTDEmail:function(){var e=i.default.createPath("help/email");i.default.openUrl(e)},onClickAdvancedHelp:function(){i.default.intro.toggle(r.a.HelpMode.Normal)},onClickHotkeys:function(){i.default.intro.toggle(r.a.HelpMode.Hotkeys)},render:function(){return s.a.createElement(d.a,u({},this.props,{key:"contextMenuHelp",id:"contextMenuHelp"}),s.a.createElement(c.a,{className:"helpVideoLink",onClick:this.onClickVideo},s.a.createElement("i",{className:"icon-youtube-play"}),s.a.createElement("div",null,"Introduction Video")),s.a.createElement("hr",null),s.a.createElement(c.a,{onClick:this.onClickGetStarted},"How to get started"),s.a.createElement(c.a,{onClick:this.onClickGTDEmail},"How to GTD your email"),s.a.createElement("hr",null),s.a.createElement(c.a,{onClick:this.onClickAdvancedHelp},"Advanced Help"),s.a.createElement(c.a,{onClick:this.onClickHotkeys},"Hotkeys"))}});t.default=h},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a(0);var i=a(1),r=a(2),n=a.n(r),s=a(3),o=a(63),l=a(12),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},c=s.a.createClass({displayName:"ReactContextMenuShare",componentDisplay:i.a.ComponentDisplay.Desktop,render:function(){return n.a.createElement(l.a,d({},this.props,{key:"contextMenuHeart",id:"contextMenuHeart",element:this.props.element}),n.a.createElement(o.a,{shouldShowInvitedBy:!1}))}});t.default=c},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(96),d=a(21),c=a(16),u=o.a.createClass({displayName:"ReactContextMenuPaneMode",componentDisplay:r.a.ComponentDisplay.Desktop,onChange:function(e){this.props.pane.setName(e)},onEnter:function(){i.default.menus.isContextMenuOpen(this.props.componentName)&&i.default.menus.closeContextMenu(this.props.componentName)},render:function(){return s.a.createElement(l.default,this.props,s.a.createElement(c.a,{className:"namePane c-border",customLayout:!0},s.a.createElement(d.a,{value:this.props.pane.name.get(),placeholder:"Name this pane",height:32,border:!1,padding:{left:16,right:16},onChange:this.onChange,onEnter:this.onEnter})))}});t.default=u},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=a(10),c=(a(11),a(13)),u=a(63),h=a(12),f=(a(30),a(16)),p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},m=l.a.createClass({displayName:"ReactContextMenuOptions",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){},onClickSettings:function(){i.default.menus.openSettings()},onClickDisplaySettings:function(){i.default.menus.openDisplaySettings()},onClickImport:function(){d.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenImport}),i.default.menus.openModalNew(Modals.ImportData)},onClickExport:function(){d.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenExport}),i.default.menus.openModalNew(Modals.ExportData)},onClickRevision:function(){i.default.menus.openModalNew(Modals.RevisionHistory)},onClickFeedback:function(){i.default.menus.openModalNew(Modals.ReportBug)},onClickBlog:function(){i.default.openUrl("/blog/")},onClickLogout:function(){i.default.vmSetup.logoutClicked()},onClickShare:function(){i.default.menus.openContextMenu({componentName:"ReactContextMenuShare",element:this.props.element})},onClickDownloadApp:function(){i.default.openUrl(n.a.getAppDownloadURL())},onClickFile:function(){d.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocumentsMenu}),i.default.menus.openContextMenu({componentName:"ReactContextMenuDocuments",element:this.props.element})},onClickTrial:function(){i.default.menus.openSettings(r.a.SettingsSections.Account)},onClickHelp:function(){i.default.menus.openContextMenu({componentName:"ReactContextMenuHelp",element:this.props.element})},renderContextMenuHeart:function(e){return o.a.createElement(h.a,{key:"contextMenuHeart",id:"contextMenuHeart",element:e.element},o.a.createElement(u.a,{shouldShowInvitedBy:!1}))},render:function(){var e=i.default.billingManager,t=i.default.vmMain.getUserName(),a=i.default.isDemoMode()?"Demo Doc":i.default.settings.get(Settings.gdocTitle),r=e.isTrialState()&&!i.default.settings.get(Settings.trialOverHidden),s=e.isTrialOver(),l=e.daysLeftInTrial.get(),d=+window.__jsVersion;return o.a.createElement(h.a,p({},this.props,{key:"contextMenuOptions",id:"contextMenuOptions",supportArrows:!0}),o.a.createElement(f.a,{icon:"icon-folder",onClick:this.onClickFile},a),o.a.createElement("hr",null),o.a.createElement(f.a,{onClick:this.onClickSettings},"Settings"),o.a.createElement(f.a,{onClick:this.onClickDisplaySettings},"Display Settings"),o.a.createElement("hr",null),o.a.createElement(f.a,{onClick:this.onClickHelp},"Help"),o.a.createElement("hr",null),o.a.createElement(f.a,{onClick:this.onClickImport},"Import Data"),o.a.createElement(f.a,{onClick:this.onClickExport},"Export Data"),o.a.createElement(f.a,{onClick:this.onClickRevision},"Revision History"),o.a.createElement("hr",null),o.a.createElement(f.a,{onClick:this.onClickFeedback},"Contact Support"),o.a.createElement(f.a,{onClick:this.onClickBlog},"Moo.do Blog"),o.a.createElement(f.a,{onClick:this.onClickShare},"Share Moo.do"),n.a.canDownloadNativeApp()&&o.a.createElement(f.a,{onClick:this.onClickDownloadApp},"Get "+n.a.getPlatformName()+" app"),o.a.createElement("hr",null),r&&o.a.createElement(f.a,{className:s?"error":"",onClick:this.onClickTrial},s?"Trial over":"Trial: "+l+" days"),o.a.createElement(f.a,{onClick:this.onClickLogout},"Logout"),o.a.createElement(f.a,{className:"username",faded:!0},t),o.a.createElement(f.a,{className:"useremail",faded:!0},i.default.getUserIdentifier()),!isNaN(d)&&o.a.createElement(f.a,{customLayout:!0,faded:!0},o.a.createElement("div",null,d),o.a.createElement("div",null,new Date(d).toString(c.a.getFormat(DFormat.ShortDayTime)))))}});t.default=m},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(41),l=(a.n(o),a(3)),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},c={},u=Modals;c[u.Lightbox]=a(217),c[u.Prompt]=a(218),c[u.EmailReply]=a(219),c[u.Settings]=a(222),c[u.Alert]=a(233),c[u.Billing]=a(234),c[u.Confirm]=a(235),c[u.Options]=a(236),c[u.ExportData]=a(237),c[u.ImportData]=a(238),c[u.RevisionHistory]=a(240),c[u.ReportProblem]=a(242),c[u.Welcome]=a(243),c[u.DeleteAccount]=a(244),c[u.Invoices]=a(245),c[u.ShareDoc]=a(246),c[u.ReportBug]=a(247),c[u.EnterCode]=a(248);var h=c,f=l.a.createClass({displayName:"ReactModals",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){return{modals:i.default.menus.modalStack}},renderModal:function(e){var t=e.id,a=h[t].default;try{i.default.PAssert(2226,a,"Could not find modal with id "+t)}catch(e){i.default.reportError(e)}return s.a.createElement(a,d({key:e.id},e))},render:function(){for(var e=[],t=0;t<this.state.modals.length;t++)e.push(this.renderModal(this.state.modals[t]));var a=i.default.classNames("modals",{none:0===e.length});return s.a.createElement(o.CSSTransitionGroup,{className:a,transitionName:"modalTransition",transitionEnterTimeout:400,transitionLeaveTimeout:300},e)}});t.a=f},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=a(22),c=a(6),u=a(40),h=l.a.createClass({displayName:"ReactModalLightbox",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({isLoaded:!1,error:!1})},onLoaded:function(){this.isLoaded.set(!0)},onError:function(){this.isLoaded.set(!0,!1),this.error.set("Could not load image")},openExternal:function(){this.props.buttonAction?this.props.buttonAction():i.default.openUrl(this.props.src),this.close()},close:function(){this.refs.modal.close()},render:function(){var e=this.props,t=this.state,a=e.src,r={maxWidth:Math.min(.95*n.a.windowWidth(),900),maxHeight:Math.min(.95*n.a.windowHeight()-30,900),visibility:!t.isLoaded&&"hidden"},s=i.default.classNames({loaded:t.isLoaded});return o.a.createElement(d.a,{id:"modalLightbox",className:s,closeButton:!1,scrollable:!1,modalID:Modals.Lightbox,ref:"modal"},o.a.createElement("div",{key:"content"},!t.isLoaded&&o.a.createElement(u.a,{center:!0}),!t.error&&o.a.createElement("img",{src:a,style:r,onLoad:this.onLoaded,onError:this.onError,onClick:this.close,ref:"image"}),t.error&&o.a.createElement("div",{className:"lightboxText"},t.error),t.isLoaded&&o.a.createElement(c.a,{id:"lightboxOpen",className:"c-border-heavy",primary:!0,height:30,onClick:this.openExternal},e.buttonText||(n.a.app?"Open in browser":"Open in new tab"))))}});t.default=h},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),r=a.n(i),n=a(3),s=a(25),o=a(1),l=a(6),d=a(21),c=a(22),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},h=n.a.createClass({displayName:"ReactModalPrompt",componentDisplay:o.a.ComponentDisplay.Everywhere,getHotkeys:function(){return[s.a.create(KeyCode.Enter,!0,o.a.Primary.Either,o.a.Shift.Either,this.onClickYes)]},onClickYes:function(){this.refs.modal.close(this.refs.input.getValue())},onClickNo:function(){this.refs.modal.close(!1)},render:function(){return r.a.createElement(c.a,u({},this.props,{id:"modalPrompt",title:this.props.text,small:!0,scrollable:!1,modalID:Modals.Prompt,ref:"modal"}),r.a.createElement("div",{key:"content"},r.a.createElement(d.a,{focused:!0,ref:"input"})),r.a.createElement("div",{key:"buttons"},r.a.createElement(l.a,{primary:!0,width:100,onClick:this.onClickYes},"OK"),r.a.createElement(l.a,{width:100,onClick:this.onClickNo},"NO")))}});t.default=h},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),r=a.n(i),n=a(3),s=a(1),o=a(28),l=a(64),d=(a(6),a(22)),c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},u=n.a.createClass({displayName:"ReactModalEmailReply",componentDisplay:s.a.ComponentDisplay.Everywhere,componentDidMount:function(){var e=this.props,t=this.refs.compose;setTimeout(function(){e.responseMode===s.a.EmailResponseMode.Forward?t.focusTo():t.focusBody()},250)},onUnmount:function(){o.a.setMessageResponseMode(this.props.inReplyToMessage.id,s.a.EmailResponseMode.None)},onClickSend:function(){this.refs.compose.send(),this.refs.modal.close()},onComposeClose:function(){var e=this.refs.modal;e&&e.close()},onCloseButton:function(){this.refs.compose.discard()},_getModalTitle:function(e){var t;return e===s.a.EmailResponseMode.Reply?t="Reply":e===s.a.EmailResponseMode.ReplyAll?t="Reply All":e===s.a.EmailResponseMode.Forward?t="Forward":e===s.a.EmailResponseMode.Other&&(t="Compose"),t},render:function(){var e=this.props,t=e.responseMode,a=this._getModalTitle(t);return r.a.createElement(d.a,c({},e,{id:"modalEmailReply",title:a,modalID:Modals.EmailReply,ref:"modal",confirmIcon:"icon-send",onConfirm:this.onClickSend,onCloseButton:this.onCloseButton}),r.a.createElement(l.a,{key:"content",threadAttach:e.threadAttach,message:e.message,ref:"compose",onClose:this.onComposeClose,responseMode:this.state.responseMode}))}});t.default=u},function(e,t,a){"use strict";var i=a(1),r=(a(0),a(4)),n=a(2),s=a.n(n),o=a(3),l=(a(6),o.a.createClass({displayName:"FancyProgressBar",componentDisplay:i.a.ComponentDisplay.Desktop,render:function(){var e=this.props,t={height:e.height},a={};a[r.a.transform.react]="scale("+e.percent+", 1)";var i={lineHeight:e.height-2+"px"};return s.a.createElement("div",{className:"fancyProgressBar",style:t},!e.error&&s.a.createElement("div",{className:"fancyProgressInside",style:a}),e.error&&s.a.createElement("div",{className:"fancyProgressError",style:i},e.errorMsg))}}));t.a=l},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(23),d=o.a.createClass({displayName:"FancyContenteditable",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({isFocused:this.props.focused||!1})},componentDidMount:function(){this.props.focused&&requestAnimationFrame(function(){this.refs.div.focus()}.bind(this))},onUnmount:function(){this.isFocused.get()&&this.onBlur()},focus:function(){i.default.isDemoRunning||this.refs.div.focus()},blur:function(){this.refs.div.blur()},setValue:function(e){this.refs.div.innerHTML=e},getValue:function(){return this.refs.div.innerHTML},getTextValue:function(){return this.refs.div.innerText},getElement:function(){return this.refs.div},insertCharAtIndex:function(e,t){var a=this.refs.div,i=a.innerHTML;i=i.substr(0,t)+e+i.substr(t,i.length),a.innerHTML=i,l.a.selectElement(a,t+1),this.props.onChange&&this.props.onChange()},onFocus:function(e){i.default.vmMain.activeInput.set(this),this.isFocused.set(!0),this.props.onFocus&&this.props.onFocus(e)},onBlur:function(e){i.default.vmMain.activeInput.set(null),this.isFocused.set(!1),this.props.onBlur&&this.props.onBlur(e)},hasFocus:function(){return this.isFocused.get()},onEscapeKey:function(){this.props.onEscape&&this.props.onEscape()},onDrop:function(e){this.props.onDrop&&this.props.onDrop(e.dataTransfer)},onDragEnter:function(){this.props.onDrop&&i.default.addClass(this.refs.div,"dragTarget")},onDragLeave:function(){this.props.onDrop&&i.default.removeClass(this.refs.div,"dragTarget")},insertNode:function(e){this.focus(),l.a.deleteRangeContents(),l.a.insertNode(e),l.a.selectAfterNode(e)},render:function(){var e=this.props,t=i.default.classNames("fancyContenteditable",e.className),a=e.spellCheck?"true":null;return s.a.createElement("div",{contentEditable:!1!==e.editable,className:t,style:this.props.style,ref:"div",spellCheck:a,onInput:e.onChange,onClick:e.onClick,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onDrop:this.onDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave})}});t.a=d},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(3),l=a(26),d=a(14),c=a(63),u=a(223),h=a(224),f=a(225),p=a(226),m=a(227),g=a(228),v=a(229),y=a(230),S=a(231),E=a(22),P=a(56),b=o.a.createClass({displayName:"ReactModalSettings",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({sectionOpened:this.props.section||r.a.SettingsSections.Plugins}),l.a.refresh(),l.a.getPluginEnabledObservable(PluginID.GCalendar).listen(this.onToggleGCal)},getState:function(){for(var e={},t=l.a.pluginsAvailable,a=0;a<t.length;++a){var i=t[a];e[i+"Enabled"]=l.a.getPluginEnabledObservable(i)}return e},onToggleGCal:function(e){e&&setTimeout(function(){this.openSection(r.a.SettingsSections.GoogleCalendar)}.bind(this),0)},openSection:function(e){var t=!l.a.isSaveEnabled.get();t||i.default.menus.confirm("You have unsaved changes. Are you sure you want to cancel your changes?",function(t){t&&(l.a.isSaveEnabled.set(!1),this.openSection(e))}.bind(this)),t&&this.sectionOpened.set(e)},showEarlyAndAccount:function(){return!i.default.isDemoMode()||!1},_checkLinkedAccountErrors:function(){for(var e=!1,t=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail).getSyncAccounts(),a=0;a<t.length;++a){var r=t[a];if(d.a.isConnected())d.a.getAccountError(r)&&(e=!0)}return e},_checkSectionError:function(e){var t=!1;switch(e){case r.a.SettingsSections.Linked:t=this._checkLinkedAccountErrors()}return t},renderListItem:function(e,t){var a,r=this._checkSectionError(e);if(r){var n=i.default.classNames("error","icon-warning");a=s.a.createElement("span",null,s.a.createElement("span",{className:n}),s.a.createElement("span",null,"\t"+e))}else a=s.a.createElement("span",null,"\t"+e);return s.a.createElement(P.a,{className:t&&!r?"indented":null,selected:this.state.sectionOpened===e,onClick:this.openSection.bind(this,e)},a)},renderPluginListItem:function(e,t){var a,r=i.default.vmMain.pluginManager.getPlugin(e),n=r&&r.hasSettingsError();if(n){var o=i.default.classNames("error","icon-warning");a=s.a.createElement("span",null,s.a.createElement("span",{className:o}),s.a.createElement("span",null,"\t"+t))}else a=s.a.createElement("span",null,"\t"+t);return s.a.createElement(P.a,{className:n?null:"indented",selected:this.state.sectionOpened===t,onClick:this.openSection.bind(this,t)},a)},isPluginEnabled:function(e){return this.state[e+"Enabled"]},render:function(){i.default.billingManager;var e,t,a=this.state.sectionOpened;switch(a){case r.a.SettingsSections.General:t=u.a;break;case r.a.SettingsSections.Plugins:t=h.a;break;case r.a.SettingsSections.Invite:t=c.a;break;case r.a.SettingsSections.EarlyAccess:t=p.a;break;case r.a.SettingsSections.Account:t=f.a;break;case r.a.SettingsSections.Linked:t=m.a;break;case r.a.SettingsSections.GoogleCalendar:t=g.a;break;case r.a.SettingsSections.Contacts:t=v.a;break;case r.a.SettingsSections.Gmail:t=y.a;break;case r.a.SettingsSections.Agenda:t=S.a;break;default:try{i.default.PAssert(2572,!1,"Unknown settings sections requested: ",a)}catch(e){i.default.reportError(e)}}e=s.a.createElement(t,{key:"content",openSection:this.openSection});var n="Settings - "+this.sectionOpened.get();return s.a.createElement(E.a,{id:"modalSettings",title:n,width:960,height:900,modalID:Modals.Settings},s.a.createElement("div",{key:"sidebar",width:170},this.renderListItem(r.a.SettingsSections.General),this.renderListItem(r.a.SettingsSections.Agenda),this.showEarlyAndAccount()&&this.renderListItem(r.a.SettingsSections.Account),this.renderListItem(r.a.SettingsSections.Plugins),this.isPluginEnabled(PluginID.GCalendar)&&this.renderPluginListItem(PluginID.GCalendar,r.a.SettingsSections.GoogleCalendar),this.isPluginEnabled(PluginID.Contacts)&&this.renderPluginListItem(PluginID.Contacts,r.a.SettingsSections.Contacts),this.isPluginEnabled(PluginID.Gmail)&&this.renderPluginListItem(PluginID.Gmail,r.a.SettingsSections.Gmail),this.showEarlyAndAccount()&&this.renderListItem(r.a.SettingsSections.Linked),this.renderListItem(r.a.SettingsSections.EarlyAccess),this.renderListItem(r.a.SettingsSections.Invite)),e)}});t.default=b},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(4),d=a(13),c=a(33),u=a(6),h=a(55),f=o.a.createClass({displayName:"ReactModalSettingsGeneral",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({isStoragePersisted:!1,usage:NaN,quota:NaN}),l.a.isStoragePersisted(function(e){this.isStoragePersisted.set(e)}.bind(this)),l.a.estimateAvailableStorage(function(e){this.usage.set(e.usage),this.quota.set(e.quota)}.bind(this),function(){})},onNotificationsChanged:function(e){i.default.settings.set(Settings.disableNotifications,!e),e?l.a.usesHTML5Notifications()?l.a.hasNotificationPermission()||Notification.requestPermission(function(e){"granted"===e?i.default.timeline.updateNotifications():(i.default.settings.set(Settings.disableNotifications,!0),this.refs.notifications.setValue(!1),i.default.toasts.pushMessage({text:"To enable notifications in the future, you must first give permission in your browser.",action:MessageAction.OpenURL,actionText:"LEARN MORE",data:{url:"https://support.google.com/chrome/answer/6148059"}}))}.bind(this)):i.default.timeline.updateNotifications():i.default.timeline.clearNotifications()},onCacheRatioClick:function(){this.getCacheRatio()<.98&&(i.default.settings.set(Settings.cacheSizeRatio,1),i.default.sendEvent("CacheRatio","Changed",1),i.default.toasts.pushMessage({text:"Success!",action:MessageAction.Okay}))},onDelayChanged:function(e){i.default.settings.set(Settings.notificationDelay,e),i.default.sendEvent("NotificationDelay","Changed",e)},onSettingChanged:function(e,t){i.default.settings.set(e,t)},parseFn:function(e){return parseFloat(e.toFixed(2))},getCacheRatio:function(){return this.parseFn(i.default.vmMain.pluginManager.getCacheSizeRatio())},onPersistClick:function(){l.a.requestStoragePersistence(function(){this.isStoragePersisted.set(!0)}.bind(this),function(){this.isStoragePersisted.set(!1)}.bind(this))},onChangeDateFormat:function(){var e=this.refs.selectDateFormat.value;i.default.settings.set(Settings.dateFormat,e)},onChangeDayWeekStart:function(){i.default.settings.set(Settings.dayWeekStart,+this.refs.selectDayWeekStart.value)},onChangeDefaultItemPrefix:function(){i.default.settings.set(Settings.defaultItemPrefix,this.refs.selectItemPrefix.value)},render:function(){var e=this.getCacheRatio()<.98,t=!l.a.app&&l.a.supportsPersistedStorage(),a=l.a.supportsEstimatedStorage(),n=i.default.settings.get(Settings.notificationDelay),o=!i.default.settings.get(Settings.disableNotifications)&&l.a.hasNotificationPermission(),f=i.default.settings.get(Settings.defaultItemPrefix),p=(this.usage.get()/1024/1024).toFixed(2),m=(this.quota.get()/1024/1024).toFixed(2),g=d.a.getCurrentDateFormat(),v=i.default.settings.get(Settings.dayWeekStart);return s.a.createElement("div",{key:"content",className:"new-modal-group"},s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement("div",{className:"settingsName ib"},"Default item type:"),s.a.createElement("select",{defaultValue:f,ref:"selectItemPrefix",onChange:this.onChangeDefaultItemPrefix},s.a.createElement("option",{value:""},"None"),s.a.createElement("option",{value:r.a.Prefix.Task},"Task"),s.a.createElement("option",{value:r.a.Prefix.Bullet},"Bullet"))),s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement("div",{className:"settingsName ib"},"Date Format:"),s.a.createElement("select",{defaultValue:g,ref:"selectDateFormat",onChange:this.onChangeDateFormat},s.a.createElement("option",{value:r.a.DateFormat.MDY},"Month / Day / Year"),s.a.createElement("option",{value:r.a.DateFormat.DMY},"Day / Month / Year"),s.a.createElement("option",{value:r.a.DateFormat.YMD},"Year / Month / Day"))),s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement("div",{className:"settingsName ib"},"Start week on:"),s.a.createElement("select",{defaultValue:v,ref:"selectDayWeekStart",onChange:this.onChangeDayWeekStart},s.a.createElement("option",{value:0},"Sunday"),s.a.createElement("option",{value:1},"Monday"))),s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement(c.a,{ref:"notifications",checked:i.default.settings.get(Settings.openEvernoteApp),onChange:this.onSettingChanged.bind(this,Settings.openEvernoteApp)},"Open Evernote links in Evernote app")),s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement(c.a,{ref:"notifications",checked:i.default.settings.get(Settings.searchExpandsCollapsed),onChange:this.onSettingChanged.bind(this,Settings.searchExpandsCollapsed)},"Automatically expand collapsed items while searching"),s.a.createElement("div",{className:"subtext",style:{marginLeft:24}},"Collapsed state while searching is separate from normal collapsed state, and search collapse state is cleared when the search is cleared.")),l.a.supportsNotifications()&&s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement(c.a,{ref:"notifications",checked:o,onChange:this.onNotificationsChanged},"Enable notifications"),s.a.createElement("div",{className:"subtext",style:{marginLeft:24}},"Display native notifications for items that use a specific @date and time in their text. These are only displayed for the currently open document on this device."),s.a.createElement("div",{style:{marginTop:16}},s.a.createElement("span",{style:{display:"inline-block",marginLeft:24,width:140}},"Notification Time"),s.a.createElement(h.a,{value:n,minValue:0,maxValue:120,interval:5,onChange:this.onDelayChanged}),s.a.createElement("div",{className:"subtext",style:{marginLeft:24}},"Time in minutes before event to display a notification about the event."))),s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement("div",{className:"modal-group-title"},"Storage / Caching"),t&&!this.isStoragePersisted.get()&&s.a.createElement("div",null,s.a.createElement(u.a,{raised:!0,margin:"16px 0",onClick:this.onPersistClick},"Enable Persistent Storage"),s.a.createElement("div",{className:"subtext"},"Allow Moo.do to store your data offline without potential for the browser to delete it. This can help Moo.do's performance if your disk is low on free-space.")),e&&s.a.createElement("div",null,s.a.createElement(u.a,{raised:!0,margin:"16px 0",onClick:this.onCacheRatioClick},"Reset Cache Ratio"),s.a.createElement("div",{className:"subtext"},"If you have run out of disk space in the past, we may not be efficiently caching your data. If you have resolved any disk space issues, click this button to efficiently cache your data again.")),a&&s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement("div",{className:"modal-group-title"},"Estimated disk usage"),s.a.createElement("div",{className:"subtext"},s.a.createElement("b",null,"Usage: "),Math.round(p)," MB / ",s.a.createElement("b",null,"Quota: "),Math.round(m)," MB"))))}});t.a=f},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(7),a(15),a(2)),s=a.n(n),o=a(3),l=a(26),d=a(14),c=a(33),u=a(6),h=o.a.createClass({displayName:"ReactModalSettingsPlugins",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.pluginsEnabled={},this.pluginOptions={},l.a.refresh()},componentDidMount:function(){this.listenTo(d.a.onAccountsUpdated),this.checkTiers()},getState:function(){for(var e={isSaveEnabled:l.a.isSaveEnabled,premiumStatus:i.default.billingManager._premiumStatus,enableOfflineAuth:l.a.enableOfflineAuth,linkedAccounts:d.a.getLinkedAccounts(),hasError:l.a.enableOfflineAuth.get()&&d.a.isConnected()&&!!d.a.getAccountError(d.a.getDefaultEmail())},t=l.a.pluginsAvailable,a=0;a<t.length;++a){var r=t[a];this.pluginsEnabled[r]=e[r+"Enabled"]=l.a.getPluginEnabledObservable(r);var n=l.a.getPluginOptions(r);for(var s in n)if(n.hasOwnProperty(s)){var o=r+"_"+s;this.pluginOptions[o]=e[o]=n[s]}}return e},openSection:function(e){this.props.openSection(e)},onChangeFree:function(e){this.refs[PluginID.Contacts].setValue(e),this.refs[PluginID.Gmail].setValue(e),this.onChangeFeature()},onChangePremium:function(e){this.refs[PluginID.GCalendar].setValue(e),this.refs[PluginID.Drive].setValue(e),this.refs.DriveShared.setValue(e),this.onChangeFeature()},checkTier:function(e,t){for(var a=0,i=0;i<t.length;i++)this.refs[t[i]].getValue()?a++:a--;a===t.length&&e.setValue(!0),a===-t.length&&e.setValue(!1)},checkTiers:function(){this.checkTier(this.refs.free,[PluginID.Contacts,PluginID.Gmail]),this.checkTier(this.refs.premium,[PluginID.GCalendar,PluginID.Drive,"DriveShared"])},onChangeFeature:function(){l.a.isSaveEnabled.set(!0),this.checkTiers()},onEnablePremium:function(){if(i.default.billingManager.isTrialOver())return this.openSection(r.a.SettingsSections.Account),!1;i.default.billingManager.startTrial()},onClickFixError:function(){l.a.enableOfflineFeatures(function(){l.a.refresh(),this.updateState()}.bind(this))},onClickCancel:function(e){for(var t in this.refs)if(this.refs.hasOwnProperty(t)){var a=this.refs[t];a.checked&&a.resetValue()}this.checkTiers()},onClickSave:function(e,t){var a=[PluginID.Contacts,PluginID.GCalendar,PluginID.Gmail,PluginID.Drive].map(function(e){var t={id:e,enable:!!this.refs[e].getValue()};return e===PluginID.Drive&&(t.shared=!!this.refs.DriveShared.getValue()),t}.bind(this)),i=this.refs.offlineFeatures.getValue(),r=!1;return l.a.setEnabledPlugins(a,i,function(){r=!0,t(),l.a.isSaveEnabled.set(!1)}),!r},renderPluginOptionCheckbox:function(e,t,a,i){return s.a.createElement(c.a,{className:"subcheckbox",ref:t,initialChecked:!!this.state[e+"_"+a],onChange:this.onChangeFeature},i)},renderPluginCheckbox:function(e,t,a){return s.a.createElement(c.a,{ref:e,initialChecked:!!this.state[e+"Enabled"],onChange:this.onChangeFeature},a,t)},render:function(){var e=i.default.billingManager,t=this.state,a=e.hasPremiumFeatures(),n=e.isTrialOver(),o=t.hasError;return s.a.createElement("div",{key:"content",className:"new-modal-group"},s.a.createElement("div",{className:"new-modal-title"},s.a.createElement("div",{className:"title"},"Integrate with your other services"),s.a.createElement("div",{className:"subtext center c-foreground-light"},"Use ",s.a.createElement("b",null,"Moo.do")," to organize everything in one place")),s.a.createElement("div",{className:"setupFeatures featureCheckboxes"},o&&s.a.createElement("div",{className:"new-modal-row new-modal-row-1c settingError"},s.a.createElement("div",{className:"bold"},"Error detected"),s.a.createElement("div",{className:"errorSubtext"},"There is an error with your offline authentication. Click here to fix it."),s.a.createElement("div",{className:"center"},s.a.createElement(u.a,{raised:!0,onClick:this.onClickFixError},"FIX ERROR"))),s.a.createElement("div",{className:"featureTier c-border"},s.a.createElement("div",{className:"tierTitleWrapper"},s.a.createElement(c.a,{ref:"free",className:"tierTitle c-background",initialChecked:!1,onChange:this.onChangeFree},"Free Plugins")),s.a.createElement("div",{className:"flexbox"},s.a.createElement("div",{className:"setupFeatureHalf"},this.renderPluginCheckbox(PluginID.Contacts,"Google Contacts",s.a.createElement("i",{className:"icon-group"})),this.renderPluginCheckbox(PluginID.Gmail,"Gmail",s.a.createElement("img",{src:"/img/plugin-gmail.png"}))),s.a.createElement("div",{className:"setupFeatureHalf"},s.a.createElement("div",{className:"setupFeature"},s.a.createElement(c.a,{ref:"offlineFeatures",initialChecked:!!t.enableOfflineAuth,onChange:this.onChangeFeature},"Offline Features"),s.a.createElement("div",{className:"setupFeatureDesc c-foreground-light"},"Gmail features like Snooze require server access to your account so Moo.do can manage your inbox."))))),s.a.createElement("div",{className:"featureTier c-border"},s.a.createElement("div",{className:"tierTitleWrapper"},s.a.createElement(c.a,{ref:"premium",className:"tierTitle c-background",initialChecked:!1,onChange:this.onChangePremium},"Premium Plugins")),!a&&n&&s.a.createElement("div",{className:"featureTierDesc c-foreground-light"},"Your free trial of Premium has ended. Please signup to continue using premium features or contact support@moo.do to extend."),!a&&!n&&s.a.createElement("div",{className:"featureTierDesc c-foreground-light"},"Enabling Premium features will start a free "+r.a.TrialDuration+" day trial of Moo.do Premium."),s.a.createElement("div",{className:"flexbox"},s.a.createElement("div",{className:"setupFeature setupFeatureHalf"},this.renderPluginCheckbox(PluginID.GCalendar,"Google Calendar",s.a.createElement("img",{src:"/img/plugin-gcal.png"}))),s.a.createElement("div",{className:"setupFeature setupFeatureHalf"},this.renderPluginCheckbox(PluginID.Drive,"Google Drive",s.a.createElement("img",{src:"/img/plugin-gdrive.png"})),this.renderPluginOptionCheckbox(PluginID.Drive,"DriveShared",PluginSettingsID.Drive.WriteAccess,"Share files with collaborators")))),s.a.createElement("div",{className:"setupSubtext"},s.a.createElement("b",null,"Moo.do")," connects with your Google services to integrate everything together. ",s.a.createElement("b",null,"Moo.do")," data is stored in your personal Google Drive account and is never sent to any other server. Nobody can access any of your data. See our ",s.a.createElement("span",{className:"link"},"Privacy Policy")," for more details."),s.a.createElement("div",{className:"setupButtons center"},s.a.createElement(u.a,{raised:!0,primary:!0,onClick:this.onClickSave,enabled:t.isSaveEnabled},"SAVE"),s.a.createElement(u.a,{raised:!0,marginLeft:24,onClick:this.onClickCancel,enabled:t.isSaveEnabled},"RESET"))))}});t.a=h},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(13),d=a(33),c=a(21),u=a(6),h=o.a.createClass({displayName:"ReactModalSettingsAccounts",componentDisplay:r.a.ComponentDisplay.Desktop,getState:function(){var e=i.default.billingManager;return{validBilling:e._hasValidBillingData,premiumStatus:e._premiumStatus,daysLeftInTrial:e.daysLeftInTrial,trialOverHidden:i.default.settings.get(Settings.trialOverHidden),monthlyInvoice:i.default.settings.get(Settings.monthlyInvoice),invoiceEmail:i.default.settings.get(Settings.invoiceEmail),invoiceCompany:i.default.settings.get(Settings.invoiceCompany),invoiceAddress:i.default.settings.get(Settings.invoiceAddress),isUnsubscribed:i.default.settings.get(Settings.isUnsubscribed)}},onClickDismissTrial:function(){i.default.settings.set(Settings.trialOverHidden,!0),this.updateState()},onUnsubscribedChanged:function(e){var t=i.default.settings.get(Settings.isUnsubscribed);i.default.settings.set(Settings.isUnsubscribed,e),e?i.default.XHR_PrivateAPI({type:"POST",path:"/feedback/unsubscribe",data:{email:i.default.vmMain.getUserEmail()},requireAuth:!0,cb:function(a){a.status!==r.a.HTTPStatusCode.Success?(i.default.settings.set(Settings.isUnsubscribed,t),i.default.toasts.pushMessage({text:"There was an error updating your subscription status. Please retry or contact support@moo.do.",actionText:"RETRY",timeout:8e3,action:function(){this.onUnsubscribedChanged(e)}.bind(this)})):i.default.toasts.pushMessage({text:"You have successfully unsubscribed from further emails.",actionText:"OKAY",timeout:2e3})}.bind(this)}):i.default.XHR_PrivateAPI({type:"POST",path:"/feedback/subscribe",data:{email:i.default.vmMain.getUserEmail()},requireAuth:!0,cb:function(a){a.status!==r.a.HTTPStatusCode.Success?(i.default.settings.set(Settings.isUnsubscribed,t),i.default.toasts.pushMessage({text:"There was an error updating your subscription status. Please retry or contact support@moo.do.",actionText:"RETRY",timeout:8e3,action:function(){this.onUnsubscribedChanged(e)}.bind(this)})):i.default.toasts.pushMessage({text:"Success!",actionText:"OKAY",timeout:2e3})}.bind(this)})},onInvoiceEnabledChanged:function(e){this._onInvoiceChanged(e,i.default.settings.get(Settings.invoiceEmail),i.default.settings.get(Settings.invoiceCompany),i.default.settings.get(Settings.invoiceAddress))},onInvoiceEmailChanged:function(e){clearTimeout(this._invoiceEmailTimeout),this._invoiceEmailTimeout=setTimeout(function(){this._onInvoiceChanged(i.default.settings.get(Settings.monthlyInvoice),e,i.default.settings.get(Settings.invoiceCompany),i.default.settings.get(Settings.invoiceAddress)),this._invoiceEmailTimeout=void 0}.bind(this),3e3)},onInvoiceCompanyChanged:function(e){clearTimeout(this._invoiceCompanyTimeout),this._invoiceCompanyTimeout=setTimeout(function(){this._onInvoiceChanged(i.default.settings.get(Settings.monthlyInvoice),i.default.settings.get(Settings.invoiceEmail),e,i.default.settings.get(Settings.invoiceAddress)),this._invoiceCompanyTimeout=void 0}.bind(this),3e3)},onInvoiceAddressChanged:function(e){clearTimeout(this._invoiceAddressTimeout),this._invoiceAddressTimeout=setTimeout(function(){this._onInvoiceChanged(i.default.settings.get(Settings.monthlyInvoice),i.default.settings.get(Settings.invoiceEmail),i.default.settings.get(Settings.invoiceCompany),e),this._invoiceAddressTimeout=void 0}.bind(this),3e3)},_onInvoiceChanged:function(e,t,a,n){var s=i.default.settings.get(Settings.monthlyInvoice),o=i.default.settings.get(Settings.invoiceEmail),l=i.default.settings.get(Settings.invoiceCompany),d=i.default.settings.get(Settings.invoiceAddress);i.default.settings.set(Settings.monthlyInvoice,e),i.default.settings.set(Settings.invoiceEmail,t),i.default.settings.set(Settings.invoiceCompany,a),i.default.settings.set(Settings.invoiceAddress,n),i.default.sendEvent("InvoiceChanged",e);var c=e?1:0;i.default.XHR_PrivateAPI({type:"POST",path:"/billing/invoice",data:{isEnabled:c,invoiceEmail:t,invoiceCompany:a,invoiceAddress:n},requireAuth:!0,cb:function(c){c.status!==r.a.HTTPStatusCode.Success?(i.default.settings.set(Settings.monthlyInvoice,s),i.default.settings.set(Settings.invoiceEmail,o),i.default.settings.set(Settings.invoiceCompany,l),i.default.settings.set(Settings.invoiceAddress,d),i.default.toasts.pushMessage({text:"There was an error updating your invoice status on the server. Please retry in a minute.",actionText:"RETRY",timeout:8e3,action:function(){this._onInvoiceChanged(e,t,a,n)}.bind(this)})):i.default.toasts.pushMessage({text:"Your invoice information was successfully updated.",actionText:"OKAY",timeout:2e3}),this.updateState()}.bind(this)})},render:function(){var e=i.default.billingManager,t=this.state,a=i.default.vmMain.getUserName(),r=i.default.vmMain.getUserEmail(),n=e.getMonthlyPrice(),o=e.getYearlyPrice();return s.a.createElement("div",{key:"content",className:"new-modal-group"},e.isTrialOver()&&!t.trialOverHidden&&s.a.createElement("div",{className:"new-modal-row-1c"},s.a.createElement("div",{className:"new-modal-row trialEnd"},s.a.createElement("div",null,"Your trial has ended. Please sign up to continue using Premium features."),s.a.createElement("div",{className:"center",style:{marginTop:16}},s.a.createElement(u.a,{raised:!0,onClick:this.onClickDismissTrial},"DISMISS"))),s.a.createElement("hr",null)),s.a.createElement("div",{className:"new-modal-title"},s.a.createElement("div",{className:"title"},a&&"Hi "+a),t.validBilling&&e.isTrialState()&&s.a.createElement("div",{className:"subtext center"},"We hope your trial of Premium is going well."),t.validBilling&&e.hasPremium()&&s.a.createElement("div",{className:"subtext center"},"We are very happy to have you as a Premium Member."),t.validBilling&&!e.hasPremium()&&!e.isTrialState()&&s.a.createElement("div",{className:"subtext center"},"We hope Moo.do is helping you be productive.")),s.a.createElement("div",{className:"new-modal-row new-modal-row-2c"},s.a.createElement("div",{className:"left-header"},"ACCOUNT STATUS"),s.a.createElement("div",{className:"right-content"},s.a.createElement("div",{className:"new-modal-subrow"},s.a.createElement("div",null,s.a.createElement("div",{className:"subtitle"},"Account email"),s.a.createElement("div",{className:"subtext"},r)),s.a.createElement("div",null,s.a.createElement("div",{className:"subtitle"},"Member since"),s.a.createElement("div",{className:"subtext"},e.getJoinDate().toString(l.a.getFormat(DFormat.LongStrDate)))),e.isTrialState()&&!e.isTrialOver()&&s.a.createElement("div",null,s.a.createElement("div",{className:"subtitle"},"Days left in trial"),s.a.createElement("div",{className:"subtext"},t.daysLeftInTrial)),e.hasPremium()&&s.a.createElement("div",null,s.a.createElement("div",{className:"subtitle"},"Premium since"),s.a.createElement("div",{className:"subtext"},e.getPremiumStartDate().toString(l.a.getFormat(DFormat.LongStrDate)))),!!e.canceledUserHasPremiumAccess()&&s.a.createElement("div",null,s.a.createElement("div",{className:"subtitle"},"Premium end"),s.a.createElement("div",{className:"subtext"},e.getPremiumEndDate().toString(l.a.getFormat(DFormat.LongStrDate)))),e.hasPremium()&&e.hasSubscription()&&s.a.createElement("div",null,s.a.createElement("div",{className:"subtitle"},"Next billing cycle"),s.a.createElement("div",{className:"subtext"},e.getNextBillingDate().toString(l.a.getFormat(DFormat.LongStrDate))))))),s.a.createElement("div",{className:"new-modal-row new-modal-row-2c"},s.a.createElement("div",{className:"left-header"},"MANAGE ACCOUNT"),s.a.createElement("div",{className:"right-content"},s.a.createElement("div",{className:"new-modal-subrow"},!e.hasPremium()&&s.a.createElement("div",null,s.a.createElement(u.a,{raised:!0,onClick:e.onTapDeleteAccount.bind(e)},"DELETE ACCOUNT")),e.hasPremium()&&e.hasSubscription()&&s.a.createElement("div",null,s.a.createElement(u.a,{raised:!0,onClick:e.onTapUpdatePaymentMethod.bind(e)},"UPDATE PAYMENT METHOD")),e.hasPremium()&&s.a.createElement("div",null,s.a.createElement(u.a,{raised:!0,onClick:e.onTapCancelSubscription.bind(e)},"CANCEL PREMIUM")),s.a.createElement("div",null,s.a.createElement(d.a,{checked:i.default.settings.get(Settings.isUnsubscribed),onChange:this.onUnsubscribedChanged},"Unsubscribe from emails"))))),e.hasPremium()&&e.hasSubscription()&&s.a.createElement("div",{className:"new-modal-row new-modal-row-2c"},s.a.createElement("div",{className:"left-header"},"INVOICES"),s.a.createElement("div",{className:"right-content"},s.a.createElement("div",{className:"new-modal-subrow"},s.a.createElement("div",null,s.a.createElement(d.a,{checked:i.default.settings.get(Settings.monthlyInvoice),onChange:this.onInvoiceEnabledChanged},"Receive Billing Invoice")),t.monthlyInvoice&&s.a.createElement(c.a,{height:50,floatingText:"Invoice Email",display:"block",ref:"invoiceEmail",value:t.invoiceEmail,onChange:this.onInvoiceEmailChanged}),t.monthlyInvoice&&s.a.createElement(c.a,{height:50,floatingText:"Name",display:"block",ref:"invoiceCompany",value:t.invoiceCompany,onChange:this.onInvoiceCompanyChanged}),t.monthlyInvoice&&s.a.createElement(c.a,{height:50,floatingText:"Address",display:"block",ref:"invoiceAddress",value:t.invoiceAddress,onChange:this.onInvoiceAddressChanged}),s.a.createElement("div",null,s.a.createElement(u.a,{raised:!0,onClick:e.onTapViewInvoices.bind(this)},"VIEW INVOICES"))))),!e.hasPremium()&&s.a.createElement("span",{id:"accountSettingsPremium"},s.a.createElement("hr",null),s.a.createElement("div",{className:"new-modal-title"},s.a.createElement("div",{className:"title"},"Moo.do Premium"),s.a.createElement("div",{className:"subtext center"},"Integrate more of your services together and unlock advanced organization and customization features."),s.a.createElement("div",{className:"center",style:{marginTop:24}},s.a.createElement(u.a,{fontSize:14,raised:!0,primary:!0,onClick:e.onTapSignupMonth.bind(e)},"$"+n+" / month"),s.a.createElement(u.a,{fontSize:14,raised:!0,primary:!0,marginLeft:16,onClick:e.onTapSignupYear.bind(e)},"$"+o+" / year"),s.a.createElement(u.a,{fontSize:14,raised:!0,primary:!0,marginLeft:16,onClick:e.onTapCodeSignup.bind(e)},"Enter Code"))),s.a.createElement("div",{id:"premiumFeatures"},s.a.createElement("div",{className:"flexbox c-border"},s.a.createElement("div",{className:"premiumImg premiumShadow"},s.a.createElement("img",{src:"/img/about/CalendarPane.gif"})),s.a.createElement("div",{className:"premiumDesc"},s.a.createElement("div",{className:"premiumTitle"},"Calendar Pane"),s.a.createElement("div",{className:"premiumText"},"Day, Week, and Month views for managing your calendar."))),s.a.createElement("div",{className:"flexbox c-border"},s.a.createElement("div",{className:"premiumImg premiumShadow"},s.a.createElement("img",{src:"/img/about/DrivePane.png"})),s.a.createElement("div",{className:"premiumDesc"},s.a.createElement("div",{className:"premiumTitle"},"Google Drive Pane"),s.a.createElement("div",{className:"premiumText"},"Attach documents to your tasks. Dragging a file from your computer into Moo.do automatically uploads it to Drive."))),s.a.createElement("div",{className:"flexbox c-border"},s.a.createElement("div",{className:"premiumImg premiumShadow"},s.a.createElement("img",{src:"/img/about/GCalSettings.jpg"})),s.a.createElement("div",{className:"premiumDesc"},s.a.createElement("div",{className:"premiumTitle"},"Google Calendar Sync"),s.a.createElement("div",{className:"premiumText"},"Two way sync: Manage your Google Calendar in Moo.do and/or sync your Moo.do events with your Google Calendar."))),s.a.createElement("div",{className:"flexbox c-border"},s.a.createElement("div",{className:"premiumImg premiumShadow"},s.a.createElement("img",{src:"/blog/img/update-workspaces.png"})),s.a.createElement("div",{className:"premiumDesc"},s.a.createElement("div",{className:"premiumTitle"},"Boards"),s.a.createElement("div",{className:"premiumText"},"Save sets of panes to easily switch between workflows."))),s.a.createElement("div",{className:"flexbox c-border"},s.a.createElement("div",{className:"premiumImg premiumShadow"},s.a.createElement("img",{src:"/img/about/DisplaySettings-Small.jpg"})),s.a.createElement("div",{className:"premiumDesc"},s.a.createElement("div",{className:"premiumTitle"},"Advanced Display Settings"),s.a.createElement("div",{className:"premiumText"},"Customize Moo.do's look and feel to your liking."))),s.a.createElement("div",{className:"flexbox c-border"},s.a.createElement("div",{className:"premiumImg"},s.a.createElement("img",{src:"/img/about/GmailCache.jpg"})),s.a.createElement("div",{className:"premiumDesc"},s.a.createElement("div",{className:"premiumTitle"},"Gmail Sync Time"),s.a.createElement("div",{className:"premiumText"},"Cache emails for access while offline and quicker load time.")))),s.a.createElement("table",{id:"pricingTable"},s.a.createElement("tbody",null,s.a.createElement("tr",{className:"c-border c-bg-faded"},s.a.createElement("td",null),s.a.createElement("td",null,"Free"),s.a.createElement("td",null,"Premium")),s.a.createElement("tr",{className:"empty"},s.a.createElement("td",null),s.a.createElement("td",null),s.a.createElement("td",null)),s.a.createElement("tr",{className:"header price"},s.a.createElement("td",null,"Price"),s.a.createElement("td",null,"$0"),s.a.createElement("td",null,s.a.createElement("div",null,"$"+n+" / month"),s.a.createElement("div",null,"$"+o+" / year"))),s.a.createElement("tr",{className:"header"},s.a.createElement("td",null,"Core Features"),s.a.createElement("td",null),s.a.createElement("td",null)),s.a.createElement("tr",null,s.a.createElement("td",null,"Unlimited items"),s.a.createElement("td",{className:"icon-check"}),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",null,s.a.createElement("td",null,"Powerful search"),s.a.createElement("td",{className:"icon-check"}),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",null,s.a.createElement("td",null,"Realtime collaboration"),s.a.createElement("td",{className:"icon-check"}),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",null,s.a.createElement("td",null,"Multiple Boards"),s.a.createElement("td",null),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",null,s.a.createElement("td",null,"Day, Week, Month views"),s.a.createElement("td",null),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",{className:"empty"},s.a.createElement("td",null),s.a.createElement("td",null),s.a.createElement("td",null)),s.a.createElement("tr",{className:"header"},s.a.createElement("td",null,"Plugins"),s.a.createElement("td",null),s.a.createElement("td",null)),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("i",{className:"icon-group"}),"Google Contacts"),s.a.createElement("td",{className:"icon-check"}),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("img",{src:"/img/plugin-mailbird.png"}),"Mailbird"),s.a.createElement("td",{className:"icon-check"}),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("img",{src:"/img/plugin-gdrive.png"}),"Google Drive"),s.a.createElement("td",null),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",{className:"empty"},s.a.createElement("td",null),s.a.createElement("td",null),s.a.createElement("td",null)),s.a.createElement("tr",{className:"header"},s.a.createElement("td",null,s.a.createElement("img",{src:"/img/plugin-gmail.png"}),"Gmail"),s.a.createElement("td",null),s.a.createElement("td",null)),s.a.createElement("tr",null,s.a.createElement("td",null,"Standard email features"),s.a.createElement("td",{className:"icon-check"}),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",null,s.a.createElement("td",null,"Offline sync"),s.a.createElement("td",null,"2 days"),s.a.createElement("td",null,"30 days")),s.a.createElement("tr",{className:"empty"},s.a.createElement("td",null),s.a.createElement("td",null),s.a.createElement("td",null)),s.a.createElement("tr",{className:"header"},s.a.createElement("td",null,s.a.createElement("img",{src:"/img/plugin-gcal.png"}),"Google Calendar"),s.a.createElement("td",null),s.a.createElement("td",null)),s.a.createElement("tr",null,s.a.createElement("td",null,"Sync Moo.do tasks"),s.a.createElement("td",null),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",null,s.a.createElement("td",null,"Manage Calendar in Moo.do"),s.a.createElement("td",null),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",{className:"empty"},s.a.createElement("td",null),s.a.createElement("td",null),s.a.createElement("td",null)),s.a.createElement("tr",{className:"header"},s.a.createElement("td",null,"Customization"),s.a.createElement("td",null),s.a.createElement("td",null)),s.a.createElement("tr",null,s.a.createElement("td",null,"Display settings presets"),s.a.createElement("td",{className:"icon-check"}),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",null,s.a.createElement("td",null,"Advanced display settings"),s.a.createElement("td",null),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",{className:"empty"},s.a.createElement("td",null),s.a.createElement("td",null),s.a.createElement("td",null)),s.a.createElement("tr",{className:"header"},s.a.createElement("td",null,"We love you",s.a.createElement("i",{className:"icon-heart"})),s.a.createElement("td",null),s.a.createElement("td",null)),s.a.createElement("tr",null,s.a.createElement("td",null,"Early access to new features"),s.a.createElement("td",null),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",null,s.a.createElement("td",null,"Premium support"),s.a.createElement("td",null),s.a.createElement("td",{className:"icon-check"})),s.a.createElement("tr",{className:"empty"},s.a.createElement("td",null),s.a.createElement("td",null),s.a.createElement("td",null))))))}});t.a=h},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(4),a(17),a(2)),s=a.n(n),o=a(3),l=a(40),d=a(6),c=o.a.createClass({displayName:"ReactModalSettingsEarly",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({isSendingFeedback:!1})},openSection:function(e){this.props.openSection(e)},onClickDiscard:function(){this.refs.feedback.value="",this.refs.feedback.focus()},onClickSend:function(e,t){var a=this.refs.feedback.value;if(a&&a.length>2){this.isSendingFeedback.set(!0);var r="Early Access Feedback: "+this.refs.selectFeature.value;return i.default.sendFeedback(r,a,function(){this.refs.feedback.value="",this.isSendingFeedback.set(!1),t&&i.default.isFunction(t)&&t()}.bind(this)),!0}},render:function(){i.default.billingManager,this.props;var e=this.state;return s.a.createElement("div",{key:"content",className:"new-modal-group"},s.a.createElement("div",{className:"new-modal-title"},s.a.createElement("div",{className:"title"},"Send Feedback"),s.a.createElement("div",{className:"subtext middle"},"Send the developers bug reports, feedback, or suggestions. Your feedback is very helpful in planning what to do next.")),s.a.createElement("div",{className:"earlyAccessFeedback"},s.a.createElement("textarea",{className:"feedbackTextArea c-background c-foreground",ref:"feedback",style:{marginBottom:16,color:e.isSendingFeedback?"#aaa":null}}),e.isSendingFeedback&&s.a.createElement(l.a,{top:100}),s.a.createElement("div",{style:{textAlign:"right"}},s.a.createElement(d.a,{raised:!0,onClick:this.onClickDiscard},"DISCARD"),s.a.createElement(d.a,{raised:!0,primary:!0,marginLeft:16,onClick:this.onClickSend},"SEND"))))}});t.a=c},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(17),a(15)),s=a(2),o=a.n(s),l=a(3),d=a(14),c=a(26),u=a(40),h=a(6),f=a(33),p=a(21),m=a(65),g=l.a.createClass({displayName:"ReactModalSettingsLinked",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({addingAccount:!1,errorMessage:"",linkingAccount:!1}),c.a.refresh()},componentDidMount:function(){this.listenTo(d.a.onAccountsUpdated)},getState:function(){return{gmailSyncAccounts:c.a.GmailSyncAccounts,linkedAccounts:d.a.getLinkedAccounts()}},linkAccount:function(e,t,a){var i=[GScope.UserInfoEmail];return i.pushArray(t),n.a.linkAccount(e,i,a)},removeAccount:function(e){this.errorMessage.set("");var t=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail);d.a.removeLinkedAccount(e,function(t){t||i.default.toasts.pushMessage({text:"There was an error unlinking your account.",actionText:"RETRY",action:this.removeAccount.bind(this,e)})}.bind(this)),t.hasSyncAccount(e)&&t.removeSyncAccount(e,function(){c.a.refresh()})},addAccount:function(e){d.a.isDefaultEmail(e)?i.default.toasts.pushMessage({text:"Please use the 'Plugins' section to manage your main account."}):(d.a.addLinkedAccount(e),i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail).isEnabled()&&this.enableGmailSync(e,!0))},enableGmailSync:function(e,t){this.errorMessage.set("");var a=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail),r=function(){this.errorMessage.set("There was an error linking your account. Please try again in a minute."),c.a.refresh()}.bind(this);if(t){var n=this.linkingAccount;n.set(e),this.linkAccount(e,[GScope.GmailCompose,GScope.GmailModify],function(e,t){e?a.addSyncAccount(t,function(e){e||r(),n.set(!1),c.a.refresh()}):(n.set(!1),r())})}else a.removeSyncAccount(e,function(e){e||r(),c.a.refresh()})},onAddAccountClick:function(){this.errorMessage.set(""),this.addingAccount.set(!0),setTimeout(function(){this.refs.addAccount.focus()}.bind(this),0)},onAddButtonClick:function(){this.errorMessage.set("");var e=this.refs.addAccount.getValue();this.addAccount(e),this.addingAccount.set(!1)},handleGmailClick:function(){i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail).isEnabled()||this.props.openSection(r.a.SettingsSections.Plugins)},renderAccount:function(e){var t=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail).isEnabled(),a=this.state.gmailSyncAccounts.indexOf(e)>=0,r=a&&d.a.isConnected()&&(!d.a.isAuthorized(e,GScope.GmailCompose)||!d.a.isCurrentlyAuthorized(e)),n=this.state.linkingAccount===e,s=i.default.classNames("accountRow",{linking:n});return o.a.createElement("div",{key:"row"+e,className:s},o.a.createElement(h.a,{icon:"icon-close",iconSize:20,width:50,height:50,onClick:this.removeAccount.bind(this,e),tooltip:"Unlink Account"}),o.a.createElement("div",null,e),o.a.createElement(f.a,{disabled:!t,checked:a,error:r,onClick:this.handleGmailClick,onChange:this.enableGmailSync.bind(this,e)}),n&&o.a.createElement(u.a,{inline:!0},"Linking account..."))},getAccountList:function(){var e=[];e.pushOnlyUniques(this.state.linkedAccounts),e.pushOnlyUniques(this.state.gmailSyncAccounts);var t=d.a.getDefaultEmail();return e.filter(function(e){return e!==t})},render:function(){var e=this.getAccountList(),t=o.a.createElement(m.a,{className:"gmailAccountTable"},o.a.createElement("div",{key:"header"},o.a.createElement("div",null),o.a.createElement("div",null,"Account"),o.a.createElement("div",null,"Enabled")),e.map(this.renderAccount));return o.a.createElement("div",{key:"content",className:"new-modal-group"},o.a.createElement("div",{className:"new-modal-title"},o.a.createElement("div",{className:"title"},"Email Accounts"),o.a.createElement("div",{className:"subtext center"},"Manage email from multiple Gmail accounts")),t,this.state.addingAccount&&o.a.createElement("div",{key:"footer",style:{padding:"0 32px"}},o.a.createElement(p.a,{ref:"addAccount",floatingText:"Account Email",padding:{left:24,right:24},height:50,buttonText:"ADD",onButtonClick:this.onAddButtonClick})),this.state.errorMessage&&o.a.createElement("div",{key:"errorMessage",style:{textAlign:"center"}},this.state.errorMessage),!this.state.addingAccount&&o.a.createElement("div",{key:"footer"},o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement(h.a,{height:50,onClick:this.onAddAccountClick},"LINK ACCOUNT"))))}});t.a=g},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(7),a(2)),s=a.n(n),o=a(3),l=a(26),d=a(14),c=a(40),u=a(33),h=a(6),f=a(65),p=a(55),m=a(21),g=o.a.createClass({displayName:"ReactModalSettingsGCal",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.hadCalendarSyncUpdated=!1,this.createObservables({addingCalendar:!1}),l.a.refresh()},openSection:function(e){this.props.openSection(e)},componentDidMount:function(){this.listenTo(d.a.onAccountsUpdated)},onUnmount:function(){if(this.hadCalendarSyncUpdated){var e=i.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar);e.isActive()&&e.forceRemoteEventSync()}},getState:function(){var e={premiumStatus:i.default.billingManager._premiumStatus,GCalendarsAvailable:l.a.GCalendarsAvailable,GCalendarSyncErrors:l.a.GCalendarSyncErrors,GCalendarAddFailure:l.a.GCalendarAddFailure,GCalendarListFailure:l.a.GCalendarListFailure,GCalendarListLoading:l.a.GCalendarListLoading},t=l.a.getPluginOptions(PluginID.GCalendar);for(var a in t){if(t.hasOwnProperty(a))e[PluginID.GCalendar+"_"+a]=t[a]}return e},toggleCalendarImport:function(e){var t=PluginSettingsID.GCalendar.ImportCalendars,a=(this.state[PluginID.GCalendar+"_"+t]||[]).slice(0),r=this.isExportCalendar(e);r&&this.disableCalendarExport(e);var n=a.indexOfWithProperty("id",e.id);if(n>=0)a.removeAt(n);else{try{i.default.PAssert(2673,!r,"Export calendar state must be matching with import calendar state")}catch(e){i.default.reportError(e)}a.push({id:e.id,summary:e.summary,accessRole:e.accessRole})}l.a.setPluginOption(PluginID.GCalendar,t,a,!1),this.hadCalendarSyncUpdated=!0},enableCalendarExport:function(e){l.a.setPluginOption(PluginID.GCalendar,PluginSettingsID.GCalendar.WriteAccess,!0,!0,function(t){t&&(l.a.setPluginOption(PluginID.GCalendar,PluginSettingsID.GCalendar.ExportCalendar,e.id,!1),this.hadCalendarSyncUpdated=!0,this.isImportCalendar(e)||this.toggleCalendarImport(e))}.bind(this))},disableCalendarExport:function(e){l.a.setPluginOption(PluginID.GCalendar,PluginSettingsID.GCalendar.WriteAccess,!1,!1,function(e){e&&l.a.setPluginOption(PluginID.GCalendar,PluginSettingsID.GCalendar.ExportCalendar,null,!1)})},toggleCalendarExport:function(e){this.isExportCalendar(e)?this.disableCalendarExport(e):this.enableCalendarExport(e)},onAddCalendarClick:function(){l.a.setPluginOption(PluginID.GCalendar,PluginSettingsID.GCalendar.WriteAccess,!0,!1,function(e){e?(this.addingCalendar.set(!0),setTimeout(function(){this.refs.addCalendar.focus()}.bind(this),0)):i.default.toasts.pushMessage({text:"Moo.do needs write access to create a new calendar.",actionText:"OKAY"})}.bind(this))},onAddButtonClick:function(){var e=this.refs.addCalendar.getValue();l.a.addCalendar(e),this.addingCalendar.set(!1)},isImportCalendar:function(e){var t=!1;if(this.state.GCalendar_importCalendars)for(var a=0;a<this.state.GCalendar_importCalendars.length;++a){var r=this.state.GCalendar_importCalendars[a];if(i.default.isObject(r)||(r={id:r}),r.id===e.id){t=!0;break}}return t},isExportCalendar:function(e){var t=!1;return this.state.GCalendar_exportCalendar&&(t=this.state.GCalendar_exportCalendar===e.id),t},onDisplayOverdueChange:function(e){i.default.vmMain.pluginManager.setSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.DisplayOverdueInAgenda,e)},onSyncNewEventsChange:function(e){i.default.vmMain.pluginManager.setSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.SyncNewEvents,e)},onSyncDraggedEventsChange:function(e){i.default.vmMain.pluginManager.setSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.SyncDraggedEvents,e)},onCreateLocalChange:function(e){i.default.vmMain.pluginManager.setSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.CreateLocalEvents,e)},renderCalendarSettings:function(){var e,t,a,n,o=this.state,d=0,g=o.GCalendarSyncErrors,v=!1;if(g)for(var y=0;y<g.length;y++){var S=g[y].result;S===r.a.SyncResult.FailureOAuth?v=!0:S!==r.a.SyncResult.FailureNoRead&&S!==r.a.SyncResult.FailureNoWrite||d++}var E=i.default.vmMain.pluginManager.getPlugin(PluginID.GCalendar),P=E.getSetting(PluginSettingsID.GCalendar.WriteAccess),b=E.getSetting(PluginSettingsID.GCalendar.WeeksPast),C=E.getSetting(PluginSettingsID.GCalendar.WeeksFuture),D=E.getSetting(PluginSettingsID.GCalendar.DisplayOverdueInAgenda),I=E.getSetting(PluginSettingsID.GCalendar.SyncNewEvents),A=E.getSetting(PluginSettingsID.GCalendar.SyncDraggedEvents),M=E.getSetting(PluginSettingsID.GCalendar.CreateLocalEvents),_=!1;return!P&&this.state.GCalendar_exportCalendar&&(_=!0),i.default.billingManager.hasPremiumFeatures()?v&&0===o.GCalendarsAvailable.length?n=s.a.createElement("center",null,s.a.createElement("div",{className:"error"},"We encountered a sync error. Please allow access to your calendar."),s.a.createElement("br",null),s.a.createElement(h.a,{raised:!0,primary:!0,onClick:l.a.enablePlugin.bind(l.a,PluginID.GCalendar)},"ALLOW")):o.GCalendarListFailure?n=s.a.createElement("center",null,s.a.createElement("div",{className:"error"},"There was an error syncing your calendar list. Please try again."),s.a.createElement("br",null),s.a.createElement(h.a,{raised:!0,primary:!0,onClick:l.a.updateCalendarList.bind(l.a)},"RETRY")):o.GCalendarListLoading?n=s.a.createElement(c.a,null,"Loading Google Calendars..."):(d>0&&(n=s.a.createElement("center",null,s.a.createElement("div",{style:{maxWidth:600,lineHeight:1.5,marginBottom:16},className:"error"},"There was an error reading or saving to your calendars. Please check your Google Calendar settings. The affected calendars are marked with a ",s.a.createElement(u.a,{checked:!0,error:!0,style:{marginLeft:5,marginRight:5}})," below."))),e=s.a.createElement(f.a,{className:"calendarSettingsTable new-modal-row"},s.a.createElement("div",{key:"header"},s.a.createElement("div",null,"Calendar Name"),s.a.createElement("div",null,"Sync From"),s.a.createElement("div",null,"Save To")),o.GCalendarsAvailable.map(function(e,t){var a=this.isImportCalendar(e),n=this.isExportCalendar(e),o="owner"===e.accessRole||"writer"===e.accessRole,l=i.default.classNames("calendarSettingsName",{import:a},{export:n});if(g){var d=g.indexOfWithProperty("id",e.id),c=null,h=null;if(d>=0){var f=g[d];f.result===r.a.SyncResult.FailureNoRead?c=!0:f.result===r.a.SyncResult.FailureNoRead&&(h=!0)}}var p=E.getCalendarBackgroundColor(e.id);return s.a.createElement("div",{key:"row"+t},s.a.createElement("div",{className:l},e.summary||e.id),s.a.createElement(u.a,{checked:a,error:c,checkedColor:p,onChange:this.toggleCalendarImport.bind(this,e)}),o?s.a.createElement(u.a,{checked:n,enabled:o,checkedColor:p,error:c||h||n&&_,radio:!0,onChange:this.toggleCalendarExport.bind(this,e)}):s.a.createElement("div",null))}.bind(this)),o.GCalendarAddFailure&&s.a.createElement("div",{key:"footerError"},s.a.createElement("div",{style:{textAlign:"center"}},"There was an error creating your new calendar. Please try again.")),o.addingCalendar&&s.a.createElement("div",{key:"footer"},s.a.createElement(m.a,{ref:"addCalendar",floatingText:"New calendar name",padding:{left:24,right:24},height:50,buttonText:"ADD",onButtonClick:this.onAddButtonClick})),!o.addingCalendar&&s.a.createElement("div",{key:"footer"},s.a.createElement("div",{style:{textAlign:"center"}},s.a.createElement(h.a,{height:"auto",onClick:this.onAddCalendarClick},"ADD NEW CALENDAR"))))):n=s.a.createElement("center",null,s.a.createElement("div",{className:"error"},"You must have an active Premium subscription or Trial to use Google Calendar."),s.a.createElement("br",null),s.a.createElement(h.a,{raised:!0,primary:!0,onClick:this.openSection.bind(this,r.a.SettingsSections.Account)},"ABOUT PREMIUM")),t=s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement("span",{style:{display:"inline-block",width:140}},"Weeks in the past"),s.a.createElement(p.a,{value:b,minValue:0,maxValue:7,onChange:this.onChangeWeeksPast}),s.a.createElement("span",{style:{display:"inline-block",marginLeft:32,width:140}},"Weeks in the future"),s.a.createElement(p.a,{value:C,minValue:0,maxValue:12,onChange:this.onChangeWeeksFuture})),a=s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement(u.a,{ref:"displayoverdue",checked:D,onChange:this.onDisplayOverdueChange},"Display overdue events in agenda"),s.a.createElement("div",{className:"subtext"},"In the Agenda view of the Calendar Pane, display events from Google Calendar that happened in the past.")),s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement(u.a,{ref:"syncDraggedEvents",checked:A,onChange:this.onSyncDraggedEventsChange},"Sync dragged events"),s.a.createElement("div",{className:"subtext"},"Sync events with Google Calendar when dragging onto the Calendar pane.")),s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement(u.a,{ref:"syncNewEvents",checked:I,onChange:this.onSyncNewEventsChange},"Sync new events created in add item popup by default"),s.a.createElement("div",{className:"subtext"},"When adding events in the New Item popup, Create Task in the Gmail pane, or in the Day, Week, and Month views in the Calendar Pane, the option to sync the event with Google Calendar will be checked by default.")),s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement(u.a,{ref:"createLocalEvents",checked:M,onChange:this.onCreateLocalChange},"Create a local item for new calendar events by default"),s.a.createElement("div",{className:"subtext"},"When adding events in the New Item popup, Create Task in the Gmail pane, or in the Day, Week, and Month views in the Calendar Pane, a new local task will be created for Google Calendar events."))),s.a.createElement("div",{className:"calendarSettings"},n,e,t,a)},onChangeWeeksPast:function(e){i.default.vmMain.pluginManager.setSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.WeeksPast,e)},onChangeWeeksFuture:function(e){i.default.vmMain.pluginManager.setSetting(PluginID.GCalendar,PluginSettingsID.GCalendar.WeeksFuture,e)},render:function(){return s.a.createElement("div",{className:"new-modal-group"},s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement("div",{className:"subtext"},"By default we are not able to modify your calendar or calendar events. Adding a 'Save To' calendar to below will sync your local changes to your Google Calendar."),this.renderCalendarSettings()))}});t.a=g},function(e,t,a){"use strict";a(0);var i=a(1),r=a(7),n=a(2),s=a.n(n),o=a(3),l=a(26),d=a(6),c=o.a.createClass({displayName:"ReactModalSettingsContacts",componentDisplay:i.a.ComponentDisplay.Desktop,getState:function(){return{contacts:r.a.contactManager._contacts}},render:function(){var e=this.state;return s.a.createElement("div",{className:"settingPluginOptions"},s.a.createElement("div",{className:"subtext"},s.a.createElement("span",null,"We will not send emails or otherwise communicate with your contacts unless you ask us to."),s.a.createElement("span",null," If you need instant access to contacts you just added you can sync them by pressing the button below, otherwise your contacts will appear automatically after a few hours.")),s.a.createElement("div",{className:"center"},s.a.createElement(d.a,{id:"refreshContacts",raised:!0,primary:!0,onClick:l.a.onTapRefreshContacts.bind(l.a)},"REFRESH CONTACTS"),s.a.createElement("div",{id:"numContacts"},e.contacts.length+" contacts loaded")))}});t.a=c},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(7),a(2)),s=a.n(n),o=a(3),l=a(26),d=a(33),c=a(6),u=a(55),h=o.a.createClass({displayName:"ReactModalSettingsGmail",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.hadGmailSyncUpdated=!1},onUnmount:function(){if(this.hadGmailSyncUpdated){var e=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail);e.isActive()&&e._forceThreadSync()}},getState:function(){return{GmailNumSyncd:l.a.GmailNumSyncd,GmailNumTotal:l.a.GmailNumTotal,GmailCacheSize:l.a.GmailCacheSize,GmailSyncAccounts:l.a.GmailSyncAccounts}},onSyncTimeChanged:function(e){i.default.vmMain.pluginManager.setSetting(PluginID.Gmail,PluginSettingsID.Gmail.SyncTime,e),this.hadGmailSyncUpdated=!0},onScheduleChange:function(e){i.default.vmMain.pluginManager.setSetting(PluginID.Gmail,PluginSettingsID.Gmail.ArchiveOnSchedule,e)},onOrganizeChange:function(e){i.default.vmMain.pluginManager.setSetting(PluginID.Gmail,PluginSettingsID.Gmail.ArchiveOnOrganize,e)},onSignatureChange:function(e){i.default.vmMain.pluginManager.setSetting(PluginID.Gmail,PluginSettingsID.Gmail.InsertSignatureAboveReplies,e)},onClickSetupAccounts:function(){this.props.openSection(r.a.SettingsSections.Linked)},render:function(){var e=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail),t=e.getSetting(PluginSettingsID.Gmail.SyncTime),a=e.getSetting(PluginSettingsID.Gmail.ArchiveOnSchedule),n=e.getSetting(PluginSettingsID.Gmail.ArchiveOnOrganize),o=e.getSetting(PluginSettingsID.Gmail.InsertSignatureAboveReplies),l=i.default.billingManager.hasPremium()?r.a.MaxGmailSyncTime.Premium:r.a.MaxGmailSyncTime.Free;return s.a.createElement("div",{className:"new-modal-group gmailSettings"},s.a.createElement("div",{className:"new-modal-row new-modal-row-1c center"},s.a.createElement(c.a,{raised:!0,onClick:this.onClickSetupAccounts},"SETUP ACCOUNTS")),s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement("span",{style:{width:140}},"Offline sync days  "),s.a.createElement(u.a,{value:t,minValue:0,maxValue:l,onChange:this.onSyncTimeChanged}),s.a.createElement("div",{className:"subtext"},"The number of days in the past that your email will be saved for offline access.")),s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement(d.a,{ref:"archiveOnSchedule",checked:a,onChange:this.onScheduleChange},"Archive emails when scheduled"),s.a.createElement("div",{className:"subtext"},"If enabled, when you use the 'Schedule' feature to put an email on your calendar it will be archived.")),s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement(d.a,{ref:"archiveOnOrganize",checked:n,onChange:this.onOrganizeChange},"Archive emails when organized"),s.a.createElement("div",{className:"subtext"},"If enabled, when you drag an email to your outline it will be archived and marked as Moo.do/Handled.")),s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement(d.a,{ref:"insertSignatureAboveReplies",checked:o,onChange:this.onSignatureChange},"Insert signature before quoted text in replies"),s.a.createElement("div",{className:"subtext"},"If enabled, your signature will be inserted above the quoted text in replies and will remove the '--' line that precedes it.")))}});t.a=h},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(77),d=a(66),c=a(6),u=["overdue","starred","important","#next","#soon","#later","#someday"],h=o.a.createClass({displayName:"ReactModalSettingsAgenda",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){for(var e=i.default.timeline.agendaSort.get(),t=[],a=Object.keys(e).map(function(t){return{key:t,value:e[t]}}),r=0;r<15;r++)a.push(r);for(a.sort(this.sortComparator),r=0;r<u.length;r++){var n=u[r];a.indexOfWithProperty("key",n)<0&&t.push({key:n,value:0})}var s=l.a.getAll();for(r=0;r<s.length;r++){var o="#"+s[r].text;a.indexOfWithProperty("key",o)<0&&t.push({key:o,value:0})}t.sort(this.sortComparatorNonSort),this.createObservables({sortArray:a,nonSortArray:t,selected:{array:"sort",index:0}})},sortComparatorNonSort:function(e,t){var a=e.key[0],i=t.key[0];return"#"===a&&"#"!==i?1:"#"===i&&"#"!==a?-1:e.key.localeCompare(t.key)},sortComparator:function(e,t){return(isNaN(e)?e.value:100*e)-(isNaN(t)?t.value:100*t)},moveChild:function(e,t,a,i){var r=this.state,n=a&&a!==this.refs.sortList?"nonSort":"sort",s=i&&i!==this.refs.nonSortList?"sort":"nonSort",o=r[n+"Array"],l=r[s+"Array"],d=o===l,c="sort"===n?r.nonSortArray:r.sortArray,u=o[e];d?o.splice(e,1):u.isDragging=!0;var h=c.indexOfWithProperty("key",u.key);h>=0&&c.splice(h,1),l.splice(t,0,u),this[n+"Array"].set(o,!1),this[s+"Array"].set(l,!0)},onDragOut:function(e,t){var a=t&&t!==this.refs.sortList?"nonSort":"sort",i=this.state[a+"Array"],r="sort"===a?this.nonSortArray:this.sortArray,n=i[e],s=r.indexOfWithProperty("key",n.key);s>=0&&r.splice(s,1)},onDragEnd:function(e,t,a){var i=e.props.owner,r=e.props.index,n=i&&i!==this.refs.sortList?"nonSort":"sort",s=this.state[n+"Array"][r];if(s.isDragging=!1,t){var o=e.props.owner;(o&&o!==this.refs.nonSortList?this.sortArray:this.nonSortArray).splice(e.props.index,1)}this.sortArray.indexOf(s)<0&&this.nonSortArray.indexOf(s)<0&&this.nonSortArray.push(s),this.sortArray.notify(),a&&this.saveAfterTimeout()},saveAfterTimeout:function(){this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(this.saveToSettings,200)},saveToSettings:function(){for(var e,t=this.state.sortArray,a={},r=-1,n=0;n<t.length;n++){var s=t[n];if(isNaN(s)){var o=100*r,l=e&&e>o?e+1:o+1;a[s.key]=l,e=l}else r=s}i.default.timeline.saveAgendaSort(a)},getDragTargetfromElement:function(e){var t=i.default.findParent(e,"fancySortableList"),a=this.refs;return t===a.sortList.getElement()?a.sortList:t===a.nonSortList.getElement()?a.nonSortList:void 0},onClickMoveToOtherList:function(){var e=this.state.selected,t=e.array,a=e.index,i="sort"===t?"nonSort":"sort",r=this.state[t+"Array"][a];isNaN(r)&&(this[t+"Array"].splice(a,1),this[i+"Array"].splice(0,0,r)),this.saveAfterTimeout()},onClickListItem:function(e,t){this.selected.set({array:e,index:t})},renderListItem:function(e,t,a,r){var n=this.state,o=this.onClickListItem.bind(this,r,t);if(isNaN(e)){var l=e.key.capitalize(),d=i.default.classNames(a,{"tag c-tag":l.startsWith("#")},{"selected c-popup-item":n.selected.array===r&&n.selected.index===t});return s.a.createElement("div",{key:l,className:d,onClick:o,"data-isdragging":e.isDragging},l)}return s.a.createElement("div",{key:e,className:a+" date c-date","data-nodrag":!0},s.a.createElement("span",{className:"icon-calendar"}),s.a.createElement("span",null,"Today"+(e>0?" + "+e+" days":"")))},render:function(){var e,t=this.state,a=t.sortArray,r=t.nonSortArray,n=[],o=[],l=t.selected.array,u=i.default.classNames("agendaSortSettingsItem c-background"),h=i.default.classNames({"icon-arrow_forward":"sort"===l},{"icon-arrow_back":"nonSort"===l});for(e=0;e<a.length;e++)n.push(this.renderListItem(a[e],e,u,"sort"));for(e=0;e<r.length;e++)o.push(this.renderListItem(r[e],e,u,"nonSort"));return s.a.createElement("div",{key:"content",className:"new-modal-group"},s.a.createElement("div",{className:"new-modal-row new-modal-row-1c"},s.a.createElement("div",{className:"settingsName ib"},"Change agenda sort:"),s.a.createElement("div",{className:"agendaSortLists flexbox"},s.a.createElement(d.a,{className:"agendaSortList f1 c-border-light",moveChild:this.moveChild,onDragEnd:this.onDragEnd,onDragOut:this.onDragOut,ref:"sortList",getDragTargetfromElement:this.getDragTargetfromElement,classDragging:"c-foreground-very-faded"},n),s.a.createElement("div",{className:"flexbox flexvert height100"},s.a.createElement(c.a,{raised:!0,round:!1,icon:h,onClick:this.onClickMoveToOtherList})),s.a.createElement(d.a,{className:"agendaSortList agendaSortList f1 c-border-light",moveChild:this.moveChild,onDragEnd:this.onDragEnd,onDragOut:this.onDragOut,ref:"nonSortList",getDragTargetfromElement:this.getDragTargetfromElement,classDragging:"c-foreground-very-faded"},o))))}});t.a=h},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(34),d=(a.n(l),a(3).a.createClass({displayName:"FancySortableItem",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.amtMoved=void 0,this.prevPos=void 0,this.isDragging=!1,this.createObservables({dragPosition:void 0})},getElement:function(){return this.refs.element},getDraggingElement:function(){return this.refs.draggingElement},getDragPosition:function(){return this.state.dragPosition},onMouseDown:function(e){var t=this.props.horizontal,a=t?e.clientX:e.clientY;this.amtMoved=0,this.prevPos={left:e.clientX,top:e.clientY},this.dragOffset=i.default.offset(this.refs.element)[t?"left":"top"]-a,this.props.allowDragOut&&(this.startPos={left:e.clientX,top:e.clientY}),document.addEventListener("mousemove",this.onMouseMoveDragging),document.addEventListener("mouseup",this.onMouseUpDragging)},onMouseMoveDragging:function(e){var t=this.props,a=t.horizontal,r=a?e.clientX:e.clientY;if(this.amtMoved+=Math.abs(e.clientX-this.prevPos.left)+Math.abs(e.clientY-this.prevPos.top),this.amtMoved>3){this.isDragging||(this.isDragging=!0,t.onDragStart(this)),t.onDragMove(this,e);var n=this.refs.element,s=a?"left":"top",o=n.parentElement,l=i.default.offset(o),d=r+this.dragOffset-l[s],c={};a?(c.left=d,t.allowDragOut&&(c.top=e.clientY-this.startPos.top)):(c.top=d,t.allowDragOut&&(c.left=e.clientX-this.startPos.left)),this.dragPosition.set(c)}this.prevPos={left:e.clientX,top:e.clientY}},onMouseUpDragging:function(e){this.isDragging&&this.props.onDragEnd(this,e),this.amtMoved=void 0,this.prevPos=void 0,this.dragOffset=void 0,this.isDragging=!1,this.dragPosition.set(void 0),document.removeEventListener("mousemove",this.onMouseMoveDragging),document.removeEventListener("mouseup",this.onMouseUpDragging)},render:function(){var e=this.state,t=this.props,a=e.dragPosition,r=!i.default.isEmpty(a),s=i.default.classNames(t.className,"fancySortableItem",{noClick:t.noDrag},{dragging:r||t.isDragging}),l=i.default.classNames((r||t.isDragging)&&t.classDragging),d={};return a&&(d[n.a.transform.react]="translate3d("+(a.left||0)+"px,"+(a.top||0)+"px,0)"),o.a.createElement("div",{className:s,onMouseDownCapture:this.onMouseDown,ref:"element"},o.a.createElement("span",{className:l},t.children),r&&o.a.createElement("div",{className:"draggingElement",style:d,ref:"draggingElement"},t.children))}}));t.a=d},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),r=a.n(i),n=a(3),s=a(25),o=a(1),l=a(6),d=a(22),c=n.a.createClass({displayName:"ReactModalAlert",componentDisplay:o.a.ComponentDisplay.Everywhere,getHotkeys:function(){return[s.a.create(KeyCode.Enter,!0,o.a.Primary.Either,o.a.Shift.Either,this.onClickButton)]},onClickButton:function(){this.refs.modal.close()},render:function(){var e=this.props.actionText||"OKAY";return r.a.createElement(d.a,{id:"modalAlert",closeButton:!1,small:!0,backdropClose:!1,scrollable:!1,modalID:Modals.Alert,ref:"modal"},r.a.createElement("div",{key:"content",dangerouslySetInnerHTML:{__html:this.props.text}}),r.a.createElement("div",{key:"buttons"},r.a.createElement(l.a,{primary:!0,onClick:this.onClickButton},e)))}});t.default=c},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),r=a.n(i),n=a(1),s=a(0),o=a(3),l=a(6),d=a(40),c=a(22),u=null,h=1,f=2,p=3,m=4,g=5,v=6,y=null,S=1,E=2,P=3,b=4,C=5,D=6,I=7,A=8,M=9,_=["2m4b","gjgm","pmjw","5pm2"];var T=o.a.createClass({displayName:"ReactModalBilling",componentDisplay:n.a.ComponentDisplay.Desktop,init:function(){this._braintreeRequested=!1,this._braintreeLoaded=!1,this._clientTokenRequested=!1,this._clientTokenLoaded=!1,this._clientToken=void 0,this._btClient=void 0,this._btIntegration=void 0,this._isMethodUpdate=this.props.isUpdate,this.createObservables({isSubmitting:!1,isLoading:!0,billingFailureCode:u,signupFailureCode:y,signupErrorMessage:void 0}),this._ensureBraintreeLib(),this._ensureClientToken()},onUnmount:function(){this._btIntegration&&(this._btIntegration.teardown(),this._btIntegration=void 0)},_handlePaymentMethodUpdate:function(e){this._isMethodUpdate?e&&e.nonce?this._processUpdateNonce(void 0,e.nonce):this._processUpdateNonce({error:!0},void 0):e&&e.nonce?this._processPaymentNonce(void 0,e.nonce):this._processPaymentNonce({error:!0},void 0)},_notifyDependencyLoaded:function(){this._braintreeLoaded&&this._clientTokenLoaded&&(this._btClient=new braintree.api.Client({clientToken:this._clientToken}),braintree.setup(this._clientToken,"dropin",{container:"braintreeDropin",onPaymentMethodReceived:this._handlePaymentMethodUpdate,onError:function(e){s.default.reportError(e)},onReady:function(e){this.isLoading.set(!1),this._btIntegration=e}.bind(this)}))},_notifyDependencyLoadError:function(e){this.billingFailureCode.set(e),s.default.reportError(new Error("Client hit error in billing: "+e)),s.default.billingManager.setLastSignupError(e),s.default.sendEvent("Billing","SignupError_"+e)},_ensureBraintreeLib:function(){this._braintreeRequested||(window.braintree?(this._braintreeLoaded=!0,this._notifyDependencyLoaded()):(this._braintreeRequested=!0,s.default.addScriptHack("https://js.braintreegateway.com/v2/braintree.js","braintreeScript",function(){window.braintree?(this._braintreeLoaded=!0,this._notifyDependencyLoaded()):(this._braintreeRequested=!1,this._notifyDependencyLoadError(h))}.bind(this),function(){this._braintreeRequested=!1,this._notifyDependencyLoadError(f)}.bind(this))))},_ensureClientToken:function(){var e=s.default.billingManager.getBillingIdentifier();e?this._clientTokenRequested||(this._clientTokenRequested=!0,s.default.XHR_PrivateAPI({type:"POST",path:"/billing/getToken",data:{email:e},requireAuth:!0,autoRetry:!0,maxRetries:1,cb:function(e){if(200===e.status){this._clientTokenLoaded=!0;try{var t=JSON.parse(e.responseText).data;t&&t.token?(this._clientToken=t.token,this._notifyDependencyLoaded()):this._notifyDependencyLoadError(p)}catch(e){s.default.reportError(e),this._notifyDependencyLoadError(m)}}else this._clientTokenRequested=!1,this._notifyDependencyLoadError(g)}.bind(this)})):this._notifyDependencyLoadError(v)},_setPaymentResponse:function(e){switch(e.code){case PrivateAPIErrorCodes.UnauthorizedUser:this.signupFailureCode.set(b),this.signupErrorMessage.set(void 0);break;case PrivateAPIErrorCodes.InvalidParameter:this.signupFailureCode.set(C),this.signupErrorMessage.set(void 0);break;case PrivateAPIErrorCodes.MissingParameter:this.signupFailureCode.set(D),this.signupErrorMessage.set(void 0);break;case PrivateAPIErrorCodes.BraintreePaypalBlock:this.signupFailureCode.set(A),this.signupErrorMessage.set(e.data);break;case PrivateAPIErrorCodes.BraintreeInvalidCCN:this.signupFailureCode.set(M),this.signupErrorMessage.set(e.data);break;case PrivateAPIErrorCodes.BraintreeUnknown:this.signupFailureCode.set(I),this.signupErrorMessage.set(e.data);break;default:this.signupFailureCode.set(P),this.signupErrorMessage.set(void 0)}},_processUpdateNonce:function(e,t){s.default.sendEvent("Billing","PremiumUpdate"),!e&&t&&(this.isSubmitting.get()||(this.isSubmitting.set(!0),s.default.XHR_PrivateAPI({type:"POST",path:"/billing/updateMethod",data:{nonce:t},requireAuth:!0,cb:function(e){if(this.isSubmitting.set(!1),200===e.status)s.default.menus.isModalOpen(this.id)&&this.onClickClose(),s.default.menus.alert({text:"Your payment information has been updated.",actionText:"OKAY"}),s.default.sendEvent("Billing","PremiumUpdateSUCCESS");else{if(e.response)try{var t=JSON.parse(e.response);this._setPaymentResponse(t)}catch(e){s.default.reportError(e),this.signupFailureCode.set(P),this.signupErrorMessage.set(void 0)}else this.signupFailureCode.set(P),this.signupErrorMessage.set(void 0);s.default.sendEvent("Billing","PremiumUpdateFAILURE")}}.bind(this)})))},_processPaymentNonce:function(e,t){if(s.default.sendEvent("Billing","PremiumSignup"),!e&&t){this.signupFailureCode.set(y),this.signupErrorMessage.set(void 0);var a=_[s.default.billingManager.getBillingPeriod()];try{s.default.PAssert(2573,a,"Must have selected a valid plan to signup")}catch(e){s.default.reportError(e)}a?this.isSubmitting.get()||(this.isSubmitting.set(!0),s.default.XHR_PrivateAPI({type:"POST",path:"/billing/signup",data:{email:s.default.billingManager.getBillingIdentifier(),nonce:t,planID:a},requireAuth:!0,cb:function(e){if(this.isSubmitting.set(!1),200===e.status){s.default.billingManager.setPremiumStatus(PremiumStatus.Active),s.default.menus.isModalOpen(this.id)&&this.onClickClose(),s.default.menus.alert({text:"Thank you for signing up for <b>Moo.do</b> premium!",actionText:"OKAY"}),s.default.sendEvent("Billing","PremiumSignupSUCCESS");var t=s.default.parseInt(s.default.billingManager.getPlanPrice(_.indexOf(a)));s.default.reportAdConversion(n.a.ConversionID.Purchase,t)}else{if(e.response)try{var i=JSON.parse(e.response);this._setPaymentResponse(i)}catch(e){s.default.reportError(e),this.signupFailureCode.set(P),this.signupErrorMessage.set(void 0)}else this.signupFailureCode.set(P),this.signupErrorMessage.set(void 0);s.default.sendEvent("Billing","PremiumSignupFAILURE")}}.bind(this)})):(this.signupFailureCode.set(E),this.signupErrorMessage.set(void 0),s.default.sendEvent("Billing","PremiumSignupFAILURE"))}else this.signupFailureCode.set(S),this.signupErrorMessage.set(void 0),s.default.sendEvent("Billing","PremiumSignupFAILURE")},onClickSubmit:function(){this.refs.form.submit()},onClickClose:function(){this.refs.modal.close()},render:function(){var e=this.state,t=e.billingFailureCode||e.signupFailureCode?200:400,a=s.default.classNames("billingSubmit loading20 right",{loading:e.isSubmitting},{disabled:e.isLoading}),i=e.signupErrorMessage?e.signupErrorMessage:"There was an error processing your payment. We will follow up with you shortly.";return r.a.createElement(c.a,{id:"modalBilling",title:"Enter Billing Info",width:400,height:t,backdropClose:!1,scrollable:!1,modalID:Modals.Billing,ref:"modal"},r.a.createElement("div",{key:"content"},!e.billingFailureCode&&!e.signupFailureCode&&r.a.createElement("form",{id:"billingForm",method:"post",action:"javascript:void(0);",ref:"form"},r.a.createElement("div",{id:"braintreeDropin"}),e.isLoading&&r.a.createElement(d.a,{center:!0},"Loading billing system..."),!e.billingFailureCode&&r.a.createElement("div",{className:a},r.a.createElement("input",{type:"submit",className:"new-modal-button mat-button-raised mat-button-blue",value:"SUBMIT"}))),e.signupFailureCode&&r.a.createElement("div",{id:"billingSignupError"},i),e.billingFailureCode&&r.a.createElement("div",{id:"billingError"},"There was an error loading our payment system. Please contact support@moo.do with code "+e.billingFailureCode+" or try again in a few minutes.")),r.a.createElement("div",{key:"buttons",style:{textAlign:"right"}},e.billingFailureCode&&r.a.createElement(l.a,{primary:!0,onClick:this.onClickClose},"OK")))}});t.default=T},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),r=a.n(i),n=a(3),s=a(25),o=a(1),l=a(6),d=a(22),c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},u=n.a.createClass({displayName:"ReactModalConfirm",componentDisplay:o.a.ComponentDisplay.Everywhere,getHotkeys:function(){return[s.a.create(KeyCode.Escape,!0,o.a.Primary.Either,o.a.Shift.Either,this.onClickNo),s.a.create(KeyCode.N,!0,o.a.Primary.Either,o.a.Shift.Either,this.onClickNo),s.a.create(KeyCode.Enter,!0,o.a.Primary.Either,o.a.Shift.Either,this.onClickYes),s.a.create(KeyCode.Y,!0,o.a.Primary.Either,o.a.Shift.Either,this.onClickYes)]},onClickYes:function(){this.refs.modal.close(!0)},onClickNo:function(){this.refs.modal.close(!1)},render:function(){return r.a.createElement(d.a,c({},this.props,{id:"modalConfirm",small:!0,backdropClose:!1,scrollable:!1,closeButton:!1,modalID:Modals.Confirm,ref:"modal"}),r.a.createElement("div",{key:"content"},this.props.text),r.a.createElement("div",{key:"buttons"},r.a.createElement(l.a,{primary:!0,width:100,onClick:this.onClickYes},"YES"),r.a.createElement(l.a,{width:100,onClick:this.onClickNo},"NO")))}});t.default=u},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(1),r=a(2),n=a.n(r),s=a(3),o=a(6),l=a(22),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},c=s.a.createClass({displayName:"ReactModalOptions",componentDisplay:i.a.ComponentDisplay.Everywhere,onClickOption:function(e){this.refs.modal.close(e)},render:function(){return n.a.createElement(l.a,d({},this.props,{id:"modalOptions",title:"Please Choose",small:!0,backdropClose:!1,scrollable:!1,modalID:Modals.Options,ref:"modal"}),n.a.createElement("div",{key:"content"},this.props.text),n.a.createElement("div",{key:"buttons"},this.props.options.map(function(e,t){return n.a.createElement(o.a,{key:t,raised:!0,width:120,margin:"0 8px",onClick:this.onClickOption.bind(this,e)},e)}.bind(this)),n.a.createElement(o.a,{cancel:!0,raised:!0,width:100,margin:"0 8px",onClick:this.onClickOption},"Cancel")))}});t.default=c},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(7),s=a(4),o=a(2),l=a.n(o),d=a(3),c=a(23),u=a(6),h=a(56),f=a(33),p=a(22),m=d.a.createClass({displayName:"ReactModalExport",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({exportArchived:!1,includeNotes:!0,dataType:"html"})},setDataType:function(e){this.dataType.set(e)},exportData:function(){var e,t,a=n.a.getRootItem(),i=this.state.exportArchived,r=this.state.includeNotes;if("html"===this.dataType.get())t=e=n.a.toHtml(a,i,r);else if("text"===this.dataType.get()){t=(e=n.a.toPlainText(a,0,i,r)).replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")}else"json"===this.dataType.get()&&(t=e=n.a.toJSON(a,!1,i,r));return this.exportedContent=e,t},onChangeArchiveItems:function(e){e&&i.default.vmMain.parseSubtreeArchive(i.default.vmMain.root(),ChangeType.Auto),this.exportArchived.set(e)},onChangeIncludeNotes:function(e){this.includeNotes.set(e)},onTapOpen:function(){var e="text"===this.dataType.get()?this.exportData():this.exportedContent;open("url").document.write(e)},onTapSelect:function(){var e=c.a.createSelectionRange();e.selectNodeContents(this.refs.exportedContent),c.a.setSelectionRange(e)},onTapSaveExport:function(){var e;"html"===this.dataType.get()?e="html":"text"===this.dataType.get()?e="txt":"json"===this.dataType.get()&&(e="json");try{i.default.saveFile(this.exportedContent,"moodo."+e)}catch(e){i.default.reportError(e)}},onKeyDown:function(e){var t=s.a.getKeyCode(e);(s.a.mac&&e.metaKey||!s.a.mac&&e.ctrlKey)&&t===KeyCode.A&&this.onTapSelect(),e.preventDefault(),e.stopPropagation()},render:function(){var e=this.state.dataType,t=i.default.classNames("exportedContent",e),a=this.exportData();return l.a.createElement(p.a,{id:"modalExport",title:"Export Data",width:860,height:900,modalID:Modals.ExportData},l.a.createElement("div",{key:"sidebar",width:180},l.a.createElement(h.a,{header:!0},"Data Type"),l.a.createElement(h.a,{selected:"html"===e,onClick:this.setDataType.bind(this,"html")},"HTML"),l.a.createElement(h.a,{selected:"text"===e,onClick:this.setDataType.bind(this,"text")},"Plain Text"),l.a.createElement(h.a,{selected:"json"===e,onClick:this.setDataType.bind(this,"json")},"JSON"),l.a.createElement(h.a,{header:!0},"Options"),l.a.createElement(h.a,null,l.a.createElement(f.a,{checked:this.state.includeNotes,onChange:this.onChangeIncludeNotes},"Include Notes")),l.a.createElement(h.a,null,l.a.createElement(f.a,{checked:this.state.exportArchived,onChange:this.onChangeArchiveItems},"Archived Items")),l.a.createElement(h.a,{header:!0},"Export"),!s.a.app&&l.a.createElement(u.a,{onClick:this.onTapOpen},"OPEN IN TAB"),l.a.createElement(u.a,{onClick:this.onTapSelect},"SELECT"),l.a.createElement(u.a,{onClick:this.onTapSaveExport},"SAVE")),l.a.createElement("div",{key:"content"},l.a.createElement("div",{className:t,onKeyDown:this.onKeyDown,contentEditable:!0,dangerouslySetInnerHTML:{__html:a},ref:"exportedContent"})))}});t.default=m},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(239),d=a(22),c=a(56),u=a(6),h=a(21),f=o.a.createClass({displayName:"ReactModalImport",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){var e=this.props.importer;"GTasks"===e&&(e="Google Tasks"),this.createObservables({isImporting:!1,preloadDisable:0,currentImporter:e||"JSON",importMessage:""}),this.importer=new l.a},getImporterFromName:function(e){var t;switch(e){case"Wunderlist":t=this.importer.wunderlist;break;case"Workflowy":t=this.importer.workflowy;break;case"OPML":t=this.importer.opml;break;case"JSON":t=this.importer.json;break;case"Text":t=this.importer.text;break;case"GTasks":case"Google Tasks":t=this.importer.gtasks;break;case"Trello":t=this.importer.trello;break;case"Todoist":t=this.importer.todoist;break;case"Toodledo":t=this.importer.toodledo;break;case"IQTell":t=this.importer.iqtell;break;default:try{i.default.PAssert(2574,!1,"Must add valid importer: ",e)}catch(e){i.default.reportError(e)}}return t},selectImporter:function(e){var t=this.getImporterFromName(e);this.currentImporter.set(e),this.importMessage.set(""),this.isImporting.set(!1),t&&t.preload&&!t.isLoaded&&(this.preloadDisable.set(this.preloadDisable.get()+1),this.importMessage.set("Loading Trello login..."),t.preload(function(){this.preloadDisable.set(this.preloadDisable.get()-1);var e=this.getImporterFromName(this.currentImporter.get());0===this.preloadDisable.get()&&e&&e.preload&&this.importMessage.set("")}.bind(this),function(e){this.preloadDisable.set(this.preloadDisable.get()-1),this.importMessage.set("Error loading Trello. Please try again.")}.bind(this)))},onImportError:function(e,t){!1!==e?(e&&i.default.isString(e)||(t||(t=e),e="Moo.do encountered an error importing your data. The developers have been notified with details of the error."),i.default.reportError(t||e,e),this.importMessage.set(e)):this.importMessage.set(""),this.isImporting.set(!1)},runImport:function(e,t,a){if(!(this.isImporting.get()||this.preloadDisable.get()>0)){var r=this.getImporterFromName(e);if(r){i.default.sendEvent("Menu","Import"+e),this.isImporting.set(!0),this.importMessage.set("Importing...");try{setTimeout(function(){r.login(t,a,function(){r.import(function(t){r.save(t,function(){this.isImporting.set(!1),this.importMessage.set(""),i.default.menus.alert({text:"Your data has been imported successfully!",actionText:"OK",callback:function(){i.default.menus.closeModalNew(Modals.ImportData)}}),i.default.sendEvent("ImportSuccess",e)}.bind(this),this.onImportError)}.bind(this),this.onImportError)}.bind(this),this.onImportError)}.bind(this),0)}catch(e){this.onImportError("There was an issue importing your data. Please try again later.",e)}}}},onTapSelect:function(e){this.selectImporter(e,this.onImportSuccess,this.onImportError)},whichArea:function(){switch(this.state.currentImporter){case"Wunderlist":return"OAuthArea";case"Workflowy":return"LoginArea";case"OPML":case"JSON":return"UploadArea";case"Google Tasks":case"GTasks":case"Trello":case"Todoist":case"Toodledo":return"OAuthArea";case"IQTell":return"UploadAreaIQTell";default:try{i.default.PAssert(2575,!1,"Must add valid importer")}catch(e){i.default.reportError(e)}}return!1},onClickImport:function(){if(!this.isImporting.get()){var e=this.refs.email&&this.refs.email.getValue(),t=this.refs.password&&this.refs.password.getValue();this.runImport(this.state.currentImporter,e,t)}},renderListItem:function(e){return s.a.createElement(c.a,{selected:this.state.currentImporter===e,onClick:this.onTapSelect.bind(this,e)},e)},renderContent:function(){var e,t=this.state,a=this.state.currentImporter,i=this.whichArea(a);return"LoginArea"===i?e=s.a.createElement("div",null,s.a.createElement("div",{className:"importTitle"},"Import data from ",a),s.a.createElement(h.a,{floatingText:"Email",display:"block",ref:"email"}),s.a.createElement(h.a,{type:"password",floatingText:"Password",display:"block",ref:"password"}),s.a.createElement("br",null)):"UploadArea"===i?e=s.a.createElement("div",{id:"importUploadArea"},s.a.createElement("div",{className:"importTitle"},"Upload ",a," file"),s.a.createElement("div",null,"Select a","OPML"===a?"n":""," ",a," file to upload"),s.a.createElement("form",{name:"importFileUpload"},s.a.createElement("input",{id:"importFileUploadButton",type:"file",required:"required",name:"importFile"}))):"UploadAreaIQTell"===i?e=s.a.createElement("div",{id:"importUploadArea"},s.a.createElement("div",{className:"importTitle"},"Upload ",a," files [BETA]"),s.a.createElement("div",null,"Export each folder from IQTell that you would like to import. You must include either the 'Short Descripton' or 'Title' fields for each. Select *all* of the exported files at once to do a single import otherwise data may be missing."),s.a.createElement("div",null," "),s.a.createElement("div",null,"Please report any issues to support@moo.do with a description of what you expect vs what you are seeing. Screenshots are very helpful."),s.a.createElement("form",{name:"importFileUpload"},s.a.createElement("input",{id:"importFileUploadButton",type:"file",required:"required",name:"importFile",multiple:!0}))):"OAuthArea"===i&&(e=s.a.createElement("div",null,s.a.createElement("div",{className:"importTitle"},"Import data from ",a),s.a.createElement("div",null,"Click to login to your account"))),s.a.createElement("div",{className:"importInside"},e,s.a.createElement(u.a,{primary:!0,enabled:0===t.preloadDisable&&!t.isImporting,onClick:this.onClickImport},"IMPORT"),s.a.createElement("div",{className:"importMessage"},t.importMessage))},render:function(){return s.a.createElement(d.a,{id:"modalImport",title:"Import Data",width:600,height:600,modalID:Modals.ImportData},s.a.createElement("div",{key:"sidebar",width:180},s.a.createElement(c.a,{header:!0},"Import from app"),this.renderListItem("Wunderlist"),this.renderListItem("Google Tasks"),this.renderListItem("Workflowy"),this.renderListItem("IQTell"),this.renderListItem("Trello"),this.renderListItem("Todoist"),s.a.createElement(c.a,{header:!0},"Import from data"),this.renderListItem("JSON"),this.renderListItem("OPML")),s.a.createElement("div",{key:"content"},this.renderContent()))}});t.default=f},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(7),o=a(10),l=a(79),d=a(15),c=a(13),u=a(14);function h(){this.workflowy={login:this.workflowyLogin.bind(this),import:this.workflowyImport.bind(this),save:this.workflowySave.bind(this)},this.wunderlist={login:this.wunderlistLogin.bind(this),import:this.wunderlistImport.bind(this),save:this.wunderlistSave.bind(this)},this.iqtell={login:this.iqtellLogin.bind(this),import:this.iqtellImport.bind(this),save:this.iqtellSave.bind(this)},this.opml={login:this.opmlLogin.bind(this),import:this.opmlImport.bind(this),save:this.opmlSave.bind(this)},this.json={login:this.jsonLogin.bind(this),import:this.jsonImport.bind(this),save:this.jsonSave.bind(this)},this.gtasks={login:this.gtasksLogin.bind(this),import:this.gtasksImport.bind(this),save:this.gtasksSave.bind(this)},this.trello={preload:this.trelloPreload.bind(this),login:this.trelloLogin.bind(this),import:this.trelloImport.bind(this),save:this.trelloSave.bind(this)},this.todoist={login:this.todoistLogin.bind(this),import:this.todoistImport.bind(this),save:this.todoistSave.bind(this)}}function f(e){return e.toString(c.a.getFormat(DFormat.MonthDay))}h.prototype={workflowyLogin:function(e,t,a,r){try{i.default.PAssert(2593,a,"Workflowy requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2594,r,"Workflowy requires an error callback")}catch(e){i.default.reportError(e)}return e?t?void i.default.XHR_PrivateAPI({type:"POST",path:"/oauth/workflowy",data:{username:e,password:t},cb:function(e){if(200===e.status){try{var t=JSON.parse(e.response);this.workflowy.data=JSON.parse(t.data)}catch(e){return i.default.reportError(e),r("Error parsing successful response from server. The developers have been notified with details of the error.")}return!this.workflowy.data||this.workflowy.data.error?r("Invalid username or password."):a()}var n;try{var s=JSON.parse(e.response);switch(s.code){case PrivateAPIErrorCodes.InvalidParameter:n="Must specify a username and password.";break;case PrivateAPIErrorCodes.UnauthorizedUser:n="Invalid username or password.";break;case PrivateAPIErrorCodes.ErrorContactingRemote:n=s.data;break;default:n="Error contacting server. The developers have been notified with details of the error."}}catch(e){n="Error parsing error response from server. The developers have been notified with details of the error.",i.default.reportError(e)}return r(n)}.bind(this)}):r("Must provide a password."):r("Must provide a valid username.")},workflowyImport:function(e,t){try{i.default.PAssert(2595,e,"Workflowy requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2596,t,"Workflowy requires an error callback")}catch(e){i.default.reportError(e)}return e(this.workflowy.data)},workflowyIterateItem:function(e,t){try{i.default.PAssert(2597,e&&void 0!==e.nm,"All items must exist and have stars and text, children and notes are optional",e)}catch(e){i.default.reportError(e)}try{i.default.PAssert(2599,t,"A valid parent must always be defined")}catch(e){i.default.reportError(e)}if(e&&t)try{var a=!!e.cp;if(!a){var r=i.default.stripFormattingTags(e.nm),n=s.a.createVMLI({text:r,isComplete:a},{parent:t,changeType:ChangeType.AllLocal});if(t.insertItem(n),e.no){var o=i.default.stripFormattingTags(e.no),l=s.a.createVMLI({text:o,isNote:!0},{parent:n,changeType:ChangeType.AllLocal});n.setNote(l,ChangeType.Local)}if(e.ch)for(var d=0;d<e.ch.length;++d){var c=e.ch[d];this.workflowyIterateItem(c,n)}}}catch(e){throw i.default.reportError(e),e}},workflowySave:function(e,t,a){try{i.default.PAssert(2600,e,"Workflowy requires having valid data")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2601,t,"Workflowy requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2602,a,"Workflowy requires an error callback")}catch(e){i.default.reportError(e)}try{try{i.default.PAssert(2603,e.projectTreeData,"Missing Workflowy projectTreeData")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2604,e.projectTreeData.mainProjectTreeInfo,"Missing Workflowy mainProjectTreeInfo")}catch(e){i.default.reportError(e)}var r=e.projectTreeData.mainProjectTreeInfo;try{i.default.PAssert(2605,r.rootProjectChildren,"Missing Workflowy rootProjectChildren")}catch(e){i.default.reportError(e)}o.a.beginAction(),i.default.vmMain.beginUpdateItems();var n=s.a.getRootModel();try{i.default.PAssert(2606,n,"Root item must exist in order to import")}catch(e){i.default.reportError(e)}var l=s.a.createVMLI({text:"Workflowy Import"},{parent:n,changeType:ChangeType.AllLocal});n.insertItem(l);try{for(var d=0;d<r.rootProjectChildren.length;++d){var c=r.rootProjectChildren[d];this.workflowyIterateItem(c,l)}i.default.vmMain.parseSubtree(l,ChangeType.Local|ChangeType.All)}catch(e){return i.default.reportError(e),a("There was an error iterating your Workflowy items. The developers have been notified with daetails of the error.",e)}return i.default.vmMain.commitUpdateItems(),o.a.endAction(),t()}catch(e){return i.default.reportError(e),a("There was an error parsing your Workflowy data. The developers have been notified with details of the error.",e)}},wunderlistLogin:function(e,t,a,r){try{i.default.PAssert(2607,a,"Wunderlist requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2608,r,"Wunderlist requires an error callback")}catch(e){i.default.reportError(e)}var n="localhost"===window.location.hostname?"f06a1334e250a9bb0b03":"ad988eeb954e9aabc288",s=window.location.protocol+"//"+window.location.host+"/oauthRelay.html";this.wunderlist.clientId=n;var o="Dchs"+(new Date).getTime(),l="https://www.wunderlist.com/oauth/authorize?client_id="+n+"&redirect_uri="+s+"&state="+o;window.open(l,"wunderlist","height=600,width=550");var d=function(e){var t=i.default.getLocationOrigin(),n=!1;try{n=e.data.state===o}catch(e){i.default.reportError(e)}if(t&&n)if(window.removeEventListener("message",d),e.data.error)r("Error authenticating with Wunderlist");else{var s=e.data.code;s&&i.default.XHR_PrivateAPI({type:"POST",path:"/oauth/wunderlist",data:{code:s},requireAuth:!0,cb:function(e){if(200===e.status){try{var t=JSON.parse(e.response).data;this.wunderlist.token=t.access_token}catch(e){r("Error parsing response from remote server.",e)}this.wunderlist.token?a():r("Invalid username or password.")}else r("Error contacting remote server.")}.bind(this)})}}.bind(this);window.addEventListener("message",d)},wunderlistImport:function(e,t){try{i.default.PAssert(2609,e,"Wunderlist requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2610,t,"Wunderlist requires an error callback")}catch(e){i.default.reportError(e)}var a={inbox:{title:"inbox",items:{},p:0}},r=0;this.wunderlistGetLists(function(i){for(var n=0;n<i.length;++n){var s=i[n];a[s.id]={title:s.title,items:{},p:s.position},this.wunderlistGetTasks(s.id,function(n){for(var o=0;o<n.length;++o){var l=n[o];if(l.parent_id){var d=a[l.list_id].items[l.parent_id];d?(d.items||(d.items=[]),d.items.push(l)):a[l.list_id].items[l.parent_id]={items:[l]}}else{var c=a[l.list_id].items[l.id];a[l.list_id].items[l.id]=l,c&&(a[l.list_id].items[l.id].items=c.items)}}this.wunderlistGetSubtasks(s.id,function(t){for(var n=0;n<t.length;++n){var s=t[n],o=a[s.list_id];if(o)if(s.parent_id){var l=o.items[s.parent_id];l?(l.items||(l.items=[]),l.items.push(s)):o.items[s.parent_id]={items:[s]}}else{var d=o.items[s.id];o.items[s.id]=s,d&&(o.items[s.id].items=d.items)}}++r===i.length&&e(a)}.bind(this),t)}.bind(this),t)}}.bind(this),t)},wunderlistGetLists:function(e,t){try{i.default.PAssert(2611,e,"Wunderlist requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2612,t,"Wunderlist requires an error callback")}catch(e){i.default.reportError(e)}i.default.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/lists",headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function(a){if(200===a.status){var i;try{i=JSON.parse(a.response)}catch(e){t("There was an error parsing your Wunderlist data. The developers have been notified with details of the error.",e)}e(i)}else t("Error contacting remote server.")}.bind(this)})},wunderlistGetTasks:function(e,t,a){try{i.default.PAssert(2613,t,"Wunderlist requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2614,a,"Wunderlist requires an error callback")}catch(e){i.default.reportError(e)}i.default.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/tasks?list_id="+e,headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function(e){if(200===e.status){var i=JSON.parse(e.response);t(i)}else a("Error contacting remote server.")}.bind(this)})},wunderlistGetSubtasks:function(e,t,a){try{i.default.PAssert(2615,t,"Wunderlist requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2616,a,"Wunderlist requires an error callback")}catch(e){i.default.reportError(e)}i.default.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/subtasks?list_id="+e,headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function(e){if(200===e.status){var i=JSON.parse(e.response);t(i)}else a("Error contacting remote server.")}.bind(this)})},wunderlistSave:function(e,t,a){try{i.default.PAssert(2617,t,"Wunderlist requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2618,a,"Wunderlist requires an error callback")}catch(e){i.default.reportError(e)}try{o.a.beginAction(),i.default.vmMain.beginUpdateItems();var r=s.a.getRootModel();try{i.default.PAssert(2619,r,"Root item must exist in order to import")}catch(e){i.default.reportError(e)}var n=s.a.createVMLI({text:"Wunderlist Import"},{parent:r,changeType:ChangeType.AllLocal});for(var l in r.insertItem(n),e){var d=e[l];0;var c=d.title,u=s.a.createVMLI({text:c},{parent:n,changeType:ChangeType.AllLocal});for(var h in n.insertItem(u),d.items){var f=d.items[h];0;var p=s.a.createVMLI({text:f.title,isComplete:!!f.completed_at,dateCompleted:f.completed_at,isStarred:f.starred},{parent:u,changeType:ChangeType.AllLocal});if(u.insertItem(p),f.note){var m=s.a.createVMLI({text:f.note},{parent:p,changeType:ChangeType.AllLocal});p.insertItem(m)}if(f.items)for(var g=0;g<f.items.length;++g){var v=f.items[g];0;var y=s.a.createVMLI({text:v.title,isComplete:!!v.completed_at,dateCompleted:v.completed_at,isStarred:v.starred},{parent:p,changeType:ChangeType.AllLocal});p.insertItem(y)}}}i.default.vmMain.parseSubtree(n,ChangeType.Local|ChangeType.All),i.default.vmMain.commitUpdateItems(),o.a.endAction(),t()}catch(e){a(void 0,e)}},iqtellLogin:function(e,t,a,r){try{i.default.PAssert(2620,a,"IQTell requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2621,r,"IQTell requires an error callback")}catch(e){i.default.reportError(e)}var n=document.getElementById("importFileUploadButton");n.onchange=a,n.click()},_readMultipleFiles:function(e,t,a){var r=0,n=0,s=!1,o={},d={},c={};function u(){s&&r+n===e.length&&(n>0?a(function(){var e="";for(var t in c)e+=l.a._parseIQTellFilename(t)+": "+c[t]+"\r\n";return e}()):t(o,d))}function h(e,t,a){o[t]=e,d[t]=a,r++,u()}function f(e,t){c[t]=e,n++,u()}for(var p=0;p<e.length;++p){var m=new FileReader;m.onload=function(e,t){var a=t.target.result;if(a){var r=l.a.parseCSV(a);r&&!i.default.isString(r)?h(r,e,a):f(r||"Error parsing IQTell import. Please validate your data.",e)}else f("Unable to load IQTell data. Please contact support.",e)}.bind(this,e[p].name),m.onerror=function(e,t){f(t,e)}.bind(this,e[p].name),m.readAsText(e[p])}s=!0,u()},iqtellImport:function(e,t){try{i.default.PAssert(2622,e,"IQTell requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2623,t,"IQTell requires an error callback")}catch(e){i.default.reportError(e)}try{var a=document.forms.importFileUpload.importFile.files;if(a&&0!==a.length){this._readMultipleFiles(a,function(a,r){var n;o.a.beginAction(),i.default.vmMain.beginUpdateItems();try{n=l.a.iqtellProcess(a,r)}catch(e){i.default.reportError(e,r)}log("IQTell output: ",n),i.default.vmMain.commitUpdateItems(),o.a.endAction(),n?e():t("Error parsing IQTell import. Please contact support")},t)}else t("You must select a file before importing.")}catch(e){t(void 0,e)}},iqtellSave:function(e,t,a){try{i.default.PAssert(2624,t,"IQTell requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2625,a,"IQTell requires an error callback")}catch(e){i.default.reportError(e)}t()},opmlLogin:function(e,t,a,r){try{i.default.PAssert(2626,a,"OPML requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2627,r,"OPML requires an error callback")}catch(e){i.default.reportError(e)}var n=document.getElementById("importFileUploadButton");n.onchange=a,n.click()},opmlImport:function(e,t){try{i.default.PAssert(2628,e,"OPML requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2629,t,"OPML requires an error callback")}catch(e){i.default.reportError(e)}try{var a=new FileReader,r=document.forms.importFileUpload.importFile.files[0];r?(a.onload=function(a){var n,s=a.target.result;if((s.startsWith("<?xml ")||s.startsWith("<?opml ")||s.startsWith("<opml "))&&(n=i.default.loadXML(s)),n){o.a.beginAction(),i.default.vmMain.beginUpdateItems();var d=l.a.parseOPML(n,r.name);i.default.vmMain.commitUpdateItems(),o.a.endAction(),d?e():t("Error parsing OPML. Please validate your data.")}else t("Unable to load XML lib. Please update or try another browser.")},a.onerror=t,a.readAsText(r)):t("You must select a file before importing.")}catch(e){t(void 0,e)}},opmlSave:function(e,t,a){try{i.default.PAssert(2630,t,"OPML requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2631,a,"OPML requires an error callback")}catch(e){i.default.reportError(e)}t()},jsonLogin:function(e,t,a,r){try{i.default.PAssert(2632,a,"JSON requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2633,r,"JSON requires an error callback")}catch(e){i.default.reportError(e)}var n=document.getElementById("importFileUploadButton"),s=!1;n.onchange=function(e){s=!0,a(e)},n.click();document.body.onfocus=function(){s||r(!1),document.body.onfocus=void 0}},jsonImport:function(e,t){try{var a=new FileReader,r=document.forms.importFileUpload.importFile.files[0];r?(a.onload=function(a){var r=a.target.result;if(!r)return t("Unable to import your requested file. Please try a different file.");try{var n=JSON.parse(r)}catch(e){return t("The JSON is not properly formatted. Please re-validate or send the file to support@moo.do.")}try{o.a.beginAction(),i.default.vmMain.beginUpdateItems();var s=l.a.parseJSON(n);return i.default.vmMain.commitUpdateItems(),o.a.endAction(),s?e():t("Invalid JSON format. The developers have been notified with details of the error.")}catch(e){return t("The JSON file has errors. The developers have been notified with details of the error.",e)}},a.onerror=t,a.readAsText(r)):t("You must select a file before importing.")}catch(e){t(void 0,e)}},jsonSave:function(e,t,a){try{i.default.PAssert(2634,t,"JSON requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2635,a,"JSON requires an error callback")}catch(e){i.default.reportError(e)}t()},gtasksLogin:function(e,t,a,r){try{i.default.PAssert(2640,a,"GTasks requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2641,r,"GTasks requires an error callback")}catch(e){i.default.reportError(e)}d.a.runAuthenticate([GScope.TasksRO],!1,!1,function(e){e&&!e.error?(this.gtasks.token=e,a(e)):r("Unable to authenticate with Google. Please try again.",e)}.bind(this))},gtasksImport:function(e,t){try{i.default.PAssert(2642,e,"GTasks requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2643,t,"GTasks requires an error callback")}catch(e){i.default.reportError(e)}var a={roots:[],remoteItems:{},unassigned:[]};this.gtasksGetLists(function(r){try{i.default.PAssert(2644,i.default.isArray(r),"List data must be an array")}catch(e){i.default.reportError(e)}for(var n=r.length,s=0,o=0;o<r.length;++o){var l=r[o];a.remoteItems[l.id]={id:l.id,text:l.title,isComplete:!1,dateCompleted:void 0,isArchived:!1,due:void 0,notes:void 0,parent:void 0,items:[]},a.roots.push(l.id),this.gtasksGetTasks(l,function(r,o){if(r){try{i.default.PAssert(2645,i.default.isArray(r),"List data must be an array")}catch(e){i.default.reportError(e)}if(i.default.isArray(r)){for(var l=0;l<r.length;++l){var d=r[l];if(d&&"completed"!==d.status){a.remoteItems[d.id]={id:d.id,text:d.title,isComplete:"completed"===d.status,dateCompleted:d.completed?new Date(d.completed):void 0,isArchived:d.hidden,due:d.due?new Date(d.due):void 0,notes:d.notes,parent:d.parent||o.id,items:[]};var c=a.remoteItems[d.parent||o.id];c?c.items.push(d.id):a.unassigned.push(d.id)}}++s===n&&e(a)}else t("Invalid task list returned.")}else s++}.bind(this),t)}}.bind(this),t)},gtasksGetLists:function(e,t){try{i.default.PAssert(2646,e,"GTasks requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2647,t,"GTasks requires an error callback")}catch(e){i.default.reportError(e)}i.default.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/users/@me/lists?maxResults=2000&key="+window.gapiKey+"&access_token="+u.a.getDefaultAccessToken(),cb:function(a){if(200===a.status)try{var r=JSON.parse(a.response);try{i.default.PAssert(2648,r&&r.items,"Must have a valid set of data to get tasks from")}catch(e){i.default.reportError(e)}r&&r.items?e(r.items):t("Error getting data from remote server.")}catch(e){t(e)}else t("Error contacting remote server.")}.bind(this)})},gtasksGetTasks:function(e,t,a){try{i.default.PAssert(2649,e,"GTasks requires a valid list to get tasks from")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2650,t,"GTasks requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2651,a,"GTasks requires an error callback")}catch(e){i.default.reportError(e)}i.default.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/lists/"+e.id+"/tasks?maxResults=2500&key="+window.gapiKey+"&access_token="+u.a.getDefaultAccessToken(),cb:function(r){if(200===r.status)try{var n=JSON.parse(r.response);try{i.default.PAssert(2652,n,"Must have a valid array of tasks")}catch(e){i.default.reportError(e)}n&&n.items?t(n.items,e):t([],e)}catch(e){a(e)}else a("Error contacting remote server.")}.bind(this)})},gtasksSave:function(e,t,a){try{i.default.PAssert(2653,t,"GTasks requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2654,a,"GTasks requires an error callback")}catch(e){i.default.reportError(e)}try{try{i.default.PAssert(2655,0===e.unassigned.length,"We should never have unassigned tasks")}catch(e){i.default.reportError(e)}o.a.beginAction(),i.default.vmMain.beginUpdateItems();var r=s.a.getRootModel();try{i.default.PAssert(2656,r,"Root item must exist in order to import")}catch(e){i.default.reportError(e)}var n=s.a.createVMLI({text:"Google Tasks Import"},{parent:r,changeType:ChangeType.AllLocal});function l(t,a){var i=t.text;t.due&&(i+=" @"+f(t.due));var r=s.a.createVMLI({text:i,isComplete:t.isComplete,dateCompleted:t.dateCompleted?t.dateCompleted.getTime():t.dateCompleted,isArchived:t.isArchived},{parent:a,changeType:ChangeType.AllLocal});if(a.insertItem(r),t.notes){var n=s.a.createVMLI({text:t.notes,isNote:!0},{parent:r,changeType:ChangeType.AllLocal});r.setNote(n,ChangeType.Local)}for(var o=0;o<t.items.length;++o)l(e.remoteItems[t.items[o]],r)}r.insertItem(n);for(var d=0;d<e.roots.length;++d)l(e.remoteItems[e.roots[d]],n);i.default.vmMain.parseSubtree(n,ChangeType.Local|ChangeType.All),i.default.vmMain.commitUpdateItems(),o.a.endAction(),t()}catch(e){a(void 0,e)}},trelloPreload:function(e,t){window.Trello||this.trello.isLoading?e():(this.trello.isLoading=!0,i.default.addScript("https://code.jquery.com/jquery-1.7.1.min.js","jqueryScript",function(){i.default.addScript("https://api.trello.com/1/client.js?key=667ecf0c3d3e029c51d205b7173f6c38","trelloScript",function(){this.trello.isLoading=!1;try{i.default.PAssert(2657,window.Trello,"The Trello client lib must have been loaded correctly")}catch(e){i.default.reportError(e)}window.Trello?e():t("Error loading Trello. Please try again.")}.bind(this),function(e){this.trello.isLoading=!1,t(e)})}.bind(this),function(e){this.trello.isLoading=!1,t(e)}))},trelloLogin:function(e,t,a,r){try{i.default.PAssert(2658,window.Trello,"The Trello client lib was not properly loaded")}catch(e){i.default.reportError(e)}if(window.Trello){if(n.a.appPlatform===AppPlatform.Chrome){var s=function(e){i.default.getLocationOrigin()&&(window.removeEventListener("message",s),e.data.error?r("Error authenticating with Trello."):(Trello.setToken(e.data.token),a()))};window.addEventListener("message",s)}Trello.authorize({type:n.a.appPlatform===AppPlatform.Chrome?"redirect":"popup",name:"Moo.do",persist:!1,expiration:"1hour",success:a,error:r})}else r("Error loading Trello. Please try again.")},trelloImport:function(e,t){var a=[];Trello.get("members/me/boards",i.default.protectFn(function(i){var r=(i=i||[]).length,n=0;function s(){r===n&&e(a)}function o(e){n++,s()}for(var l=0;l<i.length;++l){var d=i[l];if(d.closed)r--;else{var c={text:d.name,items:[]};a.push(c),this._handleBoard(c,d.id,t,o)}}s()}.bind(this),t),t)},_handleBoard:function(e,t,a,r){Trello.get("boards/"+t+"/lists",i.default.protectFn(function(t){var i=0,n=t.length;function s(){i===n&&r()}function o(){i++,s()}for(var l=0;l<t.length;++l){var d=t[l];if(d.closed)n--;else{var c={text:d.name,items:[]};e.items.push(c),this._handleList(c,d.id,a,o)}}s()}.bind(this),a),a)},_handleList:function(e,t,a,n){Trello.get("lists/"+t+"/cards",i.default.protectFn(function(t){var i=0,s=t.length;function o(){i===s&&n()}function l(){i++,o()}for(var d=0;d<t.length;++d){var c=t[d];if(c.closed)s--;else{var u={text:c.name};if(c.labels&&c.labels.length>0){for(var h="",p=0;p<c.labels.length;++p){var m=c.labels[p];h+=r.a.TagPrefix+(m.name.length>0?m.name:m.color)+" "}u.text=h+u.text}if(c.due&&(u.text+=" "+r.a.DatePrefix+f(new Date(c.due))),c.desc&&c.desc.length>0){u.items=[];var g=c.desc.split("\n");for(p=0;p<g.length;++p){var v=g[p];v&&v.length>0&&u.items.push({text:v})}}if(c.idChecklists&&c.idChecklists.length>0){u.items||(u.items=[]);for(p=0;p<c.idChecklists.length;++p)this._handleChecklist(u,c.idChecklists[p],a,l)}else i++;e.items.push(u)}}o()}.bind(this),a),a)},_handleChecklist:function(e,t,a,r){Trello.get("checklists/"+t+"/",i.default.protectFn(function(t){for(var a={text:t.name,isCollapsed:!0,items:[]},i=0;i<t.checkItems.length;++i){var n=t.checkItems[i],s="complete"===n.state;if(!s){var o={text:n.name,isComplete:s};a.items.push(o)}}e.items.push(a),r()}.bind(this),a),a)},trelloSave:function(e,t,a){function r(e,t){var a=s.a.createVMLI({text:e.text,isComplete:e.isComplete,isCollapsed:e.isCollapsed},{parent:t,changeType:ChangeType.AllLocal});if(t.insertItem(a),e.items)for(var i=0;i<e.items.length;++i)r(e.items[i],a);return a}try{o.a.beginAction(),i.default.vmMain.beginUpdateItems();var n=s.a.getRootModel();try{i.default.PAssert(2659,n,"Root item must exist in order to import")}catch(e){i.default.reportError(e)}var l=s.a.createVMLI({text:"Trello Import"},{parent:n,changeType:ChangeType.AllLocal});n.insertItem(l);for(var d=0;d<e.length;++d)r(e[d],l);i.default.vmMain.commitUpdateItems(),o.a.endAction()}catch(e){return a(e)}t()},todoistLogin:function(e,t,a,r){try{i.default.PAssert(2660,a,"Todoist requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2661,r,"Todoist requires an error callback")}catch(e){i.default.reportError(e)}var n="localhost"===window.location.hostname?"5d361221eddb4bcdb018457c7c74e698":"b701ac04f4df419ca4144ab208a9fb06",s="Dchs"+(new Date).getTime(),o="https://todoist.com/oauth/authorize?client_id="+n+"&scope=data:read&state="+s;window.open(o,"todoist","height=600,width=550");var l=function(e){var t=i.default.getLocationOrigin(),n=!1;try{n=e.data.state===s}catch(e){i.default.reportError(e)}if(t&&n)if(window.removeEventListener("message",l),e.data.error)r("Error authenticating with Todoist");else{var o=e.data.code;o&&i.default.XHR_PrivateAPI({type:"POST",path:"/oauth/todoist",data:{code:o},requireAuth:!0,cb:function(e){if(200===e.status){try{var t=JSON.parse(e.response).data;this.todoist.data=t}catch(e){r("Error parsing response from remote server.",e)}this.todoist.data?a():r("Invalid username or password")}else r("Error contacting remote server.")}.bind(this)})}}.bind(this);window.addEventListener("message",l)},todoistImport:function(e,t){try{i.default.PAssert(2662,e,"Todoist requires a success callback")}catch(e){i.default.reportError(e)}try{i.default.PAssert(2663,t,"Todoist requires an error callback")}catch(e){i.default.reportError(e)}for(var a=this.todoist.data,r={},n=0;n<a.projects.length;++n){var s=a.projects[n];s.is_archived||s.is_deleted||(r[s.id]={name:s.name,items:[]})}for(n=0;n<a.items.length;++n){var o=a.items[n];!r[o.project_id]||o.is_deleted||o.is_archived||o.checked||r[o.project_id].items.push(o)}e(r)},todoistSave:function(e,t,a){var r=[VMLIFlag.None,VMLIFlag.None,VMLIFlag.P2,VMLIFlag.P1,VMLIFlag.P0];function n(e,t){e.priority&&(e.priority=r[e.priority]),e.due_date_utc&&(e.content+=" @"+f(new Date(e.due_date_utc)));var a=s.a.createVMLI({text:e.content||"",isCollapsed:!!e.collapsed,priority:e.priority},{parent:t,changeType:ChangeType.AllLocal});return t.insertItem(a),a}try{o.a.beginAction(),i.default.vmMain.beginUpdateItems();var l=s.a.getRootModel();try{i.default.PAssert(2664,l,"Root item must exist in order to import")}catch(e){i.default.reportError(e)}var d=s.a.createVMLI({text:"Todoist Import"},{parent:l,changeType:ChangeType.AllLocal});for(var c in l.insertItem(d),e){var u=e[c],h=u.items;h.sort(function(e,t){return e.item_order>t.item_order});var p=s.a.createVMLI({text:u.name},{parent:d,changeType:ChangeType.AllLocal});d.insertItem(p);for(var m={},g=0;g<h.length;++g){var v=h[g];try{i.default.PAssert(2665,!v.parent_id||m[v.parent_id],"Parent exists and has not been created yet")}catch(e){i.default.reportError(e)}var y=v.parent_id?m[v.parent_id]:p;y||(y=p,v.content="[Error] "+v.content),m[v.id]=n(v,y)}}i.default.vmMain.commitUpdateItems(),o.a.endAction()}catch(e){return a(e)}t()}},t.a=h},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(7),s=a(17),o=a(4),l=a(2),d=a.n(l),c=a(3),u=a(241),h=a(23),f=a(22),p=a(56),m=a(6),g=c.a.createClass({displayName:"ReactModalRevisionHistory",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){if(this.maxRevision=0,this.revisions=[],this.selectedRevision=null,this.isOnline=!!s.a.doc,this.createObservables({isLoading:!1,recoveredPreview:null}),s.a.doc){var e=u.a.getCurrentRevision()-1;this.maxRevision=e,this.selectedRevision=e;for(var t=Math.max(e-window.__MoodoRecovery.maxUIRevisions,0),a=[],i=e;i>=t;--i)a.push(i);this.revisions=a,this.updatePreview()}else this.recoveredPreview.set("You must be online to view your revision history. Please go online and try again.")},updatePreview:function(){this.recoveredPreview.set("",!1),this.isLoading.set(!0);var e=u.a.getCurrentDocID();u.a.getRevisionData(e,this.selectedRevision,"html",function(e){this.recoveredPreview.set(e,!1),this.isLoading.set(!1)}.bind(this))},onSelectChange:function(e){this.selectedRevision=this.revisions[e.target.selectedIndex],log(this.selectedRevision),this.updatePreview()},onTapSelect:function(){var e=h.a.createSelectionRange();e.selectNodeContents(this.refs.exportedContent),h.a.setSelectionRange(e)},onKeyDown:function(e){var t=o.a.getKeyCode(e);log(e.metaKey,e.ctrlKey,e.keyCode),(o.a.mac&&e.metaKey||!o.a.mac&&e.ctrlKey)&&t===KeyCode.A&&this.onTapSelect(),e.preventDefault(),e.stopPropagation()},onTapRestore:function(e,t){return u.a.recoverRevision(this.selectedRevision,function(){i.default.menus.alert({text:"Your data has been recovered.",actionText:"OKAY",callback:n.a.clearDataAndReload}),t()},function(){i.default.menus.alert({text:"There was an error recovering your data. Please contact support@moo.do for additional help.",actionText:"OKAY"}),t()}),!0},render:function(){var e=i.default.classNames({loading:this.state.isLoading});return d.a.createElement(f.a,{id:"modalRevisionHistory",title:"Revision History",width:860,height:900,modalID:Modals.RevisionHistory},d.a.createElement("div",{key:"sidebar",width:180},d.a.createElement(p.a,{header:!0},"Choose Revision"),d.a.createElement(p.a,{style:{lineHeight:"24px",height:"36px"},clickable:!1},d.a.createElement("select",{onChange:this.onSelectChange},this.revisions.map(function(e){return d.a.createElement("option",{key:e,value:e},e)}))),d.a.createElement(m.a,{primary:!0,enabled:this.isOnline,onClick:this.onTapRestore},"RESTORE"),d.a.createElement(p.a,{header:!0},"Directions"),d.a.createElement(p.a,{clickable:!1,subtext:!0},d.a.createElement("p",null,"Choose the revision from the dropdown that you want to revert to."),d.a.createElement("p",null,"Each change is a new revision, so if you've made a lot of changes you may want to go back by 50 or 100."),d.a.createElement("p",null,"You may need to reload or re-login to other clients to see the recovered data there."))),d.a.createElement("div",{key:"content",className:e},d.a.createElement("div",{className:"exportedContent",onKeyDown:this.onKeyDown,contentEditable:!0,dangerouslySetInnerHTML:{__html:this.state.recoveredPreview},ref:"exportedContent"})))}});t.default=g},function(e,t,a){"use strict";var i=a(0),r=a(7),n=a(17),s=a(14);function o(e){return e?e.value:void 0}var l=/(?:â(p:[^â]+)â)/gi;function d(e){var t,a;e&&(l.lastIndex=0,t=null!==(a=l.exec(e.json))?e.json.substr(0,a.index)+window.EmbedAttachChar+a[1]+window.EmbedAttachChar+e.json.substr(a.index+a[0].length):e.json);return t}function c(){}c.prototype={_fixPlugins:function(e){this.transformRawRevisionData(e,function(e){if(e.t){var t=d(e.t);t!==e.t.json&&log("Fixed Plugin: "+t),e.t.json=t}})},recoverRevision:function(e,t,a){var i=this.getCurrentDocID();this.getRawRevisionData(i,e,function(e){if(!e)return log("Unable to get revision data"),a();this._fixPlugins(e),this.runRecovery(i,e,t,a)}.bind(this))},runRecovery:function(e,t,a,s){var o={path:"/upload/drive/v2/files/"+e+"/realtime",method:"PUT",params:{uploadType:"media",fileId:e},headers:{"Content-Type":"text/plain;"},body:t},l=gapi.client.request(o),d=n.a.model.getRoot().get("recoverVersion")||0;n.a.model.getRoot().set("recoverVersion",d+1),n.a.clearItemEventListeners(),l.then(function(e){log("Recovery Success: ",e),i.default.settings.set(Settings.localRecoverVersion,d+1),n.a.model.getRoot().set("recoverVersion",d+1),r.a.addDefaultSkipSetting(Settings.gdocId,"Default"),r.a.addDefaultSkipSetting(Settings.gdocTitle,"Default"),n.a.close(!0),a()},function(e){log("Recovery Failure: ",e),s()})},getCurrentRevision:function(){var e;try{e=n.a.doc.getModel().serverVersion}catch(e){i.default.reportError(e)}return e},getCurrentDocID:function(){var e;try{e=i.default.settings.get(Settings.gdocId)}catch(e){i.default.reportError(e)}return e},getRawRevisionData:function(e,t,a){var r=s.a.getDefaultAccessToken();if(r){var n="https://www.googleapis.com/drive/v2/files/"+(e||this.getCurrentDocID())+"/realtime";t&&(n+="?revision="+t),i.default.XHR({type:"GET",url:n,headers:{Authorization:"Bearer "+r},cb:function(e){if(200===e.status)try{var t=JSON.parse(e.responseText);a(t)}catch(e){i.default.reportError(e),a()}else a()}})}else log("Invalid OAuth token"),a()},getDefaultRawRevisionData:function(e,t){return this.getRawRevisionData(this.getCurrentDocID(),e,t)},transformRawRevisionData:function(e,t){var a=o(e.data);if(a){!function e(a,i){if(i>=0&&t(a,i),a.i)for(var r=o(a.i),n=0;n<r.length;++n){var s=o(r[n]);s&&e(s,i+1)}if(a.n){var l=o(a.n);l&&e(l,i+1)}}(o(a.root),-1)}else i.default.reportError("Invalid Revision Data: ",e)},_makeConsumableOutput:function(e,t,a,r){this.getRawRevisionData(e,t,function(e){try{i.default.PAssert(2666,e&&e.data,"Missing expected recovery data")}catch(e){i.default.reportError(e)}if(e&&e.data)try{this.transformRawRevisionData(e,a)}catch(t){i.default.reportError(t),e=void 0}r&&r(e)}.bind(this))},_padText:function(e,t,a){var i="";a=a||" ";for(var r=0;r<t;++r)i+=a;return i+=e},printRevisionData:function(e,t){this._makeConsumableOutput(e,t,function(e,t){console.log(this._padText(d(e.t),t))}.bind(this))},printDefaultRevisionData:function(e){return this.printRevisionData(this.getCurrentDocID(),e)},printRevisionOffset:function(e){var t=this.getCurrentRevision()-e;return t<0?log("Maximum offset is: "+this.getCurrentRevision()):this.printDefaultRevisionData(t)},getRevisionData:function(e,t,a,i){var r="",n=-1;this._makeConsumableOutput(e,t,function(e,t){if(a&&"text"!==a){if("html"===a){if(t>n)r+="<ul>";else if(t<n)for(var i=t;i<n;i++)r+="</ul>";r+="<li>"+d(e.t)+"</li>",n=t}}else r+=this._padText(d(e.t),t,"\t")+"\r\n"}.bind(this),function(e){i(r,e)})},saveRevisionData:function(e,t,a){var i="";this._makeConsumableOutput(e,t,function(e,t){i+=this._padText(d(e.t),t,"\t")+"\r\n"}.bind(this),function(){var e=new Blob([i],{type:"text/plain;charset=utf-8"});saveAs(e,"DataRecovery_"+t+".txt")})},saveDefaultRevisionData:function(e,t){return this.saveRevisionData(this.getCurrentDocID(),e,t)},saveRevisionOffset:function(e,t){var a=this.getCurrentRevision()-e;return a<0?log("Maximum offset is: "+this.getCurrentRevision()):this.saveDefaultRevisionData(a,t)},getHelp:function(){return console.log("To recover your data input __MoodoRecovery.saveRevisionOffset(<revision offset>)"),console.log("The maximum <revision offset> for this document is "+this.getCurrentRevision()),console.log("If you just lost data, an offset of 10 is a good place to start"),console.log("You may need to try larger offsets if the returned file does not contain the data you need"),console.log("This is a temporary tool to help recover data, please report any issues or data loss to support@moo.do"),window.__SendInfo("Recover Help Used!"),""},dumpRawIndexedDB:function(){r.a.dbi.settings.get("root").done(function(e){var t=e.root;r.a.dbi.items.query().all().execute().done(function(e){var a;e.forEach(function(e){e.id===t&&(a=e),r.a.getItem(e.id)||r.a.setItem(e.id,i.default.translateObjOut(e))});var n=r.a.toJSON(a,!1,!1,!0);saveAs(new Blob([n],{type:"text/plain;charset=utf-8"}),"MoodoRecovery.json")})})}};var u=new c;window.__MoodoRecovery={maxUIRevisions:2e3,raw:u,help:u.getHelp.bind(u),getCurrentRevision:u.getCurrentRevision.bind(u),getCurrentDocID:u.getCurrentDocID.bind(u),getRawData:u.getDefaultRawRevisionData.bind(u),printRevision:u.printDefaultRevisionData.bind(u),saveRevision:u.saveDefaultRevisionData.bind(u),printRevisionOffset:u.printRevisionOffset.bind(u),saveRevisionOffset:u.saveRevisionOffset.bind(u),dumpRawIndexedDB:u.dumpRawIndexedDB.bind(u),_getRawRevisionData:u.getRawRevisionData.bind(u)},t.a=u},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a(0);var i=a(1),r=a(2),n=a.n(r),s=a(28),o=a(3),l=a(6),d=a(54),c=a(22),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},h=o.a.createClass({displayName:"ReactModalReportProblem",componentDisplay:i.a.ComponentDisplay.Desktop,componentDidMount:function(){this.refs.textarea.focus()},sendReport:function(e){var t=this.props;s.a.reportMessage(t.accountID,t.threadID,t.msgID,this.refs.textarea.getValue(),e),this.refs.modal.close()},onClickSend:function(){this.sendReport(!0)},onClickCancel:function(){this.sendReport(!1)},render:function(){return n.a.createElement(c.a,u({},this.props,{id:"modalReportProblem",title:"Report Problem",scrollable:!1,modalID:Modals.ReportProblem,ref:"modal"}),n.a.createElement("div",{key:"content"},n.a.createElement("div",{className:"fancyModalText"},"Please describe the display problem."),n.a.createElement(d.a,{ref:"textarea"}),n.a.createElement("div",{className:"fancyModalText"},"This will send the content of your email to the developers to fix display errors.")),n.a.createElement("div",{key:"buttons",style:{textAlign:"right"}},n.a.createElement(l.a,{width:100,onClick:this.onClickCancel},"CANCEL"),n.a.createElement(l.a,{primary:!0,width:100,onClick:this.onClickSend},"SEND")))}});t.default=h},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),r=a.n(i),n=a(5),s=a(0),o=a(1),l=a(3),d=a(26),c=a(24),u=a(14),h=a(33),f=a(6),p=a(40),m=a(22),g=1,v=2,y=3,S=4,E=5,P=l.a.createClass({displayName:"ReactModalWelcome",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){var e=g,t=n.a.getURLParam("ispremium");t&&(e=y),this.createObservables({page:e,isConnected:!1,colorTheme:o.a.ColorTheme.Light}),u.a.onConnected(function(){this.isConnected.set(!0),t||(s.default.billingManager.hasPremiumFeatures()?this.page.set(y):this.page.set(v))}.bind(this)),n.a.removeURLParam("ispremium",!0)},onClickEnable:function(){try{s.default.PAssert(2576,this.state.isConnected,"Must always be connected to the server before enabling")}catch(e){s.default.reportError(e)}var e=this.state.page,t=[PluginID.Contacts,PluginID.GCalendar,PluginID.Gmail,PluginID.Drive],a=e===v?t:t.filter(function(e){return this.refs[e].getValue()}.bind(this)),i=a.map(function(t){return t===PluginID.Drive?{id:t,shared:e===v||this.refs.DriveShared.getValue()}:{id:t}}.bind(this)),r=e===v||this.refs.offlineFeatures.getValue();d.a.enablePlugins(i,r,function(e){e&&this.refs.modal&&(s.default.billingManager.hasPremiumFeatures()||(a.indexOf(PluginID.Drive)>=0||a.indexOf(PluginID.GCalendar)>=0)&&s.default.billingManager.startTrial(),this.page.set(S))}.bind(this))},onClickChoose:function(){this.page.set(y)},onChangeDrive:function(e){this.onChangeFeature(e),e||this.refs.DriveShared.setValue(!1)},onChangeDriveShared:function(e){this.onChangeFeature(e),e&&this.refs[PluginID.Drive].setValue(!0)},onChangeFree:function(e){this.refs[PluginID.Contacts].setValue(e),this.refs[PluginID.Gmail].setValue(e),this.refs.offlineFeatures.setValue(e)},onChangePremium:function(e){this.refs[PluginID.GCalendar].setValue(e),this.refs[PluginID.Drive].setValue(e),this.refs.DriveShared.setValue(e)},checkTier:function(e,t){for(var a=0,i=0;i<t.length;i++)this.refs[t[i]].getValue()?a++:a--;a===t.length&&e.setValue(!0),a===-t.length&&e.setValue(!1)},onChangeFeature:function(e){this.checkTier(this.refs.free,[PluginID.Contacts,PluginID.Gmail]),this.checkTier(this.refs.premium,[PluginID.GCalendar,PluginID.Drive,"DriveShared"])},setColorTheme:function(e){this.colorTheme.set(e),e&&c.a.changeColorTheme(e)},onClickDisplaySettings:function(){this.page.set(E)},onClickGetStarted:function(){this.refs.modal.close()},onClickImport:function(e){this.refs.modal.close(),s.default.menus.openModalNew(Modals.ImportData,{importer:e})},renderPage:function(e){switch(e){case g:return this.renderPageConnecting();case v:return this.renderPageEnableTrial();case y:return this.renderPagePluginSelect();case S:return this.renderPageThemeSelect();case E:return this.renderPageImportData();default:try{s.default.PAssert(2577,!1,"Invalid intro page requested: "+e)}catch(e){s.default.reportError(e)}}},renderPageConnecting:function(){return r.a.createElement("div",{key:"content"},r.a.createElement("div",{className:"setupTitle"},"Welcome to ",r.a.createElement("span",{className:"logoPseudo"}),"!"),r.a.createElement("div",{className:"flexbox flex-center",style:{margin:"64px 0"}},r.a.createElement(p.a,{center:!0},"Connecting to server...")))},renderPageEnableTrial:function(){var e=this.state.isConnected?"NEXT":"Connecting...";return r.a.createElement("div",{key:"content"},r.a.createElement("div",{className:"setupTitle"},"Welcome to ",r.a.createElement("span",{className:"logoPseudo"}),"!"),r.a.createElement("div",{className:"setupFeatures featureCheckboxes"},r.a.createElement("div",{className:"setupPage1Subtitle"},"Start your ",o.a.TrialDuration," day free trial of ",r.a.createElement("b",null,"Moo.do Premium")," and enable syncing with:"),r.a.createElement("div",{className:"featureTier flexbox c-border"},r.a.createElement("div",{className:"setupFeature setupFeatureRow f1"},r.a.createElement("img",{src:"/img/plugin-gcal.png"}),r.a.createElement("div",null,"Google Calendar")),r.a.createElement("div",{className:"setupFeature setupFeatureRow f1"},r.a.createElement("img",{src:"/img/plugin-gmail.png"}),r.a.createElement("div",null,"Gmail")),r.a.createElement("div",{className:"setupFeature setupFeatureRow f1"},r.a.createElement("img",{src:"/img/plugin-gdrive.png"}),r.a.createElement("div",null,"Google Drive")),r.a.createElement("div",{className:"setupFeature setupFeatureRow f1"},r.a.createElement("i",{className:"icon-group"}),r.a.createElement("div",null,"Google Contacts"))),r.a.createElement("div",{className:"setupSubtext"},r.a.createElement("b",null,"Moo.do")," connects with your Google services to integrate everything together. ",r.a.createElement("b",null,"Moo.do")," data is stored in your personal Google Drive account and is never sent to any other server. Nobody can access any of your data. See our ",r.a.createElement("span",{className:"link"},"Privacy Policy")," for more details."),r.a.createElement("div",{className:"setupButtons flexbox"},r.a.createElement(f.a,{raised:!0,onClick:this.onClickChoose},"No thanks, I'll choose what to enable"),r.a.createElement(f.a,{enabled:this.state.isConnected,raised:!0,primary:!0,onClick:this.onClickEnable},e))))},renderPagePluginSelect:function(){var e=this.state.isConnected?"NEXT":"Connecting...";return r.a.createElement("div",{key:"content",className:"pageConnect"},r.a.createElement("div",{className:"setupTitle"},"Connect ",r.a.createElement("span",{className:"logoPseudo"})," with..."),r.a.createElement("div",{className:"setupFeatures featureCheckboxes"},r.a.createElement("div",{className:"featureTier c-border"},r.a.createElement("div",{className:"tierTitleWrapper"},r.a.createElement(h.a,{ref:"free",className:"tierTitle c-background",checked:!0,onChange:this.onChangeFree},"Free Features")),r.a.createElement("div",{className:"flexbox"},r.a.createElement("div",{className:"setupFeatureHalf"},r.a.createElement(h.a,{ref:PluginID.Contacts,checked:!0,onChange:this.onChangeFeature},r.a.createElement("i",{className:"icon-group"}),"Google Contacts"),r.a.createElement(h.a,{ref:PluginID.Gmail,checked:!0,onChange:this.onChangeFeature},r.a.createElement("img",{src:"/img/plugin-gmail.png"}),"Gmail")),r.a.createElement("div",{className:"setupFeatureHalf"},r.a.createElement("div",{className:"setupFeature"},r.a.createElement(h.a,{ref:"offlineFeatures",checked:!0,onChange:this.onChangeFeature},"Offline Features"),r.a.createElement("div",{className:"setupFeatureDesc c-foreground-light"},"Gmail features like Snooze require server access to your account so Moo.do can manage your inbox."))))),r.a.createElement("div",{className:"featureTier c-border"},r.a.createElement("div",{className:"tierTitleWrapper"},r.a.createElement(h.a,{ref:"premium",className:"tierTitle c-background",checked:!0,onChange:this.onChangePremium},"Premium Features")),!s.default.billingManager.hasPremiumFeatures()&&r.a.createElement("div",{className:"featureTierDesc c-foreground-light"},"Enabling Premium features will start a free "+o.a.TrialDuration+" day trial of Moo.do Premium."),r.a.createElement("div",{className:"flexbox"},r.a.createElement("div",{className:"setupFeature setupFeatureHalf"},r.a.createElement(h.a,{ref:PluginID.GCalendar,checked:!0,onChange:this.onChangeFeature},r.a.createElement("img",{src:"/img/plugin-gcal.png"}),"Google Calendar")),r.a.createElement("div",{className:"setupFeature setupFeatureHalf"},r.a.createElement(h.a,{ref:PluginID.Drive,checked:!0,onChange:this.onChangeDrive},r.a.createElement("img",{src:"/img/plugin-gdrive.png"}),"Google Drive"),r.a.createElement(h.a,{ref:"DriveShared",checked:!0,className:"subcheckbox",onChange:this.onChangeDriveShared},"Share files with collaborators")))),r.a.createElement("div",{className:"setupSubtext"},r.a.createElement("b",null,"Moo.do")," connects with your Google services to integrate everything together. ",r.a.createElement("b",null,"Moo.do")," data is stored in your personal Google Drive account and is never sent to any other server. Nobody can access any of your data. See our ",r.a.createElement("span",{className:"link"},"Privacy Policy")," for more details."),r.a.createElement("div",{className:"setupButtons"},r.a.createElement(f.a,{enabled:this.state.isConnected,raised:!0,primary:!0,onClick:this.onClickEnable},e))))},renderPageThemeSelect:function(){var e=this.state.colorTheme;return r.a.createElement("div",{key:"content"},r.a.createElement("div",{className:"setupTitle"},"What's your style?"),r.a.createElement("div",{className:"flexbox flex-center",style:{margin:"24px 0"}},r.a.createElement("div",{className:"setupStyle",onClick:this.setColorTheme.bind(this,o.a.ColorTheme.Light)},r.a.createElement(h.a,{radio:!0,ref:"checkLight",checked:e===o.a.ColorTheme.Light},"Light")),r.a.createElement("div",{className:"setupStyle",onClick:this.setColorTheme.bind(this,o.a.ColorTheme.Dark)},r.a.createElement(h.a,{radio:!0,ref:"checkDark",checked:e===o.a.ColorTheme.Dark},"Dark"))),r.a.createElement("div",{className:"setupSubtext center"},"Don't worry! You can always change your style later."),r.a.createElement("div",{className:"setupButtons"},r.a.createElement(f.a,{raised:!0,primary:!0,onClick:this.onClickDisplaySettings},"NEXT")))},renderPageImportData:function(){this.state;return r.a.createElement("div",{key:"content"},r.a.createElement("div",{className:"setupTitle"},"Import from another app"),r.a.createElement("div",{className:"welcomeImporters"},["Wunderlist","Workflowy","Trello","Google Tasks","Todoist","IQTell"].map(function(e,t){return r.a.createElement(f.a,{key:t,heavy:!0,onClick:this.onClickImport.bind(this,e)},e)}.bind(this))),r.a.createElement("div",{className:"setupSubtext center"},"Don't worry! You can always import your data later."),r.a.createElement("div",{className:"setupButtons"},r.a.createElement(f.a,{raised:!0,primary:!0,onClick:this.onClickGetStarted},"FINISH")))},render:function(){this.state.page;return r.a.createElement(m.a,{id:"modalWelcome",width:720,minWidth:600,modalID:Modals.Welcome,closeButton:!1,backdropClose:!1,ref:"modal"},this.renderPage(this.state.page))}});t.default=P},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),r=a.n(i),n=a(3),s=(a(25),a(1)),o=a(6),l=a(54),d=a(22),c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},u=n.a.createClass({displayName:"ReactModalDeleteAccount",componentDisplay:s.a.ComponentDisplay.Desktop,componentDidMount:function(){this.refs.textarea.focus()},onClickCancel:function(){this.refs.modal.close(!1)},onClickDelete:function(){this.refs.modal.close(!0)},render:function(){return r.a.createElement(d.a,c({},this.props,{id:"modalDeleteAccount",title:"Please Confirm",scrollable:!1,modalID:Modals.DeleteAccount,ref:"modal"}),r.a.createElement("div",{key:"content"},r.a.createElement("div",{className:"fancyModalText"},"It would be very helpful if you could describe how Moo.do could be more useful to you. Your feedback will help us improve Moo.do for you and others. Thanks!"),r.a.createElement(l.a,{ref:"textarea"})),r.a.createElement("div",{key:"buttons",style:{textAlign:"right"}},r.a.createElement(o.a,{width:100,onClick:this.onClickCancel},"CANCEL"),r.a.createElement(o.a,{primary:!0,width:100,onClick:this.onClickDelete},"DELETE")))}});t.default=u},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(2),n=a.n(r),s=a(3),o=(a(25),a(1)),l=a(13),d=a(6),c=a(65),u=a(22),h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},f=s.a.createClass({displayName:"ReactModalInvoices",componentDisplay:o.a.ComponentDisplay.Desktop,onTransactionClick:function(e){var t=i.default.clone(e);t.company=i.default.settings.get(Settings.invoiceCompany),t.address=i.default.settings.get(Settings.invoiceAddress);var a=window.btoa(JSON.stringify(t));i.default.openUrl(window.location.protocol+"//"+window.location.host+"/invoice#d="+a)},render:function(){return n.a.createElement(u.a,h({},this.props,{id:"modalInvoices",title:"Account Invoices",scrollable:!1,modalID:Modals.Invoices,ref:"modal"}),n.a.createElement("div",{key:"content"},this.props.transactions.length>0&&n.a.createElement(c.a,{className:"transactionsTable"},n.a.createElement("div",{key:"header"},n.a.createElement("div",null,"Transaction Date"),n.a.createElement("div",null,"Amount"),n.a.createElement("div",null)),this.props.transactions.map(function(e,t){var a=new Date(e.date).toString(l.a.getFormat(DFormat.LongStrDate));return n.a.createElement("div",{key:e.id},n.a.createElement("div",null,a),n.a.createElement("div",null,e.amount),n.a.createElement(d.a,{onClick:this.onTransactionClick.bind(this,e),height:"auto"},"View"))}.bind(this)),";"),0===this.props.transactions.length&&n.a.createElement("div",null,"There are not transactions available for this account.")))}});t.default=f},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),r=a.n(i),n=a(1),s=a(0),o=a(3),l=a(15),d=a(21),c=a(6),u=a(22),h=o.a.createClass({displayName:"ReactModalSharing",componentDisplay:n.a.ComponentDisplay.Everywhere,init:function(){var e=this.props.doc;this.helpID="NewFile",this.createObservables({isLoading:e.hasDriveBacking(),permissions:[],errorName:!1,errorInvite:!1}),this.isCreating=!e.hasDriveBacking(),this.isSaving=!1,this.permissionsRemove=[],s.default.settings.listen("settingChanged",Settings.DefaultGroup,Settings.closedHelps,this.updateState),e.hasDriveBacking()&&e.listPermissions(this.onListPermissions)},getState:function(){return{titleText:"Modal title",shouldShowHelp:s.default.vmMain.shouldShowHelp(this.helpID)}},onUnmount:function(){s.default.settings.unlisten("settingChanged",Settings.DefaultGroup,Settings.closedHelps,this.updateState)},onClosing:function(e){this.closeCallback&&(this.closeCallback(e),this.closeCallback=void 0)},onListPermissions:function(e){if(e){for(var t=[],a=0;a<e.length;++a){var i=e[a];i.emailAddress!==s.default.getUserIdentifier()&&(i.onRemove=this.onClickRemovePermission.bind(this,i),"anyone"!==i.id&&(i.emailAddress||("owner"===i.role?i.emailAddress="Owner":i.emailAddress=""),"owner"===i.role?t.splice(0,0,i):t.push(i)),i.emailDisplay="("+i.emailAddress+")")}this.permissions.set(t,!1),this.isLoading.set(!1)}},onClickRemovePermission:function(e){this.permissionsRemove.push(e),this.permissions.remove(e),s.default.sendEvent("Menu","SharingRemoveUser")},onClickGotIt:function(){s.default.vmMain.closeHelp(this.helpID)},onClickDelete:function(){s.default.sendEvent("Menu","SharingDelete");var e=this.props.doc;s.default.menus.confirm("Are you sure you want to delete the file?",function(t){s.default.vmMain.docManager.deleteDoc(e.id,function(e){log("File Delete Response: ",e),e||s.default.toasts.pushMessage({text:"Unable to delete file on the remote server."})}),s.default.menus.closeModalNew(Modals.ShareDoc,!1)})},onClickCancel:function(){s.default.menus.closeModalNew(Modals.ShareDoc,!1),s.default.sendEvent("Menu","SharingCancel")},create:function(e){var t=this.props.doc;this.justCreated=!0,this.isSaving=!0;var a=this.refs.name.getValue().trim();t.rename(a,function(e){try{s.default.PAssert(2578,e,"Rename during create must be successful")}catch(e){s.default.reportError(e)}}),l.a.createAndSetupDocument(t,!1,function(e){e&&!e.error?(this.isSaving=!1,this.isCreating=!1,this.onClickSave()):this.errorName.set("Error: Unable to create new file.")}.bind(this))},onClickSave:function(){if(!this.isSaving){s.default.sendEvent("Menu","SharingSave");this.state;var e=this.props.doc;if(this.isSaving&&!this.justCreated)return;if(!this.checkName())return;if(this.isCreating)return this.create(),!0;this.rename();for(var t=e.isShared(),a=0,i=function(i){i?--a<=0&&(s.default.menus.closeModalNew(Modals.ShareDoc,!1),e.isOwned()&&e.isOpen()&&s.default.vmMain.pluginManager.onDocumentShared(t)):(this.errorInvite.set("Some people could not be invited."),this.isSaving=!1)}.bind(this),r=this.refs.invite.getTokens(),n=0;n<r.length;n++){var o=r[n];a++,e.insertPermission(o.email,i.bind(this))}for(n=0;n<this.permissionsRemove.length;n++){var l=this.permissionsRemove[n];a++,e.deletePermission(l.id,i.bind(this))}if(this.errorInvite.get()||this.errorName.get())return;if(0!==a)return this.isSaving=!0,!0;s.default.menus.closeModalNew(Modals.ShareDoc,!0)}},checkName:function(){var e=this.refs.name.getValue().trim();return e.length>0&&e.length<255?(this.errorName.set(!1),!0):(this.errorName.set("Error: File name must be >0 and <255 characters."),!1)},rename:function(){var e=this.refs.name.getValue().trim(),t=this.props.doc;e!==t.getTitle()&&t.rename(e,function(e){e||this.errorName("Error: Unable to update name on remote server.")}.bind(this))},render:function(){var e=this.props,t=this.state,a=e.doc,i="https://moo.do/app/#file="+e.doc.id+"&sinfo="+e.doc.generateShareInfo();return r.a.createElement(u.a,{id:"shareDoc",modalID:Modals.ShareDoc,ref:"modal",title:t.titleText,width:550,height:600},r.a.createElement("div",{key:"content"},this.isCreating&&t.shouldShowHelp&&r.a.createElement("div",{className:"inlineHelp c-bg-faded c-border-heavy"},r.a.createElement("div",null,r.a.createElement("div",{className:"inlineHelpTitle"},"HELP"),r.a.createElement("div",null,"A File contains all of your projects and tasks. Each File can be shared with a different set of people to collaborate with your friends or your team. If you are not collaborating with anyone, you likely don't want to use this feature.")),r.a.createElement("div",{className:"inlineHelpGotIt flexbox flexvert"},r.a.createElement(c.a,{primary:!0,onClick:this.onClickGotIt},"GOT IT"))),r.a.createElement("div",{className:"detailsSection flexbox itemContext c-foreground-faded"},r.a.createElement("div",{className:"c-foreground-faded"},"Name"),r.a.createElement(d.a,{value:e.doc.getTitle(),ref:"name",focused:this.isCreating})),t.errorName&&r.a.createElement("span",{className:"error"},t.errorName),!this.isCreating&&r.a.createElement("div",{className:"detailsSection flexbox itemContext c-foreground-faded"},r.a.createElement("div",{className:"c-foreground-faded"},"Share Link"),r.a.createElement(d.a,{value:i})),!this.isCreating&&(t.isLoading||t.permissions.length>0)&&r.a.createElement("div",{className:"modal-group"},r.a.createElement("div",{className:"mat-subheader"},r.a.createElement("i",{className:"icon-user"})," Who has access"),r.a.createElement("ul",{className:s.default.classNames("shareAccess c-border",{loading:t.isLoading})},t.permissions.map(function(e){return r.a.createElement("li",{key:e.emailAddress,className:"sharePerson flexbox"},r.a.createElement("span",{className:"shareDetails f1"},"owner"===e.role&&r.a.createElement("i",{className:"icon-star",tooltip:"Owner"}),r.a.createElement("span",null,e.name),r.a.createElement("span",{className:"c-foreground-faded",style:{marginLeft:16}},e.emailAddress)),a.isOwned()&&r.a.createElement(c.a,{icon:"icon-close",onClick:e.onRemove}))}))),a.isOwned()&&r.a.createElement("div",{className:"modal-group"},r.a.createElement("div",{className:"mat-subheader"},"Invite to share"),t.errorInvite&&r.a.createElement("div",{className:"error"},t.errorInvite),r.a.createElement(d.a,{id:"inputShareInvite",placeholder:"Email address",autocompleteMode:"email",ref:"invite"})),!a.isOwned()&&r.a.createElement("div",{className:"modal-group"},r.a.createElement("div",{className:"shareNotOwned gd"},"Only the creator of this file can share it with others. Please contact the creator to share it with others.")),r.a.createElement("div",{className:"scrollPad"})),r.a.createElement("div",{key:"buttons"},a.isOwned()&&r.a.createElement("div",{className:"flexbox",style:{padding:"0 16px"}},!this.isCreating&&r.a.createElement(c.a,{raised:!0,cancel:!0,id:"shareDelete",onClick:this.onClickDelete},"DELETE"),r.a.createElement("div",{className:"f1"}),r.a.createElement(c.a,{id:"shareCancel",raised:!0,onClick:this.onClickCancel},"CANCEL"),r.a.createElement(c.a,{id:"shareSave",raised:!0,primary:!0,marginLeft:16,onClick:this.onClickSave},"SAVE")),!a.isOwned()&&r.a.createElement(c.a,{id:"shareOkay",raised:!0,onClick:this.onClickCancel},"OKAY")))}});t.default=h},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),r=a.n(i),n=a(1),s=a(0),o=a(3),l=(a(36),a(6)),d=a(33),c=a(54),u=a(22),h=o.a.createClass({displayName:"ReactModalFeedback",componentDisplay:n.a.ComponentDisplay.Everywhere,onClickUV:function(e){s.default.openUrl("https://feedback.moo.do/",e),s.default.sendEvent("Menu","FeedbackUserVoice")},onClickTwitter:function(e){s.default.openUrl("https://www.twitter.com/MooDoApp",e),s.default.sendEvent("Menu","FeedbackTwitter")},onClickFacebook:function(e){s.default.openUrl("https://www.facebook.com/MooDoApp",e),s.default.sendEvent("Menu","FeedbackFacebook")},onClickGooglePlus:function(e){s.default.openUrl("https://www.google.com/+MooDoApp",e),s.default.sendEvent("Menu","FeedbackGoogle")},onClickCancel:function(e){s.default.menus.closeModalNew(Modals.ReportBug)},onClickSend:function(e){var t=this.refs.description.getValue();if(t&&t.length>2){var a="Moo.do Feedback";if(this.refs.share.getValue()){var i=s.default.vmMain.docManager.getOpenDoc();if(i){a+=" [DocShared]",t+="\r\n\r\nShared Document - "+i.id;s.default.vmMain.remoteAPI().drivePermissionsInsert(i.id,"debug@moo.do",!1,s.default.emptyFn,function(){s.default.reportError(new Error("Unable to share doc with debug account"))})}}s.default.sendFeedback(a,t),s.default.menus.closeModalNew(Modals.ReportBug),s.default.toasts.pushMessage({text:"Thanks for taking the time to send us feedback!"}),s.default.sendEvent("Menu","SendFeedback")}},render:function(){return r.a.createElement(u.a,{id:"reportBug",modalID:Modals.ReportBug,ref:"modal",title:"Contact Support",width:650,height:650},r.a.createElement("div",{key:"content"},r.a.createElement("div",{className:"c-foreground-light"},"If you're requesting a feature, it's often easier to vote it up (or add it) on our UserVoice page."),r.a.createElement("div",{className:"center"},r.a.createElement(l.a,{className:"mc",primary:!0,onClick:this.onClickUV},"Open UserVoice")),r.a.createElement("br",null),r.a.createElement("div",{className:"c-foreground-light"},"Or talk to us on your favorite social network."),r.a.createElement("div",{className:"flexbox flex-center"},r.a.createElement(l.a,{width:50,height:50,icon:"icon-twitter",tooltip:"@MooDoApp",onClick:this.onClickTwitter}),r.a.createElement(l.a,{width:50,height:50,marginLeft:16,icon:"icon-facebook",tooltip:"MooDoApp",onClick:this.onClickFacebook}),r.a.createElement(l.a,{width:50,height:50,marginLeft:16,icon:"icon-google-plus",tooltip:"+MooDoApp",onClick:this.onClickGooglePlus})),r.a.createElement("div",{className:"mat-subheader c-foreground-light"},"Or send us a message directly."),r.a.createElement(c.a,{focused:!0,id:"bugDescription",height:200,ref:"description",margin:0}),r.a.createElement("div",{className:"mt8 c-foreground-light"},"Some error reports may be helped by sharing your file with us. We can diagnose issues in your particular file. Please only share your file with us if we have asked."),r.a.createElement("br",null),r.a.createElement(d.a,{ref:"share"},"Share file with developers")),r.a.createElement("div",{key:"buttons"},r.a.createElement(l.a,{raised:!0,onClick:this.onClickCancel},"CANCEL"),r.a.createElement(l.a,{raised:!0,primary:!0,marginLeft:16,onClick:this.onClickSend},"SEND")))}});t.default=h},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(6),d=a(21),c=a(22),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},h=o.a.createClass({displayName:"ReactModalEnterCode",componentDisplay:r.a.ComponentDisplay.Desktop,componentDidMount:function(){this.refs.code.focus()},onClickConfirm:function(){i.default.billingManager.redeemCode(this.refs.code.getValue()),this.refs.modal.close()},onClickCancel:function(){this.refs.modal.close()},render:function(){return s.a.createElement(c.a,u({},this.props,{id:"modalEnterCode",title:"Redeem Code",width:325,scrollable:!1,modalID:Modals.EnterCode,ref:"modal"}),s.a.createElement("div",{key:"content"},s.a.createElement("div",{className:"fancyModalText"},"Enter your code below to redeem"),s.a.createElement(d.a,{ref:"code"})),s.a.createElement("div",{key:"buttons",style:{textAlign:"right"}},s.a.createElement(l.a,{width:100,onClick:this.onClickCancel},"CANCEL"),s.a.createElement(l.a,{primary:!0,width:100,onClick:this.onClickConfirm},"CONFIRM")))}});t.default=h},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(41),l=(a.n(o),a(3)),d=a(24),c=a(55),u=a(6),h=a(250),f=a(33),p=a(32),m=l.a.createClass({displayName:"ReactDisplaySettingsSidebar",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({showAdvanced:!1})},componentDidMount:function(){},getState:function(){return{isOpen:i.default.vmMain.isDisplaySettingsOpen,colorTheme:i.default.settings.get(Settings.theme),layoutTheme:i.default.settings.get(Settings.layoutTheme,Settings.UISettingsGroup)}},updateSetting:function(e,t){i.default.settings.set(e,t,Settings.UISettingsGroup)},onClickColorTheme:function(e){d.a.changeColorTheme(e),this.updateState()},onClickTheme:function(e){d.a.changeTheme(e),this.updateState(),this.forceUpdate()},isGrayscale:function(){return!0===i.default.settings.get(Settings.grayscale,Settings.UISettingsGroup)},toggleAdvanced:function(){this.showAdvanced.set(!this.showAdvanced.get())},updateGrayscale:function(e){this.updateSetting(Settings.grayscale,e),this.forceUpdate()},close:function(){i.default.vmMain.isDisplaySettingsOpen.set(!1)},render:function(){var e,t=this.state;if(t.showAdvanced){var a=i.default.classNames("settingsAdvanced",{disabledSettings:!i.default.billingManager.hasPremiumFeatures()}),n=this.isGrayscale(),l=i.default.classNames({disabled:n});e=s.a.createElement("div",null,s.a.createElement("div",{style:{color:"#aaa",margin:"16px 0"}},"Advanced (Premium Only)"),s.a.createElement("div",{className:a},s.a.createElement("div",null,s.a.createElement(f.a,{checked:i.default.settings.get(Settings.showVerticalLines,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.showVerticalLines)},"Show Vertical Lines")),s.a.createElement("div",null,s.a.createElement("span",null,"Item Font Size: "),s.a.createElement(c.a,{value:i.default.settings.get(Settings.fontSize,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.fontSize)})),s.a.createElement("div",null,s.a.createElement("span",null,"Project Font Size: "),s.a.createElement(c.a,{value:i.default.settings.get(Settings.fontSizeHeader,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.fontSizeHeader)})),s.a.createElement("div",null,s.a.createElement("span",null,"Top Level Project Font Size: "),s.a.createElement(c.a,{value:i.default.settings.get(Settings.fontSizeHeaderTopLevel,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.fontSizeHeaderTopLevel)})),s.a.createElement("div",null,s.a.createElement("span",null,"Note Font Size: "),s.a.createElement(c.a,{value:i.default.settings.get(Settings.noteFontSize,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.noteFontSize)})),s.a.createElement("div",null,s.a.createElement("span",null,"Item Line Height: "),s.a.createElement(c.a,{value:i.default.settings.get(Settings.itemLineHeight,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.itemLineHeight)})),s.a.createElement("div",null,s.a.createElement("span",null,"Item Padding: "),s.a.createElement(c.a,{value:i.default.settings.get(Settings.itemPadding,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.itemPadding)})),s.a.createElement("div",null,s.a.createElement("span",null,"Indent Size: "),s.a.createElement(c.a,{value:i.default.settings.get(Settings.itemIndentSize,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.itemIndentSize)})),s.a.createElement("div",null,s.a.createElement("span",null,"Checkbox Opacity: "),s.a.createElement(c.a,{value:i.default.settings.get(Settings.checkboxOpacity,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.checkboxOpacity),minValue:0,maxValue:100})),s.a.createElement("div",null,s.a.createElement("span",null,"Checkbox Background: "),s.a.createElement(c.a,{value:i.default.settings.get(Settings.checkboxBackgroundOpacity,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.checkboxBackgroundOpacity),minValue:0,maxValue:100})),s.a.createElement("div",null,s.a.createElement("span",null,"Vertical Lines Opacity: "),s.a.createElement(c.a,{value:i.default.settings.get(Settings.verticalLinesOpacity,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.verticalLinesOpacity),minValue:0,maxValue:100})),n&&s.a.createElement("div",{className:"colorsDisabled"},"Colors disabled in Grayscale mode"),s.a.createElement("div",{className:l},s.a.createElement("span",null,"Tag Color: "),s.a.createElement(h.a,{color:i.default.settings.get(Settings.tagColor,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.tagColor)})),s.a.createElement("div",{className:l},s.a.createElement("span",null,"Date Color: "),s.a.createElement(h.a,{color:i.default.settings.get(Settings.dateColor,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.dateColor)})),s.a.createElement("div",{className:l},s.a.createElement("span",null,"Contact Color: "),s.a.createElement(h.a,{color:i.default.settings.get(Settings.contactColor,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.contactColor)})),s.a.createElement("div",{className:l},s.a.createElement("span",null,"Link Color: "),s.a.createElement(h.a,{color:i.default.settings.get(Settings.linkColor,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.linkColor)})),s.a.createElement("div",null,s.a.createElement(f.a,{checked:i.default.settings.get(Settings.underlineP,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.underlineP)},"Underline tags, dates, contacts"))))}var d=t.isOpen&&s.a.createElement("div",{className:"sidebar displaySettings"},s.a.createElement("div",{className:"popup c-shadow-popup c-background"},s.a.createElement("div",{className:"overlayTitleBar c-bg-popup-title flexbox"},s.a.createElement("div",{className:"displayTitle f1"},"Display Settings"),s.a.createElement(u.a,{icon:"icon-close",width:36,height:36,onClick:this.close})),s.a.createElement(p.a,null,s.a.createElement("div",null,s.a.createElement("div",{style:{color:"#aaa",fontStyle:"bold"}},"Color Theme"),s.a.createElement("div",{className:"themeButtons"},s.a.createElement(u.a,{raised:!0,primary:t.colorTheme===r.a.ColorTheme.Light,onClick:this.onClickColorTheme.bind(this,r.a.ColorTheme.Light)},"Light"),s.a.createElement(u.a,{raised:!0,primary:t.colorTheme===r.a.ColorTheme.Dark,marginLeft:16,onClick:this.onClickColorTheme.bind(this,r.a.ColorTheme.Dark)},"Dark")),s.a.createElement("div",{style:{color:"#aaa",fontStyle:"bold"}},"Layout Theme"),s.a.createElement("div",{className:"themeButtons"},s.a.createElement("div",{className:"themeRow"},s.a.createElement(u.a,{raised:!0,padding:8,primary:t.layoutTheme===r.a.DisplayTheme.Markdown,onClick:this.onClickTheme.bind(this,r.a.DisplayTheme.Markdown)},"Markdown"),s.a.createElement(u.a,{raised:!0,padding:8,primary:t.layoutTheme===r.a.DisplayTheme.Simple,marginLeft:8,onClick:this.onClickTheme.bind(this,r.a.DisplayTheme.Simple)},"Simple")),s.a.createElement("div",{className:"themeRow"},s.a.createElement(u.a,{raised:!0,padding:8,primary:t.layoutTheme===r.a.DisplayTheme.OutlineLight,onClick:this.onClickTheme.bind(this,r.a.DisplayTheme.OutlineLight)},"Outline Light"),s.a.createElement(u.a,{raised:!0,padding:8,primary:t.layoutTheme===r.a.DisplayTheme.OutlineHeavy,marginLeft:8,onClick:this.onClickTheme.bind(this,r.a.DisplayTheme.OutlineHeavy)},"Outline Heavy"))),s.a.createElement("div",{style:{color:"#aaa",fontStyle:"bold"}},"Options"),s.a.createElement("div",{style:{marginTop:16}},s.a.createElement(f.a,{checked:n,onChange:this.updateGrayscale},"Grayscale")),s.a.createElement("div",{style:{marginTop:16}},s.a.createElement(f.a,{checked:i.default.settings.get(Settings.boldHeaders,Settings.UISettingsGroup),onChange:this.updateSetting.bind(this,Settings.boldHeaders)},"Automatically Bold Parents"))),e,s.a.createElement("div",{style:{marginTop:16,textAlign:"center"}},s.a.createElement(u.a,{raised:!0,onClick:this.toggleAdvanced},(t.showAdvanced?"Hide":"Show")+" Advanced (Premium)")))));return s.a.createElement(o.CSSTransitionGroup,{transitionName:"previewOpen",component:"div",transitionEnterTimeout:200,transitionLeaveTimeout:200},d)}});t.a=m},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(251),d=o.a.createClass({displayName:"FancyColorPicker",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({color:this.props.color})},componentWillReceiveProps:function(e){e.color!==this.props.color&&this.color.set(e.color)},openMenu:function(e){i.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})},onChange:function(e){this.color.set(e),this.props.onChange(e)},renderContextMenu:function(e){return s.a.createElement(l.a,{key:"fancyColorPicker",color:this.state.color,onChange:this.onChange,element:e.element})},render:function(){var e={background:this.state.color,border:"1px solid #666"},t=i.default.classNames("fancyColor",{isWhite:"#FFFFFF"===this.state.color.toUpperCase()});return s.a.createElement("div",{className:t,style:e,onClick:this.openMenu})}});t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(12),d=["#4D4D4D","#999999","#CCCCCC","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#BBBBBB","#EEEEEE","#D33115","#E27300","#FCC400","#22AA66","#16A5A5","#0099DD","#7B64FF","#FA28FF","#000000","#666666","#AAAAAA","#DDDDDD","#AA3300","#C45100","#FB9E00","#194D33","#0C797D","#0062B1","#653294","#AB149E"],c={hex3:/^(#)([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^(#)([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},u=o.a.createClass({displayName:"FancyColorPickerContextMenu",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({color:this.props.color,value:this.props.color,isValid:!0})},parseColor:function(e){var t;return(t=c.hex3.exec(e))?"#"+t[2]+t[2]+t[3]+t[3]+t[4]+t[4]:(t=c.hex6.exec(e))?e:void 0},onClickColor:function(e){this.color.set(e),this.value.set(e),this.props.onChange(e)},onChangeInputColor:function(e){var t=e.target.value.toUpperCase();0!==t.indexOf("#")&&(t="#"+t);var a=this.parseColor(t);a&&(this.color.set(a),this.props.onChange(a)),t.length<8&&this.value.set(t),this.isValid.set(!!this.parseColor(this.value.get()))},onChangeInputComponent:function(){var e=this.refs,t=e.r.value,a=e.g.value,r=e.b.value;if(t>=0&&t<=255&&a>=0&&a<=255&&r>=0&&r<=255){var n="#"+i.default.rgbToHex(t,a,r);this.value.set(n),this.color.set(n),this.props.onChange(n)}},render:function(){for(var e=this.state,t=this.state.color,a=i.default.hexToRgb(t),r=[],n=0;n<d.length;n++){var o=d[n],c=i.default.classNames("fancyColor",{selected:o===t},{isWhite:"#FFFFFF"===o.toUpperCase()}),u={background:o};r.push(s.a.createElement("div",{key:o,className:c,style:u,onClick:this.onClickColor.bind(this,o)}))}var h=i.default.classNames("fancyColorInputColor",{invalid:!e.isValid});return s.a.createElement(l.a,{id:"fancyColorPicker",element:this.props.element,offset:{left:-120,top:4}},s.a.createElement("div",{className:"fancyColors"},r),s.a.createElement("div",{className:"fancyColorText"},s.a.createElement("div",{key:t,className:"fancyColor",style:{background:t}}),s.a.createElement("input",{type:"text",className:h,value:e.value,onChange:this.onChangeInputColor}),s.a.createElement("span",null,"R"),s.a.createElement("input",{type:"text",ref:"r",className:"fancyColorInputComponent",value:a.r,onChange:this.onChangeInputComponent}),s.a.createElement("span",null,"G"),s.a.createElement("input",{type:"text",ref:"g",className:"fancyColorInputComponent",value:a.g,onChange:this.onChangeInputComponent}),s.a.createElement("span",null,"B"),s.a.createElement("input",{type:"text",ref:"b",className:"fancyColorInputComponent",value:a.b,onChange:this.onChangeInputComponent})))}});t.a=u},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(41),l=(a.n(o),a(3)),d=a(253),c=a(6),u=a(32),h=l.a.createClass({displayName:"ReactHelpSidebar",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.intro=i.default.intro},componentDidMount:function(){},getState:function(){return{isOpen:this.intro.isVisible,sections:this.intro.sections,mode:this.intro.mode}},close:function(){this.intro.close()},onTapFeatures:function(){this.intro.setMode(r.a.HelpMode.Normal),this.refs.scroller.scrollTo(0,0,0)},onTapHotkeys:function(){this.intro.setMode(r.a.HelpMode.Hotkeys),this.refs.scroller.scrollTo(0,0,0)},renderSection:function(e){return s.a.createElement("div",{className:"helpSection c-border-heavy",key:e.id||e.text},s.a.createElement("div",{className:"helpTitle"},e.text),e.note&&s.a.createElement("div",{className:"helpNote c-foreground-faded"},e.note),s.a.createElement("ul",null,e.items.map(function(e,t){return s.a.createElement(d.a,{item:e,key:t})})))},render:function(){var e=this.state;if(e.isOpen){for(var t=[],a=0;a<e.sections.length;a++)e.sections[a].noRender||t.push(this.renderSection(e.sections[a]));var n=i.default.classNames("tab tabFeatures c-border-heavy f1",{selected:e.mode===r.a.HelpMode.Normal}),l=i.default.classNames("tab tabHotkeys c-border-heavy f1",{selected:e.mode===r.a.HelpMode.Hotkeys}),d=i.default.classNames("sidebar sidebarHelp intro",{helpHotkeys:e.mode===r.a.HelpMode.Hotkeys},{helpNormal:e.mode===r.a.HelpMode.Normal}),h=e.isOpen&&s.a.createElement("div",{className:d},s.a.createElement("div",{className:"popup c-shadow-popup c-background"},s.a.createElement("div",{className:"overlayTitleBar c-bg-popup-title flexbox"},s.a.createElement("div",{className:"displayTitle f1"},"Help"),s.a.createElement(c.a,{icon:"icon-close",width:36,height:36,onClick:this.close})),s.a.createElement("div",{className:"helpHeaderRow flexbox"},s.a.createElement(c.a,{height:36,className:n,onClick:this.onTapFeatures},"Features"),s.a.createElement(c.a,{height:36,className:l,onClick:this.onTapHotkeys},"Hotkeys")),s.a.createElement(u.a,{ref:"scroller"},t)))}return s.a.createElement(o.CSSTransitionGroup,{transitionName:"previewOpen",component:"div",transitionEnterTimeout:200,transitionLeaveTimeout:200},h)}});t.a=h},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3).a.createClass({displayName:"ReactIntroItem",componentDisplay:r.a.ComponentDisplay.Desktop,getState:function(){var e=this.props.item;return{isComplete:e.isComplete,isDisabled:e.isDisabled,isHotkeyOr:e.isHotkeyOr,text:e.text,jsx:e.jsx,isVisible:e.visibleObservable,isHidden:e.hiddenObservable}},render:function(){var e=this.state,t=i.default.classNames({checked:e.isComplete},{disabled:e.isDisabled},{hotkeyOr:e.isHotkeyOr}),a=i.default.classNames("icon-check",{"c-foreground-super-faded":!e.isComplete},{"c-blue":e.isComplete});return!1!==e.isVisible&&!0!==e.isHidden&&s.a.createElement("li",{className:t},s.a.createElement("span",{className:a}),e.text&&s.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.text}}),e.jsx)}});t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(7),o=a(2),l=a.n(o),d=a(3),c=a(14),u=a(31),h=a(10),f=a(255),p=a(257),m=a(6),g=d.a.createClass({displayName:"ReactDesktopMenu",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({isEditingBoard:!1}),this.listenToDispatcher(i.default.settings,"settingChanged",Settings.DefaultGroup,Settings.gdocTitle),this.listenToDispatcher(i.default.vmMain.pluginManager,"pluginActiveChanged"),this.listenTo(c.a.onAccountsUpdated)},getState:function(){var e,t=this.props.main,a=t.gdriveStatus(),n={gdriveStatus:t.gdriveStatusObs,isEmailEnabled:i.default.vmMain.pluginManager.isEnabled(PluginID.Gmail),documentName:i.default.settings.get(Settings.gdocTitle)||i.default.isDemoMode()&&"Demo Doc",isOnline:a!==DriveStatus.Offline,isConnected:a===DriveStatus.Saving||a===DriveStatus.Saved,onlineText:t.onlineText(),showSidebar:u.a.showSidebar,isDraggingSidebar:u.a.isDraggingSidebar,_sidebarWidth:u.a.sidebarWidth,sidebarWidth:u.a.getSidebarWidth(),isSmall:u.a.getSidebarWidth()<r.a.DesktopMenuWidthMinBig};i.default.isDemoMode()||(e=a===DriveStatus.Offline?"icon-cloud_off":i.default.hasOnlineBlockingError()||c.a.isMissingAccountToken()||s.a.overQuota?"icon-warning":a===DriveStatus.Saving||a===DriveStatus.Saved?"icon-cloud_done":"icon-cloud_queue",n.statusIcon=e);return n},onMouseDownAddPane:function(e){i.default.menus.openAddPaneMenu({element:e.target})},onMouseDownOptions:function(e){i.default.menus.openContextMenu({componentName:"ReactContextMenuOptions",element:e.target})},onClickNewEmail:function(){i.default.menus.openComposeEmail(i.default.vmMain.getDefaultEmailPlugin())},onClickStatusText:function(e){i.default.isDemoMode()?i.default.menus.confirm("Go to the Moo.do homepage?",function(e){if(e)if(window.parent)try{window.parent.location="https://www.moo.do"}catch(e){window.location="/"}else window.location="/"}):i.default.menus.openContextMenu({componentName:"ReactContextMenuOnlineStatus",element:e.target})},onClickToggle:function(){u.a.toggleSidebar(),i.default.tooltip.hideTip()},onClickMinimize:function(){u.a.minimize(),i.default.tooltip.hideTip()},onClickRestore:function(){u.a.restore(),i.default.tooltip.hideTip()},onMouseDownGrabber:function(e){this.onMouseDownExpand(e),this._isClickOnGrabber=!0},onMouseDownExpand:function(e){this._isClickOnGrabber=!1,this.expandingFrom=e.clientX,this.startPosition=this.state.sidebarWidth,document.addEventListener("mousemove",this.onMouseMoveExpand),document.addEventListener("mouseup",this.onMouseUpExpand),i.default.preventDefault(e)},onMouseMoveExpand:function(e){if(this.expandingFrom){this._isClickOnGrabber=!1;var t=i.default.clamp(this.startPosition+e.clientX-this.expandingFrom,0,r.a.DesktopMenuWidthMax);u.a.setSidebarWidthMoving(t)}},onMouseUpExpand:function(){this.expandingFrom=void 0,this.startPosition=void 0,i.default.vmMain.cursor.set(void 0),this._isClickOnGrabber?this.onClickToggle():u.a.setSidebarWidthUp(),document.removeEventListener("mousemove",this.onMouseMoveExpand),document.removeEventListener("mouseup",this.onMouseUpExpand)},onClickAddItem:function(e){i.default.menus.openItemEditor({addOnSave:!0,element:e.target})},onClickHelp:function(e){i.default.menus.openContextMenu({componentName:"ReactContextMenuHelp",element:e.target})},onClickShare:function(e){i.default.menus.openContextMenu({componentName:"ReactContextMenuShare",element:e.target})},onClickFile:function(e){h.a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocumentsMenu}),i.default.menus.openContextMenu({componentName:"ReactContextMenuDocuments",element:e.target})},render:function(){var e,t,a=this.state,s=i.default.classNames("desktopMenuText desktopOnline",{offline:!a.isOnline},{connected:a.isConnected}),o=i.default.billingManager,d=o.isTrialState()&&!i.default.settings.get(Settings.trialOverHidden),c=o.isTrialOver(),h=a.isSmall,g=(n.a.mac?n.a.priModKey+" + Option":"Alt + Shift")+" + S",v=n.a.isNativeMac(),y=v?36:32,S=u.a.shouldShowTopBar();if(a.showSidebar){var E={width:a.sidebarWidth+r.a.SidebarDragHandleSize/4},P={marginRight:r.a.SidebarDragHandleSize/4},b={marginRight:3*r.a.SidebarDragHandleSize/4},C=i.default.classNames("desktopSidebar",{transition:u.a.sidebarTransitioning},{noClick:a.isDraggingSidebar},{small:h},{big:!h}),D=(n.a.mac?"Ctrl":"Alt")+" + B",I=h?0:8,A=i.default.clamp((u.a.getSidebarWidth()-r.a.DesktopMenuWidthMinBig)/(r.a.DesktopMenuWidthDefault-r.a.DesktopMenuWidthMinBig),0,1),M=h?9:Math.round(i.default.lerp(10,12,A));e=n.a.isMailbirdSidebar()?l.a.createElement("div",{id:"desktopMenuMailbird"},l.a.createElement(m.a,{id:"desktopDocumentsButton",ref:"documentsButton",tooltip:"Files",icon:"icon-folder",iconSize:18,onClick:this.onClickFile},a.documentName),l.a.createElement(m.a,{id:"optionsButton",ref:"options",tooltip:"More",icon:"icon-settings",iconSize:20,onMouseDown:this.onMouseDownOptions})):l.a.createElement("div",{id:"desktopMenu",className:C,style:E},l.a.createElement("div",{className:"desktopMenuInside ns flexbox flexvert c-bg-sidebar",style:P},l.a.createElement("div",{className:"desktopDrag sidebarPaddingTop",style:b}),l.a.createElement("div",{className:"sidebarToggle noShrink flexbox"},l.a.createElement("div",{className:"desktopDrag flex-spacer"}),h&&l.a.createElement(m.a,{icon:"icon-angle-right",iconSize:16,width:32,height:32,onClick:this.onClickRestore,tooltip:"Toggle Sidebar",tooltipHotkey:g}),!h&&l.a.createElement(m.a,{icon:"icon-minus",iconSize:8,width:32,height:32,onClick:this.onClickMinimize,tooltip:"Shrink to tiny sidebar"}),!h&&l.a.createElement(m.a,{icon:"icon-sidebar",iconSize:14,width:32,height:32,onClick:this.onClickToggle,tooltip:"Toggle Sidebar",tooltipHotkey:g})),!h&&l.a.createElement("div",{className:"sidebarHeader","data-tooltip":"Use Boards to save your pane layouts and customize your workflow.","data-tooltiphotkey":D},"BOARDS"),l.a.createElement("div",{className:"sidebarSection sectionBoards"},l.a.createElement(p.a,{buttonSize:26,fontSize:M,height:26,padding:I,isSmall:h})),l.a.createElement("div",{style:{height:16}}),!h&&l.a.createElement("div",{className:"sidebarHeader"},"ACTIONS"),l.a.createElement("div",{className:"sidebarSection noShrink"},l.a.createElement(m.a,{id:"addPaneButton",ref:"addPane",tooltip:"Add Pane",tooltipHotkey:n.a.secModKey+" + T",icon:"icon-crop_portrait",iconSize:15,fontSize:M,height:26,onMouseDown:this.onMouseDownAddPane,padding:I},!h&&"Add Pane"),l.a.createElement(m.a,{id:"newItemButton",icon:"icon-edit",iconSize:13,fontSize:M,height:26,tooltip:"New Item",tooltipHotkey:n.a.secModKey+" + N",onClick:this.onClickAddItem,padding:I},!h&&"New Item"),a.isEmailEnabled&&l.a.createElement(m.a,{id:"newEmailButton",iconSize:13,fontSize:M,height:26,ref:"newEmail",icon:"icon-mail_outline",tooltip:"Compose Email",tooltipHotkey:n.a.priModKey+" + E",onMouseDown:this.onClickNewEmail,padding:I},!h&&"New Email")),l.a.createElement("div",{className:"desktopDrag flex-spacer",style:b}),!S&&l.a.createElement("div",{className:"sidebarSection desktopMenuBottom noShrink"},!h&&l.a.createElement("div",{className:"sidebarHeader"},"MORE"),l.a.createElement(m.a,{id:"desktopDocumentsButton",fontSize:M,height:26,ref:"documentsButton",tooltip:h?a.documentName:"Switch to a different file",onClick:this.onClickFile},h?a.documentName.substr(0,Math.min(a.documentName.length,5)):a.documentName,l.a.createElement("i",{className:"icon-unfold_more"})),l.a.createElement(m.a,{icon:a.statusIcon,tooltip:"Check sync status",onClick:this.onClickStatusText,className:s,iconSize:15,fontSize:M,height:26,padding:I},!h&&a.onlineText),d&&!c&&l.a.createElement(m.a,{tooltip:a.daysLeftInTrial+" days left in trial",onClick:this.onClickTrial,fontSize:M,height:26,padding:I},"TRIAL"),d&&c&&l.a.createElement(m.a,{tooltip:"Learn more about Premium",onClick:this.onClickTrial,fontSize:M,height:26,padding:I},"TRIAL OVER"),l.a.createElement(m.a,{tooltip:"Share Moo.do with your friends or team",icon:"icon-heart",ref:"share",iconSize:12,fontSize:M,height:26,onClick:this.onClickShare},!h&&"Share"),l.a.createElement(m.a,{id:"helpButton",ref:"help",tooltip:"Show the Help",icon:"icon-question",iconSize:16,fontSize:M,height:26,onClick:this.onClickHelp},!h&&"Help"),l.a.createElement(m.a,{id:"optionsButton",ref:"options",tooltip:"Show more options",icon:"icon-settings",iconSize:14,fontSize:M,height:26,onMouseDown:this.onMouseDownOptions},!h&&"Options"),l.a.createElement("div",{style:{height:8}}))),l.a.createElement("div",{className:"sidebarDragHandle",onMouseDown:this.onMouseDownExpand,onDoubleClick:this.onClickToggle,style:{width:r.a.SidebarDragHandleSize}}))}if(S){var _=a.showSidebar&&!h,T=i.default.classNames("desktopToolbar flexbox c-bg-toolbar c-border"),w={left:!v&&a.sidebarWidth},k=i.default.classNames("desktopDrag noShrink",{"c-bg-sidebar":_}),x={width:Math.max(a.sidebarWidth,r.a.DesktopMenuWidthMinBig),height:_&&y+1};t=l.a.createElement("div",{className:T,style:w},v&&l.a.createElement("div",{className:k,style:x}),l.a.createElement(m.a,{icon:"icon-sidebar",className:"noShrink",iconSize:14,width:y,height:y,tooltip:"Toggle sidebar",onClick:this.onClickToggle}),!a.showSidebar&&l.a.createElement(f.a,{buttonSize:y,height:y}),l.a.createElement("div",{className:"f1 desktopDrag"}),l.a.createElement("div",{className:"noShrink"},l.a.createElement(m.a,{icon:a.statusIcon,iconSize:13,width:y,height:y,onClick:this.onClickStatusText,className:s,tooltip:"Check sync status"}),l.a.createElement(m.a,{id:"addPaneButton",icon:"icon-add-pane",iconSize:15,width:y,height:y,onMouseDown:this.onMouseDownAddPane,tooltip:"Add Pane",tooltipHotkey:n.a.secModKey+" + T"}),l.a.createElement(m.a,{id:"newItemButton",icon:"icon-edit",iconSize:14,width:y,height:y,onClick:this.onClickAddItem,tooltip:"New Item",tooltipHotkey:n.a.secModKey+" + N"}),a.isEmailEnabled&&l.a.createElement(m.a,{icon:"icon-mail_outline",iconSize:15,width:y,height:y,onClick:this.onClickNewEmail,tooltip:"New Email",tooltipHotkey:n.a.priModKey+" + E"}),l.a.createElement(m.a,{id:"optionsButton",ref:"options",tooltip:"More",icon:"icon-settings",iconSize:14,width:y,height:y,onMouseDown:this.onMouseDownOptions})))}return l.a.createElement(l.a.Fragment,null,e,t)}});t.a=g},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(35),d=a(10),c=a(256),u=a(32),h=a(12),f=a(66),p=a(6),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},g=o.a.createClass({displayName:"ReactToolbarBoards",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({isHovered:!1})},getState:function(){return{hasPremiumFeatures:i.default.billingManager.hasPremiumFeaturesObservable,workspaces:l.a._workspaces,selectedIndex:l.a.selectedIndex}},moveChild:function(e,t){l.a.moveTo(e,t)},onMouseEnter:function(){this.isHovered.set(!0),document.addEventListener("mousemove",this.onMouseMove)},onMouseMove:function(e){i.default.hasClass(e.target,"sidebarDragHandle")||!i.default.isAttachedToDoc(e.target)||i.default.findParent(e.target,"sidebarBoardOutside")||i.default.findParent(e.target,"sidebarBoard")||this.onMouseLeave()},onMouseLeave:function(e){this.isHovered.set(!1),document.removeEventListener("mousemove",this.onMouseMove)},onClickNew:function(e){var t=this.refs.newButton.getElement();!i.default.billingManager.hasPremiumFeatures()&&this.state.workspaces.length>=r.a.MaxBoardsFree?i.default.menus.openContextMenu({fn:this.renderUpsell,element:t}):i.default.menus.openAddPaneMenu({element:e.target,fromNewBoard:!0},function(e,t,a){i.default.vmMain.paneManager.addWorkspace(),d.a.performAction(TrackerType.UIAction,{type:TrackerUIAction.AddBoard})})},onClickAddPane:function(e){i.default.menus.openAddPaneMenu({element:e.target})},onClickUpsell:function(){var e=!i.default.billingManager.isTrialOver();i.default.menus.closeContextMenu(),e?i.default.billingManager.startTrial():i.default.menus.openSettings(r.a.SettingsSections.Account)},renderUpsell:function(e){var t=!i.default.billingManager.isTrialOver();return s.a.createElement(h.a,m({},e,{key:"contextMenuBoardsUpsell",id:"contextMenuBoardsUpsell",background:"c-background"}),s.a.createElement("div",null,s.a.createElement("div",null,"Using more than ",r.a.MaxBoardsFree," boards is a Premium feature that allows you to customize your workflow and save multiple sets of panes."),s.a.createElement("br",null),t&&s.a.createElement("div",null,"Start your ",r.a.TrialDuration," day free trial to enable unlimited Boards."),!t&&s.a.createElement("div",null,"Go Premium to enable unlimited Boards.")),s.a.createElement("br",null),s.a.createElement("div",{className:"center"},s.a.createElement(p.a,{primary:!0,raised:!0,onClick:this.onClickUpsell},t?"Start Trial":"Go Premium")))},render:function(){for(var e=this.state,t=this.props,a=(i.default.classNames({upsell:!e.hasPremiumFeatures}),i.default.classNames({flexbox:!t.isSmall})),n=[],o=0;o<e.workspaces.length;o++){var l=e.workspaces[o];n.push(s.a.createElement(c.a,{key:l.id,workspace:l,active:o===e.selectedIndex,buttonSize:t.buttonSize}))}return s.a.createElement("div",{className:"toolbarBoards"},s.a.createElement(u.a,{orientation:r.a.Orientation.Horizontal,showScrollbars:!0,tinyMode:!0},s.a.createElement(f.a,{moveChild:this.moveChild,onMouseEnter:this.onMouseEnter,horizontal:!0},n),s.a.createElement("span",{className:a},s.a.createElement(p.a,{icon:"icon-add",iconSize:16,width:t.buttonSize,height:t.buttonSize,onClick:this.onClickNew,tooltip:"Add new board",ref:"newButton"}))))}});t.a=g},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(8),d=a(18),c=a(35),u=a(12),h=a(16),f=a(6),p=a(21),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},g=o.a.createClass({displayName:"ReactBoardItem",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){var e=c.a.isAdding();e&&c.a.setIsAdding(!1),this.createObservables({isEditing:e})},getState:function(){return{name:this.props.workspace.name,selected:c.a.selected,hotkeySelectedIndex:c.a.hotkeySelectedIndex,hotkeySelected:c.a.getHotkeySelected()}},onBeforeChanged:function(e,t){e.selected!==t.selected&&e.isEditing&&e.selected!==this.props.workspace&&(this.isEditing.set(!1,!1),e.isEditing=!1)},onMouseEnter:function(){d.a.isDragging&&!this.props.active&&this.onClick()},openMenu:function(e){i.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})},onClickRemove:function(){this.props.active?i.default.tooltip.displayTip({text:"Cannot remove the active board.",element:this.refs.element}):c.a.removeWorkspace(this.props.workspace)},onClickClone:function(){c.a.cloneBoard(this.props.workspace)},onClick:function(){i.default.vmMain.paneManager.switchToWorkspace(this.props.workspace)},edit:function(){this.isEditing.set(!0)},rename:function(){if(this.state.isEditing){var e=this.refs.input.getValue();c.a.renameWorkspace(this.props.workspace,e)?this.isEditing.set(!1):i.default.tooltip.displayTip({text:"Please give this board a unique name.",element:this.refs.element})}},onEnter:function(){this.rename();var e=i.default.vmMain.paneManager.getPaneAtIndex(0);if(l.a.focusPane(e),!l.a.isValid()&&e.isEditable){var t=e.indexOfFirstItem();e.selectIndex(t),e.scrollIndexIntoView(t,ScrollDuration.Default)}},onEscape:function(){this.refs.input.setValue(this.state.name),this.isEditing.set(!1)},renderContextMenu:function(e){return s.a.createElement(u.a,m({},e,{key:"contextMenuBoard",id:"contextMenuBoard"}),s.a.createElement(h.a,{onClick:this.edit},"Rename"),s.a.createElement(h.a,{onClick:this.onClickClone},"Clone as new board"),s.a.createElement("hr",null),s.a.createElement(h.a,{onClick:this.onClickRemove},"Delete"))},render:function(){var e=this.props,t=this.state,a=i.default.classNames("toolbarBoard c-border-super-light",e.className,{"c-bg-toolbar ":!e.active},{"active c-background":e.active}),r=t.name||"Board";return s.a.createElement("div",{className:a,ref:"element",onMouseEnter:this.onMouseEnter},t.isEditing&&s.a.createElement(p.a,{height:e.buttonSize,value:r,border:!1,focused:!0,selectAll:!0,onEnter:this.onEnter,onBlur:this.rename,onEscape:this.onEscape,ref:"input"}),!t.isEditing&&s.a.createElement(f.a,{height:e.buttonSize,fontSize:12,onClick:this.onClick,selected:e.active,onMouseEnter:this.onMouseEnter,onDoubleClick:this.edit,onRightClick:this.openMenu,ref:"menu"},r))}});t.a=g},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(35),d=a(10),c=a(4),u=a(258),h=a(12),f=a(66),p=a(6),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},g=o.a.createClass({displayName:"ReactSidebarBoards",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({isHovered:!1}),window.addEventListener("mouseout",this.onWindowOut)},getState:function(){return{hasPremiumFeatures:i.default.billingManager.hasPremiumFeaturesObservable,workspaces:l.a._workspaces,selectedIndex:l.a.selectedIndex}},onUnmount:function(){document.removeEventListener("mouseout",this.onWindowOut)},moveChild:function(e,t){l.a.moveTo(e,t)},onMouseEnter:function(){this.isHovered.set(!0),document.addEventListener("mousemove",this.onMouseMove)},onMouseMove:function(e){i.default.hasClass(e.target,"sidebarDragHandle")||!i.default.isAttachedToDoc(e.target)||i.default.findParent(e.target,"sidebarBoardOutside")||i.default.findParent(e.target,"sidebarBoard")||this.onMouseLeave()},onWindowOut:function(e){(e.pageX>=c.a.windowWidth()||e.pageY>=c.a.windowHeight()||e.pageX<=0||e.pageY<=0)&&this.isHovered.set(!1)},onMouseLeave:function(e){this.isHovered.set(!1),document.removeEventListener("mousemove",this.onMouseMove)},addBoard:function(){var e=this.refs.newButton.getElement();!i.default.billingManager.hasPremiumFeatures()&&this.state.workspaces.length>=r.a.MaxBoardsFree?i.default.menus.openContextMenu({fn:this.renderUpsell,element:e}):(i.default.vmMain.paneManager.addWorkspace(name),d.a.performAction(TrackerType.UIAction,{type:TrackerUIAction.AddBoard}))},onClickNew:function(){this.addBoard()},onClickUpsell:function(){var e=!i.default.billingManager.isTrialOver();i.default.menus.closeContextMenu(),e?i.default.billingManager.startTrial():i.default.menus.openSettings(r.a.SettingsSections.Account)},renderUpsell:function(e){var t=!i.default.billingManager.isTrialOver();return s.a.createElement(h.a,m({},e,{key:"contextMenuBoardsUpsell",id:"contextMenuBoardsUpsell",background:"c-background"}),s.a.createElement("div",null,s.a.createElement("div",null,"Using more than 2 boards is a Premium feature that allows you to customize your workflow and save multiple sets of panes."),s.a.createElement("br",null),t&&s.a.createElement("div",null,"Start your ",r.a.TrialDuration," day free trial to enable unlimited Boards."),!t&&s.a.createElement("div",null,"Go Premium to enable unlimited Boards.")),s.a.createElement("br",null),s.a.createElement("div",{className:"center"},s.a.createElement(p.a,{primary:!0,raised:!0,onClick:this.onClickUpsell},t?"Start Trial":"Go Premium")))},render:function(){for(var e=this.state,t=this.props,a=(i.default.classNames({upsell:!e.hasPremiumFeatures}),[]),r=0;r<e.workspaces.length;r++){var n=e.workspaces[r];a.push(s.a.createElement(u.a,{key:n.id,number:r+1,workspace:n,active:r===e.selectedIndex,fontSize:t.fontSize,padding:t.padding,buttonSize:t.buttonSize,numWorkspaces:e.workspaces.length,isBoardsHovered:e.isHovered,isSmall:t.isSmall}))}return s.a.createElement("div",{className:"sidebarBoards"},s.a.createElement(f.a,{moveChild:this.moveChild,onMouseEnter:this.onMouseEnter},a),s.a.createElement(p.a,{icon:"icon-add",className:"addButton",iconSize:16,width:t.isSmall?void 0:36,height:t.buttonSize,onClick:this.onClickNew,tooltip:"Add new board",ref:"newButton"}))}});t.a=g},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(31),d=a(35),c=a(259),u=(a(12),a(30),a(16),a(6)),h=a(21),f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};var p=o.a.createClass({displayName:"ReactSidebarBoard",componentDisplay:r.a.ComponentDisplay.Desktop,init:function(){this.createObservables({isHovered:!1,isEditing:!1})},getState:function(){return{name:this.props.workspace.name,selected:d.a.selected,hotkeySelectedIndex:d.a.hotkeySelectedIndex,hotkeySelected:d.a.getHotkeySelected()}},onUnmount:function(){document.removeEventListener("mousemove",this.onMouseMove)},onClickEdit:function(){this.onMouseLeave(),this.isEditing.set(!0)},onMouseEnter:function(e){this.isHovered.set(!0),document.addEventListener("mousemove",this.onMouseMove)},onMouseMove:function(e){var t=this.refs.menu.getBoundingClientRect(),a=e.clientX<l.a.getSidebarWidth()?0:24;(e.clientY<t.top-a||e.clientY>t.bottom+a||e.clientX>l.a.getSidebarWidth()+96+16)&&this.onMouseLeave()},onMouseLeave:function(){this.isHovered.get()&&(this.isHovered.set(!1),document.removeEventListener("mousemove",this.onMouseMove))},onClickRemove:function(){this.props.active?i.default.tooltip.displayTip({text:"Cannot remove the active board.",element:this.refs.deleteButton.getElement()}):d.a.removeWorkspace(this.props.workspace)},onClickClone:function(e){this.isHovered.set(!1),d.a.cloneBoard()},onClick:function(){i.default.vmMain.paneManager.switchToWorkspace(this.props.workspace)},onEscape:function(){this.refs.input.setValue(this.state.name),this.isEditing.set(!1)},rename:function(){if(this.state.isEditing){var e=this.refs.input.getValue();d.a.renameWorkspace(this.props.workspace,e)?this.isEditing.set(!1):i.default.tooltip.displayTip({text:"Please give this board a unique name.",element:this.refs.element})}},render:function(){var e=this.props,t=this.state,a=(this.props.workspace,e.number),r=e.workspace,n=e.active,o=(e.padding,e.isAdding,e.fontSize),d=e.isSmall,p=e.numWorkspaces,m=e.isBoardsHovered,g=e.buttonSize,v=(e.toolbar,function(e,t){var a={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a}(e,["number","workspace","active","padding","isAdding","fontSize","isSmall","numWorkspaces","isBoardsHovered","buttonSize","toolbar"])),y=p>1&&void 0===t.hotkeySelected,S=i.default.classNames(e.className,{"sidebarBoard c-bg-sidebar":!e.toolbar},{"toolbarBoard c-bg-toolbar c-border-super-light":e.toolbar},{showDragHandle:y},{selected:t.hotkeySelected===r}),E=i.default.classNames({"active c-background":n}),P=t.name||"Board",b=!d&&t.isHovered,C=d&&(m||t.hotkeySelected),D={width:b&&96,left:l.a.getSidebarWidth()},I=i.default.classNames("sidebarBoardOutside c-bg-sidebar c-button sidebarOutsideName pointer",{active:n},{selected:t.hotkeySelected===r});if(b||C){var A=i.default.offset(this.refs.menu);D.top=A.top-(32-g)/2,D.height=32,D.lineHeight="32px"}return e.isSmall&&(P=P.substr(0,Math.min(t.name.length,4))),s.a.createElement("div",f({},v,{className:S,ref:"menu",onMouseEnter:this.onMouseEnter}),s.a.createElement("div",{className:"sidebarBoardInside",ref:"inside"},t.isEditing&&s.a.createElement(h.a,{height:g,className:E,fontSize:o,onClick:this.onClick,value:P,focused:!0,selectAll:!0,onEnter:this.rename,onBlur:this.rename,onEscape:this.onEscape,ref:"input"}),!t.isEditing&&s.a.createElement(u.a,{height:g,className:E,fontSize:o,onClick:this.onClick,selected:n},P),!e.isSmall&&y&&s.a.createElement("i",{className:"icon-drag-handle c-bg-sidebar c-button"}),t.hotkeySelected&&s.a.createElement("div",{className:"boardNumber pointer flexbox flex-center c-bg-sidebar",onMouseDown:this.onClick},s.a.createElement("span",null,a))),b&&s.a.createElement(c.a,{id:"portalBoardOutside_"+a},s.a.createElement("div",{className:"sidebarBoardOutside c-bg-sidebar",style:D},s.a.createElement(u.a,{icon:"icon-edit",iconSize:16,width:32,height:32,onClick:this.onClickEdit,tooltip:"Rename Board"}),s.a.createElement(u.a,{icon:"icon-filter_none",iconSize:12,width:32,height:32,onClick:this.onClickClone,tooltip:"Create copy of current board"}),s.a.createElement(u.a,{icon:"icon-delete",iconSize:16,width:32,height:32,onClick:this.onClickRemove,enabled:e.canDelete,tooltip:"Delete Board",ref:"deleteButton"}))),C&&s.a.createElement(c.a,{id:"portalBoardOutside_"+a},s.a.createElement("div",{className:I,style:D,onMouseDown:this.onClick},t.name)))}});t.a=p},function(e,t,a){"use strict";var i=a(2),r=(a.n(i),a(34)),n=a.n(r),s=a(57),o=a.n(s),l=(a(0),o()({displayName:"Portal",getInitialState:function(){return this.el=document.createElement("div"),null},componentDidMount:function(){document.body.appendChild(this.el)},componentWillUnmount:function(){document.body.removeChild(this.el)},render:function(){return n.a.createPortal(this.props.children,this.el)}}));t.a=l},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(261),l=a(3).a.createClass({displayName:"ReactEmailComposes",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){return{emailComposes:i.default.menus.emailComposeStack}},render:function(){for(var e=this.state,t=[],a=0;a<e.emailComposes.length;a++){var i=e.emailComposes[a];t.push(s.a.createElement(o.a,{key:i.draftMsg.id,threadAttach:i.attach,message:i.draftMsg}))}return s.a.createElement("div",{className:"emailComposes flexbox"},t)}});t.a=l},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(4),d=a(8),c=a(11),u=a(64),h=a(6),f=o.a.createClass({displayName:"ReactEmailComposeWindow",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.listenToDispatcher("windowResize"),this.createObservables({minimized:!1})},getState:function(){var e=l.a.windowWidth(),t=l.a.windowHeight();return{width:Math.min(Math.max(Math.min(.4*e,800),500),e-20),height:Math.min(Math.max(Math.min(.4*t,800),500),t)}},minimize:function(){this.minimized.set(!this.minimized.get())},close:function(){this.refs.compose.close(!0,!1,!0)},onClose:function(){c.a.fireEvent("EmailCompose","onClosed",[]),i.default.menus.closeComposeEmail(this.props.threadAttach,this.props.message)},onMouseDown:function(){d.a.reset()},openCc:function(){this.cc.set(!0)},openBcc:function(){this.bcc.set(!0)},componentDidMount:function(){var e=this.refs.compose;e.focusTo(),requestAnimationFrame(function(){e.focusTo()})},render:function(){var e=this.state,t={height:e.minimized?36:e.height,width:e.width},a=i.default.classNames("composeMinimize",{minimized:e.minimized});return s.a.createElement("div",{className:"composeEmail c-shadow-popup c-background flexbox flexvert",ref:"element",style:t,onMouseDown:this.onMouseDown},s.a.createElement("div",{className:"overlayTitleBar c-bg-popup-title composeTitleBar flexbox"},s.a.createElement("div",{className:"composeTitle f1"},"New Message"),s.a.createElement(h.a,{className:a,icon:"icon-minus",iconSize:14,width:36,height:36,onClick:this.minimize,tooltip:"Minimize"}),s.a.createElement(h.a,{className:"composeClose",icon:"icon-close",iconSize:18,width:36,height:36,onClick:this.close,tooltip:"Close"})),s.a.createElement(u.a,{className:"f1",threadAttach:this.props.threadAttach,message:this.props.message,showSubject:!0,onClose:this.onClose,ref:"compose",focus:"to",hidden:e.minimized}))}});t.a=f},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=(a(20),a(92)),c=a(91),u=a(21),h=a(6),f=a(32),p=l.a.createClass({displayName:"ReactOverview",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({addingItem:void 0})},componentDidMount:function(){var e=this.props.pane,t=e.getOverview(),a=t.scrollElement=this.refs.overviewScroller.getScrollElement(),r=t.contentElement=this.refElement("overviewContentElement");e.getInfiniteList(!0).setupScroller(a,r),this.setData(a,e),i.default.setupClick(a,e.getOverview(),e.getOverview().onTap)},getState:function(){var e=this.props.pane,t=e.getOverview(),a={isVisible:t.isVisible,zoomed:e.item};return a.cursor=t.cursor,a.rect=e.rect,a.isAtRoot=e.getItem()===e.getRootItem(),e.type===PaneMode.Gmail&&(a.overviewAccount=e._overviewAccount),a},renderCell:function(e,t){var a=this.props.pane;return o.a.createElement(d.a,{key:e,list:a.getInfiniteList(!0),pane:a,cell:t,overview:!0})},sizeAtIndex:function(e){var t=this.props.pane;return t.headers.get()[e].sizeInPane(t,!0)},itemsObs:function(){return this.props.pane.headers},onClickAddTop:function(){this.addingItem.set("top")},onClickAddBottom:function(){this.addingItem.set("bottom"),this.refs.overviewScroller.scrollToBottom()},onClickAll:function(){i.default.vmMain.zoomout(this.props.pane.getRootItem())},onAddItem:function(e){var t=this.refs.inputAddItem.getValue();this.addingItem.set(void 0);var a=this.props.pane,i=a.getRootItem(),r="top"===e?0:i.numItems(),n=a.addProject(r,t);setTimeout(function(){a.scrollItemToTop(n,ScrollDuration.Default)},0)},onClickCancel:function(){this.addingItem.set(void 0)},onClickGmailAccount:function(e){var t=this.props.pane;t.setOverviewAccount(e),i.default.vmMain.zoomin(t.getDefaultDisplayItem(e))},renderAddProjectInput:function(e){var t=this.onAddItem.bind(this,e),a=this.onClickCancel.bind(this,e);return o.a.createElement("div",{className:"addProjectInput"},o.a.createElement(u.a,{ref:"inputAddItem",focused:!0,height:32,placeholder:"Name project",onEscape:a,onEnter:t}),o.a.createElement("div",{className:"addProjectButtons"},o.a.createElement(h.a,{primary:!0,onClick:t},"Add Project"),o.a.createElement(h.a,{onClick:a},"Cancel")))},renderShowAllButton:function(e){return o.a.createElement(h.a,{className:"overviewHeaderButton",icon:"icon-visibility",height:32,onClick:this.onClickAll,enabled:!this.state.isAtRoot},"Show all "+e)},renderHeader:function(){var e=this.state,t=this.props.pane;switch(t.type){case PaneMode.Task:var a=t.isViewOutline()||t.isViewProject();return o.a.createElement("div",{className:"overviewHeader c-border"},this.renderShowAllButton("projects"),a&&"top"!==e.addingItem&&o.a.createElement(h.a,{className:"overviewHeaderButton",icon:"icon-add",height:30,onClick:this.onClickAddTop},"Add project"),a&&"top"===e.addingItem&&this.renderAddProjectInput("top"));case PaneMode.Archived:return o.a.createElement("div",{className:"overviewHeader c-border"},this.renderShowAllButton("projects"));case PaneMode.Drive:return o.a.createElement("div",{className:"overviewHeader"},o.a.createElement("div",{className:"overviewHeaderTitle"}),this.renderShowAllButton("folders"));case PaneMode.Gmail:var r=i.default.vmMain.pluginManager.getPlugin(PluginID.Gmail),n=e.overviewAccount,s=r.getSyncAccounts(),l=i.default.classNames("overviewHeader",{"c-border":s.length>1});return o.a.createElement("div",{className:l},s.length>1&&s.map(function(e){return o.a.createElement(h.a,{className:"overviewHeaderButton",key:e,selected:e===n,height:30,onClick:this.onClickGmailAccount.bind(this,e)},e)}.bind(this)))}},renderFooter:function(){var e=this.state,t=this.props.pane;switch(t.type){case PaneMode.Task:return t.isViewOutline()||t.isViewProject()?o.a.createElement("div",{className:"overviewFooter c-border"},"bottom"===e.addingItem&&this.renderAddProjectInput("bottom"),"bottom"!==e.addingItem&&o.a.createElement(h.a,{className:"overviewHeaderButton",icon:"icon-add",height:32,onClick:this.onClickAddBottom},"Add project")):null}},render:function(){var e=this.state,t=this.props.pane,a={};a.width=r.a.OverviewWidth,a.cursor=e.cursor,a[n.a.transform.react]="translate("+(e.rect.left-r.a.OverviewWidth)+"px,0)";var s=i.default.classNames("paneOverview",t.type+"Overview"),l=i.default.classNames(this.props.className,"paneOverviewScroller","scroller",{customScroller:t.useCustomScroller}),d=this.renderHeader(),u=this.renderFooter();return o.a.createElement(f.a,{className:l,ref:"overviewScroller",style:a,"data-moo-id":this.getUniqueID(),showScrollbars:!0},o.a.createElement("div",{className:s,ref:"overview"},d,o.a.createElement(c.a,{owner:t.getInfiniteList(!0),pane:t,overview:!0,renderCell:this.renderCell,itemsObs:this.itemsObs,minItemHeight:i.default.minItemHeight,contentClass:"overviewList noSelect mat-list",ref:"overviewContentElement"}),u))}});t.a=p},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=a(8),c=(a(13),a(28)),u=(a(35),a(264)),h=a(265),f=a(12),p=a(16),m=a(40),g=a(6),v=a(32),y=(a(37),l.a.createClass({displayName:"ReactEmailPreview",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.listenToDispatcher("windowResize"),this.createObservables({expandedMessages:[]}),i.default.isDemoMode()&&(i.default.reactEmailPreview=this)},onBeforeChanged:function(e,t){if(e.thread!==t.thread){var a=e.messages,i=[];if(a.length>0)for(var r=this.getLastMessage(e),n=0;n<a.length;n++){var s=a[n];(s===r||this.isMessageUnread(s))&&i.push(s.id)}this.expandedMessages.set(i,!1),e.expandedMessages=i}},getState:function(){return{rect:this.props.pane.rect,pane:c.a.openOnPane,isLoading:c.a.isLoading,thread:c.a.threadAttach,threadItem:c.a.threadItem,messages:c.a.messages,errorMessage:c.a.errorMessage,messagesLoaded:c.a.messagesLoaded,bottomBarHeight:!1}},getLastMessage:function(e){var t=(e=e||this.state).messages,a=e.thread,i=t.length-1;return this.isMessageDraft(t[i])&&!a.getPlugin().getAttachField(a,"pendingSend")&&i--,t[i]},onEscapeKey:function(){c.a.close()},isMessageDraft:function(e){return e.labelIds.indexOf("DRAFT")>=0},isMessageUnread:function(e){return e.labelIds.indexOf("UNREAD")>=0},onClickClose:function(){c.a.close()},onClickArchive:function(){this.state.pane.archiveItem(!0,this.state.threadItem)},onClickLabel:function(e){this.state.pane.autocompleteLabel({elementDisplay:e.target,item:this.state.threadItem})},onClickMove:function(e){this.state.pane.autocompleteMove({elementDisplay:e.target,item:this.state.threadItem})},onClickSchedule:function(e){this.state.pane.autocompleteSchedule({elementDisplay:e.target,item:this.state.threadItem})},onClickSnooze:function(e){var t=this.state.thread.getField("accountID");this.state.pane.autocompleteSnooze({elementDisplay:e.target,item:this.state.threadItem},t)},onClickUnread:function(){this.state.pane.markItemRead(!1,this.state.threadItem)},onClickDelete:function(){var e,t=this.state,a=t.pane,r=i.default.vmMain.getDefaultEmailPlugin();if(a.type===PaneMode.Gmail)this.state.pane.deleteSelected(r.isGmailItem,!0);else if(d.a.getStartItem()===t.threadItem&&(e=a.indexOfPrevVMLI(d.a.getStartIndex(),!0,!0)),t.threadItem.deleteSelf(ChangeType.Local),c.a.reset(),e){var n=a.itemAtIndex(e);if(n){var s=n.getParsedText().length;d.a.selectIndex(e,s)}}},onClickPrint:function(){var e=i.default.vmMain.getDefaultEmailPlugin().createPrintURLForThread(this.state.thread);i.default.printPage(e)},onClickViewInGmail:function(){var e=i.default.vmMain.getDefaultEmailPlugin().createURLForThread(this.state.thread);i.default.openUrl(e)},onClickReply:function(e){var t=this.getLastMessage();c.a.setMessageResponseMode(t.id,r.a.EmailResponseMode.Reply)},onClickReplyAll:function(e){var t=this.getLastMessage();c.a.setMessageResponseMode(t.id,r.a.EmailResponseMode.ReplyAll)},onClickForward:function(e){var t=this.getLastMessage();c.a.setMessageResponseMode(t.id,r.a.EmailResponseMode.Forward)},toggleExpanded:function(e){var t=this.state.messages,a=t[e];this.expandedMessages.indexOf(a.id)>=0?!(t.length>1&&e<t.length-1)||t[e+1]&&this.isMessageDraft(t[e+1])||this.expandedMessages.remove(a.id):this.expandedMessages.push(a.id)},onClickDown:function(){this.props.pane.keyMoveDown()},onClickUp:function(){this.props.pane.keyMoveUp()},onClickMobileReply:function(){i.default.menus.openContextMenu({fn:this.renderContextMenuReply})},renderContextMenuReply:function(e){return o.a.createElement(f.a,{key:"contextMenuGmailReply",id:"contextMenuGmailReply",className:"contextMenuMobile",element:e.element,position:"bottom"},o.a.createElement(p.a,{icon:"icon-reply",onClick:this.onClickReply},"Reply"),o.a.createElement(p.a,{icon:"icon-reply-all",onClick:this.onClickReplyAll},"Reply All"),o.a.createElement(p.a,{icon:"icon-forward",onClick:this.onClickForward},"Forward"))},render:function(){var e=this.state,t=(this.props.pane.type,PaneMode.Gmail,e.thread),a=e.messages||[],s=[];if(a.length>0){for(var l=a[0],d=(t.getPlugin().getDisplayParticipants(t),l.subject||"(no subject)"),c=[],f=this.expandedMessages.get(),p=this.getLastMessage(),y=0;y<a.length;++y){var S,E=a[y];if(this.isMessageDraft(E)){try{i.default.PAssert(2227,y>0,"Should never have a draft as the first message in the list")}catch(e){i.default.reportError(e)}var P=a[y-1];S=o.a.createElement(h.a,{key:P.id+"_draft",threadAttach:t,message:E,inReplyToMessage:P})}else{var b=f.indexOf(E.id)>=0,C=a[y-1],D=a[y+1],I=0===y||f.indexOf(C.id)>=0||this.isMessageDraft(C),A=y>=a.length-2||f.indexOf(D.id)>=0||this.isMessageDraft(D);S=o.a.createElement(u.a,{key:E.id,index:y,threadAttach:t,message:E,toggleExpanded:this.toggleExpanded.bind(this,y),expanded:b,isLastMessage:E===p,prevExpanded:I,nextExpanded:A})}c.push(S)}s=o.a.createElement("div",{className:"emailMessages c-background c-border c-foreground",style:{opacity:e.messagesLoaded?1:0}},c)}else s=e.isLoading?o.a.createElement(m.a,{center:!0},"Loading messages..."):e.errorMessage?o.a.createElement("div",{className:"noMessages center"},e.errorMessage):o.a.createElement("div",{className:"noMessages center"},"No conversation selected");var M=i.default.classNames("emailPreview c-background c-border"),_={};_.width=n.a.emailPreviewSize(),_[n.a.transform.react]="translate("+(e.rect.left+r.a.ExpandedPaneWidth)+"px,0)";var T=i.default.classNames("emailPreviewTop c-foreground c-background c-border-light",{hasBorder:a.length>0});return o.a.createElement("div",{className:M,style:_},o.a.createElement("div",{className:T},a.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"emailHeaderRow"},o.a.createElement("div",{className:"emailButtons"},o.a.createElement(g.a,{icon:"icon-check",iconSize:17,width:36,height:36,tooltip:"Archive (E)",onClick:this.onClickArchive}),o.a.createElement(g.a,{icon:"icon-access_time",iconSize:17,width:36,height:36,tooltip:"Snooze (D)",onClick:this.onClickSnooze}),o.a.createElement(g.a,{icon:"icon-unread icon-unread-header",iconSize:15,width:36,height:36,tooltip:"Mark Unread (U)",onClick:this.onClickUnread}),o.a.createElement(g.a,{icon:"icon-tag",iconSize:15,width:36,height:36,tooltip:"Label (L)",onClick:this.onClickLabel}),o.a.createElement(g.a,{icon:"icon-align-left",iconSize:15,width:36,height:36,tooltip:"Add to Outline (M)",onClick:this.onClickMove}),o.a.createElement(g.a,{icon:"icon-calendar",iconSize:15,width:36,height:36,tooltip:"Add to Calendar (C)",onClick:this.onClickSchedule}),o.a.createElement(g.a,{icon:"icon-delete",iconSize:18,width:36,height:36,tooltip:"Delete (Backspace)",onClick:this.onClickDelete}),!n.a.app&&o.a.createElement(g.a,{icon:"icon-print",iconSize:18,width:36,height:36,tooltip:"Print (P)",onClick:this.onClickPrint}),o.a.createElement(g.a,{icon:"icon-gmail",iconSize:15,width:36,height:36,tooltip:"Open in Gmail (G)",onClick:this.onClickViewInGmail}))),o.a.createElement("div",{className:"emailHeaderRow emailSubject"},d)),o.a.createElement(g.a,{className:"closeButton",icon:"icon-close",iconSize:18,width:40,height:40,color:void 0,onClick:this.onClickClose,tooltip:"Close"})),o.a.createElement(v.a,{className:"emailMessagesScroller"},s))}}));t.a=y},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=a(13),c=a(28),u=a(8),h=a(97),f=a(50),p=a(6),m=l.a.createClass({displayName:"ReactMessagePreview",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this._initializedFrame=!1,this.createObservables({hovered:!1})},componentDidMount:function(){this.props.isLastMessage&&this.props.index>0&&(this.needsScrollIntoView=!0),this.checkIsHovered(),this._initializeFrame()},_initializeFrame:function(){if(!this._initializedFrame&&this.refs.frame){this._initializedFrame=!0;var e=this.refs.frame.contentWindow.document;n.a.supportBlobURLIFrame||(e.open(),e.write(this.props.message.blob),e.close())}},getState:function(){var e=this.props.message;return{responseMode:e.responseMode,height:e.height,width:e.width}},onAfterChanged:function(e,t){this._initializeFrame(),e.height!==t.height&&e.height>0&&(this.checkIsHovered(),this.needsScrollIntoView&&(this.needsScrollIntoView=!1,this.scrollIntoView()))},checkIsHovered:function(){var e=u.a.getMousePos(),t=document.elementFromPoint(e.x,e.y);t&&i.default.findParent(t,"emailMessageWrapper")===this.refs.message&&this.hovered.set(!0)},scrollIntoView:function(){var e=this.refs.message,t=i.default.findParent(e,"fancyScrollContent"),a=0;a=e.clientHeight>t.clientHeight?e.offsetTop:t.scrollHeight-t.clientHeight,i.default.scrollTo(0,a,ScrollDuration.Snap,t)},onClickHeader:function(){this.props.toggleExpanded()},onMouseEnterMessage:function(){this.hovered.set(!0)},onMouseLeaveMessage:function(){this.hovered.set(!1)},onClickReply:function(e){c.a.setMessageResponseMode(this.props.message.id,r.a.EmailResponseMode.Reply),e.stopPropagation()},onClickReplyAll:function(e){c.a.setMessageResponseMode(this.props.message.id,r.a.EmailResponseMode.ReplyAll),e.stopPropagation()},onClickForward:function(e){c.a.setMessageResponseMode(this.props.message.id,r.a.EmailResponseMode.Forward),e.stopPropagation()},onClickReport:function(){i.default.menus.openModalNew(Modals.ReportProblem,{accountID:this.props.threadAttach.getField("accountID"),threadID:this.props.threadAttach.id,msgID:this.props.message.id})},_generateParticipantText:function(e){return e.text?e.text:e.email},isExpanded:function(){return this.props.expanded||this.props.isLastMessage||this.state.responseMode!==r.a.EmailResponseMode.None},openEmailDetails:function(e){var t=this.refs.messageHeaderText;i.default.menus.openContextMenu({componentName:"ReactContextMenuEmailDetails",element:t,message:this.props.message,accountID:this.props.threadAttach.getField("accountID")}),e.stopPropagation()},render:function(){var e,t=this.props,a=this.state,s=t.message,l=this.isExpanded(),c={height:a.height},u=d.a.formatDate(s.date,DFormat.MonthDay),m=d.a.formatDate(s.date,DFormat.ShortTime),g=t.isLastMessage||a.responseMode!==r.a.EmailResponseMode.None,v=n.a.windowWidth()>1080&&!i.default.isDemoMode(),y={},S={},E={};if(l||(y.opacity=a.hovered?"1":"0"),v&&(S.opacity=a.hovered?"1":"0"),n.a.ios){var P=Math.max(r.a.MinEmailScale,(n.a.windowWidth()-32)/a.width);P<1&&(c[n.a.transform.react]="scale("+P+")",E.height=a.height*P,E.overflow="hidden")}var b,C,D={cursor:l?"pointer":null};if(b=o.a.createElement("span",{className:"from",onClick:l?this.openEmailDetails:void 0,style:D},this._generateParticipantText(s.from)),l){var I=(s.to?s.to:[]).concat(s.cc?s.cc:[]).map(this._generateParticipantText).join(", ");C=o.a.createElement("span",{className:"to c-foreground-faded",onClick:this.openEmailDetails,style:{cursor:"pointer"}},!1,o.a.createElement("i",{className:"icon-long-arrow-right"}),o.a.createElement("span",null,I))}else C=o.a.createElement("span",{className:"snippet",dangerouslySetInnerHTML:{__html:s.snippet}});var A,M=o.a.createElement("span",{className:"emailDate c-foreground-faded"},o.a.createElement("div",{className:"emailDateDate"},u),o.a.createElement("div",{className:"emailDateTime"},m));e=o.a.createElement(f.a,{className:"messageHeader flexbox",onClick:this.onClickHeader},o.a.createElement("span",{className:"messageHeaderText f1",ref:"messageHeaderText"},b,C,!1),o.a.createElement("span",{className:"headerButtons",style:y},v&&o.a.createElement(p.a,{height:40,className:"reportEmail",style:S,onClick:this.onClickReport},"Report Problem"),o.a.createElement(p.a,{iconSize:16,width:40,height:40,icon:"icon-reply",tooltip:"Reply",onClick:this.onClickReply}),o.a.createElement(p.a,{iconSize:16,width:40,height:40,icon:"icon-reply-all",tooltip:"Reply All",onClick:this.onClickReplyAll}),o.a.createElement(p.a,{iconSize:16,width:40,height:40,icon:"icon-forward",tooltip:"Forward",onClick:this.onClickForward})),M),A=n.a.supportBlobURLIFrame?o.a.createElement("iframe",{key:"ep_"+this.props.message.id,ref:"frame",sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",src:s.blobURL,style:c,scrolling:"no"}):o.a.createElement("iframe",{key:"ep_"+this.props.message.id,ref:"frame",sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",style:c,scrolling:n.a.ios?"no":void 0});var _=i.default.classNames("emailMessage emailBox c-border",{collapsed:!l},{prevCollapsed:!t.prevExpanded},{nextCollapsed:!t.nextExpanded}),T=i.default.classNames("emailMessageWrapper",{replying:a.responseMode!==r.a.EmailResponseMode.None});return o.a.createElement("div",{className:T,onMouseEnter:this.onMouseEnterMessage,onMouseLeave:this.onMouseLeaveMessage,ref:"message"},o.a.createElement("div",{className:_},e,l&&o.a.createElement("div",{className:"messageContent",style:E},A,o.a.createElement(h.a,{threadAttach:t.threadAttach,message:t.message,editable:!1}))),g&&o.a.createElement("div",{className:"replyPlaceholder flexbox flex-center",ref:"placeholder"},o.a.createElement("div",{className:"replyPlaceholderInner c-background c-shadow-light"},o.a.createElement(p.a,{iconSize:16,width:40,height:40,icon:"icon-reply",tooltip:"Reply",onClick:this.onClickReply,selected:a.responseMode===r.a.EmailResponseMode.Reply,padding:24}),o.a.createElement(p.a,{iconSize:16,width:40,height:40,icon:"icon-reply-all",tooltip:"Reply All",onClick:this.onClickReplyAll,selected:a.responseMode===r.a.EmailResponseMode.ReplyAll,padding:24}),o.a.createElement(p.a,{iconSize:16,width:40,height:40,icon:"icon-forward",tooltip:"Forward",onClick:this.onClickForward,selected:a.responseMode===r.a.EmailResponseMode.Forward,padding:24}))))}});t.a=m},function(e,t,a){"use strict";var i=a(0),r=(a(4),a(1)),n=a(2),s=a.n(n),o=a(3),l=a(28),d=a(64),c=o.a.createClass({displayName:"ReactEmailReplyBox",componentDisplay:r.a.ComponentDisplay.Everywhere,componentDidUpdate:function(){this._updateFocus()},componentDidMount:function(){this.refs.message&&(this.scrollIntoView(),this._updateFocus())},getState:function(){var e=this.props.inReplyToMessage;return{responseMode:e.responseMode,replytoMessageHeight:e.height}},onAfterChanged:function(e,t){e.replytoMessageHeight!==t.replytoMessageHeight&&this.scrollIntoView()},scrollIntoView:function(){var e=this.refs.message;if(e){var t=i.default.findParent(e,"fancyScrollContent"),a=e.offsetTop+e.offsetHeight-t.clientHeight+16;i.default.scrollTo(0,a,ScrollDuration.Default,t)}},_updateFocus:function(){var e=this.state.responseMode;switch(e){case r.a.EmailResponseMode.None:break;case r.a.EmailResponseMode.Reply:case r.a.EmailResponseMode.ReplyAll:case r.a.EmailResponseMode.Other:this.focusBody();break;case r.a.EmailResponseMode.Forward:this.focusTo();break;default:try{i.default.PAssert(2586,!1,"Unknown response mode for reply box",e)}catch(e){i.default.reportError(e)}}},focusTo:function(){this.refs.compose.focusTo()},focusBody:function(){this.refs.compose.focusBody()},onClose:function(){l.a.setMessageResponseMode(this.props.inReplyToMessage.id,r.a.EmailResponseMode.None)},render:function(){return this.state.responseMode!==r.a.EmailResponseMode.None?s.a.createElement("div",{className:"emailReplyBox emailBox c-shadow-popup",ref:"message"},s.a.createElement(d.a,{threadAttach:this.props.threadAttach,message:this.props.message,ref:"compose",onClose:this.onClose,responseMode:this.state.responseMode,closeOnEscape:!0})):null}});t.a=c},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(41),l=(a.n(o),a(3)),d=a(61),c=a(267),u=l.a.createClass({displayName:"ReactToasts",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){return{toasts:d.a.queue}},render:function(){for(var e=this.state,t=[],a=0;a<e.toasts.length;a++){var r=e.toasts[a];i.default.classNames("toast noSelect",{hasAction:!!r.actionText},{big:r.isBig});t.push(s.a.createElement(c.a,{key:r.id,toast:r}))}return s.a.createElement(o.CSSTransitionGroup,{id:"toasts",transitionName:"reactFade",transitionEnterTimeout:800,transitionLeaveTimeout:100},t)}});t.a=u},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(6),d=o.a.createClass({displayName:"ReactToast",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){return{text:this.props.toast.text}},render:function(){var e=this.props.toast,t=this.state.text,a=i.default.classNames("toast noSelect",{hasAction:!!e.actionText},{big:e.isBig});return s.a.createElement("div",{className:a,onClick:e.onTapIgnore.bind(e)},s.a.createElement(l.a,{width:40,height:40,icon:"icon-close",className:"messageClose",onClick:e.onTapIgnore.bind(e)}),s.a.createElement("span",{className:"messageText f1",dangerouslySetInnerHTML:{__html:t}}),s.a.createElement(l.a,{primary:!0,className:"messageAction",onClick:e.doAction.bind(e)},e.actionText))}});t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3).a.createClass({displayName:"ReactDemoUI",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){return{caption:i.default.AScript.demoCaption}},render:function(){var e=this.state.caption;if(void 0!==e){var t=i.default.classNames("demoCaption",{center:e.center},{light:e.light});return s.a.createElement("div",{className:t,style:{opacity:e.opacity}},s.a.createElement("div",{className:"demoCaptionText",dangerouslySetInnerHTML:{__html:e.text}}))}return null}});t.a=o},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=a(15),c=a(40),u=a(32),h=a(6),f=l.a.createClass({displayName:"ReactTrashError",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.createObservables({failedRestoring:!1,isRestoring:!1,isRedirecting:!1})},getState:function(){return{filesTrashed:i.default.vmMain.docManager._docListTrashed}},getTrashUrl:function(){return"https://drive.google.com/drive/u/"+i.default.vmMain.getUserEmail()+"/search?q=mimetype=application/vnd.google-apps.drive-sdk.597847337936%20is:trashed"},reload:function(){i.default.reload()},onClickRestore:function(){var e=this.state,t=e.filesTrashed.length,a=0,r=function(){++a===t&&(this.isRestoring.set(!1),this.isRedirecting.set(!0),setTimeout(this.reload,1e3))}.bind(this),n=function(e){i.default.reportError(new Error("Failed to untrash doc: "+e.error.code),e),this.isRestoring.set(!1),this.failedRestoring.set(!0)}.bind(this);this.isRestoring.set(!0);for(var s=0;s<t;s++){var o=e.filesTrashed[s];i.default.vmMain.remoteAPI().driveFilesUntrash(o.id,r,n)}},onClickNew:function(){d.a.createDefaultRealtimeFile(),i.default.vmMain.clearTrashedDocumentError()},render:function(){var e=this.state,t=e.filesTrashed.length;return e.isRedirecting?o.a.createElement(c.a,{center:!0},"Loading Moo.do..."):e.isRestoring?o.a.createElement(c.a,{center:!0},"Restoring files..."):e.failedRestoring?o.a.createElement("div",{className:"centerVH trashedFiles"},o.a.createElement("div",null,"There was an error restoring your files. Please manually restore them from your Trash, which you can access ",o.a.createElement("a",{href:this.getTrashUrl(),target:"_blank"},"here"),", then click Retry."),o.a.createElement(h.a,{marginTop:32,raised:!0,primary:!0,onClick:this.reload},"Retry")):o.a.createElement("div",{className:"centerVH trashedFiles c-foreground",style:{textAlign:"left"}},o.a.createElement("div",{style:{textAlign:"left"}},1===t?"It looks like your document is in the Trash in Google Drive. Would you like to restore it or create a new document?":"It looks like your documents are in the Trash in Google Drive. Would you like to restore them or create a new document?"),o.a.createElement("div",{style:{marginTop:32,textAlign:"center"}},o.a.createElement(h.a,{raised:!0,primary:!0,onClick:this.onClickRestore},"Restore Document"+(t>1?"s":"")),o.a.createElement(h.a,{raised:!0,marginLeft:32,onClick:this.onClickNew},"New Document")),t>1&&o.a.createElement("div",null,o.a.createElement("div",{style:{margin:"32px 0 8px 8px"}},"Documents in the Trash:"),o.a.createElement(u.a,{className:"trashedFilesList c-background c-border-heavy",style:{maxHeight:300}},o.a.createElement("ul",null,e.filesTrashed.map(function(e,t){return o.a.createElement("li",{key:t,className:"c-border"},e.getTitle())}))),o.a.createElement("div",{style:{marginTop:32}},"If you'd prefer to restore the files from your Trash manually, you can access your Trash ",o.a.createElement("a",{href:this.getTrashUrl(),target:"_blank"},"here"),". Then reload the ",n.a.app?"app":"page",".")))}});t.a=f},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(2),s=a.n(n),o=a(3),l=a(6),d=o.a.createClass({displayName:"ReactIntroPopup",componentDisplay:r.a.ComponentDisplay.Desktop,close:function(){i.default.vmMain.closeHelp("firstRunIntro")},showHelp:function(){this.close();var e=i.default.createPath("help/basics");i.default.openUrl(e)},render:function(){return s.a.createElement("div",{id:"introPopup",className:"intro"},s.a.createElement("div",{className:"popup c-shadow-popup c-background"},s.a.createElement("div",{className:"overlayTitleBar c-bg-popup-title flexbox"},s.a.createElement("div",{className:"displayTitle f1"},"Introduction"),s.a.createElement(l.a,{icon:"icon-close",width:36,height:36,onClick:this.close})),s.a.createElement("div",null,s.a.createElement("div",{className:"helpSection c-border-heavy"},s.a.createElement("div",{className:"helpVideo"},s.a.createElement("iframe",{src:"https://www.youtube.com/embed/"+r.a.IntroVideoID,frameBorder:"0",allowFullScreen:!0}))),s.a.createElement("div",{id:"introOpenHelp"},s.a.createElement(l.a,{primary:!0,raised:!0,onClick:this.showHelp},"How to get started")))))}});t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(1),n=(a(4),a(2)),s=a.n(n),o=a(3),l=a(272),d=o.a.createClass({displayName:"ReactTooltips",componentDisplay:r.a.ComponentDisplay.Everywhere,getState:function(){return{tooltip:i.default.tooltip.tooltip,tooltipsSticky:i.default.tooltip.tooltipsSticky}},render:function(){var e=this.state,t=e.tooltip?e.tooltipsSticky.concat(e.tooltip):e.tooltipsSticky;return t.length>0?s.a.createElement("div",{className:"tooltips"},t.map(function(e){return s.a.createElement(l.a,{key:e.text,tip:e})})):null}});t.a=d},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3),d=a(31),c=l.a.createClass({displayName:"ReactTooltip",componentDisplay:r.a.ComponentDisplay.Everywhere,init:function(){this.listenToDispatcher("windowResize")},getState:function(){var e=this.updatePosition();return{left:e.left,top:e.top}},componentDidMount:function(){this.updateState()},updatePosition:function(){var e,t=this.props.tip,a=document.documentElement.getBoundingClientRect(),r=this.refs.element;if(t.element)e=t.element.getBoundingClientRect();else try{i.default.PAssert(2587,!1,"Adjust bounds had no valid tip for determining an offset",t)}catch(e){i.default.reportError(e)}if(e){if(r){var n,s,o=i.default.width(r),l=i.default.height(r),c=e.left+e.width/2-o/2,u=t&&t.offset;return t&&(t.onRight||i.default.findParentID(t.element,"desktopMenu",8))&&(s=!0,u={left:8+d.a.getSidebarWidth()+((u?u.left:0)||0)}),n=s?e.top+(e.height-l)/2:t&&t.above||e.bottom+l>a.bottom?e.top-l:e.bottom,u?(u.x?c+=u.x:u.right?c=a.right-o-u.right:u.left&&(c=u.left),u.y?n+=u.y:u.top&&(n+=u.top)):t&&t.above?n-=5:n+=5,c+o>a.right?c=a.right-o-4:c<0&&(c=4),n<0&&(n=4),{left:c=Math.round(c),top:n=Math.round(n)}}return{left:e.left,top:e.top}}},onClick:function(){i.default.tooltip.hideSticky(this.props.tip.text)},render:function(){var e=this.state,t=this.props.tip,a=t.text+(t.hotkey?'<div class="tooltipHotkey">'+t.hotkey+"</div>":""),r=i.default.classNames("tooltip flexbox flexvert",{blue:t.blue},{sticky:t.sticky},{hasHotkey:t.hotkey},{noFormat:a.indexOf("<b>")<0},{arrowDirection:t.arrowDirection}),s=i.default.classNames("tooltipArrow c-tooltip c-shadow-popup",t.arrowClass),l={maxWidth:t.maxWidth};return l[n.a.transform.react]="translate3d("+e.left+"px,"+e.top+"px,0)",o.a.createElement("div",{className:r,style:l,onClick:this.onClick,ref:"element"},o.a.createElement("div",{className:s}),o.a.createElement("div",{className:"tooltipText c-tooltip c-shadow-popup",dangerouslySetInnerHTML:{__html:a}}))}});t.a=c},function(e,t,a){"use strict";var i=a(0),r=a(1),n=a(4),s=a(2),o=a.n(s),l=a(3).a.createClass({displayName:"ReactSetup",componentDisplay:r.a.ComponentDisplay.Desktop,getState:function(){var e=i.default.vmSetup;return{loginState:e.loginState,loginStatus:e.loginStatus,shouldShowLogin:e.shouldShowLogin()}},onClickLogin:function(){i.default.vmSetup.onTapLogin()},onClickLanding:function(e){i.default.hasClass(e.target,"link")&&i.default.openUrl("https://www.moo.do",e)},onClickDownloadApp:function(){i.default.openUrl(n.a.getAppDownloadURL())},onClickPrivacy:function(e){i.default.hasClass(e.target,"link")&&i.default.openUrl("https://www.moo.do/privacy/",e)},render:function(){var e=this.state,t=i.default.vmSetup;return o.a.createElement("div",{id:"setupWrapper",className:"flexbox flexvert"},o.a.createElement("div",{id:"setupInner"},o.a.createElement("div",{id:"loginInfo"},o.a.createElement("div",{id:"setupLogo"})),o.a.createElement("div",{id:"setupBox"},o.a.createElement("div",{id:"login"},t.showLogin&&o.a.createElement("div",{id:"loginArea"},e.shouldShowLogin?o.a.createElement("div",{className:"loginButton google",onClick:this.onClickLogin}):o.a.createElement("div",{className:"loginButton"},o.a.createElement("span",{className:"signInText"},e.loginStatus)),o.a.createElement("div",{id:"learnButton",onClick:this.onClickLanding},"Learn more at ",o.a.createElement("b",{className:"link"},"https://moo.do"))),t.showLogin&&t.showDownload&&o.a.createElement("div",{className:"textInLine"},o.a.createElement("div",null,"or")),t.showDownload&&o.a.createElement("div",{id:"setupDownloadArea"},o.a.createElement("div",{className:"loginButton black",onClick:this.onClickDownloadApp},o.a.createElement("span",{className:n.a.getPlatformIcon()}),o.a.createElement("span",{className:"signInText"},t.downloadText))))),o.a.createElement("div",{className:"whyGoogle",onClick:this.onClickPrivacy},"Moo.do uses Google Drive to store and synchronize your data. Moo.do only has access to files it creates and never sends your data to any other server. See our ",o.a.createElement("span",{className:"link"},"Privacy Policy")," for more information.")))}});t.a=l}],[100]);
//# sourceMappingURL=main-min-1521538294945.js.map